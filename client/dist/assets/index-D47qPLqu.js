var cu=Object.defineProperty;var lu=(t,e,s)=>e in t?cu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Cs=(t,e,s)=>lu(t,typeof e!="symbol"?e+"":e,s);import{a as du,b as uu,g as gn,r as d,R as ct,p as Ia,u as Zt,c as hu,L as ot,d as $n,N as fu,e as pu,f as mu,h as as,B as gu}from"./vendor-BDP1-VUM.js";import{y as H,G as Ce,L as yu}from"./ui-CFgWxDLP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var Ko={exports:{}},hr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $a;function _u(){if($a)return hr;$a=1;var t=du(),e=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(l,f,h){var a,p={},_=null,N=null;h!==void 0&&(_=""+h),f.key!==void 0&&(_=""+f.key),f.ref!==void 0&&(N=f.ref);for(a in f)r.call(f,a)&&!i.hasOwnProperty(a)&&(p[a]=f[a]);if(l&&l.defaultProps)for(a in f=l.defaultProps,f)p[a]===void 0&&(p[a]=f[a]);return{$$typeof:e,type:l,key:_,ref:N,props:p,_owner:o.current}}return hr.Fragment=s,hr.jsx=c,hr.jsxs=c,hr}var Pa;function vu(){return Pa||(Pa=1,Ko.exports=_u()),Ko.exports}var n=vu(),Wr={},Ra;function wu(){if(Ra)return Wr;Ra=1;var t=uu();return Wr.createRoot=t.createRoot,Wr.hydrateRoot=t.hydrateRoot,Wr}var bu=wu();const xu=gn(bu),Su="modulepreload",Cu=function(t){return"/"+t},La={},ku=function(e,s,r){let o=Promise.resolve();if(s&&s.length>0){let c=function(h){return Promise.all(h.map(a=>Promise.resolve(a).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),f=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=c(s.map(h=>{if(h=Cu(h),h in La)return;La[h]=!0;const a=h.endsWith(".css"),p=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${p}`))return;const _=document.createElement("link");if(_.rel=a?"stylesheet":Su,a||(_.as="script"),_.crossOrigin="",_.href=h,f&&_.setAttribute("nonce",f),document.head.appendChild(_),a)return new Promise((N,g)=>{_.addEventListener("load",N),_.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return o.then(c=>{for(const l of c||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};var Jo,Oa;function Nu(){if(Oa)return Jo;Oa=1;var t=typeof Element<"u",e=typeof Map=="function",s=typeof Set=="function",r=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function o(i,c){if(i===c)return!0;if(i&&c&&typeof i=="object"&&typeof c=="object"){if(i.constructor!==c.constructor)return!1;var l,f,h;if(Array.isArray(i)){if(l=i.length,l!=c.length)return!1;for(f=l;f--!==0;)if(!o(i[f],c[f]))return!1;return!0}var a;if(e&&i instanceof Map&&c instanceof Map){if(i.size!==c.size)return!1;for(a=i.entries();!(f=a.next()).done;)if(!c.has(f.value[0]))return!1;for(a=i.entries();!(f=a.next()).done;)if(!o(f.value[1],c.get(f.value[0])))return!1;return!0}if(s&&i instanceof Set&&c instanceof Set){if(i.size!==c.size)return!1;for(a=i.entries();!(f=a.next()).done;)if(!c.has(f.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(i)&&ArrayBuffer.isView(c)){if(l=i.length,l!=c.length)return!1;for(f=l;f--!==0;)if(i[f]!==c[f])return!1;return!0}if(i.constructor===RegExp)return i.source===c.source&&i.flags===c.flags;if(i.valueOf!==Object.prototype.valueOf&&typeof i.valueOf=="function"&&typeof c.valueOf=="function")return i.valueOf()===c.valueOf();if(i.toString!==Object.prototype.toString&&typeof i.toString=="function"&&typeof c.toString=="function")return i.toString()===c.toString();if(h=Object.keys(i),l=h.length,l!==Object.keys(c).length)return!1;for(f=l;f--!==0;)if(!Object.prototype.hasOwnProperty.call(c,h[f]))return!1;if(t&&i instanceof Element)return!1;for(f=l;f--!==0;)if(!((h[f]==="_owner"||h[f]==="__v"||h[f]==="__o")&&i.$$typeof)&&!o(i[h[f]],c[h[f]]))return!1;return!0}return i!==i&&c!==c}return Jo=function(c,l){try{return o(c,l)}catch(f){if((f.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw f}},Jo}var ju=Nu();const Tu=gn(ju);var Qo,Ma;function Eu(){if(Ma)return Qo;Ma=1;var t=function(e,s,r,o,i,c,l,f){if(!e){var h;if(s===void 0)h=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=[r,o,i,c,l,f],p=0;h=new Error(s.replace(/%s/g,function(){return a[p++]})),h.name="Invariant Violation"}throw h.framesToPop=1,h}};return Qo=t,Qo}var Au=Eu();const Ba=gn(Au);var Xo,Fa;function Iu(){return Fa||(Fa=1,Xo=function(e,s,r,o){var i=r?r.call(o,e,s):void 0;if(i!==void 0)return!!i;if(e===s)return!0;if(typeof e!="object"||!e||typeof s!="object"||!s)return!1;var c=Object.keys(e),l=Object.keys(s);if(c.length!==l.length)return!1;for(var f=Object.prototype.hasOwnProperty.bind(s),h=0;h<c.length;h++){var a=c[h];if(!f(a))return!1;var p=e[a],_=s[a];if(i=r?r.call(o,p,_,a):void 0,i===!1||i===void 0&&p!==_)return!1}return!0}),Xo}var $u=Iu();const Pu=gn($u);var fl=(t=>(t.BASE="base",t.BODY="body",t.HEAD="head",t.HTML="html",t.LINK="link",t.META="meta",t.NOSCRIPT="noscript",t.SCRIPT="script",t.STYLE="style",t.TITLE="title",t.FRAGMENT="Symbol(react.fragment)",t))(fl||{}),Zo={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},Da=Object.values(fl),ra={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},Ru=Object.entries(ra).reduce((t,[e,s])=>(t[s]=e,t),{}),Os="data-rh",Vn={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},Wn=(t,e)=>{for(let s=t.length-1;s>=0;s-=1){const r=t[s];if(Object.prototype.hasOwnProperty.call(r,e))return r[e]}return null},Lu=t=>{let e=Wn(t,"title");const s=Wn(t,Vn.TITLE_TEMPLATE);if(Array.isArray(e)&&(e=e.join("")),s&&e)return s.replace(/%s/g,()=>e);const r=Wn(t,Vn.DEFAULT_TITLE);return e||r||void 0},Ou=t=>Wn(t,Vn.ON_CHANGE_CLIENT_STATE)||(()=>{}),ei=(t,e)=>e.filter(s=>typeof s[t]<"u").map(s=>s[t]).reduce((s,r)=>({...s,...r}),{}),Mu=(t,e)=>e.filter(s=>typeof s.base<"u").map(s=>s.base).reverse().reduce((s,r)=>{if(!s.length){const o=Object.keys(r);for(let i=0;i<o.length;i+=1){const l=o[i].toLowerCase();if(t.indexOf(l)!==-1&&r[l])return s.concat(r)}}return s},[]),Bu=t=>console&&typeof console.warn=="function"&&console.warn(t),fr=(t,e,s)=>{const r={};return s.filter(o=>Array.isArray(o[t])?!0:(typeof o[t]<"u"&&Bu(`Helmet: ${t} should be of type "Array". Instead found type "${typeof o[t]}"`),!1)).map(o=>o[t]).reverse().reduce((o,i)=>{const c={};i.filter(f=>{let h;const a=Object.keys(f);for(let _=0;_<a.length;_+=1){const N=a[_],g=N.toLowerCase();e.indexOf(g)!==-1&&!(h==="rel"&&f[h].toLowerCase()==="canonical")&&!(g==="rel"&&f[g].toLowerCase()==="stylesheet")&&(h=g),e.indexOf(N)!==-1&&(N==="innerHTML"||N==="cssText"||N==="itemprop")&&(h=N)}if(!h||!f[h])return!1;const p=f[h].toLowerCase();return r[h]||(r[h]={}),c[h]||(c[h]={}),r[h][p]?!1:(c[h][p]=!0,!0)}).reverse().forEach(f=>o.push(f));const l=Object.keys(c);for(let f=0;f<l.length;f+=1){const h=l[f],a={...r[h],...c[h]};r[h]=a}return o},[]).reverse()},Fu=(t,e)=>{if(Array.isArray(t)&&t.length){for(let s=0;s<t.length;s+=1)if(t[s][e])return!0}return!1},Du=t=>({baseTag:Mu(["href"],t),bodyAttributes:ei("bodyAttributes",t),defer:Wn(t,Vn.DEFER),encode:Wn(t,Vn.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:ei("htmlAttributes",t),linkTags:fr("link",["rel","href"],t),metaTags:fr("meta",["name","charset","http-equiv","property","itemprop"],t),noscriptTags:fr("noscript",["innerHTML"],t),onChangeClientState:Ou(t),scriptTags:fr("script",["src","innerHTML"],t),styleTags:fr("style",["cssText"],t),title:Lu(t),titleAttributes:ei("titleAttributes",t),prioritizeSeoTags:Fu(t,Vn.PRIORITIZE_SEO_TAGS)}),pl=t=>Array.isArray(t)?t.join(""):t,Uu=(t,e)=>{const s=Object.keys(t);for(let r=0;r<s.length;r+=1)if(e[s[r]]&&e[s[r]].includes(t[s[r]]))return!0;return!1},ti=(t,e)=>Array.isArray(t)?t.reduce((s,r)=>(Uu(r,e)?s.priority.push(r):s.default.push(r),s),{priority:[],default:[]}):{default:t,priority:[]},Ua=(t,e)=>({...t,[e]:void 0}),qu=["noscript","script","style"],Ei=(t,e=!0)=>e===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),ml=t=>Object.keys(t).reduce((e,s)=>{const r=typeof t[s]<"u"?`${s}="${t[s]}"`:`${s}`;return e?`${e} ${r}`:r},""),zu=(t,e,s,r)=>{const o=ml(s),i=pl(e);return o?`<${t} ${Os}="true" ${o}>${Ei(i,r)}</${t}>`:`<${t} ${Os}="true">${Ei(i,r)}</${t}>`},Hu=(t,e,s=!0)=>e.reduce((r,o)=>{const i=o,c=Object.keys(i).filter(h=>!(h==="innerHTML"||h==="cssText")).reduce((h,a)=>{const p=typeof i[a]>"u"?a:`${a}="${Ei(i[a],s)}"`;return h?`${h} ${p}`:p},""),l=i.innerHTML||i.cssText||"",f=qu.indexOf(t)===-1;return`${r}<${t} ${Os}="true" ${c}${f?"/>":`>${l}</${t}>`}`},""),gl=(t,e={})=>Object.keys(t).reduce((s,r)=>{const o=ra[r];return s[o||r]=t[r],s},e),Vu=(t,e,s)=>{const r={key:e,[Os]:!0},o=gl(s,r);return[ct.createElement("title",o,e)]},oo=(t,e)=>e.map((s,r)=>{const o={key:r,[Os]:!0};return Object.keys(s).forEach(i=>{const l=ra[i]||i;if(l==="innerHTML"||l==="cssText"){const f=s.innerHTML||s.cssText;o.dangerouslySetInnerHTML={__html:f}}else o[l]=s[i]}),ct.createElement(t,o)}),ks=(t,e,s=!0)=>{switch(t){case"title":return{toComponent:()=>Vu(t,e.title,e.titleAttributes),toString:()=>zu(t,e.title,e.titleAttributes,s)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>gl(e),toString:()=>ml(e)};default:return{toComponent:()=>oo(t,e),toString:()=>Hu(t,e,s)}}},Wu=({metaTags:t,linkTags:e,scriptTags:s,encode:r})=>{const o=ti(t,Zo.meta),i=ti(e,Zo.link),c=ti(s,Zo.script);return{priorityMethods:{toComponent:()=>[...oo("meta",o.priority),...oo("link",i.priority),...oo("script",c.priority)],toString:()=>`${ks("meta",o.priority,r)} ${ks("link",i.priority,r)} ${ks("script",c.priority,r)}`},metaTags:o.default,linkTags:i.default,scriptTags:c.default}},Gu=t=>{const{baseTag:e,bodyAttributes:s,encode:r=!0,htmlAttributes:o,noscriptTags:i,styleTags:c,title:l="",titleAttributes:f,prioritizeSeoTags:h}=t;let{linkTags:a,metaTags:p,scriptTags:_}=t,N={toComponent:()=>{},toString:()=>""};return h&&({priorityMethods:N,linkTags:a,metaTags:p,scriptTags:_}=Wu(t)),{priority:N,base:ks("base",e,r),bodyAttributes:ks("bodyAttributes",s,r),htmlAttributes:ks("htmlAttributes",o,r),link:ks("link",a,r),meta:ks("meta",p,r),noscript:ks("noscript",i,r),script:ks("script",_,r),style:ks("style",c,r),title:ks("title",{title:l,titleAttributes:f},r)}},Ai=Gu,Gr=[],yl=!!(typeof window<"u"&&window.document&&window.document.createElement),Ii=class{constructor(t,e){Cs(this,"instances",[]);Cs(this,"canUseDOM",yl);Cs(this,"context");Cs(this,"value",{setHelmet:t=>{this.context.helmet=t},helmetInstances:{get:()=>this.canUseDOM?Gr:this.instances,add:t=>{(this.canUseDOM?Gr:this.instances).push(t)},remove:t=>{const e=(this.canUseDOM?Gr:this.instances).indexOf(t);(this.canUseDOM?Gr:this.instances).splice(e,1)}}});this.context=t,this.canUseDOM=e||!1,e||(t.helmet=Ai({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},Yu={},_l=ct.createContext(Yu),jn,oa=(jn=class extends d.Component{constructor(s){super(s);Cs(this,"helmetData");this.helmetData=new Ii(this.props.context||{},jn.canUseDOM)}render(){return ct.createElement(_l.Provider,{value:this.helmetData.value},this.props.children)}},Cs(jn,"canUseDOM",yl),jn),Mn=(t,e)=>{const s=document.head||document.querySelector("head"),r=s.querySelectorAll(`${t}[${Os}]`),o=[].slice.call(r),i=[];let c;return e&&e.length&&e.forEach(l=>{const f=document.createElement(t);for(const h in l)if(Object.prototype.hasOwnProperty.call(l,h))if(h==="innerHTML")f.innerHTML=l.innerHTML;else if(h==="cssText")f.styleSheet?f.styleSheet.cssText=l.cssText:f.appendChild(document.createTextNode(l.cssText));else{const a=h,p=typeof l[a]>"u"?"":l[a];f.setAttribute(h,p)}f.setAttribute(Os,"true"),o.some((h,a)=>(c=a,f.isEqualNode(h)))?o.splice(c,1):i.push(f)}),o.forEach(l=>{var f;return(f=l.parentNode)==null?void 0:f.removeChild(l)}),i.forEach(l=>s.appendChild(l)),{oldTags:o,newTags:i}},$i=(t,e)=>{const s=document.getElementsByTagName(t)[0];if(!s)return;const r=s.getAttribute(Os),o=r?r.split(","):[],i=[...o],c=Object.keys(e);for(const l of c){const f=e[l]||"";s.getAttribute(l)!==f&&s.setAttribute(l,f),o.indexOf(l)===-1&&o.push(l);const h=i.indexOf(l);h!==-1&&i.splice(h,1)}for(let l=i.length-1;l>=0;l-=1)s.removeAttribute(i[l]);o.length===i.length?s.removeAttribute(Os):s.getAttribute(Os)!==c.join(",")&&s.setAttribute(Os,c.join(","))},Ku=(t,e)=>{typeof t<"u"&&document.title!==t&&(document.title=pl(t)),$i("title",e)},qa=(t,e)=>{const{baseTag:s,bodyAttributes:r,htmlAttributes:o,linkTags:i,metaTags:c,noscriptTags:l,onChangeClientState:f,scriptTags:h,styleTags:a,title:p,titleAttributes:_}=t;$i("body",r),$i("html",o),Ku(p,_);const N={baseTag:Mn("base",s),linkTags:Mn("link",i),metaTags:Mn("meta",c),noscriptTags:Mn("noscript",l),scriptTags:Mn("script",h),styleTags:Mn("style",a)},g={},C={};Object.keys(N).forEach(A=>{const{newTags:P,oldTags:R}=N[A];P.length&&(g[A]=P),R.length&&(C[A]=N[A].oldTags)}),e&&e(),f(t,g,C)},pr=null,Ju=t=>{pr&&cancelAnimationFrame(pr),t.defer?pr=requestAnimationFrame(()=>{qa(t,()=>{pr=null})}):(qa(t),pr=null)},Qu=Ju,za=class extends d.Component{constructor(){super(...arguments);Cs(this,"rendered",!1)}shouldComponentUpdate(e){return!Pu(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:s}=this.props.context;let r=null;const o=Du(e.get().map(i=>{const c={...i.props};return delete c.context,c}));oa.canUseDOM?Qu(o):Ai&&(r=Ai(o)),s(r)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},Ti,Xu=(Ti=class extends d.Component{shouldComponentUpdate(t){return!Tu(Ua(this.props,"helmetData"),Ua(t,"helmetData"))}mapNestedChildrenToProps(t,e){if(!e)return null;switch(t.type){case"script":case"noscript":return{innerHTML:e};case"style":return{cssText:e};default:throw new Error(`<${t.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(t,e,s,r){return{...e,[t.type]:[...e[t.type]||[],{...s,...this.mapNestedChildrenToProps(t,r)}]}}mapObjectTypeChildren(t,e,s,r){switch(t.type){case"title":return{...e,[t.type]:r,titleAttributes:{...s}};case"body":return{...e,bodyAttributes:{...s}};case"html":return{...e,htmlAttributes:{...s}};default:return{...e,[t.type]:{...s}}}}mapArrayTypeChildrenToProps(t,e){let s={...e};return Object.keys(t).forEach(r=>{s={...s,[r]:t[r]}}),s}warnOnInvalidChildren(t,e){return Ba(Da.some(s=>t.type===s),typeof t.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${Da.join(", ")} are allowed. Helmet does not support rendering <${t.type}> elements. Refer to our API for more information.`),Ba(!e||typeof e=="string"||Array.isArray(e)&&!e.some(s=>typeof s!="string"),`Helmet expects a string as a child of <${t.type}>. Did you forget to wrap your children in braces? ( <${t.type}>{\`\`}</${t.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(t,e){let s={};return ct.Children.forEach(t,r=>{if(!r||!r.props)return;const{children:o,...i}=r.props,c=Object.keys(i).reduce((f,h)=>(f[Ru[h]||h]=i[h],f),{});let{type:l}=r;switch(typeof l=="symbol"?l=l.toString():this.warnOnInvalidChildren(r,o),l){case"Symbol(react.fragment)":e=this.mapChildrenToProps(o,e);break;case"link":case"meta":case"noscript":case"script":case"style":s=this.flattenArrayTypeChildren(r,s,c,o);break;default:e=this.mapObjectTypeChildren(r,e,c,o);break}}),this.mapArrayTypeChildrenToProps(s,e)}render(){const{children:t,...e}=this.props;let s={...e},{helmetData:r}=e;if(t&&(s=this.mapChildrenToProps(t,s)),r&&!(r instanceof Ii)){const o=r;r=new Ii(o.context,!0),delete s.helmetData}return r?ct.createElement(za,{...s,context:r.value}):ct.createElement(_l.Consumer,null,o=>ct.createElement(za,{...s,context:o}))}},Cs(Ti,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),Ti),si={},ni={},ri={},Ha;function Zu(){return Ha||(Ha=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=function(){for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];if(typeof window<"u"){var l;typeof window.gtag>"u"&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(l=window).gtag.apply(l,i)}},s=e;t.default=s}(ri)),ri}var oi={},Va;function eh(){return Va||(Va=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var e=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;function s(l){return l.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(f,h,a){return h>0&&h+f.length!==a.length&&f.search(e)>-1&&a.charAt(h-2)!==":"&&(a.charAt(h+f.length)!=="-"||a.charAt(h-1)==="-")&&a.charAt(h-1).search(/[^\s-]/)<0?f.toLowerCase():f.substr(1).search(/[A-Z]|\../)>-1?f:f.charAt(0).toUpperCase()+f.substr(1)})}function r(l){return typeof l=="string"&&l.indexOf("@")!==-1}var o="REDACTED (Potential Email Address)";function i(l){return r(l)?(console.warn("This arg looks like an email address, redacting."),o):l}function c(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=l||"";return f&&(a=s(l)),h&&(a=i(a)),a}}(oi)),oi}var Wa;function th(){return Wa||(Wa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.GA4=void 0;var e=c(Zu()),s=c(eh()),r=["eventCategory","eventAction","eventLabel","eventValue","hitType"],o=["title","location"],i=["page","hitType"];function c($){return $&&$.__esModule?$:{default:$}}function l($,x){if($==null)return{};var z=f($,x),G,Y;if(Object.getOwnPropertySymbols){var oe=Object.getOwnPropertySymbols($);for(Y=0;Y<oe.length;Y++)G=oe[Y],!(x.indexOf(G)>=0)&&Object.prototype.propertyIsEnumerable.call($,G)&&(z[G]=$[G])}return z}function f($,x){if($==null)return{};var z={},G=Object.keys($),Y,oe;for(oe=0;oe<G.length;oe++)Y=G[oe],!(x.indexOf(Y)>=0)&&(z[Y]=$[Y]);return z}function h($){"@babel/helpers - typeof";return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},h($)}function a($){return N($)||_($)||R($)||p()}function p(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _($){if(typeof Symbol<"u"&&$[Symbol.iterator]!=null||$["@@iterator"]!=null)return Array.from($)}function N($){if(Array.isArray($))return j($)}function g($,x){var z=Object.keys($);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols($);x&&(G=G.filter(function(Y){return Object.getOwnPropertyDescriptor($,Y).enumerable})),z.push.apply(z,G)}return z}function C($){for(var x=1;x<arguments.length;x++){var z=arguments[x]!=null?arguments[x]:{};x%2?g(Object(z),!0).forEach(function(G){M($,G,z[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(z)):g(Object(z)).forEach(function(G){Object.defineProperty($,G,Object.getOwnPropertyDescriptor(z,G))})}return $}function A($,x){return F($)||k($,x)||R($,x)||P()}function P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R($,x){if($){if(typeof $=="string")return j($,x);var z=Object.prototype.toString.call($).slice(8,-1);if(z==="Object"&&$.constructor&&(z=$.constructor.name),z==="Map"||z==="Set")return Array.from($);if(z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z))return j($,x)}}function j($,x){(x==null||x>$.length)&&(x=$.length);for(var z=0,G=new Array(x);z<x;z++)G[z]=$[z];return G}function k($,x){var z=$==null?null:typeof Symbol<"u"&&$[Symbol.iterator]||$["@@iterator"];if(z!=null){var G,Y,oe,le,ye=[],K=!0,ae=!1;try{if(oe=(z=z.call($)).next,x!==0)for(;!(K=(G=oe.call(z)).done)&&(ye.push(G.value),ye.length!==x);K=!0);}catch(ue){ae=!0,Y=ue}finally{try{if(!K&&z.return!=null&&(le=z.return(),Object(le)!==le))return}finally{if(ae)throw Y}}return ye}}function F($){if(Array.isArray($))return $}function O($,x){if(!($ instanceof x))throw new TypeError("Cannot call a class as a function")}function L($,x){for(var z=0;z<x.length;z++){var G=x[z];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty($,I(G.key),G)}}function E($,x,z){return x&&L($.prototype,x),Object.defineProperty($,"prototype",{writable:!1}),$}function M($,x,z){return x=I(x),x in $?Object.defineProperty($,x,{value:z,enumerable:!0,configurable:!0,writable:!0}):$[x]=z,$}function I($){var x=v($,"string");return h(x)==="symbol"?x:String(x)}function v($,x){if(h($)!=="object"||$===null)return $;var z=$[Symbol.toPrimitive];if(z!==void 0){var G=z.call($,x);if(h(G)!=="object")return G;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)($)}var b=function(){function $(){var x=this;O(this,$),M(this,"reset",function(){x.isInitialized=!1,x._testMode=!1,x._currentMeasurementId,x._hasLoadedGA=!1,x._isQueuing=!1,x._queueGtag=[]}),M(this,"_gtag",function(){for(var z=arguments.length,G=new Array(z),Y=0;Y<z;Y++)G[Y]=arguments[Y];x._testMode||x._isQueuing?x._queueGtag.push(G):e.default.apply(void 0,G)}),M(this,"_loadGA",function(z,G){var Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"https://www.googletagmanager.com/gtag/js";if(!(typeof window>"u"||typeof document>"u")&&!x._hasLoadedGA){var oe=document.createElement("script");oe.async=!0,oe.src="".concat(Y,"?id=").concat(z),G&&oe.setAttribute("nonce",G),document.body.appendChild(oe),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},x._hasLoadedGA=!0}}),M(this,"_toGtagOptions",function(z){if(z){var G={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"},Y=Object.entries(z).reduce(function(oe,le){var ye=A(le,2),K=ye[0],ae=ye[1];return G[K]?oe[G[K]]=ae:oe[K]=ae,oe},{});return Y}}),M(this,"initialize",function(z){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!z)throw new Error("Require GA_MEASUREMENT_ID");var Y=typeof z=="string"?[{trackingId:z}]:z;x._currentMeasurementId=Y[0].trackingId;var oe=G.gaOptions,le=G.gtagOptions,ye=G.nonce,K=G.testMode,ae=K===void 0?!1:K,ue=G.gtagUrl;if(x._testMode=ae,ae||x._loadGA(x._currentMeasurementId,ye,ue),x.isInitialized||(x._gtag("js",new Date),Y.forEach(function(ce){var de=C(C(C({},x._toGtagOptions(C(C({},oe),ce.gaOptions))),le),ce.gtagOptions);Object.keys(de).length?x._gtag("config",ce.trackingId,de):x._gtag("config",ce.trackingId)})),x.isInitialized=!0,!ae){var we=a(x._queueGtag);for(x._queueGtag=[],x._isQueuing=!1;we.length;){var Pe=we.shift();x._gtag.apply(x,a(Pe)),Pe[0]==="get"&&(x._isQueuing=!0)}}}),M(this,"set",function(z){if(!z){console.warn("`fieldsObject` is required in .set()");return}if(h(z)!=="object"){console.warn("Expected `fieldsObject` arg to be an Object");return}Object.keys(z).length===0&&console.warn("empty `fieldsObject` given to .set()"),x._gaCommand("set",z)}),M(this,"_gaCommandSendEvent",function(z,G,Y,oe,le){x._gtag("event",G,C(C({event_category:z,event_label:Y,value:oe},le&&{non_interaction:le.nonInteraction}),x._toGtagOptions(le)))}),M(this,"_gaCommandSendEventParameters",function(){for(var z=arguments.length,G=new Array(z),Y=0;Y<z;Y++)G[Y]=arguments[Y];if(typeof G[0]=="string")x._gaCommandSendEvent.apply(x,a(G.slice(1)));else{var oe=G[0],le=oe.eventCategory,ye=oe.eventAction,K=oe.eventLabel,ae=oe.eventValue;oe.hitType;var ue=l(oe,r);x._gaCommandSendEvent(le,ye,K,ae,ue)}}),M(this,"_gaCommandSendTiming",function(z,G,Y,oe){x._gtag("event","timing_complete",{name:G,value:Y,event_category:z,event_label:oe})}),M(this,"_gaCommandSendPageview",function(z,G){if(G&&Object.keys(G).length){var Y=x._toGtagOptions(G),oe=Y.title,le=Y.location,ye=l(Y,o);x._gtag("event","page_view",C(C(C(C({},z&&{page_path:z}),oe&&{page_title:oe}),le&&{page_location:le}),ye))}else z?x._gtag("event","page_view",{page_path:z}):x._gtag("event","page_view")}),M(this,"_gaCommandSendPageviewParameters",function(){for(var z=arguments.length,G=new Array(z),Y=0;Y<z;Y++)G[Y]=arguments[Y];if(typeof G[0]=="string")x._gaCommandSendPageview.apply(x,a(G.slice(1)));else{var oe=G[0],le=oe.page;oe.hitType;var ye=l(oe,i);x._gaCommandSendPageview(le,ye)}}),M(this,"_gaCommandSend",function(){for(var z=arguments.length,G=new Array(z),Y=0;Y<z;Y++)G[Y]=arguments[Y];var oe=typeof G[0]=="string"?G[0]:G[0].hitType;switch(oe){case"event":x._gaCommandSendEventParameters.apply(x,G);break;case"pageview":x._gaCommandSendPageviewParameters.apply(x,G);break;case"timing":x._gaCommandSendTiming.apply(x,a(G.slice(1)));break;case"screenview":case"transaction":case"item":case"social":case"exception":console.warn("Unsupported send command: ".concat(oe));break;default:console.warn("Send command doesn't exist: ".concat(oe))}}),M(this,"_gaCommandSet",function(){for(var z=arguments.length,G=new Array(z),Y=0;Y<z;Y++)G[Y]=arguments[Y];typeof G[0]=="string"&&(G[0]=M({},G[0],G[1])),x._gtag("set",x._toGtagOptions(G[0]))}),M(this,"_gaCommand",function(z){for(var G=arguments.length,Y=new Array(G>1?G-1:0),oe=1;oe<G;oe++)Y[oe-1]=arguments[oe];switch(z){case"send":x._gaCommandSend.apply(x,Y);break;case"set":x._gaCommandSet.apply(x,Y);break;default:console.warn("Command doesn't exist: ".concat(z))}}),M(this,"ga",function(){for(var z=arguments.length,G=new Array(z),Y=0;Y<z;Y++)G[Y]=arguments[Y];if(typeof G[0]=="string")x._gaCommand.apply(x,G);else{var oe=G[0];x._gtag("get",x._currentMeasurementId,"client_id",function(le){x._isQueuing=!1;var ye=x._queueGtag;for(oe({get:function(ue){return ue==="clientId"?le:ue==="trackingId"?x._currentMeasurementId:ue==="apiVersion"?"1":void 0}});ye.length;){var K=ye.shift();x._gtag.apply(x,a(K))}}),x._isQueuing=!0}return x.ga}),M(this,"event",function(z,G){if(typeof z=="string")x._gtag("event",z,x._toGtagOptions(G));else{var Y=z.action,oe=z.category,le=z.label,ye=z.value,K=z.nonInteraction,ae=z.transport;if(!oe||!Y){console.warn("args.category AND args.action are required in event()");return}var ue={hitType:"event",eventCategory:(0,s.default)(oe),eventAction:(0,s.default)(Y)};le&&(ue.eventLabel=(0,s.default)(le)),typeof ye<"u"&&(typeof ye!="number"?console.warn("Expected `args.value` arg to be a Number."):ue.eventValue=ye),typeof K<"u"&&(typeof K!="boolean"?console.warn("`args.nonInteraction` must be a boolean."):ue.nonInteraction=K),typeof ae<"u"&&(typeof ae!="string"?console.warn("`args.transport` must be a string."):(["beacon","xhr","image"].indexOf(ae)===-1&&console.warn("`args.transport` must be either one of these values: `beacon`, `xhr` or `image`"),ue.transport=ae)),x._gaCommand("send",ue)}}),M(this,"send",function(z){x._gaCommand("send",z)}),this.reset()}return E($,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}}]),$}();t.GA4=b;var B=new b;t.default=B}(ni)),ni}var Ga;function sh(){return Ga||(Ga=1,function(t){function e(l){"@babel/helpers - typeof";return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},e(l)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ReactGAImplementation=void 0;var s=o(th());function r(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,h=new WeakMap;return(r=function(p){return p?h:f})(l)}function o(l,f){if(l&&l.__esModule)return l;if(l===null||e(l)!=="object"&&typeof l!="function")return{default:l};var h=r(f);if(h&&h.has(l))return h.get(l);var a={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var N=p?Object.getOwnPropertyDescriptor(l,_):null;N&&(N.get||N.set)?Object.defineProperty(a,_,N):a[_]=l[_]}return a.default=l,h&&h.set(l,a),a}var i=s.GA4;t.ReactGAImplementation=i;var c=s.default;t.default=c}(si)),si}var nh=sh();const vl=gn(nh),Cn={BASE_URL:"/api",TIMEOUT:15e3,RETRIES:{MAX_QUEUE_RETRIES:3,RETRY_DELAY_MS:1e3},HEALTH_CHECK:{TIMEOUT:3e3,CONNECTION_TEST_TIMEOUT:5e3,INTERVAL:3e5},ENDPOINTS:{AUTH:{LOGIN:"/auth/login",REGISTER:"/auth/register",VERIFY:"/auth/verify-email",ME:"/auth/me",REFRESH:"/auth/refresh-token",TEST:"/auth/test-connection"},USERS:{PROFILE:"/users/profile",AVATAR:"/users/avatar",SEARCH:"/users/search",SUGGEST:"/users/suggest"},MESSAGES:{BASE:"/messages",CONVERSATIONS:"/messages/conversations"},NOTIFICATIONS:{BASE:"/notifications",READ:"/notifications/read",READ_ALL:"/notifications/read-all"},SUBSCRIPTIONS:{STATUS:"/subscription/status",UPGRADE:"/subscription/upgrade",CANCEL:"/subscription/cancel"},STORIES:{BASE:"/stories",USER:t=>`/stories/user/${t}`}}},tn={SIZE:Number.parseInt("100",10),TTL:{DEFAULT:Number.parseInt("60000",10),MESSAGES:1e4,USER_PROFILE:12e4,STORIES:6e4,CONVERSATIONS:6e4}};var hl;const xt={RECONNECT:{MAX_ATTEMPTS:5,DELAY:5e3,DELAY_MAX:3e4},CONNECTION:{TIMEOUT:3e4,HEARTBEAT_INTERVAL:3e4,HEARTBEAT_TIMEOUT:6e4,MONITOR_INTERVAL:45e3,RECONNECT_DELAY_MIN:1e3,RECONNECT_DELAY_MAX:3e3,ONLINE_RECONNECT_DELAY:2e3},TRANSPORT:{DEFAULT:["polling","websocket"],FALLBACK:["polling"]},URLS:{DEV:"http://localhost:5000",PROD:((hl=window==null?void 0:window.location)==null?void 0:hl.origin)||"https://flirtss.com"},EVENTS:{MESSAGE_RECEIVED:"messageReceived",MESSAGE_SENT:"messageSent",MESSAGE_ERROR:"messageError",TYPING:"userTyping",INCOMING_CALL:"incomingCall",CALL_ANSWERED:"callAnswered",CALL_INITIATED:"callInitiated",CALL_ERROR:"callError",VIDEO_SIGNAL:"videoSignal",VIDEO_HANGUP:"videoHangup",VIDEO_ERROR:"videoError",VIDEO_MEDIA_CONTROL:"videoMediaControl",USER_ONLINE:"userOnline",USER_OFFLINE:"userOffline",NOTIFICATION:"notification",NEW_LIKE:"newLike",NEW_COMMENT:"newComment",NEW_STORY:"newStory",NEW_MESSAGE:"newMessage",PHOTO_PERMISSION_REQUEST:"photoPermissionRequestReceived",PHOTO_PERMISSION_RESPONSE:"photoPermissionResponseReceived",CONNECT:"connect",DISCONNECT:"disconnect",CONNECT_ERROR:"connect_error",RECONNECT:"reconnect",RECONNECT_ATTEMPT:"reconnect_attempt",RECONNECT_ERROR:"reconnect_error",RECONNECT_FAILED:"reconnect_failed",WELCOME:"welcome",PONG:"pong",ERROR:"error",AUTH_ERROR:"auth_error",SOCKET_CONNECTED:"socketConnected",SOCKET_DISCONNECTED:"socketDisconnected",SOCKET_RECONNECTED:"socketReconnected",SOCKET_CONNECTION_FAILED:"socketConnectionFailed",SOCKET_RECONNECT_FAILED:"socketReconnectFailed",NOTIFICATION_SOCKET_RECONNECTED:"notificationSocketReconnected"},NOTIFICATION:{SYNC_CHANNEL_NAME:"notification_sync",SYNC_EVENT_TYPES:["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall","newStory"],SYNC_ACTIONS:{NEW_NOTIFICATION:"NEW_NOTIFICATION",MARK_READ:"MARK_READ",MARK_ALL_READ:"MARK_ALL_READ"}},TIMEOUT:{ACK:2e3,INIT:5e3,PERMISSION_REQUEST:1e4}},br={MAX_SIZE:{AVATAR:5*1024*1024},ALLOWED_TYPES:{IMAGES:["image/jpeg","image/png","image/gif","image/webp"],VIDEOS:["video/mp4","video/webm","video/quicktime"],AUDIO:["audio/mpeg","audio/wav","audio/ogg"],DOCUMENTS:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}},rn={DEBOUNCE:{TYPING:1e3,SMOOTH_SCROLL:100},POLL:{NOTIFICATIONS:6e4},FETCH:{MESSAGES:8e3},MESSAGE:{DEDUPLICATION:1500,PENDING_EXPIRY:6e5},UI:{LOADING_TIMEOUT:1e4,INPUT_FOCUS_DELAY:300,UPLOAD_COMPLETE_DELAY:500}},ss={FREE:"FREE",PREMIUM:"PREMIUM",FEMALE:"FEMALE",COUPLE:"COUPLE"},kn={ANIMATIONS:{DIRECTION_CHANGE_MS:50,CHAT_OPEN_DELAY_MS:50},TOAST:{AUTO_CLOSE_MS:3e3,MAX_TOASTS:5,POSITION:"top-right"},ANALYTICS:{GA4_ID:"G-Y9EQ02574T"},EMOJI:{COMMON:["😊","😂","😍","❤️","👍","🙌","🔥","✨","🎉","🤔","😉","🥰"]}};var Yr={exports:{}},Kr={exports:{}},Ya;function wl(){return Ya||(Ya=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;function s(o){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},s(o)}function r(o){var i=typeof o=="string"||o instanceof String;if(!i){var c=s(o);throw o===null?c="null":c==="object"&&(c=o.constructor.name),new TypeError("Expected a string but received a ".concat(c))}}t.exports=e.default,t.exports.default=e.default}(Kr,Kr.exports)),Kr.exports}var Jr={exports:{}},Ka;function rh(){return Ka||(Ka=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var s=r(wl());function r(c){return c&&c.__esModule?c:{default:c}}var o=/^(0x|0h)?[0-9A-F]+$/i;function i(c){return(0,s.default)(c),o.test(c)}t.exports=e.default,t.exports.default=e.default}(Jr,Jr.exports)),Jr.exports}var Ja;function oh(){return Ja||(Ja=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var s=o(wl()),r=o(rh());function o(c){return c&&c.__esModule?c:{default:c}}function i(c){return(0,s.default)(c),(0,r.default)(c)&&c.length===24}t.exports=e.default,t.exports.default=e.default}(Yr,Yr.exports)),Yr.exports}var ih=oh();const xn=gn(ih);function bl(t,e){return function(){return t.apply(e,arguments)}}const{toString:ah}=Object.prototype,{getPrototypeOf:ia}=Object,{iterator:No,toStringTag:xl}=Symbol,jo=(t=>e=>{const s=ah.call(e);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),Ms=t=>(t=t.toLowerCase(),e=>jo(e)===t),To=t=>e=>typeof e===t,{isArray:Qn}=Array,Er=To("undefined");function ch(t){return t!==null&&!Er(t)&&t.constructor!==null&&!Er(t.constructor)&&ps(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Sl=Ms("ArrayBuffer");function lh(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Sl(t.buffer),e}const dh=To("string"),ps=To("function"),Cl=To("number"),Eo=t=>t!==null&&typeof t=="object",uh=t=>t===!0||t===!1,io=t=>{if(jo(t)!=="object")return!1;const e=ia(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(xl in t)&&!(No in t)},hh=Ms("Date"),fh=Ms("File"),ph=Ms("Blob"),mh=Ms("FileList"),gh=t=>Eo(t)&&ps(t.pipe),yh=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ps(t.append)&&((e=jo(t))==="formdata"||e==="object"&&ps(t.toString)&&t.toString()==="[object FormData]"))},_h=Ms("URLSearchParams"),[vh,wh,bh,xh]=["ReadableStream","Request","Response","Headers"].map(Ms),Sh=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Or(t,e,{allOwnKeys:s=!1}={}){if(t===null||typeof t>"u")return;let r,o;if(typeof t!="object"&&(t=[t]),Qn(t))for(r=0,o=t.length;r<o;r++)e.call(null,t[r],r,t);else{const i=s?Object.getOwnPropertyNames(t):Object.keys(t),c=i.length;let l;for(r=0;r<c;r++)l=i[r],e.call(null,t[l],l,t)}}function kl(t,e){e=e.toLowerCase();const s=Object.keys(t);let r=s.length,o;for(;r-- >0;)if(o=s[r],e===o.toLowerCase())return o;return null}const Nn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,Nl=t=>!Er(t)&&t!==Nn;function Pi(){const{caseless:t}=Nl(this)&&this||{},e={},s=(r,o)=>{const i=t&&kl(e,o)||o;io(e[i])&&io(r)?e[i]=Pi(e[i],r):io(r)?e[i]=Pi({},r):Qn(r)?e[i]=r.slice():e[i]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&Or(arguments[r],s);return e}const Ch=(t,e,s,{allOwnKeys:r}={})=>(Or(e,(o,i)=>{s&&ps(o)?t[i]=bl(o,s):t[i]=o},{allOwnKeys:r}),t),kh=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Nh=(t,e,s,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),s&&Object.assign(t.prototype,s)},jh=(t,e,s,r)=>{let o,i,c;const l={};if(e=e||{},t==null)return e;do{for(o=Object.getOwnPropertyNames(t),i=o.length;i-- >0;)c=o[i],(!r||r(c,t,e))&&!l[c]&&(e[c]=t[c],l[c]=!0);t=s!==!1&&ia(t)}while(t&&(!s||s(t,e))&&t!==Object.prototype);return e},Th=(t,e,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=e.length;const r=t.indexOf(e,s);return r!==-1&&r===s},Eh=t=>{if(!t)return null;if(Qn(t))return t;let e=t.length;if(!Cl(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=t[e];return s},Ah=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&ia(Uint8Array)),Ih=(t,e)=>{const r=(t&&t[No]).call(t);let o;for(;(o=r.next())&&!o.done;){const i=o.value;e.call(t,i[0],i[1])}},$h=(t,e)=>{let s;const r=[];for(;(s=t.exec(e))!==null;)r.push(s);return r},Ph=Ms("HTMLFormElement"),Rh=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,r,o){return r.toUpperCase()+o}),Qa=(({hasOwnProperty:t})=>(e,s)=>t.call(e,s))(Object.prototype),Lh=Ms("RegExp"),jl=(t,e)=>{const s=Object.getOwnPropertyDescriptors(t),r={};Or(s,(o,i)=>{let c;(c=e(o,i,t))!==!1&&(r[i]=c||o)}),Object.defineProperties(t,r)},Oh=t=>{jl(t,(e,s)=>{if(ps(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const r=t[s];if(ps(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Mh=(t,e)=>{const s={},r=o=>{o.forEach(i=>{s[i]=!0})};return Qn(t)?r(t):r(String(t).split(e)),s},Bh=()=>{},Fh=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Dh(t){return!!(t&&ps(t.append)&&t[xl]==="FormData"&&t[No])}const Uh=t=>{const e=new Array(10),s=(r,o)=>{if(Eo(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[o]=r;const i=Qn(r)?[]:{};return Or(r,(c,l)=>{const f=s(c,o+1);!Er(f)&&(i[l]=f)}),e[o]=void 0,i}}return r};return s(t,0)},qh=Ms("AsyncFunction"),zh=t=>t&&(Eo(t)||ps(t))&&ps(t.then)&&ps(t.catch),Tl=((t,e)=>t?setImmediate:e?((s,r)=>(Nn.addEventListener("message",({source:o,data:i})=>{o===Nn&&i===s&&r.length&&r.shift()()},!1),o=>{r.push(o),Nn.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",ps(Nn.postMessage)),Hh=typeof queueMicrotask<"u"?queueMicrotask.bind(Nn):typeof Ia<"u"&&Ia.nextTick||Tl,Vh=t=>t!=null&&ps(t[No]),ie={isArray:Qn,isArrayBuffer:Sl,isBuffer:ch,isFormData:yh,isArrayBufferView:lh,isString:dh,isNumber:Cl,isBoolean:uh,isObject:Eo,isPlainObject:io,isReadableStream:vh,isRequest:wh,isResponse:bh,isHeaders:xh,isUndefined:Er,isDate:hh,isFile:fh,isBlob:ph,isRegExp:Lh,isFunction:ps,isStream:gh,isURLSearchParams:_h,isTypedArray:Ah,isFileList:mh,forEach:Or,merge:Pi,extend:Ch,trim:Sh,stripBOM:kh,inherits:Nh,toFlatObject:jh,kindOf:jo,kindOfTest:Ms,endsWith:Th,toArray:Eh,forEachEntry:Ih,matchAll:$h,isHTMLForm:Ph,hasOwnProperty:Qa,hasOwnProp:Qa,reduceDescriptors:jl,freezeMethods:Oh,toObjectSet:Mh,toCamelCase:Rh,noop:Bh,toFiniteNumber:Fh,findKey:kl,global:Nn,isContextDefined:Nl,isSpecCompliantForm:Dh,toJSONObject:Uh,isAsyncFn:qh,isThenable:zh,setImmediate:Tl,asap:Hh,isIterable:Vh};var El={},Ao={};Ao.byteLength=Yh;Ao.toByteArray=Jh;Ao.fromByteArray=Zh;var qs=[],Ns=[],Wh=typeof Uint8Array<"u"?Uint8Array:Array,ii="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Bn=0,Gh=ii.length;Bn<Gh;++Bn)qs[Bn]=ii[Bn],Ns[ii.charCodeAt(Bn)]=Bn;Ns[45]=62;Ns[95]=63;function Al(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=t.indexOf("=");s===-1&&(s=e);var r=s===e?0:4-s%4;return[s,r]}function Yh(t){var e=Al(t),s=e[0],r=e[1];return(s+r)*3/4-r}function Kh(t,e,s){return(e+s)*3/4-s}function Jh(t){var e,s=Al(t),r=s[0],o=s[1],i=new Wh(Kh(t,r,o)),c=0,l=o>0?r-4:r,f;for(f=0;f<l;f+=4)e=Ns[t.charCodeAt(f)]<<18|Ns[t.charCodeAt(f+1)]<<12|Ns[t.charCodeAt(f+2)]<<6|Ns[t.charCodeAt(f+3)],i[c++]=e>>16&255,i[c++]=e>>8&255,i[c++]=e&255;return o===2&&(e=Ns[t.charCodeAt(f)]<<2|Ns[t.charCodeAt(f+1)]>>4,i[c++]=e&255),o===1&&(e=Ns[t.charCodeAt(f)]<<10|Ns[t.charCodeAt(f+1)]<<4|Ns[t.charCodeAt(f+2)]>>2,i[c++]=e>>8&255,i[c++]=e&255),i}function Qh(t){return qs[t>>18&63]+qs[t>>12&63]+qs[t>>6&63]+qs[t&63]}function Xh(t,e,s){for(var r,o=[],i=e;i<s;i+=3)r=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(t[i+2]&255),o.push(Qh(r));return o.join("")}function Zh(t){for(var e,s=t.length,r=s%3,o=[],i=16383,c=0,l=s-r;c<l;c+=i)o.push(Xh(t,c,c+i>l?l:c+i));return r===1?(e=t[s-1],o.push(qs[e>>2]+qs[e<<4&63]+"==")):r===2&&(e=(t[s-2]<<8)+t[s-1],o.push(qs[e>>10]+qs[e>>4&63]+qs[e<<2&63]+"=")),o.join("")}var aa={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */aa.read=function(t,e,s,r,o){var i,c,l=o*8-r-1,f=(1<<l)-1,h=f>>1,a=-7,p=s?o-1:0,_=s?-1:1,N=t[e+p];for(p+=_,i=N&(1<<-a)-1,N>>=-a,a+=l;a>0;i=i*256+t[e+p],p+=_,a-=8);for(c=i&(1<<-a)-1,i>>=-a,a+=r;a>0;c=c*256+t[e+p],p+=_,a-=8);if(i===0)i=1-h;else{if(i===f)return c?NaN:(N?-1:1)*(1/0);c=c+Math.pow(2,r),i=i-h}return(N?-1:1)*c*Math.pow(2,i-r)};aa.write=function(t,e,s,r,o,i){var c,l,f,h=i*8-o-1,a=(1<<h)-1,p=a>>1,_=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=r?0:i-1,g=r?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,c=a):(c=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-c))<1&&(c--,f*=2),c+p>=1?e+=_/f:e+=_*Math.pow(2,1-p),e*f>=2&&(c++,f/=2),c+p>=a?(l=0,c=a):c+p>=1?(l=(e*f-1)*Math.pow(2,o),c=c+p):(l=e*Math.pow(2,p-1)*Math.pow(2,o),c=0));o>=8;t[s+N]=l&255,N+=g,l/=256,o-=8);for(c=c<<o|l,h+=o;h>0;t[s+N]=c&255,N+=g,c/=256,h-=8);t[s+N-g]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Ao,s=aa,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=F,t.INSPECT_MAX_BYTES=50;const o=2147483647;t.kMaxLength=o;const{Uint8Array:i,ArrayBuffer:c,SharedArrayBuffer:l}=globalThis;a.TYPED_ARRAY_SUPPORT=f(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const y=new i(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,i.prototype),Object.setPrototypeOf(y,u),y.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function h(y){if(y>o)throw new RangeError('The value "'+y+'" is invalid for option "size"');const u=new i(y);return Object.setPrototypeOf(u,a.prototype),u}function a(y,u,m){if(typeof y=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(y)}return p(y,u,m)}a.poolSize=8192;function p(y,u,m){if(typeof y=="string")return C(y,u);if(c.isView(y))return P(y);if(y==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof y);if(fe(y,c)||y&&fe(y.buffer,c)||typeof l<"u"&&(fe(y,l)||y&&fe(y.buffer,l)))return R(y,u,m);if(typeof y=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const S=y.valueOf&&y.valueOf();if(S!=null&&S!==y)return a.from(S,u,m);const q=j(y);if(q)return q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof y[Symbol.toPrimitive]=="function")return a.from(y[Symbol.toPrimitive]("string"),u,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof y)}a.from=function(y,u,m){return p(y,u,m)},Object.setPrototypeOf(a.prototype,i.prototype),Object.setPrototypeOf(a,i);function _(y){if(typeof y!="number")throw new TypeError('"size" argument must be of type number');if(y<0)throw new RangeError('The value "'+y+'" is invalid for option "size"')}function N(y,u,m){return _(y),y<=0?h(y):u!==void 0?typeof m=="string"?h(y).fill(u,m):h(y).fill(u):h(y)}a.alloc=function(y,u,m){return N(y,u,m)};function g(y){return _(y),h(y<0?0:k(y)|0)}a.allocUnsafe=function(y){return g(y)},a.allocUnsafeSlow=function(y){return g(y)};function C(y,u){if((typeof u!="string"||u==="")&&(u="utf8"),!a.isEncoding(u))throw new TypeError("Unknown encoding: "+u);const m=O(y,u)|0;let S=h(m);const q=S.write(y,u);return q!==m&&(S=S.slice(0,q)),S}function A(y){const u=y.length<0?0:k(y.length)|0,m=h(u);for(let S=0;S<u;S+=1)m[S]=y[S]&255;return m}function P(y){if(fe(y,i)){const u=new i(y);return R(u.buffer,u.byteOffset,u.byteLength)}return A(y)}function R(y,u,m){if(u<0||y.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(y.byteLength<u+(m||0))throw new RangeError('"length" is outside of buffer bounds');let S;return u===void 0&&m===void 0?S=new i(y):m===void 0?S=new i(y,u):S=new i(y,u,m),Object.setPrototypeOf(S,a.prototype),S}function j(y){if(a.isBuffer(y)){const u=k(y.length)|0,m=h(u);return m.length===0||y.copy(m,0,0,u),m}if(y.length!==void 0)return typeof y.length!="number"||Re(y.length)?h(0):A(y);if(y.type==="Buffer"&&Array.isArray(y.data))return A(y.data)}function k(y){if(y>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return y|0}function F(y){return+y!=y&&(y=0),a.alloc(+y)}a.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==a.prototype},a.compare=function(u,m){if(fe(u,i)&&(u=a.from(u,u.offset,u.byteLength)),fe(m,i)&&(m=a.from(m,m.offset,m.byteLength)),!a.isBuffer(u)||!a.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===m)return 0;let S=u.length,q=m.length;for(let J=0,Z=Math.min(S,q);J<Z;++J)if(u[J]!==m[J]){S=u[J],q=m[J];break}return S<q?-1:q<S?1:0},a.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(u,m){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return a.alloc(0);let S;if(m===void 0)for(m=0,S=0;S<u.length;++S)m+=u[S].length;const q=a.allocUnsafe(m);let J=0;for(S=0;S<u.length;++S){let Z=u[S];if(fe(Z,i))J+Z.length>q.length?(a.isBuffer(Z)||(Z=a.from(Z)),Z.copy(q,J)):i.prototype.set.call(q,Z,J);else if(a.isBuffer(Z))Z.copy(q,J);else throw new TypeError('"list" argument must be an Array of Buffers');J+=Z.length}return q};function O(y,u){if(a.isBuffer(y))return y.length;if(c.isView(y)||fe(y,c))return y.byteLength;if(typeof y!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof y);const m=y.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&m===0)return 0;let q=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return Fe(y).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return D(y).length;default:if(q)return S?-1:Fe(y).length;u=(""+u).toLowerCase(),q=!0}}a.byteLength=O;function L(y,u,m){let S=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,u>>>=0,m<=u))return"";for(y||(y="utf8");;)switch(y){case"hex":return K(this,u,m);case"utf8":case"utf-8":return G(this,u,m);case"ascii":return le(this,u,m);case"latin1":case"binary":return ye(this,u,m);case"base64":return z(this,u,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ae(this,u,m);default:if(S)throw new TypeError("Unknown encoding: "+y);y=(y+"").toLowerCase(),S=!0}}a.prototype._isBuffer=!0;function E(y,u,m){const S=y[u];y[u]=y[m],y[m]=S}a.prototype.swap16=function(){const u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let m=0;m<u;m+=2)E(this,m,m+1);return this},a.prototype.swap32=function(){const u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let m=0;m<u;m+=4)E(this,m,m+3),E(this,m+1,m+2);return this},a.prototype.swap64=function(){const u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let m=0;m<u;m+=8)E(this,m,m+7),E(this,m+1,m+6),E(this,m+2,m+5),E(this,m+3,m+4);return this},a.prototype.toString=function(){const u=this.length;return u===0?"":arguments.length===0?G(this,0,u):L.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(u){if(!a.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:a.compare(this,u)===0},a.prototype.inspect=function(){let u="";const m=t.INSPECT_MAX_BYTES;return u=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(u+=" ... "),"<Buffer "+u+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(u,m,S,q,J){if(fe(u,i)&&(u=a.from(u,u.offset,u.byteLength)),!a.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(m===void 0&&(m=0),S===void 0&&(S=u?u.length:0),q===void 0&&(q=0),J===void 0&&(J=this.length),m<0||S>u.length||q<0||J>this.length)throw new RangeError("out of range index");if(q>=J&&m>=S)return 0;if(q>=J)return-1;if(m>=S)return 1;if(m>>>=0,S>>>=0,q>>>=0,J>>>=0,this===u)return 0;let Z=J-q,Se=S-m;const tt=Math.min(Z,Se),Ye=this.slice(q,J),nt=u.slice(m,S);for(let at=0;at<tt;++at)if(Ye[at]!==nt[at]){Z=Ye[at],Se=nt[at];break}return Z<Se?-1:Se<Z?1:0};function M(y,u,m,S,q){if(y.length===0)return-1;if(typeof m=="string"?(S=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,Re(m)&&(m=q?0:y.length-1),m<0&&(m=y.length+m),m>=y.length){if(q)return-1;m=y.length-1}else if(m<0)if(q)m=0;else return-1;if(typeof u=="string"&&(u=a.from(u,S)),a.isBuffer(u))return u.length===0?-1:I(y,u,m,S,q);if(typeof u=="number")return u=u&255,typeof i.prototype.indexOf=="function"?q?i.prototype.indexOf.call(y,u,m):i.prototype.lastIndexOf.call(y,u,m):I(y,[u],m,S,q);throw new TypeError("val must be string, number or Buffer")}function I(y,u,m,S,q){let J=1,Z=y.length,Se=u.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(y.length<2||u.length<2)return-1;J=2,Z/=2,Se/=2,m/=2}function tt(nt,at){return J===1?nt[at]:nt.readUInt16BE(at*J)}let Ye;if(q){let nt=-1;for(Ye=m;Ye<Z;Ye++)if(tt(y,Ye)===tt(u,nt===-1?0:Ye-nt)){if(nt===-1&&(nt=Ye),Ye-nt+1===Se)return nt*J}else nt!==-1&&(Ye-=Ye-nt),nt=-1}else for(m+Se>Z&&(m=Z-Se),Ye=m;Ye>=0;Ye--){let nt=!0;for(let at=0;at<Se;at++)if(tt(y,Ye+at)!==tt(u,at)){nt=!1;break}if(nt)return Ye}return-1}a.prototype.includes=function(u,m,S){return this.indexOf(u,m,S)!==-1},a.prototype.indexOf=function(u,m,S){return M(this,u,m,S,!0)},a.prototype.lastIndexOf=function(u,m,S){return M(this,u,m,S,!1)};function v(y,u,m,S){m=Number(m)||0;const q=y.length-m;S?(S=Number(S),S>q&&(S=q)):S=q;const J=u.length;S>J/2&&(S=J/2);let Z;for(Z=0;Z<S;++Z){const Se=parseInt(u.substr(Z*2,2),16);if(Re(Se))return Z;y[m+Z]=Se}return Z}function b(y,u,m,S){return re(Fe(u,y.length-m),y,m,S)}function B(y,u,m,S){return re(it(u),y,m,S)}function $(y,u,m,S){return re(D(u),y,m,S)}function x(y,u,m,S){return re(T(u,y.length-m),y,m,S)}a.prototype.write=function(u,m,S,q){if(m===void 0)q="utf8",S=this.length,m=0;else if(S===void 0&&typeof m=="string")q=m,S=this.length,m=0;else if(isFinite(m))m=m>>>0,isFinite(S)?(S=S>>>0,q===void 0&&(q="utf8")):(q=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const J=this.length-m;if((S===void 0||S>J)&&(S=J),u.length>0&&(S<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");let Z=!1;for(;;)switch(q){case"hex":return v(this,u,m,S);case"utf8":case"utf-8":return b(this,u,m,S);case"ascii":case"latin1":case"binary":return B(this,u,m,S);case"base64":return $(this,u,m,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,u,m,S);default:if(Z)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),Z=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function z(y,u,m){return u===0&&m===y.length?e.fromByteArray(y):e.fromByteArray(y.slice(u,m))}function G(y,u,m){m=Math.min(y.length,m);const S=[];let q=u;for(;q<m;){const J=y[q];let Z=null,Se=J>239?4:J>223?3:J>191?2:1;if(q+Se<=m){let tt,Ye,nt,at;switch(Se){case 1:J<128&&(Z=J);break;case 2:tt=y[q+1],(tt&192)===128&&(at=(J&31)<<6|tt&63,at>127&&(Z=at));break;case 3:tt=y[q+1],Ye=y[q+2],(tt&192)===128&&(Ye&192)===128&&(at=(J&15)<<12|(tt&63)<<6|Ye&63,at>2047&&(at<55296||at>57343)&&(Z=at));break;case 4:tt=y[q+1],Ye=y[q+2],nt=y[q+3],(tt&192)===128&&(Ye&192)===128&&(nt&192)===128&&(at=(J&15)<<18|(tt&63)<<12|(Ye&63)<<6|nt&63,at>65535&&at<1114112&&(Z=at))}}Z===null?(Z=65533,Se=1):Z>65535&&(Z-=65536,S.push(Z>>>10&1023|55296),Z=56320|Z&1023),S.push(Z),q+=Se}return oe(S)}const Y=4096;function oe(y){const u=y.length;if(u<=Y)return String.fromCharCode.apply(String,y);let m="",S=0;for(;S<u;)m+=String.fromCharCode.apply(String,y.slice(S,S+=Y));return m}function le(y,u,m){let S="";m=Math.min(y.length,m);for(let q=u;q<m;++q)S+=String.fromCharCode(y[q]&127);return S}function ye(y,u,m){let S="";m=Math.min(y.length,m);for(let q=u;q<m;++q)S+=String.fromCharCode(y[q]);return S}function K(y,u,m){const S=y.length;(!u||u<0)&&(u=0),(!m||m<0||m>S)&&(m=S);let q="";for(let J=u;J<m;++J)q+=ee[y[J]];return q}function ae(y,u,m){const S=y.slice(u,m);let q="";for(let J=0;J<S.length-1;J+=2)q+=String.fromCharCode(S[J]+S[J+1]*256);return q}a.prototype.slice=function(u,m){const S=this.length;u=~~u,m=m===void 0?S:~~m,u<0?(u+=S,u<0&&(u=0)):u>S&&(u=S),m<0?(m+=S,m<0&&(m=0)):m>S&&(m=S),m<u&&(m=u);const q=this.subarray(u,m);return Object.setPrototypeOf(q,a.prototype),q};function ue(y,u,m){if(y%1!==0||y<0)throw new RangeError("offset is not uint");if(y+u>m)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(u,m,S){u=u>>>0,m=m>>>0,S||ue(u,m,this.length);let q=this[u],J=1,Z=0;for(;++Z<m&&(J*=256);)q+=this[u+Z]*J;return q},a.prototype.readUintBE=a.prototype.readUIntBE=function(u,m,S){u=u>>>0,m=m>>>0,S||ue(u,m,this.length);let q=this[u+--m],J=1;for(;m>0&&(J*=256);)q+=this[u+--m]*J;return q},a.prototype.readUint8=a.prototype.readUInt8=function(u,m){return u=u>>>0,m||ue(u,1,this.length),this[u]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(u,m){return u=u>>>0,m||ue(u,2,this.length),this[u]|this[u+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(u,m){return u=u>>>0,m||ue(u,2,this.length),this[u]<<8|this[u+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(u,m){return u=u>>>0,m||ue(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(u,m){return u=u>>>0,m||ue(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},a.prototype.readBigUInt64LE=X(function(u){u=u>>>0,He(u,"offset");const m=this[u],S=this[u+7];(m===void 0||S===void 0)&&wt(u,this.length-8);const q=m+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24,J=this[++u]+this[++u]*2**8+this[++u]*2**16+S*2**24;return BigInt(q)+(BigInt(J)<<BigInt(32))}),a.prototype.readBigUInt64BE=X(function(u){u=u>>>0,He(u,"offset");const m=this[u],S=this[u+7];(m===void 0||S===void 0)&&wt(u,this.length-8);const q=m*2**24+this[++u]*2**16+this[++u]*2**8+this[++u],J=this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+S;return(BigInt(q)<<BigInt(32))+BigInt(J)}),a.prototype.readIntLE=function(u,m,S){u=u>>>0,m=m>>>0,S||ue(u,m,this.length);let q=this[u],J=1,Z=0;for(;++Z<m&&(J*=256);)q+=this[u+Z]*J;return J*=128,q>=J&&(q-=Math.pow(2,8*m)),q},a.prototype.readIntBE=function(u,m,S){u=u>>>0,m=m>>>0,S||ue(u,m,this.length);let q=m,J=1,Z=this[u+--q];for(;q>0&&(J*=256);)Z+=this[u+--q]*J;return J*=128,Z>=J&&(Z-=Math.pow(2,8*m)),Z},a.prototype.readInt8=function(u,m){return u=u>>>0,m||ue(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},a.prototype.readInt16LE=function(u,m){u=u>>>0,m||ue(u,2,this.length);const S=this[u]|this[u+1]<<8;return S&32768?S|4294901760:S},a.prototype.readInt16BE=function(u,m){u=u>>>0,m||ue(u,2,this.length);const S=this[u+1]|this[u]<<8;return S&32768?S|4294901760:S},a.prototype.readInt32LE=function(u,m){return u=u>>>0,m||ue(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},a.prototype.readInt32BE=function(u,m){return u=u>>>0,m||ue(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},a.prototype.readBigInt64LE=X(function(u){u=u>>>0,He(u,"offset");const m=this[u],S=this[u+7];(m===void 0||S===void 0)&&wt(u,this.length-8);const q=this[u+4]+this[u+5]*2**8+this[u+6]*2**16+(S<<24);return(BigInt(q)<<BigInt(32))+BigInt(m+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24)}),a.prototype.readBigInt64BE=X(function(u){u=u>>>0,He(u,"offset");const m=this[u],S=this[u+7];(m===void 0||S===void 0)&&wt(u,this.length-8);const q=(m<<24)+this[++u]*2**16+this[++u]*2**8+this[++u];return(BigInt(q)<<BigInt(32))+BigInt(this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+S)}),a.prototype.readFloatLE=function(u,m){return u=u>>>0,m||ue(u,4,this.length),s.read(this,u,!0,23,4)},a.prototype.readFloatBE=function(u,m){return u=u>>>0,m||ue(u,4,this.length),s.read(this,u,!1,23,4)},a.prototype.readDoubleLE=function(u,m){return u=u>>>0,m||ue(u,8,this.length),s.read(this,u,!0,52,8)},a.prototype.readDoubleBE=function(u,m){return u=u>>>0,m||ue(u,8,this.length),s.read(this,u,!1,52,8)};function we(y,u,m,S,q,J){if(!a.isBuffer(y))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>q||u<J)throw new RangeError('"value" argument is out of bounds');if(m+S>y.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(u,m,S,q){if(u=+u,m=m>>>0,S=S>>>0,!q){const Se=Math.pow(2,8*S)-1;we(this,u,m,S,Se,0)}let J=1,Z=0;for(this[m]=u&255;++Z<S&&(J*=256);)this[m+Z]=u/J&255;return m+S},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(u,m,S,q){if(u=+u,m=m>>>0,S=S>>>0,!q){const Se=Math.pow(2,8*S)-1;we(this,u,m,S,Se,0)}let J=S-1,Z=1;for(this[m+J]=u&255;--J>=0&&(Z*=256);)this[m+J]=u/Z&255;return m+S},a.prototype.writeUint8=a.prototype.writeUInt8=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,1,255,0),this[m]=u&255,m+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,2,65535,0),this[m]=u&255,this[m+1]=u>>>8,m+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,2,65535,0),this[m]=u>>>8,this[m+1]=u&255,m+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,4,4294967295,0),this[m+3]=u>>>24,this[m+2]=u>>>16,this[m+1]=u>>>8,this[m]=u&255,m+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,4,4294967295,0),this[m]=u>>>24,this[m+1]=u>>>16,this[m+2]=u>>>8,this[m+3]=u&255,m+4};function Pe(y,u,m,S,q){gt(u,S,q,y,m,7);let J=Number(u&BigInt(4294967295));y[m++]=J,J=J>>8,y[m++]=J,J=J>>8,y[m++]=J,J=J>>8,y[m++]=J;let Z=Number(u>>BigInt(32)&BigInt(4294967295));return y[m++]=Z,Z=Z>>8,y[m++]=Z,Z=Z>>8,y[m++]=Z,Z=Z>>8,y[m++]=Z,m}function ce(y,u,m,S,q){gt(u,S,q,y,m,7);let J=Number(u&BigInt(4294967295));y[m+7]=J,J=J>>8,y[m+6]=J,J=J>>8,y[m+5]=J,J=J>>8,y[m+4]=J;let Z=Number(u>>BigInt(32)&BigInt(4294967295));return y[m+3]=Z,Z=Z>>8,y[m+2]=Z,Z=Z>>8,y[m+1]=Z,Z=Z>>8,y[m]=Z,m+8}a.prototype.writeBigUInt64LE=X(function(u,m=0){return Pe(this,u,m,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=X(function(u,m=0){return ce(this,u,m,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(u,m,S,q){if(u=+u,m=m>>>0,!q){const tt=Math.pow(2,8*S-1);we(this,u,m,S,tt-1,-tt)}let J=0,Z=1,Se=0;for(this[m]=u&255;++J<S&&(Z*=256);)u<0&&Se===0&&this[m+J-1]!==0&&(Se=1),this[m+J]=(u/Z>>0)-Se&255;return m+S},a.prototype.writeIntBE=function(u,m,S,q){if(u=+u,m=m>>>0,!q){const tt=Math.pow(2,8*S-1);we(this,u,m,S,tt-1,-tt)}let J=S-1,Z=1,Se=0;for(this[m+J]=u&255;--J>=0&&(Z*=256);)u<0&&Se===0&&this[m+J+1]!==0&&(Se=1),this[m+J]=(u/Z>>0)-Se&255;return m+S},a.prototype.writeInt8=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,1,127,-128),u<0&&(u=255+u+1),this[m]=u&255,m+1},a.prototype.writeInt16LE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,2,32767,-32768),this[m]=u&255,this[m+1]=u>>>8,m+2},a.prototype.writeInt16BE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,2,32767,-32768),this[m]=u>>>8,this[m+1]=u&255,m+2},a.prototype.writeInt32LE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,4,2147483647,-2147483648),this[m]=u&255,this[m+1]=u>>>8,this[m+2]=u>>>16,this[m+3]=u>>>24,m+4},a.prototype.writeInt32BE=function(u,m,S){return u=+u,m=m>>>0,S||we(this,u,m,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[m]=u>>>24,this[m+1]=u>>>16,this[m+2]=u>>>8,this[m+3]=u&255,m+4},a.prototype.writeBigInt64LE=X(function(u,m=0){return Pe(this,u,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=X(function(u,m=0){return ce(this,u,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function de(y,u,m,S,q,J){if(m+S>y.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function me(y,u,m,S,q){return u=+u,m=m>>>0,q||de(y,u,m,4),s.write(y,u,m,S,23,4),m+4}a.prototype.writeFloatLE=function(u,m,S){return me(this,u,m,!0,S)},a.prototype.writeFloatBE=function(u,m,S){return me(this,u,m,!1,S)};function se(y,u,m,S,q){return u=+u,m=m>>>0,q||de(y,u,m,8),s.write(y,u,m,S,52,8),m+8}a.prototype.writeDoubleLE=function(u,m,S){return se(this,u,m,!0,S)},a.prototype.writeDoubleBE=function(u,m,S){return se(this,u,m,!1,S)},a.prototype.copy=function(u,m,S,q){if(!a.isBuffer(u))throw new TypeError("argument should be a Buffer");if(S||(S=0),!q&&q!==0&&(q=this.length),m>=u.length&&(m=u.length),m||(m=0),q>0&&q<S&&(q=S),q===S||u.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),u.length-m<q-S&&(q=u.length-m+S);const J=q-S;return this===u&&typeof i.prototype.copyWithin=="function"?this.copyWithin(m,S,q):i.prototype.set.call(u,this.subarray(S,q),m),J},a.prototype.fill=function(u,m,S,q){if(typeof u=="string"){if(typeof m=="string"?(q=m,m=0,S=this.length):typeof S=="string"&&(q=S,S=this.length),q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!a.isEncoding(q))throw new TypeError("Unknown encoding: "+q);if(u.length===1){const Z=u.charCodeAt(0);(q==="utf8"&&Z<128||q==="latin1")&&(u=Z)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(m<0||this.length<m||this.length<S)throw new RangeError("Out of range index");if(S<=m)return this;m=m>>>0,S=S===void 0?this.length:S>>>0,u||(u=0);let J;if(typeof u=="number")for(J=m;J<S;++J)this[J]=u;else{const Z=a.isBuffer(u)?u:a.from(u,q),Se=Z.length;if(Se===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(J=0;J<S-m;++J)this[J+m]=Z[J%Se]}return this};const he={};function Ue(y,u,m){he[y]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${y}]`,this.stack,delete this.name}get code(){return y}set code(q){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:q,writable:!0})}toString(){return`${this.name} [${y}]: ${this.message}`}}}Ue("ERR_BUFFER_OUT_OF_BOUNDS",function(y){return y?`${y} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ue("ERR_INVALID_ARG_TYPE",function(y,u){return`The "${y}" argument must be of type number. Received type ${typeof u}`},TypeError),Ue("ERR_OUT_OF_RANGE",function(y,u,m){let S=`The value of "${y}" is out of range.`,q=m;return Number.isInteger(m)&&Math.abs(m)>2**32?q=Me(String(m)):typeof m=="bigint"&&(q=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(q=Me(q)),q+="n"),S+=` It must be ${u}. Received ${q}`,S},RangeError);function Me(y){let u="",m=y.length;const S=y[0]==="-"?1:0;for(;m>=S+4;m-=3)u=`_${y.slice(m-3,m)}${u}`;return`${y.slice(0,m)}${u}`}function ht(y,u,m){He(u,"offset"),(y[u]===void 0||y[u+m]===void 0)&&wt(u,y.length-(m+1))}function gt(y,u,m,S,q,J){if(y>m||y<u){const Z=typeof u=="bigint"?"n":"";let Se;throw u===0||u===BigInt(0)?Se=`>= 0${Z} and < 2${Z} ** ${(J+1)*8}${Z}`:Se=`>= -(2${Z} ** ${(J+1)*8-1}${Z}) and < 2 ** ${(J+1)*8-1}${Z}`,new he.ERR_OUT_OF_RANGE("value",Se,y)}ht(S,q,J)}function He(y,u){if(typeof y!="number")throw new he.ERR_INVALID_ARG_TYPE(u,"number",y)}function wt(y,u,m){throw Math.floor(y)!==y?(He(y,m),new he.ERR_OUT_OF_RANGE("offset","an integer",y)):u<0?new he.ERR_BUFFER_OUT_OF_BOUNDS:new he.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${u}`,y)}const ft=/[^+/0-9A-Za-z-_]/g;function et(y){if(y=y.split("=")[0],y=y.trim().replace(ft,""),y.length<2)return"";for(;y.length%4!==0;)y=y+"=";return y}function Fe(y,u){u=u||1/0;let m;const S=y.length;let q=null;const J=[];for(let Z=0;Z<S;++Z){if(m=y.charCodeAt(Z),m>55295&&m<57344){if(!q){if(m>56319){(u-=3)>-1&&J.push(239,191,189);continue}else if(Z+1===S){(u-=3)>-1&&J.push(239,191,189);continue}q=m;continue}if(m<56320){(u-=3)>-1&&J.push(239,191,189),q=m;continue}m=(q-55296<<10|m-56320)+65536}else q&&(u-=3)>-1&&J.push(239,191,189);if(q=null,m<128){if((u-=1)<0)break;J.push(m)}else if(m<2048){if((u-=2)<0)break;J.push(m>>6|192,m&63|128)}else if(m<65536){if((u-=3)<0)break;J.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((u-=4)<0)break;J.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return J}function it(y){const u=[];for(let m=0;m<y.length;++m)u.push(y.charCodeAt(m)&255);return u}function T(y,u){let m,S,q;const J=[];for(let Z=0;Z<y.length&&!((u-=2)<0);++Z)m=y.charCodeAt(Z),S=m>>8,q=m%256,J.push(q),J.push(S);return J}function D(y){return e.toByteArray(et(y))}function re(y,u,m,S){let q;for(q=0;q<S&&!(q+m>=u.length||q>=y.length);++q)u[q+m]=y[q];return q}function fe(y,u){return y instanceof u||y!=null&&y.constructor!=null&&y.constructor.name!=null&&y.constructor.name===u.name}function Re(y){return y!==y}const ee=function(){const y="0123456789abcdef",u=new Array(256);for(let m=0;m<16;++m){const S=m*16;for(let q=0;q<16;++q)u[S+q]=y[m]+y[q]}return u}();function X(y){return typeof BigInt>"u"?U:y}function U(){throw new Error("BigInt not supported")}})(El);const ef=El.Buffer;function lt(t,e,s,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}ie.inherits(lt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ie.toJSONObject(this.config),code:this.code,status:this.status}}});const Il=lt.prototype,$l={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{$l[t]={value:t}});Object.defineProperties(lt,$l);Object.defineProperty(Il,"isAxiosError",{value:!0});lt.from=(t,e,s,r,o,i)=>{const c=Object.create(Il);return ie.toFlatObject(t,c,function(f){return f!==Error.prototype},l=>l!=="isAxiosError"),lt.call(c,t.message,e,s,r,o),c.cause=t,c.name=t.name,i&&Object.assign(c,i),c};const tf=null;function Ri(t){return ie.isPlainObject(t)||ie.isArray(t)}function Pl(t){return ie.endsWith(t,"[]")?t.slice(0,-2):t}function Xa(t,e,s){return t?t.concat(e).map(function(o,i){return o=Pl(o),!s&&i?"["+o+"]":o}).join(s?".":""):e}function sf(t){return ie.isArray(t)&&!t.some(Ri)}const nf=ie.toFlatObject(ie,{},null,function(e){return/^is[A-Z]/.test(e)});function Io(t,e,s){if(!ie.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,s=ie.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,A){return!ie.isUndefined(A[C])});const r=s.metaTokens,o=s.visitor||a,i=s.dots,c=s.indexes,f=(s.Blob||typeof Blob<"u"&&Blob)&&ie.isSpecCompliantForm(e);if(!ie.isFunction(o))throw new TypeError("visitor must be a function");function h(g){if(g===null)return"";if(ie.isDate(g))return g.toISOString();if(!f&&ie.isBlob(g))throw new lt("Blob is not supported. Use a Buffer instead.");return ie.isArrayBuffer(g)||ie.isTypedArray(g)?f&&typeof Blob=="function"?new Blob([g]):ef.from(g):g}function a(g,C,A){let P=g;if(g&&!A&&typeof g=="object"){if(ie.endsWith(C,"{}"))C=r?C:C.slice(0,-2),g=JSON.stringify(g);else if(ie.isArray(g)&&sf(g)||(ie.isFileList(g)||ie.endsWith(C,"[]"))&&(P=ie.toArray(g)))return C=Pl(C),P.forEach(function(j,k){!(ie.isUndefined(j)||j===null)&&e.append(c===!0?Xa([C],k,i):c===null?C:C+"[]",h(j))}),!1}return Ri(g)?!0:(e.append(Xa(A,C,i),h(g)),!1)}const p=[],_=Object.assign(nf,{defaultVisitor:a,convertValue:h,isVisitable:Ri});function N(g,C){if(!ie.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(g),ie.forEach(g,function(P,R){(!(ie.isUndefined(P)||P===null)&&o.call(e,P,ie.isString(R)?R.trim():R,C,_))===!0&&N(P,C?C.concat(R):[R])}),p.pop()}}if(!ie.isObject(t))throw new TypeError("data must be an object");return N(t),e}function Za(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function ca(t,e){this._pairs=[],t&&Io(t,this,e)}const Rl=ca.prototype;Rl.append=function(e,s){this._pairs.push([e,s])};Rl.toString=function(e){const s=e?function(r){return e.call(this,r,Za)}:Za;return this._pairs.map(function(o){return s(o[0])+"="+s(o[1])},"").join("&")};function rf(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ll(t,e,s){if(!e)return t;const r=s&&s.encode||rf;ie.isFunction(s)&&(s={serialize:s});const o=s&&s.serialize;let i;if(o?i=o(e,s):i=ie.isURLSearchParams(e)?e.toString():new ca(e,s).toString(r),i){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class ec{constructor(){this.handlers=[]}use(e,s,r){return this.handlers.push({fulfilled:e,rejected:s,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ie.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Ol={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},of=typeof URLSearchParams<"u"?URLSearchParams:ca,af=typeof FormData<"u"?FormData:null,cf=typeof Blob<"u"?Blob:null,lf={isBrowser:!0,classes:{URLSearchParams:of,FormData:af,Blob:cf},protocols:["http","https","file","blob","url","data"]},la=typeof window<"u"&&typeof document<"u",Li=typeof navigator=="object"&&navigator||void 0,df=la&&(!Li||["ReactNative","NativeScript","NS"].indexOf(Li.product)<0),uf=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",hf=la&&window.location.href||"http://localhost",ff=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:la,hasStandardBrowserEnv:df,hasStandardBrowserWebWorkerEnv:uf,navigator:Li,origin:hf},Symbol.toStringTag,{value:"Module"})),ds={...ff,...lf};function pf(t,e){return Io(t,new ds.classes.URLSearchParams,Object.assign({visitor:function(s,r,o,i){return ds.isNode&&ie.isBuffer(s)?(this.append(r,s.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function mf(t){return ie.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function gf(t){const e={},s=Object.keys(t);let r;const o=s.length;let i;for(r=0;r<o;r++)i=s[r],e[i]=t[i];return e}function Ml(t){function e(s,r,o,i){let c=s[i++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),f=i>=s.length;return c=!c&&ie.isArray(o)?o.length:c,f?(ie.hasOwnProp(o,c)?o[c]=[o[c],r]:o[c]=r,!l):((!o[c]||!ie.isObject(o[c]))&&(o[c]=[]),e(s,r,o[c],i)&&ie.isArray(o[c])&&(o[c]=gf(o[c])),!l)}if(ie.isFormData(t)&&ie.isFunction(t.entries)){const s={};return ie.forEachEntry(t,(r,o)=>{e(mf(r),o,s,0)}),s}return null}function yf(t,e,s){if(ie.isString(t))try{return(e||JSON.parse)(t),ie.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(s||JSON.stringify)(t)}const Mr={transitional:Ol,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const r=s.getContentType()||"",o=r.indexOf("application/json")>-1,i=ie.isObject(e);if(i&&ie.isHTMLForm(e)&&(e=new FormData(e)),ie.isFormData(e))return o?JSON.stringify(Ml(e)):e;if(ie.isArrayBuffer(e)||ie.isBuffer(e)||ie.isStream(e)||ie.isFile(e)||ie.isBlob(e)||ie.isReadableStream(e))return e;if(ie.isArrayBufferView(e))return e.buffer;if(ie.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return pf(e,this.formSerializer).toString();if((l=ie.isFileList(e))||r.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Io(l?{"files[]":e}:e,f&&new f,this.formSerializer)}}return i||o?(s.setContentType("application/json",!1),yf(e)):e}],transformResponse:[function(e){const s=this.transitional||Mr.transitional,r=s&&s.forcedJSONParsing,o=this.responseType==="json";if(ie.isResponse(e)||ie.isReadableStream(e))return e;if(e&&ie.isString(e)&&(r&&!this.responseType||o)){const c=!(s&&s.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(l){if(c)throw l.name==="SyntaxError"?lt.from(l,lt.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ds.classes.FormData,Blob:ds.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ie.forEach(["delete","get","head","post","put","patch"],t=>{Mr.headers[t]={}});const _f=ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vf=t=>{const e={};let s,r,o;return t&&t.split(`
`).forEach(function(c){o=c.indexOf(":"),s=c.substring(0,o).trim().toLowerCase(),r=c.substring(o+1).trim(),!(!s||e[s]&&_f[s])&&(s==="set-cookie"?e[s]?e[s].push(r):e[s]=[r]:e[s]=e[s]?e[s]+", "+r:r)}),e},tc=Symbol("internals");function mr(t){return t&&String(t).trim().toLowerCase()}function ao(t){return t===!1||t==null?t:ie.isArray(t)?t.map(ao):String(t)}function wf(t){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=s.exec(t);)e[r[1]]=r[2];return e}const bf=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ai(t,e,s,r,o){if(ie.isFunction(r))return r.call(this,e,s);if(o&&(e=s),!!ie.isString(e)){if(ie.isString(r))return e.indexOf(r)!==-1;if(ie.isRegExp(r))return r.test(e)}}function xf(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,r)=>s.toUpperCase()+r)}function Sf(t,e){const s=ie.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+s,{value:function(o,i,c){return this[r].call(this,e,o,i,c)},configurable:!0})})}let ms=class{constructor(e){e&&this.set(e)}set(e,s,r){const o=this;function i(l,f,h){const a=mr(f);if(!a)throw new Error("header name must be a non-empty string");const p=ie.findKey(o,a);(!p||o[p]===void 0||h===!0||h===void 0&&o[p]!==!1)&&(o[p||f]=ao(l))}const c=(l,f)=>ie.forEach(l,(h,a)=>i(h,a,f));if(ie.isPlainObject(e)||e instanceof this.constructor)c(e,s);else if(ie.isString(e)&&(e=e.trim())&&!bf(e))c(vf(e),s);else if(ie.isObject(e)&&ie.isIterable(e)){let l={},f,h;for(const a of e){if(!ie.isArray(a))throw TypeError("Object iterator must return a key-value pair");l[h=a[0]]=(f=l[h])?ie.isArray(f)?[...f,a[1]]:[f,a[1]]:a[1]}c(l,s)}else e!=null&&i(s,e,r);return this}get(e,s){if(e=mr(e),e){const r=ie.findKey(this,e);if(r){const o=this[r];if(!s)return o;if(s===!0)return wf(o);if(ie.isFunction(s))return s.call(this,o,r);if(ie.isRegExp(s))return s.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=mr(e),e){const r=ie.findKey(this,e);return!!(r&&this[r]!==void 0&&(!s||ai(this,this[r],r,s)))}return!1}delete(e,s){const r=this;let o=!1;function i(c){if(c=mr(c),c){const l=ie.findKey(r,c);l&&(!s||ai(r,r[l],l,s))&&(delete r[l],o=!0)}}return ie.isArray(e)?e.forEach(i):i(e),o}clear(e){const s=Object.keys(this);let r=s.length,o=!1;for(;r--;){const i=s[r];(!e||ai(this,this[i],i,e,!0))&&(delete this[i],o=!0)}return o}normalize(e){const s=this,r={};return ie.forEach(this,(o,i)=>{const c=ie.findKey(r,i);if(c){s[c]=ao(o),delete s[i];return}const l=e?xf(i):String(i).trim();l!==i&&delete s[i],s[l]=ao(o),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return ie.forEach(this,(r,o)=>{r!=null&&r!==!1&&(s[o]=e&&ie.isArray(r)?r.join(", "):r)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const r=new this(e);return s.forEach(o=>r.set(o)),r}static accessor(e){const r=(this[tc]=this[tc]={accessors:{}}).accessors,o=this.prototype;function i(c){const l=mr(c);r[l]||(Sf(o,c),r[l]=!0)}return ie.isArray(e)?e.forEach(i):i(e),this}};ms.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ie.reduceDescriptors(ms.prototype,({value:t},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[s]=r}}});ie.freezeMethods(ms);function ci(t,e){const s=this||Mr,r=e||s,o=ms.from(r.headers);let i=r.data;return ie.forEach(t,function(l){i=l.call(s,i,o.normalize(),e?e.status:void 0)}),o.normalize(),i}function Bl(t){return!!(t&&t.__CANCEL__)}function Xn(t,e,s){lt.call(this,t??"canceled",lt.ERR_CANCELED,e,s),this.name="CanceledError"}ie.inherits(Xn,lt,{__CANCEL__:!0});function Fl(t,e,s){const r=s.config.validateStatus;!s.status||!r||r(s.status)?t(s):e(new lt("Request failed with status code "+s.status,[lt.ERR_BAD_REQUEST,lt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function Cf(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function kf(t,e){t=t||10;const s=new Array(t),r=new Array(t);let o=0,i=0,c;return e=e!==void 0?e:1e3,function(f){const h=Date.now(),a=r[i];c||(c=h),s[o]=f,r[o]=h;let p=i,_=0;for(;p!==o;)_+=s[p++],p=p%t;if(o=(o+1)%t,o===i&&(i=(i+1)%t),h-c<e)return;const N=a&&h-a;return N?Math.round(_*1e3/N):void 0}}function Nf(t,e){let s=0,r=1e3/e,o,i;const c=(h,a=Date.now())=>{s=a,o=null,i&&(clearTimeout(i),i=null),t.apply(null,h)};return[(...h)=>{const a=Date.now(),p=a-s;p>=r?c(h,a):(o=h,i||(i=setTimeout(()=>{i=null,c(o)},r-p)))},()=>o&&c(o)]}const go=(t,e,s=3)=>{let r=0;const o=kf(50,250);return Nf(i=>{const c=i.loaded,l=i.lengthComputable?i.total:void 0,f=c-r,h=o(f),a=c<=l;r=c;const p={loaded:c,total:l,progress:l?c/l:void 0,bytes:f,rate:h||void 0,estimated:h&&l&&a?(l-c)/h:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(p)},s)},sc=(t,e)=>{const s=t!=null;return[r=>e[0]({lengthComputable:s,total:t,loaded:r}),e[1]]},nc=t=>(...e)=>ie.asap(()=>t(...e)),jf=ds.hasStandardBrowserEnv?((t,e)=>s=>(s=new URL(s,ds.origin),t.protocol===s.protocol&&t.host===s.host&&(e||t.port===s.port)))(new URL(ds.origin),ds.navigator&&/(msie|trident)/i.test(ds.navigator.userAgent)):()=>!0,Tf=ds.hasStandardBrowserEnv?{write(t,e,s,r,o,i){const c=[t+"="+encodeURIComponent(e)];ie.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),ie.isString(r)&&c.push("path="+r),ie.isString(o)&&c.push("domain="+o),i===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ef(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Af(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Dl(t,e,s){let r=!Ef(e);return t&&(r||s==!1)?Af(t,e):e}const rc=t=>t instanceof ms?{...t}:t;function In(t,e){e=e||{};const s={};function r(h,a,p,_){return ie.isPlainObject(h)&&ie.isPlainObject(a)?ie.merge.call({caseless:_},h,a):ie.isPlainObject(a)?ie.merge({},a):ie.isArray(a)?a.slice():a}function o(h,a,p,_){if(ie.isUndefined(a)){if(!ie.isUndefined(h))return r(void 0,h,p,_)}else return r(h,a,p,_)}function i(h,a){if(!ie.isUndefined(a))return r(void 0,a)}function c(h,a){if(ie.isUndefined(a)){if(!ie.isUndefined(h))return r(void 0,h)}else return r(void 0,a)}function l(h,a,p){if(p in e)return r(h,a);if(p in t)return r(void 0,h)}const f={url:i,method:i,data:i,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,a,p)=>o(rc(h),rc(a),p,!0)};return ie.forEach(Object.keys(Object.assign({},t,e)),function(a){const p=f[a]||o,_=p(t[a],e[a],a);ie.isUndefined(_)&&p!==l||(s[a]=_)}),s}const Ul=t=>{const e=In({},t);let{data:s,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:i,headers:c,auth:l}=e;e.headers=c=ms.from(c),e.url=Ll(Dl(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let f;if(ie.isFormData(s)){if(ds.hasStandardBrowserEnv||ds.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((f=c.getContentType())!==!1){const[h,...a]=f?f.split(";").map(p=>p.trim()).filter(Boolean):[];c.setContentType([h||"multipart/form-data",...a].join("; "))}}if(ds.hasStandardBrowserEnv&&(r&&ie.isFunction(r)&&(r=r(e)),r||r!==!1&&jf(e.url))){const h=o&&i&&Tf.read(i);h&&c.set(o,h)}return e},If=typeof XMLHttpRequest<"u",$f=If&&function(t){return new Promise(function(s,r){const o=Ul(t);let i=o.data;const c=ms.from(o.headers).normalize();let{responseType:l,onUploadProgress:f,onDownloadProgress:h}=o,a,p,_,N,g;function C(){N&&N(),g&&g(),o.cancelToken&&o.cancelToken.unsubscribe(a),o.signal&&o.signal.removeEventListener("abort",a)}let A=new XMLHttpRequest;A.open(o.method.toUpperCase(),o.url,!0),A.timeout=o.timeout;function P(){if(!A)return;const j=ms.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),F={data:!l||l==="text"||l==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:j,config:t,request:A};Fl(function(L){s(L),C()},function(L){r(L),C()},F),A=null}"onloadend"in A?A.onloadend=P:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(P)},A.onabort=function(){A&&(r(new lt("Request aborted",lt.ECONNABORTED,t,A)),A=null)},A.onerror=function(){r(new lt("Network Error",lt.ERR_NETWORK,t,A)),A=null},A.ontimeout=function(){let k=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const F=o.transitional||Ol;o.timeoutErrorMessage&&(k=o.timeoutErrorMessage),r(new lt(k,F.clarifyTimeoutError?lt.ETIMEDOUT:lt.ECONNABORTED,t,A)),A=null},i===void 0&&c.setContentType(null),"setRequestHeader"in A&&ie.forEach(c.toJSON(),function(k,F){A.setRequestHeader(F,k)}),ie.isUndefined(o.withCredentials)||(A.withCredentials=!!o.withCredentials),l&&l!=="json"&&(A.responseType=o.responseType),h&&([_,g]=go(h,!0),A.addEventListener("progress",_)),f&&A.upload&&([p,N]=go(f),A.upload.addEventListener("progress",p),A.upload.addEventListener("loadend",N)),(o.cancelToken||o.signal)&&(a=j=>{A&&(r(!j||j.type?new Xn(null,t,A):j),A.abort(),A=null)},o.cancelToken&&o.cancelToken.subscribe(a),o.signal&&(o.signal.aborted?a():o.signal.addEventListener("abort",a)));const R=Cf(o.url);if(R&&ds.protocols.indexOf(R)===-1){r(new lt("Unsupported protocol "+R+":",lt.ERR_BAD_REQUEST,t));return}A.send(i||null)})},Pf=(t,e)=>{const{length:s}=t=t?t.filter(Boolean):[];if(e||s){let r=new AbortController,o;const i=function(h){if(!o){o=!0,l();const a=h instanceof Error?h:this.reason;r.abort(a instanceof lt?a:new Xn(a instanceof Error?a.message:a))}};let c=e&&setTimeout(()=>{c=null,i(new lt(`timeout ${e} of ms exceeded`,lt.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(i):h.removeEventListener("abort",i)}),t=null)};t.forEach(h=>h.addEventListener("abort",i));const{signal:f}=r;return f.unsubscribe=()=>ie.asap(l),f}},Rf=function*(t,e){let s=t.byteLength;if(s<e){yield t;return}let r=0,o;for(;r<s;)o=r+e,yield t.slice(r,o),r=o},Lf=async function*(t,e){for await(const s of Of(t))yield*Rf(s,e)},Of=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:s,value:r}=await e.read();if(s)break;yield r}}finally{await e.cancel()}},oc=(t,e,s,r)=>{const o=Lf(t,e);let i=0,c,l=f=>{c||(c=!0,r&&r(f))};return new ReadableStream({async pull(f){try{const{done:h,value:a}=await o.next();if(h){l(),f.close();return}let p=a.byteLength;if(s){let _=i+=p;s(_)}f.enqueue(new Uint8Array(a))}catch(h){throw l(h),h}},cancel(f){return l(f),o.return()}},{highWaterMark:2})},$o=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ql=$o&&typeof ReadableStream=="function",Mf=$o&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),zl=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Bf=ql&&zl(()=>{let t=!1;const e=new Request(ds.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),ic=64*1024,Oi=ql&&zl(()=>ie.isReadableStream(new Response("").body)),yo={stream:Oi&&(t=>t.body)};$o&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!yo[e]&&(yo[e]=ie.isFunction(t[e])?s=>s[e]():(s,r)=>{throw new lt(`Response type '${e}' is not supported`,lt.ERR_NOT_SUPPORT,r)})})})(new Response);const Ff=async t=>{if(t==null)return 0;if(ie.isBlob(t))return t.size;if(ie.isSpecCompliantForm(t))return(await new Request(ds.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(ie.isArrayBufferView(t)||ie.isArrayBuffer(t))return t.byteLength;if(ie.isURLSearchParams(t)&&(t=t+""),ie.isString(t))return(await Mf(t)).byteLength},Df=async(t,e)=>{const s=ie.toFiniteNumber(t.getContentLength());return s??Ff(e)},Uf=$o&&(async t=>{let{url:e,method:s,data:r,signal:o,cancelToken:i,timeout:c,onDownloadProgress:l,onUploadProgress:f,responseType:h,headers:a,withCredentials:p="same-origin",fetchOptions:_}=Ul(t);h=h?(h+"").toLowerCase():"text";let N=Pf([o,i&&i.toAbortSignal()],c),g;const C=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let A;try{if(f&&Bf&&s!=="get"&&s!=="head"&&(A=await Df(a,r))!==0){let F=new Request(e,{method:"POST",body:r,duplex:"half"}),O;if(ie.isFormData(r)&&(O=F.headers.get("content-type"))&&a.setContentType(O),F.body){const[L,E]=sc(A,go(nc(f)));r=oc(F.body,ic,L,E)}}ie.isString(p)||(p=p?"include":"omit");const P="credentials"in Request.prototype;g=new Request(e,{..._,signal:N,method:s.toUpperCase(),headers:a.normalize().toJSON(),body:r,duplex:"half",credentials:P?p:void 0});let R=await fetch(g);const j=Oi&&(h==="stream"||h==="response");if(Oi&&(l||j&&C)){const F={};["status","statusText","headers"].forEach(M=>{F[M]=R[M]});const O=ie.toFiniteNumber(R.headers.get("content-length")),[L,E]=l&&sc(O,go(nc(l),!0))||[];R=new Response(oc(R.body,ic,L,()=>{E&&E(),C&&C()}),F)}h=h||"text";let k=await yo[ie.findKey(yo,h)||"text"](R,t);return!j&&C&&C(),await new Promise((F,O)=>{Fl(F,O,{data:k,headers:ms.from(R.headers),status:R.status,statusText:R.statusText,config:t,request:g})})}catch(P){throw C&&C(),P&&P.name==="TypeError"&&/Load failed|fetch/i.test(P.message)?Object.assign(new lt("Network Error",lt.ERR_NETWORK,t,g),{cause:P.cause||P}):lt.from(P,P&&P.code,t,g)}}),Mi={http:tf,xhr:$f,fetch:Uf};ie.forEach(Mi,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const ac=t=>`- ${t}`,qf=t=>ie.isFunction(t)||t===null||t===!1,Hl={getAdapter:t=>{t=ie.isArray(t)?t:[t];const{length:e}=t;let s,r;const o={};for(let i=0;i<e;i++){s=t[i];let c;if(r=s,!qf(s)&&(r=Mi[(c=String(s)).toLowerCase()],r===void 0))throw new lt(`Unknown adapter '${c}'`);if(r)break;o[c||"#"+i]=r}if(!r){const i=Object.entries(o).map(([l,f])=>`adapter ${l} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=e?i.length>1?`since :
`+i.map(ac).join(`
`):" "+ac(i[0]):"as no adapter specified";throw new lt("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return r},adapters:Mi};function li(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Xn(null,t)}function cc(t){return li(t),t.headers=ms.from(t.headers),t.data=ci.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Hl.getAdapter(t.adapter||Mr.adapter)(t).then(function(r){return li(t),r.data=ci.call(t,t.transformResponse,r),r.headers=ms.from(r.headers),r},function(r){return Bl(r)||(li(t),r&&r.response&&(r.response.data=ci.call(t,t.transformResponse,r.response),r.response.headers=ms.from(r.response.headers))),Promise.reject(r)})}const Vl="1.9.0",Po={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Po[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const lc={};Po.transitional=function(e,s,r){function o(i,c){return"[Axios v"+Vl+"] Transitional option '"+i+"'"+c+(r?". "+r:"")}return(i,c,l)=>{if(e===!1)throw new lt(o(c," has been removed"+(s?" in "+s:"")),lt.ERR_DEPRECATED);return s&&!lc[c]&&(lc[c]=!0,console.warn(o(c," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(i,c,l):!0}};Po.spelling=function(e){return(s,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function zf(t,e,s){if(typeof t!="object")throw new lt("options must be an object",lt.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let o=r.length;for(;o-- >0;){const i=r[o],c=e[i];if(c){const l=t[i],f=l===void 0||c(l,i,t);if(f!==!0)throw new lt("option "+i+" must be "+f,lt.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new lt("Unknown option "+i,lt.ERR_BAD_OPTION)}}const co={assertOptions:zf,validators:Po},Ds=co.validators;let Tn=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ec,response:new ec}}async request(e,s){try{return await this._request(e,s)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=In(this.defaults,s);const{transitional:r,paramsSerializer:o,headers:i}=s;r!==void 0&&co.assertOptions(r,{silentJSONParsing:Ds.transitional(Ds.boolean),forcedJSONParsing:Ds.transitional(Ds.boolean),clarifyTimeoutError:Ds.transitional(Ds.boolean)},!1),o!=null&&(ie.isFunction(o)?s.paramsSerializer={serialize:o}:co.assertOptions(o,{encode:Ds.function,serialize:Ds.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),co.assertOptions(s,{baseUrl:Ds.spelling("baseURL"),withXsrfToken:Ds.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let c=i&&ie.merge(i.common,i[s.method]);i&&ie.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),s.headers=ms.concat(c,i);const l=[];let f=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(s)===!1||(f=f&&C.synchronous,l.unshift(C.fulfilled,C.rejected))});const h=[];this.interceptors.response.forEach(function(C){h.push(C.fulfilled,C.rejected)});let a,p=0,_;if(!f){const g=[cc.bind(this),void 0];for(g.unshift.apply(g,l),g.push.apply(g,h),_=g.length,a=Promise.resolve(s);p<_;)a=a.then(g[p++],g[p++]);return a}_=l.length;let N=s;for(p=0;p<_;){const g=l[p++],C=l[p++];try{N=g(N)}catch(A){C.call(this,A);break}}try{a=cc.call(this,N)}catch(g){return Promise.reject(g)}for(p=0,_=h.length;p<_;)a=a.then(h[p++],h[p++]);return a}getUri(e){e=In(this.defaults,e);const s=Dl(e.baseURL,e.url,e.allowAbsoluteUrls);return Ll(s,e.params,e.paramsSerializer)}};ie.forEach(["delete","get","head","options"],function(e){Tn.prototype[e]=function(s,r){return this.request(In(r||{},{method:e,url:s,data:(r||{}).data}))}});ie.forEach(["post","put","patch"],function(e){function s(r){return function(i,c,l){return this.request(In(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:c}))}}Tn.prototype[e]=s(),Tn.prototype[e+"Form"]=s(!0)});let Hf=class Wl{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(i){s=i});const r=this;this.promise.then(o=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](o);r._listeners=null}),this.promise.then=o=>{let i;const c=new Promise(l=>{r.subscribe(l),i=l}).then(o);return c.cancel=function(){r.unsubscribe(i)},c},e(function(i,c,l){r.reason||(r.reason=new Xn(i,c,l),s(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=r=>{e.abort(r)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new Wl(function(o){e=o}),cancel:e}}};function Vf(t){return function(s){return t.apply(null,s)}}function Wf(t){return ie.isObject(t)&&t.isAxiosError===!0}const Bi={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Bi).forEach(([t,e])=>{Bi[e]=t});function Gl(t){const e=new Tn(t),s=bl(Tn.prototype.request,e);return ie.extend(s,Tn.prototype,e,{allOwnKeys:!0}),ie.extend(s,e,null,{allOwnKeys:!0}),s.create=function(o){return Gl(In(t,o))},s}const Mt=Gl(Mr);Mt.Axios=Tn;Mt.CanceledError=Xn;Mt.CancelToken=Hf;Mt.isCancel=Bl;Mt.VERSION=Vl;Mt.toFormData=Io;Mt.AxiosError=lt;Mt.Cancel=Mt.CanceledError;Mt.all=function(e){return Promise.all(e)};Mt.spread=Vf;Mt.isAxiosError=Wf;Mt.mergeConfig=In;Mt.AxiosHeaders=ms;Mt.formToJSON=t=>Ml(ie.isHTMLForm(t)?new FormData(t):t);Mt.getAdapter=Hl.getAdapter;Mt.HttpStatusCode=Bi;Mt.default=Mt;const{Axios:UG,AxiosError:qG,CanceledError:zG,isCancel:HG,CancelToken:VG,VERSION:WG,all:GG,Cancel:YG,isAxiosError:KG,spread:JG,toFormData:QG,AxiosHeaders:XG,HttpStatusCode:ZG,formToJSON:eY,getAdapter:tY,mergeConfig:sY}=Mt,zt={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",NONE:"none"},Rs={level:zt.ERROR,enabled:!1,includeTimestamp:!0,groupByContext:!0},dc={[zt.DEBUG]:0,[zt.INFO]:1,[zt.WARN]:2,[zt.ERROR]:3,[zt.NONE]:4},Gf=(t,e)=>{let s="";if(t&&(s+=`[${t}] `),Rs.includeTimestamp){const o=new Date().toLocaleTimeString();s+=`${o} `}return s+=e,s},zs=(t,e,s,...r)=>{if(!Rs.enabled||dc[t]<dc[Rs.level])return;const o=Gf(e,s);if(Rs.groupByContext&&e&&r.length>0&&typeof r[0]=="object"){console.groupCollapsed(o),r.forEach(c=>{c!==null&&typeof c=="object"?console.dir(c):console.log(c)}),console.groupEnd();return}switch(t){case zt.DEBUG:console.debug(o,...r);break;case zt.INFO:console.info(o,...r);break;case zt.WARN:console.warn(o,...r);break;case zt.ERROR:console.error(o,...r);break;default:console.log(o,...r)}},yn=t=>({debug:(e,...s)=>zs(zt.DEBUG,t,e,...s),info:(e,...s)=>zs(zt.INFO,t,e,...s),warn:(e,...s)=>zs(zt.WARN,t,e,...s),error:(e,...s)=>zs(zt.ERROR,t,e,...s),log:(e,...s)=>zs(zt.INFO,t,e,...s)}),De={debug:(t,...e)=>zs(zt.DEBUG,"",t,...e),info:(t,...e)=>zs(zt.INFO,"",t,...e),warn:(t,...e)=>zs(zt.WARN,"",t,...e),error:(t,...e)=>zs(zt.ERROR,"",t,...e),log:(t,...e)=>zs(zt.INFO,"",t,...e),create:t=>yn(t),setLevel:t=>{zt[t]&&(Rs.level=t)},getLevel:()=>Rs.level,enable:()=>{Rs.enabled=!0},disable:()=>{Rs.enabled=!1},isEnabled:()=>Rs.enabled,includeTimestamp:(t=!0)=>{Rs.includeTimestamp=t},groupByContext:(t=!0)=>{Rs.groupByContext=t}},da=De.create("chatUtils"),Yf=(t,e)=>{var r,o,i,c,l,f,h;if(!t)return"No messages yet";const s=t.sender===e?"You: ":"";switch(t.type){case"text":const a=t.content||"";return s+(a.length>25?`${a.substring(0,25)}...`:a);case"wink":return s+"Sent a wink 😉";case"file":return(o=(r=t.metadata)==null?void 0:r.fileType)!=null&&o.startsWith("image/")?s+"Sent an image":(c=(i=t.metadata)==null?void 0:i.fileType)!=null&&c.startsWith("video/")?s+"Sent a video":(f=(l=t.metadata)==null?void 0:l.fileType)!=null&&f.startsWith("audio/")?s+"Sent an audio file":((h=t.metadata)==null?void 0:h.fileType)==="application/pdf"?s+"Sent a PDF document":s+"Sent a file";case"video":return s+"Video Call";default:return s+"New message"}},ua=t=>{const e={};if(!Array.isArray(t))return e;const s=new Set;return t.forEach(r=>{if(r&&r.createdAt){const o=r._id||r.tempId;if(o&&s.has(o))return;o&&s.add(o);const i=new Date(r.createdAt).toDateString();e[i]=e[i]||[],e[i].push(r)}}),e},bs=(...t)=>t.filter(Boolean).join(" "),Kf=t=>{if(!t)return"";try{return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}catch(e){return da.warn("Error formatting message time:",e),""}},uc=t=>{if(!t)return"Unknown date";try{const e=new Date(t),s=new Date,r=new Date(s);return r.setDate(r.getDate()-1),e.toDateString()===s.toDateString()?"Today":e.toDateString()===r.toDateString()?"Yesterday":e.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}catch(e){return da.warn("Error formatting message date separator:",e),"Unknown date"}},Jf=t=>{if(!t)return"";try{const e=new Date(t),r=Math.round((new Date-e)/1e3),o=Math.round(r/60),i=Math.round(o/60),c=Math.round(i/24);return r<60?"Just now":o<60?`${o}m ago`:i<24?`${i}h ago`:c===1?"Yesterday":c<7?e.toLocaleDateString([],{weekday:"short"}):e.toLocaleDateString([],{month:"short",day:"numeric"})}catch(e){return da.warn("Error formatting preview time:",e),""}},di=De.create("utils"),Sn=t=>{if(!t)return null;const e=typeof t=="string"?t:String(t);if(/^[0-9a-fA-F]{24}$/.test(e))return e;if(e.length>24){const r=e.match(/([0-9a-fA-F]{24})/);if(r&&r[1])return r[1]}const s=e.match(/ObjectId\(['"](.*)['"]\)/);if(s&&s[1]){const r=s[1];if(/^[0-9a-fA-F]{24}$/.test(r))return r}if(typeof t=="object"&&t!==null&&t._id)return Sn(t._id);if(typeof t=="object"&&t!==null&&t.id)return Sn(t.id);if(typeof t=="object"&&t!==null&&t.sub)return Sn(t.sub);if(typeof t=="object"&&t!==null&&t.user){if(typeof t.user=="object"&&t.user!==null){if(t.user._id)return Sn(t.user._id);if(t.user.id)return Sn(t.user.id)}else if(typeof t.user=="string")return Sn(t.user)}if(typeof t=="object"&&t!==null){const o=JSON.stringify(t).match(/[0-9a-fA-F]{24}/g)||[];if(o.length>0)return o[0]}return null},lo=new Map,ha=new Set;typeof window<"u"&&(window.__url_normalization_cache=lo,window.__failed_urls_cache=ha);const fs=(t,e=!1)=>{if(!t)return`${window.location.origin}/placeholder.svg`;const s=`${t}:${e}`;if(!e&&lo.has(s))return lo.get(s);if(ha.has(t))return`${window.location.origin}/placeholder.svg`;let r;if(t==="/default-avatar.png"||t==="/placeholder.svg")r=`${window.location.origin}${t}`;else if(t.startsWith("http"))r=t;else if(/^[0-9a-f]{24}$/i.test(t))r=`${window.location.origin}/api/avatars/${t}`;else if(t.startsWith("/uploads/"))r=`${window.location.origin}${t}`;else if(t.includes("/images/")||t.includes("/photos/")){const o=t.startsWith("/uploads")?t:`/uploads${t.startsWith("/")?"":"/"}${t}`;r=`${window.location.origin}${o}`}else if(t.includes("uploads/")||t.startsWith("/uploads/")){const o=t.startsWith("/")?t:`/${t}`;r=`${window.location.origin}${o}`}else/^\d+-\d+.*\.(jpg|jpeg|png|gif|webp)$/i.test(t)?(r=`${window.location.origin}/uploads/images/${t}`,e=!0):t.startsWith("/")?r=`${window.location.origin}${t}`:r=t;if(e&&r){const o=typeof window<"u"&&window.__photo_refresh_timestamp?window.__photo_refresh_timestamp:Date.now(),i=r.includes("?")?"&":"?";r=`${r}${i}_v=${o}`}return lo.set(s,r),r},Qf=t=>(ha.add(t),`${window.location.origin}/placeholder.svg`),_o=(t,e={})=>{let s="en-US";try{document.documentElement.lang==="he"?s="he-IL":navigator.languages&&navigator.languages.length?s=navigator.languages[0]:navigator.language&&(s=navigator.language)}catch(h){di.warn("Failed to detect locale:",h)}const{showTime:r=!0,showDate:o=!0,showRelative:i=!1,locale:c=s}=e;if(!t)return"";const l=typeof t=="string"?new Date(t):t;if(isNaN(l.getTime()))return"";if(i)if(c.startsWith("he")){const a=new Date-l,p=Math.floor(a/1e3),_=Math.floor(p/60),N=Math.floor(_/60),g=Math.floor(N/24);if(p<60)return"זה עתה";if(_<60)return`לפני ${_} דקות`;if(N<24)return`לפני ${N} שעות`;if(g<7)return`לפני ${g} ימים`}else{const a=new Date-l,p=Math.floor(a/1e3),_=Math.floor(p/60),N=Math.floor(_/60),g=Math.floor(N/24);if(p<60)return"just now";if(_<60)return`${_}m ago`;if(N<24)return`${N}h ago`;if(g<7)return`${g}d ago`}let f="";if(o)try{f=l.toLocaleDateString(c,{year:"numeric",month:"short",day:"numeric"})}catch{di.warn(`Locale ${c} not supported for date formatting, falling back to default`),f=l.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}if(r){let h;try{h=l.toLocaleTimeString(c,{hour:"2-digit",minute:"2-digit"})}catch{di.warn(`Locale ${c} not supported for time formatting, falling back to default`),h=l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}c.startsWith("he")||document.dir==="rtl"?f=o?`${h} ,${f}`:h:f=o?`${f}, ${h}`:h}return f},sn=De.create("TokenStorage"),ls=()=>{const t=sessionStorage.getItem("token")||localStorage.getItem("token");return t&&sn.debug("Token retrieved from storage"),t},kr=(t,e=!0)=>{t&&(sessionStorage.setItem("token",t),sn.debug("Token stored in sessionStorage"),e?(localStorage.setItem("token",t),sn.debug("Token also stored in localStorage (remember me)")):localStorage.removeItem("token"))},xr=()=>{sessionStorage.removeItem("token"),localStorage.removeItem("token"),sn.debug("Token removed from all storage")},Fi=t=>{if(!t)return!0;try{const s=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(atob(s)).exp*1e3,c=Date.now()>=o-3e4;return c&&sn.debug(`Token expired at ${new Date(o).toISOString()}`),c}catch(e){return sn.error("Error parsing JWT token:",e),!0}},Xf=t=>{if(!t)return null;try{const s=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(s))}catch(e){return sn.error("Error parsing JWT token:",e),null}},hc=t=>{if(!t)return null;try{const e=Xf(t);if(!e)return null;let s=null;return e._id?s=e._id:e.id?s=e.id:e.sub?s=e.sub:e.user&&(s=e.user._id||e.user.id),s?Sn(s):(sn.warn("No user ID found in token payload",e),null)}catch(e){return sn.error("Error extracting user ID from token:",e),null}},Zf=Cn.BASE_URL,ep=Cn.TIMEOUT,tp=tn.SIZE,sp=tn.TTL.DEFAULT,np=Cn.RETRIES.MAX_QUEUE_RETRIES;class rp{constructor(e=tp,s=sp){this.ttl=s,this.map=new Map,this.maxSize=e}_evictIfNeeded(){if(this.map.size<=this.maxSize)return;const e=this.map.keys().next().value;this.map.delete(e)}_makeKey(e,s={}){const r=e.replace(/\/+$/,""),o=r.match(/\/([0-9a-fA-F]{24})$/),i=o?r.replace(o[1],":id"):r,c=o?`:${o[1]}`:"",l=Object.keys(s).length?":"+JSON.stringify(Object.entries(s).sort()):"";return`${i}${c}${l}`}get(e,s){const r=this._makeKey(e,s),o=this.map.get(r);return!o||o.expiresAt<Date.now()?(this.map.delete(r),De.create("ResponseCache").debug(`Cache miss/expired: ${r}`),null):(De.create("ResponseCache").debug(`Cache hit: ${r}`),o.data)}set(e,s,r){if(!(r!=null&&r.success))return;const o=this._makeKey(e,s);let i=this.ttl;e.match(/\/users\/[0-9a-fA-F]{24}$/)?i=tn.TTL.USER_PROFILE:e.includes("/messages/")?i=tn.TTL.MESSAGES:e.includes("/stories/")?i=tn.TTL.STORIES:e.includes("/messages/conversations")&&(i=tn.TTL.CONVERSATIONS),this._evictIfNeeded(),this.map.set(o,{data:r,expiresAt:Date.now()+i}),De.create("ResponseCache").debug(`Cached ${o} (TTL ${i}ms)`)}invalidate(e="",s){if(e&&s)this.map.delete(this._makeKey(e,s));else if(e)for(const r of this.map.keys())r.startsWith(e)&&this.map.delete(r);else this.map.clear();De.create("ResponseCache").debug(`Invalidated cache for: ${e}`)}}class op{constructor(e){this.onChange=e,this._online=()=>this._update(!0),this._offline=()=>this._update(!1),window.addEventListener("online",this._online),window.addEventListener("offline",this._offline),this._update(navigator.onLine)}_update(e){var s;De.create("NetworkMonitor").info(`Network is ${e?"online":"offline"}`),(s=this.onChange)==null||s.call(this,e),window.dispatchEvent(new CustomEvent("apiConnectionStatusChange",{detail:{isOnline:e}}))}cleanup(){window.removeEventListener("online",this._online),window.removeEventListener("offline",this._offline)}}class ip{constructor(e){this.api=e,this.queue=JSON.parse(localStorage.getItem("api_request_queue")||"[]"),this.processing=!1}add(e){this.queue.push({...e,retries:0}),localStorage.setItem("api_request_queue",JSON.stringify(this.queue)),De.create("RequestQueue").debug(`Queued ${e.method} ${e.url}`)}async process(){if(this.processing||!navigator.onLine)return;this.processing=!0;const e=[...this.queue];this.queue=[];for(const s of e)try{await this.api.request(s),De.create("RequestQueue").info(`Processed queued: ${s.method} ${s.url}`)}catch{s.retries++,s.retries<np?this.queue.push(s):De.create("RequestQueue").error(`Dropped after retries: ${s.method} ${s.url}`)}localStorage.setItem("api_request_queue",JSON.stringify(this.queue)),this.processing=!1}}class ap{constructor(){Cs(this,"_batchRequests",new Map);Cs(this,"_batchTimers",new Map);Cs(this,"_pendingBatches",new Map);this.baseURL=Zf,this.metrics={total:0,success:0,fail:0,avgTime:0},this.refreshPromise=null,this.retryQueue=[],this.api=Mt.create({baseURL:this.baseURL,timeout:ep,headers:{"Content-Type":"application/json",Accept:"application/json"}}),this.cache=new rp,this.queue=new ip(this.api),this.network=new op(e=>{e&&this.queue.process()}),this._loadToken(),this.api.interceptors.request.use(this._onRequest.bind(this),e=>Promise.reject(e)),this.api.interceptors.response.use(this._onResponse.bind(this),this._onError.bind(this)),this._addObjectIdInterceptor()}_onRequest(e){e.metadata={start:Date.now()},this.metrics.total++;const s=ls();if(s&&Fi(s)&&!e._retryAuth&&!e._skipAuthRefresh){e._retryAuth=!0,this.retryQueue.push(e),this._refreshToken().catch(()=>{});const r=Mt.CancelToken.source();e.cancelToken=r.token,r.cancel("Token expired")}return e.method==="get"&&e.headers["x-no-cache"]&&(e.params={...e.params||{},_:Date.now()}),s&&(e.headers.Authorization=`Bearer ${s}`),De.create("ApiService").debug(`→ ${e.method.toUpperCase()} ${e.url}`),e}_onResponse(e){const s=Date.now()-e.config.metadata.start;return this.metrics.success++,this.metrics.avgTime=(this.metrics.avgTime*(this.metrics.success-1)+s)/this.metrics.success,De.create("ApiService").debug(`← ${e.status} ${e.config.url} (${s}ms)`),e.config.method==="get"&&!e.config.headers["x-no-cache"]&&this.cache.set(e.config.url,e.config.params,e.data),e.data}async _onError(e){if(Mt.isCancel(e))return Promise.reject({canceled:!0});this.metrics.fail++;const s=e.config||{},r=s.url||"";if(["/users/photo-permissions","/users/photo-permissions/pending","/photo-permissions","/photo-access","/blocked"].some(f=>r.includes(f)))return Promise.reject({success:!1,silenced:!0});if(!e.response){const f=navigator.onLine?"Network error. Please try again.":"Offline — request queued.";return H.error(f),s.method!=="get"&&this.queue.add(s),Promise.reject({success:!1,error:f})}const{status:c,data:l}=e.response;return De.create("ApiService").error(`✖ ${c} ${s.url}`,l),c===401&&!s._retryAuth?this._handleAuthError(s):(this._notifyError(c,(l==null?void 0:l.message)||e.message),Promise.reject({success:!1,status:c,data:l}))}async _handleAuthError(e){e._retryAuth=!0;try{const s=await this._refreshToken();return e.headers.Authorization=`Bearer ${s}`,this.api.request(e)}catch{return this.logout(),Promise.reject({success:!1})}}async _refreshToken(){return this.refreshPromise?this.refreshPromise:(this.refreshPromise=(async()=>{const e=ls();if(!e)throw new Error("No token");try{const r=await this.api.post(Cn.ENDPOINTS.AUTH.REFRESH,{token:e},{headers:{"x-no-cache":"true"},_skipAuthRefresh:!0});if(r.success&&r.token)return kr(r.token,!!localStorage.token),this.api.defaults.headers.common.Authorization=`Bearer ${r.token}`,this._retryQueued(r.token),r.token;throw new Error("Refresh failed")}catch(s){throw De.create("ApiService").error("Token refresh failed:",s),s}})(),this.refreshPromise.finally(()=>this.refreshPromise=null),this.refreshPromise)}_retryQueued(e){const s=[...this.retryQueue];this.retryQueue=[],s.forEach(r=>{r.headers.Authorization=`Bearer ${e}`,this.api.request(r).catch(()=>{})})}_loadToken(){const e=ls();e&&(this.api.defaults.headers.common.Authorization=`Bearer ${e}`)}logout(){xr(),delete this.api.defaults.headers.common.Authorization,window.dispatchEvent(new CustomEvent("authLogout"))}_addToBatch(e,s,r,o,i={}){this._batchRequests.has(e)||this._batchRequests.set(e,[]);const c=new Promise((l,f)=>{this._batchRequests.get(e).push({method:s,url:r,data:o,options:i,resolve:l,reject:f})});if(!this._batchTimers.has(e)){const l=setTimeout(()=>this._processBatch(e),50);this._batchTimers.set(e,l)}return c}async _processBatch(e){clearTimeout(this._batchTimers.get(e)),this._batchTimers.delete(e);const s=this._batchRequests.get(e)||[];if(this._batchRequests.delete(e),s.length!==0){if(s.length===1){const{method:r,url:o,data:i,options:c,resolve:l,reject:f}=s[0];try{const h=await this._executeSingleRequest(r,o,i,c);l(h)}catch(h){f(h)}return}De.create("ApiService").debug(`Batching ${s.length} requests for ${e}`);try{const r=await Promise.all(s.map(({method:o,url:i,data:c,options:l})=>this._executeSingleRequest(o,i,c,l)));s.forEach(({resolve:o},i)=>{o(r[i])})}catch(r){s.forEach(({reject:o})=>{o(r)})}}}_executeSingleRequest(e,s,r,o){switch(e.toLowerCase()){case"get":const i=this.cache.get(s,o.params||{});return i&&o.useCache!==!1?i:this.api.get(s,{params:o.params,...o});case"post":return this.cache.invalidate(s),this.api.post(s,r,o);case"put":return this.cache.invalidate(s),this.api.put(s,r,o);case"delete":return this.cache.invalidate(s),this.api.delete(s,o);default:throw new Error(`Unsupported method: ${e}`)}}async get(e,s={},r={}){if(r.batch){const i=r.batchKey||"default";return this._addToBatch(i,"get",e,null,{...r,params:s})}const o=this.cache.get(e,s);return o&&r.useCache!==!1?o:this.api.get(e,{params:s,...r})}post(e,s,r={}){if(r.batch){const o=r.batchKey||"default";return this._addToBatch(o,"post",e,s,r)}return this.cache.invalidate(e),this.api.post(e,s,r)}put(e,s,r={}){if(r.batch){const o=r.batchKey||"default";return this._addToBatch(o,"put",e,s,r)}return this.cache.invalidate(e),this.api.put(e,s,r)}delete(e,s={}){if(s.batch){const r=s.batchKey||"default";return this._addToBatch(r,"delete",e,null,s)}return this.cache.invalidate(e),this.api.delete(e,s)}upload(e,s,r,o){const i=ls(),c={"Content-Type":"multipart/form-data"};return i&&(c.Authorization=`Bearer ${i}`),this.api.post(e,s,{headers:c,onUploadProgress:r,...o})}download(e,s,r,o){return this.api.get(e,{params:s,responseType:"blob",onDownloadProgress:r,...o})}createCancelableRequest(){const e=Mt.CancelToken.source();return{request:{cancelToken:e.token},cancel:()=>e.cancel("Request canceled")}}cancelAll(e="Canceled"){var s;(s=this.api.defaults.cancelToken)==null||s.cancel(e)}testConnection(){return this.get(Cn.ENDPOINTS.AUTH.TEST,{},{timeout:Cn.HEALTH_CHECK.CONNECTION_TEST_TIMEOUT})}getHealth(){return this.get("/health",{},{timeout:Cn.HEALTH_CHECK.TIMEOUT})}getMetrics(){return{...this.metrics}}clearCache(e){this.cache.invalidate(e)}cleanup(){this.network.cleanup(),this.cancelAll("Cleanup")}_addObjectIdInterceptor(){const e=De.create("ApiObjectId");this.api.interceptors.response.use(s=>s,s=>{if(s.response&&s.response.status===400){const r=s.response.data;r&&r.error&&(r.error==="Invalid user ID format"||r.error==="Invalid authenticated user ID format"||r.error==="Invalid user ID format in request")&&(e.warn("⚠️ Caught ObjectId validation error:",r.error),e.info("Standardized user ID format is now used across the application"),console.warn(`ObjectId validation error: ${r.error}. This should be handled by the standardized ID format system.`))}return Promise.reject(s)}),e.info("✅ API ObjectId interceptor installed")}_notifyError(e,s){var i;if(document.hidden)return;const r=((i=s==null?void 0:s.config)==null?void 0:i.url)||"",o=typeof r=="string"?r:"";if(o.includes("/photo-permissions")||o.includes("/photo-access")||o.includes("/users/photo-permissions")||o.endsWith("/blocked")||o.includes("/permissions/pending")){De.create("ApiService").debug(`Silently handling error for unimplemented endpoint: ${o}`);return}if(!(s&&(s.includes("story")||s.includes("Story"))&&e===429)&&!(e===404&&(o.includes("/api/users/photo-permissions")||o.includes("/api/users/photo-access"))))switch(e){case 400:if(o.includes("/users/photo-permissions")||o.includes("/photo-permissions"))return;H.error(`Bad request: ${s}`);break;case 401:break;case 403:H.error(`Forbidden: ${s}`);break;case 404:H.error(`Not found: ${s}`);break;case 429:H.error(s||"Please wait before posting again");break;default:e>=500&&H.error(`Server error (${e})`)}}}const Ae=new ap,Ws=Object.create(null);Ws.open="0";Ws.close="1";Ws.ping="2";Ws.pong="3";Ws.message="4";Ws.upgrade="5";Ws.noop="6";const uo=Object.create(null);Object.keys(Ws).forEach(t=>{uo[Ws[t]]=t});const Di={type:"error",data:"parser error"},Yl=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Kl=typeof ArrayBuffer=="function",Jl=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,fa=({type:t,data:e},s,r)=>Yl&&e instanceof Blob?s?r(e):fc(e,r):Kl&&(e instanceof ArrayBuffer||Jl(e))?s?r(e):fc(new Blob([e]),r):r(Ws[t]+(e||"")),fc=(t,e)=>{const s=new FileReader;return s.onload=function(){const r=s.result.split(",")[1];e("b"+(r||""))},s.readAsDataURL(t)};function pc(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let ui;function cp(t,e){if(Yl&&t.data instanceof Blob)return t.data.arrayBuffer().then(pc).then(e);if(Kl&&(t.data instanceof ArrayBuffer||Jl(t.data)))return e(pc(t.data));fa(t,!1,s=>{ui||(ui=new TextEncoder),e(ui.encode(s))})}const mc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Sr=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<mc.length;t++)Sr[mc.charCodeAt(t)]=t;const lp=t=>{let e=t.length*.75,s=t.length,r,o=0,i,c,l,f;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const h=new ArrayBuffer(e),a=new Uint8Array(h);for(r=0;r<s;r+=4)i=Sr[t.charCodeAt(r)],c=Sr[t.charCodeAt(r+1)],l=Sr[t.charCodeAt(r+2)],f=Sr[t.charCodeAt(r+3)],a[o++]=i<<2|c>>4,a[o++]=(c&15)<<4|l>>2,a[o++]=(l&3)<<6|f&63;return h},dp=typeof ArrayBuffer=="function",pa=(t,e)=>{if(typeof t!="string")return{type:"message",data:Ql(t,e)};const s=t.charAt(0);return s==="b"?{type:"message",data:up(t.substring(1),e)}:uo[s]?t.length>1?{type:uo[s],data:t.substring(1)}:{type:uo[s]}:Di},up=(t,e)=>{if(dp){const s=lp(t);return Ql(s,e)}else return{base64:!0,data:t}},Ql=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Xl="",hp=(t,e)=>{const s=t.length,r=new Array(s);let o=0;t.forEach((i,c)=>{fa(i,!1,l=>{r[c]=l,++o===s&&e(r.join(Xl))})})},fp=(t,e)=>{const s=t.split(Xl),r=[];for(let o=0;o<s.length;o++){const i=pa(s[o],e);if(r.push(i),i.type==="error")break}return r};function pp(){return new TransformStream({transform(t,e){cp(t,s=>{const r=s.length;let o;if(r<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,r);else if(r<65536){o=new Uint8Array(3);const i=new DataView(o.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{o=new Uint8Array(9);const i=new DataView(o.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(o[0]|=128),e.enqueue(o),e.enqueue(s)})}})}let hi;function Qr(t){return t.reduce((e,s)=>e+s.length,0)}function Xr(t,e){if(t[0].length===e)return t.shift();const s=new Uint8Array(e);let r=0;for(let o=0;o<e;o++)s[o]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),s}function mp(t,e){hi||(hi=new TextDecoder);const s=[];let r=0,o=-1,i=!1;return new TransformStream({transform(c,l){for(s.push(c);;){if(r===0){if(Qr(s)<1)break;const f=Xr(s,1);i=(f[0]&128)===128,o=f[0]&127,o<126?r=3:o===126?r=1:r=2}else if(r===1){if(Qr(s)<2)break;const f=Xr(s,2);o=new DataView(f.buffer,f.byteOffset,f.length).getUint16(0),r=3}else if(r===2){if(Qr(s)<8)break;const f=Xr(s,8),h=new DataView(f.buffer,f.byteOffset,f.length),a=h.getUint32(0);if(a>Math.pow(2,21)-1){l.enqueue(Di);break}o=a*Math.pow(2,32)+h.getUint32(4),r=3}else{if(Qr(s)<o)break;const f=Xr(s,o);l.enqueue(pa(i?f:hi.decode(f),e)),r=0}if(o===0||o>t){l.enqueue(Di);break}}}})}const Zl=4;function Wt(t){if(t)return gp(t)}function gp(t){for(var e in Wt.prototype)t[e]=Wt.prototype[e];return t}Wt.prototype.on=Wt.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};Wt.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this};Wt.prototype.off=Wt.prototype.removeListener=Wt.prototype.removeAllListeners=Wt.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+t];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,o=0;o<s.length;o++)if(r=s[o],r===e||r.fn===e){s.splice(o,1);break}return s.length===0&&delete this._callbacks["$"+t],this};Wt.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(s){s=s.slice(0);for(var r=0,o=s.length;r<o;++r)s[r].apply(this,e)}return this};Wt.prototype.emitReserved=Wt.prototype.emit;Wt.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};Wt.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Ro=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,s)=>s(e,0),js=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),yp="arraybuffer";function ed(t,...e){return e.reduce((s,r)=>(t.hasOwnProperty(r)&&(s[r]=t[r]),s),{})}const _p=js.setTimeout,vp=js.clearTimeout;function Lo(t,e){e.useNativeTimers?(t.setTimeoutFn=_p.bind(js),t.clearTimeoutFn=vp.bind(js)):(t.setTimeoutFn=js.setTimeout.bind(js),t.clearTimeoutFn=js.clearTimeout.bind(js))}const wp=1.33;function bp(t){return typeof t=="string"?xp(t):Math.ceil((t.byteLength||t.size)*wp)}function xp(t){let e=0,s=0;for(let r=0,o=t.length;r<o;r++)e=t.charCodeAt(r),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(r++,s+=4);return s}function td(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Sp(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}function Cp(t){let e={},s=t.split("&");for(let r=0,o=s.length;r<o;r++){let i=s[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class kp extends Error{constructor(e,s,r){super(e),this.description=s,this.context=r,this.type="TransportError"}}class ma extends Wt{constructor(e){super(),this.writable=!1,Lo(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,s,r){return super.emitReserved("error",new kp(e,s,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const s=pa(e,this.socket.binaryType);this.onPacket(s)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,s={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const s=Sp(e);return s.length?"?"+s:""}}class Np extends ma{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const s=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||s()})),this.writable||(r++,this.once("drain",function(){--r||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const s=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};fp(e,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,hp(e,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=td()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(e,s)}}let sd=!1;try{sd=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const jp=sd;function Tp(){}class Ep extends Np{constructor(e){if(super(e),typeof location<"u"){const s=location.protocol==="https:";let r=location.port;r||(r=s?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,s){const r=this.request({method:"POST",data:e});r.on("success",s),r.on("error",(o,i)=>{this.onError("xhr post error",o,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(s,r)=>{this.onError("xhr poll error",s,r)}),this.pollXhr=e}}let Gn=class ho extends Wt{constructor(e,s,r){super(),this.createRequest=e,Lo(this,r),this._opts=r,this._method=r.method||"GET",this._uri=s,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const s=ed(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(s);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var o;r.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=ho.requestsCount++,ho.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Tp,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ho.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Gn.requestsCount=0;Gn.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",gc);else if(typeof addEventListener=="function"){const t="onpagehide"in js?"pagehide":"unload";addEventListener(t,gc,!1)}}function gc(){for(let t in Gn.requests)Gn.requests.hasOwnProperty(t)&&Gn.requests[t].abort()}const Ap=function(){const t=nd({xdomain:!1});return t&&t.responseType!==null}();class Ip extends Ep{constructor(e){super(e);const s=e&&e.forceBase64;this.supportsBinary=Ap&&!s}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Gn(nd,this.uri(),e)}}function nd(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||jp))return new XMLHttpRequest}catch{}if(!e)try{return new js[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const rd=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class $p extends ma{get name(){return"websocket"}doOpen(){const e=this.uri(),s=this.opts.protocols,r=rd?{}:ed(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,s,r)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const r=e[s],o=s===e.length-1;fa(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{}o&&Ro(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=td()),this.supportsBinary||(s.b64=1),this.createUri(e,s)}}const fi=js.WebSocket||js.MozWebSocket;class Pp extends $p{createSocket(e,s,r){return rd?new fi(e,s,r):s?new fi(e,s):new fi(e)}doWrite(e,s){this.ws.send(s)}}class Rp extends ma{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const s=mp(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(s).getReader(),o=pp();o.readable.pipeTo(e.writable),this._writer=o.writable.getWriter();const i=()=>{r.read().then(({done:l,value:f})=>{l||(this.onPacket(f),i())}).catch(l=>{})};i();const c={type:"open"};this.query.sid&&(c.data=`{"sid":"${this.query.sid}"}`),this._writer.write(c).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const r=e[s],o=s===e.length-1;this._writer.write(r).then(()=>{o&&Ro(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Lp={websocket:Pp,webtransport:Rp,polling:Ip},Op=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Mp=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ui(t){if(t.length>8e3)throw"URI too long";const e=t,s=t.indexOf("["),r=t.indexOf("]");s!=-1&&r!=-1&&(t=t.substring(0,s)+t.substring(s,r).replace(/:/g,";")+t.substring(r,t.length));let o=Op.exec(t||""),i={},c=14;for(;c--;)i[Mp[c]]=o[c]||"";return s!=-1&&r!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Bp(i,i.path),i.queryKey=Fp(i,i.query),i}function Bp(t,e){const s=/\/{2,9}/g,r=e.replace(s,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Fp(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,o,i){o&&(s[o]=i)}),s}const qi=typeof addEventListener=="function"&&typeof removeEventListener=="function",fo=[];qi&&addEventListener("offline",()=>{fo.forEach(t=>t())},!1);class mn extends Wt{constructor(e,s){if(super(),this.binaryType=yp,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(s=e,e=null),e){const r=Ui(e);s.hostname=r.host,s.secure=r.protocol==="https"||r.protocol==="wss",s.port=r.port,r.query&&(s.query=r.query)}else s.host&&(s.hostname=Ui(s.host).host);Lo(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(r=>{const o=r.prototype.name;this.transports.push(o),this._transportsByName[o]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Cp(this.opts.query)),qi&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},fo.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=Zl,s.transport=e,this.id&&(s.sid=this.id);const r=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&mn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(e);s.open(),this.setTransport(s)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",mn.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=e.data,this._onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let r=0;r<this.writeBuffer.length;r++){const o=this.writeBuffer[r].data;if(o&&(s+=bp(o)),r>0&&s>this._maxPayload)return this.writeBuffer.slice(0,r);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Ro(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,s,r){return this._sendPacket("message",e,s,r),this}send(e,s,r){return this._sendPacket("message",e,s,r),this}_sendPacket(e,s,r,o){if(typeof s=="function"&&(o=s,s=void 0),typeof r=="function"&&(o=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:s,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),o&&this.once("flush",o),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},r=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(mn.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),qi&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=fo.indexOf(this._offlineEventListener);r!==-1&&fo.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this._prevBufferLen=0}}}mn.protocol=Zl;class Dp extends mn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let s=this.createTransport(e),r=!1;mn.priorWebsocketSuccess=!1;const o=()=>{r||(s.send([{type:"ping",data:"probe"}]),s.once("packet",p=>{if(!r)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;mn.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(a(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const _=new Error("probe error");_.transport=s.name,this.emitReserved("upgradeError",_)}}))};function i(){r||(r=!0,a(),s.close(),s=null)}const c=p=>{const _=new Error("probe error: "+p);_.transport=s.name,i(),this.emitReserved("upgradeError",_)};function l(){c("transport closed")}function f(){c("socket closed")}function h(p){s&&p.name!==s.name&&i()}const a=()=>{s.removeListener("open",o),s.removeListener("error",c),s.removeListener("close",l),this.off("close",f),this.off("upgrading",h)};s.once("open",o),s.once("error",c),s.once("close",l),this.once("close",f),this.once("upgrading",h),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||s.open()},200):s.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const s=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&s.push(e[r]);return s}}let Up=class extends Dp{constructor(e,s={}){const r=typeof e=="object"?e:s;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(o=>Lp[o]).filter(o=>!!o)),super(e,r)}};function qp(t,e="",s){let r=t;s=s||typeof location<"u"&&location,t==null&&(t=s.protocol+"//"+s.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=s.protocol+t:t=s.host+t),/^(https?|wss?):\/\//.test(t)||(typeof s<"u"?t=s.protocol+"//"+t:t="https://"+t),r=Ui(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(s&&s.port===r.port?"":":"+r.port),r}const zp=typeof ArrayBuffer=="function",Hp=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,od=Object.prototype.toString,Vp=typeof Blob=="function"||typeof Blob<"u"&&od.call(Blob)==="[object BlobConstructor]",Wp=typeof File=="function"||typeof File<"u"&&od.call(File)==="[object FileConstructor]";function ga(t){return zp&&(t instanceof ArrayBuffer||Hp(t))||Vp&&t instanceof Blob||Wp&&t instanceof File}function po(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let s=0,r=t.length;s<r;s++)if(po(t[s]))return!0;return!1}if(ga(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return po(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&po(t[s]))return!0;return!1}function Gp(t){const e=[],s=t.data,r=t;return r.data=zi(s,e),r.attachments=e.length,{packet:r,buffers:e}}function zi(t,e){if(!t)return t;if(ga(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}else if(Array.isArray(t)){const s=new Array(t.length);for(let r=0;r<t.length;r++)s[r]=zi(t[r],e);return s}else if(typeof t=="object"&&!(t instanceof Date)){const s={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=zi(t[r],e));return s}return t}function Yp(t,e){return t.data=Hi(t.data,e),delete t.attachments,t}function Hi(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=Hi(t[s],e);else if(typeof t=="object")for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=Hi(t[s],e));return t}const Kp=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Jp=5;var kt;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(kt||(kt={}));class Qp{constructor(e){this.replacer=e}encode(e){return(e.type===kt.EVENT||e.type===kt.ACK)&&po(e)?this.encodeAsBinary({type:e.type===kt.EVENT?kt.BINARY_EVENT:kt.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let s=""+e.type;return(e.type===kt.BINARY_EVENT||e.type===kt.BINARY_ACK)&&(s+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(s+=e.nsp+","),e.id!=null&&(s+=e.id),e.data!=null&&(s+=JSON.stringify(e.data,this.replacer)),s}encodeAsBinary(e){const s=Gp(e),r=this.encodeAsString(s.packet),o=s.buffers;return o.unshift(r),o}}function yc(t){return Object.prototype.toString.call(t)==="[object Object]"}class ya extends Wt{constructor(e){super(),this.reviver=e}add(e){let s;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(e);const r=s.type===kt.BINARY_EVENT;r||s.type===kt.BINARY_ACK?(s.type=r?kt.EVENT:kt.ACK,this.reconstructor=new Xp(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(ga(e)||e.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(e),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let s=0;const r={type:Number(e.charAt(0))};if(kt[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===kt.BINARY_EVENT||r.type===kt.BINARY_ACK){const i=s+1;for(;e.charAt(++s)!=="-"&&s!=e.length;);const c=e.substring(i,s);if(c!=Number(c)||e.charAt(s)!=="-")throw new Error("Illegal attachments");r.attachments=Number(c)}if(e.charAt(s+1)==="/"){const i=s+1;for(;++s&&!(e.charAt(s)===","||s===e.length););r.nsp=e.substring(i,s)}else r.nsp="/";const o=e.charAt(s+1);if(o!==""&&Number(o)==o){const i=s+1;for(;++s;){const c=e.charAt(s);if(c==null||Number(c)!=c){--s;break}if(s===e.length)break}r.id=Number(e.substring(i,s+1))}if(e.charAt(++s)){const i=this.tryParse(e.substr(s));if(ya.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,s){switch(e){case kt.CONNECT:return yc(s);case kt.DISCONNECT:return s===void 0;case kt.CONNECT_ERROR:return typeof s=="string"||yc(s);case kt.EVENT:case kt.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&Kp.indexOf(s[0])===-1);case kt.ACK:case kt.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Xp{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const s=Yp(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Zp=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ya,Encoder:Qp,get PacketType(){return kt},protocol:Jp},Symbol.toStringTag,{value:"Module"}));function Ls(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const em=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class id extends Wt{constructor(e,s,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=s,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ls(e,"open",this.onopen.bind(this)),Ls(e,"packet",this.onpacket.bind(this)),Ls(e,"error",this.onerror.bind(this)),Ls(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...s){var r,o,i;if(em.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const c={type:kt.EVENT,data:s};if(c.options={},c.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const a=this.ids++,p=s.pop();this._registerAckCallback(a,p),c.id=a}const l=(o=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||o===void 0?void 0:o.writable,f=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!l||(f?(this.notifyOutgoingListeners(c),this.packet(c)):this.sendBuffer.push(c)),this.flags={},this}_registerAckCallback(e,s){var r;const o=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(o===void 0){this.acks[e]=s;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&this.sendBuffer.splice(l,1);s.call(this,new Error("operation has timed out"))},o),c=(...l)=>{this.io.clearTimeoutFn(i),s.apply(this,l)};c.withError=!0,this.acks[e]=c}emitWithAck(e,...s){return new Promise((r,o)=>{const i=(c,l)=>c?o(c):r(l);i.withError=!0,s.push(i),this.emit(e,...s)})}_addToQueue(e){let s;typeof e[e.length-1]=="function"&&(s=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((o,...i)=>r!==this._queue[0]?void 0:(o!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(o)):(this._queue.shift(),s&&s(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!e||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:kt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case kt.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case kt.EVENT:case kt.BINARY_EVENT:this.onevent(e);break;case kt.ACK:case kt.BINARY_ACK:this.onack(e);break;case kt.DISCONNECT:this.ondisconnect();break;case kt.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const s=e.data||[];e.id!=null&&s.push(this.ack(e.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const r of s)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const s=this;let r=!1;return function(...o){r||(r=!0,s.packet({type:kt.ACK,id:e,data:o}))}}onack(e){const s=this.acks[e.id];typeof s=="function"&&(delete this.acks[e.id],s.withError&&e.data.unshift(null),s.apply(this,e.data))}onconnect(e,s){this.id=e,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:kt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const s=this._anyListeners;for(let r=0;r<s.length;r++)if(e===s[r])return s.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const s=this._anyOutgoingListeners;for(let r=0;r<s.length;r++)if(e===s[r])return s.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const r of s)r.apply(this,e.data)}}}function Zn(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Zn.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-s:t+s}return Math.min(t,this.max)|0};Zn.prototype.reset=function(){this.attempts=0};Zn.prototype.setMin=function(t){this.ms=t};Zn.prototype.setMax=function(t){this.max=t};Zn.prototype.setJitter=function(t){this.jitter=t};class Vi extends Wt{constructor(e,s){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(s=e,e=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,Lo(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((r=s.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Zn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=e;const o=s.parser||Zp;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var s;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(s=this.backoff)===null||s===void 0||s.setMin(e),this)}randomizationFactor(e){var s;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(s=this.backoff)===null||s===void 0||s.setJitter(e),this)}reconnectionDelayMax(e){var s;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(s=this.backoff)===null||s===void 0||s.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Up(this.uri,this.opts);const s=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const o=Ls(s,"open",function(){r.onopen(),e&&e()}),i=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},c=Ls(s,"error",i);if(this._timeout!==!1){const l=this._timeout,f=this.setTimeoutFn(()=>{o(),i(new Error("timeout")),s.close()},l);this.opts.autoUnref&&f.unref(),this.subs.push(()=>{this.clearTimeoutFn(f)})}return this.subs.push(o),this.subs.push(c),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ls(e,"ping",this.onping.bind(this)),Ls(e,"data",this.ondata.bind(this)),Ls(e,"error",this.onerror.bind(this)),Ls(e,"close",this.onclose.bind(this)),Ls(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(s){this.onclose("parse error",s)}}ondecoded(e){Ro(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,s){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new id(this,e,s),this.nsps[e]=r),r}_destroy(e){const s=Object.keys(this.nsps);for(const r of s)if(this.nsps[r].active)return;this._close()}_packet(e){const s=this.encoder.encode(e);for(let r=0;r<s.length;r++)this.engine.write(s[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,s){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(o=>{o?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",o)):e.onreconnect()}))},s);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const gr={};function mo(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const s=qp(t,e.path||"/socket.io"),r=s.source,o=s.id,i=s.path,c=gr[o]&&i in gr[o].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||c;let f;return l?f=new Vi(r,e):(gr[o]||(gr[o]=new Vi(r,e)),f=gr[o]),s.query&&!e.query&&(e.query=s.queryKey),f.socket(s.path,e)}Object.assign(mo,{Manager:Vi,Socket:id,io:mo,connect:mo});const Be=De.create("SocketClient");class tm{constructor(){this.socket=null,this.connected=!1,this.reconnecting=!1,this.userId=null,this.pendingMessages=[],this.eventHandlers={},this.connectionAttempts=0,this.maxReconnectAttempts=xt.RECONNECT.MAX_ATTEMPTS,this.reconnectDelay=xt.RECONNECT.DELAY,this.heartbeatInterval=null,this.lastPong=null,this.notificationSyncChannel=null,this.connectionMonitorInterval=null,this.notificationEventTypes=xt.NOTIFICATION.SYNC_EVENT_TYPES}init(e,s,r={}){if(this.socket&&this.connected)return Be.info("Socket already connected"),this.socket;this.userId=e;let o;o=window.location.origin,Be.info(`Using current origin for socket connection: ${o}`),Be.info(`Connecting to socket server at ${o}`);try{return this.socket=mo(o,{query:{token:s},auth:{token:s,userId:e},reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,reconnectionDelayMax:xt.RECONNECT.DELAY_MAX,timeout:xt.CONNECTION.TIMEOUT,path:"/socket.io/",transports:["polling","websocket"],autoConnect:!0,forceNew:!0,withCredentials:!0,extraHeaders:{},rejectUnauthorized:!1,secure:window.location.protocol==="https:",upgrade:!0}),this._setupSocketHandlers(),this.setupNotificationSyncChannel(),this.startConnectionMonitoring(),this.socket}catch(i){throw Be.error("Socket initialization error:",i),i}}isConnected(){return this.socket&&this.connected}_setupSocketHandlers(){this.socket&&(this.socket.on("connect",()=>{Be.info("Socket connected successfully"),this.connected=!0,this.connectionAttempts=0,this._startHeartbeat(),this._processPendingMessages(),this._notifyEventHandlers(xt.EVENTS.SOCKET_CONNECTED,{userId:this.userId,socketId:this.socket.id}),window.dispatchEvent(new CustomEvent(xt.EVENTS.SOCKET_CONNECTED,{detail:{userId:this.userId,socketId:this.socket.id}}))}),this.socket.on("connect_error",e=>{var s,r,o,i,c,l,f,h,a,p,_,N;Be.error("Socket connection error:",e),this.connected=!1,this.connectionAttempts++,Be.error("Socket connection error details:",{message:e.message||"Unknown error",type:e.type||"Unknown type",transport:((o=(r=(s=this.socket.io)==null?void 0:s.engine)==null?void 0:r.transport)==null?void 0:o.name)||"Unknown transport",attempts:this.connectionAttempts,url:((i=this.socket.io)==null?void 0:i.uri)||"Unknown URL"}),this.connectionAttempts>2&&((c=e.message)!=null&&c.includes("websocket")||((h=(f=(l=this.socket.io)==null?void 0:l.engine)==null?void 0:f.transport)==null?void 0:h.name)==="websocket")&&(Be.warn("Switching to polling transport after WebSocket failures"),(a=this.socket.io)!=null&&a.opts&&(this.socket.io.opts.transports=xt.TRANSPORT.FALLBACK,Be.info("Forced polling-only transport mode"))),this.connectionAttempts>=this.maxReconnectAttempts&&(this._notifyEventHandlers(xt.EVENTS.SOCKET_CONNECTION_FAILED,{error:e.message,attempts:this.connectionAttempts}),this.connectionAttempts===this.maxReconnectAttempts&&H.error("Failed to connect to the chat server.",{autoClose:5e3})),window.dispatchEvent(new CustomEvent("socketConnectionError",{detail:{error:e.message,attempts:this.connectionAttempts,transport:((N=(_=(p=this.socket.io)==null?void 0:p.engine)==null?void 0:_.transport)==null?void 0:N.name)||"unknown"}}))}),this.socket.on("disconnect",e=>{Be.info(`Socket disconnected: ${e}`),this.connected=!1,this._stopHeartbeat(),this._notifyEventHandlers(xt.EVENTS.SOCKET_DISCONNECTED,{reason:e}),window.dispatchEvent(new CustomEvent(xt.EVENTS.SOCKET_DISCONNECTED,{detail:{reason:e}})),(e==="io server disconnect"||e==="transport close")&&this.enhancedReconnect()}),this.socket.on("reconnect",e=>{Be.info(`Socket reconnected after ${e} attempts`),this.connected=!0,this.reconnecting=!1,this._notifyEventHandlers(xt.EVENTS.SOCKET_RECONNECTED,{userId:this.userId,attempts:e}),window.dispatchEvent(new CustomEvent(xt.EVENTS.SOCKET_RECONNECTED,{detail:{userId:this.userId,attempts:e}}))}),this.socket.on("reconnect_attempt",e=>{Be.debug(`Socket reconnect attempt ${e}`),this.reconnecting=!0}),this.socket.on("reconnect_error",e=>{Be.error("Socket reconnection error:",e)}),this.socket.on("reconnect_failed",()=>{Be.error("Socket reconnection failed"),this.reconnecting=!1,H.error("Failed to reconnect to the chat server. Please reload the page."),this._notifyEventHandlers(xt.EVENTS.SOCKET_RECONNECT_FAILED,{userId:this.userId}),window.dispatchEvent(new CustomEvent(xt.EVENTS.SOCKET_RECONNECT_FAILED,{detail:{userId:this.userId}}))}),this.socket.on("welcome",e=>{Be.debug("Socket welcome message received:",e)}),this.socket.on("pong",()=>{this.lastPong=Date.now()}),this.socket.on("error",e=>{Be.error("Socket server error:",e),H.error(`Server error: ${e.message||"Unknown error"}`)}),this.socket.on("auth_error",e=>{Be.error("Socket authentication error:",e),H.error("Authentication failed. Please log in again."),window.dispatchEvent(new CustomEvent("authLogout"))}),this._registerEnhancedEventForwarder("messageReceived"),this._registerEnhancedEventForwarder("messageSent"),this._registerEnhancedEventForwarder("messageError"),this._registerEnhancedEventForwarder("userTyping"),this._registerEnhancedEventForwarder("videoSignal"),this._registerEnhancedEventForwarder("videoHangup"),this._registerEnhancedEventForwarder("videoError"),this._registerEnhancedEventForwarder("videoMediaControl"),this._registerEnhancedEventForwarder("incomingCall"),this._registerEnhancedEventForwarder("callAnswered"),this._registerEnhancedEventForwarder("callInitiated"),this._registerEnhancedEventForwarder("callError"),this._registerEnhancedEventForwarder("userOnline"),this._registerEnhancedEventForwarder("userOffline"),this._registerEnhancedEventForwarder("notification"),this._registerEnhancedEventForwarder("newLike"),this._registerEnhancedEventForwarder("photoPermissionRequestReceived"),this._registerEnhancedEventForwarder("photoPermissionResponseReceived"),this._registerEnhancedEventForwarder("newComment"),this._registerEnhancedEventForwarder("newStory"))}_registerEnhancedEventForwarder(e){this._eventDeduplicationMap||(this._eventDeduplicationMap=new Map),this._eventDeduplicationMap.has(e)||this._eventDeduplicationMap.set(e,new Map);const s=i=>{var c;return i?e==="messageReceived"||e==="messageSent"?`${i._id||i.tempId||""}|${i.sender||""}|${i.recipient||""}`:e.includes("photoPermission")?`${i.permissionId||i.requestId||""}|${i.status||""}`:e==="notification"||e==="newLike"?`${i.type||""}|${((c=i.sender)==null?void 0:c._id)||i.sender||""}|${i.timestamp||Date.now()}`:`${JSON.stringify(i).substring(0,100)}|${Date.now().toString().substring(0,10)}`:""},r=i=>{const c=this._eventDeduplicationMap.get(e);if(!c)return!1;if(i&&(i._id||i.id||i.tempId)){const f=i._id||i.id||i.tempId;if(c.has(f)){const h=c.get(f);if(Date.now()-h<5e3)return!0}}const l=s(i);if(l&&c.has(`hash:${l}`)){const f=c.get(`hash:${l}`);if(Date.now()-f<5e3)return!0}return!1},o=i=>{const c=this._eventDeduplicationMap.get(e);if(!c)return;const l=Date.now();if(i&&(i._id||i.id||i.tempId)){const h=i._id||i.id||i.tempId;c.set(h,l)}const f=s(i);f&&c.set(`hash:${f}`,l),Math.random()<.1&&this._cleanupDeduplicationMaps()};this.socket.on(e,i=>{if(r(i)){Be.debug(`Skipping duplicate ${e} event`,(i==null?void 0:i._id)||(i==null?void 0:i.id)||"");return}if(o(i),this._notifyEventHandlers(e,i),this.notificationEventTypes.includes(e)&&(window.dispatchEvent(new CustomEvent(e,{detail:i})),window.dispatchEvent(new CustomEvent("notification",{detail:i})),this.notificationSyncChannel))try{this.notificationSyncChannel.postMessage({type:xt.NOTIFICATION.SYNC_ACTIONS.NEW_NOTIFICATION,data:i})}catch(c){Be.error("Error syncing notification to other tabs:",c)}})}setupNotificationSyncChannel(){if(typeof BroadcastChannel>"u")return Be.warn("BroadcastChannel not supported, cross-tab sync disabled"),null;try{return this.notificationSyncChannel=new BroadcastChannel(xt.NOTIFICATION.SYNC_CHANNEL_NAME),this.notificationSyncChannel.onmessage=e=>{const{type:s,data:r}=e.data;s===xt.NOTIFICATION.SYNC_ACTIONS.NEW_NOTIFICATION?(Be.debug("Received new notification from another tab"),window.dispatchEvent(new CustomEvent("newNotification",{detail:r}))):s===xt.NOTIFICATION.SYNC_ACTIONS.MARK_READ?(Be.debug("Received mark-read event from another tab"),window.dispatchEvent(new CustomEvent("notificationRead",{detail:r}))):s===xt.NOTIFICATION.SYNC_ACTIONS.MARK_ALL_READ&&(Be.debug("Received mark-all-read event from another tab"),window.dispatchEvent(new CustomEvent("allNotificationsRead")))},Be.info("Notification sync channel initialized"),this.notificationSyncChannel}catch(e){return Be.error("Error setting up notification sync channel:",e),this.notificationSyncChannel=null,null}}_startHeartbeat(){this._stopHeartbeat(),this.lastPong=Date.now(),this.heartbeatInterval=setInterval(()=>{if(this.socket&&this.connected){this.socket.emit("ping");const e=Date.now();this.lastPong&&e-this.lastPong>xt.CONNECTION.HEARTBEAT_TIMEOUT&&(Be.warn(`No heartbeat response in ${xt.CONNECTION.HEARTBEAT_TIMEOUT/1e3} seconds, reconnecting...`),this.enhancedReconnect())}},xt.CONNECTION.HEARTBEAT_INTERVAL)}_stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}startConnectionMonitoring(){this.stopConnectionMonitoring(),this.connectionMonitorInterval=setInterval(()=>{this.checkSocketHealthForNotifications()},xt.CONNECTION.MONITOR_INTERVAL),Be.info("Notification connection monitoring started")}stopConnectionMonitoring(){this.connectionMonitorInterval&&(clearInterval(this.connectionMonitorInterval),this.connectionMonitorInterval=null)}checkSocketHealthForNotifications(){if(!this.userId||!this.socket)return!1;const e=Date.now(),s=this.lastPong||0,r=e-s;return Be.debug(`Socket health check - Connected: ${this.connected}, Time since last heartbeat: ${r/1e3}s`),!this.socket||typeof this.socket.emit!="function"?(Be.warn("Invalid socket object, attempting to reconnect..."),this.enhancedReconnect(),!1):r>xt.CONNECTION.HEARTBEAT_TIMEOUT?(Be.warn(`No socket response in the last ${xt.CONNECTION.HEARTBEAT_TIMEOUT/1e3} seconds, reconnecting for notifications...`),this.enhancedReconnect(),!1):this.connected?!0:(Be.warn("Socket appears disconnected, reconnecting for notifications..."),this.enhancedReconnect(),!1)}_processPendingMessages(){if(!this.connected||this.pendingMessages.length===0)return;Be.info(`Processing ${this.pendingMessages.length} pending messages`);const e=[...this.pendingMessages];this.pendingMessages=[],e.forEach(s=>{this.emit(s.event,s.data)})}on(e,s){const r=(...i)=>s(...i);r._originalCallback=s,r._id=Math.random().toString(36).substr(2,9),this.eventHandlers[e]||(this.eventHandlers[e]=[]);const o=this.eventHandlers[e].find(i=>i._originalCallback===s||i===s);return o?(Be.debug(`Preventing duplicate handler for ${e} event`),()=>this.off(e,o)):(this.eventHandlers[e].push(r),this.socket&&this.socket.on(e,r),()=>this.off(e,r))}off(e,s){this.socket&&this.socket.off(e,s),this.eventHandlers[e]&&(this.eventHandlers[e]=this.eventHandlers[e].filter(r=>!(r===s||r._originalCallback===s||s._originalCallback&&r._originalCallback&&s._originalCallback===r._originalCallback)),this.eventHandlers[e].length===0&&delete this.eventHandlers[e])}_notifyEventHandlers(e,s){this.eventHandlers[e]&&this.eventHandlers[e].forEach(r=>{try{r(s)}catch(o){Be.error(`Error in ${e} handler:`,o)}})}_cleanupDeduplicationMaps(){if(!this._eventDeduplicationMap)return;const s=Date.now()-3e4;for(const[r,o]of this._eventDeduplicationMap.entries())for(const[i,c]of o.entries())c<s&&o.delete(i);if(Math.random()<.1){let r=0;for(const o of this._eventDeduplicationMap.values())r+=o.size;Be.debug(`Cleaned up event deduplication maps, current size: ${r} entries`)}}emit(e,s={}){if(!this.socket)return Be.warn(`Socket not initialized, cannot emit '${e}'`),!1;if(!this.connected){if(Be.info(`Socket not connected, queueing '${e}'`),this.pendingMessages.length<100)this.pendingMessages.push({event:e,data:s});else{const r=["message","videoSignal","notification"];if(r.includes(e)){const o=this.pendingMessages.findIndex(i=>!r.includes(i.event));o!==-1&&(this.pendingMessages.splice(o,1),this.pendingMessages.push({event:e,data:s}))}Be.warn("Pending message queue full, dropping non-priority messages")}return!0}try{if(e==="typing"){const r=Date.now();(!this._lastTypingEvent||r-this._lastTypingEvent>2e3)&&(this._lastTypingEvent=r,this.socket.emit(e,s))}else this.socket.emit(e,s);return!0}catch(r){return Be.error(`Error emitting '${e}':`,r),!1}}enhancedReconnect(){if(this.reconnecting){Be.info("Already attempting reconnection, skipping duplicate request");return}if(Be.info("Forcing socket reconnection with notification support..."),this.reconnecting=!0,this.socket)try{this.socket.disconnect(),this.socket.close()}catch(e){Be.error("Error closing socket:",e)}if(this._stopHeartbeat(),this.userId){const e=ls();if(e){const s=xt.CONNECTION.RECONNECT_DELAY_MIN+Math.random()*(xt.CONNECTION.RECONNECT_DELAY_MAX-xt.CONNECTION.RECONNECT_DELAY_MIN);Be.debug(`Scheduling reconnection in ${Math.round(s)}ms`),setTimeout(()=>{try{const r=ls();if(r!==e&&Be.info("Token changed since reconnection attempt started, using fresh token"),!navigator.onLine){Be.warn("Browser is offline, waiting for connection to return");const c=()=>{Be.info("Browser back online, attempting reconnection"),window.removeEventListener("online",c),setTimeout(()=>{this.reconnecting=!1,this.enhancedReconnect()},xt.CONNECTION.ONLINE_RECONNECT_DELAY)};window.addEventListener("online",c,{once:!0}),this.reconnecting=!1;return}const i=!1?xt.URLS.DEV:xt.URLS.PROD;Be.info("Initializing socket with fresh token"),this.init(this.userId,r||e,{transportOptions:{websocket:{}}}),window.dispatchEvent(new CustomEvent(xt.EVENTS.NOTIFICATION_SOCKET_RECONNECTED)),Be.info("Socket reconnected with notification support")}catch(r){if(Be.error("Socket reconnection failed:",r),r.message&&(r.message.includes("websocket")||r.message.includes("WebSocket"))){Be.warn("WebSocket error detected, trying fallback to polling transport only");try{const i=xt.URLS.PROD;this.init(this.userId,e,{transports:xt.TRANSPORT.FALLBACK,autoConnect:!0}),Be.info("Fallback to polling transport initiated")}catch(o){Be.error("Polling fallback also failed:",o)}}if(r.message&&(r.message.includes("auth")||r.message.includes("token"))){Be.warn("Authentication error detected, trying emergency session reset"),setTimeout(()=>{try{typeof window.fixMyUserId=="function"?window.fixMyUserId():this._attemptTokenRefresh().catch(()=>{Be.warn("Performing emergency session reset"),Ae.logout(),window.location.reload()})}catch(o){Be.error("Emergency recovery failed:",o),this.reconnecting=!1}},2e3);return}}finally{this.reconnecting=!1}},s)}else Be.error("Cannot reconnect: No authentication token found"),this.reconnecting=!1}else Be.error("Cannot reconnect: No user ID"),this.reconnecting=!1}_attemptTokenRefresh(){return new Promise((e,s)=>{Be.info("Attempting to refresh authentication token"),Ae.post("/auth/refresh-token",{}).then(r=>{if(r.token)Be.info("Token refresh successful"),kr(r.token,!0),this.reconnecting=!1,this.enhancedReconnect(),e();else throw new Error("No token in response")}).catch(r=>{Be.error("Token refresh failed:",r),s(r)})})}reconnect(){this.enhancedReconnect()}disconnect(){if(Be.info("Disconnecting socket"),this._stopHeartbeat(),this.stopConnectionMonitoring(),this.notificationSyncChannel)try{this.notificationSyncChannel.close(),this.notificationSyncChannel=null}catch(e){Be.error("Error closing notification sync channel:",e)}if(this.socket){try{this.socket.disconnect()}catch(e){Be.error("Error disconnecting socket:",e)}this.socket=null}this.connected=!1,this.reconnecting=!1}}const Zs=new tm,pi=De.create("SocketService");class sm{constructor(){this.socket=Zs,this.initialized=!1,this.showConnectionToasts=!0,this.debugMode=!1,this.eventListeners=new Map,this.pendingMessages=[],this.userId=null,this.connectionState="disconnected",this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.connectionMonitor=null}init(e,s,r={}){if(this.initialized&&this.socket.isConnected()&&this.userId===e)return this._log("Socket service already initialized and connected"),this.socket;this._clearConnectionMonitor(),this._log(`Initializing socket service for user: ${e}`),this.userId=e,this.reconnectAttempts=0;try{return r.serverUrl="https://flirtss.com",r.rejectUnauthorized=!1,r.secure=!0,r.upgrade=!0,this.socket.init(e,s,r),this.initialized=!0,this.connectionState="connecting",this.socket.on("connect",()=>{this._log("Socket connection established"),this.connectionState="connected",this.reconnectAttempts=0,this._processPendingMessages(),window.dispatchEvent(new CustomEvent("socketReconnected"))}),this.socket.on("disconnect",i=>{this._log(`Socket disconnected: ${i}`),this.connectionState="disconnected",this._startConnectionMonitor()}),this.socket.on("connect_error",i=>{this._log(`Socket connection error: ${i}`),this.connectionState="error",this._startConnectionMonitor()}),this._startConnectionMonitor(),this.socket}catch(o){throw this._log(`Socket initialization error: ${o.message}`,"error"),this.connectionState="error",o}}_startConnectionMonitor(){this.connectionMonitor||(this._log("Starting socket connection monitor"),this.connectionMonitor=setInterval(()=>{this.initialized&&this.connectionState!=="connected"&&this.reconnectAttempts<this.maxReconnectAttempts&&this.connectionState!=="reconnecting"&&(this._log(`Connection monitor: Socket is ${this.connectionState}, attempting reconnect`),this.reconnect())},15e3))}_clearConnectionMonitor(){this.connectionMonitor&&(clearInterval(this.connectionMonitor),this.connectionMonitor=null,this._log("Cleared socket connection monitor"))}isConnected(){return this.socket&&this.socket.isConnected()}reconnect(){if(this.connectionState==="connected")return this._log("Socket already connected, no need to reconnect"),this.reconnectAttempts=0,!0;if(this.reconnectAttempts>=this.maxReconnectAttempts)return this._log(`Maximum reconnect attempts (${this.maxReconnectAttempts}) reached, stopping reconnection attempts`,"warn"),setTimeout(()=>{this._log("Reconnect cooldown completed, resetting counter"),this.reconnectAttempts=0},3e4),!1;this.reconnectAttempts++,this._log(`Forcing socket reconnection (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connectionState="reconnecting";try{return this.socket&&typeof this.socket.reconnect=="function"?this.socket.reconnect():(this._log("Socket not initialized, cannot reconnect","warn"),!1)}catch(e){return this._log(`Reconnection error: ${e.message}`,"error"),!1}}disconnect(){return this._log("Disconnecting socket"),this._clearConnectionMonitor(),this.initialized=!1,this.connectionState="disconnected",this.pendingMessages=[],this.savedListeners=Array.from(this.eventListeners.entries()),this.eventListeners.clear(),this.socket.disconnect()}on(e,s){if(!s||typeof s!="function")return this._log(`Invalid callback for event: ${e}`,"error"),()=>{};this._log(`Registering listener for event: ${e}`),this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(s);let r;try{r=this.socket.on(e,s)}catch(o){this._log(`Error registering event listener for ${e}: ${o.message}`,"error"),r=()=>{}}return()=>{this.eventListeners.has(e)&&(this.eventListeners.get(e).delete(s),this.eventListeners.get(e).size===0&&this.eventListeners.delete(e));try{r()}catch(o){this._log(`Error unsubscribing from event ${e}: ${o.message}`,"error")}}}off(e,s){this._log(`Removing listener for event: ${e}`);try{this.socket.off(e,s)}catch(r){this._log(`Error removing event listener for ${e}: ${r.message}`,"error")}this.eventListeners.has(e)&&s?(this.eventListeners.get(e).delete(s),this.eventListeners.get(e).size===0&&this.eventListeners.delete(e)):this.eventListeners.has(e)&&!s&&this.eventListeners.delete(e)}emit(e,s={}){if(!this.socket)return this._log(`Socket not initialized, cannot emit '${e}'`,"warn"),!1;if(!this.isConnected())return this._log(`Socket not connected, queueing '${e}'`,"warn"),this.pendingMessages.push({event:e,data:s,timestamp:Date.now()}),!0;try{return this._log(`Emitting event: ${e}`),this.socket.emit(e,s),!0}catch(r){return this._log(`Error emitting '${e}': ${r.message}`,"error"),["sendMessage","messageRead","answerCall"].includes(e)&&(this._log(`Adding failed '${e}' to pending queue for retry`,"warn"),this.pendingMessages.push({event:e,data:s,timestamp:Date.now()})),!1}}async sendMessage(e,s="text",r,o={}){return this._log(`Attempting to send ${s} message to ${e}`),new Promise((i,c)=>{const l=`temp-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,f={current:null};let h=!1;if(!this.isConnected()){this._log(`Socket not connected, returning pending message with id ${l}`);const C={_id:l,sender:this.userId,recipient:e,type:s,content:r,metadata:{...o,clientMessageId:l},createdAt:new Date().toISOString(),read:!1,pending:!0,status:"pending",tempMessageId:l};return this.pendingMessages.push({event:"sendMessage",data:{recipientId:e,type:s,content:r,metadata:{...o,clientMessageId:l},tempMessageId:l},timestamp:Date.now()}),i(C)}const a=()=>{h||(h=!0,this.socket.off("messageSent",p),this.socket.off("messageError",_),f.current&&(clearTimeout(f.current),f.current=null))},p=C=>{C&&C.tempMessageId===l&&(this._log(`Message confirmed sent: ${l}`),a(),i(C))},_=C=>{C&&C.tempMessageId===l&&(this._log(`Message error for ${l}: ${C.error||"Unknown error"}`,"error"),a(),c(new Error(C.error||"Failed to send message")))};this.socket.on("messageSent",p),this.socket.on("messageError",_);const N={...o,clientMessageId:l};if(this._log(`Emitting sendMessage with tempId: ${l}`),!this.socket.emit("sendMessage",{recipientId:e,type:s,content:r,metadata:N,tempMessageId:l})){this._log(`Message emission failed immediately for ${l}`,"error"),a(),i({_id:l,sender:this.userId,recipient:e,content:r,type:s,metadata:N,createdAt:new Date().toISOString(),read:!1,status:"pending",pending:!0,tempMessageId:l});return}f.current=setTimeout(()=>{h||(this._log(`Message timeout reached for ${l}`,"warn"),a(),i({_id:l,sender:this.userId,recipient:e,content:r,type:s,metadata:N,createdAt:new Date().toISOString(),read:!1,status:"pending",pending:!0,tempMessageId:l}))},1e4)})}sendTyping(e){this.isConnected()&&this.socket.emit("typing",{recipientId:e})}_processPendingMessages(){if(this.pendingMessages.length===0)return;this._log(`Processing ${this.pendingMessages.length} pending messages`);const e=[...this.pendingMessages];this.pendingMessages=[],e.forEach((s,r)=>{setTimeout(()=>{if(Date.now()-s.timestamp>3e5){this._log(`Skipping stale pending message of type ${s.event}`,"warn");return}this._log(`Processing queued message: ${s.event}`),this.emit(s.event,s.data)},r*100)})}initiateVideoCall(e){return this._log(`Initiating video call to ${e}`),new Promise((s,r)=>{if(!this.isConnected())return this._log("Socket not connected, cannot initiate call","error"),r(new Error("Socket not connected"));const o={callId:`call-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,recipientId:e,callType:"video",userId:this.userId,caller:{userId:this.userId,name:localStorage.getItem("userNickname")||"User"},timestamp:Date.now()},i=l=>{this._log(`Call initiated successfully: ${l.callId||"unknown"}`),this.socket.off("callInitiated",i),this.socket.off("callError",c),s(l)},c=l=>{this._log(`Call initiation error: ${l.message||"unknown"}`,"error"),this.socket.off("callInitiated",i),this.socket.off("callError",c),r(new Error(l.message||"Failed to initiate call"))};this.socket.on("callInitiated",i),this.socket.on("callError",c),this.socket.emit("initiateCall",o),setTimeout(()=>{this._log("Call initiation timeout reached","warn"),this.socket.off("callInitiated",i),this.socket.off("callError",c),s({success:!0,callId:o.callId})},5e3)})}answerVideoCall(e,s,r){if(this._log(`Answering call from ${e} with accept=${s}`),!this.isConnected())return this._log("Cannot answer call: Socket not connected","error"),!1;let o=0;const i=3,c=()=>{o++;const l=this.socket.emit("answerCall",{callerId:e,accept:s,callId:r,userId:this.userId,timestamp:Date.now()});return!l&&o<i&&(this._log(`Retrying call answer (attempt ${o})`,"warn"),setTimeout(c,1e3)),l};return c()}getStatus(){return{connected:this.isConnected(),initialized:this.initialized,userId:this.userId,state:this.connectionState,reconnectAttempts:this.reconnectAttempts,pendingMessages:this.pendingMessages.length}}setShowConnectionToasts(e){this.showConnectionToasts=e}updatePrivacySettings(e){e&&(this.privacySettings=e,e.showOnlineStatus!==void 0&&(this._log(`Updating online status visibility: ${e.showOnlineStatus}`),this.isConnected()&&this.socket.emit("updatePrivacySettings",{showOnlineStatus:e.showOnlineStatus})),this._log(`Privacy settings updated: ${JSON.stringify(e)}`))}setDebugMode(e){this.debugMode=e}_log(e,s="log"){if(!(!this.debugMode&&s==="log"))switch(s){case"warn":pi.warn(e);break;case"error":pi.error(e);break;default:pi.info(e)}}}const Ne=new sm,nm=rn.POLL.NOTIFICATIONS,rm=5*6e4,om=3,im=2e3,$s=De.create("NotificationService");class am{constructor(){this._byId=new Map,this._sorted=[],this.unreadCount=0,this.listeners=new Set,this.settings={_init:!1},this.navigate=null,this.loading=!1,this.fetching=!1,this.poller=null,this.bc=null,this._abortController=null,this._retryAttempts=0,this.notificationEventTypes=["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall","newStory"],this.socketHandlers={notification:e=>this._onSocket("generic",e),newMessage:e=>this._onSocket("message",e),newLike:e=>this._onSocket(e.isMatch?"match":"like",e),photoPermissionRequestReceived:e=>this._onSocket("photoRequest",e),photoPermissionResponseReceived:e=>this._onSocket("photoResponse",e),newComment:e=>this._onSocket("comment",e),incomingCall:e=>this._onSocket("call",e),newStory:e=>this._onSocket("story",e)},this._initBroadcast()}_initBroadcast(){if(typeof BroadcastChannel=="function")try{this.bc=new BroadcastChannel("notification_sync"),this.bc.onmessage=({data:{type:e,payload:s}})=>{e==="ADD"&&this._add(s,!1),e==="READ"&&this._markReadLocal(s.notificationId,!1),e==="READ_ALL"&&this._markAllLocal(!1)}}catch(e){$s.error("BroadcastChannel init failed:",e)}}_sync(e,s){if(this.bc)try{this.bc.postMessage({type:e,payload:s})}catch(r){$s.error("Broadcast sync failed:",r)}}setNavigate(e){typeof e=="function"&&(this.navigate=e)}initialize(e={}){if(this.settings._init)return;const s={messages:!0,calls:!0,stories:!0,likes:!0,comments:!0,photoRequests:!0};if(this.settings={...s,...e.notifications||{}},this.settings._init=!0,!(sessionStorage.getItem("token")||localStorage.getItem("token"))){$s.debug("No authentication token, notification service in limited mode");return}this._setupSocket(),this.fetchNotifications(),this._managePolling()}_setupSocket(){Ne.on("connect",()=>{this._clearPoller(),this.fetchNotifications()}),Ne.on("disconnect",()=>this._managePolling());for(const[e,s]of Object.entries(this.socketHandlers))Ne.on(e,s)}_managePolling(){if(!this.settings._init)return;if(!(sessionStorage.getItem("token")||localStorage.getItem("token"))){this._clearPoller(),$s.debug("No authentication token, polling disabled");return}const s=Ne.isConnected();!s&&!this.poller?(this.poller=setInterval(()=>this.fetchNotifications(),nm),this.fetchNotifications()):s&&this.poller&&this._clearPoller()}_clearPoller(){clearInterval(this.poller),this.poller=null}async fetchNotifications(){if(!this.settings._init||this.fetching)return;if(!(sessionStorage.getItem("token")||localStorage.getItem("token"))){$s.debug("No authentication token, skipping notification fetch");return}this.fetching=!0,this.loading=!0,this._notify(),this._abortController&&this._abortController.abort(),this._abortController=new AbortController;try{const s=await Ae.get("/notifications",{_t:Date.now()},{signal:this._abortController.signal});s.success&&Array.isArray(s.data)?(this._processFetched(s.data),this._retryAttempts=0):$s.warn("Unexpected notifications payload",s)}catch(s){if(s.name!=="AbortError"&&this._retryAttempts<om){this._retryAttempts+=1;const r=im*2**(this._retryAttempts-1);setTimeout(()=>this.fetchNotifications(),r)}else $s.error("Fetch notifications failed:",s)}finally{this.loading=!1,this.fetching=!1,this._notify()}}_processFetched(e){this._byId.clear(),e.forEach(s=>{const r=this._sanitize(s);r&&this._byId.set(r._id,r)}),this._sorted=Array.from(this._byId.values()).sort((s,r)=>r.createdAtTime-s.createdAtTime),this._recount()}_sanitize(e){if(!e||!e._id)return null;const s=e.createdAt||new Date().toISOString(),r=Date.parse(s)||Date.now();return{_id:String(e._id),type:e.type||"generic",title:e.title||"",message:e.message||"",sender:e.sender||null,data:e.data||{},read:!!e.read,createdAt:s,createdAtTime:r,count:Number(e.count)||1}}_onSocket(e,s){if(!this.settings[e])return;const r={_id:s._id||`bc-${Date.now()}`,type:e,title:s.title,message:s.message,sender:s.sender,data:s,read:!1,createdAt:s.createdAt||new Date().toISOString()},o=this._sanitize(r);o&&this._add(o,!0)}_add(e,s=!0){var c;const r=Date.now(),o=((c=e.sender)==null?void 0:c._id)||"";`${e.type}${o}`;const i=this._sorted.find(l=>{var f;return l.type===e.type&&(((f=l.sender)==null?void 0:f._id)||"")===o&&r-l.createdAtTime<rm});i?(i.count+=1,i.createdAt=e.createdAt,i.createdAtTime=e.createdAtTime,i.message=`${i.count} new ${i.type}${i.count>1?"s":""}`,i.read=!1):this._byId.has(e._id)||(this._sorted.unshift(e),this._byId.set(e._id,e)),this._recount(),this._notify(),s&&this._sync("ADD",e),window.dispatchEvent(new CustomEvent("newNotification",{detail:e}))}_recount(){this.unreadCount=this._sorted.reduce((e,s)=>e+(s.read?0:1),0)}_notify(){queueMicrotask(()=>{const e={notifications:[...this._sorted],unreadCount:this.unreadCount,loading:this.loading};this.listeners.forEach(s=>{try{s(e)}catch(r){$s.error("Listener error:",r)}})})}addListener(e){return typeof e!="function"?()=>{}:(this.listeners.add(e),e({notifications:[...this._sorted],unreadCount:this.unreadCount,loading:this.loading}),()=>this.listeners.delete(e))}markAsRead(e,s=!0){this._markReadLocal(e,s),Ae.put("/notifications/read",{ids:[e]}).catch(r=>$s.warn("markAsRead API error:",r))}_markReadLocal(e,s){const r=this._byId.get(e);!r||r.read||(r.read=!0,this._recount(),this._notify(),s&&this._sync("READ",{notificationId:e}))}markAllAsRead(e=!0){this.unreadCount&&(this._markAllLocal(e),Ae.put("/notifications/read-all").catch(s=>$s.warn("markAllAsRead API error:",s)))}_markAllLocal(e){for(const s of this._sorted)s.read=!0;this._recount(),this._notify(),e&&this._sync("READ_ALL",null)}handleClick(e){var r,o,i;if(!this.navigate)return;this.markAsRead(e._id);let s="/dashboard";switch(e.type){case"message":s=`/messages/${((r=e.sender)==null?void 0:r._id)||""}`;break;case"like":case"match":s=`/user/${((o=e.sender)==null?void 0:o._id)||""}`;break;case"photoRequest":s="/settings?tab=privacy";break;case"photoResponse":s=`/user/${((i=e.sender)==null?void 0:i._id)||""}`;break;case"comment":s=`/post/${e.data.postId||e.data.referenceId||""}`;break;case"story":return window.dispatchEvent(new CustomEvent("viewStory",{detail:e.data}));case"call":return window.dispatchEvent(new CustomEvent("startCall",{detail:e.data}))}this.navigate(s)}cleanup(){for(const e of Object.keys(this.socketHandlers))Ne.off(e,this.socketHandlers[e]);Ne.off("connect"),Ne.off("disconnect"),this._abortController&&(this._abortController.abort(),this._abortController=null),this._clearPoller(),this.bc&&this.bc.close(),this.listeners.clear(),this._byId.clear(),this._sorted=[],this.unreadCount=0,this.settings._init=!1,this._retryAttempts=0,this.fetching=!1,this.loading=!1}}const cm=()=>{const t=Zt();d.useEffect(()=>{$s.debug("Attaching navigation to NotificationService"),ws.setNavigate(t),ws.settings._init&&ws._setupSocket()},[t])},ws=new am,ys=De.create("AuthContext"),_a=d.createContext(),Gt=()=>{const t=d.useContext(_a);if(!t)throw new Error("useAuth must be used within AuthProvider");return t};function lm({children:t}){const[e,s]=d.useState(null),[r,o]=d.useState(!0),[i,c]=d.useState(null),[l,f]=d.useState(!1),[h,a]=d.useState(!1),p=d.useRef(null),_=d.useRef(null),N=d.useRef(null),g=d.useRef(!1),C=d.useCallback(()=>c(null),[]),A=d.useCallback(async v=>{if(!v)return null;let b={...v};!b._id&&b.id&&(b._id=b.id),!b.id&&b._id&&(b.id=b._id);const B=$=>typeof $=="string"&&xn($);if(!B(b._id)){try{const $=ls();if($){const x=hc($);B(x)&&(b._id=b.id=x)}}catch($){ys.error("normalizeUser.token",$)}B(b._id)}return B(b._id)?b:(ys.error("Invalid user ID:",b._id),H.error("Auth error: invalid profile, please log in again."),xr(),null)},[]),P=d.useCallback(v=>{var b,B;ws.initialize((b=v.settings)==null?void 0:b.notifications),Ne.updatePrivacySettings((B=v.settings)==null?void 0:B.privacy)},[]),R=d.useCallback(v=>{clearTimeout(_.current);try{const $=JSON.parse(atob(v.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))).exp*1e3-Date.now()-5*6e4;$>6e4?_.current=setTimeout(()=>j(),$):j()}catch(b){ys.error("scheduleRefresh",b)}},[]),j=d.useCallback(()=>!l&&!ls()?Promise.resolve(null):(p.current||(p.current=(async()=>{var b;const v=ls();if(!v)return null;try{ys.info("Refreshing token…");const B=await Ae.post("/auth/refresh-token",{token:v},{headers:{"x-no-cache":"true"},_isRefreshRequest:!0});if(!B.success||!B.token)throw new Error("Bad refresh");kr(B.token,!!localStorage.getItem("token")),R(B.token);const $=hc(B.token);return e&&$&&$!==e._id&&s(x=>({...x,_id:$,id:$})),ys.info("Token refreshed"),B.token}catch(B){return ys.error("refreshToken",B),p.current=null,(((b=B==null?void 0:B.response)==null?void 0:b.status)===401||Fi(ls()))&&O(),null}finally{setTimeout(()=>p.current=null,1e3)}})()),p.current),[l,R,e]),k=d.useCallback(async v=>{var b,B;o(!0),c(null);try{const $=await Ae.post("/auth/register",v);if(!$.success)throw $;kr($.token,!0),R($.token);const x=await A($.user);x&&(s(x),f(!0),P(x));const z=await Ae.get("/auth/me");if(z.success){const G=await A(z.data);G&&s(G)}return $}catch($){ys.error("register",$);const x=$.error||((B=(b=$.response)==null?void 0:b.data)==null?void 0:B.error)||"Registration failed";throw c(x),new Error(x)}finally{o(!1)}},[A,R,P]),F=d.useCallback(async(v,b=!0)=>{o(!0),c(null);try{const B=await Ae.post("/auth/login",v);if(!B.success||!B.token)throw B;kr(B.token,b),R(B.token);const $=B.user?await A(B.user):await(async()=>{const x=await Ae.get("/auth/me");return x.success?A(x.data):null})();return $&&(s($),f(!0),P($)),H.success($!=null&&$.nickname?`Welcome back, ${$.nickname}!`:"Welcome back!"),B}catch(B){ys.error("login",B);const $=B.error||B.message||"Login failed";throw c($),H.error($),B}finally{o(!1)}},[A,R,P]),O=d.useCallback(async()=>{o(!0);try{clearTimeout(_.current),await Ae.logout().catch(()=>{}),xr(),s(null),f(!1)}catch(v){ys.error("logout",v),xr(),s(null),f(!1)}finally{o(!1)}},[]),L=d.useCallback(async()=>{try{const v=ls();return v?Fi(v)?!!await j():(await Ae.get("/auth/verify")).success?!0:!!await j():!1}catch(v){return ys.error("checkAndRefresh",v),!1}},[j]),E=d.useCallback(async()=>{o(!0);try{const v=await Ae.get("/auth/me");if(!v.success)throw v;const b=await A(v.data);return b?(s(b),f(!0),P(b),b):null}catch(v){return ys.error("getCurrentUser",v),s(null),f(!1),null}finally{o(!1),a(!0),g.current=!0}},[A,P]),M=d.useCallback(async()=>{var v;try{const b=await Ae.post("/auth/resend-verification");return b.success?(H.success("Verification email sent."),!0):(H.error(b.error||"Failed to send verification"),!1)}catch(b){return ys.error("resendVerificationEmail",b),((v=b.response)==null?void 0:v.status)===429?H.error("Too many requests, please wait."):H.error("Failed to send verification."),!1}},[]);d.useEffect(()=>{if(!g.current)return g.current=!0,N.current=setTimeout(()=>{r&&(ys.warn("Auth check timeout"),o(!1),a(!0),ls()&&f(!0))},8e3),(async()=>(ls()?await L()?await E():(xr(),s(null),f(!1)):(f(!1),s(null)),clearTimeout(N.current),a(!0),o(!1)))(),()=>clearTimeout(N.current)},[L,E]),d.useEffect(()=>()=>clearTimeout(_.current),[]);const I={user:e,loading:r,error:i,isAuthenticated:l,authChecked:h,register:k,login:F,logout:O,refreshToken:j,getCurrentUser:E,clearError:C,fixUserIdFormat:A,token:ls(),resendVerificationEmail:M};return n.jsx(_a.Provider,{value:I,children:t})}var mi,_c;function dm(){if(_c)return mi;_c=1;var t="Expected a function",e=NaN,s="[object Symbol]",r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,f=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,h=typeof self=="object"&&self&&self.Object===Object&&self,a=f||h||Function("return this")(),p=Object.prototype,_=p.toString,N=Math.max,g=Math.min,C=function(){return a.Date.now()};function A(F,O,L){var E,M,I,v,b,B,$=0,x=!1,z=!1,G=!0;if(typeof F!="function")throw new TypeError(t);O=k(O)||0,P(L)&&(x=!!L.leading,z="maxWait"in L,I=z?N(k(L.maxWait)||0,O):I,G="trailing"in L?!!L.trailing:G);function Y(ce){var de=E,me=M;return E=M=void 0,$=ce,v=F.apply(me,de),v}function oe(ce){return $=ce,b=setTimeout(K,O),x?Y(ce):v}function le(ce){var de=ce-B,me=ce-$,se=O-de;return z?g(se,I-me):se}function ye(ce){var de=ce-B,me=ce-$;return B===void 0||de>=O||de<0||z&&me>=I}function K(){var ce=C();if(ye(ce))return ae(ce);b=setTimeout(K,le(ce))}function ae(ce){return b=void 0,G&&E?Y(ce):(E=M=void 0,v)}function ue(){b!==void 0&&clearTimeout(b),$=0,E=B=M=b=void 0}function we(){return b===void 0?v:ae(C())}function Pe(){var ce=C(),de=ye(ce);if(E=arguments,M=this,B=ce,de){if(b===void 0)return oe(B);if(z)return b=setTimeout(K,O),Y(B)}return b===void 0&&(b=setTimeout(K,O)),v}return Pe.cancel=ue,Pe.flush=we,Pe}function P(F){var O=typeof F;return!!F&&(O=="object"||O=="function")}function R(F){return!!F&&typeof F=="object"}function j(F){return typeof F=="symbol"||R(F)&&_.call(F)==s}function k(F){if(typeof F=="number")return F;if(j(F))return e;if(P(F)){var O=typeof F.valueOf=="function"?F.valueOf():F;F=P(O)?O+"":O}if(typeof F!="string")return F===0?F:+F;F=F.replace(r,"");var L=i.test(F);return L||c.test(F)?l(F.slice(2),L?2:8):o.test(F)?e:+F}return mi=A,mi}var um=dm();const vc=gn(um),Nt=De.create("StoriesService"),Ys="/stories",hm=tn.TTL.STORIES;let fn=null,wc=0;const Yn=new Map;let bc=0;const fm=async()=>{try{const t=Date.now();if(fn&&t-wc<hm)return t-bc>1e4&&(Nt.debug("Returning cached stories"),bc=t),fn;Nt.debug("Fetching all stories");const e=await Ae.get(Ys);return wc=t,Array.isArray(e)?(Nt.debug("Handling legacy API format for stories"),fn={success:!0,data:e},fn):(fn=e,e)}catch(t){return Nt.error("Error fetching stories",t),{success:!1,message:t.message||"Failed to fetch stories"}}},pm=async t=>{try{Nt.debug(`Fetching stories for user ${t}`);const e=await Ae.get(`${Ys}/user/${t}`);return Array.isArray(e)?(Nt.debug("Handling legacy API format for user stories"),{success:!0,data:e}):e}catch(e){return Nt.error(`Error fetching stories for user ${t}`,e),{success:!1,message:e.message||"Failed to fetch user stories"}}},mm=async(t,e)=>{const s=`create-story-${Date.now()}`;if(Yn.has(s.substring(0,s.length-3)))return Nt.warn("Duplicate story creation request detected"),{success:!1,message:"A similar request is already in progress"};Yn.set(s,!0),Nt.debug(`Starting story creation request: ${s}`);try{if(t instanceof FormData)t.append("timestamp",Date.now().toString());else if(typeof t=="object"){if(t.mediaType==="text"||t.type==="text")return Nt.debug("Redirecting to text story creation"),ad(t,e);t.timestamp=Date.now()}Nt.debug("Uploading media story");const r=await Ae.upload(Ys,t,e),o={success:!0,data:r.data||r,message:"Story created successfully"};return Nt.debug("Invalidating stories cache after creation"),fn=null,o}catch(r){return Nt.error("Error creating story",r),{success:!1,message:r.message||"Failed to create story"}}finally{setTimeout(()=>{Yn.delete(s),Nt.debug(`Story request ${s} unlocked after cooldown`)},5e3)}},ad=async(t,e)=>{const r=`create-text-story-${t.content?t.content.trim().substring(0,20):""}`;if(Yn.has(r))return Nt.warn("Duplicate text story creation request detected"),{success:!1,error:"Duplicate submission"};Yn.set(r,!0),Nt.debug(`Starting text story creation: ${r}`);try{const o={...t,timestamp:Date.now(),type:"text",mediaType:"text"};Nt.debug("Sending text story to API");const i=await Ae.post(Ys,o,{onUploadProgress:e});if(i&&typeof i=="object"){if(i.error)throw new Error(i.error);if(i.success===!1)throw new Error(i.message||"Failed to create text story")}const c=(i==null?void 0:i.status)===201||i&&(i.success||i._id);let l;return c?l={success:!0,data:i.data||i.story||i,message:"Story created successfully"}:i&&i.success?l={success:!0,data:i.data||i.story,message:"Story created successfully"}:i&&i._id?l={success:!0,data:i,message:"Story created successfully"}:i==null?l={success:!0,message:"Story created successfully",data:{created:!0,timestamp:Date.now()}}:l={success:!0,data:i,message:"Story created successfully"},Nt.debug("Invalidating stories cache after text story creation"),fn=null,l}catch(o){return Nt.error("Error creating text story",o),{success:!1,message:o.message||"Failed to create text story"}}finally{setTimeout(()=>{Yn.delete(r),Nt.debug(`Text story request ${r} unlocked after cooldown`)},5e3)}},gm=async t=>{try{Nt.debug(`Deleting story ${t}`);const e=await Ae.delete(`${Ys}/${t}`),s=e&&!e.success&&e.msg?{success:!0,message:e.msg}:e;return Nt.debug("Invalidating stories cache after deletion"),fn=null,s}catch(e){return Nt.error(`Error deleting story ${t}`,e),{success:!1,message:e.message||"Failed to delete story"}}},ym=async t=>{try{Nt.debug(`Marking story ${t} as viewed`);const e=await Ae.post(`${Ys}/${t}/view`);return e&&!e.success&&e.msg?{success:!0,message:e.msg}:e}catch(e){return Nt.error(`Error marking story ${t} as viewed`,e),{success:!1,message:e.message||"Failed to mark story as viewed"}}},_m=async(t,e)=>{try{Nt.debug(`Reacting to story ${t} with type: ${e}`);const s=await Ae.post(`${Ys}/${t}/react`,{reactionType:e});return s&&s.data&&!s.success?{success:!0,data:s.data,message:"Reaction added successfully"}:s}catch(s){return Nt.error(`Error reacting to story ${t}`,s),{success:!1,message:s.message||"Failed to react to story"}}},vm=async t=>{try{return Nt.debug(`Removing reaction from story ${t}`),await Ae.delete(`${Ys}/${t}/react`)}catch(e){return Nt.error(`Error removing reaction from story ${t}`,e),{success:!1,message:e.message||"Failed to remove reaction"}}},wm=async t=>{try{return Nt.debug(`Fetching reactions for story ${t}`),await Ae.get(`${Ys}/${t}/reactions`)}catch(e){return Nt.error(`Error fetching reactions for story ${t}`,e),{success:!1,message:e.message||"Failed to fetch story reactions"}}},bm=async t=>{try{return Nt.debug(`Fetching viewers for story ${t}`),await Ae.get(`${Ys}/${t}/viewers`)}catch(e){return Nt.error(`Error fetching viewers for story ${t}`,e),{success:!1,message:e.message||"Failed to fetch story viewers"}}},vn={getAllStories:fm,getUserStories:pm,createStory:mm,createTextStory:ad,deleteStory:gm,markStoryAsViewed:ym,reactToStory:_m,removeReaction:vm,getStoryReactions:wm,getStoryViewers:bm},Qs=De.create("StoriesContext"),cd=d.createContext(),xm={stories:[],loading:!1,error:null,viewedStories:{},isCreating:!1};function Sm(t,e){switch(e.type){case"LOAD_START":return{...t,loading:!0,error:null};case"LOAD_SUCCESS":return{...t,loading:!1,stories:e.payload,error:null};case"LOAD_ERROR":return{...t,loading:!1,error:e.payload};case"ADD_STORY":return{...t,stories:t.stories.some(s=>s._id===e.payload._id)?t.stories:[e.payload,...t.stories]};case"REMOVE_STORY":return{...t,stories:t.stories.filter(s=>s._id!==e.payload)};case"CREATE_START":return{...t,isCreating:!0};case"CREATE_END":return{...t,isCreating:!1};case"VIEW_STORY":return{...t,viewedStories:{...t.viewedStories,[e.payload]:Date.now()}};default:return t}}function Cm({children:t}){const{user:e,isAuthenticated:s}=Gt(),[r,o]=d.useReducer(Sm,xm),i=d.useRef(0),c=d.useRef(new Map),l=d.useRef(null),f=d.useCallback(async(R=!1)=>{const j=Date.now();if(!R&&r.stories.length>0&&j-i.current<6e4)return r.stories;const k="loadStories";if(c.current.has(k))return c.current.get(k);const F=(async()=>{o({type:"LOAD_START"});try{const O=await vn.getAllStories();if(!O.success)throw new Error(O.message||"Failed to load stories");const L=Array.from(new Map(O.data.map(E=>[E._id,E])).values());return i.current=Date.now(),o({type:"LOAD_SUCCESS",payload:L}),L}catch(O){return o({type:"LOAD_ERROR",payload:O.message}),[]}finally{c.current.delete(k)}})();return c.current.set(k,F),F},[r.stories]),h=d.useMemo(()=>vc(f,300),[f]),a=d.useCallback(R=>{if(!R)return Promise.resolve([]);const j=`loadUserStories:${R}`;if(c.current.has(j))return c.current.get(j);const k=(async()=>{o({type:"LOAD_START"});try{const F=await vn.getUserStories(R);if(!F.success)throw new Error(F.message||"Failed to load user stories");return Array.isArray(F.data)?[...F.data]:[]}catch(F){return Qs.error(`loadUserStories(${R})`,F),[]}finally{o({type:"LOAD_SUCCESS",payload:r.stories}),c.current.delete(j)}})();return c.current.set(j,k),k},[r.stories]),p=d.useCallback(async(R,j)=>{var k,F;if(Qs.debug("createStory"),!s)return H.error("Login required to create stories"),{success:!1};if(!r.isCreating){o({type:"CREATE_START"});try{const O={...R};if(O.mediaType==="text"&&!O.content)throw new Error("Text stories require content");const L=O.mediaType==="text"?await vn.createTextStory(O,j):await vn.createStory(O,j);if(!L)throw new Error("No response from server");if(L.message&&L.message.includes("wait")&&!L.success)return H.info(L.message),L;if(!L.success)throw new Error(L.message||"Failed to create story");const E=L.data||L.story;if(!E)throw new Error("No story returned from API");return o({type:"ADD_STORY",payload:E}),L}catch(O){if(O.status===429||O&&O.data&&O.data.status===429){const E=((k=O.data)==null?void 0:k.message)||((F=O.data)==null?void 0:F.error)||"Please wait before posting another story";return H.error(E),Qs.error("createStory rate limited",O),{success:!1,message:E}}else return H.error(O.message),Qs.error("createStory",O),{success:!1,message:O.message}}finally{o({type:"CREATE_END"})}}},[s,r.isCreating]),_=d.useCallback(async R=>{if(!s)return H.error("Login required to delete stories"),{success:!1};if(!R)return H.error("Invalid story ID"),{success:!1};const j=`deleteStory:${R}`;if(c.current.has(j))return c.current.get(j);const k=(async()=>{o({type:"LOAD_START"});try{const F=await vn.deleteStory(R);if(!F.success)throw new Error(F.message||"Failed to delete story");return o({type:"REMOVE_STORY",payload:R}),H.success("Story deleted"),F}catch(F){return H.error(F.message),Qs.error("deleteStory",F),{success:!1,message:F.message}}finally{c.current.delete(j),o({type:"LOAD_SUCCESS",payload:r.stories})}})();return c.current.set(j,k),k},[s,r.stories]),N=d.useCallback(R=>{if(!s||!R)return Promise.resolve(!1);const j=`viewStory:${R}`;if(c.current.has(j))return c.current.get(j);const k=(async()=>{try{const F=await vn.markStoryAsViewed(R);if(!F.success)throw new Error(F.message||"Failed to mark viewed");return o({type:"VIEW_STORY",payload:R}),!0}catch(F){return Qs.error("viewStory",F),!1}finally{c.current.delete(j)}})();return c.current.set(j,k),k},[s]),g=d.useCallback((R,j)=>{if(!s||!R||!j)return H.error("Invalid reaction"),Promise.resolve({success:!1});const k=`reactToStory:${R}:${j}`;if(c.current.has(k))return c.current.get(k);const F=(async()=>{try{const O=await vn.reactToStory(R,j);if(!O.success)throw new Error(O.message||"Failed to react");return H.success("Reaction recorded"),O}catch(O){return H.error(O.message),Qs.error("reactToStory",O),{success:!1}}finally{c.current.delete(k)}})();return c.current.set(k,F),F},[s]),C=d.useCallback(R=>R?r.stories.some(j=>{var k;return String(((k=j.user)==null?void 0:k._id)||j.user)===String(R)&&!r.viewedStories[j._id]}):!1,[r.stories,r.viewedStories]),A=d.useCallback(()=>{o({type:"LOAD_ERROR",payload:null})},[]);d.useEffect(()=>{if(e!=null&&e._id)try{const R=`viewedStories:${e._id}`,j=JSON.parse(localStorage.getItem(R)||"{}");if(o({type:"VIEW_STORY",payload:null}),j&&typeof j=="object")for(const[k,F]of Object.entries(j))o({type:"VIEW_STORY",payload:k})}catch(R){Qs.error("load viewedStories",R)}},[e]),d.useEffect(()=>{if(!(e!=null&&e._id))return;const j=vc(()=>{try{localStorage.setItem(`viewedStories:${e._id}`,JSON.stringify(r.viewedStories))}catch(k){Qs.error("save viewedStories",k)}},1e3);return j(),()=>j.flush()},[r.viewedStories,e]),d.useEffect(()=>{if(l.current&&clearInterval(l.current),!s)return;const R=setTimeout(()=>h(!1),500);return l.current=setInterval(()=>{document.visibilityState==="visible"&&h(!0)},5*6e4),()=>{clearTimeout(R),clearInterval(l.current)}},[s,h]);const P=d.useMemo(()=>({stories:r.stories,loading:r.loading,error:r.error,viewedStories:r.viewedStories,isCreating:r.isCreating,clearError:A,loadStories:f,loadUserStories:a,createStory:p,deleteStory:_,viewStory:N,reactToStory:g,hasUnviewedStories:C}),[r,A,f,a,p,_,N,g,C]);return n.jsx(cd.Provider,{value:P,children:t})}function Br(){const t=d.useContext(cd);if(!t)throw new Error("useStories must be used within StoriesProvider");return t}function ld(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(t)}function dd(t){return Ce({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(t)}function km(t){return Ce({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"},child:[]}]})(t)}function Nm(t){return Ce({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"},child:[]}]})(t)}function Kn(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(t)}function Nr(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(t)}function va(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"},child:[]}]})(t)}function Ar(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(t)}function ud(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(t)}function Hs(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"},child:[]}]})(t)}function jm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(t)}function Tm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 174.8l-39.6-39.6c-9.4-9.4-24.6-9.4-33.9 0L192 374.7 80.6 263.2c-9.4-9.4-24.6-9.4-33.9 0L7 302.9c-9.4 9.4-9.4 24.6 0 34L175 505c9.4 9.4 24.6 9.4 33.9 0l296-296.2c9.4-9.5 9.4-24.7.1-34zm-324.3 106c6.2 6.3 16.4 6.3 22.6 0l208-208.2c6.2-6.3 6.2-16.4 0-22.6L366.1 4.7c-6.2-6.3-16.4-6.3-22.6 0L192 156.2l-55.4-55.5c-6.2-6.3-16.4-6.3-22.6 0L68.7 146c-6.2 6.3-6.2 16.4 0 22.6l112 112.2z"},child:[]}]})(t)}function mt(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(t)}function Em(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"},child:[]}]})(t)}function hd(t){return Ce({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(t)}function fd(t){return Ce({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(t)}function Am(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"},child:[]}]})(t)}function Im(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(t)}function xc(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(t)}function er(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"},child:[]}]})(t)}function $m(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"},child:[]}]})(t)}function Pm(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M4.686 427.314L104 328l-32.922-31.029C55.958 281.851 66.666 256 88.048 256h112C213.303 256 224 266.745 224 280v112c0 21.382-25.803 32.09-40.922 16.971L152 376l-99.314 99.314c-6.248 6.248-16.379 6.248-22.627 0L4.686 449.941c-6.248-6.248-6.248-16.379 0-22.627zM443.314 84.686L344 184l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C234.697 256 224 245.255 224 232V120c0-21.382 25.803-32.09 40.922-16.971L296 136l99.314-99.314c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.248 6.248 6.248 16.379 0 22.627z"},child:[]}]})(t)}function pd(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"},child:[]}]})(t)}function md(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(t)}function gd(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"},child:[]}]})(t)}function Rm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 464c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V200.724a48 48 0 0 1 18.387-37.776c24.913-19.529 45.501-35.365 164.2-121.511C199.412 29.17 232.797-.347 256 .003c23.198-.354 56.596 29.172 73.413 41.433 118.687 86.137 139.303 101.995 164.2 121.512A48 48 0 0 1 512 200.724V464zm-65.666-196.605c-2.563-3.728-7.7-4.595-11.339-1.907-22.845 16.873-55.462 40.705-105.582 77.079-16.825 12.266-50.21 41.781-73.413 41.43-23.211.344-56.559-29.143-73.413-41.43-50.114-36.37-82.734-60.204-105.582-77.079-3.639-2.688-8.776-1.821-11.339 1.907l-9.072 13.196a7.998 7.998 0 0 0 1.839 10.967c22.887 16.899 55.454 40.69 105.303 76.868 20.274 14.781 56.524 47.813 92.264 47.573 35.724.242 71.961-32.771 92.263-47.573 49.85-36.179 82.418-59.97 105.303-76.868a7.998 7.998 0 0 0 1.839-10.967l-9.071-13.196z"},child:[]}]})(t)}function Gs(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(t)}function wa(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(t)}function It(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(t)}function Lm(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"},child:[]}]})(t)}function yd(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(t)}function ba(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(t)}function Sc(t){return Ce({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(t)}function Om(t){return Ce({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm-64 268c0 10.7-12.9 16-20.5 8.5L104 376H76c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h28l35.5-36.5c7.6-7.6 20.5-2.2 20.5 8.5v136zm33.2-47.6c9.1-9.3 9.1-24.1 0-33.4-22.1-22.8 12.2-56.2 34.4-33.5 27.2 27.9 27.2 72.4 0 100.4-21.8 22.3-56.9-10.4-34.4-33.5zm86-117.1c54.4 55.9 54.4 144.8 0 200.8-21.8 22.4-57-10.3-34.4-33.5 36.2-37.2 36.3-96.5 0-133.8-22.1-22.8 12.3-56.3 34.4-33.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(t)}function Mm(t){return Ce({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z"},child:[]}]})(t)}function Bm(t){return Ce({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M384 121.941V128H256V0h6.059c6.365 0 12.47 2.529 16.971 7.029l97.941 97.941A24.005 24.005 0 0 1 384 121.941zM224 136V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248c-13.2 0-24-10.8-24-24zm96 144.016v111.963c0 21.445-25.943 31.998-40.971 16.971L224 353.941V392c0 13.255-10.745 24-24 24H88c-13.255 0-24-10.745-24-24V280c0-13.255 10.745-24 24-24h112c13.255 0 24 10.745 24 24v38.059l55.029-55.013c15.011-15.01 40.971-4.491 40.971 16.97z"},child:[]}]})(t)}function Fm(t){return Ce({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(t)}function Dm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(t)}function _d(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048 34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122 53.588 0 97.844 34.783 165.217 34.783 48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016-34.338 15.948-76.454 31.854-116.95 31.854z"},child:[]}]})(t)}function Um(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"},child:[]}]})(t)}function nn(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(t)}function Oo(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"},child:[]}]})(t)}function qm(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"},child:[]}]})(t)}function zm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(t)}function Cc(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"},child:[]}]})(t)}function ns(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(t)}function Ir(t){return Ce({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(t)}function kc(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"},child:[]}]})(t)}function Hm(t){return Ce({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"},child:[]}]})(t)}function Vm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"},child:[]}]})(t)}function Wi(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(t)}function Wm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(t)}function vd(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"},child:[]}]})(t)}function Gm(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(t)}function Gi(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z"},child:[]}]})(t)}function wd(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(t)}function yr(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(t)}function bd(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(t)}function Ym(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"},child:[]}]})(t)}function Km(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"},child:[]}]})(t)}function xd(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(t)}function Jm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"},child:[]}]})(t)}function xa(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"},child:[]}]})(t)}function Qm(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function Xm(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M216 288h-48c-8.84 0-16 7.16-16 16v192c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V304c0-8.84-7.16-16-16-16zM88 384H40c-8.84 0-16 7.16-16 16v96c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16v-96c0-8.84-7.16-16-16-16zm256-192h-48c-8.84 0-16 7.16-16 16v288c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V208c0-8.84-7.16-16-16-16zm128-96h-48c-8.84 0-16 7.16-16 16v384c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V112c0-8.84-7.16-16-16-16zM600 0h-48c-8.84 0-16 7.16-16 16v480c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V16c0-8.84-7.16-16-16-16z"},child:[]}]})(t)}function Zm(t){return Ce({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"},child:[]}]})(t)}function Ts(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(t)}function eg(t){return Ce({attr:{viewBox:"0 0 480 512"},child:[{tag:"path",attr:{d:"M471.99 334.43L336.06 256l135.93-78.43c7.66-4.42 10.28-14.2 5.86-21.86l-32.02-55.43c-4.42-7.65-14.21-10.28-21.87-5.86l-135.93 78.43V16c0-8.84-7.17-16-16.01-16h-64.04c-8.84 0-16.01 7.16-16.01 16v156.86L56.04 94.43c-7.66-4.42-17.45-1.79-21.87 5.86L2.15 155.71c-4.42 7.65-1.8 17.44 5.86 21.86L143.94 256 8.01 334.43c-7.66 4.42-10.28 14.21-5.86 21.86l32.02 55.43c4.42 7.65 14.21 10.27 21.87 5.86l135.93-78.43V496c0 8.84 7.17 16 16.01 16h64.04c8.84 0 16.01-7.16 16.01-16V339.14l135.93 78.43c7.66 4.42 17.45 1.8 21.87-5.86l32.02-55.43c4.42-7.65 1.8-17.43-5.86-21.85z"},child:[]}]})(t)}function _r(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(t)}function tg(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"},child:[]}]})(t)}function gi(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"},child:[]}]})(t)}function sg(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z"},child:[]}]})(t)}function rs(t){return Ce({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function Jn(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(t)}function ng(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(t)}function rg(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"},child:[]}]})(t)}function og(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"},child:[]}]})(t)}function Yi(t){return Ce({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(t)}function ig(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(t)}function ag(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.8 458.1L362.3 248.3C412.1 230.7 448 183.8 448 128 448 57.3 390.7 0 320 0c-67.1 0-121.5 51.8-126.9 117.4L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3zM96 422.4V464c0 26.5 21.5 48 48 48h350.2L207.4 290.3C144.2 301.3 96 356 96 422.4z"},child:[]}]})(t)}function jr(t){return Ce({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(t)}function vo(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(t)}function cg(t){return Ce({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.8 458.1l-55-42.5c15.4-1.4 29.2-13.7 29.2-31.1v-257c0-25.5-29.1-40.4-50.4-25.8L448 177.3v137.2l-32-24.7v-178c0-26.4-21.4-47.8-47.8-47.8H123.9L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4L42.7 82 416 370.6l178.5 138c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.5-6.9 4.2-17-2.8-22.4zM32 400.2c0 26.4 21.4 47.8 47.8 47.8h288.4c11.2 0 21.4-4 29.6-10.5L32 154.7v245.5z"},child:[]}]})(t)}function En(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z"},child:[]}]})(t)}function lg(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"},child:[]}]})(t)}function dg(t){return Ce({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"},child:[]}]})(t)}function ug(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"},child:[]}]})(t)}function Sd(t){return Ce({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(t)}const _s=De.create("UserContext"),Cd=d.createContext(),hg={users:[],currentUser:null,messages:[],photoPermissions:[],likedUsers:[],loading:!1,uploadingPhoto:!1,updatingProfile:!1,likesLoading:!0,error:null};function fg(t,e){switch(e.type){case"SET_LOADING":return{...t,loading:e.payload};case"GET_USERS":return{...t,users:e.payload,loading:!1};case"APPEND_USERS":return{...t,users:[...t.users,...e.payload],loading:!1};case"GET_USER":return{...t,currentUser:e.payload.user,messages:e.payload.messages,loading:!1};case"UPLOAD_PHOTO":return{...t,currentUser:t.currentUser?{...t.currentUser,photos:[...t.currentUser.photos||[],e.payload]}:null,uploadingPhoto:!1};case"PHOTO_PERMISSION_REQUESTED":return{...t,photoPermissions:[...t.photoPermissions,e.payload]};case"PHOTO_PERMISSION_UPDATED":return{...t,photoPermissions:t.photoPermissions.map(s=>s._id===e.payload._id?e.payload:s)};case"SET_LIKED_USERS":return{...t,likedUsers:e.payload,likesLoading:!1};case"ADD_LIKED_USER":return t.likedUsers.some(s=>{var r;return String(((r=s.recipient)==null?void 0:r._id)||s.recipient)===String(e.payload.recipient)})?t:{...t,likedUsers:[...t.likedUsers,e.payload]};case"REMOVE_LIKED_USER":return{...t,likedUsers:t.likedUsers.filter(s=>{var r;return String(((r=s.recipient)==null?void 0:r._id)||s.recipient)!==String(e.payload)})};case"SET_LIKES_LOADING":return{...t,likesLoading:e.payload};case"UPLOADING_PHOTO":return{...t,uploadingPhoto:!0};case"UPDATING_PROFILE":return{...t,updatingProfile:!0};case"UPDATE_PROFILE":return{...t,currentUser:e.payload,updatingProfile:!1};case"USER_ERROR":return{...t,error:e.payload,loading:!1,uploadingPhoto:!1,updatingProfile:!1,likesLoading:!1};case"CLEAR_ERROR":return{...t,error:null};default:return t}}function pg({children:t}){var M;const[e,s]=d.useReducer(fg,hg),{user:r,isAuthenticated:o}=Gt(),i=d.useRef(!1),c=d.useRef();d.useRef(null);const l=d.useCallback(async(I=1,v=20)=>{var b,B;s({type:"SET_LOADING",payload:I===1});try{const $=await Ae.get(`/users?page=${I}&limit=${v}`);if(!$.success)throw new Error($.error||"Failed to fetch users");return s({type:I===1?"GET_USERS":"APPEND_USERS",payload:$.data}),{users:$.data,hasMore:$.hasMore??((b=$.pagination)==null?void 0:b.hasNext)??$.data.length===v,totalPages:((B=$.pagination)==null?void 0:B.totalPages)??Math.ceil($.totalCount/v)??1}}catch($){return s({type:"USER_ERROR",payload:$.message}),{users:[],hasMore:!1,totalPages:1}}},[]),f=d.useCallback(()=>{clearTimeout(c.current),c.current=setTimeout(()=>{o&&r&&l()},500)},[l,o,r]);d.useEffect(()=>(o&&r&&f(),()=>clearTimeout(c.current)),[f,o,r]);const h=d.useCallback(async(I=!1)=>{if(!i.current||I){if(s({type:"SET_LIKES_LOADING",payload:!0}),!(r!=null&&r._id)||!xn(r._id)){s({type:"SET_LIKED_USERS",payload:[]});return}try{const v=await Ae.get("/users/likes",{},{headers:I?{"x-no-cache":"true"}:{},useCache:!I});v.success?s({type:"SET_LIKED_USERS",payload:v.data}):s({type:"SET_LIKED_USERS",payload:[]}),i.current=!0}catch{s({type:"SET_LIKED_USERS",payload:[]})}}},[r]);d.useEffect(()=>{if(o&&(r!=null&&r._id)){h(!0);const I=setInterval(()=>{document.visibilityState==="visible"&&h(!0)},5*6e4);return()=>clearInterval(I)}else s({type:"SET_LIKED_USERS",payload:[]}),i.current=!1},[h,o,r]),d.useEffect(()=>{var I;(I=e.currentUser)!=null&&I.settings&&(_s.info("Initializing services with settings",e.currentUser.settings),ws.initialize(e.currentUser.settings.notifications),Ne.updatePrivacySettings(e.currentUser.settings.privacy))},[(M=e.currentUser)==null?void 0:M.settings]);const a=d.useCallback(async I=>{if(!xn(I))return s({type:"USER_ERROR",payload:"Invalid user ID"}),null;s({type:"SET_LOADING",payload:!0});try{const v=await Ae.get(`/users/${I}`);if(!v.success)throw new Error(v.error);return s({type:"GET_USER",payload:v.data}),v.data}catch(v){return s({type:"USER_ERROR",payload:v.message}),null}},[]),p=d.useCallback(async I=>{s({type:"UPDATING_PROFILE"});try{const v=await Ae.put("/users/profile",I);if(_s.debug("Profile update response:",v),!v.success)throw new Error(v.error||"Profile update failed");if(!e.currentUser)return s({type:"UPDATE_PROFILE",payload:v.data}),v.data;const b={...e.currentUser,...v.data,_id:e.currentUser._id||v.data&&v.data._id};return s({type:"UPDATE_PROFILE",payload:b}),b}catch(v){return _s.error("Profile update error details:",v),s({type:"USER_ERROR",payload:v.message}),null}},[e.currentUser]),_=d.useCallback(async(I,v="private")=>{s({type:"UPLOADING_PHOTO"});try{const b=new FormData;b.append("photo",I),b.append("privacy",v);const B=await Ae.upload("/users/photos",b,$=>_s.debug(`Upload progress: ${$}%`));if(!B.success)throw new Error(B.error);return s({type:"UPLOAD_PHOTO",payload:B.data}),H.success(`Photo uploaded (${v})`),B.data}catch(b){return s({type:"USER_ERROR",payload:b.message}),null}},[]),N=d.useCallback(async(I,v)=>{try{const b=await Ae.post(`/users/photos/${I}/request`,{userId:v});if(!b.success)throw new Error(b.error);return s({type:"PHOTO_PERMISSION_REQUESTED",payload:b.data}),H.success("Access request sent"),b.data}catch(b){return s({type:"USER_ERROR",payload:b.message}),null}},[]),g=d.useCallback(async(I,v)=>{try{const b=await Ae.put(`/users/photos/permissions/${I}`,{status:v});if(!b.success)throw new Error(b.error);return s({type:"PHOTO_PERMISSION_UPDATED",payload:b.data}),H.success(`Photo ${v}`),b.data}catch(b){return s({type:"USER_ERROR",payload:b.message}),null}},[]),C=d.useCallback(I=>e.likedUsers.some(v=>{var b;return String(((b=v.recipient)==null?void 0:b._id)||v.recipient)===String(I)}),[e.likedUsers]),A=d.useCallback(async(I,v)=>{if(!xn(I))return H.error("Invalid user ID"),!1;if(C(I))return!0;s({type:"ADD_LIKED_USER",payload:{recipient:I,createdAt:new Date}});try{const b=await Ae.post(`/users/${I}/like`,{},{headers:{"x-no-cache":"true"}});if(!b.success&&b.error!=="Already liked")throw new Error(b.error);return h(!0),H.success(n.jsxs(n.Fragment,{children:[n.jsx(nn,{className:"pulse"})," Liked ",v||""]})),b.likesRemaining!==void 0&&H.info(`${b.likesRemaining} likes left`),!0}catch(b){return s({type:"REMOVE_LIKED_USER",payload:I}),H.error(b.message),!1}},[h,C]),P=d.useCallback(async(I,v)=>{if(!C(I))return!0;s({type:"REMOVE_LIKED_USER",payload:I});try{const b=await Ae.delete(`/users/${I}/like`,{},{headers:{"x-no-cache":"true"}});if(!b.success)throw new Error(b.error);return h(!0),H.info(`Unliked ${v||""}`),!0}catch(b){return s({type:"ADD_LIKED_USER",payload:{recipient:I,createdAt:new Date}}),H.error(b.message),!1}},[h,C]),R=d.useCallback(async I=>{try{const v=await Ae.post("/messages/start",{recipient:I});if(!v.success)throw new Error(v.error);return v.data}catch(v){return s({type:"USER_ERROR",payload:v.message}),null}},[]),j=d.useCallback(async()=>{try{if(!r)return[];_s.debug("Fetching blocked users list");try{const I=await Ae.get("/users/blocked");if(_s.debug(`Blocked users response: ${I!=null&&I.success?"success":"failed"}`),!(I!=null&&I.success))return[];const v=(Array.isArray(I.data)?I.data:[]).map(b=>typeof b=="object"&&b._id?b._id:typeof b=="object"&&b.id?b.id:String(b).replace(/^ObjectId\(['"](.+)['"]\)$/,"$1")).filter(b=>/^[0-9a-fA-F]{24}$/.test(b));return localStorage.setItem("blockedUsers",JSON.stringify(v)),v}catch(I){_s.warn("Failed to fetch blocked users from API, using localStorage fallback:",I);try{const v=localStorage.getItem("blockedUsers");if(v){const b=JSON.parse(v)||[];return _s.debug(`Loaded ${b.length} blocked users from localStorage`),b}}catch(v){_s.warn("Error parsing blocked users from localStorage:",v)}return[]}}catch(I){return _s.error("Error in getBlockedUsers:",I),[]}},[r]),k=d.useCallback(async(I,v="User")=>{if(!xn(I))return H.error("Invalid user ID"),!1;try{const b=await Ae.post(`/users/${I}/block`);if(!b.success&&!b.alreadyBlocked)throw new Error(b.error);return H.success(`Blocked ${v}`),!0}catch(b){return s({type:"USER_ERROR",payload:b.message}),!1}},[]),F=d.useCallback(async(I,v="User")=>{if(!xn(I))return H.error("Invalid user ID"),!1;try{const b=await Ae.delete(`/users/${I}/block`);if(!b.success)throw new Error(b.error);return H.success(`Unblocked ${v}`),!0}catch(b){return s({type:"USER_ERROR",payload:b.message}),!1}},[]),O=d.useCallback(async(I,v="")=>{if(!xn(I))return!1;try{const b=await Ae.post(`/users/${I}/report`,{reason:v});if(!b.success)throw new Error(b.error);return H.success("User reported"),!0}catch(b){return s({type:"USER_ERROR",payload:b.message}),!1}},[]),L=d.useCallback(()=>s({type:"CLEAR_ERROR"}),[]),E=d.useCallback(async(I,v=!1)=>{var b;try{if(!I&&(r!=null&&r._id)){_s.info("Refreshing current user data"+(v?" (immediate)":""));const B=await Ae.get("/auth/me",{},{useCache:!1,headers:{"x-no-cache":"true","Cache-Control":v?"no-cache, no-store, must-revalidate":void 0,Pragma:v?"no-cache":void 0}});if(!B.success)throw new Error(B.error||"Failed to refresh user data");const $={user:B,messages:e.messages||[]};return v&&Ae.clearCache("/auth/me"),s({type:"GET_USER",payload:$}),B}else{const B=I||((b=e.currentUser)==null?void 0:b._id)||(r==null?void 0:r._id);if(!B)throw new Error("No user ID available for refresh");_s.info("Refreshing user data for ID:",B+(v?" (immediate)":""));const $=await Ae.get(`/users/${B}`,{},{useCache:!1,headers:{"x-no-cache":"true","Cache-Control":v?"no-cache, no-store, must-revalidate":void 0,Pragma:v?"no-cache":void 0}});if(!$.success)throw new Error($.error||"Failed to refresh user data");return v&&Ae.clearCache(`/users/${B}`),s({type:"GET_USER",payload:$.data}),$.data}}catch(B){return _s.error("Error refreshing user data:",B),s({type:"USER_ERROR",payload:B.message}),null}},[e.currentUser,e.messages,r]);return d.useEffect(()=>{e.error&&H.error(e.error)},[e.error]),n.jsx(Cd.Provider,{value:{...e,getUsers:l,getUser:a,updateProfile:p,uploadPhoto:_,requestPhotoPermission:N,updatePhotoPermission:g,getLikedUsers:h,isUserLiked:C,likeUser:A,unlikeUser:P,sendMessage:R,getBlockedUsers:j,blockUser:k,unblockUser:F,reportUser:O,clearError:L,refreshUserData:E},children:t})}function _n(){const t=d.useContext(Cd);if(!t)throw new Error("useUser must be used within UserProvider");return t}const kd=d.createContext(),mg=({children:t})=>{const[e,s]=d.useState(()=>{const i=localStorage.getItem("theme");return i||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,"dark")});d.useEffect(()=>{const i=window.document.documentElement;i.classList.remove("light","dark"),i.classList.add(e),localStorage.setItem("theme",e)},[e]);const r=()=>{s(i=>i==="light"?"dark":"light")},o=i=>{["light","dark","system"].includes(i)&&s(i)};return n.jsx(kd.Provider,{value:{theme:e,toggleTheme:r,setTheme:o},children:t})},Sa=()=>{const t=d.useContext(kd);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t},Zr=De.create("ModalContext"),Nd=d.createContext(void 0);function gg({children:t}){const[e,s]=d.useState(null),[r,o]=d.useState(!1),[i,c]=d.useState(null),l=!!i,f=d.useCallback(N=>{Zr.debug("Opening chat with recipient:",(N==null?void 0:N.nickname)||(N==null?void 0:N._id)),s(N),setTimeout(()=>o(!0),kn.ANIMATIONS.CHAT_OPEN_DELAY_MS)},[]),h=d.useCallback(()=>{Zr.debug("Closing chat"),o(!1)},[]),a=d.useCallback(N=>{Zr.debug("Opening profile modal for user:",N),c(N)},[]),p=d.useCallback(()=>{Zr.debug("Closing profile modal"),c(null)},[]);d.useEffect(()=>{const N=g=>{const{recipient:C}=g.detail;C&&C._id&&f(C)};return window.addEventListener("openChat",N),()=>{window.removeEventListener("openChat",N)}},[f]);const _={chatRecipient:e,isChatOpen:r,openChat:f,closeChat:h,profileModalUserId:i,isProfileModalOpen:l,openProfileModal:a,closeProfileModal:p};return n.jsx(Nd.Provider,{value:_,children:t})}function jd(){const t=d.useContext(Nd);if(t===void 0)throw new Error("useModals must be used within a ModalProvider");return t}const yi=De.create("NotificationContext"),Td=d.createContext(),yg={notifications:[],unreadCount:0,loading:!1,socketConnected:!1};function _g(t,{type:e,payload:s}){switch(e){case"SET_LOADING":return{...t,loading:s};case"SET_NOTIFICATIONS":return{...t,notifications:s,unreadCount:s.filter(r=>!r.read).length};case"ADD_NOTIFICATION":return t.notifications.some(r=>(r._id||r.id)===(s._id||s.id))?t:{...t,notifications:[s,...t.notifications],unreadCount:t.unreadCount+(s.read?0:1)};case"MARK_AS_READ":return{...t,notifications:t.notifications.map(r=>(r._id||r.id)===s?{...r,read:!0}:r),unreadCount:Math.max(0,t.unreadCount-(t.notifications.find(r=>(r._id||r.id)===s&&!r.read)?1:0))};case"MARK_ALL_AS_READ":return{...t,notifications:t.notifications.map(r=>({...r,read:!0})),unreadCount:0};case"SET_SOCKET_CONNECTED":return{...t,socketConnected:s};default:return t}}function vg({children:t}){const{user:e,isAuthenticated:s}=Gt(),{openProfileModal:r}=jd(),o=Zt(),[i,c]=d.useReducer(_g,yg),l=d.useRef(null),f=d.useCallback(async()=>{c({type:"SET_LOADING",payload:!0});try{const g=await ws.getNotifications();return c({type:"SET_NOTIFICATIONS",payload:g}),g}catch(g){return yi.error("fetchNotifications",g),[]}finally{c({type:"SET_LOADING",payload:!1})}},[]);d.useEffect(()=>{ws.setNavigate(o)},[o]),d.useEffect(()=>{var A;if(!s||!e){c({type:"SET_NOTIFICATIONS",payload:[]});return}const g=((A=e.settings)==null?void 0:A.notifications)??{};ws.initialize({notifications:g}),f();const C=ws.addListener(({notifications:P})=>{c({type:"SET_NOTIFICATIONS",payload:P})});return()=>C()},[s,e,f]),d.useEffect(()=>{if(!s)return;const g=(R,j)=>{var k,F,O,L,E;if(c({type:"ADD_NOTIFICATION",payload:R}),j==="newLike")H.success(n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx(nn,{className:"pulse"}),n.jsx("span",{style:{marginLeft:8},children:R.isMatch?`It's a match with ${((k=R.sender)==null?void 0:k.nickname)||"Someone"}!`:`${((F=R.sender)==null?void 0:F.nickname)||"Someone"} liked you`})]}),{autoClose:5e3});else if(j==="photoPermissionRequest")H.info(n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("div",{style:{backgroundColor:"#3897f0",borderRadius:"50%",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px"},children:n.jsx(Hs,{})}),n.jsx("span",{children:`${((O=R.sender)==null?void 0:O.nickname)||"Someone"} requested access to your private photos`})]}),{autoClose:6e3,closeButton:!0,icon:"🔒"});else if(j==="photoPermissionResponse"){const M=((L=R.data)==null?void 0:L.status)==="approved";H[M?"success":"info"](n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("div",{style:{backgroundColor:M?"#43a047":"#757575",borderRadius:"50%",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px"},children:M?n.jsx(mt,{}):n.jsx(rs,{})}),n.jsxs("span",{children:[((E=R.sender)==null?void 0:E.nickname)||"Someone"," ",M?"approved":"declined"," your photo request"]})]}),{autoClose:6e3,closeButton:!0,icon:M?"🔓":"🔒"})}else H.info(R.message||R.content||"New notification",{autoClose:4e3})},C=()=>{c({type:"SET_SOCKET_CONNECTED",payload:!0}),f()},A=()=>{c({type:"SET_SOCKET_CONNECTED",payload:!1})},P=[Ne.on("notification",R=>g(R,"notification")),Ne.on("newMessage",R=>g(R,"newMessage")),Ne.on("newLike",R=>g(R,"newLike")),Ne.on("photoPermissionRequestReceived",R=>{yi.info("Received photo permission request notification:",R),g(R,"photoPermissionRequest")}),Ne.on("photoPermissionResponseReceived",R=>{yi.info("Received photo permission response notification:",R),g(R,"photoPermissionResponse")}),Ne.on("newComment",R=>g(R,"newComment")),Ne.on("incomingCall",R=>g(R,"incomingCall")),Ne.on("connect",C),Ne.on("disconnect",A)];return c({type:"SET_SOCKET_CONNECTED",payload:Ne.isConnected()}),()=>{P.forEach(R=>{typeof R=="function"&&R()})}},[s,f]),d.useEffect(()=>(clearInterval(l.current),s&&!i.socketConnected&&(l.current=setInterval(()=>{var g;Ne.isConnected()||(f(),(g=Ne.reconnect)==null||g.call(Ne))},3e4)),()=>clearInterval(l.current)),[s,i.socketConnected,f]);const h=d.useCallback(()=>{const g=ws.addTestNotification();c({type:"ADD_NOTIFICATION",payload:g}),H.info("Test notification added")},[]),a=d.useCallback(g=>{c({type:"MARK_AS_READ",payload:g}),ws.markAsRead(g)},[]),p=d.useCallback(()=>{c({type:"MARK_ALL_AS_READ"}),ws.markAllAsRead()},[]),_=d.useCallback(g=>{var j,k,F,O,L,E,M;if(!g)return;const C=g._id||g.id;g.read||a(C);const A=g.type,P=g.data||{},R=((j=g.sender)==null?void 0:j._id)||((k=P.sender)==null?void 0:k._id)||((F=P.requester)==null?void 0:F._id)||((O=P.user)==null?void 0:O._id)||((L=P.owner)==null?void 0:L._id)||A==="match"&&((E=P.matchedUser)==null?void 0:E._id)||A==="comment"&&((M=P.commenter)==null?void 0:M._id);(A==="message"||A==="newMessage")&&R?o(`/messages/${R}`):R&&r&&r(R)},[a,o,r]),N=d.useMemo(()=>({notifications:i.notifications,unreadCount:i.unreadCount,loading:i.loading,socketConnected:i.socketConnected,fetchNotifications:f,addTestNotification:h,markAsRead:a,markAllAsRead:p,handleNotificationClick:_}),[i,f,h,a,p,_]);return n.jsx(Td.Provider,{value:N,children:t})}function Ed(){const t=d.useContext(Td);if(!t)throw new Error("useNotifications must be used within NotificationProvider");return t}const qt=De.create("ChatService"),wg=tn.TTL.MESSAGES,bg=tn.TTL.CONVERSATIONS,xg=xt.TIMEOUT.INIT,Sg=xt.TIMEOUT.ACK,Cg=rn.FETCH.MESSAGES,kg=rn.MESSAGE.DEDUPLICATION,Ng=rn.MESSAGE.PENDING_EXPIRY,_i="mandarin_file_urls",vi="mandarin_file_urls_by_hash";function Nc(t){return typeof t=="string"&&/^[0-9a-fA-F]{24}$/.test(t)}function jg(){try{const t=ls();if(!t)return null;const e=JSON.parse(atob(t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")));return e.id||e.sub||e.user&&(e.user._id||e.user._id)}catch{return null}}class Tg{constructor(){this.initialized=!1,this.user=null,this.initPromise=null,this.activeChats=new Map,this.eventListeners=new Map,this.messageCache=new Map,this.messageCacheTs=new Map,this.conversationsCache=null,this.conversationsTs=0,this.processed=new Set,this.pendingMessages=[],this.socketUnsubscribers=[],this._registerSocketHandlers()}_registerSocketHandlers(){Ne.on("connect",()=>{qt.info("Socket connected – processing pending messages"),this._processPending(),this._notify("connectionChanged",{connected:!0})}),Ne.on("disconnect",()=>{qt.warn("Socket disconnected"),this._notify("connectionChanged",{connected:!1})})}async initialize(e){var s;return this.initialized&&((s=this.user)==null?void 0:s._id)===(e==null?void 0:e._id)?!0:this.initPromise?this.initPromise:(this.initPromise=new Promise(async(r,o)=>{const i=setTimeout(()=>o(new Error("Init timeout")),xg);try{let c=e==null?void 0:e._id;if(Nc(c)||(c=jg()),!Nc(c))throw new Error("Invalid user ID");this.user={...e,_id:c,id:c},qt.info(`Initializing ChatService for ${c}`);const l=ls();l&&!Ne.isConnected()&&Ne.init(c,l),this._setupSocketListeners(),this.initialized=!0,clearTimeout(i),r(!0)}catch(c){clearTimeout(i),qt.error("Initialization failed:",c),this.initialized=!0,r(!0)}finally{this.initPromise=null}}),this.initPromise)}_setupSocketListeners(){this._cleanupSocketListeners();const e=(s,r)=>{const o=Ne.on(s,r);this.socketUnsubscribers.push(o)};e("messageReceived",s=>this._onSocketMessage(s,!1)),e("messageSent",s=>this._onSocketMessage(s,!0)),e("messageError",s=>this._notify("messageError",s)),e("typing",s=>{s&&s.userId&&this._notify("userTyping",s)})}_cleanupSocketListeners(){this.socketUnsubscribers.forEach(e=>e()),this.socketUnsubscribers=[]}_onSocketMessage(e,s){s?e._id:e.sender;const r=s?e.recipient:e.sender;this._cacheMessage(r,e),this._notify(s?"messageUpdated":"messageReceived",e)}_cacheMessage(e,s){if(!e||!s)return;const r=`${s._id||s.tempId}-${e}`;if(this.processed.has(r))return;this.processed.add(r),setTimeout(()=>this.processed.delete(r),kg);let o=this.messageCache.get(e)||[];const i=o.findIndex(c=>c._id===s._id||c.tempId===s.tempId);i>=0?o[i]={...o[i],...s}:o.push(s),o.sort((c,l)=>new Date(c.createdAt)-new Date(l.createdAt)),this.messageCache.set(e,o),this.messageCacheTs.set(e,Date.now())}async getMessages(e,s=1,r=20){if(await this.initialize(this.user||{}),!e)return[];const o=Date.now(),i=this.messageCache.get(e)||[],c=o-(this.messageCacheTs.get(e)||0)<wg;if(s===1&&i.length&&c)return qt.debug(`getMessages: using cache for ${e}`),i;try{qt.debug(`getMessages: fetching page ${s} for ${e}`);const f=await Promise.race([Ae.get(`/messages/${e}`,{page:s,limit:r,_t:o}),new Promise((h,a)=>setTimeout(()=>a(new Error("Timeout")),Cg))]);if(f.success&&Array.isArray(f.data)){const h=f.data.map(a=>({...a,tempId:a.tempId||null,createdAt:a.createdAt||new Date().toISOString()})).sort((a,p)=>new Date(a.createdAt)-new Date(p.createdAt));return s===1&&(this.messageCache.set(e,h),this.messageCacheTs.set(e,o)),h}throw new Error(f.error||"Invalid response")}catch(f){return qt.warn(`getMessages failed, fallback to cache: ${f.message}`),i}}async sendMessage(e,s,r="text",o={}){if(await this.initialize(this.user||{}),!e)throw new Error("Recipient required");const i=`temp-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,c={tempId:i,_id:i,sender:this.user._id,recipient:e,content:s,type:r,metadata:o,createdAt:new Date().toISOString(),status:"sending",pending:!0};return this._cacheMessage(e,c),Ne.isConnected()?new Promise((l,f)=>{let h=!1;const a=g=>{g.tempId===i&&(h=!0,this._cacheMessage(e,{...g,status:"sent",pending:!1}),_(),l(g))},p=g=>{g.tempId===i&&(h=!0,this._cacheMessage(e,{...c,status:"error",error:g.error||g.message}),_(),f(g))},_=()=>{clearTimeout(N),Ne.off("messageSent",a),Ne.off("messageError",p)};Ne.on("messageSent",a),Ne.on("messageError",p),Ne.emit("sendMessage",{recipientId:e,content:s,type:r,metadata:o,tempId:i});const N=setTimeout(()=>{h||(_(),qt.warn(`Socket ack timeout for ${i}, falling back to API`),this.pendingMessages.push({recipientId:e,content:s,type:r,metadata:o,tempId:i}),this._sendViaApi(e,s,r,o,i).then(l).catch(f))},Sg)}):(qt.warn("Socket disconnected – sending via API"),this.pendingMessages.push({recipientId:e,content:s,type:r,metadata:o,tempId:i}),this._sendViaApi(e,s,r,o,i))}async _sendViaApi(e,s,r,o,i){this._cacheMessage(e,{tempId:i,status:"sending-api"});try{const c=await Ae.post("/messages",{recipient:e,content:s,type:r,metadata:o});if(!c.success||!c.data)throw new Error(c.error||"API send failed");const l={...c.data,tempId:i,status:"sent",pending:!1};return this._cacheMessage(e,l),l}catch(c){throw qt.error(`API sendMessage error: ${c.message}`),this._cacheMessage(e,{tempId:i,status:"error",error:c.message}),c}}_processPending(){if(!Ne.isConnected())return;const e=[...this.pendingMessages];this.pendingMessages=[],e.forEach(s=>{Date.now()-s.timestamp>Ng||Ne.emit("sendMessage",{recipientId:s.recipientId||s.recipient,content:s.content,type:s.type,metadata:s.metadata,tempId:s.tempId})})}async markConversationRead(e){if(!this.initialized||!e)return null;try{const s=await Ae.put(`/messages/conversation/${e}/read`),o=(this.messageCache.get(e)||[]).map(i=>i.sender===e?{...i,read:!0,readAt:new Date().toISOString()}:i);return this.messageCache.set(e,o),s}catch(s){return qt.error(`markConversationRead failed: ${s.message}`),null}}async getConversations(){await this.initialize(this.user||{});const e=Date.now();if(this.conversationsCache&&e-this.conversationsTs<bg)return this.conversationsCache;const s=[this._fetchDirect(),Ae.get("/messages/conversations").then(r=>{if(r.success)return r.data;throw new Error})];try{const r=await Promise.any(s);if(Array.isArray(r))return this.conversationsCache=r,this.conversationsTs=e,r;throw new Error("Bad data")}catch{return this.conversationsCache||[]}}async _fetchDirect(){try{const e=await Ae.get("/messages/conversations",{},{headers:{"Cache-Control":"no-cache"}});return Array.isArray(e.data)?e.data:[]}catch(e){return qt.error("Failed to fetch conversations directly:",e),[]}}sendTypingIndicator(e){return this.initialized&&Ne.isConnected()&&e?typeof Ne.sendTyping=="function"?Ne.sendTyping(e):Ne.emit("typing",{recipientId:e}):!1}on(e,s){return this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(s),()=>this.eventListeners.get(e).delete(s)}_notify(e,s){const r=this.eventListeners.get(e);r&&r.forEach(o=>{try{o(s)}catch(i){qt.error(`Listener ${e} error:`,i)}})}isReady(){var e;return this.initialized&&!!((e=this.user)!=null&&e._id)}isConnected(){return Ne.isConnected()}_initFileCache(){if(!this._fileUrlCache){qt.debug("Initializing file URL caches"),this._fileUrlCache={},this._fileUrlCacheByHash={};try{const e=localStorage.getItem(_i);if(e){const r=JSON.parse(e);r&&typeof r=="object"&&(this._fileUrlCache=r,qt.debug(`Restored ${Object.keys(r).length} file URLs from localStorage`))}const s=localStorage.getItem(vi);if(s){const r=JSON.parse(s);r&&typeof r=="object"&&(this._fileUrlCacheByHash=r,qt.debug(`Restored ${Object.keys(r).length} file URLs by hash`))}else Object.keys(this._fileUrlCache).length>0&&this._rebuildHashCache()}catch(e){qt.error("Failed to load persisted file URLs",e),this._fileUrlCache={},this._fileUrlCacheByHash={}}}}_rebuildHashCache(){qt.debug("Building hash-based cache from ID-based cache"),Object.entries(this._fileUrlCache).forEach(([e,s])=>{if(s!=null&&s.url){const r=s.hash||this._generateMessageHash(s);r&&(this._fileUrlCacheByHash[r]={...s,id:e})}}),this._persistFileCaches()}_generateMessageHash(e){if(!e)return"";const s=e.fileName||"",r=e.timestamp?new Date(e.timestamp).toISOString().substring(0,16):"";return`${s}-${r}`}_persistFileCaches(){try{localStorage.setItem(_i,JSON.stringify(this._fileUrlCache)),localStorage.setItem(vi,JSON.stringify(this._fileUrlCacheByHash))}catch(e){qt.error("Failed to persist file URL caches",e)}}getFileUrl(e){return this._initFileCache(),this._fileUrlCache[e]||null}getFileUrlByHash(e){return this._initFileCache(),this._fileUrlCacheByHash[e]||null}addFileUrl(e,s){if(this._initFileCache(),!e||!(s!=null&&s.url))return;const r={...s,timestamp:s.timestamp||new Date().toISOString()};r.hash||(r.hash=this._generateMessageHash(r)),this._fileUrlCache[e]=r,r.hash&&(this._fileUrlCacheByHash[r.hash]={...r,id:e}),this._persistFileCaches()}removeFileUrl(e){this._initFileCache();const s=this._fileUrlCache[e];s&&(s.hash&&this._fileUrlCacheByHash[s.hash]&&delete this._fileUrlCacheByHash[s.hash],delete this._fileUrlCache[e],this._persistFileCaches())}clearFileCaches(){this._fileUrlCache={},this._fileUrlCacheByHash={};try{localStorage.removeItem(_i),localStorage.removeItem(vi)}catch(e){qt.error("Failed to clear file URL caches from localStorage",e)}}cleanup(){this._cleanupSocketListeners(),this.eventListeners.clear(),this.messageCache.clear(),this.messageCacheTs.clear(),this.pendingMessages=[],this.initialized=!1,this.user=null,this.conversationsCache=null,this.conversationsTs=0,this.processed.clear(),qt.info("ChatService cleaned up")}}const pt=new Tg,vs=De.create("ChatContext"),Ad=d.createContext();function Eg({children:t}){const{user:e,isAuthenticated:s}=Gt(),[r,o]=d.useState(!1),[i,c]=d.useState(!1),[l,f]=d.useState(null),[h,a]=d.useState(!1),[p,_]=d.useState([]),[N,g]=d.useState([]),[C,A]=d.useState(null),[P,R]=d.useState(!1),[j,k]=d.useState(!0),[F,O]=d.useState(1),[L,E]=d.useState(!1),[M,I]=d.useState(!1),v=d.useRef(!0),b=d.useRef([]),B=d.useRef(null);d.useEffect(()=>(v.current=!0,(async()=>{if(!(!s||!(e!=null&&e._id))){c(!0),f(null);try{vs.info("Initializing chat service..."),await pt.initialize(e),v.current&&(o(!0),a(pt.isConnected()),$())}catch(me){vs.error("Failed to initialize chat service:",me),v.current&&(f(me.message||"Failed to initialize chat"),o(!0))}finally{v.current&&c(!1)}}})(),()=>{v.current=!1,x()}),[s,e]);const $=d.useCallback(()=>{x();const de=[];de.push(pt.on("connectionChanged",({connected:me})=>{v.current&&a(me)})),de.push(pt.on("messageReceived",me=>{v.current&&(C===me.sender&&(_(se=>se.some(he=>he._id===me._id)?se:[...se,me].sort((he,Ue)=>new Date(he.createdAt)-new Date(Ue.createdAt))),pt.markConversationRead(me.sender)),z(me))})),de.push(pt.on("messageSent",me=>{v.current&&(C===me.recipient&&G(me),z(me))})),de.push(pt.on("messageError",me=>{v.current&&(me.tempId&&_(se=>se.map(he=>he.tempId===me.tempId?{...he,status:"error",error:!0,errorMessage:me.error}:he)),I(!1),f(me.error||"Error sending message"))})),de.push(pt.on("userTyping",me=>{v.current&&C===me.userId&&(R(!0),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{v.current&&R(!1)},3e3))})),b.current=de},[C]),x=d.useCallback(()=>{b.current.length>0&&(b.current.forEach(de=>{typeof de=="function"&&de()}),b.current=[]),B.current&&(clearTimeout(B.current),B.current=null)},[]),z=d.useCallback(de=>{g(me=>{const se=me.findIndex(Ue=>Ue._id===(de.recipient===(e==null?void 0:e._id)?de.sender:de.recipient));if(se===-1)return me;const he=[...me];return he[se]={...he[se],lastMessage:de,unreadCount:C===he[se]._id?0:(he[se].unreadCount||0)+1},he.sort((Ue,Me)=>{var He,wt;const ht=(He=Ue.lastMessage)!=null&&He.createdAt?new Date(Ue.lastMessage.createdAt):new Date(0);return((wt=Me.lastMessage)!=null&&wt.createdAt?new Date(Me.lastMessage.createdAt):new Date(0))-ht})})},[C,e]),G=d.useCallback(de=>{_(me=>me.map(se=>se._id===de._id||se.tempId===de.tempId?{...se,...de,status:"sent",pending:!1,error:!1}:se))},[]),Y=d.useCallback(async()=>{if(!r||!s)return vs.warn("Not initialized or authenticated, can't get conversations"),[];try{vs.info("ChatContext: Getting conversations from service");const de=await pt.getConversations();return vs.info(`ChatContext: Got ${(de==null?void 0:de.length)||0} conversations from service`),v.current&&Array.isArray(de)?(vs.info("ChatContext: Setting conversations in state"),g(de),de):(vs.warn("ChatContext: Got non-array or component unmounted, returning empty array"),[])}catch(de){return vs.error("Failed to fetch conversations:",de),[]}},[r,s]),oe=d.useCallback(de=>{de!==C&&(A(de),de&&r&&(pt.markConversationRead(de),O(1),k(!0),R(!1),le(de)))},[C,r]),le=d.useCallback(async(de,me=!1)=>{if(!de||!r||i&&!me)return p;c(!0),f(null);try{const se=await pt.getMessages(de);if(!v.current)return[];if(C===de){const he=[],Ue=new Set;[...se].reverse().forEach(Me=>{Ue.has(Me._id)||(he.push(Me),Ue.add(Me._id))}),_(he),k(se.length>=20),O(1)}return se}catch(se){return vs.error("Failed to load messages:",se),v.current&&f(se.message||"Failed to load messages"),[]}finally{v.current&&c(!1)}},[C,r,i,p]),ye=d.useCallback(async()=>{if(!C||!r||L||!j)return[];E(!0);try{const de=F+1,me=await pt.getMessages(C,de);return v.current?(Array.isArray(me)&&me.length>0?(_(se=>{const he=[...se],Ue=new Set(se.map(Me=>Me._id));return me.forEach(Me=>{Ue.has(Me._id)||(he.push(Me),Ue.add(Me._id))}),he.sort((Me,ht)=>new Date(Me.createdAt)-new Date(ht.createdAt))}),k(me.length>=20),O(de)):k(!1),me):[]}catch(de){return vs.error("Failed to load more messages:",de),f("Failed to load more messages"),[]}finally{E(!1)}},[C,r,L,j,F]),K=d.useCallback(async(de,me="text",se=null)=>{if(!C||!r||!h){const he="Cannot send message: Chat is not ready";throw vs.error(he),new Error(he)}I(!0);try{const he=new Date;if(p.some(He=>He.content===de&&He.type===me&&He.sender===(e==null?void 0:e._id)&&He.recipient===C&&he-new Date(He.createdAt)<5e3))return vs.debug("Skipping duplicate message send"),I(!1),null;const Me=`temp-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,ht={_id:Me,tempId:Me,sender:e._id,recipient:C,content:de,type:me,metadata:se||{},createdAt:new Date().toISOString(),status:"sending",pending:!0};_(He=>[...He,ht].sort((wt,ft)=>new Date(wt.createdAt)-new Date(ft.createdAt)));const gt=await pt.sendMessage(C,de,me,se);return v.current&&(_(He=>He.map(wt=>wt.tempId===Me?{...wt,...gt,status:"sent",pending:!1}:wt)),I(!1)),gt}catch(he){throw vs.error("Failed to send message:",he),v.current&&(f(he.message||"Failed to send message"),I(!1)),he}},[C,r,h,p,e]),ae=d.useCallback(()=>{C&&r&&h&&pt.sendTypingIndicator(C)},[C,r,h]),ue=d.useCallback(()=>{f(null)},[]),we=d.useCallback(()=>C?le(C,!0):Promise.resolve([]),[C,le]),Pe=d.useCallback(de=>de&&r?pt.markConversationRead(de):Promise.resolve(null),[r]),ce={initialized:r,loading:i,error:l,isConnected:h,messages:p,conversations:N,activeConversation:C,typingStatus:P,hasMore:j,loadingMore:L,sending:M,user:e,isAuthenticated:s,getConversations:Y,setActiveConversation:oe,loadMessages:le,loadMoreMessages:ye,sendMessage:K,sendTyping:ae,resetError:ue,refresh:we,markConversationRead:Pe};return n.jsx(Ad.Provider,{value:ce,children:t})}const Ag=()=>{const t=d.useContext(Ad);if(!t)throw new Error("useChat must be used within a ChatProvider");return t},Ig=(t,e,s,r)=>{var i,c,l,f;const o=[s,{code:e,...r||{}}];if((c=(i=t==null?void 0:t.services)==null?void 0:i.logger)!=null&&c.forward)return t.services.logger.forward(o,"warn","react-i18next::",!0);An(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),(f=(l=t==null?void 0:t.services)==null?void 0:l.logger)!=null&&f.warn?t.services.logger.warn(...o):console!=null&&console.warn&&console.warn(...o)},jc={},Ki=(t,e,s,r)=>{An(s)&&jc[s]||(An(s)&&(jc[s]=new Date),Ig(t,e,s,r))},Id=(t,e)=>()=>{if(t.isInitialized)e();else{const s=()=>{setTimeout(()=>{t.off("initialized",s)},0),e()};t.on("initialized",s)}},Ji=(t,e,s)=>{t.loadNamespaces(e,Id(t,s))},Tc=(t,e,s,r)=>{if(An(s)&&(s=[s]),t.options.preload&&t.options.preload.indexOf(e)>-1)return Ji(t,s,r);s.forEach(o=>{t.options.ns.indexOf(o)<0&&t.options.ns.push(o)}),t.loadLanguages(e,Id(t,r))},$g=(t,e,s={})=>!e.languages||!e.languages.length?(Ki(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:s.lng,precheck:(r,o)=>{var i;if(((i=s.bindI18n)==null?void 0:i.indexOf("languageChanging"))>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!o(r.isLanguageChangingTo,t))return!1}}),An=t=>typeof t=="string",Pg=t=>typeof t=="object"&&t!==null,Rg=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Lg={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Og=t=>Lg[t],Mg=t=>t.replace(Rg,Og);let Qi={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Mg};const Bg=(t={})=>{Qi={...Qi,...t}},Fg=()=>Qi;let $d;const Dg=t=>{$d=t},Ug=()=>$d,qg={type:"3rdParty",init(t){Bg(t.options.react),Dg(t)}},zg=d.createContext();class Hg{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Vg=(t,e)=>{const s=d.useRef();return d.useEffect(()=>{s.current=t},[t,e]),s.current},Pd=(t,e,s,r)=>t.getFixedT(e,s,r),Wg=(t,e,s,r)=>d.useCallback(Pd(t,e,s,r),[t,e,s,r]),Pt=(t,e={})=>{var k,F,O,L;const{i18n:s}=e,{i18n:r,defaultNS:o}=d.useContext(zg)||{},i=s||r||Ug();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new Hg),!i){Ki(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const E=(I,v)=>An(v)?v:Pg(v)&&An(v.defaultValue)?v.defaultValue:Array.isArray(I)?I[I.length-1]:I,M=[E,{},!1];return M.t=E,M.i18n={},M.ready=!1,M}(k=i.options.react)!=null&&k.wait&&Ki(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const c={...Fg(),...i.options.react,...e},{useSuspense:l,keyPrefix:f}=c;let h=o||((F=i.options)==null?void 0:F.defaultNS);h=An(h)?[h]:h||["translation"],(L=(O=i.reportNamespaces).addUsedNamespaces)==null||L.call(O,h);const a=(i.isInitialized||i.initializedStoreOnce)&&h.every(E=>$g(E,i,c)),p=Wg(i,e.lng||null,c.nsMode==="fallback"?h:h[0],f),_=()=>p,N=()=>Pd(i,e.lng||null,c.nsMode==="fallback"?h:h[0],f),[g,C]=d.useState(_);let A=h.join();e.lng&&(A=`${e.lng}${A}`);const P=Vg(A),R=d.useRef(!0);d.useEffect(()=>{const{bindI18n:E,bindI18nStore:M}=c;R.current=!0,!a&&!l&&(e.lng?Tc(i,e.lng,h,()=>{R.current&&C(N)}):Ji(i,h,()=>{R.current&&C(N)})),a&&P&&P!==A&&R.current&&C(N);const I=()=>{R.current&&C(N)};return E&&(i==null||i.on(E,I)),M&&(i==null||i.store.on(M,I)),()=>{R.current=!1,i&&(E==null||E.split(" ").forEach(v=>i.off(v,I))),M&&i&&M.split(" ").forEach(v=>i.store.off(v,I))}},[i,A]),d.useEffect(()=>{R.current&&a&&C(_)},[i,f,a]);const j=[g,i,a];if(j.t=g,j.i18n=i,j.ready=a,a||!a&&!l)return j;throw new Promise(E=>{e.lng?Tc(i,e.lng,h,()=>E()):Ji(i,h,()=>E())})},vr=De.create("LanguageContext"),Rd=d.createContext();function Gg({children:t}){const{i18n:e}=Pt(),[s,r]=d.useState(localStorage.getItem("language")||"en"),[o,i]=d.useState(s==="he"),c=a=>{try{vr.info("Changing language to:",a),e.changeLanguage(a),r(a),i(a==="he"),localStorage.setItem("language",a),document.documentElement.dir=a==="he"?"rtl":"ltr",document.documentElement.lang=a,document.body.classList.remove("rtl","ltr"),document.body.classList.add(a==="he"?"rtl":"ltr"),window.dispatchEvent(new CustomEvent("languageDirectionChanged",{detail:{isRTL:a==="he",language:a}})),vr.info("Language changed successfully to:",a,"RTL:",a==="he")}catch(p){vr.error("Error changing language:",p)}};d.useEffect(()=>{const a=localStorage.getItem("language");if(a){c(a);return}(async()=>{try{const _=Intl.DateTimeFormat().resolvedOptions().timeZone,N=_==="Asia/Jerusalem",g=navigator.language.split("-")[0],C=g==="he"||navigator.language==="he-IL",P=new URLSearchParams(window.location.search).get("country"),R=P==="IL"||P==="Israel",j=window.__userCountry==="IL"||window.__userCountry==="Israel",k=N||C||R||j;vr.info("Israeli user detection:",{timeZone:_,isIsraeliTimeZone:N,browserLanguage:g,isHebrewLanguage:C,countryParam:P,isIsraeliParam:R,isIsraeliIP:j,result:k}),c(k||g==="he"?"he":"en")}catch(_){vr.error("Error detecting user location:",_);const g=navigator.language.split("-")[0]==="he"?"he":"en";c(g)}})()},[]);const l=()=>{var a,p;return((p=(a=e.options)==null?void 0:a.supportedLngs)==null?void 0:p.filter(_=>_!=="cimode"))||["en","he"]},f=a=>a==="en"?"English":a==="he"?"עברית":a,h={language:s,isRTL:o,changeLanguage:c,t:e.t,supportedLanguages:l(),getLanguageDisplayName:f};return n.jsx(Rd.Provider,{value:h,children:t})}function Ht(){const t=d.useContext(Rd);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t}const Ec=De.create("useApi"),Ld=(t={})=>{const[e,s]=d.useState(!1),[r,o]=d.useState(null),[i,c]=d.useState(null),l=d.useRef({}),f=d.useCallback(()=>{Object.values(l.current).forEach(R=>{typeof R=="function"&&R()}),l.current={}},[]),h=d.useCallback(async(R,j={})=>{const{onSuccess:k,onError:F,key:O="default"}=j;s(!0),o(null);try{const L=await R();if(!L)return t.logErrors!==!1&&Ec.warn("API response is null or undefined"),delete l.current[O],null;if(!L.success)throw new Error(L.error||"API request failed");return L.data!==void 0&&c(L.data),delete l.current[O],k&&k(L.data),L.data}catch(L){const E=L.error||L.message||"An error occurred",I=O&&typeof O=="string"&&["/users/photo-permissions","/users/photo-permissions/pending","/photo-permissions","/photo-access","/blocked"].some(v=>O.includes(v));return!I&&!L.silenced&&o(E),delete l.current[O],F&&F(E),t.logErrors!==!1&&!I&&!L.silenced&&Ec.error(`API error: ${E}`,L),null}finally{s(!1)}},[t.logErrors]),a=(R={})=>{const j={...R};if(!j.Authorization&&!j["x-auth-token"]){const k=localStorage.getItem("token")||sessionStorage.getItem("token")||localStorage.getItem("authToken")||sessionStorage.getItem("authToken");k&&(j.Authorization=`Bearer ${k}`,j["x-auth-token"]=k)}return j},p=d.useCallback((R,j,k={})=>{const F=k.key||R;l.current[F]&&t.cancelDuplicates&&l.current[F]();const{request:O,cancel:L}=Ae.createCancelableRequest();return l.current[F]=L,h(()=>{const E=a();return Ae.get(R,j,{request:O,headers:E})},{...k,key:F})},[h,t.cancelDuplicates]),_=d.useCallback((R,j,k={})=>{const F=k.key||R;l.current[F]&&t.cancelDuplicates&&l.current[F]();const{request:O,cancel:L}=Ae.createCancelableRequest();return l.current[F]=L,h(()=>{const E=a();return Ae.post(R,j,{request:O,headers:E})},{...k,key:F})},[h,t.cancelDuplicates]),N=d.useCallback((R,j,k={})=>{const F=k.key||R;l.current[F]&&t.cancelDuplicates&&l.current[F]();const{request:O,cancel:L}=Ae.createCancelableRequest();return l.current[F]=L,h(()=>{const E=a();return Ae.put(R,j,{request:O,headers:E})},{...k,key:F})},[h,t.cancelDuplicates]),g=d.useCallback((R,j,k={})=>{const F=k.key||R;l.current[F]&&t.cancelDuplicates&&l.current[F]();const{request:O,cancel:L}=Ae.createCancelableRequest();return l.current[F]=L,h(()=>{const E=a();return Ae.delete(R,j,{request:O,headers:E})},{...k,key:F})},[h,t.cancelDuplicates]),C=d.useCallback((R,j,k,F={})=>{const O=F.key||R;l.current[O]&&t.cancelDuplicates&&l.current[O]();const{request:L,cancel:E}=Ae.createCancelableRequest();return l.current[O]=E,h(()=>Ae.upload(R,j,k,{request:L}),{...F,key:O})},[h,t.cancelDuplicates]),A=d.useCallback(()=>{o(null)},[]),P=d.useCallback(()=>{s(!1),o(null),c(null)},[]);return{loading:e,error:r,data:i,get:p,post:_,put:N,delete:g,upload:C,clearError:A,reset:P,cancelAllRequests:f}};d.createContext(null);const Yg=De.create("ErrorBoundary");class Od extends d.Component{constructor(e){super(e),this.state={hasError:!1,errorMessage:"",errorStack:""}}static getDerivedStateFromError(e){return{hasError:!0,errorMessage:e.message||"An unknown error occurred"}}componentDidCatch(e,s){const r=e.message||"An unknown error occurred",o=e.stack||s.componentStack||"";Yg.error("ErrorBoundary caught an error",r,o),this.setState({errorMessage:r,errorStack:o})}render(){return this.state.hasError?n.jsxs("div",{className:"error-boundary",children:[n.jsx("h1",{children:"Something went wrong"}),n.jsx("p",{children:"We're sorry, but an error occurred. Please try refreshing the page."}),n.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Refresh Page"}),!1]}):this.props.children}}var wi={exports:{}},bi,Ac;function Kg(){if(Ac)return bi;Ac=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return bi=t,bi}var xi,Ic;function Jg(){if(Ic)return xi;Ic=1;var t=Kg();function e(){}function s(){}return s.resetWarningCache=e,xi=function(){function r(c,l,f,h,a,p){if(p!==t){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}r.isRequired=r;function o(){return r}var i={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:o,element:r,elementType:r,instanceOf:o,node:r,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:s,resetWarningCache:e};return i.PropTypes=i,i},xi}var $c;function Qg(){return $c||($c=1,wi.exports=Jg()()),wi.exports}var Xg=Qg();const w=gn(Xg),Is=De.create("usePhotoManagement"),Pn=()=>{const t=Ld(),{refreshUserData:e}=_n(),[s,r]=d.useState(!1),[o,i]=d.useState(0),[c,l]=d.useState(!1),[f,h]=d.useState({}),a=d.useRef(!1),p=d.useCallback(L=>{const E=typeof window<"u"?window.__url_normalization_cache:null;L?E&&(E.delete(L),E.delete(`${L}:true`),Is.debug(`Cleared cache for specific URL: ${L}`)):E&&(E.clear(),Is.debug("Cleared entire URL cache"))},[]),_=d.useCallback(()=>`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[]),N=d.useCallback(async(L,E="private",M,I=!1)=>{if(!L)throw new Error("No file provided");if(L.type.split("/")[0]!=="image")throw new Error("File must be an image");const b=5*1024*1024;if(L.size>b)throw new Error("File size exceeds 5MB limit");E&&!["public","private","friends_only"].includes(E)&&(E="private"),r(!0),i(0);try{const B=new FormData;B.append("photo",L),B.append("privacy",E),I&&B.append("isProfile","true");const $=await t.upload("/users/photos",B,x=>{const z=Math.round(x.loaded*100/x.total);i(z),M&&typeof M=="function"&&M(z)});if(O(),await new Promise(x=>setTimeout(x,300)),$&&$.success&&$.data)return $.data;if($&&$.photo)return $.photo;throw new Error(($==null?void 0:$.error)||"Failed to upload photo")}catch(B){throw Is.error("Photo upload error:",B),B}finally{r(!1),i(0)}},[t,p]),g=d.useCallback(async(L,E,M)=>{if(!L)throw new Error("No photo ID provided");if(!["public","private","friends_only"].includes(E))throw new Error("Privacy must be 'public', 'private', or 'friends_only'");if(!a.current){if(typeof L=="string"&&L.startsWith("temp-")){H.warning("Please wait for the photo to finish uploading");return}a.current=!0,l(!0);try{const I=await t.put(`/users/photos/${L}/privacy`,{privacy:E}),v=(I==null?void 0:I.data)||I;return O(),M&&await e(M,!0),v}catch(I){throw Is.error("Photo privacy update error:",I),I}finally{a.current=!1,l(!1)}}},[t,e]),C=d.useCallback(async(L,E)=>{if(!L)throw new Error("No photo ID provided");if(!a.current){if(typeof L=="string"&&L.startsWith("temp-")){H.warning("Please wait for the photo to finish uploading");return}a.current=!0,l(!0);try{const M=await t.get("/auth/me");if(!M||!M.photos)throw new Error("Failed to get user information");const I=M.photos.find(B=>B._id===L);if(!I)throw new Error("Photo not found");const b=(I.privacy||"private")==="private"?"public":"private";return await g(L,b,E)}catch(M){throw Is.error("Photo privacy toggle error:",M),M}finally{a.current=!1,l(!1)}}},[t,e,g]),A=d.useCallback(async(L,E)=>{var M;if(!L)throw new Error("No photo ID provided");if(!a.current){if(typeof L=="string"&&L.startsWith("temp-")){H.warning("Please wait for the photo to finish uploading");return}a.current=!0,l(!0);try{const I=await t.get("/auth/me"),v=(M=I==null?void 0:I.photos)==null?void 0:M.find($=>$._id===L);v&&(v.privacy==="private"||v.privacy==="friends_only"||v.isPrivate)&&(Is.debug(`Setting photo ${L} to public because it's being set as profile photo`),await t.put(`/users/photos/${L}/privacy`,{privacy:"public"}));const b=await t.put(`/users/photos/${L}/profile`),B=(b==null?void 0:b.data)||b;return p(),O(),E&&await e(E,!0),B}catch(I){throw Is.error("Set profile photo error:",I),I}finally{a.current=!1,l(!1)}}},[t,e,p]),P=d.useCallback(async(L,E)=>{var M;if(!L)throw new Error("No photo ID provided");if(!a.current){if(typeof L=="string"&&L.startsWith("temp-"))return!0;a.current=!0,l(!0);try{const I=await t.get("/auth/me"),v=(M=I==null?void 0:I.photos)==null?void 0:M.find(B=>B._id===L);if(v!=null&&v.isProfile)throw new Error("Cannot delete profile photo. Set another photo as profile first.");const b=await t.delete(`/users/photos/${L}`);if(!b.success)throw new Error(b.error||"Failed to delete photo");return O(),E&&await e(E,!0),!0}catch(I){throw Is.error("Delete photo error:",I),I}finally{a.current=!1,l(!1)}}},[t,e]),R=d.useCallback((L,E)=>{Is.debug(`Image with ID ${L} failed to load`),h(M=>({...M,[L]:!0})),E&&Qf(E)},[]),j=d.useCallback(L=>!L||!Array.isArray(L)?[]:L.map(E=>E._id?E.isPrivate!==void 0&&!E.privacy?{...E,privacy:E.isPrivate?"private":"public"}:E:{...E,_id:_(),url:E.url||"/placeholder.svg",privacy:E.privacy||"private",isProfile:E.isProfile??!1,isDeleted:E.isDeleted??!1,uploadedAt:E.uploadedAt||new Date}),[_]),k=d.useCallback(L=>{if(!L||!Array.isArray(L))return[];const E=L.filter(I=>!I.isDeleted),M=j(E);return M.length>0&&!M.some(I=>I.isProfile)&&(M[0].isProfile=!0),M.forEach(I=>{(!I.privacy||!["public","private","friends_only"].includes(I.privacy))&&(I.privacy="private")}),M},[j]),F=d.useCallback(L=>{if(!L)return fs("/default-avatar.png");if(L.photos){const E=L.photos;if(!E||E.length===0)return fs("/default-avatar.png");const M=E.filter(b=>!b.isDeleted);if(M.length===0)return fs("/default-avatar.png");const I=M.find(b=>b.isProfile),v=I?I.url:M[0].url;return fs(v||"/default-avatar.png")}if(Array.isArray(L)){if(L.length===0)return fs("/default-avatar.png");const E=L.filter(v=>!v.isDeleted);if(E.length===0)return fs("/default-avatar.png");const M=E.find(v=>v.isProfile),I=M?M.url:E[0].url;return fs(I||"/default-avatar.png")}return fs(typeof L=="string"?L:"/default-avatar.png")},[]),O=d.useCallback((L=!1)=>{if(p(),L&&typeof window<"u"){Is.debug("Forcing complete page refresh by reloading the window"),window.location.reload();return}if(typeof window<"u"){window.__photo_refresh_timestamp=Date.now();const E=new CustomEvent("avatar:refresh",{detail:{timestamp:window.__photo_refresh_timestamp}});window.dispatchEvent(E),document.body.classList.add("photo-refreshed"),setTimeout(()=>{document.body.classList.remove("photo-refreshed")},100);const M=window.scrollY;document.body.style.zoom="99.99%",setTimeout(()=>{document.body.style.zoom="100%",window.scrollTo(0,M)},50),Is.debug("Avatar refresh event dispatched with timestamp:",window.__photo_refresh_timestamp)}},[p]);return{isUploading:s,uploadProgress:o,isProcessingPhoto:c,photoLoadErrors:f,uploadPhoto:N,setPhotoPrivacy:g,togglePhotoPrivacy:C,setProfilePhoto:A,deletePhoto:P,handlePhotoLoadError:R,ensurePhotoIds:j,processPhotos:k,getProfilePhotoUrl:F,generateTempId:_,normalizePhotoUrl:fs,clearCache:p,refreshAllAvatars:O}},eo=De.create("Avatar"),Rn=({src:t,alt:e,size:s="medium",status:r=null,className:o="",onClick:i,online:c=!1,placeholder:l="/default-avatar.png",statusPosition:f="bottom-right",showFallback:h=!0,user:a=null,showOnlineStatus:p=!1})=>{const{normalizePhotoUrl:_,getProfilePhotoUrl:N,handlePhotoLoadError:g,clearCache:C}=Pn(),A=a?N(a):t||null,P=(a==null?void 0:a.nickname)||e||"User",R=p&&(a==null?void 0:a.isOnline)||c;t=A,e=P,c=R;const[j,k]=ct.useState(t),[F,O]=ct.useState(!1),[L,E]=ct.useState(""),M=ct.useRef(new Map),I=`${window.location.origin}/default-avatar.png`,[v,b]=ct.useState(Date.now()),B=()=>{C(),b(Date.now())};d.useEffect(()=>{const le=K=>{var ae;b(((ae=K==null?void 0:K.detail)==null?void 0:ae.timestamp)||Date.now()),M.current.clear(),O(!1)};window.addEventListener("avatar:refresh",le);const ye=()=>{F&&B()};return window.addEventListener("load",ye),()=>{window.removeEventListener("avatar:refresh",le),window.removeEventListener("load",ye)}},[F]),ct.useEffect(()=>{var le;if(t!==j||!t&&!F){if(t&&M.current.has(t)){const ue=M.current.get(t);if(ue.error){k(ue.fallback),O(!0);return}}if(t&&typeof t=="string"&&t.includes("unsplash.com")){k(I),O(!0);return}const ye=a&&((le=a.photos)==null?void 0:le.length)>0,K=M.current.has(t);let ae;ye&&!K?(ae=_(t,!0),M.current.set(t,{processed:ae,error:!1})):K&&!M.current.get(t).error?ae=M.current.get(t).processed:ae=_(t,!1),k(ae),O(!1),t&&typeof t=="string"&&/^[0-9a-f]{24}$/i.test(t)&&eo.debug(`Avatar for user ID: ${t}`)}},[t,I,j,F,_,a,v]);const $=ct.useRef(new Map),x=le=>{const ye=le.target.src;E(`Failed to load image: ${ye}`);const K=typeof t=="string"&&/\d+-\d+\.(jpg|jpeg|png|gif|webp)$/i.test(t);$.current.has(t)||$.current.set(t,0);const ae=$.current.get(t),ue=K?3:1;if(ye.includes("unsplash.com")||eo.error(`Image failed to load: ${ye}`,{originalSrc:t,attempt:ae+1,maxRetries:ue}),ae<ue){$.current.set(t,ae+1),setTimeout(()=>{M.current.delete(t);const Pe=Date.now(),ce=_(t,!0)+`&retry=${Pe}`;eo.debug(`Retrying image load (${ae+1}/${ue}): ${ce}`),k(ce),b(Pe)},K?1500:500);return}if(h){const we=I;t&&(M.current.set(t,{error:!0,fallback:we}),ye&&g(t,ye)),k(we),O(!0)}};let z;try{z=j}catch(le){eo.error(`Error with image source: ${le.message}`,{src:j}),z=I}const G={tiny:"avatar-xs",small:"avatar-sm",medium:"avatar-md",large:"avatar-lg",xlarge:"avatar-xl"},Y={backgroundImage:`url(${z})`,backgroundSize:"cover",backgroundPosition:"center"},oe=le=>{i||(B(),le.stopPropagation())};return n.jsxs("div",{className:`avatar ${G[s]||""} ${c?"avatar-online":""} ${o}`,onClick:i,onDoubleClick:oe,style:Y,role:i?"button":void 0,tabIndex:i?0:void 0,"data-debug":L,"data-timestamp":v,children:[n.jsx("img",{src:z,alt:e,onError:x,style:{display:"none"},crossOrigin:"anonymous"},`img-${v}`),r&&n.jsx("span",{className:`avatar-status status-${r} status-${f}`})]})};Rn.propTypes={src:w.string,alt:w.string,size:w.oneOf(["tiny","small","medium","large","xlarge"]),status:w.oneOf([null,"online","offline","busy","away"]),className:w.string,onClick:w.func,online:w.bool,placeholder:w.string,statusPosition:w.oneOf(["top-right","top-left","bottom-right","bottom-left"]),showFallback:w.bool,user:w.object,showOnlineStatus:w.bool};const en=({children:t,onClick:e,type:s="button",variant:r="primary",size:o="medium",className:i="",disabled:c=!1,fullWidth:l=!1,icon:f,iconPosition:h="left",isLoading:a=!1,loadingText:p,..._})=>{const{t:N}=Pt(),g=d.useMemo(()=>({loading:N("loading")||"Loading..."}),[N]),C=`btn btn-${r} btn-${o} ${l?"btn-full-width":""}`,A=f?`btn-with-icon icon-${h}`:"",P=a?"btn-loading":"",R=p||g.loading;return n.jsx("button",{type:s,className:`${C} ${A} ${P} ${i}`,onClick:e,disabled:c||a,..._,children:a?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"loading-spinner"}),R]}):n.jsxs(n.Fragment,{children:[f&&h==="left"&&n.jsx("span",{className:"btn-icon",children:f}),n.jsx("span",{className:"btn-text",children:t}),f&&h==="right"&&n.jsx("span",{className:"btn-icon",children:f})]})})};en.propTypes={children:w.node.isRequired,onClick:w.func,type:w.oneOf(["button","submit","reset"]),variant:w.oneOf(["primary","secondary","success","danger","warning","info","light","dark","link"]),size:w.oneOf(["small","medium","large"]),className:w.string,disabled:w.bool,fullWidth:w.bool,icon:w.node,iconPosition:w.oneOf(["left","right"]),isLoading:w.bool,loadingText:w.string};w.node.isRequired,w.node,w.node,w.string,w.string,w.string,w.string,w.node,w.bool,w.func,w.bool;w.oneOfType([w.string,w.object]).isRequired,w.string,w.oneOf(["error","warning","info"]),w.func,w.bool,w.string,w.object;const Zg=De.create("useChat"),e1=(t=null)=>{const e=t?String(t):null,s=Ag();d.useEffect(()=>{e&&s.setActiveConversation(e)},[e,s.setActiveConversation]);const r=d.useCallback(async(p,_="text",N=null)=>{if(!e){const g="Cannot send message: Missing recipient ID";throw Zg.error(g),new Error(g)}return s.activeConversation!==e&&await s.setActiveConversation(e),s.sendMessage(p,_,N)},[e,s]),o=d.useCallback(async(p=!1)=>e?s.loadMessages(e,p):[],[e,s.loadMessages]),i=d.useCallback(async()=>!e||s.activeConversation!==e?[]:s.loadMoreMessages(),[e,s.activeConversation,s.loadMoreMessages]),c=d.useCallback(()=>e?(s.activeConversation!==e&&s.setActiveConversation(e),s.refresh()):Promise.resolve([]),[e,s]),l=d.useCallback(()=>{e&&(s.activeConversation!==e&&s.setActiveConversation(e),s.sendTyping())},[e,s]),f=e?s.messages.filter(p=>{var _,N;return p.sender===e&&p.recipient===((_=s.user)==null?void 0:_._id)||p.sender===((N=s.user)==null?void 0:N._id)&&p.recipient===e}):[],h=d.useCallback(()=>e?s.markConversationRead(e):Promise.resolve(null),[e,s.markConversationRead]),a=d.useCallback(()=>s.getConversations?s.getConversations():Promise.resolve([]),[s]);return{conversations:s.conversations,messages:f,loading:s.loading,sending:s.sending,error:s.error,hasMore:s.hasMore,typingStatus:s.typingStatus,isConnected:s.isConnected,initialized:s.initialized,activeConversation:s.activeConversation,loadMessages:o,loadMoreMessages:i,sendMessage:r,sendTyping:l,refresh:c,markConversationRead:h,getConversations:a,setActiveConversation:s.setActiveConversation}},Xi={md:768,lg:992},Md=t=>{const e=o=>typeof window<"u"?window.matchMedia(o).matches:!1,[s,r]=d.useState(e(t));return d.useEffect(()=>{if(typeof window>"u")return;const o=window.matchMedia(t);r(o.matches);const i=c=>r(c.matches);return o.addEventListener?o.addEventListener("change",i):o.addListener(i),()=>{o.removeEventListener?o.removeEventListener("change",i):o.removeListener(i)}},[t]),s},on=()=>Md(`(max-width: ${Xi.md-1}px)`),t1=()=>Md(`(min-width: ${Xi.md}px) and (max-width: ${Xi.lg-1}px)`),tr=()=>{const[t,e]=d.useState({isMobile:!1,isTouch:!1,isIOS:!1,isAndroid:!1,isSafari:!1,isPWA:!1,isLandscape:!1}),s=on();return d.useEffect(()=>{if(typeof window>"u")return;const r=navigator.userAgent||navigator.vendor||window.opera,o="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,i=/iPad|iPhone|iPod/.test(r)&&!window.MSStream,c=/android/i.test(r),l=/^((?!chrome|android).)*safari/i.test(r),f=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),h=window.matchMedia("(orientation: landscape)").matches;e({isMobile:s,isTouch:o,isIOS:i,isAndroid:c,isSafari:l,isPWA:f,isLandscape:h});const a=()=>{e(p=>({...p,isLandscape:window.matchMedia("(orientation: landscape)").matches}))};return window.addEventListener("orientationchange",a),window.addEventListener("resize",a),()=>{window.removeEventListener("orientationchange",a),window.removeEventListener("resize",a)}},[s]),t};let Pc=0;const Zi=(t="local")=>{Pc++;const e=Math.random().toString(36).substring(2,9);return`${t}-${Date.now()}-${Pc}-${e}`},Bd=t=>{const e=(t==null?void 0:t.type)||(t==null?void 0:t.fileType)||(t==null?void 0:t.mimeType)||"";return e?e.startsWith("image/")?n.jsx(Oo,{}):e.startsWith("video/")?n.jsx(Bm,{}):e.startsWith("audio/")?n.jsx(Om,{}):e==="application/pdf"?n.jsx(Mm,{}):e.includes("word")?n.jsx(Sc,{}):n.jsx(Sc,{}):n.jsx(Fm,{})},dn=De.create("useBlockedUsers"),s1=()=>{const[t,e]=d.useState([]),[s,r]=d.useState(!1),[o,i]=d.useState(null),{user:c,isAuthenticated:l}=Gt(),f=d.useCallback(()=>{const _=localStorage.getItem("blockedUsers");let N=[];if(_)try{N=JSON.parse(_)||[],dn.debug(`Loaded ${N.length} blocked users from localStorage`)}catch(g){dn.warn("Error parsing blocked users from localStorage:",g),N=[]}return N},[]),h=d.useCallback(async()=>{var _,N;if(!l||!(c!=null&&c._id))return[];r(!0),i(null);try{if(localStorage.getItem("blocked_users_endpoint_missing")==="true"){dn.debug("Skipping blocked users API call - endpoint known to be missing");const C=f();return e(C),r(!1),C}try{dn.debug("Attempting to fetch blocked users from API...");const C=await Ae.get("/users/blocked",{},{timeout:5e3});if(C&&C.success&&Array.isArray(C.data)){const A=C.data.map(P=>typeof P=="object"&&P._id?P._id:typeof P=="object"&&P.id?P.id:String(P).replace(/^ObjectId\(['"](.+)['"]\)$/,"$1")).filter(P=>/^[0-9a-fA-F]{24}$/.test(P));return dn.debug(`Successfully loaded ${A.length} blocked users from API`),localStorage.setItem("blockedUsers",JSON.stringify(A)),localStorage.removeItem("blocked_users_endpoint_missing"),e(A),r(!1),A}else throw new Error("Invalid response format from API")}catch(C){dn.warn("Failed to fetch blocked users from API, using localStorage fallback:",C),(((_=C==null?void 0:C.response)==null?void 0:_.status)===400||((N=C==null?void 0:C.response)==null?void 0:N.status)===404)&&(dn.info("Marking blocked users endpoint as missing for future reference"),localStorage.setItem("blocked_users_endpoint_missing","true"));const A=f();return e(A),r(!1),A}}catch(g){return dn.error("Error fetching blocked users:",g),i("Failed to load blocked users"),r(!1),[]}},[l,c,f]),a=d.useCallback(_=>_?t.includes(_):!1,[t]),p=d.useCallback(_=>Array.isArray(_)?_.map(N=>{var g;return(g=N==null?void 0:N.user)!=null&&g._id?{...N,user:{...N.user,isBlocked:a(N.user._id)}}:N!=null&&N._id?{...N,isBlocked:a(N._id)}:N}):_,[a]);return d.useEffect(()=>{l&&(c!=null&&c._id)&&h()},[l,c,h]),{blockedUsers:t,isUserBlocked:a,markBlockedUsers:p,fetchBlockedUsers:h,loading:s,error:o}},n1=()=>{const t=d.useRef(!1);return d.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),{isMounted:()=>t.current}},r1=t=>{const e=d.useRef(null);return d.useEffect(()=>{const s=r=>{e.current&&!e.current.contains(r.target)&&t()};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[t]),e};w.string,w.node,w.node,w.node.isRequired,w.bool,w.node,w.string,w.string,w.string,w.bool,w.oneOf(["top","left","right"]);const rt=t=>typeof t=="string",wr=()=>{let t,e;const s=new Promise((r,o)=>{t=r,e=o});return s.resolve=t,s.reject=e,s},Rc=t=>t==null?"":""+t,o1=(t,e,s)=>{t.forEach(r=>{e[r]&&(s[r]=e[r])})},i1=/###/g,Lc=t=>t&&t.indexOf("###")>-1?t.replace(i1,"."):t,Oc=t=>!t||rt(t),Tr=(t,e,s)=>{const r=rt(e)?e.split("."):e;let o=0;for(;o<r.length-1;){if(Oc(t))return{};const i=Lc(r[o]);!t[i]&&s&&(t[i]=new s),Object.prototype.hasOwnProperty.call(t,i)?t=t[i]:t={},++o}return Oc(t)?{}:{obj:t,k:Lc(r[o])}},Mc=(t,e,s)=>{const{obj:r,k:o}=Tr(t,e,Object);if(r!==void 0||e.length===1){r[o]=s;return}let i=e[e.length-1],c=e.slice(0,e.length-1),l=Tr(t,c,Object);for(;l.obj===void 0&&c.length;)i=`${c[c.length-1]}.${i}`,c=c.slice(0,c.length-1),l=Tr(t,c,Object),l!=null&&l.obj&&typeof l.obj[`${l.k}.${i}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${i}`]=s},a1=(t,e,s,r)=>{const{obj:o,k:i}=Tr(t,e,Object);o[i]=o[i]||[],o[i].push(s)},wo=(t,e)=>{const{obj:s,k:r}=Tr(t,e);if(s&&Object.prototype.hasOwnProperty.call(s,r))return s[r]},c1=(t,e,s)=>{const r=wo(t,s);return r!==void 0?r:wo(e,s)},Fd=(t,e,s)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?rt(t[r])||t[r]instanceof String||rt(e[r])||e[r]instanceof String?s&&(t[r]=e[r]):Fd(t[r],e[r],s):t[r]=e[r]);return t},Fn=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var l1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const d1=t=>rt(t)?t.replace(/[&<>"'\/]/g,e=>l1[e]):t;class u1{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const s=this.regExpMap.get(e);if(s!==void 0)return s;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const h1=[" ",",","?","!",";"],f1=new u1(20),p1=(t,e,s)=>{e=e||"",s=s||"";const r=h1.filter(c=>e.indexOf(c)<0&&s.indexOf(c)<0);if(r.length===0)return!0;const o=f1.getRegExp(`(${r.map(c=>c==="?"?"\\?":c).join("|")})`);let i=!o.test(t);if(!i){const c=t.indexOf(s);c>0&&!o.test(t.substring(0,c))&&(i=!0)}return i},ea=function(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(s);let o=t;for(let i=0;i<r.length;){if(!o||typeof o!="object")return;let c,l="";for(let f=i;f<r.length;++f)if(f!==i&&(l+=s),l+=r[f],c=o[l],c!==void 0){if(["string","number","boolean"].indexOf(typeof c)>-1&&f<r.length-1)continue;i+=f-i+1;break}o=c}return o},bo=t=>t==null?void 0:t.replace("_","-"),m1={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){var s,r;(r=(s=console==null?void 0:console[t])==null?void 0:s.apply)==null||r.call(s,console,e)}};class xo{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,s)}init(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=s.prefix||"i18next:",this.logger=e||m1,this.options=s,this.debug=s.debug}log(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return this.forward(s,"log","",!0)}warn(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return this.forward(s,"warn","",!0)}error(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return this.forward(s,"error","")}deprecate(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return this.forward(s,"warn","WARNING DEPRECATED: ",!0)}forward(e,s,r,o){return o&&!this.debug?null:(rt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[s](e))}create(e){return new xo(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new xo(this.logger,e)}}var Vs=new xo;class Mo{constructor(){this.observers={}}on(e,s){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const o=this.observers[r].get(s)||0;this.observers[r].set(s,o+1)}),this}off(e,s){if(this.observers[e]){if(!s){delete this.observers[e];return}this.observers[e].delete(s)}}emit(e){for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(c=>{let[l,f]=c;for(let h=0;h<f;h++)l(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(c=>{let[l,f]=c;for(let h=0;h<f;h++)l.apply(l,[e,...r])})}}class Bc extends Mo{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const s=this.options.ns.indexOf(e);s>-1&&this.options.ns.splice(s,1)}getResource(e,s,r){var h,a;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,c=o.ignoreJSONStructure!==void 0?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,s],r&&(Array.isArray(r)?l.push(...r):rt(r)&&i?l.push(...r.split(i)):l.push(r)));const f=wo(this.data,l);return!f&&!s&&!r&&e.indexOf(".")>-1&&(e=l[0],s=l[1],r=l.slice(2).join(".")),f||!c||!rt(r)?f:ea((a=(h=this.data)==null?void 0:h[e])==null?void 0:a[s],r,i)}addResource(e,s,r,o){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const c=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let l=[e,s];r&&(l=l.concat(c?r.split(c):r)),e.indexOf(".")>-1&&(l=e.split("."),o=s,s=l[1]),this.addNamespaces(s),Mc(this.data,l,o),i.silent||this.emit("added",e,s,r,o)}addResources(e,s,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in r)(rt(r[i])||Array.isArray(r[i]))&&this.addResource(e,s,i,r[i],{silent:!0});o.silent||this.emit("added",e,s,r)}addResourceBundle(e,s,r,o,i){let c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},l=[e,s];e.indexOf(".")>-1&&(l=e.split("."),o=r,r=s,s=l[1]),this.addNamespaces(s);let f=wo(this.data,l)||{};c.skipCopy||(r=JSON.parse(JSON.stringify(r))),o?Fd(f,r,i):f={...f,...r},Mc(this.data,l,f),c.silent||this.emit("added",e,s,r)}removeResourceBundle(e,s){this.hasResourceBundle(e,s)&&delete this.data[e][s],this.removeNamespaces(s),this.emit("removed",e,s)}hasResourceBundle(e,s){return this.getResource(e,s)!==void 0}getResourceBundle(e,s){return s||(s=this.options.defaultNS),this.getResource(e,s)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const s=this.getDataByLanguage(e);return!!(s&&Object.keys(s)||[]).find(o=>s[o]&&Object.keys(s[o]).length>0)}toJSON(){return this.data}}var Dd={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,s,r,o){return t.forEach(i=>{var c;e=((c=this.processors[i])==null?void 0:c.process(e,s,r,o))??e}),e}};const Fc={},Dc=t=>!rt(t)&&typeof t!="boolean"&&typeof t!="number";class So extends Mo{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),o1(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Vs.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,s);return(r==null?void 0:r.res)!==void 0}extractFromKey(e,s){let r=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let i=s.ns||this.options.defaultNS||[];const c=r&&e.indexOf(r)>-1,l=!this.options.userDefinedKeySeparator&&!s.keySeparator&&!this.options.userDefinedNsSeparator&&!s.nsSeparator&&!p1(e,r,o);if(c&&!l){const f=e.match(this.interpolator.nestingRegexp);if(f&&f.length>0)return{key:e,namespaces:rt(i)?[i]:i};const h=e.split(r);(r!==o||r===o&&this.options.ns.indexOf(h[0])>-1)&&(i=h.shift()),e=h.join(o)}return{key:e,namespaces:rt(i)?[i]:i}}translate(e,s,r){if(typeof s!="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),typeof s=="object"&&(s={...s}),s||(s={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const o=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,i=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,{key:c,namespaces:l}=this.extractFromKey(e[e.length-1],s),f=l[l.length-1],h=s.lng||this.language,a=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((h==null?void 0:h.toLowerCase())==="cimode"){if(a){const v=s.nsSeparator||this.options.nsSeparator;return o?{res:`${f}${v}${c}`,usedKey:c,exactUsedKey:c,usedLng:h,usedNS:f,usedParams:this.getUsedParamsDetails(s)}:`${f}${v}${c}`}return o?{res:c,usedKey:c,exactUsedKey:c,usedLng:h,usedNS:f,usedParams:this.getUsedParamsDetails(s)}:c}const p=this.resolve(e,s);let _=p==null?void 0:p.res;const N=(p==null?void 0:p.usedKey)||c,g=(p==null?void 0:p.exactUsedKey)||c,C=["[object Number]","[object Function]","[object RegExp]"],A=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,P=!this.i18nFormat||this.i18nFormat.handleAsObject,R=s.count!==void 0&&!rt(s.count),j=So.hasDefaultValue(s),k=R?this.pluralResolver.getSuffix(h,s.count,s):"",F=s.ordinal&&R?this.pluralResolver.getSuffix(h,s.count,{ordinal:!1}):"",O=R&&!s.ordinal&&s.count===0,L=O&&s[`defaultValue${this.options.pluralSeparator}zero`]||s[`defaultValue${k}`]||s[`defaultValue${F}`]||s.defaultValue;let E=_;P&&!_&&j&&(E=L);const M=Dc(E),I=Object.prototype.toString.apply(E);if(P&&E&&M&&C.indexOf(I)<0&&!(rt(A)&&Array.isArray(E))){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const v=this.options.returnedObjectHandler?this.options.returnedObjectHandler(N,E,{...s,ns:l}):`key '${c} (${this.language})' returned an object instead of string.`;return o?(p.res=v,p.usedParams=this.getUsedParamsDetails(s),p):v}if(i){const v=Array.isArray(E),b=v?[]:{},B=v?g:N;for(const $ in E)if(Object.prototype.hasOwnProperty.call(E,$)){const x=`${B}${i}${$}`;j&&!_?b[$]=this.translate(x,{...s,defaultValue:Dc(L)?L[$]:void 0,joinArrays:!1,ns:l}):b[$]=this.translate(x,{...s,joinArrays:!1,ns:l}),b[$]===x&&(b[$]=E[$])}_=b}}else if(P&&rt(A)&&Array.isArray(_))_=_.join(A),_&&(_=this.extendTranslation(_,e,s,r));else{let v=!1,b=!1;!this.isValidLookup(_)&&j&&(v=!0,_=L),this.isValidLookup(_)||(b=!0,_=c);const $=(s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&b?void 0:_,x=j&&L!==_&&this.options.updateMissing;if(b||v||x){if(this.logger.log(x?"updateKey":"missingKey",h,f,c,x?L:_),i){const oe=this.resolve(c,{...s,keySeparator:!1});oe&&oe.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let z=[];const G=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&G&&G[0])for(let oe=0;oe<G.length;oe++)z.push(G[oe]);else this.options.saveMissingTo==="all"?z=this.languageUtils.toResolveHierarchy(s.lng||this.language):z.push(s.lng||this.language);const Y=(oe,le,ye)=>{var ae;const K=j&&ye!==_?ye:$;this.options.missingKeyHandler?this.options.missingKeyHandler(oe,f,le,K,x,s):(ae=this.backendConnector)!=null&&ae.saveMissing&&this.backendConnector.saveMissing(oe,f,le,K,x,s),this.emit("missingKey",oe,f,le,_)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?z.forEach(oe=>{const le=this.pluralResolver.getSuffixes(oe,s);O&&s[`defaultValue${this.options.pluralSeparator}zero`]&&le.indexOf(`${this.options.pluralSeparator}zero`)<0&&le.push(`${this.options.pluralSeparator}zero`),le.forEach(ye=>{Y([oe],c+ye,s[`defaultValue${ye}`]||L)})}):Y(z,c,L))}_=this.extendTranslation(_,e,s,p,r),b&&_===c&&this.options.appendNamespaceToMissingKey&&(_=`${f}:${c}`),(b||v)&&this.options.parseMissingKeyHandler&&(_=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${f}:${c}`:c,v?_:void 0))}return o?(p.res=_,p.usedParams=this.getUsedParamsDetails(s),p):_}extendTranslation(e,s,r,o,i){var h,a;var c=this;if((h=this.i18nFormat)!=null&&h.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const p=rt(e)&&(((a=r==null?void 0:r.interpolation)==null?void 0:a.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let _;if(p){const g=e.match(this.interpolator.nestingRegexp);_=g&&g.length}let N=r.replace&&!rt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(N={...this.options.interpolation.defaultVariables,...N}),e=this.interpolator.interpolate(e,N,r.lng||this.language||o.usedLng,r),p){const g=e.match(this.interpolator.nestingRegexp),C=g&&g.length;_<C&&(r.nest=!1)}!r.lng&&o&&o.res&&(r.lng=this.language||o.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var g=arguments.length,C=new Array(g),A=0;A<g;A++)C[A]=arguments[A];return(i==null?void 0:i[0])===C[0]&&!r.context?(c.logger.warn(`It seems you are nesting recursively key: ${C[0]} in key: ${s[0]}`),null):c.translate(...C,s)},r)),r.interpolation&&this.interpolator.reset()}const l=r.postProcess||this.options.postProcess,f=rt(l)?[l]:l;return e!=null&&(f!=null&&f.length)&&r.applyPostProcessor!==!1&&(e=Dd.handle(f,e,s,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...o,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,o,i,c,l;return rt(e)&&(e=[e]),e.forEach(f=>{if(this.isValidLookup(r))return;const h=this.extractFromKey(f,s),a=h.key;o=a;let p=h.namespaces;this.options.fallbackNS&&(p=p.concat(this.options.fallbackNS));const _=s.count!==void 0&&!rt(s.count),N=_&&!s.ordinal&&s.count===0,g=s.context!==void 0&&(rt(s.context)||typeof s.context=="number")&&s.context!=="",C=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);p.forEach(A=>{var P,R;this.isValidLookup(r)||(l=A,!Fc[`${C[0]}-${A}`]&&((P=this.utils)!=null&&P.hasLoadedNamespace)&&!((R=this.utils)!=null&&R.hasLoadedNamespace(l))&&(Fc[`${C[0]}-${A}`]=!0,this.logger.warn(`key "${o}" for languages "${C.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),C.forEach(j=>{var O;if(this.isValidLookup(r))return;c=j;const k=[a];if((O=this.i18nFormat)!=null&&O.addLookupKeys)this.i18nFormat.addLookupKeys(k,a,j,A,s);else{let L;_&&(L=this.pluralResolver.getSuffix(j,s.count,s));const E=`${this.options.pluralSeparator}zero`,M=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(_&&(k.push(a+L),s.ordinal&&L.indexOf(M)===0&&k.push(a+L.replace(M,this.options.pluralSeparator)),N&&k.push(a+E)),g){const I=`${a}${this.options.contextSeparator}${s.context}`;k.push(I),_&&(k.push(I+L),s.ordinal&&L.indexOf(M)===0&&k.push(I+L.replace(M,this.options.pluralSeparator)),N&&k.push(I+E))}}let F;for(;F=k.pop();)this.isValidLookup(r)||(i=F,r=this.getResource(j,A,F,s))}))})}),{res:r,usedKey:o,exactUsedKey:i,usedLng:c,usedNS:l}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,s,r){var i;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(i=this.i18nFormat)!=null&&i.getResource?this.i18nFormat.getResource(e,s,r,o):this.resourceStore.getResource(e,s,r,o)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!rt(e.replace);let o=r?e.replace:e;if(r&&typeof e.count<"u"&&(o.count=e.count),this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),!r){o={...o};for(const i of s)delete o[i]}return o}static hasDefaultValue(e){const s="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&s===r.substring(0,s.length)&&e[r]!==void 0)return!0;return!1}}class Uc{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Vs.create("languageUtils")}getScriptPartFromCode(e){if(e=bo(e),!e||e.indexOf("-")<0)return null;const s=e.split("-");return s.length===2||(s.pop(),s[s.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(s.join("-"))}getLanguagePartFromCode(e){if(e=bo(e),!e||e.indexOf("-")<0)return e;const s=e.split("-");return this.formatLanguageCode(s[0])}formatLanguageCode(e){if(rt(e)&&e.indexOf("-")>-1){let s;try{s=Intl.getCanonicalLocales(e)[0]}catch{}return s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let s;return e.forEach(r=>{if(s)return;const o=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(o))&&(s=o)}),!s&&this.options.supportedLngs&&e.forEach(r=>{if(s)return;const o=this.getLanguagePartFromCode(r);if(this.isSupportedCode(o))return s=o;s=this.options.supportedLngs.find(i=>{if(i===o)return i;if(!(i.indexOf("-")<0&&o.indexOf("-")<0)&&(i.indexOf("-")>0&&o.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===o||i.indexOf(o)===0&&o.length>1))return i})}),s||(s=this.getFallbackCodes(this.options.fallbackLng)[0]),s}getFallbackCodes(e,s){if(!e)return[];if(typeof e=="function"&&(e=e(s)),rt(e)&&(e=[e]),Array.isArray(e))return e;if(!s)return e.default||[];let r=e[s];return r||(r=e[this.getScriptPartFromCode(s)]),r||(r=e[this.formatLanguageCode(s)]),r||(r=e[this.getLanguagePartFromCode(s)]),r||(r=e.default),r||[]}toResolveHierarchy(e,s){const r=this.getFallbackCodes(s||this.options.fallbackLng||[],e),o=[],i=c=>{c&&(this.isSupportedCode(c)?o.push(c):this.logger.warn(`rejecting language code not found in supportedLngs: ${c}`))};return rt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):rt(e)&&i(this.formatLanguageCode(e)),r.forEach(c=>{o.indexOf(c)<0&&i(this.formatLanguageCode(c))}),o}}const qc={zero:0,one:1,two:2,few:3,many:4,other:5},zc={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class g1{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=s,this.logger=Vs.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,s){this.rules[e]=s}clearCache(){this.pluralRulesCache={}}getRule(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=bo(e==="dev"?"en":e),o=s.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:r,type:o});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let c;try{c=new Intl.PluralRules(r,{type:o})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),zc;if(!e.match(/-|_/))return zc;const f=this.languageUtils.getLanguagePartFromCode(e);c=this.getRule(f,s)}return this.pluralRulesCache[i]=c,c}needsPlural(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,s);return r||(r=this.getRule("dev",s)),(r==null?void 0:r.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(o=>`${s}${o}`)}getSuffixes(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,s);return r||(r=this.getRule("dev",s)),r?r.resolvedOptions().pluralCategories.sort((o,i)=>qc[o]-qc[i]).map(o=>`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${o}`):[]}getSuffix(e,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const o=this.getRule(e,r);return o?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${o.select(s)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",s,r))}}const Hc=function(t,e,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=c1(t,e,s);return!i&&o&&rt(s)&&(i=ea(t,s,r),i===void 0&&(i=ea(e,s,r))),i},Si=t=>t.replace(/\$/g,"$$$$");class y1{constructor(){var s;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Vs.create("interpolator"),this.options=e,this.format=((s=e==null?void 0:e.interpolation)==null?void 0:s.format)||(r=>r),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:s,escapeValue:r,useRawValueToEscape:o,prefix:i,prefixEscaped:c,suffix:l,suffixEscaped:f,formatSeparator:h,unescapeSuffix:a,unescapePrefix:p,nestingPrefix:_,nestingPrefixEscaped:N,nestingSuffix:g,nestingSuffixEscaped:C,nestingOptionsSeparator:A,maxReplaces:P,alwaysFormat:R}=e.interpolation;this.escape=s!==void 0?s:d1,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=o!==void 0?o:!1,this.prefix=i?Fn(i):c||"{{",this.suffix=l?Fn(l):f||"}}",this.formatSeparator=h||",",this.unescapePrefix=a?"":p||"-",this.unescapeSuffix=this.unescapePrefix?"":a||"",this.nestingPrefix=_?Fn(_):N||Fn("$t("),this.nestingSuffix=g?Fn(g):C||Fn(")"),this.nestingOptionsSeparator=A||",",this.maxReplaces=P||1e3,this.alwaysFormat=R!==void 0?R:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(s,r)=>(s==null?void 0:s.source)===r?(s.lastIndex=0,s):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,s,r,o){var N;let i,c,l;const f=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=g=>{if(g.indexOf(this.formatSeparator)<0){const R=Hc(s,f,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(R,void 0,r,{...o,...s,interpolationkey:g}):R}const C=g.split(this.formatSeparator),A=C.shift().trim(),P=C.join(this.formatSeparator).trim();return this.format(Hc(s,f,A,this.options.keySeparator,this.options.ignoreJSONStructure),P,r,{...o,...s,interpolationkey:A})};this.resetRegExp();const a=(o==null?void 0:o.missingInterpolationHandler)||this.options.missingInterpolationHandler,p=((N=o==null?void 0:o.interpolation)==null?void 0:N.skipOnVariables)!==void 0?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>Si(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?Si(this.escape(g)):Si(g)}].forEach(g=>{for(l=0;i=g.regex.exec(e);){const C=i[1].trim();if(c=h(C),c===void 0)if(typeof a=="function"){const P=a(e,i,o);c=rt(P)?P:""}else if(o&&Object.prototype.hasOwnProperty.call(o,C))c="";else if(p){c=i[0];continue}else this.logger.warn(`missed to pass in variable ${C} for interpolating ${e}`),c="";else!rt(c)&&!this.useRawValueToEscape&&(c=Rc(c));const A=g.safeValue(c);if(e=e.replace(i[0],A),p?(g.regex.lastIndex+=c.length,g.regex.lastIndex-=i[0].length):g.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),e}nest(e,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o,i,c;const l=(f,h)=>{const a=this.nestingOptionsSeparator;if(f.indexOf(a)<0)return f;const p=f.split(new RegExp(`${a}[ ]*{`));let _=`{${p[1]}`;f=p[0],_=this.interpolate(_,c);const N=_.match(/'/g),g=_.match(/"/g);(((N==null?void 0:N.length)??0)%2===0&&!g||g.length%2!==0)&&(_=_.replace(/'/g,'"'));try{c=JSON.parse(_),h&&(c={...h,...c})}catch(C){return this.logger.warn(`failed parsing options string in nesting for key ${f}`,C),`${f}${a}${_}`}return c.defaultValue&&c.defaultValue.indexOf(this.prefix)>-1&&delete c.defaultValue,f};for(;o=this.nestingRegexp.exec(e);){let f=[];c={...r},c=c.replace&&!rt(c.replace)?c.replace:c,c.applyPostProcessor=!1,delete c.defaultValue;let h=!1;if(o[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(o[1])){const a=o[1].split(this.formatSeparator).map(p=>p.trim());o[1]=a.shift(),f=a,h=!0}if(i=s(l.call(this,o[1].trim(),c),c),i&&o[0]===e&&!rt(i))return i;rt(i)||(i=Rc(i)),i||(this.logger.warn(`missed to resolve ${o[1]} for nesting ${e}`),i=""),h&&(i=f.reduce((a,p)=>this.format(a,p,r.lng,{...r,interpolationkey:o[1].trim()}),i.trim())),e=e.replace(o[0],i),this.regexp.lastIndex=0}return e}}const _1=t=>{let e=t.toLowerCase().trim();const s={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const o=r[1].substring(0,r[1].length-1);e==="currency"&&o.indexOf(":")<0?s.currency||(s.currency=o.trim()):e==="relativetime"&&o.indexOf(":")<0?s.range||(s.range=o.trim()):o.split(";").forEach(c=>{if(c){const[l,...f]=c.split(":"),h=f.join(":").trim().replace(/^'+|'+$/g,""),a=l.trim();s[a]||(s[a]=h),h==="false"&&(s[a]=!1),h==="true"&&(s[a]=!0),isNaN(h)||(s[a]=parseInt(h,10))}})}return{formatName:e,formatOptions:s}},Dn=t=>{const e={};return(s,r,o)=>{let i=o;o&&o.interpolationkey&&o.formatParams&&o.formatParams[o.interpolationkey]&&o[o.interpolationkey]&&(i={...i,[o.interpolationkey]:void 0});const c=r+JSON.stringify(i);let l=e[c];return l||(l=t(bo(r),o),e[c]=l),l(s)}};class v1{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Vs.create("formatter"),this.options=e,this.formats={number:Dn((s,r)=>{const o=new Intl.NumberFormat(s,{...r});return i=>o.format(i)}),currency:Dn((s,r)=>{const o=new Intl.NumberFormat(s,{...r,style:"currency"});return i=>o.format(i)}),datetime:Dn((s,r)=>{const o=new Intl.DateTimeFormat(s,{...r});return i=>o.format(i)}),relativetime:Dn((s,r)=>{const o=new Intl.RelativeTimeFormat(s,{...r});return i=>o.format(i,r.range||"day")}),list:Dn((s,r)=>{const o=new Intl.ListFormat(s,{...r});return i=>o.format(i)})},this.init(e)}init(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=s.interpolation.formatSeparator||","}add(e,s){this.formats[e.toLowerCase().trim()]=s}addCached(e,s){this.formats[e.toLowerCase().trim()]=Dn(s)}format(e,s,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=s.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(l=>l.indexOf(")")>-1)){const l=i.findIndex(f=>f.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,l)].join(this.formatSeparator)}return i.reduce((l,f)=>{var p;const{formatName:h,formatOptions:a}=_1(f);if(this.formats[h]){let _=l;try{const N=((p=o==null?void 0:o.formatParams)==null?void 0:p[o.interpolationkey])||{},g=N.locale||N.lng||o.locale||o.lng||r;_=this.formats[h](l,g,{...a,...o,...N})}catch(N){this.logger.warn(N)}return _}else this.logger.warn(`there was no format function for ${h}`);return l},e)}}const w1=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class b1 extends Mo{constructor(e,s,r){var i,c;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=s,this.services=r,this.languageUtils=r.languageUtils,this.options=o,this.logger=Vs.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],(c=(i=this.backend)==null?void 0:i.init)==null||c.call(i,r,o.backend,o)}queueLoad(e,s,r,o){const i={},c={},l={},f={};return e.forEach(h=>{let a=!0;s.forEach(p=>{const _=`${h}|${p}`;!r.reload&&this.store.hasResourceBundle(h,p)?this.state[_]=2:this.state[_]<0||(this.state[_]===1?c[_]===void 0&&(c[_]=!0):(this.state[_]=1,a=!1,c[_]===void 0&&(c[_]=!0),i[_]===void 0&&(i[_]=!0),f[p]===void 0&&(f[p]=!0)))}),a||(l[h]=!0)}),(Object.keys(i).length||Object.keys(c).length)&&this.queue.push({pending:c,pendingCount:Object.keys(c).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(i),pending:Object.keys(c),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(f)}}loaded(e,s,r){const o=e.split("|"),i=o[0],c=o[1];s&&this.emit("failedLoading",i,c,s),!s&&r&&this.store.addResourceBundle(i,c,r,void 0,void 0,{skipCopy:!0}),this.state[e]=s?-1:2,s&&r&&(this.state[e]=0);const l={};this.queue.forEach(f=>{a1(f.loaded,[i],c),w1(f,e),s&&f.errors.push(s),f.pendingCount===0&&!f.done&&(Object.keys(f.loaded).forEach(h=>{l[h]||(l[h]={});const a=f.loaded[h];a.length&&a.forEach(p=>{l[h][p]===void 0&&(l[h][p]=!0)})}),f.done=!0,f.errors.length?f.callback(f.errors):f.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(f=>!f.done)}read(e,s,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,c=arguments.length>5?arguments[5]:void 0;if(!e.length)return c(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:s,fcName:r,tried:o,wait:i,callback:c});return}this.readingCalls++;const l=(h,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const p=this.waitingReads.shift();this.read(p.lng,p.ns,p.fcName,p.tried,p.wait,p.callback)}if(h&&a&&o<this.maxRetries){setTimeout(()=>{this.read.call(this,e,s,r,o+1,i*2,c)},i);return}c(h,a)},f=this.backend[r].bind(this.backend);if(f.length===2){try{const h=f(e,s);h&&typeof h.then=="function"?h.then(a=>l(null,a)).catch(l):l(null,h)}catch(h){l(h)}return}return f(e,s,l)}prepareLoading(e,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),o&&o();rt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),rt(s)&&(s=[s]);const i=this.queueLoad(e,s,r,o);if(!i.toLoad.length)return i.pending.length||o(),null;i.toLoad.forEach(c=>{this.loadOne(c)})}load(e,s,r){this.prepareLoading(e,s,{},r)}reload(e,s,r){this.prepareLoading(e,s,{reload:!0},r)}loadOne(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),o=r[0],i=r[1];this.read(o,i,"read",void 0,void 0,(c,l)=>{c&&this.logger.warn(`${s}loading namespace ${i} for language ${o} failed`,c),!c&&l&&this.logger.log(`${s}loaded namespace ${i} for language ${o}`,l),this.loaded(e,c,l)})}saveMissing(e,s,r,o,i){var f,h,a,p,_;let c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((h=(f=this.services)==null?void 0:f.utils)!=null&&h.hasLoadedNamespace&&!((p=(a=this.services)==null?void 0:a.utils)!=null&&p.hasLoadedNamespace(s))){this.logger.warn(`did not save key "${r}" as the namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if((_=this.backend)!=null&&_.create){const N={...c,isUpdate:i},g=this.backend.create.bind(this.backend);if(g.length<6)try{let C;g.length===5?C=g(e,s,r,o,N):C=g(e,s,r,o),C&&typeof C.then=="function"?C.then(A=>l(null,A)).catch(l):l(null,C)}catch(C){l(C)}else g(e,s,r,o,l,N)}!e||!e[0]||this.store.addResource(e[0],s,r,o)}}}const Vc=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),rt(t[1])&&(e.defaultValue=t[1]),rt(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const s=t[3]||t[2];Object.keys(s).forEach(r=>{e[r]=s[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Wc=t=>{var e,s;return rt(t.ns)&&(t.ns=[t.ns]),rt(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),rt(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),((s=(e=t.supportedLngs)==null?void 0:e.indexOf)==null?void 0:s.call(e,"cimode"))<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t},to=()=>{},x1=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(s=>{typeof t[s]=="function"&&(t[s]=t[s].bind(t))})};class $r extends Mo{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Wc(e),this.services={},this.logger=Vs,this.modules={external:[]},x1(this),s&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,s),this;setTimeout(()=>{this.init(e,s)},0)}}init(){var e=this;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof s=="function"&&(r=s,s={}),s.defaultNS==null&&s.ns&&(rt(s.ns)?s.defaultNS=s.ns:s.ns.indexOf("translation")<0&&(s.defaultNS=s.ns[0]));const o=Vc();this.options={...o,...this.options,...Wc(s)},this.options.interpolation={...o.interpolation,...this.options.interpolation},s.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=s.keySeparator),s.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=s.nsSeparator);const i=a=>a?typeof a=="function"?new a:a:null;if(!this.options.isClone){this.modules.logger?Vs.init(i(this.modules.logger),this.options):Vs.init(null,this.options);let a;this.modules.formatter?a=this.modules.formatter:a=v1;const p=new Uc(this.options);this.store=new Bc(this.options.resources,this.options);const _=this.services;_.logger=Vs,_.resourceStore=this.store,_.languageUtils=p,_.pluralResolver=new g1(p,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),a&&(!this.options.interpolation.format||this.options.interpolation.format===o.interpolation.format)&&(_.formatter=i(a),_.formatter.init(_,this.options),this.options.interpolation.format=_.formatter.format.bind(_.formatter)),_.interpolator=new y1(this.options),_.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},_.backendConnector=new b1(i(this.modules.backend),_.resourceStore,_,this.options),_.backendConnector.on("*",function(N){for(var g=arguments.length,C=new Array(g>1?g-1:0),A=1;A<g;A++)C[A-1]=arguments[A];e.emit(N,...C)}),this.modules.languageDetector&&(_.languageDetector=i(this.modules.languageDetector),_.languageDetector.init&&_.languageDetector.init(_,this.options.detection,this.options)),this.modules.i18nFormat&&(_.i18nFormat=i(this.modules.i18nFormat),_.i18nFormat.init&&_.i18nFormat.init(this)),this.translator=new So(this.services,this.options),this.translator.on("*",function(N){for(var g=arguments.length,C=new Array(g>1?g-1:0),A=1;A<g;A++)C[A-1]=arguments[A];e.emit(N,...C)}),this.modules.external.forEach(N=>{N.init&&N.init(this)})}if(this.format=this.options.interpolation.format,r||(r=to),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const a=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);a.length>0&&a[0]!=="dev"&&(this.options.lng=a[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(a=>{this[a]=function(){return e.store[a](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(a=>{this[a]=function(){return e.store[a](...arguments),e}});const f=wr(),h=()=>{const a=(p,_)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),f.resolve(_),r(p,_)};if(this.languages&&!this.isInitialized)return a(null,this.t.bind(this));this.changeLanguage(this.options.lng,a)};return this.options.resources||!this.options.initAsync?h():setTimeout(h,0),f}loadResources(e){var i,c;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:to;const o=rt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if((o==null?void 0:o.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const l=[],f=h=>{if(!h||h==="cimode")return;this.services.languageUtils.toResolveHierarchy(h).forEach(p=>{p!=="cimode"&&l.indexOf(p)<0&&l.push(p)})};o?f(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(a=>f(a)),(c=(i=this.options.preload)==null?void 0:i.forEach)==null||c.call(i,h=>f(h)),this.services.backendConnector.load(l,this.options.ns,h=>{!h&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(h)})}else r(null)}reloadResources(e,s,r){const o=wr();return typeof e=="function"&&(r=e,e=void 0),typeof s=="function"&&(r=s,s=void 0),e||(e=this.languages),s||(s=this.options.ns),r||(r=to),this.services.backendConnector.reload(e,s,i=>{o.resolve(),r(i)}),o}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&Dd.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let s=0;s<this.languages.length;s++){const r=this.languages[s];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,s){var r=this;this.isLanguageChangingTo=e;const o=wr();this.emit("languageChanging",e);const i=f=>{this.language=f,this.languages=this.services.languageUtils.toResolveHierarchy(f),this.resolvedLanguage=void 0,this.setResolvedLanguage(f)},c=(f,h)=>{h?(i(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,o.resolve(function(){return r.t(...arguments)}),s&&s(f,function(){return r.t(...arguments)})},l=f=>{var a,p;!e&&!f&&this.services.languageDetector&&(f=[]);const h=rt(f)?f:this.services.languageUtils.getBestMatchFromCodes(f);h&&(this.language||i(h),this.translator.language||this.translator.changeLanguage(h),(p=(a=this.services.languageDetector)==null?void 0:a.cacheUserLanguage)==null||p.call(a,h)),this.loadResources(h,_=>{c(_,h)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?l(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(l):this.services.languageDetector.detect(l):l(e),o}getFixedT(e,s,r){var o=this;const i=function(c,l){let f;if(typeof l!="object"){for(var h=arguments.length,a=new Array(h>2?h-2:0),p=2;p<h;p++)a[p-2]=arguments[p];f=o.options.overloadTranslationOptionHandler([c,l].concat(a))}else f={...l};f.lng=f.lng||i.lng,f.lngs=f.lngs||i.lngs,f.ns=f.ns||i.ns,f.keyPrefix!==""&&(f.keyPrefix=f.keyPrefix||r||i.keyPrefix);const _=o.options.keySeparator||".";let N;return f.keyPrefix&&Array.isArray(c)?N=c.map(g=>`${f.keyPrefix}${_}${g}`):N=f.keyPrefix?`${f.keyPrefix}${_}${c}`:c,o.t(N,f)};return rt(e)?i.lng=e:i.lngs=e,i.ns=s,i.keyPrefix=r,i}t(){var o;for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return(o=this.translator)==null?void 0:o.translate(...s)}exists(){var o;for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return(o=this.translator)==null?void 0:o.exists(...s)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=s.lng||this.resolvedLanguage||this.languages[0],o=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const c=(l,f)=>{const h=this.services.backendConnector.state[`${l}|${f}`];return h===-1||h===0||h===2};if(s.precheck){const l=s.precheck(this,c);if(l!==void 0)return l}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||c(r,e)&&(!o||c(i,e)))}loadNamespaces(e,s){const r=wr();return this.options.ns?(rt(e)&&(e=[e]),e.forEach(o=>{this.options.ns.indexOf(o)<0&&this.options.ns.push(o)}),this.loadResources(o=>{r.resolve(),s&&s(o)}),r):(s&&s(),Promise.resolve())}loadLanguages(e,s){const r=wr();rt(e)&&(e=[e]);const o=this.options.preload||[],i=e.filter(c=>o.indexOf(c)<0&&this.services.languageUtils.isSupportedCode(c));return i.length?(this.options.preload=o.concat(i),this.loadResources(c=>{r.resolve(),s&&s(c)}),r):(s&&s(),Promise.resolve())}dir(e){var o,i;if(e||(e=this.resolvedLanguage||(((o=this.languages)==null?void 0:o.length)>0?this.languages[0]:this.language)),!e)return"rtl";const s=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=((i=this.services)==null?void 0:i.languageUtils)||new Uc(Vc());return s.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;return new $r(e,s)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:to;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const o={...this.options,...e,isClone:!0},i=new $r(o);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(l=>{i[l]=this[l]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},r){const l=Object.keys(this.store.data).reduce((f,h)=>(f[h]={...this.store.data[h]},Object.keys(f[h]).reduce((a,p)=>(a[p]={...f[h][p]},a),{})),{});i.store=new Bc(l,o),i.services.resourceStore=i.store}return i.translator=new So(i.services,o),i.translator.on("*",function(l){for(var f=arguments.length,h=new Array(f>1?f-1:0),a=1;a<f;a++)h[a-1]=arguments[a];i.emit(l,...h)}),i.init(o,s),i.translator.options=o,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const os=$r.createInstance();os.createInstance=$r.createInstance;os.createInstance;os.dir;os.init;os.loadResources;os.reloadResources;os.use;os.changeLanguage;os.getFixedT;os.t;os.exists;os.setDefaultNamespace;os.hasLoadedNamespace;os.loadNamespaces;os.loadLanguages;const Ud=({className:t="",display:e="toggle"})=>{const{language:s,changeLanguage:r}=Ht(),{t:o}=Pt(),i=d.useMemo(()=>({languageSelect:o("languageSelect")||"Select language",switchToHebrew:o("switchToHebrew")||"Switch to Hebrew",switchToEnglish:o("switchToEnglish")||"Switch to English",english:o("english")||"English",hebrew:o("hebrew")||"Hebrew",language:o("language")||"Language",currentlyUsing:o("currentlyUsing")||"Currently using:"}),[o]),c=()=>{r(s==="en"?"he":"en")},l=()=>n.jsx("div",{className:`language-selector ${t}`,children:n.jsx("button",{onClick:c,className:"language-toggle-btn","aria-label":s==="en"?i.switchToHebrew||"Switch to Hebrew":i.switchToEnglish||"Switch to English",children:s==="en"?"עברית":"English"})}),f=()=>n.jsxs("div",{className:"settings-section language-settings-section",children:[n.jsx("h3",{className:"settings-heading",children:i.language}),n.jsxs("div",{className:"settings-content language-settings",children:[n.jsxs("div",{className:"language-options",children:[n.jsxs("div",{className:`language-option ${s==="en"?"active":""}`,onClick:()=>r("en"),children:[n.jsx("div",{className:"language-flag",children:"🇺🇸"}),n.jsxs("div",{className:"language-info",children:[n.jsx("div",{className:"language-name",children:i.english||"English"}),n.jsx("div",{className:"language-native",children:"English"})]}),s==="en"&&n.jsx("div",{className:"language-active-indicator",children:"✓"})]}),n.jsxs("div",{className:`language-option ${s==="he"?"active":""}`,onClick:()=>r("he"),children:[n.jsx("div",{className:"language-flag",children:"🇮🇱"}),n.jsxs("div",{className:"language-info",children:[n.jsx("div",{className:"language-name",children:i.hebrew||"Hebrew"}),n.jsx("div",{className:"language-native",children:"עברית"})]}),s==="he"&&n.jsx("div",{className:"language-active-indicator",children:"✓"})]})]}),n.jsx("div",{className:"language-notice",children:i.currentlyUsing||"Currently using:"})]})]});return n.jsxs(n.Fragment,{children:[(e==="toggle"||e==="both")&&l(),(e==="section"||e==="both")&&f()]})},sr=({size:t="medium",color:e="primary",centered:s=!1,fullPage:r=!1,text:o="",className:i="",overlay:c=!1})=>{const{t:l}=Pt(),f=d.useMemo(()=>({loading:l("loading")||"Loading..."}),[l]),h=t==="small"?"spinner-sm":t==="large"?"spinner-lg":"",a=`spinner-${e}`,p=`spinner-container
    ${s?"centered":""}
    ${r?"full-page":""}
    ${c?"with-overlay":""}
    ${i}`,_=o||f.loading;return n.jsxs("div",{className:p,role:"status","aria-live":"polite",children:[c&&n.jsx("div",{className:"spinner-overlay"}),n.jsxs("div",{className:`spinner ${h} ${a}`,"aria-hidden":"true",children:[n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"}),n.jsx("div",{className:"spinner-blade"})]}),_&&n.jsx("p",{className:"spinner-text",children:_}),n.jsx("span",{className:"sr-only",children:f.loading})]})};sr.propTypes={size:w.oneOf(["small","medium","large"]),color:w.oneOf(["primary","secondary","light","dark"]),centered:w.bool,fullPage:w.bool,text:w.string,className:w.string,overlay:w.bool};w.bool,w.oneOfType([w.string,w.object]),w.node,w.string,w.string,w.oneOf(["small","medium","large"]),w.object,w.func,w.bool,w.bool,w.string,w.func;const Cr=({isOpen:t,onClose:e,title:s,children:r,footer:o,size:i="medium",closeOnClickOutside:c=!0,closeOnEsc:l=!0,showCloseButton:f=!0,className:h="",contentClassName:a="",headerClassName:p="",bodyClassName:_="",footerClassName:N="",modalRoot:g=document.body,bottomSheetOnMobile:C=!0})=>{const A=d.useRef(null),P=d.useRef(null),R=on(),{isTouch:j}=tr(),[k,F]=d.useState(null),[O,L]=d.useState(0),[E,M]=d.useState(!1),{language:I="en",isRTL:v=!1}=Ht()||{},b=v||document.documentElement.dir==="rtl"||document.documentElement.lang==="he",B=C&&R,$=r1(()=>{c&&t&&e()}),x=ye=>{if(!B)return;const K=ye.target;(K.closest(".modal-header")||K.classList.contains("modal-drag-indicator"))&&(F(ye.touches[0].clientY),M(!0))},z=ye=>{if(!E||k===null)return;const ae=ye.touches[0].clientY-k;ae>0&&(L(ae),ye.preventDefault())},G=()=>{var ae;if(!E)return;const ye=((ae=A.current)==null?void 0:ae.offsetHeight)||0,K=Math.min(100,ye*.3);O>K&&e(),M(!1),F(null),L(0)};d.useEffect(()=>{if(!t)return;P.current=document.activeElement;const ye=K=>{var ae;if(l&&K.key==="Escape"&&e(),K.key==="Tab"){const ue=((ae=A.current)==null?void 0:ae.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))||[];if(ue.length===0)return;const we=ue[0],Pe=ue[ue.length-1];K.shiftKey?document.activeElement===we&&(Pe.focus(),K.preventDefault()):document.activeElement===Pe&&(we.focus(),K.preventDefault())}};return document.addEventListener("keydown",ye),document.body.style.overflow="hidden",setTimeout(()=>{var ae;const K=(ae=A.current)==null?void 0:ae.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');K!=null&&K[0]&&K[0].focus()},0),()=>{document.removeEventListener("keydown",ye),document.body.style.overflow="",P.current&&P.current.focus()}},[t,l,e,c]);const Y={small:"modal-sm",medium:"modal-md",large:"modal-lg",xlarge:"modal-xl",fullscreen:"modal-fullscreen"};if(!t)return null;const oe=b?n.jsx("style",{children:`
      .modal, .modal-body, .modal-header, .modal-footer {
        direction: rtl !important;
        text-align: right !important;
      }
      .modal-close {
        right: auto !important;
        left: 1rem !important;
      }
      `}):null,le=n.jsxs("div",{className:`modal-overlay ${t?"open":""} ${B?"mobile-modal-overlay":""}`,onClick:c?e:void 0,children:[oe,n.jsxs("div",{className:`modal ${Y[i]||""} ${h} ${b?"rtl-layout":""} 
          ${B?"mobile-modal bottom-sheet":""} ${E?"is-dragging":""}`,ref:ye=>{A.current=ye,$&&($.current=ye)},onClick:ye=>ye.stopPropagation(),onTouchStart:x,onTouchMove:z,onTouchEnd:G,role:"dialog","aria-modal":"true","aria-labelledby":s?"modal-title":void 0,dir:b?"rtl":"ltr","data-language":I,style:E?{transform:`translateY(${O}px)`}:{},children:[B&&n.jsx("div",{className:"modal-drag-indicator"}),n.jsxs("div",{className:`modal-header ${p} ${b?"rtl-layout":""}`,children:[s&&n.jsx("h2",{className:"modal-title",id:"modal-title",children:s}),f&&n.jsx("button",{className:"modal-close",onClick:e,"aria-label":"Close modal",children:n.jsx(rs,{})})]}),n.jsx("div",{className:`modal-body ${_} ${b?"rtl-layout":""}`,dir:b?"rtl":"ltr",children:r}),o&&n.jsx("div",{className:`modal-footer ${N} ${b?"rtl-layout":""}`,children:o})]})]});return hu.createPortal(le,g)};Cr.propTypes={isOpen:w.bool.isRequired,onClose:w.func.isRequired,title:w.node,children:w.node.isRequired,footer:w.node,size:w.oneOf(["small","medium","large","xlarge","fullscreen"]),closeOnClickOutside:w.bool,closeOnEsc:w.bool,showCloseButton:w.bool,className:w.string,contentClassName:w.string,headerClassName:w.string,bodyClassName:w.string,footerClassName:w.string,modalRoot:w.object,bottomSheetOnMobile:w.bool};const Ci=80,S1=.4,C1=80,so=300,ki=(t,e)=>{const{container:s,sidebar:r,chatArea:o,conversationList:i,refreshIndicator:c}=t,{onSidebarShow:l,onSidebarHide:f,onRefresh:h,onRefreshStart:a,onRefreshEnd:p}=e;let _=0,N=0,g=!1,C=!1,A=0,P=0;const R=()=>i&&i.scrollTop<=1,j=E=>{_=E.touches[0].clientX,N=E.touches[0].clientY,g=!1,C=!1,P=0,A=0},k=()=>window.visualViewport?window.visualViewport.height<window.innerHeight*.8:document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName),F=E=>{if(!E.touches[0]||k())return;const M=E.touches[0].clientX,I=E.touches[0].clientY,v=M-_,b=I-N;if(!g&&!C&&(Math.abs(v)>Math.abs(b)&&Math.abs(v)>10?g=!0:b>10&&R()&&(C=!0,a&&a())),g){P=v,E.preventDefault();const B=!r.classList.contains("hide");if(B&&v<0||!B&&v>0){const x=v*.5;if(r.dataset.swiping="true",B)x<0&&(r.style.transform=`translateX(${x}px)`);else{const z=Math.min(0,-100+x/s.offsetWidth*100);r.style.transform=`translateX(${z}%)`}}}C&&!g&&(E.preventDefault(),A=Math.min(b*S1,C1),c&&(c.style.transform=`translateY(${A}px)`,A>Ci?c.textContent="Release to refresh":c.textContent="Pull down to refresh"))},O=E=>{if(r&&r.dataset.swiping&&delete r.dataset.swiping,g){const M=!r.classList.contains("hide");M&&P<-80?f&&(r.classList.add("animating"),f()):!M&&P>Ci?l&&(r.classList.add("animating"),l()):r.style.transform="",setTimeout(()=>{r.classList.remove("animating"),r.style.transition="",r.style.transform=""},so)}C&&c&&(c.style.transition=`transform ${so}ms ease`,A>Ci?(c.style.transform="translateY(40px)",h&&h(),c.classList.add("refreshSuccess"),setTimeout(()=>{c.style.transform="translateY(0)",c.classList.remove("refreshSuccess"),p&&p()},1e3)):(c.style.transform="translateY(0)",setTimeout(()=>{p&&p()},so)),setTimeout(()=>{c.style.transition=""},so))};if("ontouchstart"in window||navigator.maxTouchPoints>0)return s?(s.addEventListener("touchstart",j,{passive:!0}),s.addEventListener("touchmove",F,{passive:!1}),s.addEventListener("touchend",O,{passive:!0}),()=>{s.removeEventListener("touchstart",j),s.removeEventListener("touchmove",F),s.removeEventListener("touchend",O)}):null},Ot=t=>{if("vibrate"in navigator)switch(t){case"send":navigator.vibrate(20);break;case"sendFile":navigator.vibrate(40);break;case"wink":navigator.vibrate([20,30,20]);break;case"selectConversation":navigator.vibrate(20);break;case"callStart":navigator.vibrate([50,100,50]);break;case"callEnd":navigator.vibrate(100);break;case"error":navigator.vibrate([100,50,100]);break;default:navigator.vibrate(15)}},Pr=t=>{if(!t)return null;const e=()=>{/iPad|iPhone|iPod/.test(navigator.userAgent)&&(t.style.WebkitOverflowScrolling="touch"),t.classList.add("scrolling"),clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(()=>{t.classList.remove("scrolling")},200)};return t.addEventListener("scroll",e,{passive:!0}),()=>{t.removeEventListener("scroll",e)}},Gc=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");w.node.isRequired,w.string,w.bool,w.func,w.func,w.number,w.bool,w.func,w.string;const k1="_photoGallery_2n68h_7",N1="_galleryTitle_2n68h_28",j1="_mainPhotoContainer_2n68h_50",T1="_mainPhoto_2n68h_50",E1="_navButton_2n68h_71",A1="_prevButton_2n68h_99",I1="_nextButton_2n68h_103",$1="_galleryGrid_2n68h_108",P1="_mobileGallery_2n68h_117",R1="_photoItem_2n68h_123",L1="_profilePhotoItem_2n68h_148",O1="_photoImage_2n68h_164",M1="_hasPrivatePhoto_2n68h_188",B1="_photoControls_2n68h_209",F1="_photoControlButton_2n68h_236",D1="_controlIcon_2n68h_283",U1="_privatePhoto_2n68h_294",q1="_lockIcon_2n68h_310",z1="_privateIndicator_2n68h_332",H1="_profileIndicator_2n68h_333",V1="_friendsIndicator_2n68h_334",W1="_profileStar_2n68h_387",G1="_privacyOverlay_2n68h_399",Y1="_overlayIcon_2n68h_424",K1="_thumbnailsContainer_2n68h_436",J1="_thumbnails_2n68h_436",Q1="_thumbnail_2n68h_436",X1="_activeThumbnail_2n68h_458",Z1="_thumbnailImage_2n68h_462",ey="_privateThumbnail_2n68h_468",ty="_thumbnailLockIcon_2n68h_480",sy="_profileBadge_2n68h_490",ny="_thumbnailControls_2n68h_506",ry="_controlButton_2n68h_523",oy="_addPhotoThumbnail_2n68h_541",iy="_uploadPhotoButton_2n68h_571",ay="_uploadProgressContainer_2n68h_602",cy="_uploadProgressBar_2n68h_610",ly="_progressBar_2n68h_611",dy="_uploadProgressFill_2n68h_619",uy="_progressFill_2n68h_620",hy="_uploadProgressText_2n68h_626",fy="_progressText_2n68h_627",py="_uploadProgress_2n68h_602",my="_noPhotosMessage_2n68h_640",gy="_placeholder_2n68h_657",yy="_placeholderIcon_2n68h_662",_y="_placeholderText_2n68h_667",vy="_spinner_2n68h_673",Oe={photoGallery:k1,galleryTitle:N1,mainPhotoContainer:j1,mainPhoto:T1,navButton:E1,prevButton:A1,nextButton:I1,galleryGrid:$1,mobileGallery:P1,photoItem:R1,profilePhotoItem:L1,photoImage:O1,hasPrivatePhoto:M1,photoControls:B1,photoControlButton:F1,controlIcon:D1,privatePhoto:U1,lockIcon:q1,privateIndicator:z1,profileIndicator:H1,friendsIndicator:V1,profileStar:W1,privacyOverlay:G1,overlayIcon:Y1,thumbnailsContainer:K1,thumbnails:J1,thumbnail:Q1,activeThumbnail:X1,thumbnailImage:Z1,privateThumbnail:ey,thumbnailLockIcon:ty,profileBadge:sy,thumbnailControls:ny,controlButton:ry,addPhotoThumbnail:oy,uploadPhotoButton:iy,uploadProgressContainer:ay,uploadProgressBar:cy,progressBar:ly,uploadProgressFill:dy,progressFill:uy,uploadProgressText:hy,progressText:fy,uploadProgress:py,noPhotosMessage:my,placeholder:gy,placeholderIcon:yy,placeholderText:_y,spinner:vy},un=De.create("PhotoGallery"),qd=({photos:t=[],onPhotoChange:e,onSetProfilePhoto:s,onSetPrivacy:r,onDeletePhoto:o,canEdit:i=!1,canTogglePrivacy:c=!1,userId:l,isOwner:f=!0,canViewPrivate:h=!1,isProcessing:a=!1,isUploading:p=!1,uploadProgress:_=0,gridView:N=!1})=>{const{t:g}=Pt(),C=on(),A=d.useRef(0),{isUploading:P,uploadProgress:R,isProcessingPhoto:j,uploadPhoto:k,togglePhotoPrivacy:F,setProfilePhoto:O,deletePhoto:L}=Pn(),E=p||P,M=_||R,I=a||j,[v,b]=d.useState(0),[B,$]=d.useState(Date.now()),x=d.useRef(null);d.useEffect(()=>{const ce=()=>{un.debug("Avatar refresh event received, updating PhotoGallery"),A.current=Date.now(),$(Date.now()),G(Date.now())};return window.addEventListener("avatar:refresh",ce),()=>window.removeEventListener("avatar:refresh",ce)},[]);const[z,G]=d.useState(0),Y=Array.isArray(t)?t.filter(ce=>ce&&typeof ce=="object"&&ce._id&&!ce.isDeleted):[],oe=Y[v]||null,le=async ce=>{const de=ce.target.files[0];if(de)try{const me=await k(de,"private");me&&e&&e([...Y.filter(se=>!se._id.startsWith("temp-")),me]),x.current&&(x.current.value="")}catch(me){un.error("Failed to upload photo:",me)}},ye=async(ce,de)=>{if(de==null||de.stopPropagation(),!I)try{const me=Y.find(Ue=>Ue._id===ce);if(!me)return;const se=me.privacy||(me.isPrivate?"private":"public");let he;if(typeof r=="function")he=se==="private"?"public":"private",await r(ce,he,de);else{switch(se){case"private":he="public";break;case"public":he="friends_only";break;case"friends_only":default:he="private"}if(await F(ce,l,he),e){const Ue=Y.map(Me=>Me._id===ce?{...Me,privacy:he,isPrivate:he==="private"}:Me);e(Ue)}}}catch(me){un.error("Failed to update photo privacy:",me)}},K=async(ce,de)=>{if(de==null||de.stopPropagation(),!I)try{if(typeof s=="function")await s(ce);else if(await O(ce,l),e){const se=Y.map(he=>({...he,isProfile:he._id===ce}));e(se)}const me=Y.findIndex(se=>se._id===ce);me!==-1&&b(me)}catch(me){un.error("Failed to set profile photo:",me)}},ae=async(ce,de)=>{if(de==null||de.stopPropagation(),I)return;if(typeof ce=="string"&&ce.startsWith("temp-")){e&&e(Y.filter(se=>se._id!==ce));return}if(!window.confirm(g("confirmDeletePhoto","Are you sure you want to delete this photo?")))return;const me=Y.findIndex(se=>se._id===ce);if(me!==-1&&Y[me].isProfile){alert(g("cannotDeleteProfilePhoto","You cannot delete your profile photo. Please set another photo as your profile photo first."));return}try{if(typeof o=="function")await o(ce,de);else if(await L(ce,l),e){const se=Y.filter(he=>he._id!==ce);e(se),me<=v&&v>0?b(v-1):se.length===0&&b(0)}}catch(se){un.error("Failed to delete photo:",se)}},ue=()=>{x.current&&i&&x.current.click()},we=()=>{v<Y.length-1&&b(v+1)},Pe=()=>{v>0&&b(v-1)};return Y.length===0?n.jsxs("div",{className:Oe.photoGallery,children:[n.jsx("h3",{className:Oe.galleryTitle,children:g("photos")}),n.jsx("div",{className:Oe.noPhotosMessage,children:n.jsxs("div",{className:Oe.placeholder,children:[n.jsx("div",{className:Oe.placeholderIcon,children:n.jsx(Hs,{size:48})}),n.jsx("p",{className:Oe.placeholderText,children:g("noPhotos","No photos available")}),i&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:Oe.uploadPhotoButton,onClick:ue,disabled:E,children:E?n.jsxs(n.Fragment,{children:[n.jsx(Ts,{className:Oe.spinner}),g("uploading","Uploading...")]}):n.jsxs(n.Fragment,{children:[n.jsx(Hs,{}),g("addPhoto","Add Photo")]})}),n.jsx("input",{type:"file",ref:x,onChange:le,accept:"image/*",style:{display:"none"}})]})]})})]}):N?n.jsxs("div",{className:`${Oe.photoGallery} ${C?Oe.mobileGallery:""}`,children:[n.jsx("h3",{className:Oe.galleryTitle,children:g("photos")}),n.jsxs("div",{className:Oe.galleryGrid,children:[Y.map(ce=>{const de=ce.privacy||(ce.isPrivate?"private":"public"),me=de==="private",se=me&&!f&&!h;return n.jsxs("div",{className:`${Oe.photoItem} 
                          ${ce.isProfile?Oe.profilePhotoItem:""} 
                          ${me?Oe.hasPrivatePhoto:""}`,onClick:he=>K(ce._id,he),children:[se?n.jsx("div",{className:Oe.privatePhoto,children:n.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:g("privatePhoto"),className:Oe.photoImage},`private-photo-${ce._id}`)}):n.jsx("img",{src:`${fs(ce.url,!0)}${window.__photo_refresh_timestamp?`&_t=${window.__photo_refresh_timestamp}`:""}&_k=${B}`,alt:g("photo"),className:Oe.photoImage,style:{opacity:me?.7:1,filter:me?"grayscale(0.3)":"none"},onError:he=>{un.debug(`Failed to load photo: ${ce._id}`),he.target.src=`${window.location.origin}/placeholder.svg?height=100&width=100`}},`photo-${ce._id}-${B}`),(i||c)&&n.jsxs("div",{className:Oe.photoControls,children:[c&&n.jsx("button",{onClick:he=>ye(ce._id,he),className:Oe.photoControlButton,title:g(de==="private"?"makePublic":"makePrivate"),disabled:I,"aria-label":g(de==="private"?"makePublic":"makePrivate"),children:de==="private"?n.jsx(Cc,{className:Oe.controlIcon}):n.jsx(ns,{className:Oe.controlIcon})}),i&&!ce.isProfile&&n.jsx("button",{onClick:he=>K(ce._id,he),className:Oe.photoControlButton,title:g("setAsProfilePhoto"),disabled:I,"aria-label":g("setAsProfilePhoto"),children:n.jsx(_r,{className:Oe.controlIcon})}),i&&!ce.isProfile&&n.jsx("button",{onClick:he=>ae(ce._id,he),className:Oe.photoControlButton,title:g("deletePhoto"),disabled:I,"aria-label":g("deletePhoto"),children:n.jsx(Jn,{className:Oe.controlIcon})})]}),de==="private"&&n.jsx("div",{className:Oe.privacyOverlay,children:n.jsx(ns,{className:Oe.overlayIcon})}),ce.isProfile&&n.jsx("div",{className:Oe.profileIndicator,children:n.jsx(_r,{className:Oe.profileStar})})]},ce._id)}),i&&n.jsxs("div",{className:Oe.addPhotoThumbnail,onClick:ue,children:[n.jsx(Hs,{}),n.jsx("input",{type:"file",ref:x,onChange:le,accept:"image/*",style:{display:"none"}})]})]}),E&&n.jsxs("div",{className:Oe.uploadProgressContainer,children:[n.jsx("div",{className:Oe.uploadProgressBar,children:n.jsx("div",{className:Oe.uploadProgressFill,style:{width:`${M}%`}})}),n.jsxs("p",{className:Oe.uploadProgressText,children:[g("uploading","Uploading...")," ",M,"%"]})]})]}):n.jsxs("div",{className:Oe.photoGallery,children:[n.jsx("h3",{className:Oe.galleryTitle,children:g("photos")}),n.jsxs("div",{className:Oe.mainPhotoContainer,children:[(()=>{if(!oe)return null;const ce=oe.privacy||(oe.isPrivate?"private":"public");return ce==="private"&&!f&&!h?n.jsxs("div",{className:Oe.privatePhoto,children:[n.jsx(ns,{className:Oe.lockIcon}),n.jsx("p",{children:g("privatePhoto","This photo is private")})]}):n.jsxs(n.Fragment,{children:[n.jsx("img",{src:fs(oe.url,!0),alt:g("photo","Photo"),className:Oe.mainPhoto,style:{opacity:ce==="private"&&f?.7:1,filter:ce==="private"&&f?"grayscale(0.3)":"none"},onError:me=>{un.debug(`Failed to load main photo: ${oe._id}`),me.target.src=`${window.location.origin}/placeholder.svg`}},`main-photo-${oe._id}-${B}`),ce==="private"&&n.jsxs("div",{className:Oe.privateIndicator,children:[n.jsx(ns,{}),g("private","Private")]}),ce==="friends_only"&&n.jsxs("div",{className:Oe.friendsIndicator,children:[n.jsx(vo,{}),g("friendsOnly","Friends Only")]}),oe.isProfile&&n.jsxs("div",{className:Oe.profileIndicator,children:[n.jsx(_r,{}),g("profilePhoto","Profile")]})]})})(),Y.length>1&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:`${Oe.navButton} ${Oe.prevButton}`,onClick:Pe,disabled:v===0,"aria-label":g("previousPhoto","Previous photo"),children:n.jsx(hd,{})}),n.jsx("button",{className:`${Oe.navButton} ${Oe.nextButton}`,onClick:we,disabled:v===Y.length-1,"aria-label":g("nextPhoto","Next photo"),children:n.jsx(fd,{})})]})]}),n.jsx("div",{className:Oe.thumbnailsContainer,children:n.jsxs("div",{className:Oe.thumbnails,children:[Y.map((ce,de)=>{const me=ce.privacy||(ce.isPrivate?"private":"public"),se=me==="private"&&!f&&!h;return n.jsxs("div",{className:`${Oe.thumbnail} ${de===v?Oe.activeThumbnail:""}`,onClick:()=>b(de),children:[se?n.jsxs("div",{className:Oe.privateThumbnail,children:[n.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:g("privatePhoto","Private photo"),className:Oe.thumbnailImage}),n.jsx(ns,{className:Oe.thumbnailLockIcon})]}):n.jsx("img",{src:fs(ce.url,!0),alt:g("photoThumbnail",`Photo ${de+1}`),className:Oe.thumbnailImage,style:{opacity:me==="private"&&f?.7:1,filter:me==="private"&&f?"grayscale(0.3)":"none"},onError:he=>{un.debug(`Failed to load thumbnail: ${ce._id}`),he.target.src=`${window.location.origin}/placeholder.svg?height=60&width=60`}},`thumbnail-${ce._id}-${B}`),ce.isProfile&&n.jsx("div",{className:Oe.profileBadge,children:n.jsx(_r,{})}),(i||c)&&n.jsxs("div",{className:Oe.thumbnailControls,children:[c&&n.jsx("button",{onClick:he=>ye(ce._id,he),className:Oe.controlButton,"aria-label":me==="private"?g("makePublic","Make public"):g("makePrivate","Make private"),title:me==="private"?g("makePublic","Make public"):g("makePrivate","Make private"),children:me==="private"?n.jsx(Cc,{}):n.jsx(ns,{})}),i&&!ce.isProfile&&n.jsx("button",{onClick:he=>K(ce._id,he),className:Oe.controlButton,"aria-label":g("setAsProfile","Set as profile photo"),title:g("setAsProfile","Set as profile photo"),children:n.jsx(_r,{})}),i&&!ce.isProfile&&n.jsx("button",{onClick:he=>ae(ce._id,he),className:Oe.controlButton,"aria-label":g("deletePhoto","Delete photo"),title:g("deletePhoto","Delete photo"),children:n.jsx(Jn,{})})]})]},ce._id||`photo-${de}`)}),i&&n.jsxs("div",{className:Oe.addPhotoThumbnail,onClick:ue,children:[n.jsx(Hs,{}),n.jsx("input",{type:"file",ref:x,onChange:le,accept:"image/*",style:{display:"none"}})]})]})}),E&&n.jsxs("div",{className:Oe.uploadProgress,children:[n.jsx("div",{className:Oe.progressBar,children:n.jsx("div",{className:Oe.progressFill,style:{width:`${M}%`}})}),n.jsxs("p",{className:Oe.progressText,children:[g("uploading","Uploading...")," ",M,"%"]})]})]})};qd.propTypes={photos:w.arrayOf(w.shape({_id:w.oneOfType([w.string,w.object]),url:w.string.isRequired,privacy:w.string,isPrivate:w.bool,isProfile:w.bool,isDeleted:w.bool})),onPhotoChange:w.func,onSetProfilePhoto:w.func,onSetPrivacy:w.func,onDeletePhoto:w.func,canEdit:w.bool,canTogglePrivacy:w.bool,userId:w.string,isOwner:w.bool,canViewPrivate:w.bool,isProcessing:w.bool,isUploading:w.bool,uploadProgress:w.number,gridView:w.bool};const wy=ct.memo(qd),by=(t,e,s={})=>{const{debug:r=!1}=s,o=r?(l,f)=>{const h=e?e(l,f):!0;if(!h){const a=Object.keys(f).filter(_=>l[_]!==f[_]),p=t.displayName||t.name||"Component";De.debug(`[withMemo] ${p} re-rendering due to props changes:`,a)}return h}:e,i=d.memo(t,o),c=t.displayName||t.name||"Component";return i.displayName=`withMemo(${c})`,i},Et=De.create("NotificationsComponent");let Ps;try{Ps=new BroadcastChannel("notifications_sync"),Et.info("BroadcastChannel API available for cross-tab sync.")}catch{Et.warn("BroadcastChannel not supported in this browser. Cross-tab sync disabled."),Ps=null}const zd=ct.memo(({notification:t,onClick:e})=>{const s=p=>{var _,N,g,C,A,P,R,j,k;return((_=p.sender)==null?void 0:_.nickname)||((g=(N=p.data)==null?void 0:N.sender)==null?void 0:g.nickname)||((A=(C=p.data)==null?void 0:C.requester)==null?void 0:A.nickname)||((R=(P=p.data)==null?void 0:P.owner)==null?void 0:R.nickname)||((k=(j=p.data)==null?void 0:j.user)==null?void 0:k.nickname)||"Someone"},r=p=>{switch(p){case"message":return Gs;case"like":case"match":return nn;case"photoRequest":case"photoResponse":return Hs;case"story":return Oo;case"comment":return er;case"call":return wd;default:return Ar}},o=p=>{var _;switch(p.type){case"message":return p.count>1?`sent you ${p.count} messages`:"sent you a message";case"like":return"liked your profile";case"match":return"matched with you";case"photoRequest":return Et.debug("Rendering photoRequest notification:",p),"requested access to your private photos";case"photoResponse":return Et.debug("Rendering photoResponse notification:",p),(((_=p.data)==null?void 0:_.status)||"")==="approved"?"approved your photo request":"declined your photo request";case"story":return p.count>1?`shared ${p.count} new stories`:"shared a new story";case"comment":return p.count>1?`left ${p.count} comments on your post`:"commented on your post";case"call":return"called you";default:return"sent a notification"}};if(!t)return Et.warn("NotificationItem received null notification prop."),null;const i=r(t.type),c=_o(t.createdAt,{showRelative:!0,showTime:!1,showDate:!1}),l=t.count>1?t.count:null,f=s(t),h=o(t),a=d.useCallback(p=>{p.preventDefault(),p.stopPropagation(),Et.debug("Notification item clicked:",t._id),e&&e(t)},[t,e]);return!t._id||!t.type||!t.createdAt?(Et.error("Rendering NotificationItem with invalid data:",t),n.jsx("div",{className:"notification-item error",children:"Invalid notification data"})):n.jsxs("div",{className:`notification-item ${t.read?"":"unread"}`,onClick:a,role:"listitem","aria-labelledby":`notification-title-${t._id}`,"aria-describedby":`notification-desc-${t._id}`,children:[n.jsx("div",{className:"notification-icon","aria-hidden":"true",children:n.jsx(i,{})}),n.jsxs("div",{className:"notification-content",children:[n.jsxs("div",{className:"notification-title",id:`notification-title-${t._id}`,children:[n.jsx("span",{className:"notification-sender",children:f})," ",h,l&&n.jsxs("span",{className:"notification-count",children:[" (",l,")"]})]}),n.jsx("div",{className:"notification-message",id:`notification-desc-${t._id}`,children:t.message||t.content||t.title||""}),n.jsxs("div",{className:"notification-time",children:[c,!t.read&&n.jsx("span",{className:"notification-status",children:"• New"})]})]})]})});zd.displayName="NotificationItem";const xy=({showHeader:t=!0,showFilters:e=!0,isDropdown:s=!1,isMobile:r=!1,onClose:o,maxHeight:i=400,className:c="",style:l={},customFilters:f=null})=>{const{t:h}=Pt(),{notifications:a,unreadCount:p,loading:_,socketConnected:N,markAllAsRead:g,addTestNotification:C,handleNotificationClick:A,fetchNotifications:P}=Ed(),[R,j]=d.useState("all"),[k,F]=d.useState([]),[O,L]=d.useState(!1),[E,M]=d.useState(()=>typeof document<"u"?document.visibilityState:"visible"),I=d.useRef(null),v=d.useRef(Date.now()),b=d.useRef(null),B=d.useRef(!0);d.useEffect(()=>(B.current=!0,()=>{B.current=!1}),[]),d.useEffect(()=>{const K=()=>{if(typeof document>"u")return;const ae=document.visibilityState;Et.debug("Document visibility changed:",ae),M(ae),ae==="visible"&&Date.now()-v.current>3e4&&(Et.info("Tab became visible after >30s, refreshing notifications."),P(),v.current=Date.now())};if(typeof document<"u")return document.addEventListener("visibilitychange",K),()=>{document.removeEventListener("visibilitychange",K)}},[P]),d.useEffect(()=>{const K=ae=>{if(!(ae!=null&&ae.data))return;const{type:ue,data:we}=ae.data;Et.debug("Received cross-tab message:",ue,we),(ue==="NOTIFICATION_READ"||ue==="NOTIFICATION_RECEIVED"||ue==="NOTIFICATIONS_CLEARED")&&(Et.info(`Cross-tab sync (${ue}), refreshing notifications.`),P())};if(Ps)return Ps.addEventListener("message",K),()=>{Ps.removeEventListener("message",K)}},[P]),d.useEffect(()=>{const K=ae=>{Et.debug("⚡ DIRECT socket notification received in COMPONENT:",ae),P(),v.current=Date.now(),Ps&&Ps.postMessage({type:"NOTIFICATION_RECEIVED",data:ae})};if(Ne&&Ne.isConnected){Et.debug("📱 Attaching socket event listeners in NotificationsComponent.");const ue=["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall"].map(we=>Ne.on(we,K));return Et.debug("Socket check - Connected:",Ne.isConnected()),()=>{Et.debug("🧹 Cleaning up socket listeners in NotificationsComponent."),ue.forEach(we=>{typeof we=="function"&&we()}),b.current&&clearTimeout(b.current)}}else Et.warn("Socket service or socket instance not available for direct listeners.")},[P]);const $=d.useRef(N);d.useEffect(()=>{if(Et.debug(`Socket connection state changed. Previous: ${$.current}, Current: ${N}`),!N&&$.current){Et.warn("Socket disconnected. Initiating polling fallback.");const K=6e4,ae=()=>{B.current&&!Ne.isConnected()?(Et.debug("Polling for notifications (socket disconnected)."),P(),v.current=Date.now(),b.current=setTimeout(ae,K)):(Et.info("Polling stopped (component unmounted or socket reconnected)."),b.current&&(clearTimeout(b.current),b.current=null))};b.current&&clearTimeout(b.current),b.current=setTimeout(ae,5e3)}return N&&!$.current&&(Et.info("Socket reconnected. Stopping any active polling and refreshing."),b.current&&(clearTimeout(b.current),b.current=null),P(),v.current=Date.now()),$.current=N,()=>{b.current&&clearTimeout(b.current)}},[N,P]);const x=d.useRef((a==null?void 0:a.length)||0);d.useEffect(()=>{const K=(a==null?void 0:a.length)||0;K>x.current&&I.current&&(Et.debug("New notifications detected, scrolling list to top."),I.current.scrollTop=0),x.current=K},[a]),d.useEffect(()=>{if(!a){F([]);return}Et.debug(`Filtering notifications. Count: ${a.length}, Filter: ${R}`);let K=[...a];if(R!=="all")if(R==="unread")K=K.filter(we=>!we.read);else{const Pe={Photos:["photoRequest","photoResponse"],Likes:["like","match"],Messages:["message"]}[R]||[R];K=K.filter(ce=>Pe.includes(ce.type))}const ae=[],ue={};K.forEach(we=>{var de,me,se,he,Ue;const ce=`${((de=we.sender)==null?void 0:de._id)||((se=(me=we.data)==null?void 0:me.sender)==null?void 0:se._id)||((Ue=(he=we.data)==null?void 0:he.requester)==null?void 0:Ue._id)||"unknown_sender"}_${we.type}`;ue[ce]?(ue[ce].count+=1,ue[ce].originalItems.push(we),new Date(we.createdAt)>new Date(ue[ce].createdAt)&&(ue[ce].createdAt=we.createdAt)):ue[ce]={...we,count:1,originalItems:[we]}}),Object.values(ue).forEach(we=>ae.push(we)),ae.sort((we,Pe)=>new Date(Pe.createdAt)-new Date(we.createdAt)),F(ae),Et.debug(`Filtered notifications count: ${ae.length}`)},[a,R]);const z=d.useCallback(async K=>{if(K&&(K.preventDefault(),K.stopPropagation()),!O){Et.info("Manual refresh triggered."),L(!0);try{await P(),v.current=Date.now(),H.success("Notifications refreshed!")}catch(ae){Et.error("Failed to refresh notifications:",ae),H.error("Could not refresh notifications. Please try again.")}finally{setTimeout(()=>{B.current&&L(!1)},300)}}},[P,O]),G=d.useCallback(K=>{Et.debug("Filter changed to:",K),j(K),I.current&&(I.current.scrollTop=0)},[]),Y=d.useCallback(K=>{K&&(K.preventDefault(),K.stopPropagation()),Et.info("Marking all notifications as read."),g(),Ps&&Ps.postMessage({type:"NOTIFICATION_READ",data:{all:!0}}),H.success("All notifications marked as read.")},[g]),oe=d.useCallback(K=>{Et.debug("Handling click for notification:",K._id),A(K),!K.read&&Ps&&Ps.postMessage({type:"NOTIFICATION_READ",data:{id:K._id}}),s&&o&&o()},[A,s,o]);d.useCallback(K=>{K&&(K.preventDefault(),K.stopPropagation()),Et.info("Adding test notification."),C()},[C]);const le=d.useCallback(()=>{const K=[{id:"all",label:"All"},{id:"unread",label:"Unread"},{id:"Messages",label:"Messages"},{id:"Likes",label:"Likes"},{id:"Photos",label:"Photos"}];return f&&Array.isArray(f)?K.filter(ae=>f.includes(ae.id)):K},[f]),ye=()=>{const K=le();return n.jsx("div",{className:"notification-filters",role:"tablist","aria-label":"Notification Filters",children:K.map(ae=>n.jsx(en,{className:`filter-btn ${R===ae.id?"active":""}`,onClick:()=>G(ae.id),variant:R===ae.id?"primary":"secondary",size:"small",role:"tab","aria-selected":R===ae.id,"aria-controls":"notification-list-panel",children:ae.label},ae.id))})};return _&&(a==null?void 0:a.length)===0?n.jsx("div",{className:`notification-loading ${c}`,style:l,children:n.jsx(sr,{size:"medium",text:h("loading","Loading notifications..."),centered:!0})}):!k||k.length===0?n.jsxs("div",{className:`notification-empty ${c}`,style:l,children:[n.jsx(Ar,{size:32,"aria-hidden":"true"}),n.jsx("p",{children:R==="unread"?h("noUnreadNotifications","No unread notifications"):R==="all"?h("noNotifications","No notifications yet"):h("noFilteredNotifications","No {{filter}} notifications",{filter:R.toLowerCase()})}),n.jsxs("div",{className:"notification-empty-actions",children:[n.jsx(en,{onClick:z,disabled:O,isLoading:O,variant:"secondary",size:"small",icon:n.jsx(gi,{}),children:O?h("refreshing","Refreshing..."):h("refresh","Refresh")}),!1]}),!N&&n.jsxs("div",{className:"notification-connection-status",children:[n.jsxs("div",{className:"connection-info",children:[" ",n.jsx("span",{className:"connection-dot disconnected",title:"Disconnected"}),n.jsx("small",{children:h("updatesPaused","Real-time updates paused")})]}),n.jsx(en,{onClick:()=>{Et.info("Manual reconnect attempt triggered."),Ne!=null&&Ne.reconnect?(Ne.reconnect(),H.info("Attempting to reconnect...")):H.warn("Reconnect function not available.")},variant:"link",size:"small",icon:n.jsx(gi,{}),className:"reconnect-btn",title:"Attempt to reconnect",children:h("reconnect","Reconnect")})]})]}):n.jsxs("div",{className:`notification-container ${c}`,style:l,role:"region","aria-label":"Notifications",children:[t&&n.jsxs("div",{className:"notification-header",children:[n.jsxs("div",{className:"notification-header-title",children:[n.jsx("span",{children:h("notificationsTitle","Notifications")}),R!=="all"&&n.jsxs("span",{className:"notification-filter-indicator",children:["(",R,")"]}),n.jsxs("div",{className:"notification-connection-indicator",title:N?"Real-time connection active":"Disconnected - Updates via polling",children:[n.jsx("span",{className:`connection-dot ${N?"connected":"disconnected"}`}),!N&&n.jsx("small",{className:"connection-status-text",children:h("offline","Offline")})]})]}),n.jsxs("div",{className:"notification-header-actions",children:[n.jsx(en,{className:"notification-header-action",onClick:z,title:"Refresh notifications",variant:"link",size:"small",icon:n.jsx(gi,{className:O?"spin":""}),disabled:O,"aria-label":"Refresh notifications",children:h("refresh","Refresh")}),p>0&&n.jsxs(en,{className:"notification-header-action",onClick:Y,variant:"link",size:"small",title:"Mark all notifications as read","aria-label":`Mark all ${p} as read`,children:[h("markAllRead","Mark all read")," (",p,")"]}),s&&o&&n.jsx(en,{className:"notification-close-btn",onClick:o,variant:"secondary",size:"small",icon:n.jsx(rs,{}),"aria-label":"Close notifications",children:h("close","Close")})]})]}),e&&!r&&ye(),n.jsx("div",{ref:I,className:"notification-list",style:{maxHeight:`${i}px`},role:"list",id:"notification-list-panel","aria-live":"polite",children:k.map(K=>n.jsx(zd,{notification:K,onClick:oe},K._id||`notification-${Math.random()}`))}),e&&r&&n.jsx("div",{className:"notification-footer",children:ye()})]})};function Hd(){const{theme:t,toggleTheme:e}=Sa(),[s,r]=d.useState(!1);return d.useEffect(()=>{r(!0)},[]),s?n.jsx("button",{onClick:e,className:"theme-toggle-btn","aria-label":t==="dark"?"Switch to light mode":"Switch to dark mode",children:t==="dark"?n.jsx(tg,{}):n.jsx(Vm,{})}):null}const Yc=De.create("LayoutComponents"),Rr=()=>{const[t,e]=d.useState(!1),[s,r]=d.useState(!1),[o,i]=d.useState(!1),c=d.useRef(null),l=d.useRef(null),f=d.useRef(null),{unreadCount:h,addTestNotification:a}=Ed(),{isAuthenticated:p,logout:_,user:N}=Gt(),{t:g}=Pt(),{isRTL:C}=Ht(),A=Zt();Pn();const P=async O=>{O.preventDefault(),await _()},R=()=>{A("/profile")},j=O=>{O&&(O.preventDefault(),O.stopPropagation()),Yc.debug("Toggle notification dropdown"),e(L=>!L),r(!1)},k=O=>{O.preventDefault(),O.stopPropagation(),r(!s),e(!1)};d.useEffect(()=>{const O=L=>{const E=L.target.closest(".notification-button");c.current&&!c.current.contains(L.target)&&!E&&e(!1),l.current&&!l.current.contains(L.target)&&!L.target.closest(".user-menu")&&r(!1)};return document.addEventListener("mousedown",O),()=>document.removeEventListener("mousedown",O)},[]);const F=()=>{e(!1)};return n.jsx("header",{className:`app-header ${C?"rtl-header":""}`,children:n.jsxs("div",{className:"header-inner",children:[n.jsx("div",{className:"header-logo",onClick:()=>A("/"),children:n.jsx("span",{children:"Mandarin"})}),p&&n.jsx("nav",{className:"header-nav",children:n.jsxs("ul",{className:"nav-tabs",children:[n.jsx("li",{children:n.jsxs("button",{className:`nav-tab ${window.location.pathname==="/dashboard"?"active":""}`,onClick:()=>A("/dashboard"),children:[n.jsx(xd,{}),n.jsx("span",{className:"nav-text",children:g("search")})]})}),n.jsx("li",{children:n.jsxs("button",{className:`nav-tab ${window.location.pathname==="/messages"?"active":""}`,onClick:()=>A("/messages"),children:[n.jsx(Rm,{}),n.jsx("span",{className:"nav-text",children:g("messages")})]})})]})}),n.jsxs("div",{className:"header-actions",children:[n.jsx(Hd,{}),n.jsx(Ud,{className:"navbar-language-selector"}),p?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"notification-wrapper",children:[n.jsxs("button",{ref:f,"aria-label":"Notifications",className:`notification-button ${o?"notification-pulse":""}`,onClick:O=>{O.stopPropagation(),O.preventDefault(),Yc.debug("Notification button clicked"),j(O)},style:{position:"relative",zIndex:102,cursor:"pointer"},children:[n.jsx(Ar,{}),h>0&&n.jsx("span",{className:"notification-badge",children:h>9?"9+":h})]}),t&&n.jsx("div",{ref:c,className:"notification-dropdown",children:n.jsx(xy,{isDropdown:!0,maxHeight:400,onClose:F,className:"notification-dropdown-content",customFilters:["all","unread"]})})]}),n.jsx("div",{className:"user-menu",children:n.jsxs("div",{className:"user-avatar-container",onClick:k,children:[N?n.jsx(Rn,{user:N,size:"small",alt:N.nickname,status:N.online?"online":null,showOnlineStatus:!0,className:"navbar-avatar"}):n.jsx(Yi,{className:"user-avatar-icon"}),s&&n.jsxs("div",{ref:l,className:"user-dropdown",children:[n.jsxs("div",{className:"user-dropdown-item",onClick:R,children:[n.jsx(Yi,{}),g("profile")]}),n.jsxs("div",{className:"user-dropdown-item",onClick:()=>A("/settings"),children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"12",r:"3"}),n.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),g("settings")]}),n.jsxs("div",{className:"user-dropdown-item",onClick:()=>A("/subscription"),children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"12",cy:"8",r:"7"}),n.jsx("polyline",{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"})]}),g("subscription")]}),n.jsx("div",{className:"user-dropdown-divider"}),n.jsxs("div",{className:"user-dropdown-item danger",onClick:P,children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),n.jsx("polyline",{points:"16 17 21 12 16 7"}),n.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),g("logout")]})]})]})})]}):n.jsxs("div",{className:"auth-buttons",children:[n.jsx(ot,{to:"/login",className:"btn btn-outline me-2",children:g("login")}),n.jsx(ot,{to:"/register",className:"btn btn-primary",children:g("register")})]})]})]})})},Sy="_userCard_1uxoq_4 _userCardVars_1uxoq_4",Cy="_cardPhoto_1uxoq_114",ky="_statusIndicator_1uxoq_133",Ny="_online_1uxoq_149",jy="_userInfo_1uxoq_166",Ty="_userNameRow_1uxoq_174",Ey="_userName_1uxoq_174",Ay="_userAge_1uxoq_196",Iy="_unreadBadge_1uxoq_207",$y="_lastActive_1uxoq_222",Py="_location_1uxoq_223",Ry="_icon_1uxoq_237",Ly="_tagsContainer_1uxoq_248",Oy="_detailsRow_1uxoq_252",My="_detailItem_1uxoq_259",By="_detailLabel_1uxoq_266",Fy="_tag_1uxoq_248",Dy="_identityTag_1uxoq_297",Uy="_identityWoman_1uxoq_307",qy="_identityMan_1uxoq_319",zy="_identityCouple_1uxoq_331",Hy="_lookingForTag_1uxoq_344",Vy="_intoTag_1uxoq_356",Wy="_interestTag_1uxoq_368",Gy="_moreCount_1uxoq_381",Yy="_tagCategory_1uxoq_400",Ky="_categoryTitle_1uxoq_404",Jy="_tagsGroup_1uxoq_415",Qy="_tagsToggle_1uxoq_423",Xy="_toggleBtn_1uxoq_427",Zy="_actions_1uxoq_449",e_="_actionBtn_1uxoq_456",t_="_likeBtn_1uxoq_483",s_="_messageBtn_1uxoq_493",n_="_active_1uxoq_503",r_="_listItem_1uxoq_514 _userCardVars_1uxoq_4",o_="_listPhotoContainer_1uxoq_543",i_="_listPhoto_1uxoq_543",a_="_listInfo_1uxoq_556",c_="_listHeader_1uxoq_563",l_="_listName_1uxoq_570",d_="_listLastActive_1uxoq_585",u_="_listActions_1uxoq_598",ze={userCard:Sy,cardPhoto:Cy,statusIndicator:ky,online:Ny,userInfo:jy,userNameRow:Ty,userName:Ey,userAge:Ay,unreadBadge:Iy,lastActive:$y,location:Py,icon:Ry,tagsContainer:Ly,detailsRow:Oy,detailItem:My,detailLabel:By,tag:Fy,identityTag:Dy,identityWoman:Uy,identityMan:qy,identityCouple:zy,lookingForTag:Hy,intoTag:Vy,interestTag:Wy,moreCount:Gy,tagCategory:Yy,categoryTitle:Ky,tagsGroup:Jy,tagsToggle:Qy,toggleBtn:Xy,actions:Zy,actionBtn:e_,likeBtn:t_,messageBtn:s_,active:n_,listItem:r_,listPhotoContainer:o_,listPhoto:i_,listInfo:a_,listHeader:c_,listName:l_,listLastActive:d_,listActions:u_},Kc=De.create("UserCard"),pn={IDENTITY:"identity",LOOKING_FOR:"lookingFor",INTO:"into",INTEREST:"interest"},ta=(t,e="")=>{const s=ze.tag,r=e.toLowerCase();if(r.includes("woman"))return`${s} ${ze.identityWoman}`;if(r.includes("man"))return`${s} ${ze.identityMan}`;if(r.includes("couple"))return`${s} ${ze.identityCouple}`;switch(t){case pn.IDENTITY:return`${s} ${ze.identityTag}`;case pn.LOOKING_FOR:return`${s} ${ze.lookingForTag}`;case pn.INTO:return`${s} ${ze.intoTag}`;case pn.INTEREST:return`${s} ${ze.interestTag}`;default:return s}},sa=({title:t,tags:e,tagType:s,translationNamespace:r,t:o,showAll:i,toggleShowAll:c,maxVisible:l=3})=>{if(!e||e.length===0)return null;const f=(p,_)=>_?o(_)||_:"",h=i?e:e.slice(0,l),a=e.length>l;return n.jsxs("div",{className:ze.tagCategory,children:[t&&n.jsx("h4",{className:ze.categoryTitle,children:t}),n.jsxs("div",{className:ze.tagsGroup,children:[h.map((p,_)=>n.jsx("span",{className:ta(s,p),children:f("",p)},`${s}-${_}`)),a&&!i&&n.jsxs("span",{className:ze.moreCount,onClick:c,children:["+",e.length-l]})]})]})},Vd=({user:t,isLiked:e=!1,onLike:s,viewMode:r="grid",onMessage:o,onClick:i,showExtendedDetails:c=!0,unreadMessageCount:l=0,hasUnreadMessages:f=!1})=>{const[h,a]=d.useState(!1),[p,_]=d.useState(!1),N=Zt(),{t:g}=Pt(),{isRTL:C}=Ht(),{user:A}=Gt(),{getProfilePhotoUrl:P,handlePhotoLoadError:R}=Pn(),j=d.useMemo(()=>({like:g("like")||"like",liked:g("liked")||"liked",message:g("message")||"message",online:g("online")||"online",offline:g("offline")||"offline",lastActive:g("lastActive")||"Last active",viewProfile:g("view")||"View",showMore:g("showMore")||"Show more",showLess:g("showLess")||"Show less"}),[g]);d.useEffect(()=>{const Y=()=>{Kc.debug(`Avatar refresh event received for user ${t.nickname}`)};return window.addEventListener("avatar:refresh",Y),()=>{window.removeEventListener("avatar:refresh",Y)}},[t.nickname]);const k=d.useCallback(Y=>{var oe;(oe=Y==null?void 0:Y.target)!=null&&oe.closest("button")||(i?i():t!=null&&t._id&&N(`/user/${t._id}`))},[i,N,t==null?void 0:t._id]),F=d.useCallback(Y=>{Y.stopPropagation(),Y.preventDefault(),s&&(t!=null&&t._id)&&(Kc.debug(`Like button clicked for user ${t._id}, current isLiked: ${e}`),s(t._id,t.nickname))},[s,t==null?void 0:t._id,t==null?void 0:t.nickname,e]),O=d.useCallback(Y=>{if(Y.stopPropagation(),Y.preventDefault(),o)o(Y,t);else if(t){const oe=new CustomEvent("openChat",{detail:{recipient:t}});window.dispatchEvent(oe)}},[o,t]),L=d.useCallback(Y=>{Y==null||Y.stopPropagation(),a(oe=>!oe)},[]),E=d.useCallback(Y=>{Y==null||Y.stopPropagation(),_(oe=>!oe)},[]),M=d.useCallback(Y=>Y?!!(Y.privacy==="private"||Y.isPrivate):!1,[]),I=d.useMemo(()=>A&&t&&A._id===t._id,[A,t]),v=d.useMemo(()=>{var oe;if(!((oe=t==null?void 0:t.photos)!=null&&oe.length))return`${window.location.origin}/default-avatar.png`;const Y=t.photos.find(le=>le.isProfile)||t.photos[0];return M(Y)&&!I?`${window.location.origin}/private-photo.png`:P(t)},[t,P,M,I]);d.useEffect(()=>{if(!document.getElementById("private-photo-styles")){const Y=document.createElement("style");Y.id="private-photo-styles",Y.innerHTML=`
        .private-photo-placeholder {
          object-fit: cover !important;
          width: 100% !important;
          height: 100% !important;
          border-radius: 4px !important;
        }
      `,document.head.appendChild(Y)}},[]);const b=d.useMemo(()=>{if(!(t!=null&&t.details))return{age:null,location:null,identity:null,status:null,tags:{lookingFor:[],into:[],interests:[]}};const{age:Y,location:oe,iAm:le,maritalStatus:ye,lookingFor:K=[],intoTags:ae=[],interests:ue=[]}=t.details;return{age:Y,location:oe||g("unknownLocation")||"Unknown location",identity:le||null,status:ye||null,tags:{lookingFor:K,into:ae,interests:ue}}},[t==null?void 0:t.details,g]),B=d.useMemo(()=>t!=null&&t.isOnline?j.online:t!=null&&t.lastActive?_o(t.lastActive,{showRelative:!0,showTime:!1,showDate:!1}):g("inactive")||"Never active",[t==null?void 0:t.lastActive,t==null?void 0:t.isOnline,g,j]);if(!t)return null;const $=()=>n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:F,"aria-label":`${e?"Unlike":"Like"} ${t.nickname}`,className:`${ze.actionBtn} ${ze.likeBtn} ${e?ze.active:""}`,children:[n.jsx(nn,{}),e?j.liked:j.like]}),n.jsxs("button",{onClick:O,"aria-label":`Message ${t.nickname}`,className:`${ze.actionBtn} ${ze.messageBtn}`,children:[n.jsx(er,{}),j.message]})]}),x=({isShowingMore:Y,onToggle:oe,showMoreText:le,showLessText:ye})=>n.jsx("div",{className:ze.tagsToggle,children:n.jsx("span",{className:ze.toggleBtn,onClick:oe,children:Y?n.jsxs(n.Fragment,{children:[ye||j.showLess," ",n.jsx(Am,{size:12})]}):n.jsxs(n.Fragment,{children:[le||j.showMore," ",n.jsx(Em,{size:12})]})})}),z=()=>n.jsx("div",{className:ze.tagsContainer,children:n.jsxs("div",{className:ze.detailsRow,children:[b.identity&&n.jsxs("div",{className:ze.detailItem,children:[n.jsxs("span",{className:ze.detailLabel,children:[g("iAm")||"I am",":"]}),n.jsx("span",{className:ta(pn.IDENTITY,b.identity),children:g(b.identity)||b.identity})]}),b.tags.lookingFor.length>0&&n.jsxs("div",{className:ze.detailItem,children:[n.jsxs("span",{className:ze.detailLabel,children:[g("lookingFor")||"Looking for",":"]}),n.jsx("span",{className:ta(pn.LOOKING_FOR,b.tags.lookingFor[0]),children:g(b.tags.lookingFor[0])||b.tags.lookingFor[0]}),b.tags.lookingFor.length>1&&n.jsxs("span",{className:ze.moreCount,children:["+",b.tags.lookingFor.length-1]})]})]})}),G=()=>n.jsxs(n.Fragment,{children:[(b.tags.lookingFor.length>0||b.tags.into.length>0||b.tags.interests.length>0)&&x({isShowingMore:p,onToggle:E,showMoreText:j.showMore,showLessText:j.showLess}),p&&n.jsxs(n.Fragment,{children:[n.jsx(sa,{title:g("interests")||"Interests",tags:b.tags.interests,tagType:pn.INTEREST,translationNamespace:"",t:g,showAll:h,toggleShowAll:L,maxVisible:r==="grid"?3:2}),n.jsx(sa,{title:g("preferences")||"Preferences",tags:b.tags.into,tagType:pn.INTO,translationNamespace:"",t:g,showAll:h,toggleShowAll:L,maxVisible:r==="grid"?3:2}),(b.tags.lookingFor.length>(r==="grid"?3:2)||b.tags.into.length>(r==="grid"?3:2)||b.tags.interests.length>(r==="grid"?3:2))&&x({isShowingMore:h,onToggle:L,showMoreText:g("showMore")||"Show more",showLessText:g("showLess")||"Show less"})]})]});return r==="grid"?n.jsxs("div",{className:ze.userCard,onClick:k,"data-userid":t._id,children:[n.jsxs("div",{className:ze.cardPhoto,children:[(()=>{var ye,K;const Y=((ye=t.photos)==null?void 0:ye.find(ae=>ae.isProfile))||((K=t.photos)==null?void 0:K[0]),le=M(Y)&&I?.7:1;return n.jsx("img",{src:v,alt:t.nickname,loading:"lazy",crossOrigin:"anonymous",className:v.includes("private-photo.png")?"private-photo-placeholder":"",style:{opacity:le,objectFit:"cover",width:"100%",height:"100%"},onError:ae=>{ae.target.onerror=null;const ue=`${window.location.origin}/default-avatar.png`;ae.target.src=ue,Y!=null&&Y._id&&R(Y._id,v)}})})(),t.isOnline&&n.jsx("span",{className:`${ze.statusIndicator} ${ze.online}`})]}),n.jsxs("div",{className:ze.userInfo,children:[n.jsxs("div",{className:ze.userNameRow,children:[n.jsxs("h3",{className:ze.userName,children:[t.nickname,b.age&&n.jsxs("span",{className:ze.userAge,children:[", ",b.age]})]}),f&&n.jsx("span",{className:ze.unreadBadge,children:l})]}),n.jsxs("p",{className:ze.lastActive,children:[n.jsx(xc,{className:ze.icon}),B]}),n.jsxs("p",{className:ze.location,children:[n.jsx(Ir,{className:ze.icon}),b.location]}),c&&n.jsxs(n.Fragment,{children:[z(),n.jsx("div",{className:ze.tagsContainer,children:G()})]}),n.jsx("div",{className:ze.actions,children:$()})]})]}):n.jsxs("div",{className:ze.listItem,onClick:k,"data-userid":t._id,children:[n.jsxs("div",{className:ze.listPhotoContainer,children:[(()=>{var ye,K;const Y=((ye=t.photos)==null?void 0:ye.find(ae=>ae.isProfile))||((K=t.photos)==null?void 0:K[0]),le=M(Y)&&I?.7:1;return n.jsx("img",{src:v,alt:t.nickname,loading:"lazy",crossOrigin:"anonymous",className:`${ze.listPhoto} ${v.includes("private-photo.png")?"private-photo-placeholder":""}`,style:{opacity:le,objectFit:"cover"},onError:ae=>{ae.target.onerror=null;const ue=`${window.location.origin}/default-avatar.png`;ae.target.src=ue,Y!=null&&Y._id&&R(Y._id,v)}})})(),t.isOnline&&n.jsx("span",{className:`${ze.statusIndicator} ${ze.online}`})]}),n.jsxs("div",{className:ze.listInfo,children:[n.jsxs("div",{className:ze.listHeader,children:[n.jsxs("h3",{className:ze.listName,children:[t.nickname,b.age&&n.jsxs("span",{className:ze.userAge,children:[", ",b.age]})]}),f&&n.jsx("span",{className:ze.unreadBadge,children:l})]}),n.jsxs("p",{className:ze.listLastActive,children:[n.jsx(xc,{className:ze.icon}),B]}),n.jsxs("p",{className:ze.location,children:[n.jsx(Ir,{className:ze.icon}),b.location]}),c&&n.jsxs(n.Fragment,{children:[z(),n.jsx("div",{className:ze.tagsContainer,children:G()})]})]}),n.jsx("div",{className:ze.listActions,children:$()})]})};Vd.propTypes={user:w.shape({_id:w.string.isRequired,nickname:w.string.isRequired,isOnline:w.bool,lastActive:w.string,photos:w.arrayOf(w.shape({url:w.string})),details:w.shape({age:w.oneOfType([w.number,w.string]),gender:w.string,location:w.string,maritalStatus:w.string,iAm:w.string,lookingFor:w.arrayOf(w.string),intoTags:w.arrayOf(w.string),interests:w.arrayOf(w.string)})}).isRequired,isLiked:w.bool,onLike:w.func,viewMode:w.oneOf(["grid","list"]),onMessage:w.func,onClick:w.func,showExtendedDetails:w.bool,unreadMessageCount:w.number,hasUnreadMessages:w.bool};sa.propTypes={title:w.string,tags:w.arrayOf(w.string).isRequired,tagType:w.string.isRequired,translationNamespace:w.string.isRequired,t:w.func.isRequired,showAll:w.bool.isRequired,toggleShowAll:w.func.isRequired,maxVisible:w.number};const h_=by(Vd,(t,e)=>t.user._id===e.user._id&&t.isLiked===e.isLiked&&t.viewMode===e.viewMode&&t.hasUnreadMessages===e.hasUnreadMessages&&t.unreadMessageCount===e.unreadMessageCount&&t.user.isOnline===e.user.isOnline,{debug:!1}),Co=br.MAX_SIZE.AVATAR,ko=[...br.ALLOWED_TYPES.IMAGES,...br.ALLOWED_TYPES.DOCUMENTS,...br.ALLOWED_TYPES.AUDIO,...br.ALLOWED_TYPES.VIDEOS,"text/plain"],Wd=kn.EMOJI.COMMON,f_=rn.UI.LOADING_TIMEOUT,p_=xt.CONNECTION.RECONNECT_DELAY_MIN,m_=rn.UI.INPUT_FOCUS_DELAY,g_=rn.DEBOUNCE.TYPING,y_=rn.DEBOUNCE.SMOOTH_SCROLL,__=rn.UI.UPLOAD_COMPLETE_DELAY,v_="_appWrapper_14qcl_6",w_="_messagesContainer_14qcl_23",b_="_sidebar_14qcl_34",x_="_chatArea_14qcl_48",S_="_hide_14qcl_71",C_="_fullWidth_14qcl_84",k_="_sidebarHeader_14qcl_90",N_="_chatHeader_14qcl_90",j_="_sidebarActions_14qcl_111",T_="_chatActions_14qcl_111",E_="_userInfo_14qcl_118",A_="_userName_14qcl_124",I_="_blockedTag_14qcl_134",$_="_pulseBg_14qcl_1",P_="_userStatus_14qcl_152",R_="_blockedStatus_14qcl_158",L_="_videoCallButton_14qcl_163",O_="_moreOptionsButton_14qcl_163",M_="_chatHeaderBtn_14qcl_163",B_="_spinner_14qcl_182",F_="_spin_14qcl_182",D_="_headerDropdown_14qcl_197",U_="_dropdownItem_14qcl_212",q_="_backButton_14qcl_262",z_="_newConversationButton_14qcl_281 _backButton_14qcl_262",H_="_conversationsHeader_14qcl_288",V_="_newMessageBtn_14qcl_302",W_="_conversationsList_14qcl_323",G_="_noConversations_14qcl_332",Y_="_startConversationBtn_14qcl_352",K_="_conversationItem_14qcl_367",J_="_active_14qcl_382",Q_="_unread_14qcl_387",X_="_conversationName_14qcl_387",Z_="_avatarContainer_14qcl_391",e2="_statusIndicator_14qcl_397",t2="_online_14qcl_407",s2="_conversationInfo_14qcl_411",n2="_unreadBadge_14qcl_434",r2="_conversationPreview_14qcl_448",o2="_conversationTime_14qcl_456",i2="_chatUser_14qcl_477",a2="_chatUserDetails_14qcl_485",c2="_statusText_14qcl_501",l2="_offline_14qcl_512",d2="_messagesArea_14qcl_526",u2="_messageGroup_14qcl_541",h2="_dateSeparator_14qcl_548",f2="_messageWrapper_14qcl_586",p2="_sent_14qcl_594",m2="_messageBubble_14qcl_598",g2="_bubbleIn_14qcl_1",y2="_received_14qcl_630",_2="_systemMessage_14qcl_640",v2="_systemMessageContent_14qcl_666",w2="_errorContent_14qcl_671",b2="_messageContent_14qcl_677",x2="_messageMeta_14qcl_682",S2="_messageTime_14qcl_690",C2="_fileMessage_14qcl_709",k2="_imageContainer_14qcl_716",N2="_imageAttachment_14qcl_726",j2="_loading_14qcl_740",T2="_shine_14qcl_1",E2="_imgCaption_14qcl_752",A2="_fileAttachment_14qcl_768",I2="_fileName_14qcl_779",$2="_fileSize_14qcl_785",P2="_downloadLink_14qcl_790",R2="_typingIndicatorBubble_14qcl_803",L2="_typingIndicator_14qcl_803",O2="_dot_14qcl_819",M2="_typingAnimation_14qcl_1",B2="_typingUserName_14qcl_850",F2="_inputWrapper_14qcl_857",D2="_inputArea_14qcl_867",U2="_messageInput_14qcl_878",q2="_blockedInput_14qcl_903",z2="_emojiButton_14qcl_909",H2="_attachButton_14qcl_909",V2="_winkButton_14qcl_909",W2="_sendButton_14qcl_909",G2="_disabled_14qcl_942",Y2="_sending_14qcl_948",K2="_emojiPicker_14qcl_963",J2="_emojiHeader_14qcl_975",Q2="_emojiList_14qcl_996",X2="_noActiveChat_14qcl_1017",Z2="_noMessages_14qcl_1017",ev="_noActiveChatContent_14qcl_1027",tv="_noMessagesContent_14qcl_1027",sv="_startChatButton_14qcl_1049",nv="_activeCallBanner_14qcl_1068",rv="_incomingCallBanner_14qcl_1068",ov="_incomingCallInfo_14qcl_1088",iv="_activeCallInfo_14qcl_1088",av="_callIcon_14qcl_1094",cv="_pulse_14qcl_1",lv="_incomingCallActions_14qcl_1109",dv="_acceptCallBtn_14qcl_1114",uv="_declineCallBtn_14qcl_1114",hv="_endCallBtn_14qcl_1114",fv="_acceptCallBtnSmall_14qcl_1127",pv="_declineCallBtnSmall_14qcl_1127",mv="_premiumBanner_14qcl_1160",gv="_premiumInfo_14qcl_1177",yv="_premiumIcon_14qcl_1183",_v="_crownIcon_14qcl_1183",vv="_upgradeButton_14qcl_1188",wv="_upgradeBtn_14qcl_1188",bv="_pullToRefreshIndicator_14qcl_1207",xv="_refreshSuccess_14qcl_1224",Sv="_refreshError_14qcl_1228",Cv="_videoCallOverlay_14qcl_1233",kv="_appInstallBanner_14qcl_1244",Nv="_show_14qcl_1259",jv="_appInstallText_14qcl_1266",Tv="_installButton_14qcl_1270",Ev="_attachmentPreview_14qcl_1287",Av="_attachmentInfo_14qcl_1296",Iv="_attachmentName_14qcl_1303",$v="_attachmentSize_14qcl_1311",Pv="_removeAttachment_14qcl_1317",Rv="_uploadProgressContainer_14qcl_1325",Lv="_uploadProgressLabel_14qcl_1332",Ov="_uploadProgressBar_14qcl_1339",Mv="_uploadProgressFill_14qcl_1346",Bv="_loadingMessages_14qcl_1353",Fv="_loadingActions_14qcl_1362",Dv="_retryButton_14qcl_1368",Uv="_reconnectButton_14qcl_1368",qv="_initButton_14qcl_1368",zv="_messageErrorDisplay_14qcl_1383",Hv="_errorIconLarge_14qcl_1397",Vv="_errorActions_14qcl_1403",Wv="_messagesLoading_14qcl_1409",Gv="_messageError_14qcl_1383",Yv="_winkMessage_14qcl_1446",Kv="_blockedUserBanner_14qcl_1452",Jv="_unblockButton_14qcl_1474",Qv="_blockedChatArea_14qcl_1492",Xv="_winkContent_14qcl_1501",Zv="_messageLabel_14qcl_1507",e0="_placeholderMessage_14qcl_1514",t0="_error_14qcl_671",s0="_pending_14qcl_1523",n0="_actionButton_14qcl_1547",r0="_messagesEnd_14qcl_1789",$e={appWrapper:v_,messagesContainer:w_,sidebar:b_,chatArea:x_,hide:S_,fullWidth:C_,sidebarHeader:k_,chatHeader:N_,sidebarActions:j_,chatActions:T_,userInfo:E_,userName:A_,blockedTag:I_,pulseBg:$_,userStatus:P_,blockedStatus:R_,videoCallButton:L_,moreOptionsButton:O_,chatHeaderBtn:M_,spinner:B_,spin:F_,headerDropdown:D_,dropdownItem:U_,backButton:q_,newConversationButton:z_,conversationsHeader:H_,newMessageBtn:V_,conversationsList:W_,noConversations:G_,startConversationBtn:Y_,conversationItem:K_,active:J_,unread:Q_,conversationName:X_,avatarContainer:Z_,statusIndicator:e2,online:t2,conversationInfo:s2,unreadBadge:n2,conversationPreview:r2,conversationTime:o2,chatUser:i2,chatUserDetails:a2,statusText:c2,offline:l2,messagesArea:d2,messageGroup:u2,dateSeparator:h2,messageWrapper:f2,sent:p2,messageBubble:m2,bubbleIn:g2,received:y2,systemMessage:_2,systemMessageContent:v2,errorContent:w2,messageContent:b2,messageMeta:x2,messageTime:S2,fileMessage:C2,imageContainer:k2,imageAttachment:N2,loading:j2,shine:T2,imgCaption:E2,fileAttachment:A2,fileName:I2,fileSize:$2,downloadLink:P2,typingIndicatorBubble:R2,typingIndicator:L2,dot:O2,typingAnimation:M2,typingUserName:B2,inputWrapper:F2,inputArea:D2,messageInput:U2,blockedInput:q2,emojiButton:z2,attachButton:H2,winkButton:V2,sendButton:W2,disabled:G2,sending:Y2,emojiPicker:K2,emojiHeader:J2,emojiList:Q2,noActiveChat:X2,noMessages:Z2,noActiveChatContent:ev,noMessagesContent:tv,startChatButton:sv,activeCallBanner:nv,incomingCallBanner:rv,incomingCallInfo:ov,activeCallInfo:iv,callIcon:av,pulse:cv,incomingCallActions:lv,acceptCallBtn:dv,declineCallBtn:uv,endCallBtn:hv,acceptCallBtnSmall:fv,declineCallBtnSmall:pv,premiumBanner:mv,premiumInfo:gv,premiumIcon:yv,crownIcon:_v,upgradeButton:vv,upgradeBtn:wv,pullToRefreshIndicator:bv,refreshSuccess:xv,refreshError:Sv,videoCallOverlay:Cv,appInstallBanner:kv,show:Nv,appInstallText:jv,installButton:Tv,attachmentPreview:Ev,attachmentInfo:Av,attachmentName:Iv,attachmentSize:$v,removeAttachment:Pv,uploadProgressContainer:Rv,uploadProgressLabel:Lv,uploadProgressBar:Ov,uploadProgressFill:Mv,loadingMessages:Bv,loadingActions:Fv,retryButton:Dv,reconnectButton:Uv,initButton:qv,messageErrorDisplay:zv,errorIconLarge:Hv,errorActions:Vv,messagesLoading:Wv,messageError:Gv,winkMessage:Yv,blockedUserBanner:Kv,unblockButton:Jv,blockedChatArea:Qv,winkContent:Xv,messageLabel:Zv,placeholderMessage:e0,error:t0,pending:s0,actionButton:n0,messagesEnd:r0},Qt=De.create("MessageItem"),Bo=ct.memo(({message:t,currentUserId:e,isSending:s=!1,customStyles:r=null})=>{var R;const o=r||$e;if(!t||!t._id&&!t.tempId)return Qt.warn("Invalid message object passed to MessageItem:",t),null;const i=j=>{var L,E;if(!j)return"";const k=(j.content||"").substring(0,30),F=((L=j.metadata)==null?void 0:L.fileName)||"",O=((E=j.createdAt)==null?void 0:E.substring(0,16))||"";return`${j.sender}-${O}-${F}-${k}-${j.type}`},c=ct.useMemo(()=>t.type==="file"?i(t):null,[t]),l=t.sender===e,f=t.type==="system",h=((R=t.metadata)==null?void 0:R.__localPlaceholder)===!0,a=t.error===!0;let p=null;l&&!f&&!a?t.pending||t.tempId&&s?p=n.jsx(Ts,{className:"fa-spin",size:14,title:"Sending...",style:{color:"#65abff"}}):t.read?p=n.jsx(Tm,{size:14,title:"Read",style:{color:"#4caf50"}}):p=n.jsx(mt,{size:14,title:"Sent",style:{color:"#65abff"}}):a&&(p=n.jsx(wa,{size:14,title:"Failed to send",style:{color:"#f44336"}}));const _=()=>n.jsx(n.Fragment,{children:a?n.jsxs("div",{className:o.errorMessageContent||o.messageContent,children:[n.jsx("span",{className:o.errorIcon,"aria-hidden":"true",children:"!"}),n.jsx("span",{children:t.content||"Failed to send"})]}):n.jsx("p",{className:o.messageContent,children:t.content||""})}),N=()=>n.jsxs("div",{className:o.winkContent,children:[n.jsx("p",{className:o.messageContent,children:"😉"}),n.jsx("span",{className:o.messageLabel,children:"Wink"})]}),g=()=>{var v,b;const{metadata:j}=t;if(!j)return n.jsx("p",{className:o.messageContent,children:"Attachment unavailable"});const k=j.fileUrl||j.url||j.serverUrl,F=h&&((v=j.url)!=null&&v.startsWith("blob:"))?j.url:null;let O=null;typeof window<"u"&&window.__fileMessages&&(t._id&&window.__fileMessages[t._id]?O=window.__fileMessages[t._id].url:c&&window.__fileMessagesByHash&&window.__fileMessagesByHash[c]&&(O=window.__fileMessagesByHash[c].url));const L=F||O||k,E=(b=j.fileType)==null?void 0:b.startsWith("image/"),M=B=>{if(typeof window<"u"&&B&&!B.startsWith("blob:")){window.__fileMessages||(window.__fileMessages={}),window.__fileMessagesByHash||(window.__fileMessagesByHash={});const $={url:B,timestamp:Date.now(),fileName:j.fileName};return t._id&&(window.__fileMessages[t._id]={...$,hash:c}),c&&(window.__fileMessagesByHash[c]={...$,id:t._id}),window.__fileUrlPersistTimeout||(window.__fileUrlPersistTimeout=setTimeout(()=>{try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash)),Qt.debug(`Persisted ${Object.keys(window.__fileMessages).length} file URLs to localStorage`)}catch(x){Qt.warn("Failed to persist file URLs to localStorage",x)}window.__fileUrlPersistTimeout=null},1e3)),!0}return!1},I=B=>j&&B?(j.url=B,j.fileUrl=B,j.serverUrl=B,!0):!1;return n.jsx("div",{className:o.fileMessage,children:E?n.jsxs("div",{className:o.imageContainer,children:[L?n.jsx("a",{href:k||"#",target:"_blank",rel:"noopener noreferrer",className:o.imageLink,onClick:B=>B.stopPropagation(),title:`View ${j.fileName||"image"}`,children:n.jsx("img",{src:L,alt:j.fileName||"Image attachment",className:bs(o.imageAttachment,h&&o.loading),loading:"lazy",style:{display:"block",visibility:"visible",minHeight:"100px"},onError:B=>{if(Qt.error(`Failed to load image: ${L}`),B.target.onerror=null,B.target.src="/placeholder-error.svg",B.target.classList.remove(o.loading),typeof window<"u"){let $=!1;if(t._id&&window.__fileMessages&&window.__fileMessages[t._id]){const x=window.__fileMessages[t._id].url;x&&x!==L&&(Qt.debug(`Attempting to recover image URL by ID: ${x}`),setTimeout(()=>{B.target.src=x,I(x)},100),$=!0)}if(!$&&c&&window.__fileMessagesByHash&&window.__fileMessagesByHash[c]){const x=window.__fileMessagesByHash[c].url;x&&x!==L&&(Qt.debug(`Attempting to recover image URL by hash: ${x}`),setTimeout(()=>{B.target.src=x,I(x),t._id&&(window.__fileMessages[t._id]={url:x,timestamp:Date.now(),hash:c})},150),$=!0)}if(!$&&L&&L.startsWith("http")){const x=L.startsWith("https")?L.replace("https","http"):L.replace("http","https");Qt.debug(`Attempting protocol switch recovery: ${x}`),setTimeout(()=>{B.target.src=x,B.target.complete&&B.target.naturalWidth>0&&(I(x),M(x))},200)}}},onLoad:B=>{B.target.classList.remove(o.loading);const $=B.target.src;$&&!$.startsWith("blob:")&&$!=="/placeholder-error.svg"&&(I($),M($))}})}):n.jsx("div",{className:o.imagePlaceholder,children:h?"Uploading...":"Image unavailable"}),n.jsxs("div",{className:o.imgCaption,children:[k?n.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",onClick:B=>B.stopPropagation(),title:`View ${j.fileName||"image"}`,children:j.fileName||"Image"}):n.jsx("span",{children:j.fileName||"Image"}),j.fileSize&&` (${Math.round(j.fileSize/1024)} KB)`,h&&!a&&n.jsx("span",{className:o.uploadingIndicatorSmall,children:" (Uploading...)"}),a&&n.jsx("span",{className:o.errorIndicatorSmall,children:" (Upload Failed)"})]})]}):n.jsxs("div",{className:o.fileAttachment,children:[n.jsx("span",{"aria-hidden":"true",children:Bd(j)}),n.jsxs("div",{className:o.fileInfo,children:[n.jsx("span",{className:o.fileName,children:j.fileName||"File"}),j.fileSize&&n.jsx("span",{className:o.fileSize,children:`(${Math.round(j.fileSize/1024)} KB)`}),!h&&k&&!a&&n.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",className:o.downloadLink,onClick:B=>B.stopPropagation(),download:j.fileName||!0,children:"Download"}),h&&!a&&n.jsx("span",{className:o.uploadingIndicator,children:"Uploading..."}),a&&n.jsx("span",{className:o.errorIndicator,children:"Upload Failed"})]})]})})},C=()=>n.jsx("div",{className:bs(o.systemMessageContent,t.error&&o.errorContent),children:n.jsx("p",{children:t.content})}),A=()=>n.jsxs("div",{className:o.videoCallMessage,children:[n.jsx(En,{className:o.videoIcon,"aria-hidden":"true"}),n.jsx("p",{className:o.messageContent,children:t.content||"Video Call Event"})]}),P=()=>{switch(t.type){case"text":return _();case"wink":return N();case"file":return g();case"system":return C();case"video":return A();default:return Qt.warn(`Unsupported message type: ${t.type}`,t),n.jsx("p",{className:o.messageContent,children:"Unsupported message"})}};return ct.useEffect(()=>{if(t.type!=="file"||!t.metadata)return;const j=()=>{let k=null;if(typeof window<"u"){if(!window.__fileMessages){window.__fileMessages={};try{const F=localStorage.getItem("mandarin_file_urls");F&&(window.__fileMessages=JSON.parse(F)||{},Qt.debug(`Loaded ${Object.keys(window.__fileMessages).length} file URLs from localStorage`))}catch(F){Qt.warn("Error loading file URLs from localStorage",F)}}if(!window.__fileMessagesByHash){window.__fileMessagesByHash={};try{const F=localStorage.getItem("mandarin_file_urls_by_hash");F&&(window.__fileMessagesByHash=JSON.parse(F)||{})}catch(F){Qt.warn("Error loading file URL hashes from localStorage",F)}}if(t._id&&window.__fileMessages[t._id])k=window.__fileMessages[t._id].url,Qt.debug(`Found cached URL for ${t._id} via ID lookup`);else if(c&&window.__fileMessagesByHash[c])k=window.__fileMessagesByHash[c].url,Qt.debug("Found cached URL for message via hash lookup"),t._id&&(window.__fileMessages[t._id]={url:k,timestamp:Date.now(),hash:c});else if(t.metadata.fileName){const F=Object.values(window.__fileMessages).filter(O=>O.fileName===t.metadata.fileName);F.length>0&&(k=F.sort((L,E)=>E.timestamp-L.timestamp)[0].url,Qt.debug(`Found cached URL via filename match: ${t.metadata.fileName}`))}}return k&&t.metadata?(Qt.debug(`Restoring file URL: ${k.substring(0,50)}...`),t.metadata.url=k,t.metadata.fileUrl=k,t.metadata.serverUrl=k,typeof window<"u"&&(t._id&&(window.__fileMessages[t._id]={url:k,timestamp:Date.now(),hash:c,fileName:t.metadata.fileName}),c&&(window.__fileMessagesByHash[c]={url:k,timestamp:Date.now(),id:t._id,fileName:t.metadata.fileName}),window.__fileUrlPersistTimeout||(window.__fileUrlPersistTimeout=setTimeout(()=>{try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash)),Qt.debug("Persisted file URLs to localStorage")}catch(F){Qt.warn("Failed to persist file URLs to localStorage",F)}window.__fileUrlPersistTimeout=null},1e3))),!0):!1};j(),(!t.metadata.url||!t.metadata.fileUrl)&&t._id&&setTimeout(()=>{!t.metadata.url&&!t.metadata.fileUrl&&(Qt.debug(`Retrying URL recovery for message ${t._id}`),j())},500)},[t,c]),n.jsxs("div",{className:o.messageWrapper,children:[n.jsx("div",{className:bs(o.messageBubble||o.message,l?o.sent:o.received,f?o.systemMessage:"",a?o.error:"",t.type==="wink"?o.winkMessage:"",h?o.placeholderMessage:"",t.pending?o.pending:""),"data-system-type":t.systemType||"",role:f?"status":"listitem","aria-label":f?"System message":`${l?"Sent":"Received"} ${t.type} message`,children:P()}),!f&&n.jsxs("div",{className:bs(o.messageMeta,l?o.metaSent:o.metaReceived),children:[n.jsx("span",{className:o.messageTime,title:new Date(t.createdAt).toLocaleString(),children:Kf(t.createdAt)}),l&&n.jsx("span",{className:o.statusIndicator,"aria-hidden":"true",children:p})]})]})});Bo.displayName="MessageItem";Bo.propTypes={message:w.shape({_id:w.string,tempId:w.string,sender:w.string.isRequired,recipient:w.string,content:w.string,createdAt:w.string.isRequired,type:w.string.isRequired,read:w.bool,pending:w.bool,error:w.bool,metadata:w.shape({fileName:w.string,fileType:w.string,fileSize:w.number,fileUrl:w.string,url:w.string,__localPlaceholder:w.bool}),senderName:w.string,senderPhoto:w.string}).isRequired,currentUserId:w.string.isRequired,isSending:w.bool,customStyles:w.object};const Fo=ct.memo(({messageValue:t,onInputChange:e,onSubmit:s,onWinkSend:r=()=>{},onFileAttachClick:o,onEmojiClick:i,userTier:c=ss.FREE,isSending:l=!1,isUploading:f=!1,attachmentSelected:h=!1,disabled:a=!1,isUserBlocked:p=!1,inputRef:_,placeholderText:N="Type a message...",customStyles:g=null})=>{const C=g||$e,[A,P]=d.useState(!1),R=d.useRef(null),{t:j}=Pt(),k=d.useMemo(()=>({messagePlaceholder:j("messagePlaceholder")||"Type a message...",sendMessage:j("sendMessage")||"Send Message",sendFile:j("sendFile")||"Send File",attachFile:j("attachFile")||"Attach File",addEmoji:j("addEmoji")||"Add Emoji",closeEmojiPicker:j("closeEmojiPicker")||"Close emoji picker",selectEmoji:j("selectEmoji")||"Select Emoji",sendWink:j("sendWink")||"Send Wink",blockedUserMessage:j("blockedUserMessage")||"Cannot send messages to blocked users",upgradeToSendText:j("upgradeToSendText")||"Upgrade to send text messages",upgradeToSendFiles:j("upgradeToSendFiles")||"Upgrade to send files",freeAccountWink:j("freeAccountWink")||"Send a wink instead (Free Account)",messageInput:j("messageInput")||"Message Input"}),[j]),F=x=>{e(x)},O=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),!l&&!f&&!a&&(t.trim()||h)&&(s(),x.target&&(x.target.style.height="auto")))},L=x=>{i(x),P(!1)};d.useEffect(()=>{const x=z=>{R.current&&!R.current.contains(z.target)&&!z.target.closest(`.${C.emojiButton}`)&&P(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const E=c===ss.FREE&&!h,M=(t.trim().length>0||h)&&!l&&!f&&!a,I=E?k.freeAccountWink||"Send a wink instead (Free Account)":N||k.messagePlaceholder||"Type a message...",v=a||l||f||E,b=a||l||f||c===ss.FREE,B=a||l||f,$=a||l||f;return n.jsxs("div",{className:C.inputWrapper,children:[A&&n.jsxs("div",{className:C.emojiPicker,ref:R,role:"dialog","aria-label":"Emoji picker",children:[n.jsxs("div",{className:C.emojiHeader,children:[n.jsx("h4",{children:k.selectEmoji||"Select Emoji"}),n.jsx("button",{onClick:()=>P(!1),"aria-label":k.closeEmojiPicker||"Close emoji picker",type:"button",children:n.jsx(rs,{})})]}),n.jsx("div",{className:C.emojiList,children:Wd.map(x=>n.jsx("button",{type:"button",onClick:()=>L(x),title:x,"aria-label":`Emoji ${x}`,children:x},x))})]}),n.jsxs("div",{className:C.inputArea,children:[n.jsx("button",{type:"button",className:C.emojiButton,onClick:()=>P(!A),disabled:$,title:"Add Emoji","aria-label":"Add Emoji","aria-expanded":A,children:n.jsx(Zm,{})}),n.jsx("textarea",{ref:_,className:bs(C.messageInput,p&&C.blockedInput),placeholder:p?k.blockedUserMessage||"Cannot send messages to blocked users":I,value:t,onChange:F,onKeyPress:O,rows:1,disabled:v||p,title:p?k.blockedUserMessage||"This user is blocked":E?k.upgradeToSendText||"Upgrade to send text messages":k.messagePlaceholder||"Type a message (Shift+Enter for newline)","aria-label":k.messageInput||"Message Input"}),n.jsx("button",{type:"button",className:C.attachButton,onClick:o,disabled:b,title:c===ss.FREE?k.upgradeToSendFiles||"Upgrade to send files":k.attachFile||"Attach File","aria-label":k.attachFile||"Attach File",children:n.jsx(vd,{})}),n.jsx("button",{type:"button",className:C.winkButton,onClick:r,disabled:B,title:k.sendWink||"Send Wink","aria-label":k.sendWink||"Send Wink",children:n.jsx(nn,{})}),n.jsx("button",{type:"button",onClick:s,className:bs(C.sendButton,!M&&C.disabled,(l||f)&&C.sending),disabled:!M,title:h?k.sendFile||"Send File":k.sendMessage||"Send Message","aria-label":h?k.sendFile||"Send File":k.sendMessage||"Send Message",children:l||f?n.jsx(Ts,{className:"fa-spin"}):n.jsx(Wm,{})})]})]})});Fo.displayName="ChatInput";Fo.propTypes={messageValue:w.string.isRequired,onInputChange:w.func.isRequired,onSubmit:w.func.isRequired,onWinkSend:w.func,onFileAttachClick:w.func.isRequired,onEmojiClick:w.func.isRequired,userTier:w.string,isSending:w.bool,isUploading:w.bool,attachmentSelected:w.bool,disabled:w.bool,isUserBlocked:w.bool,inputRef:w.oneOfType([w.func,w.shape({current:w.instanceOf(Element)})]),placeholderText:w.string,customStyles:w.object};const Jc=De.create("AttachmentPreview"),Do=ct.memo(({attachment:t,isUploading:e=!1,uploadProgress:s=0,onRemoveAttachment:r=()=>{},onFileSelected:o,onAttachmentClick:i,error:c=null,disabled:l=!1,userTier:f=null,showFileInput:h=!0,fileInputAccept:a=ko.join(","),customStyles:p=null})=>{const _=d.useRef(null),N=p||$e,g=t!=null&&t.size?t.size<1024*1024?`(${Math.round(t.size/1024)} KB)`:`(${(t.size/(1024*1024)).toFixed(1)} MB)`:"",C=d.useCallback(P=>{var j;const R=(j=P.target.files)==null?void 0:j[0];if(R){if(R.size>Co){const k=`File too large. Maximum size is ${Co/1048576}MB.`;Jc.warn(k,R),o&&o(null,k),P.target.value=null;return}if(!ko.includes(R.type)){const k=`File type (${R.type||"unknown"}) not supported.`;Jc.warn(k,R),o&&o(null,k),P.target.value=null;return}o&&o(R),P.target.value=null}},[o]),A=d.useCallback(()=>{l||(i?i():_.current&&_.current.click())},[l,i]);return t?n.jsxs("div",{className:bs(N.attachmentPreview,c&&N.error),children:[n.jsxs("div",{className:N.attachmentInfo,children:[n.jsx("span",{className:N.fileIconPreview,children:Bd(t)}),n.jsx("span",{className:N.attachmentName,title:t.name,children:t.name}),n.jsx("span",{className:N.attachmentSize,children:g}),c&&n.jsx("span",{className:N.errorMessagePreview,children:c})]}),e?n.jsxs("div",{className:N.uploadProgressContainer,children:[n.jsx("div",{className:N.uploadProgressBar,style:{width:`${s}%`},role:"progressbar","aria-valuenow":s,"aria-valuemin":"0","aria-valuemax":"100"}),n.jsxs("span",{className:N.uploadProgressText,children:[s,"%"]})]}):n.jsx("button",{type:"button",className:N.removeAttachment,onClick:r,disabled:e||l,title:"Remove attachment","aria-label":"Remove attachment",children:n.jsx(rs,{})})]}):h?n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:_,style:{display:"none"},onChange:C,accept:a,disabled:l,"aria-hidden":"true"}),i&&n.jsx("button",{type:"button",className:N.attachButton,onClick:A,disabled:l||f==="FREE",title:f==="FREE"?"Upgrade to send files":"Attach File","aria-label":"Attach File",children:n.jsx(vd,{})})]}):null});Do.displayName="AttachmentPreview";Do.propTypes={attachment:w.object,isUploading:w.bool,uploadProgress:w.number,onRemoveAttachment:w.func,onFileSelected:w.func,onAttachmentClick:w.func,error:w.string,disabled:w.bool,userTier:w.string,showFileInput:w.bool,fileInputAccept:w.string,customStyles:w.object};const Uo=ct.memo(({incomingCall:t=null,isCallActive:e,recipientNickname:s="user",onAcceptCall:r,onDeclineCall:o,onEndCall:i,useSmallButtons:c=!1,customStyles:l=null})=>{const f=l||$e,h=c?f.declineCallBtnSmall:f.declineCallBtn,a=c?f.acceptCallBtnSmall:f.acceptCallBtn;return n.jsxs(n.Fragment,{children:[t&&!e&&n.jsxs("div",{className:f.incomingCallBanner,role:"alert","aria-live":"assertive",children:[n.jsxs("div",{className:f.incomingCallInfo,children:[n.jsx(En,{className:bs(f.callIcon,f.pulse)}),n.jsxs("span",{children:[t.callerName||"Someone"," is calling you"]})]}),n.jsxs("div",{className:f.incomingCallActions,children:[n.jsxs("button",{className:h,onClick:o,"aria-label":"Decline call",title:"Decline Call",children:[n.jsx(rs,{})," ",!c&&"Decline"]}),n.jsxs("button",{className:a,onClick:r,"aria-label":"Accept call",title:"Accept Call",children:[n.jsx(En,{})," ",!c&&"Accept"]})]})]}),e&&n.jsxs("div",{className:f.activeCallBanner,role:"status",children:[n.jsxs("div",{className:f.activeCallInfo,children:[n.jsx(En,{className:f.callIcon}),n.jsxs("span",{children:["Call with ",s]})]}),n.jsxs("button",{className:f.endCallBtn,onClick:i,"aria-label":"End call",title:"End Call",children:[n.jsx(Gi,{})," End Call"]})]})]})});Uo.displayName="CallBanners";Uo.propTypes={incomingCall:w.shape({callId:w.string.isRequired,callerName:w.string,callerId:w.string.isRequired}),isCallActive:w.bool.isRequired,recipientNickname:w.string,onAcceptCall:w.func.isRequired,onDeclineCall:w.func.isRequired,onEndCall:w.func.isRequired,useSmallButtons:w.bool,customStyles:w.object};const qo=ct.memo(({onUpgradeClick:t,customStyles:e=null})=>{const s=e||$e;return n.jsxs("div",{className:s.premiumBanner,role:"complementary","aria-label":"Premium subscription banner",children:[n.jsxs("div",{className:s.premiumInfo,children:[n.jsx(pd,{className:s.premiumIcon,"aria-hidden":"true"}),n.jsx("span",{children:"Upgrade to send messages and make calls"})]}),n.jsx("button",{className:s.upgradeBtn,onClick:t,"aria-label":"Upgrade to premium",type:"button",children:"Upgrade Now"})]})});qo.displayName="PremiumBanner";qo.propTypes={onUpgradeClick:w.func.isRequired,customStyles:w.object};const Gd=({children:t,isUserBlocked:e=!1,className:s="",...r})=>{const o=typeof s=="boolean"?s?"active":"":s||"";return n.jsx("div",{className:bs($e.chatArea,e&&$e.blockedChatArea,o),...r,children:t})};Gd.propTypes={children:w.node.isRequired,isUserBlocked:w.bool,className:w.string};const Yd=ct.memo(Gd),Kd=({conversation:t,isMobile:e=!1,onBackClick:s,onStartVideoCall:r,onProfileClick:o,onBlockUser:i,onReportUser:c,userTier:l,customStyles:f,pendingPhotoRequests:h,isApprovingRequests:a,onApprovePhotoRequests:p,isActionDisabled:_,isConnected:N})=>{const g=f||$e,[C,A]=d.useState(!1),P=d.useRef(null),R=d.useRef(null),{t:j}=Pt(),k=d.useMemo(()=>({approvePhotoRequests:j("approvePhotoRequests")||"Approve photo requests",blockedUserMessage:j("blockedUserMessage")||"You have blocked this user. They will not receive any messages from you.",disconnected:j("disconnected")||"Disconnected",connectionLost:j("connectionLost")||"Connection lost",startVideoCall:j("startVideoCall")||"Start video call",viewProfile:j("viewProfile")||"View Profile",blockUser:j("blockUser")||"Block User",unblockUser:j("unblockUser")||"Unblock User",reportUser:j("reportUser")||"Report User",blocked:j("blocked")||"Blocked",online:j("online")||"Online",offline:j("offline")||"Offline",moreOptions:j("moreOptions")||"More options",unblock:j("unblock")||"Unblock"}),[j]);if(d.useEffect(()=>{const v=b=>{P.current&&!P.current.contains(b.target)&&!R.current.contains(b.target)&&A(!1)};return document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[]),!t||!t.user)return null;const{user:F}=t,O=F.nickname||F.username||"User",L=v=>{v.stopPropagation(),A(b=>!b)},E=v=>{v.stopPropagation(),A(!1),o()},M=v=>{v.stopPropagation(),A(!1),i&&i(F._id)},I=v=>{v.stopPropagation(),A(!1),c&&c(F._id)};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:g.chatHeader,children:[e&&n.jsx("button",{className:g.backButton,onClick:s,"aria-label":"Back to conversations",type:"button",children:n.jsx(Kn,{})}),n.jsxs("div",{className:g.conversationInfo,onClick:o,role:"button",tabIndex:0,"aria-label":`View ${O}'s profile`,onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&o()},children:[n.jsx(Rn,{user:F,size:"medium",status:F.online?"online":"offline",showOnlineStatus:!0}),n.jsxs("div",{className:g.userInfo,children:[n.jsxs("h3",{className:g.userName,children:[O,F.isBlocked&&n.jsx("span",{className:g.blockedTag,children:k.blocked||"Blocked"})]}),n.jsx("span",{className:`${g.userStatus} ${F.isBlocked?g.blockedStatus:""}`,children:F.isBlocked?k.blocked||"Blocked":F.online?k.online||"Online":k.offline||"Offline"}),N===!1&&n.jsxs("span",{className:g.connectionStatus,title:k.connectionLost||"Connection lost",children:[n.jsx(wa,{className:g.statusIcon}),n.jsx("span",{children:k.disconnected||"Disconnected"})]})]})]}),n.jsxs("div",{className:g.chatActions,children:[h>0&&p&&n.jsx("button",{className:g.chatHeaderBtn||g.videoCallButton,onClick:p,title:`Approve ${h} photo request(s)`,"aria-label":k.approvePhotoRequests||"Approve photo requests",disabled:a,type:"button",children:a?n.jsx(Ts,{className:"fa-spin"}):n.jsx(ns,{})}),n.jsx("button",{className:g.videoCallButton,onClick:r,"aria-label":k.startVideoCall||"Start video call",title:k.startVideoCall||"Start video call",type:"button",disabled:l==="FREE"||(_!==void 0?_:!1),children:n.jsx(En,{})}),n.jsx("button",{ref:R,className:g.moreOptionsButton,onClick:L,"aria-label":k.moreOptions||"More options",title:k.moreOptions||"More options",type:"button",children:n.jsx(gd,{})}),C&&n.jsxs("div",{ref:P,className:g.headerDropdown,children:[n.jsxs("button",{className:g.dropdownItem,onClick:E,type:"button",children:[n.jsx(jr,{})," ",k.viewProfile||"View Profile"]}),n.jsxs("button",{className:g.dropdownItem,onClick:M,type:"button",children:[n.jsx(va,{})," ",F.isBlocked?k.unblockUser||"Unblock User":k.blockUser||"Block User"]}),n.jsxs("button",{className:g.dropdownItem,onClick:I,type:"button",children:[n.jsx(_d,{})," ",k.reportUser||"Report User"]})]})]})]}),F.isBlocked&&n.jsxs("div",{className:g.blockedUserBanner,role:"alert",children:[n.jsxs("div",{children:[n.jsx(It,{}),k.blockedUserMessage||"You have blocked this user. They will not receive any messages from you."]}),n.jsx("button",{className:g.unblockButton,onClick:M,type:"button",children:k.unblock||"Unblock"})]})]})};Kd.propTypes={conversation:w.shape({user:w.shape({_id:w.string.isRequired,username:w.string,nickname:w.string,photo:w.string,online:w.bool,isBlocked:w.bool}).isRequired,pendingPhotoRequests:w.number}),isMobile:w.bool,onBackClick:w.func.isRequired,onStartVideoCall:w.func.isRequired,onProfileClick:w.func.isRequired,onBlockUser:w.func,onReportUser:w.func,userTier:w.string,customStyles:w.object,pendingPhotoRequests:w.number,isApprovingRequests:w.bool,onApprovePhotoRequests:w.func,isActionDisabled:w.bool,isConnected:w.bool};const Jd=ct.memo(Kd),Lr=ct.memo(({showTimeoutMessage:t,handleRetry:e,handleReconnect:s,customStyles:r=null})=>{const o=r||$e;return n.jsxs("div",{className:o.loadingMessages,role:"status","aria-live":"polite",children:[n.jsx(sr,{size:"medium",text:t?"Taking longer than expected...":"Loading messages...",centered:!0}),t&&n.jsxs("div",{className:o.loadingActions,children:[n.jsx("button",{className:o.retryButton,onClick:e,"aria-label":"Retry loading messages",type:"button",children:"Retry Load"}),n.jsx("button",{className:o.reconnectButton,onClick:s,"aria-label":"Force reconnect",type:"button",children:"Reconnect"})]})]})});Lr.displayName="LoadingIndicator";Lr.propTypes={showTimeoutMessage:w.bool.isRequired,handleRetry:w.func.isRequired,handleReconnect:w.func.isRequired,customStyles:w.object};const zo=ct.memo(({error:t="An unknown error occurred.",handleRetry:e,handleForceInit:s,showInitButton:r=!1,customStyles:o=null})=>{const i=o||$e;return n.jsxs("div",{className:i.messageErrorDisplay,role:"alert",children:[n.jsx(wa,{className:i.errorIconLarge,"aria-hidden":"true"}),n.jsx("p",{children:t}),n.jsxs("div",{className:i.errorActions,children:[n.jsx("button",{onClick:e,className:i.retryButton,"aria-label":"Retry loading messages",type:"button",children:"Retry Loading"}),r&&n.jsx("button",{onClick:s,className:i.initButton,"aria-label":"Force initialization",type:"button",children:"Force Init"})]})]})});zo.displayName="ErrorMessage";zo.propTypes={error:w.string,handleRetry:w.func.isRequired,handleForceInit:w.func.isRequired,showInitButton:w.bool,customStyles:w.object};const Ca=ct.memo(({handleReconnect:t,isInitializing:e,customStyles:s=null})=>{const r=s||$e;return n.jsxs("div",{className:r.loadingMessages,role:"status","aria-live":"polite",children:[n.jsx(sr,{size:"medium",text:e?"Initializing chat...":"Trying to reconnect...",centered:!0}),n.jsx("div",{className:r.errorActions,children:n.jsx("button",{onClick:t,className:r.retryButton,"aria-label":"Force reconnection",type:"button",children:"Reconnect Now"})})]})});Ca.displayName="ConnectionIssueMessage";Ca.propTypes={handleReconnect:w.func.isRequired,isInitializing:w.bool.isRequired,customStyles:w.object};const Ho=ct.memo(({text:t="No messages yet.",hint:e=null,customStyles:s=null})=>{const r=s||$e;return n.jsx("div",{className:r.noMessages,role:"status",children:n.jsxs("div",{className:r.noMessagesContent,children:[n.jsx(Gs,{size:40,"aria-hidden":"true"}),n.jsx("p",{children:t}),e&&n.jsx("p",{className:r.hint,children:e})]})})});Ho.displayName="NoMessagesPlaceholder";Ho.propTypes={text:w.string,hint:w.string,customStyles:w.object};const o0="_dark_vfayn_1",i0="_container_vfayn_1",a0="_btn_vfayn_1",c0="_card_vfayn_1",l0="_fadeIn_vfayn_1",d0="_slideUp_vfayn_1",u0="_slideDown_vfayn_1",h0="_slideLeft_vfayn_1",f0="_slideRight_vfayn_1",p0="_pulse_vfayn_1",m0="_spin_vfayn_157",g0="_videoCall_vfayn_4",y0="_videoContainer_vfayn_26",_0="_remoteVideoWrapper_vfayn_43",v0="_remoteVideo_vfayn_43",w0="_videoPlaceholder_vfayn_60",b0="_remoteVideoPlaceholder_vfayn_67",x0="_connectionQualityIndicator_vfayn_74",S0="_qualityCanvas_vfayn_87",C0="_qualityText_vfayn_91",k0="_remoteAudioIndicator_vfayn_98",N0="_localAudioIndicator_vfayn_109",j0="_audioLevelCanvas_vfayn_120",T0="_connectingIndicator_vfayn_125",E0="_waitingIndicator_vfayn_126",A0="_errorIndicator_vfayn_127",I0="_waitingSubtext_vfayn_151",$0="_retryCount_vfayn_168",P0="_errorMessage_vfayn_177",R0="_errorIcon_vfayn_190",L0="_retryButton_vfayn_196",O0="_errorEndCallButton_vfayn_197",M0="_audioOffIndicator_vfayn_228",B0="_localVideoWrapper_vfayn_243",F0="_localVideo_vfayn_243",D0="_localVideoPlaceholder_vfayn_270",U0="_callInfo_vfayn_277",q0="_videoStats_vfayn_293",z0="_callControls_vfayn_299",H0="_visible_vfayn_315",V0="_hidden_vfayn_320",W0="_controlButton_vfayn_326",G0="_active_vfayn_347",Y0="_endCall_vfayn_351",K0="_qualityDot_vfayn_360",J0="_excellent_vfayn_371",Q0="_good_vfayn_372",X0="_fair_vfayn_373",Z0="_poor_vfayn_374",ew="_unknown_vfayn_375",tw="_callDuration_vfayn_385",sw="_fadeOut_vfayn_1",Qe={dark:o0,"no-underline":"_no-underline_vfayn_1","app-wrapper":"_app-wrapper_vfayn_1","app-main":"_app-main_vfayn_1",container:i0,"main-content":"_main-content_vfayn_1",btn:a0,"btn-sm":"_btn-sm_vfayn_1","btn-lg":"_btn-lg_vfayn_1","btn-primary":"_btn-primary_vfayn_1","btn-secondary":"_btn-secondary_vfayn_1","btn-outline":"_btn-outline_vfayn_1",card:c0,"form-control":"_form-control_vfayn_1","section-title":"_section-title_vfayn_1","section-subtitle":"_section-subtitle_vfayn_1","gradient-text":"_gradient-text_vfayn_1","gradient-hero-text":"_gradient-hero-text_vfayn_1","glass-effect":"_glass-effect_vfayn_1","direction-changing":"_direction-changing_vfayn_1","sr-only":"_sr-only_vfayn_1","not-sr-only":"_not-sr-only_vfayn_1","skip-to-content":"_skip-to-content_vfayn_1","animate-fade-in":"_animate-fade-in_vfayn_1",fadeIn:l0,"animate-slide-up":"_animate-slide-up_vfayn_1",slideUp:d0,"animate-slide-down":"_animate-slide-down_vfayn_1",slideDown:u0,"animate-slide-left":"_animate-slide-left_vfayn_1",slideLeft:h0,"animate-slide-right":"_animate-slide-right_vfayn_1",slideRight:f0,"animate-pulse":"_animate-pulse_vfayn_1",pulse:p0,"animate-spin":"_animate-spin_vfayn_1",spin:m0,"delay-100":"_delay-100_vfayn_1","delay-200":"_delay-200_vfayn_1","delay-300":"_delay-300_vfayn_1","delay-400":"_delay-400_vfayn_1","delay-500":"_delay-500_vfayn_1","hover-scale":"_hover-scale_vfayn_1","hover-translate-y":"_hover-translate-y_vfayn_1","hover-shadow":"_hover-shadow_vfayn_1","transform-gpu":"_transform-gpu_vfayn_1",videoCall:g0,videoContainer:y0,remoteVideoWrapper:_0,remoteVideo:v0,videoPlaceholder:w0,remoteVideoPlaceholder:b0,connectionQualityIndicator:x0,qualityCanvas:S0,qualityText:C0,remoteAudioIndicator:k0,localAudioIndicator:N0,audioLevelCanvas:j0,connectingIndicator:T0,waitingIndicator:E0,errorIndicator:A0,waitingSubtext:I0,retryCount:$0,errorMessage:P0,errorIcon:R0,retryButton:L0,errorEndCallButton:O0,audioOffIndicator:M0,localVideoWrapper:B0,localVideo:F0,localVideoPlaceholder:D0,callInfo:U0,videoStats:q0,callControls:z0,visible:H0,hidden:V0,controlButton:W0,active:G0,endCall:Y0,qualityDot:K0,excellent:J0,good:Q0,fair:X0,poor:Z0,unknown:ew,callDuration:tw,fadeOut:sw},je=De.create("VideoCall"),nw=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:"turn:turn.example.org:3478",username:"turnuser",credential:"turnpassword"},{urls:"turn:turn.example.org:443?transport=tcp",username:"turnuser",credential:"turnpassword"}],Xt={peerConnection:{iceServers:nw,iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},media:{video:{width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:24,max:30}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},timeouts:{signaling:2e4,connection:3e4,reconnect:2e3,unansweredCall:45e3},retry:{maxCount:3},intervals:{stats:5e3,audioMeter:100}},Vt={drawConnectionQuality:(t,e)=>{if(!t)return;const s=t.getContext("2d");if(!s)return;s.clearRect(0,0,t.width,t.height);let r="#aaaaaa",o=0;switch(e){case"excellent":r="#4caf50",o=4;break;case"good":r="#8bc34a",o=3;break;case"fair":r="#ffc107",o=2;break;case"poor":r="#f44336",o=1;break;default:o=0}const i=Math.floor(t.width/5),c=Math.floor(i/4),l=i-c;s.fillStyle=r;for(let f=0;f<4;f++){const h=Math.floor(t.height*(.4+f*.2)),a=f*i,p=t.height-h;f<o?s.fillRect(a,p,l,h):(s.strokeStyle="#888888",s.lineWidth=1,s.strokeRect(a,p,l,h))}},drawAudioLevel:(t,e)=>{if(!t)return;const s=t.getContext("2d");if(!s)return;s.clearRect(0,0,t.width,t.height);const r=Math.min(1,Math.max(0,e)),o=s.createLinearGradient(0,t.height,0,0);o.addColorStop(0,"#4caf50"),o.addColorStop(.5,"#ffeb3b"),o.addColorStop(1,"#f44336"),s.fillStyle=o;const i=Math.round(t.height*r);s.fillRect(0,t.height-i,t.width,i),s.fillStyle="#222";for(let c=0;c<=10;c++){const l=t.height-c*t.height/10,f=c%5===0?10:5;s.fillRect(0,l,f,1)}},drawPlaceholderVideo:(t,e)=>{if(!t)return;const s=t.getContext("2d");if(!s)return;s.clearRect(0,0,t.width,t.height),s.fillStyle="#222",s.fillRect(0,0,t.width,t.height),s.fillStyle="#fff",s.font="20px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText(e||"Video Off",t.width/2,t.height/2),s.strokeStyle="#fff",s.lineWidth=2;const r=50,o=(t.width-r)/2,i=(t.height-r)/2-40;s.beginPath(),s.rect(o,i,r,r*.7),s.stroke(),s.beginPath(),s.arc(o+r/2,i+r*.35,r*.25,0,Math.PI*2),s.stroke(),s.beginPath(),s.moveTo(o-5,i-5),s.lineTo(o+r+5,i+r*.7+5),s.stroke()}},Us={getCandidateFingerprint:t=>t?typeof t=="string"?t:[t.candidate,t.sdpMid,t.sdpMLineIndex].join("|"):"",getSignalId:t=>{var e,s,r;if(!t||!t.type)return`invalid-${Date.now()}`;if(t.type==="ice-candidate")return`ice-${Us.getCandidateFingerprint(t.candidate)}`;if(t.type==="offer"||t.type==="answer"){const o=((s=(e=t.sdp)==null?void 0:e.sdp)==null?void 0:s.slice(0,150))||((r=t.sdp)==null?void 0:r.slice(0,150))||"";return`${t.type}-${o}`}return`${t.type}-${Date.now()}`},getConnectionQuality:t=>{if(!t)return"unknown";const e=t.iceConnectionState,s=t.connectionState;return s==="failed"||e==="failed"||s==="disconnected"||e==="disconnected"?"poor":s==="connecting"||e==="checking"?"fair":s==="connected"&&e==="connected"?"good":s==="connected"&&e==="completed"?"excellent":"unknown"},formatErrorMessage:t=>{if(!t)return null;if(typeof t=="string"){if(t.includes("Permission denied"))return"Camera or microphone access was denied. Please check browser permissions.";if(t.includes("NotFoundError")||t.includes("Devices not found"))return"Camera or microphone not found. Please check if they are connected and enabled.";if(t.includes("timed out"))return"Connection timed out. The other user may be offline.";if(t.includes("Could not access"))return"Unable to access camera or microphone. Please check connections and browser permissions.";if(t.includes("multiple attempts"))return"Connection failed after several attempts. Please check your network or try again later.";if(t.includes("Failed to set remote answer sdp: Called in wrong state"))return"Connection synchronization error. Attempting to recover...";if(t.includes("Failed to execute 'addIceCandidate'"))return"Network negotiation issue occurred. Attempting to continue...";if(t.includes("No answer"))return"No answer from the recipient. They may be away or unable to accept calls right now."}return`An unexpected error occurred${t?`: ${t.toString().split(":")[0]}`:""}. Please try again.`}},Qc=t=>{const e=Math.floor(t/60),s=Math.floor(t%60);return`${String(e).padStart(2,"0")}:${String(s).padStart(2,"0")}`},Vo=({isOpen:t,user:e,recipient:s,onEndCall:r,socketService:o,isIncoming:i=!1,callId:c=null})=>{const l=s==null?void 0:s._id,f=(s==null?void 0:s.nickname)||"User",h=e==null?void 0:e._id,a={localVideo:d.useRef(null),remoteVideo:d.useRef(null),localPlaceholder:d.useRef(null),remotePlaceholder:d.useRef(null),qualityCanvas:d.useRef(null),localAudioCanvas:d.useRef(null),remoteAudioCanvas:d.useRef(null),localStream:d.useRef(null),peerConnection:d.useRef(null),audioAnalyser:d.useRef(null),audioData:d.useRef(null),remoteAudioAnalyser:d.useRef(null),remoteAudioData:d.useRef(null),signallingTimeout:d.useRef(null),connectionTimeout:d.useRef(null),reconnectTimeout:d.useRef(null),candidateFlushTimeout:d.useRef(null),statsInterval:d.useRef(null),audioMeterInterval:d.useRef(null),unansweredCallTimeout:d.useRef(null),iceCandidateQueue:d.useRef([]),processedCandidates:d.useRef(new Set),processedSignals:d.useRef(new Set),incomingSignalQueue:d.useRef([]),negotiationInProgress:d.useRef(!1),isMounted:d.useRef(!1),connectionCompleted:d.useRef(!1),callAnswered:d.useRef(!1)},[p,_]=d.useState(!0),[N,g]=d.useState(!1),[C,A]=d.useState(!1),[P,R]=d.useState(!1),[j,k]=d.useState(!1),[F,O]=d.useState(!1),[L,E]=d.useState(!1),[M,I]=d.useState(null),[v,b]=d.useState(0),[B,$]=d.useState(0),[x,z]=d.useState(!0),[G,Y]=d.useState("unknown"),[oe,le]=d.useState(0),[ye,K]=d.useState(0),[ae,ue]=d.useState({resolution:"",frameRate:0,bitrate:0}),[we,Pe]=d.useState(!1),ce=d.useCallback(async()=>{if(je.debug("Initializing local media..."),_(!0),I(null),a.localStream.current){je.debug("Reusing existing media stream."),a.localVideo.current&&a.localVideo.current.srcObject!==a.localStream.current&&(a.localVideo.current.srcObject=a.localStream.current),!a.audioAnalyser.current&&a.localStream.current.getAudioTracks().length>0&&de();return}try{let U=null;try{je.debug("Requesting user media with video and audio constraints."),U=await navigator.mediaDevices.getUserMedia({video:Xt.media.video,audio:Xt.media.audio}),je.debug("Acquired video and audio stream."),A(!1),R(!1)}catch(y){je.warn(`Media acquisition with audio+video failed: ${y.message}. Trying fallbacks.`);try{U=await navigator.mediaDevices.getUserMedia({video:Xt.media.video}),A(!0),R(!1),H.warning("Microphone access failed. You are muted."),je.warn("Acquired video-only stream.")}catch(u){je.warn(`Video-only acquisition failed: ${u.message}. Trying audio only.`);try{U=await navigator.mediaDevices.getUserMedia({audio:Xt.media.audio}),A(!1),R(!0),H.warning("Camera access failed. Using audio only."),je.warn("Acquired audio-only stream.")}catch(m){throw je.error(`All media acquisition attempts failed: ${m.message}`),new Error("Could not access camera or microphone. Check connections & browser permissions.")}}}if(!U)throw new Error("Media stream acquisition failed unexpectedly.");a.localStream.current=U,a.localVideo.current&&(a.localVideo.current.srcObject=U,a.localVideo.current.muted=!0,(U.getVideoTracks().length===0||!U.getVideoTracks()[0].enabled)&&(R(!0),a.localPlaceholder.current&&Vt.drawPlaceholderVideo(a.localPlaceholder.current,"Camera Off"))),U.getAudioTracks().length>0&&de(),je.info("Media initialized successfully.")}catch(U){throw je.error("Media initialization failed:",U),I(`Media Error: ${U.message}`),_(!1),U}},[]),de=d.useCallback(()=>{if(!(!a.localStream.current||!a.localStream.current.getAudioTracks().length))try{const U=new(window.AudioContext||window.webkitAudioContext),y=U.createMediaStreamSource(a.localStream.current),u=U.createAnalyser();u.fftSize=256,y.connect(u),a.audioAnalyser.current=u,a.audioData.current=new Uint8Array(u.frequencyBinCount),a.audioMeterInterval.current&&clearInterval(a.audioMeterInterval.current),a.audioMeterInterval.current=setInterval(()=>{me()},Xt.intervals.audioMeter),je.debug("Audio visualization setup complete")}catch(U){je.warn("Could not setup audio visualization:",U)}},[]),me=d.useCallback(()=>{if(a.audioAnalyser.current&&a.audioData.current&&!C){a.audioAnalyser.current.getByteFrequencyData(a.audioData.current);const y=Array.from(a.audioData.current).reduce((u,m)=>u+m,0)/a.audioData.current.length/255;le(y),a.localAudioCanvas.current&&Vt.drawAudioLevel(a.localAudioCanvas.current,y)}else C&&a.localAudioCanvas.current&&(Vt.drawAudioLevel(a.localAudioCanvas.current,0),le(0));if(a.remoteAudioAnalyser.current&&a.remoteAudioData.current&&!j){a.remoteAudioAnalyser.current.getByteFrequencyData(a.remoteAudioData.current);const y=Array.from(a.remoteAudioData.current).reduce((u,m)=>u+m,0)/a.remoteAudioData.current.length/255;K(y),a.remoteAudioCanvas.current&&Vt.drawAudioLevel(a.remoteAudioCanvas.current,y)}else j&&a.remoteAudioCanvas.current&&(Vt.drawAudioLevel(a.remoteAudioCanvas.current,0),K(0))},[C,j]),se=d.useCallback(async()=>{if(!a.peerConnection.current)return;if(a.candidateFlushTimeout.current&&(clearTimeout(a.candidateFlushTimeout.current),a.candidateFlushTimeout.current=null),!a.peerConnection.current.remoteDescription){je.debug("Remote description not set yet, delaying candidate flush"),a.candidateFlushTimeout.current=setTimeout(se,500);return}const U=[...a.iceCandidateQueue.current];a.iceCandidateQueue.current=[],U.length>0&&je.debug(`Flushing ${U.length} queued ICE candidates.`);for(const y of U)try{const u=Us.getCandidateFingerprint(y);a.processedCandidates.current.has(u)||(await a.peerConnection.current.addIceCandidate(new RTCIceCandidate(y)),a.processedCandidates.current.add(u))}catch(u){je.error("Error adding queued ICE candidate:",u),(u.name==="OperationError"||u.message.includes("prerequisite"))&&a.iceCandidateQueue.current.push(y)}a.iceCandidateQueue.current.length>0&&!a.candidateFlushTimeout.current&&(a.candidateFlushTimeout.current=setTimeout(se,1e3))},[]),he=d.useCallback(async(U={})=>{if(!o){je.warn("createOffer: socketService prop is not available.");return}if(!a.peerConnection.current){je.error("Cannot create offer: Peer connection does not exist.");return}const y=a.peerConnection.current;if(y.signalingState!=="stable"){je.warn(`Cannot create offer in signaling state: ${y.signalingState}. Aborting.`);return}if(a.negotiationInProgress.current){je.warn("Negotiation already in progress, skipping offer creation.");return}try{a.negotiationInProgress.current=!0;const u={offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:(U==null?void 0:U.iceRestart)||!1},m=await y.createOffer(u);if(y.signalingState!=="stable"){je.warn(`Signaling state changed to ${y.signalingState} during offer creation. Aborting.`),a.negotiationInProgress.current=!1;return}await y.setLocalDescription(m);const S={type:"offer",sdp:y.localDescription},q=Us.getSignalId(S);a.processedSignals.current.add(q),o.emit("videoSignal",{recipientId:l,signal:S,from:{userId:h,callId:c}}),se(),!i&&!a.callAnswered.current&&(Pe(!0),a.unansweredCallTimeout.current&&clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=setTimeout(()=>{!a.callAnswered.current&&a.isMounted.current&&(je.warn("Call went unanswered for too long. Ending call attempt."),I("No answer from the recipient. They may be away or unable to accept calls right now."),_(!1),Pe(!1),r&&setTimeout(()=>{a.isMounted.current&&r()},5e3))},Xt.timeouts.unansweredCall))}catch(u){je.error("Error creating or setting offer:",u),I(`Signaling Error: ${u.message}`),a.negotiationInProgress.current=!1,Fe(he)}},[l,h,c,se,i,r,o]),Ue=d.useCallback(async()=>{je.debug(`Starting signaling. Role: ${i?"Callee (Incoming)":"Caller (Outgoing)"}`),a.signallingTimeout.current&&clearTimeout(a.signallingTimeout.current),a.signallingTimeout.current=setTimeout(()=>{a.isMounted.current&&!N&&p&&(je.error("Signaling timeout reached. Connection failed."),I("Connection timed out. The other user may be offline or have network issues."),_(!1),Pe(!1))},Xt.timeouts.signaling);try{if(!a.peerConnection.current)throw new Error("Peer connection not initialized before starting signaling.");i?je.debug("Incoming call: Waiting for offer from caller."):(je.debug("Outgoing call: Creating initial offer."),await he())}catch(U){je.error("Error during signaling initiation:",U),I(`Signaling Error: ${U.message}`),_(!1),Pe(!1)}},[i,he,N,p]),Me=d.useCallback(()=>{if(a.incomingSignalQueue.current.length>0){je.debug(`Flushing ${a.incomingSignalQueue.current.length} queued incoming signals`);const U=[...a.incomingSignalQueue.current];a.incomingSignalQueue.current=[],U.forEach(y=>{et(y)})}},[]),ht=d.useCallback(U=>{if(!o){je.warn("handleICECandidate: socketService prop is not available.");return}if(U.candidate&&a.peerConnection.current){const y=Us.getCandidateFingerprint(U.candidate);if(a.processedCandidates.current.has(y))return;a.processedCandidates.current.add(y),o.emit("videoSignal",{recipientId:l,signal:{type:"ice-candidate",candidate:U.candidate.toJSON()},from:{userId:h,callId:c}})}},[l,h,c,o]),gt=d.useCallback(U=>{try{if(!U.streams||U.streams.length===0){je.warn("Remote track received without a stream.");return}const y=U.streams[0];if(U.track.kind==="audio"&&!a.remoteAudioAnalyser.current)try{const u=new(window.AudioContext||window.webkitAudioContext),m=u.createMediaStreamSource(y),S=u.createAnalyser();S.fftSize=256,m.connect(S),a.remoteAudioAnalyser.current=S,a.remoteAudioData.current=new Uint8Array(S.frequencyBinCount)}catch(u){je.warn("Could not setup remote audio visualization:",u)}if(a.remoteVideo.current&&a.remoteVideo.current.srcObject!==y&&(a.remoteVideo.current.srcObject=y,a.connectionCompleted.current=!0,a.callAnswered.current=!0,g(!0),_(!1),Pe(!1),I(null),b(0),a.connectionTimeout.current&&(clearTimeout(a.connectionTimeout.current),a.connectionTimeout.current=null),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null)),U.track.kind==="audio"){const u=U.track.muted||!U.track.enabled;k(u),U.track.onmute=()=>k(!0),U.track.onunmute=()=>k(!1),U.track.onended=()=>k(!0)}else if(U.track.kind==="video"){const u=U.track.muted||!U.track.enabled;O(u),u&&a.remotePlaceholder.current&&Vt.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off"),U.track.onmute=()=>{O(!0),a.remotePlaceholder.current&&Vt.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off")},U.track.onunmute=()=>O(!1),U.track.onended=()=>{O(!0),a.remotePlaceholder.current&&Vt.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Video Ended")}}}catch(y){je.error("Error handling remote track:",y)}},[]),He=d.useCallback(()=>{if(!a.peerConnection.current)return;const U=a.peerConnection.current,y=U.connectionState,u=U.iceConnectionState,m=Us.getConnectionQuality(U);Y(m),a.qualityCanvas.current&&Vt.drawConnectionQuality(a.qualityCanvas.current,m),je.debug(`Connection states changed - RTCPeerConnection: ${y}, ICE: ${u}`),y==="connected"||u==="connected"||u==="completed"?(a.connectionCompleted.current=!0,a.callAnswered.current=!0,g(!0),_(!1),Pe(!1),I(null),a.negotiationInProgress.current=!1,b(0),a.connectionTimeout.current&&(clearTimeout(a.connectionTimeout.current),a.connectionTimeout.current=null),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null),se()):y==="disconnected"||u==="disconnected"?(je.warn(`Connection state: ${y}, ICE state: ${u}`),setTimeout(()=>{var S,q,J;a.isMounted.current&&(((S=a.peerConnection.current)==null?void 0:S.connectionState)==="disconnected"||((q=a.peerConnection.current)==null?void 0:q.iceConnectionState)==="disconnected")&&(je.warn("Connection still disconnected after grace period"),g(!1),((J=a.peerConnection.current)==null?void 0:J.iceConnectionState)==="disconnected"&&Fe(he))},3e3)):y==="failed"||u==="failed"?(je.error(`Connection failed - state: ${y}, ICE: ${u}`),g(!1),_(!1),I("Connection failed. Please retry."),it(wt,Ue)):y==="closed"?(je.info("Connection closed"),g(!1),_(!1)):(y==="connecting"||u==="checking")&&(N||_(!0))},[se,N]),wt=d.useCallback(async()=>{je.debug("Creating new RTCPeerConnection"),a.peerConnection.current&&(a.peerConnection.current.close(),a.peerConnection.current=null),a.processedCandidates.current.clear(),a.processedSignals.current.clear(),a.iceCandidateQueue.current=[],a.incomingSignalQueue.current=[],a.negotiationInProgress.current=!1;try{const U=new RTCPeerConnection(Xt.peerConnection);if(a.localStream.current)a.localStream.current.getTracks().forEach(y=>{try{U.addTrack(y,a.localStream.current)}catch(u){je.error(`Failed to add ${y.kind} track:`,u)}});else throw je.warn("No local stream available when creating peer connection."),new Error("Local media stream missing.");return U.ontrack=gt,U.onicecandidate=ht,U.onconnectionstatechange=He,U.oniceconnectionstatechange=He,U.onicegatheringstatechange=()=>{U.iceGatheringState==="complete"&&se()},U.onsignalingstatechange=()=>{a.negotiationInProgress.current=U.signalingState!=="stable"},a.peerConnection.current=U,Me(),U}catch(U){throw je.error("Fatal error creating peer connection:",U),I(`Failed to initialize connection: ${U.message}`),_(!1),U}},[gt,ht,He,se,Me]),ft=d.useCallback(async()=>{if(!o){je.warn("createAnswer: socketService prop is not available.");return}if(!a.peerConnection.current){je.error("Cannot create answer: Peer connection does not exist.");return}const U=a.peerConnection.current;if(U.signalingState!=="have-remote-offer"){je.warn(`Cannot create answer in signaling state: ${U.signalingState}. Aborting.`);return}try{a.negotiationInProgress.current=!0;const y=await U.createAnswer();if(U.signalingState!=="have-remote-offer"){je.warn("Signaling state changed during answer creation. Aborting."),a.negotiationInProgress.current=!1;return}await U.setLocalDescription(y);const u={type:"answer",sdp:U.localDescription},m=Us.getSignalId(u);a.processedSignals.current.add(m),o.emit("videoSignal",{recipientId:l,signal:u,from:{userId:h,callId:c}}),se(),i&&(a.callAnswered.current=!0)}catch(y){je.error("Error creating or setting answer:",y),I(`Signaling Error: ${y.message}`),a.negotiationInProgress.current=!1,Fe(he)}},[l,h,c,se,he,i,o]),et=d.useCallback(U=>{if(!U||!U.signal||!U.signal.type||!U.userId){je.warn("Received invalid signal data structure.");return}if(U.userId!==l)return;const y=U.signal,u=y.type;if(!a.peerConnection.current){je.warn(`Peer connection not ready. Queuing '${u}' signal.`),a.incomingSignalQueue.current.push(U);return}const m=a.peerConnection.current,S=m.signalingState,q=Us.getSignalId(y);if(!a.processedSignals.current.has(q))try{switch(u){case"request-offer":S==="stable"&&!a.negotiationInProgress.current&&he().catch(tt=>je.error("Error creating offer:",tt));break;case"offer":a.processedSignals.current.add(q),i||(Pe(!1),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null)),a.negotiationInProgress.current&&S==="have-local-offer"?(je.warn("Offer collision detected (both peers sending offers)."),h>l?(je.debug("This peer is polite. Rolling back local offer and accepting remote offer."),a.negotiationInProgress.current=!1,m.setLocalDescription({type:"rollback"}).then(()=>m.setRemoteDescription(new RTCSessionDescription(y.sdp))).then(()=>(se(),ft())).catch(Ye=>{je.error("Error handling polite offer collision:",Ye)})):je.debug("This peer is impolite. Ignoring remote offer, expecting peer to accept ours.")):S==="stable"||S==="have-remote-offer"?m.setRemoteDescription(new RTCSessionDescription(y.sdp)).then(()=>{if(se(),m.signalingState==="have-remote-offer")return ft()}).catch(tt=>{je.error("Error setting remote description:",tt),I(`Signaling Error: ${tt.message}`)}):(je.error(`Cannot handle offer in unexpected state: ${S}.`),Fe(he));break;case"answer":i||(a.callAnswered.current=!0,Pe(!1),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null)),S==="have-local-offer"&&(a.processedSignals.current.add(q),m.setRemoteDescription(new RTCSessionDescription(y.sdp)).then(()=>{je.debug("Remote answer set successfully. Connection should establish soon."),a.negotiationInProgress.current=!1,se()}).catch(tt=>{je.error("Error setting remote answer description:",tt),I(`Signaling Error: ${tt.message}`)}));break;case"ice-candidate":if(!y.candidate)return;const Z=new RTCIceCandidate(y.candidate),Se=Us.getCandidateFingerprint(Z);if(a.processedCandidates.current.has(Se))return;m.remoteDescription?m.addIceCandidate(Z).then(()=>{a.processedCandidates.current.add(Se)}).catch(tt=>{je.error("Error adding remote ICE candidate:",tt),m.signalingState!=="closed"&&a.iceCandidateQueue.current.push(Z)}):(je.debug("Queuing remote ICE candidate (no remote description yet)."),a.iceCandidateQueue.current.push(Z));break}}catch(J){je.error(`Error processing signal type ${u}:`,J),I(`Signaling Error: ${J.message}`),a.negotiationInProgress.current=!1,Fe(he)}},[l,h,c,he,ft,se,i]),Fe=d.useCallback(U=>{if(!a.peerConnection.current||!a.isMounted.current)return;const y=a.peerConnection.current;je.warn("Attempting connection recovery (ICE Restart)."),Y(Us.getConnectionQuality(y)),a.qualityCanvas.current&&Vt.drawConnectionQuality(a.qualityCanvas.current,"poor"),typeof y.restartIce=="function"&&(y.iceConnectionState==="disconnected"||y.iceConnectionState==="failed")?(je.debug("Performing ICE restart."),a.negotiationInProgress.current=!1,y.restartIce(),!i&&y.signalingState==="stable"&&(je.debug("Initiator attempting offer creation after ICE restart."),setTimeout(()=>{var u;a.isMounted.current&&((u=a.peerConnection.current)==null?void 0:u.signalingState)==="stable"&&U({iceRestart:!0}).catch(m=>je.error("Error creating recovery offer:",m))},500))):(je.warn(`ICE restart not applicable or supported. State: ${y.iceConnectionState}. Attempting full reconnect.`),it(wt,Ue))},[i,wt,Ue]),it=d.useCallback((U,y)=>{if(!a.isMounted.current)return;if(v>=Xt.retry.maxCount){je.error("Max reconnection attempts reached. Giving up."),I("Failed to establish connection after multiple attempts. Please check network or try again later."),_(!1);return}if(a.reconnectTimeout.current){je.debug("Reconnect attempt already scheduled.");return}_(!0),g(!1),b(m=>m+1);const u=v+1;je.warn(`Attempting full reconnect (${u}/${Xt.retry.maxCount}) in ${Xt.timeouts.reconnect}ms...`),I(`Connection lost. Attempting to reconnect (${u}/${Xt.retry.maxCount})...`),a.reconnectTimeout.current=setTimeout(async()=>{if(a.reconnectTimeout.current=null,!!a.isMounted.current)try{if(await U(),!a.isMounted.current)return;await y()}catch(m){je.error(`Error during reconnection attempt ${u}:`,m),I(`Reconnection failed: ${m.message}`),_(!1),u<Xt.retry.maxCount?it(U,y):(je.error("Final reconnection attempt failed."),I("Failed to reconnect. Please try again later."))}},Xt.timeouts.reconnect)},[v,wt]),T=d.useCallback(async()=>{if(!(!a.peerConnection.current||!N))try{const U=await a.peerConnection.current.getStats();let y=null,u=null;if(U.forEach(m=>{m.type==="inbound-rtp"&&m.kind==="video"&&(y=m),m.type==="candidate-pair"&&m.state==="succeeded"&&(u=m)}),y){const m=y.frameWidth||0,S=y.frameHeight||0,q=Math.round(y.framesPerSecond||0);ue({resolution:m&&S?`${m}x${S}`:"",frameRate:q,bitrate:Math.round((y.bytesReceived||0)/1024/8)})}if(u&&y){const m=u.currentRoundTripTime||0,S=y.packetsLost||0,q=y.packetsReceived||1,J=S/(S+q),Z=y.jitter||0;let Se="unknown";m<.1&&J<.01&&Z<.01?Se="excellent":m<.3&&J<.05&&Z<.03?Se="good":m<.5&&J<.1&&Z<.05?Se="fair":Se="poor",Y(Se),a.qualityCanvas.current&&Vt.drawConnectionQuality(a.qualityCanvas.current,Se)}}catch(U){je.warn("Error getting WebRTC stats:",U)}},[N]),D=d.useCallback(()=>{je.info("Closing VideoCall connection and cleaning up resources.");const U=["signallingTimeout","connectionTimeout","reconnectTimeout","candidateFlushTimeout","unansweredCallTimeout"],y=["statsInterval","audioMeterInterval"];U.forEach(u=>{a[u].current&&(clearTimeout(a[u].current),a[u].current=null)}),y.forEach(u=>{a[u].current&&(clearInterval(a[u].current),a[u].current=null)}),a.localStream.current&&(a.localStream.current.getTracks().forEach(u=>{u.stop()}),a.localStream.current=null),a.audioAnalyser.current=null,a.audioData.current=null,a.remoteAudioAnalyser.current=null,a.remoteAudioData.current=null,a.localVideo.current&&(a.localVideo.current.srcObject=null),a.remoteVideo.current&&(a.remoteVideo.current.srcObject=null),a.peerConnection.current&&(a.peerConnection.current.close(),a.peerConnection.current=null),a.iceCandidateQueue.current=[],a.incomingSignalQueue.current=[],a.processedCandidates.current.clear(),a.processedSignals.current.clear(),a.negotiationInProgress.current=!1,a.connectionCompleted.current=!1,a.callAnswered.current=!1},[]),re=d.useCallback(()=>{if(!o){je.warn("toggleMute: socketService prop is not available.");return}if(!a.localStream.current)return;const U=a.localStream.current.getAudioTracks();if(U.length>0){const y=!C;U[0].enabled=!y,A(y),a.localAudioCanvas.current&&Vt.drawAudioLevel(a.localAudioCanvas.current,y?0:oe),o.emit("videoMediaControl",{recipientId:l,type:"audio",muted:y})}},[C,l,oe,o]),fe=d.useCallback(()=>{if(!o){je.warn("toggleVideo: socketService prop is not available.");return}if(!a.localStream.current)return;const U=a.localStream.current.getVideoTracks();if(U.length>0){const y=!P;U[0].enabled=!y,R(y),a.localPlaceholder.current&&y&&Vt.drawPlaceholderVideo(a.localPlaceholder.current,"Camera Off"),o.emit("videoMediaControl",{recipientId:l,type:"video",muted:y})}},[P,l,o]),Re=d.useCallback(()=>{if(!o){je.warn("handleEndCall: socketService prop is not available."),r&&r();return}o.emit("videoHangup",{recipientId:l}),r&&r()},[l,r,o]),ee=d.useCallback(()=>{const U=document.querySelector(`.${Qe.videoContainer}`);U&&(document.fullscreenElement?document.exitFullscreen().then(()=>E(!1)):U.requestFullscreen().then(()=>E(!0)).catch(y=>H.error(`Could not enter fullscreen: ${y.message}`)))},[]);d.useEffect(()=>(a.isMounted.current=!0,()=>{a.isMounted.current=!1,D()}),[D]),d.useEffect(()=>{if(t&&a.isMounted.current){a.connectionCompleted.current=!1,a.callAnswered.current=!1,a.connectionTimeout.current=setTimeout(()=>{a.isMounted.current&&!a.connectionCompleted.current&&(I("Connection failed to establish after 30 seconds."),_(!1),Pe(!1))},Xt.timeouts.connection),(async()=>{try{if(I(null),_(!0),b(0),Pe(!1),await ce(),!a.isMounted.current||(await wt(),!a.isMounted.current)||(await Ue(),!a.isMounted.current))return}catch(u){a.isMounted.current&&(_(!1),Pe(!1),I(`Setup failed: ${u.message}`))}})(),a.statsInterval.current=setInterval(()=>{T()},Xt.intervals.stats);const y=setInterval(()=>{$(u=>u+1)},1e3);return()=>{clearInterval(y),D(),$(0)}}else!t&&a.peerConnection.current&&(D(),g(!1),_(!1),Pe(!1),I(null),b(0),$(0))},[t,ce,wt,Ue,D,T]),d.useEffect(()=>{if(!t||!o||!l){je.debug("Socket listener effect skipped: component not open or props missing.");return}je.debug("Setting up socket listeners for VideoCall");const U=Se=>et(Se),y=Se=>{Se.userId===l&&(je.info("Received hangup signal from peer."),H.info("The other user has ended the call."),r&&r())},u=Se=>{Se.userId===l&&(je.debug(`Received media control: type=${Se.type}, muted=${Se.muted}`),Se.type==="audio"&&(k(Se.muted),a.remoteAudioCanvas.current&&Vt.drawAudioLevel(a.remoteAudioCanvas.current,Se.muted?0:ye)),Se.type==="video"&&(O(Se.muted),Se.muted&&a.remotePlaceholder.current&&Vt.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off")))},m=Se=>{je.error(`Received remote error signal: ${Se==null?void 0:Se.error}`),I(`Remote Error: ${(Se==null?void 0:Se.error)||"Unknown issue"}`),_(!1),Pe(!1)},S=o.on("videoSignal",U),q=o.on("videoHangup",y),J=o.on("videoMediaControl",u),Z=o.on("videoError",m);return()=>{je.debug("Cleaning up socket listeners for VideoCall"),typeof S=="function"&&S(),typeof q=="function"&&q(),typeof J=="function"&&J(),typeof Z=="function"&&Z()}},[t,l,r,et,ye,o]),d.useEffect(()=>{let U=null;const y=()=>{z(!0),U&&clearTimeout(U),U=setTimeout(()=>{a.isMounted.current&&z(!1)},3e3)},u=document.querySelector(`.${Qe.videoContainer}`);return u&&(u.addEventListener("mousemove",y),y()),()=>{U&&clearTimeout(U),u==null||u.removeEventListener("mousemove",y)}},[]),d.useEffect(()=>{a.qualityCanvas.current&&Vt.drawConnectionQuality(a.qualityCanvas.current,G),a.localAudioCanvas.current&&Vt.drawAudioLevel(a.localAudioCanvas.current,C?0:oe),a.remoteAudioCanvas.current&&Vt.drawAudioLevel(a.remoteAudioCanvas.current,j?0:ye),P&&a.localPlaceholder.current&&Vt.drawPlaceholderVideo(a.localPlaceholder.current,"Camera Off"),F&&a.remotePlaceholder.current&&Vt.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off")},[G,oe,ye,C,j,P,F]);const X=()=>n.jsxs("div",{className:`${Qe.callControls} ${x?Qe.visible:Qe.hidden}`,children:[n.jsx("button",{className:`${Qe.controlButton} ${C?Qe.active:""}`,onClick:re,"aria-label":C?"Unmute Microphone":"Mute Microphone","aria-pressed":C,children:C?n.jsx(kc,{}):n.jsx(Hm,{})}),n.jsx("button",{className:`${Qe.controlButton} ${P?Qe.active:""}`,onClick:fe,"aria-label":P?"Turn Camera On":"Turn Camera Off","aria-pressed":P,children:P?n.jsx(cg,{}):n.jsx(En,{})}),n.jsx("button",{className:`${Qe.controlButton} ${Qe.endCall}`,onClick:Re,"aria-label":"End Call",children:n.jsx(Gi,{})}),n.jsx("button",{className:`${Qe.controlButton} ${L?Qe.active:""}`,onClick:ee,"aria-label":L?"Exit Fullscreen":"Enter Fullscreen","aria-pressed":L,children:L?n.jsx(Pm,{}):n.jsx(Lm,{})}),n.jsxs("button",{className:Qe.controlButton,"aria-label":"Show connection quality",children:[n.jsx(Xm,{}),n.jsx("span",{className:`${Qe.qualityDot} ${Qe[G]}`})]})]});return n.jsx("div",{className:Qe.videoCall,children:n.jsxs("div",{className:Qe.videoContainer,children:[n.jsxs("div",{className:Qe.remoteVideoWrapper,children:[n.jsx("video",{ref:a.remoteVideo,className:Qe.remoteVideo,autoPlay:!0,playsInline:!0}),F&&n.jsx("canvas",{ref:a.remotePlaceholder,className:`${Qe.videoPlaceholder} ${Qe.remoteVideoPlaceholder}`,width:"640",height:"480"}),n.jsxs("div",{className:Qe.connectionQualityIndicator,children:[n.jsx("canvas",{ref:a.qualityCanvas,width:"100",height:"30",className:`${Qe.qualityCanvas} ${Qe[G]}`}),n.jsx("span",{className:`${Qe.qualityText} ${Qe[G]}`,children:G})]}),n.jsx("div",{className:Qe.remoteAudioIndicator,children:n.jsx("canvas",{ref:a.remoteAudioCanvas,width:"15",height:"80",className:Qe.audioLevelCanvas})}),j&&!p&&!M&&n.jsx("div",{className:Qe.audioOffIndicator,children:n.jsx(kc,{"aria-label":"Remote peer muted"})}),we&&!M&&n.jsxs("div",{className:Qe.waitingIndicator,children:[n.jsx(Ts,{className:Qe.spin,"aria-hidden":"true"}),n.jsxs("span",{children:["Calling ",f,"..."]}),n.jsx("span",{className:Qe.waitingSubtext,children:"Waiting for answer"})]}),p&&!N&&!we&&n.jsxs("div",{className:Qe.connectingIndicator,children:[n.jsx(Ts,{className:Qe.spin,"aria-hidden":"true"}),n.jsx("span",{children:"Connecting..."}),v>0&&n.jsxs("span",{className:Qe.retryCount,children:["Attempt ",v,"/",Xt.retry.maxCount]})]}),M&&!p&&n.jsx("div",{className:Qe.errorIndicator,children:n.jsxs("div",{className:Qe.errorMessage,children:[n.jsx(It,{className:Qe.errorIcon}),n.jsx("span",{children:Us.formatErrorMessage(M)}),v<Xt.retry.maxCount&&!N&&n.jsxs("button",{className:Qe.retryButton,onClick:()=>it(wt,Ue),"aria-label":"Retry connection",children:[n.jsx(rg,{})," Retry"]}),n.jsxs("button",{className:Qe.errorEndCallButton,onClick:Re,"aria-label":"End Call",children:[n.jsx(Gi,{})," End Call"]})]})})]}),n.jsxs("div",{className:Qe.localVideoWrapper,children:[n.jsx("video",{ref:a.localVideo,className:Qe.localVideo,autoPlay:!0,playsInline:!0,muted:!0}),P&&n.jsx("canvas",{ref:a.localPlaceholder,className:`${Qe.videoPlaceholder} ${Qe.localVideoPlaceholder}`,width:"160",height:"120"}),n.jsx("div",{className:Qe.localAudioIndicator,children:n.jsx("canvas",{ref:a.localAudioCanvas,width:"10",height:"60",className:Qe.audioLevelCanvas})})]}),n.jsxs("div",{className:Qe.callInfo,children:[n.jsx("span",{className:Qe.callDuration,"aria-label":`Call duration: ${Qc(B)}`,children:Qc(B)}),N&&ae.resolution&&n.jsxs("span",{className:Qe.videoStats,children:[ae.resolution," • ",ae.frameRate," fps"]})]}),X()]})})};Vo.propTypes={isOpen:w.bool.isRequired,user:w.shape({_id:w.string.isRequired}),recipient:w.shape({_id:w.string.isRequired,nickname:w.string}),onEndCall:w.func.isRequired,socketService:w.object.isRequired,isIncoming:w.bool,callId:w.string};Vo.defaultProps={isIncoming:!1,callId:null,user:null,recipient:null};const rw="_storiesCarouselContainer_1vzgs_14",ow="_storiesCarousel_1vzgs_14",iw="_carouselNavButton_1vzgs_42",aw="_carouselNavButtonLeft_1vzgs_67",cw="_carouselNavButtonRight_1vzgs_71",lw="_storyThumbnail_1vzgs_76",dw="_avatarBorder_1vzgs_92",uw="_avatarBorderViewed_1vzgs_104",hw="_imageContainer_1vzgs_112",fw="_thumbnailImage_1vzgs_127",pw="_username_1vzgs_146",mw="_comingSoonBadge_1vzgs_163",gw="_mediaTypeIcon_1vzgs_178",yw="_storiesViewerOverlay_1vzgs_200",_w="_storiesViewerContainer_1vzgs_214",vw="_storiesViewerHeader_1vzgs_225",ww="_storiesProgressContainer_1vzgs_237",bw="_storiesProgressBar_1vzgs_244",xw="_storiesProgressFill_1vzgs_252",Sw="_storiesUserInfo_1vzgs_265",Cw="_storiesUserAvatar_1vzgs_271",kw="_storiesUserDetails_1vzgs_280",Nw="_storiesUsername_1vzgs_284",jw="_storiesTimestamp_1vzgs_291",Tw="_storiesCloseBtn_1vzgs_297",Ew="_storiesViewerContent_1vzgs_314",Aw="_storiesImageContainer_1vzgs_327",Iw="_storiesVideoContainer_1vzgs_328",$w="_storiesTextContent_1vzgs_329",Pw="_storiesMedia_1vzgs_339",Rw="_storyCaption_1vzgs_359",Lw="_storiesViewerNavigation_1vzgs_372",Ow="_storiesNavLeft_1vzgs_382",Mw="_storiesNavRight_1vzgs_383",Bw="_storiesActions_1vzgs_390",Fw="_storyActionButton_1vzgs_400",Dw="_active_1vzgs_416",Uw="_videoControl_1vzgs_423",qw="_pauseIndicator_1vzgs_440",zw="_doubleTapHeart_1vzgs_457",Hw="_spinner_1vzgs_476",Vw="_errorMessage_1vzgs_493",Ww="_storyCreatorModal_1vzgs_532",Gw="_storyPreviewFrame_1vzgs_539",Yw="_storyCreatorContainer_1vzgs_881",Kw="_storyCreatorOverlay_1vzgs_893",Jw="_storyCreatorHeader_1vzgs_922",Qw="_storyCreatorTitle_1vzgs_936",Xw="_storyCreatorCloseButton_1vzgs_943",Zw="_storyCreatorContent_1vzgs_963",eb="_storyCreatorPreview_1vzgs_970",tb="_storyTextContent_1vzgs_996",sb="_storyPlaceholder_1vzgs_1007",nb="_storyCreatorTabs_1vzgs_1013",rb="_storyCreatorTab_1vzgs_1013",ob="_storyCreatorTabContent_1vzgs_1064",ib="_storyCreatorInput_1vzgs_1073",ab="_storyCreatorCharCount_1vzgs_1100",cb="_storyCreatorFooter_1vzgs_1111",lb="_storyCreatorButton_1vzgs_1125",db="_storyCreatorPrimaryButton_1vzgs_1138",ub="_storyCreatorOutlineButton_1vzgs_1156",hb="_uploadProgressContainer_1vzgs_1178",fb="_storyCreatorProgressContainer_1vzgs_1185",pb="_storyCreatorProgressFill_1vzgs_1197",mb="_storyCreatorBackgroundOptions_1vzgs_1220",gb="_storyCreatorBackgroundOption_1vzgs_1220",yb="_selected_1vzgs_1239",ge={storiesCarouselContainer:rw,storiesCarousel:ow,carouselNavButton:iw,carouselNavButtonLeft:aw,carouselNavButtonRight:cw,storyThumbnail:lw,avatarBorder:dw,avatarBorderViewed:uw,imageContainer:hw,thumbnailImage:fw,username:pw,comingSoonBadge:mw,mediaTypeIcon:gw,storiesViewerOverlay:yw,storiesViewerContainer:_w,storiesViewerHeader:vw,storiesProgressContainer:ww,storiesProgressBar:bw,storiesProgressFill:xw,storiesUserInfo:Sw,storiesUserAvatar:Cw,storiesUserDetails:kw,storiesUsername:Nw,storiesTimestamp:jw,storiesCloseBtn:Tw,storiesViewerContent:Ew,storiesImageContainer:Aw,storiesVideoContainer:Iw,storiesTextContent:$w,storiesMedia:Pw,storyCaption:Rw,storiesViewerNavigation:Lw,storiesNavLeft:Ow,storiesNavRight:Mw,storiesActions:Bw,storyActionButton:Fw,active:Dw,videoControl:Uw,pauseIndicator:qw,doubleTapHeart:zw,spinner:Hw,errorMessage:Vw,storyCreatorModal:Ww,storyPreviewFrame:Gw,storyCreatorContainer:Yw,storyCreatorOverlay:Kw,storyCreatorHeader:Jw,storyCreatorTitle:Qw,storyCreatorCloseButton:Xw,storyCreatorContent:Zw,storyCreatorPreview:eb,storyTextContent:tb,storyPlaceholder:sb,storyCreatorTabs:nb,storyCreatorTab:rb,storyCreatorTabContent:ob,storyCreatorInput:ib,storyCreatorCharCount:ab,storyCreatorFooter:cb,storyCreatorButton:lb,storyCreatorPrimaryButton:db,storyCreatorOutlineButton:ub,uploadProgressContainer:hb,storyCreatorProgressContainer:fb,storyCreatorProgressFill:pb,storyCreatorBackgroundOptions:mb,storyCreatorBackgroundOption:gb,selected:yb},wn=De.create("StoriesViewer"),Qd=({storyId:t,userId:e,onClose:s})=>{const{stories:r=[],viewStory:o,loadUserStories:i,loadStories:c,reactToStory:l}=Br()||{},{user:f}=_n()||{},{user:h,isAuthenticated:a}=Gt()||{},p=h||f,[_,N]=d.useState(0),[g,C]=d.useState(0),[A,P]=d.useState(!1),[R,j]=d.useState(!1),[k,F]=d.useState(null),[O,L]=d.useState([]),[E,M]=d.useState(!0),[I,v]=d.useState(!1),[b,B]=d.useState(!1),[$,x]=d.useState(!1),[z,G]=d.useState(!1),[Y,oe]=d.useState({x:0,y:0}),[le,ye]=d.useState(!1),K=d.useRef(null),ue=100/(5e3/100),we=d.useRef(null),Pe=d.useRef(null),ce=d.useRef(null),de=d.useRef({x:0,y:0,time:0}),me=d.useRef(0),se=e?O:r;d.useEffect(()=>{(!r||!r.length)&&c&&c(!0).catch(ee=>wn.error("Error loading stories:",ee))},[r,c]),d.useEffect(()=>{(async()=>{if(!(!e||!i)){j(!0);try{const X=await i(e),U=[],y=new Set;(Array.isArray(X)?X:r.filter(m=>{var q;return(typeof m.user=="string"?m.user:(q=m.user)==null?void 0:q._id)===e})).forEach(m=>{m._id&&!y.has(m._id)&&(y.add(m._id),U.push(m))}),U.length||F("No stories available for this user"),L(U)}catch(X){wn.error("Error loading user stories:",X),F("Failed to load stories")}finally{j(!1)}}})()},[e,i,r]),d.useEffect(()=>{if(se.length>0&&_>=0&&_<se.length){const ee=se[_];if(ee&&ee.reactions&&Array.isArray(ee.reactions)&&p){const X=ee.reactions.some(U=>U.user===p._id||U.user&&U.user._id===p._id);v(X)}else v(!1)}},[_,se,p]),d.useEffect(()=>{if(t&&(e?O:r).length){const X=(e?O:r).findIndex(U=>U._id===t);X!==-1&&N(X)}},[t,e,O,r]),d.useEffect(()=>{if(!o||!se.length)return;const ee=se[_];ee&&p&&ee._id&&o(ee._id).catch(X=>{wn.error("Error marking story as viewed:",X)})},[_,se,p,o]),d.useEffect(()=>{if(we.current)if(A)we.current.pause();else{const ee=we.current.play();ee!==void 0&&ee.catch(X=>{wn.error("Error playing video:",X),X.name==="NotAllowedError"&&!E&&(M(!0),we.current.muted=!0,we.current.play().catch(U=>wn.error("Still couldn't play even with mute:",U)))})}},[A,_,E]),d.useEffect(()=>{if(A||R||k||!se.length){K.current&&(clearInterval(K.current),K.current=null);return}C(0),K.current&&(clearInterval(K.current),K.current=null);const ee=se[_];if(!(ee&&(ee.mediaType==="video"||ee.type==="video")&&we.current))return K.current=setInterval(()=>{C(X=>X>=100?(clearInterval(K.current),K.current=null,_<se.length-1?N(U=>U+1):s==null||s(),0):X+ue)},100),()=>{K.current&&(clearInterval(K.current),K.current=null)}},[_,se,A,s,R,k,ue]);const he=d.useCallback(()=>{if(we.current){const ee=we.current.duration,X=we.current.currentTime;if(ee>0){const U=X/ee*100;C(U),U>=99.5&&(_<se.length-1?N(y=>y+1):s==null||s())}}},[_,se.length,s]),Ue=d.useCallback(ee=>{if(ee&&(ee.stopPropagation(),ee.preventDefault()),$){x(!1);return}b||_>0&&(B(!0),N(X=>X-1),C(0),setTimeout(()=>B(!1),300))},[_,b,$]),Me=d.useCallback(ee=>{if(ee&&(ee.stopPropagation(),ee.preventDefault()),$){x(!1);return}b||(B(!0),_<se.length-1?(N(X=>X+1),C(0)):s==null||s(),setTimeout(()=>B(!1),300))},[_,se,s,b,$]),ht=d.useCallback(ee=>{ee&&(ee.stopPropagation(),ee.preventDefault()),x(!0),M(X=>{const U=!X;return we.current&&(we.current.muted=U),U}),setTimeout(()=>x(!1),300)},[]),gt=d.useCallback(ee=>{if(ee&&(ee.stopPropagation(),ee.preventDefault()),x(!0),I){setTimeout(()=>x(!1),300);return}if(!a||!p){H.error("You must be logged in to react to stories"),setTimeout(()=>x(!1),300);return}if(!se||_>=se.length){setTimeout(()=>x(!1),300);return}const X=se[_];if(!X||!X._id){setTimeout(()=>x(!1),300);return}const U=X._id;U&&l?(v(!0),l(U,"like").then(y=>{if(!y||!y.success)throw new Error((y==null?void 0:y.message)||"Failed to react to story");if(y.data&&Array.isArray(y.data)){const u=[...se];u[_]&&(u[_].reactions=y.data,e&&L(u))}}).catch(y=>{wn.error("Error reacting to story:",y),v(!1),H.error("Failed to react to story")}).finally(()=>{setTimeout(()=>x(!1),300)})):setTimeout(()=>x(!1),300)},[p,a,se,_,l,I,e]),He=d.useCallback(ee=>{ee&&Pe.current&&Pe.current.contains(ee.target)||(ee&&(ee.stopPropagation(),ee.preventDefault()),P(X=>!X))},[]),wt=d.useCallback(ee=>{de.current={x:ee.touches[0].clientX,y:ee.touches[0].clientY,time:Date.now()},ce.current=setTimeout(()=>{G(!0),P(!0)},500)},[]),ft=d.useCallback(ee=>{const X=ee.touches[0].clientX,U=ee.touches[0].clientY,y=de.current.x,u=de.current.y,m=Math.abs(X-y),S=Math.abs(U-u);(m>10||S>10)&&ce.current&&(clearTimeout(ce.current),ce.current=null)},[]),et=d.useCallback(ee=>{if(ce.current&&(clearTimeout(ce.current),ce.current=null),z){G(!1),P(!1);return}const X=ee.changedTouches[0].clientX,U=ee.changedTouches[0].clientY,y=de.current.x,u=de.current.y,m=y-X,S=u-U,q=Date.now()-de.current.time,J=Date.now(),Z=J-me.current;Z<300&&Z>0&&Math.abs(m)<10&&Math.abs(S)<10?(I||(oe({x:X,y:U}),ye(!0),setTimeout(()=>{ye(!1)},1e3),gt(ee)),me.current=0):(q<300&&(Math.abs(m)>Math.abs(S)&&Math.abs(m)>30?m>0?Me(ee):Ue(ee):Math.abs(S)>Math.abs(m)&&Math.abs(S)>50?S>0||s==null||s():He(ee)),me.current=J)},[Me,Ue,gt,s,He,z,I]);d.useEffect(()=>{const ee=X=>{b||(X.key==="ArrowLeft"?Ue():X.key==="ArrowRight"||X.key===" "||X.key==="Spacebar"?Me():X.key==="Escape"&&(s==null||s()))};return document.addEventListener("keydown",ee),()=>document.removeEventListener("keydown",ee)},[Ue,Me,s,b]),d.useEffect(()=>()=>{ce.current&&clearTimeout(ce.current),K.current&&clearInterval(K.current)},[]);const Fe=d.useCallback(()=>s==null?void 0:s(),[s]),it=d.useMemo(()=>se&&se.length>0&&_<se.length?se[_]:null,[se,_]),T=d.useCallback(()=>{if(!se||!se.length||_>=se.length)return"Unknown User";const ee=se[_];if(!ee)return"Unknown User";const X=ee.user||ee.userData||{};return!X||typeof X=="string"?"Unknown User":X.nickname||X.username||X.name||"User"},[se,_]);d.useCallback(()=>{if(!se||!se.length||_>=se.length)return"/api/avatars/default";const ee=se[_];if(!ee)return"/api/avatars/default";const X=ee.user||ee.userData||{};return!X||typeof X=="string"?"/api/avatars/default":X.profilePicture||X.avatar||`/api/avatars/${X._id||"default"}`},[se,_]);const D=d.useCallback(()=>{if(!se||!se.length||_>=se.length)return"Recently";const ee=se[_];if(!ee||!ee.createdAt)return"Recently";try{return new Date(ee.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return"Recently"}},[se,_]),re=d.useCallback(()=>{var X,U;if(!se||!se.length||_>=se.length)return n.jsx("div",{className:ge.storiesTextContent,children:n.jsx("p",{children:"No story available"})});const ee=se[_];if(!ee)return n.jsx("div",{className:ge.storiesTextContent,children:n.jsx("p",{children:"Story not found"})});if(ee.mediaType==="text"||ee.type==="text"){const y={};return ee.backgroundStyle?y.background=ee.backgroundStyle:ee.backgroundColor&&(y.background=ee.backgroundColor),ee.fontStyle&&(y.fontFamily=ee.fontStyle),n.jsxs("div",{className:ge.storiesTextContent,style:y,children:[n.jsx("div",{className:ge.storyUserOverlay,children:n.jsx("span",{className:ge.storyNickname,children:T()})}),ee.text||ee.content||"",A&&n.jsx("div",{className:ge.pauseIndicator,children:n.jsx(yr,{size:24})})]})}if(((X=ee.mediaType)!=null&&X.startsWith("image")||ee.type==="image")&&(ee.mediaUrl||ee.media)){const y=ee.mediaUrl||ee.media;return n.jsxs("div",{className:ge.storiesImageContainer,children:[n.jsx("div",{className:ge.storyUserOverlay,children:n.jsx("span",{className:ge.storyNickname,children:T()})}),n.jsx("img",{src:y||"/placeholder.svg",alt:"Story",className:ge.storiesMedia,crossOrigin:"anonymous",loading:"lazy",decoding:"async",onError:u=>{u.target.onerror=null,u.target.src="/placeholder.svg"}}),A&&n.jsx("div",{className:ge.pauseIndicator,children:n.jsx(yr,{size:24})}),ee.content&&ee.content.trim()&&n.jsx("div",{className:ge.storyCaption,children:ee.content})]})}if(((U=ee.mediaType)!=null&&U.startsWith("video")||ee.type==="video")&&(ee.mediaUrl||ee.media)){const y=ee.mediaUrl||ee.media;return n.jsxs("div",{className:ge.storiesVideoContainer,children:[n.jsx("div",{className:ge.storyUserOverlay,children:n.jsx("span",{className:ge.storyNickname,children:T()})}),n.jsx("video",{ref:we,src:y,className:ge.storiesMedia,autoPlay:!0,muted:E,loop:!1,playsInline:!0,crossOrigin:"anonymous",onTimeUpdate:he,onError:u=>{wn.error("Video failed to load:",u)}}),A&&n.jsx("div",{className:ge.pauseIndicator,children:n.jsx(yr,{size:24})}),n.jsx("button",{className:ge.videoControl,onClick:ht,"aria-label":E?"Unmute video":"Mute video",children:E?n.jsx(lg,{size:16}):n.jsx(dg,{size:16})}),ee.content&&ee.content.trim()&&n.jsx("div",{className:ge.storyCaption,children:ee.content})]})}return n.jsxs("div",{className:ge.storiesTextContent,children:[n.jsx("div",{className:ge.storyUserOverlay,children:n.jsx("span",{className:ge.storyNickname,children:T()})}),n.jsx("p",{children:ee.text||ee.content||"No content available"}),A&&n.jsx("div",{className:ge.pauseIndicator,children:n.jsx(yr,{size:24})})]})},[se,_,A,E,T,he,ht]),fe=d.useMemo(()=>R?"loading":k?"error":!se.length||_>=se.length?"empty":it?"normal":"notAvailable",[R,k,se,_,it]),Re=d.useMemo(()=>le?n.jsx("div",{className:ge.doubleTapHeart,style:{position:"absolute",left:`${Y.x-40}px`,top:`${Y.y-40}px`,width:"80px",height:"80px",color:"#FD1D1D",fontSize:"80px",zIndex:9999,pointerEvents:"none"},children:n.jsx(nn,{})}):null,[le,Y]);return fe==="loading"?n.jsx("div",{className:ge.storiesViewerOverlay,children:n.jsxs("div",{className:ge.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[n.jsx("div",{className:ge.spinner}),n.jsx("p",{style:{color:"white",marginTop:"15px"},children:"Loading stories..."})]})}):fe==="error"?n.jsx("div",{className:ge.storiesViewerOverlay,children:n.jsxs("div",{className:ge.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[n.jsx("p",{style:{color:"white"},children:k}),n.jsx("button",{onClick:Fe,style:{marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Close"})]})}):fe==="empty"?n.jsx("div",{className:ge.storiesViewerOverlay,children:n.jsxs("div",{className:ge.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[n.jsx("p",{style:{color:"white"},children:"No stories available"}),n.jsx("button",{onClick:Fe,style:{marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Close"})]})}):fe==="notAvailable"?n.jsx("div",{className:ge.storiesViewerOverlay,children:n.jsxs("div",{className:ge.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[n.jsx("p",{style:{color:"white"},children:"Story not available"}),n.jsx("button",{onClick:Fe,style:{marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Close"})]})}):n.jsx("div",{className:ge.storiesViewerOverlay,children:n.jsxs("div",{className:ge.storiesViewerContainer,children:[n.jsxs("div",{className:ge.storiesViewerHeader,children:[n.jsx("div",{className:ge.storiesProgressContainer,children:se.map((ee,X)=>n.jsxs("div",{className:`${ge.storiesProgressBar} ${X<_?"completed":""}`,"aria-label":`Story ${X+1} of ${se.length}`,role:"progressbar","aria-valuenow":X===_?g:X<_?100:0,"aria-valuemin":"0","aria-valuemax":"100",children:[X===_&&n.jsx("div",{className:ge.storiesProgressFill,style:{width:`${g}%`}}),X<_&&n.jsx("div",{className:ge.storiesProgressFill,style:{width:"100%"}})]},X))}),n.jsxs("div",{className:ge.storiesUserInfo,children:[n.jsx(Rn,{user:typeof(it==null?void 0:it.user)=="object"?it.user:(it==null?void 0:it.userData)||{_id:it==null?void 0:it.user,nickname:T()},alt:T(),className:ge.storiesUserAvatar,size:"small"}),n.jsxs("div",{className:ge.storiesUserDetails,children:[n.jsx("span",{className:ge.storiesUsername,children:T()}),n.jsx("span",{className:ge.storiesTimestamp,children:D()})]})]}),n.jsx("button",{className:ge.storiesCloseBtn,onClick:Fe,"aria-label":"Close stories",children:n.jsx(rs,{})})]}),n.jsxs("div",{className:ge.storiesViewerContent,onClick:He,onTouchStart:wt,onTouchMove:ft,onTouchEnd:et,children:[re(),Re]}),n.jsxs("div",{className:ge.storiesViewerNavigation,"aria-label":"Story navigation",children:[n.jsx("div",{className:ge.storiesNavLeft,onClick:Ue,"aria-label":"Previous story",role:"button",tabIndex:"0"}),n.jsx("div",{className:ge.storiesNavRight,onClick:Me,"aria-label":"Next story",role:"button",tabIndex:"0"})]}),n.jsxs("div",{ref:Pe,className:ge.storiesActions,onClick:ee=>{ee.stopPropagation(),ee.preventDefault(),x(!0)},children:[n.jsx("button",{className:`${ge.storyActionButton} ${I?ge.active:""}`,onClick:gt,"aria-label":"Like story","aria-pressed":I,children:I?n.jsx(nn,{size:20}):n.jsx(Sd,{size:20})}),n.jsx("button",{className:ge.storyActionButton,onClick:ee=>{ee.stopPropagation(),ee.preventDefault(),x(!0),H.info("Comments feature coming soon!"),setTimeout(()=>x(!1),300)},"aria-label":"Comment on story",children:n.jsx(er,{size:20})}),n.jsx("button",{className:ge.storyActionButton,onClick:ee=>{ee.stopPropagation(),ee.preventDefault(),x(!0),H.info("Share feature coming soon!"),setTimeout(()=>x(!1),300)},"aria-label":"Share story",children:n.jsx(Jm,{size:20})}),n.jsx("button",{className:ge.storyActionButton,onClick:ee=>{ee.stopPropagation(),ee.preventDefault(),x(!0),He(ee),setTimeout(()=>x(!1),300)},"aria-label":A?"Play story":"Pause story",children:A?n.jsx(yr,{size:20}):n.jsx(Gm,{size:20})})]})]})})},Xd=({story:t,onClick:e,hasUnviewedStories:s,user:r,mediaType:o})=>{const{user:i}=_n(),c=d.useRef(0),l=d.useMemo(()=>r||(t?typeof t.user=="object"?t.user:t.userData&&typeof t.userData=="object"?t.userData:typeof t.user=="string"?{_id:t.user}:{}:{}),[t,r]);l._id;const f=l.nickname||l.username||l.name||"User",h=d.useMemo(()=>typeof s<"u"?!s:!i||!i._id||!(t!=null&&t.viewers)||!Array.isArray(t.viewers)?!1:t.viewers.includes(i._id),[s,i,t]),a=d.useMemo(()=>o==="video"||o==="image",[o]),p=g=>{if(a){g.preventDefault(),g.stopPropagation();return}g.preventDefault(),g.stopPropagation(),typeof e=="function"&&e()},_=g=>{c.current=Date.now()},N=g=>{Date.now()-c.current<300&&p(g)};return!t&&!r?null:n.jsxs("div",{className:ge.storyThumbnail,onClick:p,onTouchStart:_,onTouchEnd:N,"aria-label":`${f}'s story ${h?"viewed":"not viewed"}`,role:"button",children:[n.jsx("div",{className:`${ge.avatarBorder} ${h?ge.avatarBorderViewed:""}`,children:n.jsxs("div",{className:ge.imageContainer,children:[n.jsx(Rn,{user:l,alt:`${f}'s avatar`,className:ge.thumbnailImage,size:"medium",showFallback:!0}),o==="video"&&n.jsx("div",{className:ge.mediaTypeIcon,children:n.jsx(En,{})}),o==="image"&&n.jsx("div",{className:ge.mediaTypeIcon,children:n.jsx(Oo,{})})]})}),a&&n.jsxs("div",{className:ge.comingSoonBadge,children:[n.jsx(eg,{size:8,style:{marginRight:"2px"}})," Coming Soon"]}),n.jsx("div",{className:ge.username,children:f})]})},_b="_modalContainer_z42cc_6",vb="_modalHeader_z42cc_19",wb="_profileContent_z42cc_43",bb="_loadingContainer_z42cc_53",xb="_errorContainer_z42cc_54",Sb="_notFoundContainer_z42cc_55",Cb="_errorTitle_z42cc_66",kb="_notFoundTitle_z42cc_67",Nb="_errorText_z42cc_77",jb="_notFoundText_z42cc_78",Tb="_requestNotification_z42cc_92",Eb="_fadeIn_z42cc_1",Ab="_notificationContent_z42cc_103",Ib="_notificationIcon_z42cc_109",$b="_notificationText_z42cc_115",Pb="_notificationActions_z42cc_126",Rb="_approveBtn_z42cc_132",Lb="_rejectBtn_z42cc_133",Ob="_spinner_z42cc_178",Mb="_spin_z42cc_178",Bb="_profileLayout_z42cc_185",Fb="_photosSection_z42cc_195",Db="_storiesThumbnail_z42cc_202",Ub="_galleryContainer_z42cc_210",qb="_gallery_z42cc_210",zb="_imageContainer_z42cc_229",Hb="_galleryImage_z42cc_234",Vb="_privatePhoto_z42cc_246",Wb="_lockIcon_z42cc_262",Gb="_permissionStatus_z42cc_279",Yb="_pending_z42cc_287",Kb="_rejected_z42cc_291",Jb="_approved_z42cc_295",Qb="_requestAccessBtn_z42cc_300",Xb="_onlineBadge_z42cc_329",Zb="_pulse_z42cc_347",e4="_nav_z42cc_356",t4="_navPrev_z42cc_386",s4="_navNext_z42cc_389",n4="_thumbnails_z42cc_393",r4="_thumbnail_z42cc_393",o4="_thumbnailActive_z42cc_423",i4="_thumbnailImg_z42cc_429",a4="_privateThumbnail_z42cc_436",c4="_actions_z42cc_471",l4="_actionBtn_z42cc_477",d4="_likeBtn_z42cc_521",u4="_likedBtn_z42cc_532",h4="_messageBtn_z42cc_541",f4="_moreActions_z42cc_552",p4="_toggleBtn_z42cc_557",m4="_dropdown_z42cc_582",g4="_slideUp_z42cc_1",y4="_dropdownItem_z42cc_597",_4="_detailsSection_z42cc_627",v4="_headline_z42cc_636",w4="_headlineTitle_z42cc_643",b4="_premiumBadge_z42cc_652",x4="_location_z42cc_669",S4="_icon_z42cc_678",C4="_onlineStatus_z42cc_685",k4="_isOnline_z42cc_696",N4="_activity_z42cc_711",j4="_activityItem_z42cc_720",T4="_compatibilitySection_z42cc_733",E4="_sectionTitle_z42cc_744",A4="_compatibilityScore_z42cc_755",I4="_scoreCircle_z42cc_761",$4="_scoreBg_z42cc_772",P4="_scoreFill_z42cc_777",R4="_scoreValue_z42cc_784",L4="_compatibilityDetails_z42cc_794",O4="_compatibilityFactor_z42cc_801",M4="_factorLabel_z42cc_807",B4="_factorBar_z42cc_814",F4="_factorFill_z42cc_822",D4="_section_z42cc_744",U4="_aboutText_z42cc_855",q4="_tagsContainer_z42cc_863",z4="_tag_z42cc_863",H4="_identityTag_z42cc_891",V4="_statusTag_z42cc_892",W4="_lookingForTag_z42cc_893",G4="_intoTag_z42cc_894",Y4="_turnOnTag_z42cc_895",K4="_interestsTags_z42cc_897",J4="_interestTag_z42cc_903",Q4="_commonTag_z42cc_925",X4="_commonIcon_z42cc_932",Z4="_showMoreBtn_z42cc_937",ex="_chatOverlay_z42cc_960",tx="_dark_z42cc_976",sx="_darkToggleBtn_z42cc_1033",nx="_darkDropdown_z42cc_1046",rx="_darkDropdownItem_z42cc_1052",ox="_darkDropdownIcon_z42cc_1056",ix="_darkOnlineStatus_z42cc_1074",ax="_darkCompatibilitySection_z42cc_1088",cx="_darkScoreBg_z42cc_1095",lx="_darkScoreValue_z42cc_1098",dx="_darkFactorLabel_z42cc_1101",ux="_darkFactorBar_z42cc_1105",hx="_darkFactorFill_z42cc_1109",fx="_darkTag_z42cc_1119",px="_darkIdentityTag_z42cc_1129",mx="_darkStatusTag_z42cc_1134",gx="_darkLookingForTag_z42cc_1139",yx="_darkIntoTag_z42cc_1144",_x="_darkTurnOnTag_z42cc_1149",vx="_darkInterestTag_z42cc_1154",wx="_darkCommonTag_z42cc_1159",bx="_darkCommonIcon_z42cc_1165",xx="_darkShowMoreBtn_z42cc_1168",te={modalContainer:_b,modalHeader:vb,profileContent:wb,loadingContainer:bb,errorContainer:xb,notFoundContainer:Sb,errorTitle:Cb,notFoundTitle:kb,errorText:Nb,notFoundText:jb,requestNotification:Tb,fadeIn:Eb,notificationContent:Ab,notificationIcon:Ib,notificationText:$b,notificationActions:Pb,approveBtn:Rb,rejectBtn:Lb,spinner:Ob,spin:Mb,profileLayout:Bb,photosSection:Fb,storiesThumbnail:Db,galleryContainer:Ub,gallery:qb,imageContainer:zb,galleryImage:Hb,privatePhoto:Vb,lockIcon:Wb,permissionStatus:Gb,pending:Yb,rejected:Kb,approved:Jb,requestAccessBtn:Qb,onlineBadge:Xb,pulse:Zb,nav:e4,navPrev:t4,navNext:s4,thumbnails:n4,thumbnail:r4,thumbnailActive:o4,thumbnailImg:i4,privateThumbnail:a4,actions:c4,actionBtn:l4,likeBtn:d4,likedBtn:u4,messageBtn:h4,moreActions:f4,toggleBtn:p4,dropdown:m4,slideUp:g4,dropdownItem:y4,detailsSection:_4,headline:v4,headlineTitle:w4,premiumBadge:b4,location:x4,icon:S4,onlineStatus:C4,isOnline:k4,activity:N4,activityItem:j4,compatibilitySection:T4,sectionTitle:E4,compatibilityScore:A4,scoreCircle:I4,scoreBg:$4,scoreFill:P4,scoreValue:R4,compatibilityDetails:L4,compatibilityFactor:O4,factorLabel:M4,factorBar:B4,factorFill:F4,section:D4,aboutText:U4,tagsContainer:q4,tag:z4,identityTag:H4,statusTag:V4,lookingForTag:W4,intoTag:G4,turnOnTag:Y4,interestsTags:K4,interestTag:J4,commonTag:Q4,commonIcon:X4,showMoreBtn:Z4,chatOverlay:ex,dark:tx,darkToggleBtn:sx,darkDropdown:nx,darkDropdownItem:rx,darkDropdownIcon:ox,darkOnlineStatus:ix,darkCompatibilitySection:ax,darkScoreBg:cx,darkScoreValue:lx,darkFactorLabel:dx,darkFactorBar:ux,darkFactorFill:hx,darkTag:fx,darkIdentityTag:px,darkStatusTag:mx,darkLookingForTag:gx,darkIntoTag:yx,darkTurnOnTag:_x,darkInterestTag:vx,darkCommonTag:wx,darkCommonIcon:bx,darkShowMoreBtn:xx},Wo=({userId:t,isOpen:e,onClose:s})=>{var On,Es,Fr,Dr,Ur,rr,qr,zr,Hr,or,ir,ar,cr,lr,dr,ur;const{user:r}=Gt(),o=on(),{isTouch:i,isIOS:c,isAndroid:l}=tr(),{getUser:f,currentUser:h,likeUser:a,unlikeUser:p,isUserLiked:_,error:N,blockUser:g,reportUser:C,sendMessage:A}=_n(),{loadUserStories:P,hasUnviewedStories:R}=Br(),{theme:j}=Sa(),{t:k,language:F}=Ht(),O=d.useMemo(()=>({compatibilityTitle:k("compatibility"),location:k("location"),age:k("age"),interests:k("interests"),aboutMe:k("aboutMe"),iAm:k("identity"),maritalStatus:k("maritalStatus"),lookingFor:k("lookingFor"),imInto:k("intoTags"),itTurnsMeOn:k("turnOns"),onlineNow:k("online"),offline:k("offline"),lastActive:k("lastActive"),memberSince:k("memberSince")}),[k]),[L,E]=d.useState([]),[M,I]=d.useState(!1),[v,b]=d.useState(0),[B,$]=d.useState(!1),[x,z]=d.useState(!1),[G,Y]=d.useState(!1),[oe,le]=d.useState({}),[ye,K]=d.useState(!1),[ae,ue]=d.useState(!1),[we,Pe]=d.useState([]),[ce,de]=d.useState(!1),[me,se]=d.useState(!1),[he,Ue]=d.useState(null),[Me,ht]=d.useState(!1),[gt,He]=d.useState(Date.now()),wt=d.useMemo(()=>{if(t&&r&&t!==r._id)try{const ve=localStorage.getItem("photo-permissions-status");if(ve){const qe=JSON.parse(ve);if(qe&&qe[t])return{status:qe[t].status,isLoading:!1,source:"localStorage"}}}catch(ve){y.error("Failed to load initial permission status from localStorage:",ve)}return{status:null,isLoading:!1,source:"default"}},[t,r]),[ft,et]=d.useState(wt),Fe=d.useRef(null),it=d.useRef(!1),T=d.useRef(!1),D=d.useRef(!1),re=Zt(),fe=Ld(),{isMounted:Re}=n1(),{normalizePhotoUrl:ee,handlePhotoLoadError:X,clearCache:U}=Pn(),y=De.create("UserProfileModal"),u=d.useMemo(()=>r&&h&&r._id===h._id,[r,h]),m=d.useMemo(()=>!h||!r?0:Ln(),[h,r]),S=d.useMemo(()=>{var ve;return!h||!r||!((ve=h.details)!=null&&ve.interests)?[]:h.details.interests.filter(qe=>{var St,Ze;return(Ze=(St=r.details)==null?void 0:St.interests)==null?void 0:Ze.includes(qe)})},[h,r]);d.useMemo(()=>we.some(ve=>ve.user&&h&&ve.user._id===h._id),[we,h]),d.useMemo(()=>we.find(ve=>ve.user&&h&&ve.user._id===h._id),[we,h]);const q=u||ft.status==="approved",J=d.useRef(null);d.useEffect(()=>!t||!e||J.current===t?void 0:((async()=>{var qe,St;ht(!0),J.current=t;try{await new Promise(W=>setTimeout(W,50));const Ze=await fe.get(`/users/${t}`,{},{useCache:!1,headers:{"x-no-cache":"true","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!Re())return;y.debug("User data received:",((qe=Ze==null?void 0:Ze.data)==null?void 0:qe.user)||(Ze==null?void 0:Ze.data)||Ze);const es=((St=Ze==null?void 0:Ze.data)==null?void 0:St.user)||(Ze==null?void 0:Ze.data)||Ze;Ue(es),f&&typeof f=="function"&&f(t)}catch(Ze){Re()&&(y.error("Error fetching user:",Ze),ht(!1))}finally{Re()&&ht(!1)}})(),()=>{e||(J.current=null)}),[t,e,Re,fe]),d.useCallback(()=>{y.debug("This function is no longer used - direct API call is made instead")},[]);const Z=d.useCallback(async()=>{y.debug("Photo permission system has been removed")},[]),Se=d.useRef(!1),tt=d.useRef(!1),Ye=d.useRef(!1),nt=d.useRef(!1),at=d.useRef(!1);d.useEffect(()=>{if(!t||!e){Ye.current&&(Ye.current=!1,Se.current=!1,tt.current=!1,T.current=!1,it.current=!1,D.current=!1,nt.current=!1,at.current=!1,I(!1),Y(!1),et({status:null,isLoading:!1}),le({}),K(!1),ue(!1),b(0),E([]),Pe([]),He(Date.now()),y.debug(`Modal cleanup ran for userId: ${t}`));return}Ye.current||(Ye.current=!0,y.debug(`Modal opened for userId: ${t}, dataLoadedRef: ${Se.current}`),y.debug(`Modal using initial permission status: ${ft.status} (from ${ft.source})`),ft.status==="pending"&&H.info("Request to view private photos is pending approval",{autoClose:3e3,position:"top-center"}),b(0),z(!1),$(!1),le({}),I(!1),Y(!1),He(Date.now()),ht(!1),K(!1),ue(!1),de(!1),se(!1)),!it.current&&!Se.current&&(it.current=!0,Promise.resolve(P==null?void 0:P(t)).then(ve=>{Re()&&ve&&Array.isArray(ve)&&E(ve)}).catch(ve=>{y.error("Error loading stories:",ve)}).finally(()=>{Re()&&(it.current=!1)})),!T.current&&!nt.current&&(nt.current=!0,T.current=!0,fe.get(`/users/${t}/photo-access-status`).then(ve=>{if(Re())if(y.debug("Received photo access status response:",ve),ve&&ve.success){const qe=ve.status||ve.data&&ve.data.status||null;qe?Re()&&et(St=>St.status==="pending"&&qe==="none"?(y.debug("Keeping 'pending' status from localStorage instead of overriding with 'none' from API"),St):St.status!==qe?(y.debug(`Updating status from ${St.status} to ${qe} based on API response`),{status:qe,isLoading:!1,source:"api"}):St):(et(St=>St.status==="pending"?St:{status:"none",isLoading:!1,source:"api-default"}),y.debug("No status value in response, defaulting to 'none'"))}else ve?(y.warn("Unsuccessful photo access status response:",ve),et(qe=>qe.status==="pending"?qe:{status:"none",isLoading:!1,source:"api-error"})):(y.warn("Empty photo access status response"),et(qe=>qe.status==="pending"?qe:{status:"none",isLoading:!1,source:"api-empty"}))}).catch(ve=>{Re()&&(y.error("Error loading photo access status:",ve),et(qe=>qe.status==="pending"?qe:{status:"none",isLoading:!1,source:"api-error"}))}).finally(()=>{Re()&&(T.current=!1)})),r&&r._id===t&&!D.current&&!Se.current&&Z(),Se.current||(Se.current=!0)},[t,P,r,e,Re,fe,Z]),d.useEffect(()=>{if(!e||!t||!Zs||!Zs.isConnected||!Zs.isConnected()||at.current)return;at.current=!0,y.debug(`Setting up photo permission notification listeners for user ${t}`);const ve=St=>{if(y.debug("Photo permission response received:",St),St&&St.status&&St.sender&&St.sender._id===t){if(y.debug(`Received permission response from ${t}: ${St.status}`),et({status:St.status,isLoading:!1,source:"notification"}),St.status==="approved"){H.success(`${(h==null?void 0:h.nickname)||"User"} approved your photo request!`,{position:"top-center",autoClose:5e3,icon:"🔓"});try{const es=localStorage.getItem("photo-permissions-status")||"{}",W=JSON.parse(es);W[t]={status:"approved",timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(W))}catch(es){y.error("Failed to update permission status in localStorage:",es)}const Ze=Date.now();U(),He(Ze),window.dispatchEvent(new CustomEvent("avatar:refresh",{detail:{timestamp:Ze}}))}else if(St.status==="rejected"){H.info(`${(h==null?void 0:h.nickname)||"User"} declined your photo request`,{position:"top-center",autoClose:5e3,icon:"🔒"});try{const Ze=localStorage.getItem("photo-permissions-status")||"{}",es=JSON.parse(Ze);es[t]={status:"rejected",timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(es))}catch(Ze){y.error("Failed to update permission status in localStorage:",Ze)}}}},qe=Zs.on("photoPermissionResponseReceived",ve);return()=>{typeof qe=="function"&&qe(),at.current=!1}},[t,e,h,U]);const Bs=async ve=>{if(!ve||!h||ft.isLoading){y.warn("Cannot request private photos: missing user ID or already loading");return}i&&Ot("send"),et(qe=>({...qe,isLoading:!0}));try{if(y.debug(`Requesting private photos access for user ${ve}`),Zs&&Zs.isConnected&&Zs.isConnected()){y.debug("Using socket to request photo permission");try{const Ze=`req-${Date.now()}`,es=Math.floor(Math.random()*1e9).toString(16);Zs.emit("requestPhotoPermission",{ownerId:ve,photoId:ve,permissionId:ve,requestId:Ze,timestamp:Date.now()}),y.debug(`Emitted photo permission request: ${Ze}`),window.dispatchEvent(new CustomEvent("mandarin:photoRequest",{detail:{userId:ve,requestId:Ze,timestamp:Date.now()}})),y.debug(`Photo permission request sent via socket with requestId: ${Ze}`)}catch(Ze){throw y.error("Socket-based permission request failed, using local fallback:",Ze),new Error("Socket request failed")}}else y.warn("Socket not available, using local simulation"),await new Promise(Ze=>setTimeout(Ze,1e3));try{const Ze=localStorage.getItem("photo-permissions-status")||"{}",es=JSON.parse(Ze);es[ve]={status:"pending",timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(es)),y.debug(`Saved photo permission request for user ${ve} to localStorage`)}catch(Ze){y.error("Failed to save photo permission status to localStorage:",Ze)}H.success(n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("div",{style:{backgroundColor:"#4a76a8",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"16px"},children:n.jsx(Hs,{})}),n.jsx("span",{style:{fontWeight:"bold"},children:"Access request sent!"})]}),n.jsxs("p",{style:{margin:"0",fontSize:"14px"},children:["Waiting for ",h.nickname||"user"," to approve your request"]})]}),{position:"top-center",autoClose:6e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,icon:"🔒"}),et({status:"pending",isLoading:!1,source:"user-request"});const St=Date.now();U(),He(St),window.__photo_refresh_timestamp=St,window.dispatchEvent(new CustomEvent("avatar:refresh",{detail:{timestamp:St}}))}catch(qe){if(!Re())return;y.error("Error requesting private photos access:",qe),et({status:null,isLoading:!1}),H.error("Failed to request access to private photos")}},gs=d.useCallback(ve=>{var St;y.debug(`Image with ID ${ve} failed to load`),le(Ze=>({...Ze,[ve]:!0}));const qe=(St=h==null?void 0:h.photos)==null?void 0:St.find(Ze=>Ze._id===ve);qe&&qe.url&&X(ve,qe.url),U()},[h,y,X,U]),an=d.useCallback(async()=>{const ve=h||he;if(!(!ve||ye)){i&&Ot(_&&_(ve._id)?"wink":"send"),K(!0);try{_&&_(ve._id)?await p(ve._id,ve.nickname):await a(ve._id,ve.nickname)}catch(qe){i&&Ot("error"),y.error("Error toggling like:",qe),H.error("Failed to update like status")}finally{Re()&&K(!1)}}},[h,he,ye,_,p,a,Re,y,i]),be=d.useCallback(async()=>{if(t){i&&Ot("selectConversation");try{await g(t),H.success("User blocked successfully"),s()}catch(ve){i&&Ot("error"),y.error("Error blocking user:",ve),H.error("Failed to block user")}}},[t,g,s,y,i]),ke=d.useCallback(async()=>{if(t){i&&Ot("selectConversation");try{await C(t),H.success("User reported successfully"),s()}catch(ve){i&&Ot("error"),y.error("Error reporting user:",ve),H.error("Failed to report user")}}},[t,C,s,y,i]);d.useCallback(async()=>{if(t){i&&Ot("send"),ue(!0);try{await A(t),re("/messages"),s()}catch(ve){i&&Ot("error"),y.error("Error sending message:",ve),H.error("Failed to start conversation")}finally{Re()&&ue(!1)}}},[t,A,re,s,Re,y,i]);const Ge=d.useCallback(()=>Y(!0),[]),Xe=d.useCallback(()=>Y(!1),[]),Rt=d.useCallback(()=>I(!1),[]),Je=d.useCallback(()=>{var qe;const ve=(qe=h||he)==null?void 0:qe.photos;ve&&v<ve.length-1&&b(v+1)},[h,he,v]),Jt=d.useCallback(()=>{v>0&&b(v-1)},[v]);function Ln(){if(!(h!=null&&h.details)||!(r!=null&&r.details))return 0;let ve=0;h.details.location===r.details.location&&(ve+=25);const qe=Math.abs((h.details.age||0)-(r.details.age||0));qe<=5?ve+=25:qe<=10?ve+=15:ve+=5;const St=h.details.interests||[],Ze=r.details.interests||[],es=St.filter(W=>Ze.includes(W)).length;return ve+=Math.min(50,es*10),Math.min(100,ve)}const dt=ve=>!ve||typeof ve!="string"?"":ve.charAt(0).toUpperCase()+ve.slice(1);if(!e)return null;if(Me)return n.jsx(Cr,{isOpen:e,onClose:s,size:"large",children:n.jsx("div",{className:te.loadingContainer,children:n.jsx(sr,{text:k("loadingProfile"),size:"large",centered:!0})})});if(N)return n.jsx(Cr,{isOpen:e,onClose:s,size:"small",children:n.jsxs("div",{className:te.errorContainer,children:[n.jsx("h3",{className:te.errorTitle,children:k("errorUnknown")}),n.jsx("p",{className:te.errorText,children:N}),n.jsx(en,{variant:"primary",onClick:s,children:k("close")})]})});const Ie=h||he;return Ie?n.jsx(Cr,{isOpen:e,onClose:s,size:o?"fullscreen":"xlarge",className:`${te.modalContainer} ${o?te.mobileModal:""}`,showCloseButton:!0,bottomSheetOnMobile:o,headerClassName:te.modalHeader,bodyClassName:"modern-user-profile",closeOnClickOutside:!0,children:n.jsxs("div",{className:te.profileContent,ref:Fe,children:[n.jsxs("div",{className:te.profileLayout,children:[n.jsxs("div",{className:te.photosSection,children:[L&&L.length>0&&n.jsx("div",{className:te.storiesThumbnail,children:n.jsx(Xd,{user:Ie,hasUnviewedStories:R&&R(Ie._id),onClick:Ge})}),Ie&&Ie.photos&&Ie.photos.length>0?n.jsxs("div",{className:te.galleryContainer,children:[n.jsxs("div",{className:te.gallery,children:[Ie.photos[v]&&(Ie.photos[v].privacy==="private"||Ie.photos[v].isPrivate&&!Ie.photos[v].privacy)&&!q?n.jsxs("div",{className:te.privatePhoto,children:[n.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:k("privatePhoto"),style:{width:"100%",height:"100%",objectFit:"cover",opacity:.7,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:0,borderRadius:"inherit"}}),n.jsxs("div",{style:{position:"absolute",zIndex:1,top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.5)",borderRadius:"inherit"},children:[n.jsx(ns,{className:te.lockIcon,style:{fontSize:"3rem",color:"white",margin:"0 0 1rem 0"}}),n.jsx("p",{style:{color:"white",fontWeight:"bold",marginBottom:"1rem"},children:k("privatePhoto")||"Private Photo"}),n.jsxs("button",{className:te.requestAccessBtn,onClick:()=>Bs(Ie._id),disabled:ft.isLoading||ft.status==="pending",children:[ft.isLoading?n.jsx(Ts,{className:te.spinner}):n.jsx(ba,{}),ft.status==="pending"?k("requestPending","Request Pending"):k("requestAccess")||"Request Access"]})]})]}):Ie.photos[v]&&n.jsx("div",{className:te.imageContainer,children:n.jsx("img",{src:`${ee(Ie.photos[v].url,!0)}&_key=${gt}`,alt:`${Ie.nickname}'s photo`,className:te.galleryImage,onError:()=>gs(Ie.photos[v]._id)})}),Ie.isOnline&&n.jsxs("div",{className:te.onlineBadge,children:[n.jsx("span",{className:te.pulse}),k("online")]}),Ie.photos.length>1&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:`${te.nav} ${te.navPrev}`,onClick:Jt,disabled:v===0,"aria-label":k("previous"),children:n.jsx(hd,{})}),n.jsx("button",{className:`${te.nav} ${te.navNext}`,onClick:Je,disabled:v===Ie.photos.length-1,"aria-label":k("next"),children:n.jsx(fd,{})})]})]}),Ie.photos.length>1&&n.jsx("div",{className:te.thumbnails,children:Ie.photos.map((ve,qe)=>n.jsx("div",{className:`${te.thumbnail} ${qe===v?te.thumbnailActive:""}`,onClick:()=>b(qe),children:(ve.privacy==="private"||ve.isPrivate&&!ve.privacy)&&!q?n.jsxs("div",{className:te.privateThumbnail,children:[n.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:k("privatePhoto","Private photo"),className:te.thumbnailImg,style:{width:"100%",height:"100%",objectFit:"cover"}}),n.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"inherit"},children:n.jsx(ns,{style:{color:"white",fontSize:"1.25rem"}})}),ft.status&&n.jsxs("div",{className:`${te.permissionStatus} ${te[ft.status]}`,style:{zIndex:2},children:[ft.status==="pending"&&(k("requestAccessPending")||"Pending"),ft.status==="approved"&&(k("approve")||"Approved"),ft.status==="rejected"&&(k("reject")||"Rejected")]})]}):n.jsx("img",{src:`${ee(ve.url,!0)}&_key=${gt}`,alt:`${Ie.nickname} ${qe+1}`,className:te.thumbnailImg,onError:()=>gs(ve._id)})},ve._id||qe))})]}):n.jsxs("div",{className:te.gallery,children:[n.jsx(Rn,{user:Ie,size:"xlarge",alt:Ie.nickname,status:Ie.isOnline?"online":null,showOnlineStatus:!0}),n.jsx("p",{children:k("noPhotosAvailable")})]}),n.jsxs("div",{className:te.actions,children:[!u&&n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:`${te.actionBtn} ${_&&_(Ie._id)?te.likedBtn:te.likeBtn}`,onClick:an,disabled:ye,children:[ye?n.jsx(Ts,{className:te.spinner}):n.jsx(nn,{}),_&&_(Ie._id)?k("liked"):k("like")]}),n.jsxs("button",{className:`${te.actionBtn} ${te.messageBtn}`,onClick:()=>I(!0),disabled:ae,children:[ae?n.jsx(Ts,{className:te.spinner}):n.jsx(er,{}),k("message")]})]}),n.jsxs("div",{className:te.moreActions,children:[n.jsx("button",{className:`${te.toggleBtn} ${j==="dark"?te.darkToggleBtn:""}`,onClick:()=>$(!B),"aria-label":k("moreActions"),children:n.jsx(gd,{})}),B&&n.jsxs("div",{className:`${te.dropdown} ${j==="dark"?te.darkDropdown:""}`,children:[n.jsxs("button",{className:`${te.dropdownItem} ${j==="dark"?te.darkDropdownItem:""}`,onClick:ke,children:[n.jsx(_d,{className:j==="dark"?te.darkDropdownIcon:""}),k("reportUser")]}),n.jsxs("button",{className:`${te.dropdownItem} ${j==="dark"?te.darkDropdownItem:""}`,onClick:be,children:[n.jsx(va,{className:j==="dark"?te.darkDropdownIcon:""}),k("blockUser")]})]})]})]})]}),n.jsxs("div",{className:te.detailsSection,children:[n.jsxs("div",{className:te.headline,children:[n.jsxs("h1",{className:te.headlineTitle,children:[Ie.nickname,", ",((On=Ie.details)==null?void 0:On.age)||"?"]}),Ie.role==="premium"&&n.jsxs("div",{className:te.premiumBadge,children:[n.jsx(ng,{})," ",k("premium","Premium")]})]}),n.jsxs("div",{className:te.location,children:[n.jsx(Ir,{className:te.icon}),n.jsx("span",{children:((Es=Ie.details)==null?void 0:Es.location)||k("unknownLocation")}),n.jsx("div",{className:`${te.onlineStatus} ${Ie.isOnline?te.isOnline:""} ${j==="dark"?te.darkOnlineStatus:""}`,children:Ie.isOnline?O.onlineNow:O.offline})]}),n.jsxs("div",{className:te.activity,children:[n.jsxs("div",{className:te.activityItem,children:[n.jsx(ug,{className:te.icon}),n.jsx("span",{children:Ie.isOnline?O.onlineNow:`${O.lastActive} ${_o(Ie.lastActive,{showTime:!1})}`})]}),n.jsxs("div",{className:te.activityItem,children:[n.jsx(ud,{className:te.icon}),n.jsxs("span",{children:[O.memberSince," ",_o(Ie.createdAt,{showTime:!1})]})]})]}),!u&&n.jsxs("div",{className:`${te.compatibilitySection} ${j==="dark"?te.darkCompatibilitySection:""}`,children:[n.jsx("h2",{className:te.sectionTitle,children:O.compatibilityTitle}),n.jsxs("div",{className:te.compatibilityScore,children:[n.jsxs("div",{className:te.scoreCircle,children:[n.jsxs("svg",{viewBox:"0 0 100 100",children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:`compatibility-gradient-${t||"default"}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",style:{stopColor:"var(--compat-gradient-start, var(--primary-400))"}}),n.jsx("stop",{offset:"100%",style:{stopColor:"var(--compat-gradient-end, var(--primary-500))"}})]})}),n.jsx("circle",{className:`${te.scoreBg} ${j==="dark"?te.darkScoreBg:""}`,cx:"50",cy:"50",r:"45"}),n.jsx("circle",{className:te.scoreFill,cx:"50",cy:"50",r:"45",strokeDasharray:"283",strokeDashoffset:283-283*m/100,style:{stroke:`url(#compatibility-gradient-${t||"default"})`}})]}),n.jsxs("div",{className:`${te.scoreValue} ${j==="dark"?te.darkScoreValue:""}`,children:[m,"%"]})]}),n.jsxs("div",{className:te.compatibilityDetails,children:[n.jsxs("div",{className:te.compatibilityFactor,children:[n.jsx("span",{className:`${te.factorLabel} ${j==="dark"?te.darkFactorLabel:""}`,children:k("location")}),n.jsx("div",{className:`${te.factorBar} ${j==="dark"?te.darkFactorBar:""}`,children:n.jsx("div",{className:`${te.factorFill} ${j==="dark"?te.darkFactorFill:""}`,style:{width:((Fr=h.details)==null?void 0:Fr.location)===((Dr=r==null?void 0:r.details)==null?void 0:Dr.location)?"100%":"30%"}})})]}),n.jsxs("div",{className:te.compatibilityFactor,children:[n.jsx("span",{className:`${te.factorLabel} ${j==="dark"?te.darkFactorLabel:""}`,children:k("age")}),n.jsx("div",{className:`${te.factorBar} ${j==="dark"?te.darkFactorBar:""}`,children:n.jsx("div",{className:`${te.factorFill} ${j==="dark"?te.darkFactorFill:""}`,style:{width:Math.abs((((Ur=h.details)==null?void 0:Ur.age)||0)-(((rr=r==null?void 0:r.details)==null?void 0:rr.age)||0))<=5?"90%":Math.abs((((qr=h.details)==null?void 0:qr.age)||0)-(((zr=r==null?void 0:r.details)==null?void 0:zr.age)||0))<=10?"60%":"30%"}})})]}),n.jsxs("div",{className:te.compatibilityFactor,children:[n.jsx("span",{className:`${te.factorLabel} ${j==="dark"?te.darkFactorLabel:""}`,children:k("interests")}),n.jsx("div",{className:`${te.factorBar} ${j==="dark"?te.darkFactorBar:""}`,children:n.jsx("div",{className:`${te.factorFill} ${j==="dark"?te.darkFactorFill:""}`,style:{width:`${Math.min(100,S.length*20)}%`}})})]})]})]})]}),((Hr=Ie.details)==null?void 0:Hr.bio)&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.aboutMe}),n.jsx("p",{className:te.aboutText,children:Ie.details.bio})]}),((or=Ie.details)==null?void 0:or.iAm)&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.iAm}),n.jsx("div",{className:te.tagsContainer,children:n.jsx("span",{className:`${te.tag} ${te.identityTag} ${j==="dark"?te.darkTag+" "+te.darkIdentityTag:""}`,children:k(Ie.details.iAm)||dt(Ie.details.iAm)})})]}),((ir=Ie.details)==null?void 0:ir.maritalStatus)&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.maritalStatus}),n.jsx("div",{className:te.tagsContainer,children:n.jsx("span",{className:`${te.tag} ${te.statusTag} ${j==="dark"?te.darkTag+" "+te.darkStatusTag:""}`,children:k(Ie.details.maritalStatus)||Ie.details.maritalStatus})})]}),((ar=Ie.details)==null?void 0:ar.lookingFor)&&Ie.details.lookingFor.length>0&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.lookingFor}),n.jsx("div",{className:te.tagsContainer,children:Ie.details.lookingFor.map((ve,qe)=>n.jsx("span",{className:`${te.tag} ${te.lookingForTag} ${j==="dark"?te.darkTag+" "+te.darkLookingForTag:""}`,children:k(ve)||ve},qe))})]}),((cr=Ie.details)==null?void 0:cr.intoTags)&&Ie.details.intoTags.length>0&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.imInto}),n.jsx("div",{className:te.tagsContainer,children:Ie.details.intoTags.map((ve,qe)=>n.jsx("span",{className:`${te.tag} ${te.intoTag} ${j==="dark"?te.darkTag+" "+te.darkIntoTag:""}`,children:k(ve)||ve},qe))})]}),((lr=Ie.details)==null?void 0:lr.turnOns)&&Ie.details.turnOns.length>0&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.itTurnsMeOn}),n.jsx("div",{className:te.tagsContainer,children:Ie.details.turnOns.map((ve,qe)=>n.jsx("span",{className:`${te.tag} ${te.turnOnTag} ${j==="dark"?te.darkTag+" "+te.darkTurnOnTag:""}`,children:k(ve)||ve},qe))})]}),((ur=(dr=Ie.details)==null?void 0:dr.interests)==null?void 0:ur.length)>0&&n.jsxs("div",{className:te.section,children:[n.jsx("h2",{className:te.sectionTitle,children:O.interests}),n.jsxs("div",{className:te.interestsTags,children:[(x?Ie.details.interests:Ie.details.interests.slice(0,8)).map(ve=>n.jsxs("span",{className:`
                        ${te.interestTag}
                        ${S.includes(ve)?te.commonTag:""}
                        ${j==="dark"?te.darkInterestTag:""}
                        ${j==="dark"&&S.includes(ve)?te.darkCommonTag:""}
                      `,children:[k(ve)||ve,S.includes(ve)&&n.jsx(mt,{className:`${te.commonIcon} ${j==="dark"?te.darkCommonIcon:""}`})]},ve)),!x&&Ie.details.interests.length>8&&n.jsxs("button",{className:`${te.showMoreBtn} ${j==="dark"?te.darkShowMoreBtn:""}`,onClick:()=>z(!0),children:["+",Ie.details.interests.length-8," ",k("showMore")]})]})]})]})]}),M&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:te.chatOverlay,onClick:Rt}),n.jsx(Go,{recipient:Ie,isOpen:M,onClose:Rt})]}),G&&n.jsx(Qd,{userId:Ie._id,onClose:Xe})]})}):n.jsx(Cr,{isOpen:e,onClose:s,size:"small",children:n.jsxs("div",{className:te.notFoundContainer,children:[n.jsx("h3",{className:te.notFoundTitle,children:k("notFound")}),n.jsx("p",{className:te.notFoundText,children:k("userNotFound")}),n.jsx(en,{variant:"primary",onClick:s,children:k("close")})]})})},Sx="_chatContainer_dulfn_8",Cx="_minimized_dulfn_26",kx="_collapsed_dulfn_30",Nx="_opening_dulfn_40",jx="_slideUp_dulfn_1",Tx="_chatHeader_dulfn_45",Ex="_backButton_dulfn_59",Ax="_conversationInfo_dulfn_74",Ix="_userInfo_dulfn_83",$x="_userName_dulfn_89",Px="_blockedTag_dulfn_101",Rx="_pulseBg_dulfn_1",Lx="_userStatus_dulfn_119",Ox="_blockedStatus_dulfn_127",Mx="_statusOnline_dulfn_132",Bx="_statusOffline_dulfn_132",Fx="_statusBlocked_dulfn_132",Dx="_connectionStatus_dulfn_142",Ux="_statusIcon_dulfn_154",qx="_chatActions_dulfn_159",zx="_chatHeaderBtn_dulfn_165",Hx="_videoCallButton_dulfn_165",Vx="_moreOptionsButton_dulfn_165",Wx="_headerDropdown_dulfn_184",Gx="_fadeIn_dulfn_1",Yx="_dropdownItem_dulfn_203",Kx="_blockedUserBanner_dulfn_223",Jx="_unblockButton_dulfn_246",Qx="_premiumBanner_dulfn_263",Xx="_premiumIcon_dulfn_275",Zx="_premiumText_dulfn_281",eS="_upgradeBtn_dulfn_287",tS="_activeCallBanner_dulfn_307",sS="_callIcon_dulfn_318",nS="_endCallBtn_dulfn_323",rS="_incomingCallBanner_dulfn_342",oS="_slidein_dulfn_1",iS="_incomingCallInfo_dulfn_358",aS="_pulse_dulfn_369",cS="_incomingCallActions_dulfn_373",lS="_acceptCallBtnSmall_dulfn_378",dS="_declineCallBtnSmall_dulfn_378",uS="_messagesContainer_dulfn_422",hS="_loadingMessages_dulfn_432",fS="_noMessages_dulfn_432",pS="_spinner_dulfn_444",mS="_spin_dulfn_444",gS="_messageDate_dulfn_454",yS="_messageWrapper_dulfn_481",_S="_sent_dulfn_491",vS="_message_dulfn_422",wS="_messageFadeIn_dulfn_1",bS="_messageBubble_dulfn_520",xS="_received_dulfn_540",SS="_messageContent_dulfn_554",CS="_messageMeta_dulfn_559",kS="_metaReceived_dulfn_571",NS="_metaSent_dulfn_575",jS="_messageTime_dulfn_580",TS="_readIndicator_dulfn_589",ES="_sentIndicator_dulfn_589",AS="_statusIndicator_dulfn_589",IS="_errorIndicator_dulfn_606",$S="_pending_dulfn_620",PS="_pendingIndicator_dulfn_620",RS="_error_dulfn_606",LS="_systemMessage_dulfn_636",OS="_systemMessageContent_dulfn_665",MS="_errorContent_dulfn_675",BS="_winkMessage_dulfn_681",FS="_messageLabel_dulfn_692",DS="_videoCallMessage_dulfn_704",US="_videoIcon_dulfn_710",qS="_fileMessage_dulfn_721",zS="_imageAttachment_dulfn_725",HS="_fileAttachment_dulfn_742",VS="_fileIcon_dulfn_758",WS="_fileName_dulfn_768",GS="_fileSize_dulfn_774",YS="_downloadLink_dulfn_783",KS="_typingIndicator_dulfn_810",JS="_typing_dulfn_810",QS="_messageError_dulfn_852",XS="_errorActions_dulfn_869",ZS="_retryButton_dulfn_875",eC="_initButton_dulfn_875",tC="_refreshButton_dulfn_899",sC="_attachmentPreview_dulfn_918",nC="_attachmentInfo_dulfn_927",rC="_attachmentName_dulfn_933",oC="_attachmentSize_dulfn_942",iC="_removeAttachment_dulfn_947",aC="_uploadProgressContainer_dulfn_961",cC="_uploadProgressBar_dulfn_971",lC="_uploadProgressText_dulfn_978",dC="_chatArea_dulfn_1028",uC="_blockedChatArea_dulfn_1035",hC="_inputWrapper_dulfn_1041",fC="_inputArea_dulfn_1048",pC="_messageInput_dulfn_1057",mC="_blockedInput_dulfn_1079",gC="_emojiButton_dulfn_1086",yC="_attachButton_dulfn_1087",_C="_winkButton_dulfn_1088",vC="_sendButton_dulfn_1089",wC="_disabled_dulfn_1117",bC="_sending_dulfn_1126",xC="_rotate_dulfn_1",SC="_emojiPicker_dulfn_1140",CC="_emojiHeader_dulfn_1152",kC="_emojiList_dulfn_1166",NC="_videoCallOverlay_dulfn_1257",jC="_incomingCallOverlay_dulfn_1257",TC="_active_dulfn_307",Dt={chatContainer:Sx,minimized:Cx,collapsed:kx,opening:Nx,slideUp:jx,chatHeader:Tx,backButton:Ex,conversationInfo:Ax,userInfo:Ix,userName:$x,blockedTag:Px,pulseBg:Rx,userStatus:Lx,blockedStatus:Ox,statusOnline:Mx,statusOffline:Bx,statusBlocked:Fx,connectionStatus:Dx,statusIcon:Ux,chatActions:qx,chatHeaderBtn:zx,videoCallButton:Hx,moreOptionsButton:Vx,headerDropdown:Wx,fadeIn:Gx,dropdownItem:Yx,blockedUserBanner:Kx,unblockButton:Jx,premiumBanner:Qx,premiumIcon:Xx,premiumText:Zx,upgradeBtn:eS,activeCallBanner:tS,callIcon:sS,endCallBtn:nS,incomingCallBanner:rS,slidein:oS,incomingCallInfo:iS,pulse:aS,incomingCallActions:cS,acceptCallBtnSmall:lS,declineCallBtnSmall:dS,messagesContainer:uS,loadingMessages:hS,noMessages:fS,spinner:pS,spin:mS,messageDate:gS,messageWrapper:yS,sent:_S,message:vS,messageFadeIn:wS,messageBubble:bS,received:xS,messageContent:SS,messageMeta:CS,metaReceived:kS,metaSent:NS,messageTime:jS,readIndicator:TS,sentIndicator:ES,statusIndicator:AS,errorIndicator:IS,pending:$S,pendingIndicator:PS,error:RS,systemMessage:LS,systemMessageContent:OS,errorContent:MS,winkMessage:BS,messageLabel:FS,videoCallMessage:DS,videoIcon:US,fileMessage:qS,imageAttachment:zS,fileAttachment:HS,fileIcon:VS,fileName:WS,fileSize:GS,downloadLink:YS,typingIndicator:KS,typing:JS,messageError:QS,errorActions:XS,retryButton:ZS,initButton:eC,refreshButton:tC,attachmentPreview:sC,attachmentInfo:nC,attachmentName:rC,attachmentSize:oC,removeAttachment:iC,uploadProgressContainer:aC,uploadProgressBar:cC,uploadProgressText:lC,chatArea:dC,blockedChatArea:uC,inputWrapper:hC,inputArea:fC,messageInput:pC,blockedInput:mC,emojiButton:gC,attachButton:yC,winkButton:_C,sendButton:vC,disabled:wC,sending:bC,rotate:xC,emojiPicker:SC,emojiHeader:CC,emojiList:kC,videoCallOverlay:NC,incomingCallOverlay:jC,active:TC},ut=De.create("EmbeddedChat"),Go=({recipient:t,isOpen:e=!0,onClose:s=()=>{}})=>{const{user:r}=Gt(),o=Zt(),i=t==null?void 0:t._id,{messages:c,loading:l,error:f,sendMessage:h,sendFileMessage:a,typingStatus:p,sendTyping:_,loadMoreMessages:N,hasMore:g,sending:C,initialized:A,isConnected:P,refresh:R}=e1(i),[j,k]=d.useState(""),[F,O]=d.useState(null),[L,E]=d.useState(!1),[M,I]=d.useState(0),[v,b]=d.useState(0),[B,$]=d.useState(!1),[x,z]=d.useState(null),[G,Y]=d.useState(!1),[oe,le]=d.useState(!1),[ye,K]=d.useState(!1),[ae,ue]=d.useState(null),[we,Pe]=d.useState(new Set),[ce,de]=d.useState([]),me=d.useRef(null),se=d.useRef(null),he=d.useRef(null),Ue=d.useRef(null),Me=d.useRef(null),ht=d.useRef(null),gt=d.useRef(!1),He=d.useMemo(()=>c?[...c,...ce].sort((ke,Ge)=>new Date(ke.createdAt)-new Date(Ge.createdAt)):[],[c,ce]),wt=d.useMemo(()=>ua(He),[He]),ft=r==null?void 0:r._id,et=d.useCallback(be=>{if(!be)return!1;const ke=we.has(be),Ge=(t==null?void 0:t.isBlocked)||!1;return ke||Ge},[we,t==null?void 0:t.isBlocked]),Fe=d.useCallback((be,ke=!1)=>{const Ge={_id:Zi("system"),sender:"system",content:be,createdAt:new Date().toISOString(),type:"system",error:ke};de(Xe=>Xe.some(Rt=>Rt._id===Ge._id)?Xe:[...Xe,Ge].sort((Rt,Je)=>new Date(Rt.createdAt)-new Date(Je.createdAt)))},[]);d.useEffect(()=>(ut.debug("EmbeddedChat mounted for recipient:",t==null?void 0:t.nickname),()=>{ut.debug("EmbeddedChat unmounted"),Ue.current&&clearTimeout(Ue.current),Me.current&&clearTimeout(Me.current)}),[i,t==null?void 0:t.nickname]),d.useEffect(()=>{(async()=>{try{const ke=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");ke.length>0&&(ut.debug(`Loading ${ke.length} blocked users from localStorage`),Pe(new Set(ke)),t!=null&&t._id&&ke.includes(t._id)&&!t.isBlocked&&(ut.debug("Marking current recipient as blocked from localStorage data"),t.isBlocked=!0))}catch(ke){ut.error("Error loading blocked users from localStorage:",ke)}if(r!=null&&r._id)try{if(ut.debug("Fetching blocked users from server"),t!=null&&t._id)try{ut.debug(`Checking if user ${t._id} is blocked (as workaround for 400 error)`),r.blockedUsers&&Array.isArray(r.blockedUsers)&&r.blockedUsers.includes(t._id)&&(ut.debug(`User ${t._id} is marked as blocked in user object`),t.isBlocked=!0)}catch(Ge){ut.debug(`Could not check specific user blocked status: ${Ge.message}`)}const ke=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");ke.length>0&&(ut.debug(`Using ${ke.length} blocked users from localStorage due to API error`),Pe(new Set(ke)))}catch(ke){ut.error("Error with blocked users handling:",ke)}})()},[t==null?void 0:t._id,r==null?void 0:r._id]),d.useEffect(()=>{const be=me.current,ke=ht.current;if(!be||!ke||!e){gt.current=!e;return}if(A&&He.length>0&&!gt.current)be.scrollIntoView({behavior:"instant",block:"end"}),gt.current=!0;else if(gt.current&&He.length>0){if(ke.scrollHeight-ke.scrollTop-ke.clientHeight<150){const Rt=setTimeout(()=>{be.scrollIntoView({behavior:"smooth",block:"end"})},y_);return()=>clearTimeout(Rt)}}else A||(gt.current=!1)},[He,A,e]),d.useEffect(()=>(l?(le(!1),Me.current=setTimeout(()=>le(!0),f_)):(Me.current&&clearTimeout(Me.current),le(!1)),()=>{Me.current&&clearTimeout(Me.current)}),[l]);const it=d.useCallback(async()=>{var be,ke;if(!(!i||!(r!=null&&r._id)))try{const Ge=await Ae.get("/users/photos/permissions",{params:{requestedBy:i,status:"pending"}}),Xe=((be=Ge==null?void 0:Ge.data)==null?void 0:be.data)||[];b(Xe.length)}catch(Ge){ut.error("Error checking photo permissions:",((ke=Ge.response)==null?void 0:ke.data)||Ge.message),b(0)}},[i,r==null?void 0:r._id]);d.useEffect(()=>{e&&i&&(r!=null&&r._id)&&it()},[e,i,r==null?void 0:r._id,it]),d.useEffect(()=>{if(e&&i&&!G&&A){const be=setTimeout(()=>{var ke;return(ke=se.current)==null?void 0:ke.focus()},m_);return()=>clearTimeout(be)}},[e,i,G,A]),d.useEffect(()=>{if(!e||!i||!(r!=null&&r._id)||!Ne)return;const be=Je=>{var Jt;Je.userId===i&&(ut.debug("Incoming call:",Je),z({callId:Je.callId,callerName:((Jt=Je.caller)==null?void 0:Jt.name)||(t==null?void 0:t.nickname)||"Unknown",callerId:Je.userId}),Fe(`${(t==null?void 0:t.nickname)||"Someone"} is calling you.`))},ke=Je=>{Je.userId===i&&(ut.debug("Call accepted:",Je),x||(Fe(`${(t==null?void 0:t.nickname)||"User"} accepted your call.`),Y(!0),z(null),H.success(`${t==null?void 0:t.nickname} accepted your call`)))},Ge=Je=>{Je.userId===i&&(ut.debug("Call declined:",Je),G&&!x?(Fe(`${(t==null?void 0:t.nickname)||"User"} declined your call.`),Y(!1)):x&&x.callerId===i&&(Fe(`Call from ${t==null?void 0:t.nickname} was declined/cancelled.`),z(null)),H.info(`${t==null?void 0:t.nickname} declined the call`))},Xe=Je=>{(Je.userId===i||Je.userId===r._id)&&(ut.debug("Hangup received:",Je),G&&(Fe("Video call ended."),Y(!1)),x&&x.callerId===Je.userId&&(Fe(`Call attempt from ${t==null?void 0:t.nickname} ended.`),z(null)),(G||x)&&H.info("Video call ended"),Y(!1),z(null))},Rt=[Ne.on("incomingCall",be),Ne.on("callAccepted",ke),Ne.on("callDeclined",Ge),Ne.on("videoHangup",Xe)];return()=>Rt.forEach(Je=>Je==null?void 0:Je())},[e,i,t==null?void 0:t.nickname,r==null?void 0:r._id,G,x,Fe]);const T=d.useCallback(async be=>{var ke,Ge;if(be==null||be.stopPropagation(),!(v===0||!i||B)){$(!0);try{const Xe=await Ae.post("/users/photos/approve-all",{requesterId:i});if((ke=Xe.data)!=null&&ke.success){const Rt=Xe.data.approvedCount||v;H.success(`Approved ${Rt} photo request${Rt!==1?"s":""}.`),Fe(`Photo access approved for ${(t==null?void 0:t.nickname)||"user"}.`),b(0),h&&(r==null?void 0:r.accountTier)!==ss.FREE&&h("I've approved your request to view my private photos.","text")}else throw new Error(((Ge=Xe.data)==null?void 0:Ge.message)||"Approval failed")}catch(Xe){ut.error("Error approving photo requests:",Xe),H.error(`Error approving requests: ${Xe.message||"Please try again."}`),Fe("Failed to approve photo requests.",!0)}finally{$(!1)}}},[i,v,B,r==null?void 0:r.accountTier,h,Fe,t==null?void 0:t.nickname]),D=d.useCallback(be=>{const ke=be.target.value;k(ke),Ue.current&&clearTimeout(Ue.current),ke.trim()&&i&&_&&P&&(Ue.current=setTimeout(_,g_))},[i,_,P]),re=d.useCallback(async(be,ke="text")=>{if(!A||!P||!i||!/^[0-9a-fA-F]{24}$/.test(i))return H.error("Cannot send message. Chat not ready or recipient invalid."),ut.warn("sendMessageWrapper pre-condition failed.",{initialized:A,isConnected:P,recipientId:i}),P||Fe("Message failed: No connection.",!0),!1;const Ge=ke==="file"&&be instanceof File,Xe=Ge?a:h;if(!Xe)return ut.error(`Send function not available for type: ${ke}`),H.error(`Cannot send ${ke} message.`),!1;let Rt=null;try{if(ke==="text"&&typeof be=="string"){Rt=Zi("msg");const Je={}}return Ge?await Xe(be,i):await Xe(be,ke),ut.debug(`${ke} message sent/initiated.`),!0}catch(Je){return ut.error(`Failed to send ${ke} message:`,Je),H.error(Je.message||`Failed to send ${ke}.`),Fe(`Failed to send ${ke==="file"?"file":"message"}.`,!0),!1}},[A,P,i,h,a,Fe,r==null?void 0:r._id]),fe=d.useCallback(async()=>{var be;if(et(t==null?void 0:t._id)){H.error("Cannot send messages to blocked users");return}if(F){if(!F||L||C||(r==null?void 0:r.accountTier)===ss.FREE){(r==null?void 0:r.accountTier)===ss.FREE&&H.error("Upgrade to Premium to send files.");return}E(!0),I(0);const ke=setInterval(()=>I(Xe=>Math.min(Xe+10,90)),200),Ge=await re(F,"file");clearInterval(ke),Ge?(I(100),setTimeout(()=>{O(null),E(!1),I(0),he.current&&(he.current.value="")},__)):(E(!1),I(0),H.error("File upload failed."))}else{const ke=j.trim();if(!ke||C||L)return;if((r==null?void 0:r.accountTier)===ss.FREE&&ke!=="😉"){H.error("Free accounts can only send winks 😉.");return}k(""),await re(ke,"text")?(be=se.current)==null||be.focus():k(ke)}},[F,j,C,L,r==null?void 0:r.accountTier,re,t,et]),Re=d.useCallback(async()=>{if(C||L||!i||et(t==null?void 0:t._id)){et(t==null?void 0:t._id)&&H.error("Cannot send winks to blocked users");return}await re("😉","wink")},[C,L,i,re,et,t]),ee=d.useCallback(()=>{var be;if((r==null?void 0:r.accountTier)===ss.FREE){H.error("Upgrade to Premium to send files.");return}if(et(t==null?void 0:t._id)){H.error("Cannot send files to blocked users");return}L||(be=he.current)==null||be.click()},[r==null?void 0:r.accountTier,L,et,t]),X=d.useCallback(be=>{var Ge;const ke=(Ge=be.target.files)==null?void 0:Ge[0];if(ke){if(et(t==null?void 0:t._id)){H.error("Cannot send files to blocked users"),be.target.value=null;return}if(ke.size>Co){H.error(`File too large. Max size: ${Co/1024/1024}MB.`),be.target.value=null;return}if(!ko.includes(ke.type)){H.error(`File type (${ke.type||"unknown"}) not supported.`),be.target.value=null;return}O(ke),k(""),E(!1),I(0),H.info(`Selected: ${ke.name}. Click send.`),be.target.value=null}},[et,t]),U=d.useCallback(()=>{var be;O(null),I(0),E(!1),he.current&&(he.current.value=""),(be=se.current)==null||be.focus()},[]),y=d.useCallback(be=>{k(ke=>ke+be),setTimeout(()=>{var ke;return(ke=se.current)==null?void 0:ke.focus()},0)},[]),u=d.useCallback(async be=>{if(be==null||be.stopPropagation(),!(Ne!=null&&Ne.isConnected())||!(t!=null&&t.isOnline)||(r==null?void 0:r.accountTier)===ss.FREE||!i||G||x){Ne!=null&&Ne.isConnected()?t!=null&&t.isOnline?(r==null?void 0:r.accountTier)===ss.FREE?Fe("Upgrade to Premium to make video calls.",!0):G||x?ut.warn("Call attempt while call active/incoming."):Fe("Cannot start call: Invalid state.",!0):Fe(`${t.nickname} is offline.`,!0):Fe("Cannot start call: Connection issue.",!0);return}Fe(`Initiating call to ${t.nickname}...`);try{await Ne.initiateVideoCall(i),Fe(`Calling ${t.nickname}... Waiting...`)}catch(ke){ut.error("Video call initiation error:",ke),Fe(ke.message||"Could not start video call.",!0)}},[t,i,r==null?void 0:r.accountTier,G,x,Fe,P]),m=d.useCallback(be=>{be==null||be.stopPropagation(),G&&i&&Ne&&(ut.debug("Ending active call via button."),Ne.emit("videoHangup",{recipientId:i})),Fe("Video call ended."),Y(!1),z(null)},[G,i,Fe]),S=d.useCallback(()=>{if(!(!x||!Ne)){if((r==null?void 0:r.accountTier)===ss.FREE){H.error("Upgrade required to receive video calls."),Ne.answerVideoCall(x.callerId,!1,x.callId),Fe(`Declined call from ${x.callerName} (Upgrade required).`),z(null);return}ut.debug("Accepting call:",x.callId),Ne.answerVideoCall(x.callerId,!0,x.callId),Fe(`Accepted call from ${x.callerName}.`),Y(!0),z(null)}},[x,r==null?void 0:r.accountTier,Fe]),q=d.useCallback(()=>{!x||!Ne||(ut.debug("Declining call:",x.callId),Ne.answerVideoCall(x.callerId,!1,x.callId),Fe(`Declined call from ${x.callerName}.`),z(null))},[x,Fe]),J=d.useCallback(async be=>{var ke;if(!be||!(r!=null&&r._id)){ut.warn("Block/unblock attempted with invalid parameters:",{userId:be,currentUser:r==null?void 0:r._id}),H.error("Unable to process block/unblock request. Please try again.");return}try{const Ge=et(be),Xe=Ge?"unblock":"block";ut.debug(`Attempting to ${Xe} user:`,be);let Rt=!1;try{Rt=((ke=(await Ae.post(`/users/${Xe}/${be}`)).data)==null?void 0:ke.success)||!1}catch(Je){ut.error(`API error for ${Xe} user:`,Je)}Pe(Je=>{try{const Jt=new Set(Je);return Xe==="block"?Jt.add(be):Jt.delete(be),Jt}catch(Jt){return ut.error("Error updating blockedUsers state:",Jt),Je}});try{(t==null?void 0:t._id)===be&&(t.isBlocked=!Ge)}catch(Je){ut.error("Error updating recipient.isBlocked:",Je)}try{const Je=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");if(Xe==="block"&&!Je.includes(be))Je.push(be);else if(Xe==="unblock"){const Jt=Je.indexOf(be);Jt>-1&&Je.splice(Jt,1)}localStorage.setItem("mandarin_blocked_users",JSON.stringify(Je)),ut.debug(`Updated blocked users in localStorage: ${Je.length} users`)}catch(Je){ut.error("Error updating localStorage blocked users:",Je)}H.success(`User ${Xe==="block"?"blocked":"unblocked"} successfully`),Fe(`User ${Xe==="block"?"blocked":"unblocked"}.`)}catch(Ge){if(ut.error(`Error ${et(be)?"unblocking":"blocking"} user:`,Ge),H.error(`Failed to ${et(be)?"unblock":"block"} user. Please try again.`),!et(be)){if(ut.debug("Applying fallback local blocking for better UX despite error"),Pe(Xe=>{const Rt=new Set(Xe);return Rt.add(be),Rt}),(t==null?void 0:t._id)===be)try{t.isBlocked=!0}catch(Xe){ut.error("Error updating recipient.isBlocked in error handler:",Xe)}try{const Xe=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");Xe.includes(be)||(Xe.push(be),localStorage.setItem("mandarin_blocked_users",JSON.stringify(Xe)))}catch(Xe){ut.error("Error updating localStorage in fallback:",Xe)}}}},[r==null?void 0:r._id,et,t,Fe]),Z=d.useCallback(async be=>{var ke;if(!be||!(r!=null&&r._id)){ut.warn("Report user attempted with invalid parameters:",{userId:be,currentUser:r==null?void 0:r._id}),H.error("Unable to process report request. Please try again.");return}try{ut.debug("Attempting to report user:",be);const Ge=await Ae.post(`/users/report/${be}`);(ke=Ge.data)!=null&&ke.success?(H.success("User reported successfully"),Fe("User reported to moderators."),et(be)||setTimeout(()=>{H.info("Consider blocking this user if they are bothering you.",{autoClose:8e3,onClick:()=>J(be)})},1500)):(ut.warn("API reported failure for report:",Ge.data),H.error("Failed to report user. Server reported an issue."))}catch(Ge){ut.error("Error reporting user:",Ge),H.error("Failed to report user. Please try again."),Fe("Attempted to report user to moderators, but there was a network issue.",!0)}},[r==null?void 0:r._id,Fe,et,J]),Se=d.useCallback(()=>{t!=null&&t._id&&(K(!0),ue(t._id))},[t]),tt=d.useCallback(()=>{le(!1),R()},[R]),Ye=d.useCallback(()=>{var be;H.info("Attempting reconnect..."),(be=Ne==null?void 0:Ne.reconnect)==null||be.call(Ne),setTimeout(R,p_)},[R]),nt=d.useCallback(()=>{H.info("Re-initializing chat..."),Ye()},[Ye]);if(!e)return null;if(!t)return n.jsxs("div",{className:bs(Dt.chatContainer,Dt.opening),children:[n.jsx(Lr,{showTimeoutMessage:!1,handleRetry:()=>{},handleReconnect:()=>{}}),n.jsx("p",{children:"Loading recipient..."})]});const at=G||!!x||!A||!P,Bs=L||C||G||!!x,gs=et(t._id),an={user:{...t,username:t.username||t.nickname||t._id,isBlocked:gs},pendingPhotoRequests:v};return Bs||t.isOnline,n.jsxs("div",{className:bs(Dt.chatContainer,Dt.opening),children:[n.jsx(Jd,{conversation:an,isMobile:!1,onBackClick:s,onStartVideoCall:u,onProfileClick:Se,onBlockUser:J,onReportUser:Z,userTier:r==null?void 0:r.accountTier,pendingPhotoRequests:v,isApprovingRequests:B,onApprovePhotoRequests:T,isActionDisabled:Bs,isConnected:P,customStyles:Dt}),(r==null?void 0:r.accountTier)===ss.FREE&&n.jsx(qo,{onUpgradeClick:()=>o("/subscription"),customStyles:Dt}),n.jsx(Uo,{incomingCall:x,isCallActive:G,recipientNickname:t.nickname,onAcceptCall:S,onDeclineCall:q,onEndCall:m,useSmallButtons:!0,customStyles:Dt}),n.jsx(Yd,{className:Dt.chatArea,isUserBlocked:gs,children:n.jsxs("div",{className:Dt.messagesContainer,ref:ht,children:[l&&!He.length?n.jsx(Lr,{showTimeoutMessage:oe,handleRetry:tt,handleReconnect:Ye,customStyles:Dt}):f?n.jsx(zo,{error:f,handleRetry:tt,handleForceInit:nt,showInitButton:!A,customStyles:Dt}):!A||!P&&!He.length?n.jsx(Ca,{handleReconnect:Ye,isInitializing:!A,customStyles:Dt}):He.length===0&&!l?n.jsx(Ho,{text:"No messages yet. Say hello!",customStyles:Dt}):n.jsxs(n.Fragment,{children:[g&&n.jsx("button",{onClick:N,className:Dt.loadMoreButton,disabled:l,children:l?"Loading...":"Load More"}),Object.entries(wt).map(([be,ke])=>n.jsxs(ct.Fragment,{children:[n.jsx("div",{className:Dt.messageDate,children:be}),ke.map(Ge=>n.jsx(Bo,{message:Ge,currentUserId:ft,isSending:C&&Ge.tempId===Ge._id,customStyles:Dt},Ge._id||Ge.tempId))]},be)),p&&n.jsx("div",{className:Dt.typingIndicatorBubble,children:n.jsxs("div",{className:Dt.typingIndicator,children:[n.jsx("span",{}),n.jsx("span",{}),n.jsx("span",{})]})})]}),n.jsx("div",{ref:me,style:{height:"1px"}})]})}),n.jsx(Do,{attachment:F,isUploading:L,uploadProgress:M,onRemoveAttachment:U,onFileSelected:X,showFileInput:!1,disabled:at,userTier:r==null?void 0:r.accountTier,customStyles:Dt}),n.jsx(Fo,{messageValue:j,onInputChange:D,onSubmit:fe,onWinkSend:Re,onFileAttachClick:ee,onEmojiClick:y,userTier:r==null?void 0:r.accountTier,isSending:C,isUploading:L,attachmentSelected:!!F,disabled:at,isUserBlocked:gs,inputRef:se,placeholderText:gs?"Cannot send messages to blocked users":t?`Message ${t.nickname}...`:"Type a message...",customStyles:Dt}),n.jsx("input",{type:"file",ref:he,style:{display:"none"},onChange:X,accept:ko.join(","),"aria-hidden":"true"}),G&&i&&ft&&n.jsx("div",{className:bs(Dt.videoCallOverlay,Dt.active),children:n.jsx(Vo,{isActive:G,userId:ft,recipientId:i,onEndCall:m,isIncoming:!1,callId:null})}),ae&&n.jsx(Wo,{userId:ae,isOpen:ye,onClose:()=>K(!1)})]})};Go.propTypes={recipient:w.shape({_id:w.string.isRequired,nickname:w.string.isRequired,isOnline:w.bool,photos:w.arrayOf(w.shape({url:w.string}))}),isOpen:w.bool,onClose:w.func};const Ni=De.create("StoriesCarousel"),EC=(t,e)=>{let s,r;return function(){const o=this,i=arguments;r?(clearTimeout(s),s=setTimeout(function(){Date.now()-r>=e&&(t.apply(o,i),r=Date.now())},e-(Date.now()-r))):(t.apply(o,i),r=Date.now())}},AC=({onStoryClick:t})=>{const e=Br()||{},{stories:s=[],loadStories:r,loading:o,hasUnviewedStories:i}=e,[c,l]=d.useState(!0),[f,h]=d.useState(null),[a,p]=d.useState([]),[_,N]=d.useState(!1),g=d.useRef(!1),C=d.useRef(null),A=d.useRef(0),P=d.useRef(!1),R=[{_id:"coming-soon-video",mediaType:"video",user:{_id:"video-user",nickname:"Video Stories"}},{_id:"coming-soon-image",mediaType:"image",user:{_id:"image-user",nickname:"Image Stories"}}];d.useEffect(()=>{if(s&&s.length>0){const M=[],I=new Set,v=new Set;s.forEach(x=>{x&&x._id&&!I.has(x._id)&&(I.add(x._id),M.push(x))});const b=[];[...M].sort((x,z)=>new Date(z.createdAt||0)-new Date(x.createdAt||0)).forEach(x=>{const z=x.user?typeof x.user=="string"?x.user:x.user._id:x.userData?x.userData._id:null;z&&!v.has(z)&&(v.add(z),b.push(x))});const $=[...b,...R];p($)}else p(R)},[s]),d.useEffect(()=>{const M=async()=>{if(!g.current){g.current=!0,l(!0),h(null);try{typeof r=="function"?await r(!1):Ni.warn("Stories functionality is not available - loadStories function not found")}catch(I){Ni.error("Error loading stories:",I),h("Failed to load stories")}finally{l(!1),g.current=!1,N(!0)}}};!_&&!g.current&&typeof r=="function"&&M()},[r,_]);const j=d.useCallback(EC(M=>{typeof t=="function"?t(M):Ni.warn("Story click handler not provided")},300),[t]),k=d.useCallback(M=>{if(!C.current)return;const I=300,v=C.current.scrollLeft;C.current.scrollTo({left:M==="right"?v+I:v-I,behavior:"smooth"})},[]),F=d.useCallback(M=>{A.current=M.touches[0].clientX,P.current=!0},[]),O=d.useCallback(M=>{P.current&&M.preventDefault()},[]),L=d.useCallback(M=>{if(!P.current)return;const I=M.changedTouches[0].clientX,v=A.current-I;Math.abs(v)>20&&(v>0?k("right"):k("left")),P.current=!1},[k]);d.useEffect(()=>{const M=C.current;if(M)return M.addEventListener("touchstart",F,{passive:!1}),M.addEventListener("touchmove",O,{passive:!1}),M.addEventListener("touchend",L),()=>{M.removeEventListener("touchstart",F),M.removeEventListener("touchmove",O),M.removeEventListener("touchend",L)}},[F,O,L]);const E=d.useMemo(()=>a.map(M=>n.jsx(Xd,{story:M,onClick:()=>j(M._id),hasUnviewedStories:typeof i=="function"&&M.user?i(typeof M.user=="string"?M.user:M.user._id):!1,mediaType:M.mediaType},M._id||`story-${Math.random()}`)),[a,j,i]);return(c||o)&&!_?n.jsx("div",{className:ge.storiesCarouselContainer,children:n.jsxs("div",{className:ge.loadingContainer,children:[n.jsx("div",{className:ge.spinner}),n.jsx("p",{children:"Loading stories..."})]})}):f?n.jsx("div",{className:ge.storiesCarouselContainer,children:n.jsx("div",{className:ge.errorContainer,children:n.jsx("p",{children:f})})}):n.jsxs("div",{className:ge.storiesCarouselContainer,role:"region","aria-label":"Stories",children:[a.length>4&&n.jsx("button",{className:`${ge.carouselNavButton} ${ge.carouselNavButtonLeft}`,onClick:()=>k("left"),"aria-label":"Scroll stories left",children:"‹"}),n.jsx("div",{className:ge.storiesCarousel,ref:C,style:{overscrollBehavior:"contain"},children:E}),a.length>4&&n.jsx("button",{className:`${ge.carouselNavButton} ${ge.carouselNavButtonRight}`,onClick:()=>k("right"),"aria-label":"Scroll stories right",children:"›"})]})},Xc=De.create("StoryCreator"),Zc=[{id:"gradient-1",name:"Sunset",style:"linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)"},{id:"gradient-2",name:"Ocean",style:"linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"},{id:"gradient-3",name:"Passion",style:"linear-gradient(135deg, #f6d365 0%, #fda085 100%)"},{id:"gradient-4",name:"Midnight",style:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)"},{id:"gradient-5",name:"Forest",style:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},{id:"gradient-6",name:"Berry",style:"linear-gradient(135deg, #c471f5 0%, #fa71cd 100%)"},{id:"gradient-7",name:"Dusk",style:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{id:"gradient-8",name:"Fire",style:"linear-gradient(135deg, #f83600 0%, #f9d423 100%)"}],IC=[{id:"font-1",name:"Classic",style:"'Helvetica', sans-serif"},{id:"font-2",name:"Elegant",style:"'Georgia', serif"},{id:"font-3",name:"Modern",style:"'Montserrat', sans-serif"},{id:"font-4",name:"Playful",style:"'Comic Sans MS', cursive"},{id:"font-5",name:"Bold",style:"'Impact', sans-serif"}],$C=({onClose:t,onSubmit:e})=>{const{user:s}=Gt(),{createStory:r}=Br(),{t:o}=Pt(),{isRTL:i}=Ht(),[c,l]=d.useState(""),[f,h]=d.useState(Zc[0]),[a,p]=d.useState(IC[0]),[_,N]=d.useState(!1),[g,C]=d.useState(0),[A,P]=d.useState(""),[R,j]=d.useState("text"),[k,F]=d.useState(!1),O=B=>B.trim().toLowerCase().substring(0,20),L=()=>{const B=`story_submission_${O(c)}`;return localStorage.getItem(B)},E=()=>{const B=`story_submission_${O(c)}`;localStorage.setItem(B,Date.now().toString()),localStorage.setItem("lastStoryCreated",Date.now().toString()),setTimeout(()=>{try{localStorage.removeItem(B)}catch($){Xc.error("Failed to clean up submission record",$)}},1e4)},M=async()=>{if(k||_){H.info(o("waitForStoryCreation")||"Story creation in progress...");return}if(!c.trim()){H.error(o("addTextError")||"Please add some text to your story");return}if(!s){H.error(o("loginRequired")||"Please log in to create stories");return}if(L()){H.info("This story was already submitted. Please wait or create a different story.");return}if(localStorage.getItem("lastStoryCreated")){const $=parseInt(localStorage.getItem("lastStoryCreated"),10),z=Date.now()-$;if(z<5e3){const G=Math.ceil((5e3-z)/1e3);H.info(`Please wait ${G} seconds before posting another story`);return}}E(),P(""),N(!0),F(!0),C(0);try{const $={content:c.trim(),text:c.trim(),backgroundStyle:f.style,backgroundColor:f.style,fontStyle:a.style,mediaType:"text",type:"text"},x=await r($,I);if(x&&x.message&&x.message.includes("wait")&&!x.success){P(x.message),setTimeout(()=>t==null?void 0:t(),1500);return}x&&(x.success===!0||x._id||x.data&&x.data._id)?(H.success("Story created successfully!"),e&&(x.data?e(x.data):(x._id,e(x))),t==null||t()):P((x==null?void 0:x.message)||(x==null?void 0:x.error)||"Failed to create story")}catch($){Xc.error("Error creating story:",$),P($.message||o("somethingWentWrong")),H.error($.message||o("somethingWentWrong"))}finally{N(!1),F(!1)}},I=B=>{if(B&&typeof B=="number")C(B);else if(B&&B.total>0){const $=Math.round(B.loaded*100/B.total);C($)}},v=d.useCallback(B=>({background:B.style}),[]),b=d.useCallback(B=>({fontFamily:B.style}),[]);return d.useEffect(()=>{const B=$=>{$.key==="Escape"&&!_&&!k&&(t==null||t())};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[t,_,k]),n.jsxs("div",{className:`${ge.storyCreatorContainer} ${i?"rtl-layout":""}`,children:[n.jsx("div",{className:ge.storyCreatorOverlay,onClick:_||k?void 0:t}),n.jsxs("div",{className:ge.storyCreatorModal,children:[n.jsxs("div",{className:ge.storyCreatorHeader,children:[n.jsx("h2",{className:ge.storyCreatorTitle,children:o("createStory")}),n.jsx("button",{className:ge.storyCreatorCloseButton,onClick:_||k?void 0:t,disabled:_||k,"aria-label":"Close",children:n.jsx(rs,{})})]}),n.jsxs("div",{className:ge.storyCreatorContent,children:[n.jsx("div",{className:ge.storyCreatorPreview,children:n.jsx("div",{className:ge.storyPreviewFrame,style:{...v(f),...b(a)},children:c?n.jsx("div",{className:ge.storyTextContent,children:c}):n.jsx("div",{className:ge.storyPlaceholder,children:o("typeSomething")})})}),n.jsxs("div",{className:ge.storyCreatorTabs,children:[n.jsxs("button",{className:`${ge.storyCreatorTab} ${R==="text"?ge.active:""}`,onClick:()=>j("text"),disabled:k||_,children:[n.jsx(Um,{})," ",o("text")]}),n.jsxs("button",{className:`${ge.storyCreatorTab} ${R==="background"?ge.active:""}`,onClick:()=>j("background"),disabled:k||_,children:[n.jsx(Wi,{})," ",o("background")]})]}),R==="text"&&n.jsxs("div",{className:ge.storyCreatorTabContent,children:[n.jsx("textarea",{className:ge.storyCreatorInput,value:c,onChange:B=>l(B.target.value),placeholder:o("whatsOnYourMind"),maxLength:150,disabled:k||_}),n.jsxs("small",{className:ge.storyCreatorCharCount,children:[c.length,"/150"]})]}),R==="background"&&n.jsx("div",{className:ge.storyCreatorTabContent,children:n.jsx("div",{className:ge.storyCreatorBackgroundOptions,children:Zc.map(B=>n.jsx("div",{className:`${ge.storyCreatorBackgroundOption} ${f.id===B.id?ge.selected:""}`,style:v(B),onClick:()=>{!k&&!_&&h(B)},title:B.name},B.id))})}),A&&n.jsx("div",{className:ge.errorMessage,children:A})]}),n.jsx("div",{className:ge.storyCreatorFooter,children:_?n.jsxs("div",{className:ge.uploadProgressContainer,children:[n.jsx("div",{className:ge.storyCreatorProgressContainer,children:n.jsx("div",{className:ge.storyCreatorProgressFill,style:{width:`${g}%`}})}),n.jsxs("span",{children:[g,"%"]})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:`${ge.storyCreatorButton} ${ge.storyCreatorOutlineButton}`,onClick:t,disabled:_||k,children:o("cancel")}),n.jsx("button",{className:`${ge.storyCreatorButton} ${ge.storyCreatorPrimaryButton}`,onClick:M,disabled:_||k||!c.trim(),children:k?n.jsxs(n.Fragment,{children:[n.jsx(Ts,{className:ge.spinner}),n.jsx("span",{children:o("creating")})]}):n.jsxs(n.Fragment,{children:[n.jsx(mt,{}),n.jsx("span",{children:o("createStory")})]})})]})})]})]})},PC=De.create("PrivateRoute"),Un=({children:t,useNavigateHook:e=!1})=>{const{user:s,isAuthenticated:r,loading:o,error:i}=Gt(),c=$n(),l=Zt(),[f,h]=d.useState(!1);if(d.useEffect(()=>{if(i){h(!0);const a=setTimeout(()=>{h(!1)},3e3);return()=>clearTimeout(a)}},[i]),d.useEffect(()=>{e&&!o&&!r&&(PC.debug("Not authenticated, redirecting to login"),l("/login",{replace:!0,state:{from:c.pathname}}))},[r,o,l,c.pathname,e]),o)return n.jsxs("div",{className:"loading-container",children:[n.jsx("div",{className:"spinner"}),n.jsx("p",{className:"loading-text",children:"Loading..."})]});if(i||f){const a=typeof i=="object"&&i!==null?i.message||JSON.stringify(i):String(i||"Authentication error");return n.jsx("div",{className:"auth-error",children:n.jsxs("div",{className:"auth-error-content",children:[n.jsx(It,{className:"auth-error-icon"}),n.jsx("h3",{children:"Authentication Error"}),n.jsx("p",{children:a}),n.jsx("button",{onClick:()=>l("/login"),className:"btn btn-primary",children:"Go to Login"})]})})}return!e&&!r?n.jsx(fu,{to:"/login",state:{from:c.pathname},replace:!0}):r?t:null},nr=({title:t,description:e,image:s="/images/flirtss-social-share.jpg",schema:r,meta:o={},canonicalUrl:i})=>{const c=$n(),{language:l,isRTL:f}=Ht(),h="https://flirtss.com",a=i||`${h}${c.pathname}`,p="Flirtss",_=t?`${t} | ${p}`:p,g=e||"Find meaningful relationships and make genuine connections with singles in your area.",C=s.startsWith("http")?s:`${h}${s}`;return n.jsx(Xu,{htmlAttributes:{lang:l,dir:f?"rtl":"ltr"},title:_,meta:[{name:"description",content:g},{property:"og:title",content:_},{property:"og:description",content:g},{property:"og:url",content:a},{property:"og:type",content:"website"},{property:"og:image",content:C},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:_},{name:"twitter:description",content:g},{name:"twitter:image",content:C},...Object.entries(o).map(([A,P])=>({name:A,content:P}))],link:[{rel:"canonical",href:a}],children:r&&n.jsx("script",{type:"application/ld+json",children:JSON.stringify(r)})})},RC=De.create("VerificationBanner"),LC=()=>{const{user:t,resendVerificationEmail:e}=Gt(),[s,r]=d.useState(!0),[o,i]=d.useState(!1),[c,l]=d.useState(0),{t:f}=Pt();d.useEffect(()=>{const p=localStorage.getItem("verificationBannerDismissed");if(p){const _=new Date(p),g=new Date().getTime()-_.getTime(),C=24*60*60*1e3;g<C?r(!1):(localStorage.removeItem("verificationBannerDismissed"),r(!0))}},[]),d.useEffect(()=>{let p;return c>0&&(p=setInterval(()=>{l(_=>_-1)},6e4)),()=>clearInterval(p)},[c]);const h=async()=>{i(!0);try{await e()&&l(60)}catch(p){RC.error("Error resending verification email:",p)}finally{i(!1)}},a=()=>{r(!1),localStorage.setItem("verificationBannerDismissed",new Date().toISOString())};return!t||t.isVerified||!s?null:n.jsxs("div",{className:"verification-banner",children:[n.jsx("div",{className:"container",children:n.jsxs("div",{className:"banner-content",children:[n.jsx(It,{className:"banner-icon"}),n.jsx("p",{children:f("verificationNeeded")||"Your email is not verified. Please verify your email address to unlock all features."}),n.jsxs("div",{className:"banner-actions",children:[n.jsx("button",{className:"resend-btn",onClick:h,disabled:o||c>0,"aria-label":f("resendVerificationEmail")||"Resend verification email",children:o?n.jsx(n.Fragment,{children:f("sending")||"Sending..."}):c>0?f("resendEmailCooldown",{cooldown:c})||`Resend Email (${c}m)`:n.jsxs(n.Fragment,{children:[n.jsx(Gs,{})," ",f("resendEmail")||"Resend Email"]})}),n.jsx("button",{className:"dismiss-btn",onClick:a,"aria-label":f("dismiss")||"Dismiss banner",children:n.jsx(rs,{})})]})]})}),n.jsx("style",{jsx:!0,children:`
        .verification-banner {
          background-color: #fef08a;
          color: #92400e;
          padding: 12px 20px;
          text-align: center;
          position: absolute;
          top: 64px;
          left: 0;
          width: 100%;
          z-index: 100;
          border-bottom: 1px solid #fcd34d;
        }

        .container {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        .banner-content {
          display: flex;
          align-items: center;
          gap: 16px;
        }

        .banner-icon {
          font-size: 20px;
        }

        .banner-actions {
          display: flex;
          gap: 10px;
        }

        .resend-btn,
        .dismiss-btn {
          background: none;
          border: none;
          color: #92400e;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          transition: background-color 0.2s ease;
        }

        .resend-btn:hover,
        .dismiss-btn:hover {
          background-color: rgba(255, 255, 255, 0.2);
        }

        .resend-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        @media (max-width: 768px) {
          .banner-content {
            flex-direction: column;
            text-align: center;
          }

          .banner-actions {
            flex-direction: column;
          }
        }
      `})]})},OC="_modernFooter_19xca_4",MC="_footerContent_19xca_19",BC="_footerLogo_19xca_40",FC="_footerLinks_19xca_51",DC="_footerSocial_19xca_108",UC="_socialIcon_19xca_114",qC="_footerBottom_19xca_146",Xs={modernFooter:OC,footerContent:MC,footerLogo:BC,footerLinks:FC,footerSocial:DC,socialIcon:UC,footerBottom:qC},zC=()=>{const{t}=Pt();return n.jsxs("footer",{className:Xs.modernFooter,children:[" ",n.jsxs("div",{className:`container ${Xs.footerContent}`,children:[" ",n.jsx(ot,{to:"/",className:Xs.footerLogo,children:"Mandarin"})," ",n.jsxs("div",{className:Xs.footerLinks,children:[" ",n.jsx(ot,{to:"/about",children:t("aboutUs","About Us")}),n.jsx(ot,{to:"/safety",children:t("safety","Safety")})," ",n.jsx(ot,{to:"/support",children:t("contactSupport","Support")}),n.jsx(ot,{to:"/terms",children:t("termsOfService","Terms")}),n.jsx(ot,{to:"/privacy",children:t("privacyPolicy","Privacy")})," "]}),n.jsxs("div",{className:Xs.footerSocial,children:[" ",n.jsx("a",{href:"#","aria-label":"Facebook",className:Xs.socialIcon,children:"FB"}),n.jsx("a",{href:"#","aria-label":"Instagram",className:Xs.socialIcon,children:"IG"}),n.jsx("a",{href:"#","aria-label":"Twitter",className:Xs.socialIcon,children:"TW"})]})]}),n.jsxs("div",{className:Xs.footerBottom,children:[" ","© ",new Date().getFullYear()," Mandarin."," ",t("allRightsReserved","All rights reserved.")]})]})},HC=De.create("ModalContainer"),VC=()=>{const{chatRecipient:t,isChatOpen:e,closeChat:s,profileModalUserId:r,isProfileModalOpen:o,closeProfileModal:i}=jd(),c=e||o;return ct.useEffect(()=>{c&&HC.debug("Active modals:",{chat:e?(t==null?void 0:t.nickname)||(t==null?void 0:t._id):!1,profile:o?r:!1})},[e,o,t,r,c]),n.jsxs(n.Fragment,{children:[e&&t&&n.jsx(Go,{recipient:t,isOpen:e,onClose:s}),n.jsx(Wo,{userId:r,isOpen:o,onClose:i})]})},WC=ct.memo(VC),GC="_loginContainer_19osi_2",YC="_gradientBar_19osi_18",KC="_pageTitle_19osi_25",JC="_subtitle_19osi_41",QC="_formGroup_19osi_52",XC="_formLabel_19osi_56",ZC="_inputWrapper_19osi_67",ek="_inputIcon_19osi_73",tk="_input_19osi_67",sk="_errorMessage_19osi_103",nk="_togglePassword_19osi_112",rk="_rememberForgotWrapper_19osi_134",ok="_checkboxLabel_19osi_141",ik="_checkbox_19osi_141",ak="_forgotPassword_19osi_160",ck="_submitButton_19osi_172",lk="_spinner_19osi_200",dk="_divider_19osi_214",uk="_socialButton_19osi_247",hk="_googleIcon_19osi_281",fk="_facebookIcon_19osi_285",pk="_footer_19osi_289",mk="_footerLink_19osi_300",gk="_alert_19osi_312",yk="_alertDanger_19osi_321",jt={loginContainer:GC,gradientBar:YC,pageTitle:KC,subtitle:JC,formGroup:QC,formLabel:XC,inputWrapper:ZC,inputIcon:ek,input:tk,errorMessage:sk,togglePassword:nk,rememberForgotWrapper:rk,checkboxLabel:ok,checkbox:ik,forgotPassword:ak,submitButton:ck,spinner:lk,divider:dk,socialButton:uk,googleIcon:hk,facebookIcon:fk,footer:pk,footerLink:mk,alert:gk,alertDanger:yk},_k=yn("Login"),vk=()=>{var L;const[t,e]=d.useState({email:"",password:""}),[s,r]=d.useState(!1),[o,i]=d.useState(!1),[c,l]=d.useState({}),[f,h]=d.useState(!1),{login:a,error:p,clearError:_,isAuthenticated:N}=Gt(),{t:g}=Pt(),{isRTL:C}=Ht(),A=Zt(),P=$n(),R=((L=P.state)==null?void 0:L.from)||"/dashboard";d.useEffect(()=>{N&&A(R)},[N,A,R]),d.useEffect(()=>{var E;(E=P.state)!=null&&E.email&&e(M=>({...M,email:P.state.email})),_()},[]),d.useEffect(()=>{p&&(l({general:p}),h(!1))},[p]);const j=()=>{const E={},M=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return t.email?M.test(t.email)||(E.email=g("validationError")):E.email=g("email")+" "+g("validationError"),t.password?t.password.length<6&&(E.password=g("passwordRequirements")):E.password=g("password")+" "+g("validationError"),E},k=E=>{const{name:M,value:I}=E.target;e({...t,[M]:I}),c[M]&&l({...c,[M]:""})},F=async E=>{E.preventDefault();const M=j();if(Object.keys(M).length>0){l(M);return}l({}),h(!0);try{await a({email:t.email,password:t.password})}catch(I){_k.error("Login error",I)}},O=()=>{r(!s)};return n.jsx("div",{className:`auth-page login-page d-flex min-vh-100 bg-light-subtle ${C?"rtl-layout":""}`,children:n.jsxs("div",{className:jt.loginContainer,children:[n.jsx("div",{className:jt.gradientBar}),n.jsxs("div",{className:"text-center mb-4",children:[n.jsx(ot,{to:"/",className:jt.pageTitle,children:"Mandarin"}),n.jsx("p",{className:jt.subtitle,children:g("signIn")})]}),c.general&&n.jsxs("div",{className:`${jt.alert} ${jt.alertDanger}`,children:[n.jsx(It,{}),n.jsx("p",{className:"mb-0",children:c.general})]}),n.jsxs("form",{onSubmit:F,children:[n.jsxs("div",{className:jt.formGroup,children:[n.jsx("label",{className:jt.formLabel,htmlFor:"email",children:g("email")}),n.jsxs("div",{className:jt.inputWrapper,children:[n.jsx(Gs,{className:jt.inputIcon}),n.jsx("input",{type:"email",id:"email",name:"email",className:jt.input,placeholder:g("email"),value:t.email,onChange:k,disabled:f,autoComplete:"email"})]}),c.email&&n.jsxs("p",{className:jt.errorMessage,children:[n.jsx(It,{}),c.email]})]}),n.jsxs("div",{className:jt.formGroup,children:[n.jsx("label",{className:jt.formLabel,htmlFor:"password",children:g("password")}),n.jsxs("div",{className:jt.inputWrapper,children:[n.jsx(ns,{className:jt.inputIcon}),n.jsx("input",{type:s?"text":"password",id:"password",name:"password",className:jt.input,placeholder:g("password"),value:t.password,onChange:k,disabled:f,autoComplete:"current-password"}),n.jsx("button",{type:"button",className:jt.togglePassword,onClick:O,tabIndex:-1,children:s?n.jsx(yd,{}):n.jsx(ba,{})})]}),c.password&&n.jsxs("p",{className:jt.errorMessage,children:[n.jsx(It,{}),c.password]})]}),n.jsxs("div",{className:jt.rememberForgotWrapper,children:[n.jsxs("label",{className:jt.checkboxLabel,children:[n.jsx("input",{type:"checkbox",className:jt.checkbox,checked:o,onChange:()=>i(!o),disabled:f}),g("rememberMe")]}),n.jsx(ot,{to:"/forgot-password",className:jt.forgotPassword,children:g("forgotPassword")})]}),n.jsx("button",{type:"submit",className:jt.submitButton,disabled:f,children:f?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:jt.spinner}),n.jsx("span",{children:g("loading")})]}):n.jsxs(n.Fragment,{children:[n.jsx("span",{children:g("signIn")}),n.jsx(Nr,{})]})})]}),n.jsx("div",{className:jt.divider,children:g("or")}),n.jsxs("div",{children:[n.jsxs("button",{className:jt.socialButton,children:[n.jsx(dd,{className:jt.googleIcon}),n.jsxs("span",{children:[g("signInWith")," Google"]})]}),n.jsxs("button",{className:jt.socialButton,children:[n.jsx(ld,{className:jt.facebookIcon}),n.jsxs("span",{children:[g("signInWith")," Facebook"]})]})]}),n.jsxs("div",{className:jt.footer,children:[g("dontHaveAccount")," ",n.jsx(ot,{to:"/register",className:jt.footerLink,children:g("signUp")})]})]})})},wk="_registerContainer_7o157_3",bk="_gradientBar_7o157_19",xk="_pageTitle_7o157_31",Sk="_subtitle_7o157_47",Ck="_progressContainer_7o157_58",kk="_progressSteps_7o157_62",Nk="_progressLine_7o157_71",jk="_progressStep_7o157_62",Tk="_stepCircle_7o157_92",Ek="_stepLabel_7o157_114",Ak="_active_7o157_124",Ik="_stepHeader_7o157_140",$k="_formGroup_7o157_165",Pk="_formLabel_7o157_169",Rk="_inputWrapper_7o157_185",Lk="_inputIcon_7o157_191",Ok="_input_7o157_185",Mk="_errorMessage_7o157_233",Bk="_helpText_7o157_248",Fk="_togglePassword_7o157_263",Dk="_formActions_7o157_291",Uk="_button_7o157_297",qk="_buttonOutline_7o157_310",zk="_buttonPrimary_7o157_331",Hk="_spinner_7o157_353",Vk="_alert_7o157_367",Wk="_alertDanger_7o157_376",Gk="_tagContainer_7o157_385",Yk="_tag_7o157_385",Kk="_selected_7o157_418",Jk="_tagCheck_7o157_430",Qk="_checkboxGroup_7o157_434",Xk="_checkboxLabel_7o157_438",Zk="_checkboxLabelError_7o157_457",e6="_checkbox_7o157_434",t6="_divider_7o157_467",s6="_socialButtons_7o157_511",n6="_socialButton_7o157_511",r6="_googleIcon_7o157_554",o6="_facebookIcon_7o157_558",i6="_footer_7o157_562",a6="_footerLink_7o157_573",c6="_photoUploadContainer_7o157_585",l6="_uploadProgressContainer_7o157_592",d6="_uploadProgressBar_7o157_607",u6="_uploadProgressFill_7o157_620",h6="_uploadProgressText_7o157_627",f6="_photoUploadArea_7o157_638",p6="_hasImage_7o157_665",m6="_photoUploadIcon_7o157_670",g6="_photoUploadText_7o157_676",y6="_profileImagePreview_7o157_687",_6="_uploadGuidelines_7o157_693",v6="_photoActions_7o157_704",w6="_photoActionButton_7o157_711",b6="_changePhotoButton_7o157_722",x6="_removePhotoButton_7o157_726",Q={registerContainer:wk,gradientBar:bk,pageTitle:xk,subtitle:Sk,progressContainer:Ck,progressSteps:kk,progressLine:Nk,progressStep:jk,stepCircle:Tk,stepLabel:Ek,active:Ak,stepHeader:Ik,formGroup:$k,formLabel:Pk,inputWrapper:Rk,inputIcon:Lk,input:Ok,errorMessage:Mk,helpText:Bk,togglePassword:Fk,formActions:Dk,button:Uk,buttonOutline:qk,buttonPrimary:zk,spinner:Hk,alert:Vk,alertDanger:Wk,tagContainer:Gk,tag:Yk,selected:Kk,tagCheck:Jk,checkboxGroup:Qk,checkboxLabel:Xk,checkboxLabelError:Zk,checkbox:e6,divider:t6,socialButtons:s6,socialButton:n6,googleIcon:r6,facebookIcon:o6,footer:i6,footerLink:a6,photoUploadContainer:c6,uploadProgressContainer:l6,uploadProgressBar:d6,uploadProgressFill:u6,uploadProgressText:h6,photoUploadArea:f6,hasImage:p6,photoUploadIcon:m6,photoUploadText:g6,profileImagePreview:y6,uploadGuidelines:_6,photoActions:v6,photoActionButton:w6,changePhotoButton:b6,removePhotoButton:x6},no=yn("Register"),S6=()=>{var it;const{t}=Pt(),[e,s]=d.useState(1),[r,o]=d.useState({nickname:"",email:"",password:"",confirmPassword:"",dateOfBirth:"",location:"",interests:[],lookingFor:[],agreeTerms:!1,agreePrivacy:!1,newsletter:!1,iAm:"",intoTags:[],turnOns:[],maritalStatus:"",profilePhoto:null}),[i,c]=d.useState(null),l=d.useRef(null),[f,h]=d.useState(!1),[a,p]=d.useState({}),[_,N]=d.useState(!1),[g,C]=d.useState(!1),[A,P]=d.useState([]),{isRTL:R}=Ht(),{register:j,error:k,isAuthenticated:F}=Gt(),O=Zt(),L=$n(),{uploadPhoto:E,isUploading:M,uploadProgress:I}=Pn(),v=["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art","Reading","Gaming","Photography","Dancing","Cooking","Sports"],b=["woman","man","couple"],B=["women","men","couples"],$=["Meetups","Power play","Threesomes","Online fun","Hot chat","Photo sharing","Camera chat","Cuckold","Golden showers","Strap-on","Forced bi","Erotic domination","Humiliation","Crossdressing","Worship","Foot fetish","Oral","From behind","Role-play","Toys","Massages","Foreplay","Casual meetups","Fantasy fulfillment","Bizarre","Education","Experiences","Tantra"],x=["Sexy ass","Dirty talk","Aggressive","Slow and gentle","In a public place","Pampering","Sexy clothing","Leather/latex clothing","Watching porn","Fit body","Bathing together","Erotic writing","Eye contact","Being pampered","Sexy legs","Teasing","Pushing boundaries"],z=["Single","Married","Divorced","Separated","Widowed","In a relationship","It's complicated","Open relationship","Polyamorous"],G=["Tel Aviv, Israel","Jerusalem, Israel","Haifa, Israel","Eilat, Israel","Beer Sheva, Israel","Netanya, Israel","Herzliya, Israel","Ashdod, Israel","Ashkelon, Israel","Tiberias, Israel","Ramat Gan, Israel","Rishon LeZion, Israel","Petah Tikva, Israel","Holon, Israel","Bat Yam, Israel","Rehovot, Israel","Kfar Saba, Israel","Raanana, Israel","Nahariya, Israel","Acre, Israel"],Y=T=>{if(!T)return 0;const D=new Date(T),re=new Date;let fe=re.getFullYear()-D.getFullYear();const Re=re.getMonth()-D.getMonth();return(Re<0||Re===0&&re.getDate()<D.getDate())&&fe--,fe};d.useEffect(()=>{var T;F&&O("/dashboard"),(T=L.state)!=null&&T.email&&o(D=>({...D,email:L.state.email}))},[F,O,(it=L.state)==null?void 0:it.email]),d.useEffect(()=>{if(k){const T=typeof k=="string"?k:t("generalError","An unexpected error occurred.");p(re=>({...re,general:T})),N(!1);const D=document.querySelector(`.${Q.alertDanger}`);D&&D.scrollIntoView({behavior:"smooth",block:"start"})}},[k,t]);const oe=d.useCallback(T=>{const D={},re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(T===1&&(r.nickname.trim()?r.nickname.length<3?D.nickname=t("nicknameTooShort","Nickname must be at least 3 characters"):r.nickname.length>50?D.nickname=t("nicknameTooLong","Nickname cannot exceed 50 characters"):/^[\p{L}\p{N}_]+$/u.test(r.nickname)||(D.nickname=t("nicknameInvalid","Nickname can contain letters in any language, numbers, and underscores")):D.nickname=t("nicknameRequired","Nickname is required"),r.email?re.test(r.email.toLowerCase())||(D.email=t("invalidEmail","Please enter a valid email address")):D.email=t("emailRequired","Email is required"),r.password?r.password.length<8?D.password=t("passwordLengthError","Password must be at least 8 characters"):/(?=.*[a-z])/.test(r.password)?/(?=.*[A-Z])/.test(r.password)?/(?=.*\d)/.test(r.password)?/(?=.*[@$!%*?&])/.test(r.password)||(D.password=t("passwordSpecialError","Password must include at least one special character (@$!%*?&)")):D.password=t("passwordNumberError","Password must include at least one number"):D.password=t("passwordUppercaseError","Password must include at least one uppercase letter"):D.password=t("passwordLowercaseError","Password must include at least one lowercase letter"):D.password=t("passwordRequired","Password is required"),r.password!==r.confirmPassword&&(D.confirmPassword=t("passwordMatchError","Passwords do not match"))),T===2){if(!r.dateOfBirth)D.dateOfBirth=t("dateOfBirthRequired","Date of birth is required");else{const fe=Y(r.dateOfBirth);fe<18?D.dateOfBirth=t("ageRestriction","You must be at least 18 years old"):fe>120&&(D.dateOfBirth=t("invalidDateOfBirth","Please enter a valid date of birth"))}r.iAm||(D.iAm=t("selectIdentity","Please select who you are")),r.location.trim()?r.location.length<2?D.location=t("locationTooShort","Location must be at least 2 characters"):r.location.length>100&&(D.location=t("locationTooLong","Location cannot exceed 100 characters")):D.location=t("locationRequired","Location is required")}return T===3&&(r.profilePhoto||(D.profilePhoto=t("profilePhotoRequired","Please upload a profile photo"))),T===4&&(r.maritalStatus||(D.maritalStatus=t("maritalStatusRequired","Please select your marital status")),r.lookingFor.length===0?D.lookingFor=t("selectLookingFor","Please select what you're looking for"):r.lookingFor.length>3&&(D.lookingFor=t("tooManyLookingFor","Please select no more than 3 options")),r.intoTags.length>20&&(D.intoTags=t("tooManyIntoTags","Please select no more than 20 'I'm into' tags")),r.turnOns.length>20&&(D.turnOns=t("tooManyTurnOns","Please select no more than 20 'Turn ons' tags")),r.interests.length===0?D.interests=t("interestsRequired","Please select at least one interest"):r.interests.length>10&&(D.interests=t("tooManyInterests","Please select no more than 10 interests")),r.agreeTerms||(D.agreeTerms=t("termsRequired","You must agree to the Terms of Service")),r.agreePrivacy||(D.agreePrivacy=t("privacyRequired","You must agree to the Privacy Policy"))),D},[r,t]),le=T=>{const{name:D,value:re,type:fe,checked:Re}=T.target;o(ee=>({...ee,[D]:fe==="checkbox"?Re:re})),a[D]&&p(ee=>({...ee,[D]:""}))},ye=T=>{const D=T.target.value;if(o({...r,location:D}),a.location&&p({...a,location:""}),D.length>1){const re=G.filter(fe=>fe.toLowerCase().includes(D.toLowerCase()));P(re)}else P([])},K=()=>{C(!0);const T=oe(e);if(Object.keys(T).length>0){p(T);const D=document.querySelector(`.${Q.errorMessage}`);D&&D.scrollIntoView({behavior:"smooth",block:"start"});return}p({}),s(e+1),C(!1),window.scrollTo({top:0,behavior:"smooth"})},ae=()=>{s(e-1),p({}),C(!1),window.scrollTo({top:0,behavior:"smooth"})},ue=T=>{o(D=>{const re=D.interests||[],fe=re.includes(T)?re.filter(Re=>Re!==T):[...re,T];return fe.length>10?(H.warning(t("tooManyInterests","Please select no more than 10 interests")),D):(a.interests&&fe.length>0&&p({...a,interests:""}),{...D,interests:fe})})},we=T=>{o(D=>{const re=D.lookingFor||[],fe=re.includes(T)?re.filter(Re=>Re!==T):[...re,T];return fe.length>3?(H.warning(t("tooManyLookingFor","Please select no more than 3 options")),D):(a.lookingFor&&fe.length>0&&p({...a,lookingFor:""}),{...D,lookingFor:fe})})},Pe=T=>{o(D=>({...D,iAm:D.iAm===T?"":T})),a.iAm&&T&&p({...a,iAm:""})},ce=T=>{o(D=>{const re=D.intoTags||[],fe=re.includes(T)?re.filter(Re=>Re!==T):[...re,T];return fe.length>20?(H.warning(t("tooManyIntoTags","Please select no more than 20 'I'm into' tags")),D):(a.intoTags&&p({...a,intoTags:""}),{...D,intoTags:fe})})},de=T=>{o(D=>{const re=D.turnOns||[],fe=re.includes(T)?re.filter(Re=>Re!==T):[...re,T];return fe.length>20?(H.warning(t("tooManyTurnOns","Please select no more than 20 'Turn ons' tags")),D):(a.turnOns&&p({...a,turnOns:""}),{...D,turnOns:fe})})},me=T=>{o({...r,maritalStatus:T.target.value}),a.maritalStatus&&p({...a,maritalStatus:""})},se=async T=>{const D=T.target.files[0];if(!D)return;if(!["image/jpeg","image/png","image/jpg"].includes(D.type)){H.error(t("uploadTypeMismatch","Please upload a valid image file (JPEG, JPG or PNG)"));return}if(D.size>5*1024*1024){H.error(t("uploadSizeLimitExceeded","Image size should be less than 5MB"));return}o({...r,profilePhoto:D});const fe=new FileReader;fe.onloadend=()=>{c(fe.result)},fe.readAsDataURL(D),a.profilePhoto&&p({...a,profilePhoto:""})},he=()=>{o({...r,profilePhoto:null}),c(null),l.current&&(l.current.value="")},Ue=()=>{l.current&&l.current.click()},Me=async T=>{T==null||T.preventDefault();const D=oe(4);if(Object.keys(D).length>0){p(D);const re=document.querySelector(`.${Q.errorMessage}`);re&&re.scrollIntoView({behavior:"smooth",block:"center"});return}p({}),N(!0);try{let re="";r.iAm.toLowerCase()==="woman"?re="female":r.iAm.toLowerCase()==="man"?re="male":r.iAm.toLowerCase()==="couple"&&(re="other");let fe="FREE";r.iAm.toLowerCase()==="woman"?fe="FEMALE":r.iAm.toLowerCase()==="couple"&&(fe="COUPLE");const Re={nickname:r.nickname.trim(),email:r.email.trim().toLowerCase(),password:r.password,accountTier:fe,isCouple:r.iAm.toLowerCase()==="couple",details:{age:Y(r.dateOfBirth),gender:re,location:r.location.trim(),bio:"",interests:r.interests,iAm:r.iAm,lookingFor:r.lookingFor,intoTags:r.intoTags,turnOns:r.turnOns,maritalStatus:r.maritalStatus,dateOfBirth:r.dateOfBirth}},ee=await j(Re);if(ee&&ee.token){if(r.profilePhoto instanceof File)try{await new Promise(U=>setTimeout(U,500));const X=await E(r.profilePhoto,"public",null,!0);X?(H.success(t("photoUploadSuccess","Profile photo uploaded successfully")),no.debug("Profile photo uploaded successfully via hook:",X)):(no.error("Photo upload returned no result"),H.error(t("photoUploadFailed","Failed to upload profile photo")))}catch(X){no.error("Error uploading photo via hook:",X),document.visibilityState==="visible"&&H.error(t("photoUploadFailed","Failed to upload profile photo:")+" "+(X.message||""))}H.success(t("registerSuccess","Welcome to Mandarin! Your account has been created successfully.")),setTimeout(()=>{O("/dashboard")},800)}}catch(re){no.error("Registration error caught in component:",re),!a.general&&!k&&p(Re=>({...Re,general:re.message||t("generalError","An unexpected error occurred. Please try again.")}));const fe=document.querySelector(`.${Q.errorMessage}, .${Q.alertDanger}`);fe&&fe.scrollIntoView({behavior:"smooth",block:"start"})}finally{N(!1)}},ht=()=>{h(!f)},gt=()=>n.jsx("div",{className:Q.progressContainer,children:n.jsxs("div",{className:Q.progressSteps,children:[n.jsxs("div",{className:`${Q.progressStep} ${e>=1?Q.active:""}`,children:[n.jsx("div",{className:Q.stepCircle,children:e>1?n.jsx(mt,{}):1}),n.jsx("span",{className:Q.stepLabel,children:t("accountStep","Account")})]}),n.jsx("div",{className:Q.progressLine}),n.jsxs("div",{className:`${Q.progressStep} ${e>=2?Q.active:""}`,children:[n.jsx("div",{className:Q.stepCircle,children:e>2?n.jsx(mt,{}):2}),n.jsx("span",{className:Q.stepLabel,children:t("profileStep","Profile")})]}),n.jsx("div",{className:Q.progressLine}),n.jsxs("div",{className:`${Q.progressStep} ${e>=3?Q.active:""}`,children:[n.jsx("div",{className:Q.stepCircle,children:e>3?n.jsx(mt,{}):3}),n.jsx("span",{className:Q.stepLabel,children:t("photoStep","Photo")})]}),n.jsx("div",{className:Q.progressLine}),n.jsxs("div",{className:`${Q.progressStep} ${e>=4?Q.active:""}`,children:[n.jsx("div",{className:Q.stepCircle,children:e>4?n.jsx(mt,{}):4}),n.jsx("span",{className:Q.stepLabel,children:t("preferencesStep","Preferences")})]})]})}),He=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:Q.stepHeader,children:[n.jsx("h3",{children:t("createAccount","Create Your Account")}),n.jsx("p",{children:t("enterBasicInfo","Enter your basic information")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,htmlFor:"nickname",children:t("nickname","Nickname")}),n.jsxs("div",{className:Q.inputWrapper,children:[n.jsx(jr,{className:Q.inputIcon}),n.jsx("input",{type:"text",id:"nickname",name:"nickname",placeholder:t("chooseNickname","Choose a nickname"),className:Q.input,value:r.nickname,onChange:le,maxLength:50,autoComplete:"nickname"})]}),a.nickname?n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.nickname]}):n.jsx("p",{className:Q.helpText,children:t("nicknameHelp","Your public display name (can contain letters, numbers, and underscores)")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,htmlFor:"email",children:t("emailAddress","Email Address")}),n.jsxs("div",{className:Q.inputWrapper,children:[n.jsx(Gs,{className:Q.inputIcon}),n.jsx("input",{type:"email",id:"email",name:"email",placeholder:t("enterEmail","Enter your email"),className:Q.input,value:r.email,onChange:le,autoComplete:"username"})]}),a.email?n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.email]}):n.jsx("p",{className:Q.helpText,children:t("emailHelp","We'll never share your email with anyone else")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,htmlFor:"password",children:t("password","Password")}),n.jsxs("div",{className:Q.inputWrapper,children:[n.jsx(ns,{className:Q.inputIcon}),n.jsx("input",{type:f?"text":"password",id:"password",name:"password",placeholder:t("createPassword","Create a password"),className:Q.input,value:r.password,onChange:le,autoComplete:"new-password"}),n.jsx("button",{type:"button",className:Q.togglePassword,onClick:ht,tabIndex:-1,"aria-label":f?t("hidePassword","Hide password"):t("showPassword","Show password"),children:f?n.jsx(yd,{}):n.jsx(ba,{})})]}),a.password?n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.password]}):n.jsx("p",{className:Q.helpText,children:t("passwordHelp","Must be at least 8 characters with uppercase, lowercase, number, and special character")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,htmlFor:"confirmPassword",children:t("confirmPassword","Confirm Password")}),n.jsxs("div",{className:Q.inputWrapper,children:[n.jsx(ns,{className:Q.inputIcon}),n.jsx("input",{type:f?"text":"password",id:"confirmPassword",name:"confirmPassword",placeholder:t("confirmPassword","Confirm password"),className:Q.input,value:r.confirmPassword,onChange:le,autoComplete:"new-password"})]}),a.confirmPassword&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.confirmPassword]})]}),n.jsxs("div",{className:Q.formActions,children:[n.jsx("div",{}),n.jsxs("button",{type:"button",className:`${Q.button} ${Q.buttonPrimary}`,onClick:K,disabled:_,children:[t("continue","Continue")," ",n.jsx(Nr,{})]})]})]}),wt=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:Q.stepHeader,children:[n.jsx("h3",{children:t("tellAboutYourself","Tell Us About Yourself")}),n.jsx("p",{children:t("addBasicProfileDetails","Add some basic profile details")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,htmlFor:"dateOfBirth",children:t("dateOfBirth","Date of Birth")}),n.jsxs("div",{className:Q.inputWrapper,children:[n.jsx(ud,{className:Q.inputIcon}),n.jsx("input",{type:"date",id:"dateOfBirth",name:"dateOfBirth",className:Q.input,value:r.dateOfBirth,onChange:le,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0]})]}),a.dateOfBirth?n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.dateOfBirth]}):n.jsx("p",{className:Q.helpText,children:t("dateOfBirthHelp","You must be at least 18 years old to use this service")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,children:t("iAmA","I am a")}),n.jsx("div",{className:Q.tagContainer,children:b.map(T=>n.jsxs("button",{type:"button",className:`${Q.tag} ${r.iAm===T?Q.selected:""}`,onClick:()=>Pe(T),children:[t(T)||T.charAt(0).toUpperCase()+T.slice(1),r.iAm===T&&n.jsx(mt,{className:Q.tagCheck})]},T))}),a.iAm&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.iAm]})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,htmlFor:"location",children:t("location","Location")}),n.jsxs("div",{className:Q.inputWrapper,children:[n.jsx(Ir,{className:Q.inputIcon}),n.jsx("input",{type:"text",id:"location",name:"location",placeholder:t("locationPlaceholder","City, Country"),className:Q.input,value:r.location,onChange:ye,maxLength:100,list:"location-suggestions"}),n.jsx("datalist",{id:"location-suggestions",children:G.map((T,D)=>n.jsx("option",{value:T},D))})]}),a.location?n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.location]}):n.jsx("p",{className:Q.helpText,children:t("locationHelp","Your general location (e.g., Tel Aviv, Israel)")})]}),n.jsxs("div",{className:Q.formActions,children:[n.jsxs("button",{type:"button",className:`${Q.button} ${Q.buttonOutline}`,onClick:ae,children:[n.jsx(Kn,{})," ",t("back","Back")]}),n.jsxs("button",{type:"button",className:`${Q.button} ${Q.buttonPrimary}`,onClick:K,disabled:_,children:[t("continue","Continue")," ",n.jsx(Nr,{})]})]})]}),ft=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:Q.stepHeader,children:[n.jsx("h3",{children:t("uploadYourPhoto","Upload Your Photo")}),n.jsx("p",{children:t("improveVisibility","Add a profile photo to improve your visibility")})]}),n.jsxs("div",{className:Q.photoUploadContainer,children:[M?n.jsxs("div",{className:Q.uploadProgressContainer,children:[n.jsx("div",{className:Q.uploadProgressBar,children:n.jsx("div",{className:Q.uploadProgressFill,style:{width:`${I}%`}})}),n.jsxs("p",{className:Q.uploadProgressText,children:[t("uploading","Uploading")," ",I,"%"]})]}):n.jsxs("div",{className:`${Q.photoUploadArea} ${i?Q.hasImage:""}`,onClick:Ue,children:[n.jsx("input",{type:"file",ref:l,accept:"image/jpeg,image/png,image/jpg",onChange:se,className:"d-none"}),i?n.jsx("img",{src:i,alt:t("profilePhoto","Profile Preview"),className:Q.profileImagePreview}):n.jsxs(n.Fragment,{children:[n.jsx(Hs,{className:Q.photoUploadIcon}),n.jsx("p",{className:Q.photoUploadText,children:t("clickToUpload","Click to upload a profile photo")})]})]}),n.jsxs("p",{className:Q.uploadGuidelines,children:[t("profileImageHelp","Photos should be clear, recent and show your face."),n.jsx("br",{}),t("profileImageSize","Maximum size: 5MB. Formats: JPG, JPEG, PNG.")]}),a.profilePhoto&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.profilePhoto]}),i&&!M&&n.jsxs("div",{className:Q.photoActions,children:[n.jsxs("button",{type:"button",className:`${Q.photoActionButton} ${Q.changePhotoButton}`,onClick:Ue,disabled:M,children:[n.jsx(md,{})," ",t("changePhoto","Change Photo")]}),n.jsxs("button",{type:"button",className:`${Q.photoActionButton} ${Q.removePhotoButton}`,onClick:he,disabled:M,children:[n.jsx(Jn,{})," ",t("removePhoto","Remove")]})]})]}),n.jsxs("div",{className:Q.formActions,children:[n.jsxs("button",{type:"button",className:`${Q.button} ${Q.buttonOutline}`,onClick:ae,disabled:_,children:[n.jsx(Kn,{})," ",t("back","Back")]}),n.jsxs("button",{type:"button",className:`${Q.button} ${Q.buttonPrimary}`,onClick:K,disabled:_,children:[t("continue","Continue")," ",n.jsx(Nr,{})]})]})]}),et=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:Q.stepHeader,children:[n.jsx("h3",{children:t("yourPreferences","Your Preferences")}),n.jsx("p",{children:t("tellWhatLooking","Tell us about yourself and what you're looking for")})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,children:t("maritalStatus","Marital Status")}),n.jsxs("select",{className:Q.input,name:"maritalStatus",value:r.maritalStatus,onChange:me,style:{paddingLeft:"1rem"},children:[n.jsx("option",{value:"",children:t("selectStatus","Select your status")}),z.map(T=>n.jsx("option",{value:T,children:t(T)||T},T))]}),a.maritalStatus&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.maritalStatus]})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,children:t("lookingFor","Looking For")}),n.jsx("p",{className:Q.helpText,children:t("lookingForHelp","Select up to 3 options")}),n.jsx("div",{className:Q.tagContainer,children:B.map(T=>n.jsxs("button",{type:"button",className:`${Q.tag} ${r.lookingFor.includes(T)?Q.selected:""}`,onClick:()=>we(T),disabled:!r.lookingFor.includes(T)&&r.lookingFor.length>=3,children:[t(T)||T.charAt(0).toUpperCase()+T.slice(1),r.lookingFor.includes(T)&&n.jsx(mt,{className:Q.tagCheck})]},T))}),a.lookingFor&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.lookingFor]})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,children:t("interests","Interests")}),n.jsx("p",{className:Q.helpText,children:t("interestsHelp","Select up to 10 interests")}),n.jsx("div",{className:Q.tagContainer,children:v.map(T=>n.jsxs("button",{type:"button",className:`${Q.tag} ${r.interests.includes(T)?Q.selected:""}`,onClick:()=>ue(T),disabled:!r.interests.includes(T)&&r.interests.length>=10,children:[t(T)||T,r.interests.includes(T)&&n.jsx(mt,{className:Q.tagCheck})]},T))}),a.interests&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.interests]})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,children:t("imInto","I'm into")}),n.jsx("p",{className:Q.helpText,children:t("imIntoHelp","Select up to 20 tags")}),n.jsx("div",{className:Q.tagContainer,children:$.map(T=>n.jsxs("button",{type:"button",className:`${Q.tag} ${r.intoTags.includes(T)?Q.selected:""}`,onClick:()=>ce(T),disabled:!r.intoTags.includes(T)&&r.intoTags.length>=20,children:[t(T)||T,r.intoTags.includes(T)&&n.jsx(mt,{className:Q.tagCheck})]},T))}),a.intoTags&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.intoTags]})]}),n.jsxs("div",{className:Q.formGroup,children:[n.jsx("label",{className:Q.formLabel,children:t("turnsMeOn","It turns me on")}),n.jsx("p",{className:Q.helpText,children:t("turnsMeOnHelp","Select up to 20 tags")}),n.jsx("div",{className:Q.tagContainer,children:x.map(T=>n.jsxs("button",{type:"button",className:`${Q.tag} ${r.turnOns.includes(T)?Q.selected:""}`,onClick:()=>de(T),disabled:!r.turnOns.includes(T)&&r.turnOns.length>=20,children:[t(T)||T,r.turnOns.includes(T)&&n.jsx(mt,{className:Q.tagCheck})]},T))}),a.turnOns&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.turnOns]})]}),n.jsxs("div",{className:Q.checkboxGroup,children:[n.jsxs("label",{className:`${Q.checkboxLabel} ${a.agreeTerms?Q.checkboxLabelError:""}`,children:[n.jsx("input",{type:"checkbox",className:Q.checkbox,name:"agreeTerms",checked:r.agreeTerms,onChange:le}),t("termsAgreement","I agree to the")," ",n.jsx(ot,{to:"/terms",target:"_blank",rel:"noopener noreferrer",className:Q.footerLink,children:t("termsOfService","Terms of Service")})]}),a.agreeTerms&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.agreeTerms]})]}),n.jsxs("div",{className:Q.checkboxGroup,children:[n.jsxs("label",{className:`${Q.checkboxLabel} ${a.agreePrivacy?Q.checkboxLabelError:""}`,children:[n.jsx("input",{type:"checkbox",className:Q.checkbox,name:"agreePrivacy",checked:r.agreePrivacy,onChange:le}),t("privacyAgreement","I agree to the")," ",n.jsx(ot,{to:"/privacy",target:"_blank",rel:"noopener noreferrer",className:Q.footerLink,children:t("privacyPolicy","Privacy Policy")})]}),a.agreePrivacy&&n.jsxs("p",{className:Q.errorMessage,children:[n.jsx(It,{})," ",a.agreePrivacy]})]}),n.jsx("div",{className:Q.checkboxGroup,children:n.jsxs("label",{className:Q.checkboxLabel,children:[n.jsx("input",{type:"checkbox",className:Q.checkbox,name:"newsletter",checked:r.newsletter,onChange:le}),t("newsletterAgreement","I want to receive news and special offers (optional)")]})}),n.jsxs("div",{className:Q.formActions,children:[n.jsxs("button",{type:"button",className:`${Q.button} ${Q.buttonOutline}`,onClick:ae,disabled:_,children:[n.jsx(Kn,{})," ",t("back","Back")]}),n.jsx("button",{type:"submit",className:`${Q.button} ${Q.buttonPrimary}`,disabled:_,onClick:Me,children:_?n.jsxs(n.Fragment,{children:[" ",n.jsx("span",{className:Q.spinner})," ",n.jsx("span",{children:t("creatingAccount","Creating account...")})," "]}):n.jsxs(n.Fragment,{children:[" ",n.jsx("span",{children:t("createBtn","Create Account")})," ",n.jsx(mt,{})," "]})})]})]}),Fe=()=>{switch(e){case 1:return He();case 2:return wt();case 3:return ft();case 4:return et();default:return null}};return n.jsx("div",{className:`auth-page register-page d-flex min-vh-100 bg-light-subtle ${R?"rtl-layout":""}`,children:n.jsxs("div",{className:Q.registerContainer,children:[n.jsx("div",{className:Q.gradientBar}),n.jsxs("div",{className:"text-center mb-4",children:[n.jsx(ot,{to:"/",className:Q.pageTitle,children:"Mandarin"}),n.jsx("p",{className:Q.subtitle,children:t("createAccount","Create Your Account")})]}),a.general&&n.jsxs("div",{className:`${Q.alert} ${Q.alertDanger}`,children:[n.jsx(It,{}),n.jsx("p",{className:"mb-0",children:typeof a.general=="string"?a.general:t("generalError","An error occurred")})]}),gt(),n.jsx("form",{onSubmit:T=>{T.preventDefault(),e===4&&Me()},children:Fe()}),e===1&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:Q.divider,children:t("signUpWith","OR SIGN UP WITH")}),n.jsxs("div",{className:Q.socialButtons,children:[n.jsxs("button",{type:"button",className:Q.socialButton,children:[" ",n.jsx(dd,{className:Q.googleIcon}),n.jsx("span",{children:t("signUpGoogle","Sign up with Google")})]}),n.jsxs("button",{type:"button",className:Q.socialButton,children:[" ",n.jsx(ld,{className:Q.facebookIcon}),n.jsx("span",{children:t("signUpFacebook","Sign up with Facebook")})]})]})]}),n.jsxs("div",{className:Q.footer,children:[t("haveAccount","Already have an account?")," "," ",n.jsx(ot,{to:"/login",className:Q.footerLink,children:t("signIn","Sign In")})]})]})})},C6="_container_auyyq_40",k6="_dashboardPage_auyyq_9",N6="_dashboardContent_auyyq_26",j6="_gradientBar_auyyq_78",T6="_storiesSection_auyyq_89",E6="_storiesHeader_auyyq_106",A6="_storiesTitle_auyyq_119",I6="_dashboardHeader_auyyq_131",$6="_dashboardTitle_auyyq_147",P6="_dashboardSubtitle_auyyq_158",R6="_dashboardActions_auyyq_164",L6="_viewToggle_auyyq_170",O6="_viewToggleButton_auyyq_183",M6="_active_auyyq_202",B6="_filterButton_auyyq_209",F6="_filterPanel_auyyq_240",D6="_filterSection_auyyq_263",U6="_filterOptions_auyyq_278",q6="_rangeSlider_auyyq_284",z6="_rangeValues_auyyq_289",H6="_rangeValue_auyyq_289",V6="_rangeInput_auyyq_304",W6="_filterOption_auyyq_278",G6="_tagsContainer_auyyq_386",Y6="_filterTag_auyyq_394",K6="_filterActions_auyyq_436",J6="_usersSection_auyyq_444",Q6="_usersGrid_auyyq_455",X6="_usersList_auyyq_462",Z6="_userCardWrapper_auyyq_469",e3="_contentLoader_auyyq_479",t3="_loadingContainer_auyyq_488",s3="_spinner_auyyq_493",n3="_loadingText_auyyq_509",r3="_noResultsIcon_auyyq_515",o3="_chatOverlay_auyyq_522",Ve={container:C6,dashboardPage:k6,dashboardContent:N6,gradientBar:j6,storiesSection:T6,storiesHeader:E6,storiesTitle:A6,dashboardHeader:I6,dashboardTitle:$6,dashboardSubtitle:P6,dashboardActions:R6,viewToggle:L6,viewToggleButton:O6,active:M6,filterButton:B6,filterPanel:F6,filterSection:D6,filterOptions:U6,rangeSlider:q6,rangeValues:z6,rangeValue:H6,rangeInput:V6,filterOption:W6,tagsContainer:G6,filterTag:Y6,filterActions:K6,usersSection:J6,usersGrid:Q6,usersList:X6,userCardWrapper:Z6,contentLoader:e3,loadingContainer:t3,spinner:s3,loadingText:n3,noResultsIcon:r3,chatOverlay:o3},el=yn("Dashboard"),i3=()=>{Zt();const{user:t}=Gt(),{users:e,getUsers:s,loading:r,likeUser:o,unlikeUser:i,isUserLiked:c,likesLoading:l,getLikedUsers:f}=_n(),h=0,{createStory:a}=Br(),{t:p}=Pt(),{isRTL:_}=Ht(),N=on();t1();const g=d.useMemo(()=>({browseUsers:p("browseUsers")||"Browse Users",yourMatches:p("yourMatches")||"Your Matches",findMatches:p("findMatches")||"Find your perfect matches",loadingUsers:p("loadingUsers")||"Loading users",loadingMoreUsers:p("loadingMoreUsers")||"Loading more users",noMatches:p("noMatches")||"No matches found",tryAdjustingFilters:p("tryAdjustingFilters")||"Try adjusting your filters",myStories:p("myStories")||"My Stories",createStory:p("createStory")||"Create Story",loading:p("loading")||"Loading",filter:p("filter")||"Filter",filters:p("filters")||"Filters",reset:p("reset")||"Reset",apply:p("apply")||"Apply",online:p("online")||"Online",showOnly:p("showOnly")||"Show Only",range:p("range")||"Range",age:p("age")||"Age",distance:p("distance")||"Distance",verified:p("verified")||"Verified",withPhotos:p("withPhotos")||"With Photos",interests:p("interests")||"Interests",gridView:p("gridView")||"Grid View",listView:p("listView")||"List View",toggleFilters:p("toggleFilters")||"Toggle Filters",browseAndConnect:p("browseAndConnect")||"Browse and Connect",kmAway:p("kmAway")||"km away"}),[p]),[C,A]=d.useState(1),[P,R]=d.useState(!0),[j,k]=d.useState(!1),F=d.useRef(),O=d.useRef(null),[L,E]=d.useState("discover"),[M,I]=d.useState(!1),[v,b]=d.useState({ageMin:18,ageMax:99,distance:100,online:!1,verified:!1,withPhotos:!1,interests:[]}),[B,$]=d.useState(null),[x,z]=d.useState(!1),[G,Y]=d.useState("grid"),[oe,le]=d.useState({}),[ye,K]=d.useState(!1),[ae,ue]=d.useState(null),[we,Pe]=d.useState(!1),[ce,de]=d.useState(null),[me,se]=d.useState(!1),[he,Ue]=d.useState(!1);d.useCallback(X=>{le(U=>({...U,[X]:!0}))},[]),d.useEffect(()=>{Me(1).then(()=>{Ue(!0)})},[v]);const Me=d.useCallback(async X=>{k(X!==1);try{const U=await s(X,20);return R(U.hasMore),A(X),U}catch(U){return el.error("Error loading users:",U),H.error("Failed to load users. Please try again."),null}finally{k(!1)}},[s]),ht=d.useCallback(()=>{!j&&P&&Me(C+1)},[j,P,C,Me]);d.useEffect(()=>{const X=F.current;return X&&X.disconnect(),F.current=new IntersectionObserver(U=>{U[0].isIntersecting&&P&&!j&&!r&&ht()},{root:null,threshold:.1,rootMargin:"100px"}),O.current&&P&&F.current.observe(O.current),()=>{X&&X.disconnect()}},[P,j,r,ht,e.length]),d.useEffect(()=>{const X=setInterval(()=>{document.visibilityState==="visible"&&Me(1)},3e5),U=()=>{document.visibilityState==="visible"&&Me(1)};return document.addEventListener("visibilitychange",U),()=>{clearInterval(X),document.removeEventListener("visibilitychange",U),z(!1),$(null)}},[Me]);const gt=d.useMemo(()=>e.filter(X=>{var y,u;if(X._id===(t==null?void 0:t._id))return!1;const U=((y=X.details)==null?void 0:y.age)||25;if(U<v.ageMin||U>v.ageMax||v.online&&!X.isOnline||v.withPhotos&&(!X.photos||X.photos.length===0))return!1;if(v.interests.length>0){const m=((u=X.details)==null?void 0:u.interests)||[];if(!v.interests.some(q=>m.includes(q)))return!1}return!0}),[e,t,v]),He=d.useMemo(()=>{const X=new Map;return gt.forEach(y=>{y&&y._id&&X.set(y._id,y)}),Array.from(X.values()).sort((y,u)=>y.isOnline&&!u.isOnline?-1:!y.isOnline&&u.isOnline?1:new Date(u.lastActive)-new Date(y.lastActive))},[gt]),wt=["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art"],ft=X=>{b(U=>U.interests.includes(X)?{...U,interests:U.interests.filter(y=>y!==X)}:{...U,interests:[...U.interests,X]})},et=X=>{de(X),se(!0)},Fe=(X,U)=>{X.stopPropagation(),$(U),z(!0)},it=()=>{z(!1),$(null)},T=X=>{if(!a||we){H.info(we?"Story creation in progress, please wait...":"Story creation is not available right now");return}Pe(!0),a(X).then(U=>{U&&(U.success===!0||U._id||U.data&&U.data._id)||U&&U.message&&U.message.includes("wait")?K(!1):H.error(U&&U.error||"Failed to create story")}).catch(U=>{H.error("An error occurred while creating your story"),el.error("Story creation error:",U)}).finally(()=>{Pe(!1)})};d.useEffect(()=>{le({})},[v]);const D=d.useCallback(X=>Array.isArray(h)&&h.some(U=>U.sender===X),[h]),re=d.useCallback(X=>Array.isArray(h)?h.filter(U=>U.sender===X).length:0,[h]),fe=d.useCallback(()=>{b({ageMin:18,ageMax:99,distance:100,online:!1,verified:!1,withPhotos:!1,interests:[]}),A(1),R(!0)},[]);d.useEffect(()=>{const X=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.scrollHeight-300&&P&&!j&&!r&&ht()};return window.addEventListener("scroll",X),()=>window.removeEventListener("scroll",X)},[P,j,r,ht]);const Re=d.useCallback((X,U)=>{c(X)?i(X,U).then(u=>{u&&setTimeout(()=>f(!0),300)}):o(X,U).then(u=>{u&&setTimeout(()=>f(!0),300)})},[c,i,o,f]),ee=(r||l)&&C===1&&!he;return n.jsxs("div",{className:`${Ve.dashboardPage} ${_?"rtl-layout":""} ${N?"mobile-device":""}`,children:[M&&N&&n.jsx("div",{className:`mobile-modal-backdrop ${M?"open":""}`,onClick:()=>I(!1)}),n.jsx(Rr,{}),n.jsx("main",{className:Ve.dashboardContent,children:n.jsxs("div",{className:Ve.container,children:[n.jsx("div",{className:Ve.gradientBar}),n.jsxs("div",{className:Ve.storiesSection,children:[n.jsxs("div",{className:Ve.storiesHeader,children:[n.jsx("h2",{className:Ve.storiesTitle,children:g.myStories}),n.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>!we&&K(!0),"aria-label":"Create a new story",disabled:we,children:[n.jsx(bd,{}),n.jsx("span",{children:we?g.loading:g.createStory})]})]}),n.jsx(AC,{onStoryClick:X=>{ae||ue(X)}})]}),n.jsxs("div",{className:Ve.dashboardHeader,children:[n.jsxs("div",{children:[n.jsx("h1",{className:Ve.dashboardTitle,children:L==="discover"?g.browseUsers:g.yourMatches}),n.jsx("p",{className:Ve.dashboardSubtitle,children:g.findMatches})]}),n.jsxs("div",{className:Ve.dashboardActions,children:[n.jsxs("div",{className:Ve.viewToggle,children:[n.jsx("button",{className:`${Ve.viewToggleButton} ${G==="grid"?Ve.active:""}`,onClick:()=>Y("grid"),title:"Grid View","aria-label":"Grid view",children:n.jsx(sg,{})}),n.jsx("button",{className:`${Ve.viewToggleButton} ${G==="list"?Ve.active:""}`,onClick:()=>Y("list"),title:"List View","aria-label":"List view",children:n.jsx(zm,{})})]}),n.jsxs("button",{className:`${Ve.filterButton} ${M?Ve.active:""}`,onClick:()=>I(!M),"aria-expanded":M,"aria-label":"Toggle filters",children:[n.jsx(Dm,{}),n.jsx("span",{children:g.filter})]})]})]}),M&&n.jsxs("div",{className:`${Ve.filterPanel} animate-fade-in ${N?"mobile-modal":""}`,children:[N&&n.jsxs("div",{className:"mobile-modal-header",children:[n.jsx("div",{className:"mobile-modal-drag-indicator"}),n.jsx("h3",{className:"mobile-modal-title",children:g.filters}),n.jsx("button",{className:"mobile-modal-close",onClick:()=>I(!1),"aria-label":"Close filters",children:n.jsx(rs,{})})]}),n.jsxs("div",{className:Ve.filterSection,children:[n.jsxs("h3",{children:[g.age," ",g.range]}),n.jsx("div",{className:`${Ve.filterOptions} ${N?"touch-target":""}`,children:n.jsxs("div",{className:Ve.rangeSlider,children:[n.jsxs("div",{className:Ve.rangeValues,children:[n.jsx("span",{children:v.ageMin}),n.jsx("span",{children:v.ageMax})]}),n.jsx("input",{type:"range",min:"18",max:"99",value:v.ageMin,onChange:X=>b({...v,ageMin:Number.parseInt(X.target.value)}),className:Ve.rangeInput,"aria-label":"Minimum age"}),n.jsx("input",{type:"range",min:"18",max:"99",value:v.ageMax,onChange:X=>b({...v,ageMax:Number.parseInt(X.target.value)}),className:Ve.rangeInput,"aria-label":"Maximum age"})]})})]}),n.jsxs("div",{className:Ve.filterSection,children:[n.jsx("h3",{children:g.distance}),n.jsx("div",{className:Ve.filterOptions,children:n.jsxs("div",{className:Ve.rangeSlider,children:[n.jsx("div",{className:Ve.rangeValue,children:n.jsxs("span",{children:[v.distance," km"]})}),n.jsx("input",{type:"range",min:"5",max:"100",value:v.distance,onChange:X=>b({...v,distance:Number.parseInt(X.target.value)}),className:Ve.rangeInput,"aria-label":"Maximum distance"})]})})]}),n.jsxs("div",{className:Ve.filterSection,children:[n.jsx("h3",{children:g.showOnly}),n.jsxs("div",{className:`${Ve.filterOptions} d-flex flex-column`,children:[n.jsxs("label",{className:Ve.filterOption,children:[n.jsx("input",{type:"checkbox",checked:v.online,onChange:()=>b({...v,online:!v.online}),"aria-label":"Show only online users"}),n.jsx("span",{children:g.online})]}),n.jsxs("label",{className:Ve.filterOption,children:[n.jsx("input",{type:"checkbox",checked:v.verified,onChange:()=>b({...v,verified:!v.verified}),"aria-label":"Show only verified profiles"}),n.jsx("span",{children:g.verified})]}),n.jsxs("label",{className:Ve.filterOption,children:[n.jsx("input",{type:"checkbox",checked:v.withPhotos,onChange:()=>b({...v,withPhotos:!v.withPhotos}),"aria-label":"Show only profiles with photos"}),n.jsx("span",{children:g.withPhotos})]})]})]}),n.jsxs("div",{className:Ve.filterSection,children:[n.jsx("h3",{children:g.interests}),n.jsx("div",{className:Ve.tagsContainer,children:wt.map(X=>n.jsx("button",{className:`${Ve.filterTag} ${v.interests.includes(X)?Ve.active:""}`,onClick:()=>ft(X),"aria-pressed":v.interests.includes(X),children:X},X))})]}),n.jsxs("div",{className:Ve.filterActions,children:[n.jsx("button",{className:"btn btn-outline",onClick:fe,"aria-label":"Reset filters",children:g.reset}),n.jsxs("button",{className:"btn btn-primary",onClick:()=>I(!1),"aria-label":"Apply filters",children:[g.apply," ",g.filter]})]})]}),n.jsx("div",{className:`${Ve.usersSection} ${N?"mobile-optimized":""}`,children:n.jsx("div",{className:`${G==="grid"?Ve.usersGrid:Ve.usersList} ${N?"compact-grid":""}`,children:ee?n.jsx("div",{className:Ve.contentLoader,children:n.jsxs("div",{className:Ve.loadingContainer,children:[n.jsx("div",{className:Ve.spinner}),n.jsxs("p",{className:Ve.loadingText,children:[g.loadingUsers,"..."]})]})}):He.length>0?n.jsxs(n.Fragment,{children:[He.map((X,U)=>{const y=U===He.length-1;return n.jsx("div",{className:Ve.userCardWrapper,ref:y?O:null,children:n.jsx(h_,{user:X,isLiked:c(X._id),onLike:Re,viewMode:G,onMessage:u=>Fe(u,X),onClick:()=>et(X._id),showExtendedDetails:!0,hasUnreadMessages:D(X._id),unreadMessageCount:re(X._id)})},X._id)}),j&&n.jsx("div",{className:Ve.contentLoader,style:{minHeight:"100px"},children:n.jsxs("div",{className:Ve.loadingContainer,children:[n.jsx("div",{className:Ve.spinner}),n.jsxs("p",{className:Ve.loadingText,children:[g.loadingMoreUsers,"..."]})]})})]}):n.jsx("div",{className:Ve.contentLoader,children:n.jsxs("div",{className:Ve.loadingContainer,children:[n.jsx("div",{className:Ve.noResultsIcon,children:n.jsx(xd,{})}),n.jsx("h3",{children:g.noMatches}),n.jsx("p",{children:g.tryAdjustingFilters}),n.jsxs("button",{className:"btn btn-primary",onClick:fe,"aria-label":"Reset filters",children:[g.reset," ",g.filter]})]})})})})]})}),x&&B&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:Ve.chatOverlay,onClick:it}),n.jsx(Go,{recipient:B,isOpen:x,onClose:it})]}),ye&&n.jsx($C,{onClose:()=>K(!1),onSubmit:T}),ae&&n.jsx(Qd,{storyId:ae,onClose:()=>ue(null)}),me&&n.jsx(Wo,{userId:ce,isOpen:me,onClose:()=>se(!1)})]})},a3="_btn_vy4l6_761",c3="_profilePage_vy4l6_3",l3="_dashboardContent_vy4l6_18",d3="_photoSection_vy4l6_34",u3="_profilePhotoWrapper_vy4l6_74",h3="_profilePhoto_vy4l6_74",f3="_addPhotoButton_vy4l6_371",p3="_profileInfo_vy4l6_422",m3="_profileHeader_vy4l6_448",g3="_profileTitle_vy4l6_462",y3="_infoSection_vy4l6_474",_3="_sectionTitle_vy4l6_501",v3="_infoGrid_vy4l6_531",w3="_formGroup_vy4l6_537",b3="_formLabel_vy4l6_541",x3="_formControl_vy4l6_549",S3="_borderDanger_vy4l6_593",C3="_textArea_vy4l6_597",k3="_errorMessage_vy4l6_602",N3="_textMuted_vy4l6_611",j3="_textRight_vy4l6_615",T3="_mt1_vy4l6_623",E3="_mt2_vy4l6_627",A3="_mt4_vy4l6_635",I3="_mb2_vy4l6_639",$3="_fstItalic_vy4l6_648",P3="_interestsTags_vy4l6_653",R3="_interestTag_vy4l6_659",L3="_selected_vy4l6_676",O3="_btnPrimary_vy4l6_775",M3="_btnOutline_vy4l6_787",B3="_spinner_vy4l6_808",F3="_spinnerLarge_vy4l6_824",D3="_spinnerDark_vy4l6_830",U3="_flexDisplay_vy4l6_929",q3="_flexWrap_vy4l6_930",z3="_gap2_vy4l6_933",pe={btn:a3,profilePage:c3,dashboardContent:l3,photoSection:d3,profilePhotoWrapper:u3,profilePhoto:h3,addPhotoButton:f3,profileInfo:p3,profileHeader:m3,profileTitle:g3,infoSection:y3,sectionTitle:_3,infoGrid:v3,formGroup:w3,formLabel:b3,formControl:x3,borderDanger:S3,textArea:C3,errorMessage:k3,textMuted:N3,textRight:j3,mt1:T3,mt2:E3,mt4:A3,mb2:I3,fstItalic:$3,interestsTags:P3,interestTag:R3,selected:L3,"identity-woman":"_identity-woman_vy4l6_682","identity-man":"_identity-man_vy4l6_695","identity-couple":"_identity-couple_vy4l6_708",btnPrimary:O3,btnOutline:M3,spinner:B3,spinnerLarge:F3,spinnerDark:D3,flexDisplay:U3,flexWrap:q3,gap2:z3},bn=De.create("Profile"),H3=()=>{var it;const t=d.useRef(null),{user:e}=Gt(),{updateProfile:s,refreshUserData:r}=_n(),{t:o}=Pt(),{isRTL:i}=Ht(),c=on(),{isTouch:l,isIOS:f,isAndroid:h,isPWA:a}=tr(),p=d.useMemo(()=>({profilePhoto:o("profilePhoto")||"Profile Photo",profileUpdated:o("profileUpdated")||"Profile updated successfully",updateFailed:o("updateFailed")||"Update failed",photoUploadSuccess:o("photoUploadSuccess")||"Photo uploaded successfully",updatingPhotoPrivacy:o("updatingPhotoPrivacy")||"Updating photo privacy...",photoPrivacySuccess:o("photoPrivacySuccess")||"Photo privacy updated",updatingProfilePhoto:o("updatingProfilePhoto")||"Updating profile photo...",profilePhotoUpdated:o("profilePhotoUpdated")||"Profile photo updated",confirmDeletePhoto:o("confirmDeletePhoto")||"Are you sure you want to delete this photo?",photoDeleteSuccess:o("photoDeleteSuccess")||"Photo deleted successfully",loadingProfile:o("loading")||"Loading...",uploading:o("uploading")||"Uploading...",addPhoto:o("addPhoto")||"Add Photo",myProfile:o("myProfile")||"My Profile",edit:o("edit")||"Edit",cancel:o("cancel")||"Cancel",save:o("save")||"Save",saving:o("saving")||"Saving...",basicInformation:o("basicInfo")||"Basic Information",nickname:o("nickname")||"Nickname",age:o("age")||"Age",location:o("location")||"Location",iAmA:o("iAm")||"I am",notSpecified:o("notSpecified")||"Not specified",maritalStatus:o("maritalStatus")||"Marital Status",maritalStatusMarried:o("maritalStatusMarried")||"Married",aboutMe:o("aboutMe")||"About Me",tellAboutYourself:o("tellAboutYourself")||"Tell others about yourself...",noBioProvided:o("noBioProvided")||"No bio provided",interests:o("interests")||"Interests",interestsLimit:o("interestsLimit")||"Select up to 10 interests",noInterestsSelected:o("noInterestsSelected")||"No interests selected",lookingFor:o("lookingFor")||"Looking For",lookingForLimit:o("lookingForLimit")||"Select up to 3 options",imInto:o("intoTags")||"I'm Into",intoTagsLimit:o("intoTagsLimit")||"Select up to 20 tags",noTagsSelected:o("noTagsSelected")||"No tags selected",turnOns:o("turnOns")||"Turn Ons",turnOnsLimit:o("turnOnsLimit")||"Select up to 20 turn ons",private:o("private")||"Private",public:o("public")||"Public",friendsOnly:o("friendsOnly")||"Friends Only",profileUpdateFailed:o("profileUpdateFailed")||"Failed to update profile",photoUploadFailed:o("photoUploadFailed")||"Failed to upload photo",photoPrivacyUpdateFailed:o("photoPrivacyUpdateFailed")||"Failed to update photo privacy",profilePhotoUpdateFailed:o("profilePhotoUpdateFailed")||"Failed to update profile photo",photoDeleteFailed:o("photoDeleteFailed")||"Failed to delete photo",required:o("required")||"This field is required",invalidFormat:o("invalidFormat")||"Invalid format",tooShort:o("tooShort")||"Too short",tooLong:o("tooLong")||"Too long",man:o("man")||"Man",woman:o("woman")||"Woman",couple:o("couple")||"Couple",men:o("men")||"Men",women:o("women")||"Women",couples:o("couples")||"Couples"}),[o]),{uploadPhoto:_,setPhotoPrivacy:N,setProfilePhoto:g,deletePhoto:C,isUploading:A,uploadProgress:P,isProcessingPhoto:R,processPhotos:j,clearCache:k,refreshAllAvatars:F}=Pn(),[O,L]=d.useState(!1),[E,M]=d.useState({nickname:"",details:{age:"",gender:"",location:"",bio:"",interests:[],iAm:"",lookingFor:[],intoTags:[],turnOns:[],maritalStatus:""}}),[I]=d.useState(["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art","Reading","Gaming","Photography","Dancing","Cooking"]),[v]=d.useState(["woman","man","couple"]),[b]=d.useState(["women","men","couples"]),[B]=d.useState(["Meetups","Power play","Threesomes","Online fun","Hot chat","Photo sharing","Camera chat","Cuckold","Golden showers","Strap-on","Forced bi","Erotic domination","Humiliation","Crossdressing","Worship","Foot fetish","Oral","From behind","Role-play","Toys","Massages","Foreplay","Casual meetups","Fantasy fulfillment","Bizarre","Education","Experiences","Tantra"]),[$]=d.useState(["Sexy ass","Dirty talk","Aggressive","Slow and gentle","In a public place","Pampering","Sexy clothing","Leather/latex clothing","Watching porn","Fit body","Bathing together","Erotic writing","Eye contact","Being pampered","Sexy legs","Teasing","Pushing boundaries"]),[x]=d.useState(["Single","Married","Divorced","Separated","Widowed","In a relationship","It's complicated","Open relationship","Polyamorous"]),[z,G]=d.useState({}),[Y,oe]=d.useState(!1),le=d.useRef(null);Zt();const[ye,K]=d.useState(!0),[ae,ue]=d.useState(Date.now());d.useEffect(()=>{var T,D,re,fe,Re,ee,X,U,y,u,m;K(!0),e&&(M({nickname:e.nickname||"",details:{age:((T=e.details)==null?void 0:T.age)||"",gender:((D=e.details)==null?void 0:D.gender)||"",location:((re=e.details)==null?void 0:re.location)||"",bio:((fe=e.details)==null?void 0:fe.bio)||"",interests:((Re=e.details)==null?void 0:Re.interests)||[],iAm:((ee=e.details)==null?void 0:ee.iAm)||"",lookingFor:((X=e.details)==null?void 0:X.lookingFor)||[],intoTags:((U=e.details)==null?void 0:U.intoTags)||[],turnOns:((y=e.details)==null?void 0:y.turnOns)||[],maritalStatus:((u=e.details)==null?void 0:u.maritalStatus)||""}}),bn.debug(`User has ${((m=e.photos)==null?void 0:m.length)||0} photos`)),K(!1)},[e]);const we=d.useRef(!0);d.useEffect(()=>()=>{we.current=!1},[]),d.useEffect(()=>()=>{le.current&&(le.current.value="")},[]),d.useEffect(()=>{let T=null;return l&&t.current&&(T=Pr(t.current),bn.debug("Mobile scroll enhancements applied to Profile")),()=>{T&&T()}},[l]);const Pe=T=>{const{name:D,value:re,type:fe,checked:Re}=T.target;if(fe==="checkbox")M({...E,[D]:Re});else if(fe==="number"){if(re===""||!isNaN(Number.parseInt(re)))if(D.includes("details.")){const ee=D.split(".")[1];M({...E,details:{...E.details,[ee]:re}})}else M({...E,[D]:re})}else if(D.includes("details.")){const ee=D.split(".")[1];M({...E,details:{...E.details,[ee]:re}})}else M({...E,[D]:re});z[D.split(".").pop()]&&G(ee=>{const X={...ee};return delete X[D.split(".").pop()],X})},ce=T=>{const D=E.details.interests;if(!D.includes(T)&&D.length>=10){H.warning("You can select up to 10 interests");return}const re=D.includes(T)?D.filter(fe=>fe!==T):[...D,T];M(fe=>({...fe,details:{...fe.details,interests:re}}))},de=T=>{M(D=>({...D,details:{...D.details,iAm:D.details.iAm===T?"":T}}))},me=T=>{const D=E.details.lookingFor;let re;if(D.includes(T))re=D.filter(fe=>fe!==T);else{if(D.length>=3){H.warning("You can select up to 3 options");return}re=[...D,T]}M(fe=>({...fe,details:{...fe.details,lookingFor:re}}))},se=T=>{const D=E.details.intoTags;if(!D.includes(T)&&D.length>=20){H.warning("You can select up to 20 'I'm into' tags");return}const re=D.includes(T)?D.filter(fe=>fe!==T):[...D,T];M(fe=>({...fe,details:{...fe.details,intoTags:re}}))},he=T=>{const D=E.details.turnOns;if(!D.includes(T)&&D.length>=20){H.warning("You can select up to 20 'Turn ons' tags");return}const re=D.includes(T)?D.filter(fe=>fe!==T):[...D,T];M(fe=>({...fe,details:{...fe.details,turnOns:re}}))},Ue=T=>{M(D=>({...D,details:{...D.details,maritalStatus:D.details.maritalStatus===T?"":T}}))},Me=()=>{const T={};return E.nickname.trim()?E.nickname.length<3?T.nickname="nicknameTooShort":E.nickname.length>50&&(T.nickname="nicknameTooLong"):T.nickname="nicknameRequired",!E.details.age&&E.details.age!==0?T.age="ageRequired":isNaN(E.details.age)?T.age="ageInvalid":E.details.age<18?T.age="ageMinimum":E.details.age>120&&(T.age="ageMaximum"),E.details.location.trim()?E.details.location.length<2&&(T.location="locationTooShort"):T.location="locationRequired",E.details.bio&&E.details.bio.length>500&&(T.bio="bioTooLong"),T},ht=async T=>{T==null||T.preventDefault();const D=Me();if(Object.keys(D).length>0){G(D);const re=document.querySelector(`.${pe.errorMessage}`);re&&re.scrollIntoView({behavior:"smooth",block:"center"});return}G({}),oe(!0);try{const re={nickname:E.nickname.trim(),details:{...E.details,age:Number(E.details.age),location:E.details.location.trim(),bio:E.details.bio?E.details.bio.trim():"",interests:Array.isArray(E.details.interests)?E.details.interests:[],iAm:E.details.iAm||"",lookingFor:Array.isArray(E.details.lookingFor)?E.details.lookingFor:[],intoTags:Array.isArray(E.details.intoTags)?E.details.intoTags:[],turnOns:Array.isArray(E.details.turnOns)?E.details.turnOns:[],maritalStatus:E.details.maritalStatus||""}},fe=await s(re);if(fe)await r(fe._id)||bn.warn("User data refresh may not have been complete, but continuing"),H.success(p.profileUpdated),L(!1);else throw new Error(p.updateFailed)}catch(re){console.error("Failed to update profile:",re),H.error(re.message||p.profileUpdateFailed)}finally{oe(!1)}},gt=async T=>{const D=T.target.files[0];if(D){l&&Ot("sendFile");try{await _(D,"private")&&(k(),ue(Date.now()),H.success(p.photoUploadSuccess),await r(e==null?void 0:e._id,!0),le.current&&(le.current.value=""))}catch(re){bn.error("Failed to upload photo:",re),H.error(re.message||p.photoUploadFailed)}}},He=()=>{var T;(T=le.current)==null||T.click()},wt=async(T,D,re)=>{re==null||re.stopPropagation();try{H.info(p.updatingPhotoPrivacy,{autoClose:1e3}),await N(T,D,e==null?void 0:e._id),F(!0),k(),ue(Date.now()),await r(e==null?void 0:e._id,!0);const fe=D==="private"?p.private:D==="friends_only"?p.friendsOnly:p.public;H.success(o("photoPrivacySuccess")||`Photo privacy set to ${fe}`)}catch(fe){bn.error("Failed to update photo privacy:",fe),H.error(fe.message||p.photoPrivacyUpdateFailed)}},ft=async T=>{try{l&&Ot("selectConversation"),H.info(p.updatingProfilePhoto,{autoClose:1e3}),await g(T,e==null?void 0:e._id),F(!0),window.__photo_refresh_timestamp=Date.now(),ue(window.__photo_refresh_timestamp),await new Promise(D=>setTimeout(D,300)),await r(e==null?void 0:e._id,!0),ue(Date.now()),H.success(p.profilePhotoUpdated)}catch(D){bn.error("Failed to set profile photo:",D),H.error(D.message||p.profilePhotoUpdateFailed)}},et=async(T,D)=>{if(D==null||D.stopPropagation(),!!window.confirm(p.confirmDeletePhoto))try{await C(T,e==null?void 0:e._id),k(),ue(Date.now()),await r(e==null?void 0:e._id,!0),H.success(p.photoDeleteSuccess)}catch(re){bn.error("Failed to delete photo:",re),H.error(re.message||p.photoDeleteFailed)}},Fe=()=>{var T,D,re,fe,Re,ee,X,U,y,u;e&&M({nickname:e.nickname||"",details:{age:((T=e.details)==null?void 0:T.age)||"",gender:((D=e.details)==null?void 0:D.gender)||"",location:((re=e.details)==null?void 0:re.location)||"",bio:((fe=e.details)==null?void 0:fe.bio)||"",interests:((Re=e.details)==null?void 0:Re.interests)||[],iAm:((ee=e.details)==null?void 0:ee.iAm)||"",lookingFor:((X=e.details)==null?void 0:X.lookingFor)||[],intoTags:((U=e.details)==null?void 0:U.intoTags)||[],turnOns:((y=e.details)==null?void 0:y.turnOns)||[],maritalStatus:((u=e.details)==null?void 0:u.maritalStatus)||""}}),G({}),L(!1)};return n.jsxs("div",{ref:t,className:`${pe.profilePage} min-vh-100 w-100 overflow-hidden bg-light-subtle transition-all ${i?"rtl-layout":""} ${c?"mobile-optimized":""}`,children:[n.jsx(Rr,{}),n.jsx("main",{className:`${pe.dashboardContent} py-5`,children:n.jsx("div",{className:"container max-w-xl mx-auto px-4 d-flex flex-column gap-5",children:ye?n.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5 text-center",children:[n.jsx("div",{className:`${pe.spinner} ${pe.spinnerLarge} text-primary mb-4`}),n.jsx("p",{className:"text-opacity-70 font-weight-medium",children:p.loadingProfile})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`${pe.photoSection} text-center bg-white shadow-lg rounded-lg border py-4 transform-gpu hover-shadow-xl transition-all`,children:[e!=null&&e.photos&&e.photos.some(T=>T.isProfile&&!T.isDeleted)?n.jsx("div",{className:`${pe.profilePhotoWrapper} position-relative d-inline-block`,children:(()=>{const T=e.photos.find(re=>re.isProfile&&!re.isDeleted)||e.photos[0],D=T.privacy||(T.isPrivate?"private":"public");return n.jsxs(n.Fragment,{children:[n.jsx("img",{src:`${fs(T.url,!0)}${window.__photo_refresh_timestamp?`&_t=${window.__photo_refresh_timestamp}`:""}&_updateTime=${ae}`,alt:p.profilePhoto,className:`${pe.profilePhoto} w-300px h-300px object-cover rounded-circle shadow-lg border-4 border-white transform-gpu transition-transform hover-scale`},`profile-photo-${ae}`),D!=="public"&&n.jsx("div",{className:"position-absolute top-0 left-0 w-100 h-100 rounded-circle d-flex align-items-center justify-content-center bg-overlay-dark",children:D==="private"?n.jsx(ns,{className:"text-3xl text-white"}):n.jsx(vo,{className:"text-3xl text-white"})}),n.jsx("div",{className:"position-absolute bottom-0 left-0 w-100 py-1 bg-overlay-dark text-white text-xs rounded-bottom-circle",children:p.profilePhoto})]})})()}):n.jsx("div",{className:"w-300px h-300px rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto border-4 border-white",children:n.jsx(Yi,{className:"text-7xl text-gray-400"})}),n.jsx("div",{className:"mt-4",children:A?n.jsxs("div",{className:"mx-auto w-200px",children:[n.jsx("div",{className:"h-8px bg-gray-800 rounded-pill overflow-hidden mb-2",children:n.jsx("div",{className:"h-100 bg-primary transition-width",role:"progressbar",style:{width:`${P}%`},"aria-valuenow":P,"aria-valuemin":"0","aria-valuemax":"100"})}),n.jsxs("div",{className:"text-center text-opacity-70",children:[p.uploading," ",P,"%"]})]}):n.jsxs("button",{className:"btn btn-outline-primary rounded-pill d-inline-flex align-items-center gap-2 hover-scale shadow-sm transition-all px-4 py-2",onClick:He,disabled:R,"aria-label":p.addPhoto,children:[n.jsx(Hs,{})," ",n.jsx("span",{children:p.addPhoto}),n.jsx("input",{type:"file",ref:le,onChange:gt,accept:"image/*",style:{display:"none"},"aria-hidden":"true"})]})})]}),(e==null?void 0:e.photos)&&e.photos.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(wy,{photos:j(e.photos),onSetProfilePhoto:ft,onSetPrivacy:wt,onDeletePhoto:et,isProcessing:R,isUploading:A,uploadProgress:P,canEdit:!0,canTogglePrivacy:!0,userId:e==null?void 0:e._id,isOwner:!0,canViewPrivate:!0,gridView:!0},`photo-gallery-${((it=e.photos)==null?void 0:it.length)||0}-${ae}`),n.jsx("div",{className:"text-center mt-4",children:n.jsxs("button",{type:"button",className:pe.addPhotoButton,onClick:He,disabled:A||R,"aria-label":p.addPhoto,children:[n.jsx(Hs,{style:{fontSize:"18px",marginRight:"8px"}}),p.addPhoto]})})]}),n.jsxs("div",{className:pe.profileInfo,children:[n.jsxs("div",{className:pe.profileHeader,children:[n.jsx("h2",{className:pe.profileTitle,children:p.myProfile}),O?n.jsxs("div",{className:`${pe.flexDisplay} ${pe.gap2}`,children:[n.jsxs("button",{className:`${pe.btn} ${pe.btnOutline}`,onClick:Fe,disabled:Y,"aria-label":p.cancel,children:[n.jsx(rs,{})," ",n.jsx("span",{children:p.cancel})]}),n.jsx("button",{className:`${pe.btn} ${pe.btnPrimary}`,onClick:ht,disabled:Y,"aria-label":p.save,children:Y?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:`${pe.spinner} ${pe.spinnerDark}`}),n.jsx("span",{children:p.saving})]}):n.jsxs(n.Fragment,{children:[n.jsx(mt,{})," ",n.jsx("span",{children:p.save})]})})]}):n.jsxs("button",{className:`${pe.btn} ${pe.btnPrimary}`,onClick:()=>L(!0),"aria-label":p.edit,children:[n.jsx(md,{})," ",n.jsx("span",{children:p.edit})]})]}),n.jsxs("form",{className:"mt-4",onSubmit:ht,children:[n.jsxs("div",{className:`${pe.infoSection} animate-fade-in`,children:[n.jsx("h3",{className:pe.sectionTitle,children:p.basicInformation}),n.jsxs("div",{className:pe.infoGrid,children:[n.jsxs("div",{className:pe.formGroup,children:[n.jsx("label",{className:pe.formLabel,htmlFor:"nickname",children:p.nickname}),n.jsx("input",{type:"text",id:"nickname",name:"nickname",className:`${pe.formControl} ${z.nickname?pe.borderDanger:""}`,value:E.nickname,onChange:Pe,disabled:!O,maxLength:50,"aria-invalid":z.nickname?"true":"false","aria-describedby":z.nickname?"nickname-error":void 0}),z.nickname&&n.jsxs("p",{id:"nickname-error",className:pe.errorMessage,children:[n.jsx(It,{className:"mr-1"}),o(`errors.${z.nickname}`)]})]}),n.jsxs("div",{className:pe.formGroup,children:[n.jsx("label",{className:pe.formLabel,htmlFor:"details.age",children:p.age}),n.jsx("input",{type:"number",id:"details.age",name:"details.age",className:`${pe.formControl} ${z.age?pe.borderDanger:""}`,value:E.details.age,onChange:Pe,disabled:!O,min:"18",max:"120","aria-invalid":z.age?"true":"false","aria-describedby":z.age?"age-error":void 0}),z.age&&n.jsxs("p",{id:"age-error",className:pe.errorMessage,children:[n.jsx(It,{className:"mr-1"}),o(`errors.${z.age}`)]})]}),n.jsxs("div",{className:pe.formGroup,children:[n.jsx("label",{className:pe.formLabel,htmlFor:"details.location",children:p.location}),n.jsx("input",{type:"text",id:"details.location",name:"details.location",className:`${pe.formControl} ${z.location?pe.borderDanger:""}`,value:E.details.location,onChange:Pe,disabled:!O,maxLength:100,"aria-invalid":z.location?"true":"false","aria-describedby":z.location?"location-error":void 0}),z.location&&n.jsxs("p",{id:"location-error",className:pe.errorMessage,children:[n.jsx(It,{className:"mr-1"}),o(`errors.${z.location}`)]})]})]}),n.jsxs("div",{className:pe.mt4,children:[n.jsx("label",{className:pe.formLabel,children:p.iAmA}),n.jsx("div",{className:`${pe.flexDisplay} ${pe.flexWrap} ${pe.gap2}`,children:v.map(T=>{const D=T==="woman"?pe["identity-woman"]:T==="man"?pe["identity-man"]:T==="couple"?pe["identity-couple"]:"";return n.jsxs("button",{type:"button",className:`${pe.interestTag} ${E.details.iAm===T?`${pe.selected} ${D}`:D}`,onClick:()=>O&&de(T),disabled:!O,"aria-pressed":E.details.iAm===T,children:[o(T)||T,E.details.iAm===T&&n.jsx(mt,{style:{marginLeft:"4px"}})]},T)})}),!E.details.iAm&&!O&&n.jsx("p",{className:`${pe.textMuted} ${pe.fstItalic} ${pe.mt2}`,children:p.notSpecified})]}),n.jsxs("div",{className:pe.mt4,children:[n.jsx("label",{className:pe.formLabel,children:p.maritalStatus}),n.jsx("div",{className:`${pe.flexDisplay} ${pe.flexWrap} ${pe.gap2}`,children:x.map(T=>n.jsxs("button",{type:"button",className:`${pe.interestTag} ${E.details.maritalStatus===T?pe.selected:""}`,onClick:()=>O&&Ue(T),disabled:!O,"aria-pressed":E.details.maritalStatus===T,children:[o(T)||(T.toLowerCase()==="married"?p.maritalStatusMarried:T),E.details.maritalStatus===T&&n.jsx(mt,{style:{marginLeft:"4px"}})]},T))}),!E.details.maritalStatus&&!O&&n.jsx("p",{className:`${pe.textMuted} ${pe.fstItalic} ${pe.mt2}`,children:p.notSpecified})]})]}),n.jsxs("div",{className:pe.infoSection,children:[n.jsx("h3",{className:pe.sectionTitle,children:p.aboutMe}),n.jsx("textarea",{name:"details.bio",rows:"5",className:`${pe.formControl} ${pe.textArea} ${z.bio?pe.borderDanger:""}`,value:E.details.bio||"",onChange:Pe,disabled:!O,maxLength:500,placeholder:O?p.tellAboutYourself:p.noBioProvided,"aria-invalid":z.bio?"true":"false","aria-describedby":z.bio?"bio-error":void 0}),z.bio&&n.jsxs("p",{id:"bio-error",className:pe.errorMessage,children:[n.jsx(It,{style:{marginRight:"4px"}}),o(`errors.${z.bio}`)]}),O&&n.jsxs("div",{className:`${pe.textMuted} ${pe.textRight} ${pe.mt1}`,children:[E.details.bio?E.details.bio.length:0,"/500"]})]}),n.jsxs("div",{className:pe.infoSection,children:[n.jsx("h3",{className:pe.sectionTitle,children:p.interests}),O&&n.jsx("div",{className:`${pe.textMuted} ${pe.mb2}`,children:p.interestsLimit}),n.jsx("div",{className:pe.interestsTags,children:I.map(T=>{const D=E.details.interests.includes(T);return n.jsxs("button",{type:"button",className:`${pe.interestTag} ${D?pe.selected:""}`,onClick:()=>O&&ce(T),disabled:!O||!D&&E.details.interests.length>=10,"aria-pressed":D,"aria-label":`${p.interests}: ${T}`,children:[o(T)||T,D&&n.jsx(mt,{style:{marginLeft:"4px"}})]},T)})}),E.details.interests.length===0&&!O&&n.jsx("p",{className:`${pe.textMuted} ${pe.fstItalic} ${pe.mt2}`,children:p.noInterestsSelected})]}),n.jsxs("div",{className:pe.infoSection,children:[n.jsx("h3",{className:pe.sectionTitle,children:p.lookingFor||"Looking For"}),O&&n.jsx("div",{className:`${pe.textMuted} ${pe.mb2}`,children:p.lookingForLimit||"Select up to 3 options"}),n.jsx("div",{className:pe.interestsTags,children:b.map(T=>{const D=E.details.lookingFor.includes(T),re=T.toLowerCase().includes("women")||T.toLowerCase().includes("woman")?pe["identity-woman"]:T.toLowerCase().includes("men")||T.toLowerCase().includes("man")?pe["identity-man"]:T.toLowerCase().includes("couple")?pe["identity-couple"]:"";return n.jsxs("button",{type:"button",className:`${pe.interestTag} ${D?`${pe.selected} ${re}`:re}`,onClick:()=>O&&me(T),disabled:!O||!D&&E.details.lookingFor.length>=3,"aria-pressed":D,children:[o(T)||T,D&&n.jsx(mt,{style:{marginLeft:"4px"}})]},T)})}),E.details.lookingFor.length===0&&!O&&n.jsx("p",{className:`${pe.textMuted} ${pe.fstItalic} ${pe.mt2}`,children:p.notSpecified})]}),n.jsxs("div",{className:pe.infoSection,children:[n.jsx("h3",{className:pe.sectionTitle,children:p.imInto}),O&&n.jsx("div",{className:`${pe.textMuted} ${pe.mb2}`,children:p.intoTagsLimit}),n.jsx("div",{className:pe.interestsTags,children:B.map(T=>{const D=E.details.intoTags.includes(T);return n.jsxs("button",{type:"button",className:`${pe.interestTag} ${D?pe.selected:""}`,onClick:()=>O&&se(T),disabled:!O||!D&&E.details.intoTags.length>=20,"aria-pressed":D,children:[o(T)||T,D&&n.jsx(mt,{style:{marginLeft:"4px"}})]},T)})}),E.details.intoTags.length===0&&!O&&n.jsx("p",{className:`${pe.textMuted} ${pe.fstItalic} ${pe.mt2}`,children:p.noTagsSelected})]}),n.jsxs("div",{className:pe.infoSection,children:[n.jsx("h3",{className:pe.sectionTitle,children:p.turnOns}),O&&n.jsx("div",{className:`${pe.textMuted} ${pe.mb2}`,children:p.turnOnsLimit}),n.jsx("div",{className:pe.interestsTags,children:$.map(T=>{const D=E.details.turnOns.includes(T);return n.jsxs("button",{type:"button",className:`${pe.interestTag} ${D?pe.selected:""}`,onClick:()=>O&&he(T),disabled:!O||!D&&E.details.turnOns.length>=20,"aria-pressed":D,children:[o(T)||T,D&&n.jsx(mt,{style:{marginLeft:"4px"}})]},T)})}),E.details.turnOns.length===0&&!O&&n.jsx("p",{className:`${pe.textMuted} ${pe.fstItalic} ${pe.mt2}`,children:p.noTagsSelected})]})]})]})]})})})]})},Kt=De.create("SettingsService"),V3={notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0},privacy:{showOnlineStatus:!0,showReadReceipts:!0,showLastSeen:!0,allowStoryReplies:"everyone"}},ji={getUserSettings:async()=>{try{Kt.debug("Fetching user settings from /auth/me endpoint");const t=await Ae.get("/auth/me");if(t.success&&t.data){const e=t.data.settings||V3;return Kt.debug("Successfully fetched user settings"),{success:!0,data:e}}else return Kt.error("API returned unsuccessful response",t),{success:!1,error:t.error||"Failed to fetch settings",data:null}}catch(t){return Kt.error("Error fetching user settings",t),{success:!1,error:t.message||"Failed to fetch settings",data:null}}},updateSettings:async t=>{try{Kt.debug("Updating settings via /users/profile endpoint");const e=await Ae.put("/users/profile",{settings:t});return e.success?(Kt.debug("Settings update successful"),{success:!0,data:t}):(Kt.warn("Settings update failed",e),{success:!1,error:e.error||"Failed to update settings",data:null})}catch(e){return Kt.error("Error updating settings",e),{success:!1,error:e.message||"Failed to update settings",data:null}}},updateNotificationSettings:async t=>{try{Kt.debug("Updating notification settings",{notificationSettings:t});const e=await Ae.put("/users/profile",{settings:{notifications:t}});return e.success?(Kt.debug("Notification settings update successful"),{success:!0,data:{notifications:t}}):(Kt.warn("Notification settings update failed",e),{success:!1,error:e.error||"Failed to update notification settings",data:null})}catch(e){return Kt.error("Error updating notification settings",e),{success:!1,error:e.message||"Failed to update notification settings",data:null}}},updatePrivacySettings:async t=>{try{Kt.debug("Updating privacy settings",{privacySettings:t});const e=await Ae.put("/users/profile",{settings:{privacy:t}});return e.success?(Kt.debug("Privacy settings update successful"),{success:!0,data:{privacy:t}}):(Kt.warn("Privacy settings update failed",e),{success:!1,error:e.error||"Failed to update privacy settings",data:null})}catch(e){return Kt.error("Error updating privacy settings",e),{success:!1,error:e.message||"Failed to update privacy settings",data:null}}},deleteAccount:async t=>{try{Kt.info("Attempting account deletion");const e=await Ae.delete("/users/account",{data:{password:t}});return Kt.info("Account deletion successful"),e.data}catch(e){throw Kt.error("Error deleting account",e),e}}},cs=De.create("SubscriptionService"),W3={accountTier:"FREE",isPaid:!1,dailyLikesRemaining:3,canSendMessages:!1,canCreateStory:!0},na={getSubscriptionStatus:async()=>{var t;try{cs.debug("Fetching subscription status");const e=await Ae.get("/subscription/status");return cs.debug("Subscription status received",{tier:(t=e==null?void 0:e.data)==null?void 0:t.accountTier}),e}catch(e){return cs.error("Error fetching subscription status",e),{success:!0,data:W3}}},upgradeSubscription:async t=>{try{if(!t||!["monthly","yearly"].includes(t))throw new Error("Invalid subscription plan. Please choose monthly or yearly.");cs.info(`Upgrading subscription to ${t} plan`);const e=await Ae.post("/subscription/upgrade",{plan:t});if(e.success)return cs.info("Subscription upgrade successful",{plan:t}),H.success(`Successfully upgraded to ${t} plan!`),e;throw cs.warn("Subscription upgrade failed",{error:e.error}),new Error(e.error||"Failed to upgrade subscription")}catch(e){throw cs.error("Error upgrading subscription",e),H.error(e.message||"Failed to upgrade subscription"),e}},cancelSubscription:async()=>{try{cs.info("Canceling subscription");const t=await Ae.post("/subscription/cancel");if(t.success)return cs.info("Subscription cancellation successful"),H.info(t.message||"Subscription successfully canceled"),t;throw cs.warn("Subscription cancellation failed",{error:t.error}),new Error(t.error||"Failed to cancel subscription")}catch(t){throw cs.error("Error canceling subscription",t),H.error(t.message||"Failed to cancel subscription"),t}},checkActionPermission:async t=>{try{if(!["message","like","story"].includes(t))throw cs.warn(`Invalid action type requested: ${t}`),new Error("Invalid action type");cs.debug(`Checking permission for action: ${t}`);const s=await na.getSubscriptionStatus();if(!s.success)throw cs.warn("Could not verify subscription status"),new Error("Could not verify subscription status");const{data:r}=s;let o;switch(t){case"message":o={allowed:r.canSendMessages,reason:r.canSendMessages?null:"Messaging requires a premium account"};break;case"like":o={allowed:r.accountTier!=="FREE"||r.dailyLikesRemaining>0,reason:r.dailyLikesRemaining>0?null:"You have used all your daily likes",remaining:r.dailyLikesRemaining};break;case"story":o={allowed:r.canCreateStory,reason:r.canCreateStory?null:`Story creation available in ${r.storyCooldown} hours`,cooldown:r.storyCooldown};break;default:o={allowed:!1,reason:"Unknown action type"}}return cs.debug(`Permission check result for ${t}:`,{allowed:o.allowed}),o}catch(e){return cs.error(`Error checking permission for ${t}`,e),{allowed:!1,reason:e.message||"Could not verify permissions"}}}},G3="_dark_1wrhd_16",Y3="_settingsPage_1wrhd_4",K3="_settingsContent_1wrhd_21",J3="_settingsContainer_1wrhd_31",Q3="_gradientBar_1wrhd_56",X3="_settingsTitle_1wrhd_66",Z3="_settingsNavigation_1wrhd_77",eN="_navItem_1wrhd_89",tN="_active_1wrhd_119",sN="_navIcon_1wrhd_134",nN="_settingsPanel_1wrhd_144",rN="_sectionHeader_1wrhd_150",oN="_sectionIcon_1wrhd_164",iN="_sectionTitle_1wrhd_169",aN="_settingsOption_1wrhd_186",cN="_optionContent_1wrhd_214",lN="_optionTitle_1wrhd_218",dN="_optionDescription_1wrhd_229",uN="_toggleWrapper_1wrhd_240",hN="_toggleInput_1wrhd_247",fN="_toggleSlider_1wrhd_253",pN="_radioGroup_1wrhd_291",mN="_radioOption_1wrhd_297",gN="_radioInput_1wrhd_311",yN="_themeOptions_1wrhd_346",_N="_themeOption_1wrhd_346",vN="_themePreview_1wrhd_387",wN="_light_1wrhd_400",bN="_system_1wrhd_452",xN="_themeName_1wrhd_478",SN="_accountInfo_1wrhd_489",CN="_accountDetail_1wrhd_514",kN="_accountLabel_1wrhd_531",NN="_accountActions_1wrhd_542",jN="_actionButton_1wrhd_548",TN="_editButton_1wrhd_567",EN="_logoutButton_1wrhd_571",AN="_deleteButton_1wrhd_575",IN="_actionIcon_1wrhd_579",$N="_saveSection_1wrhd_589",PN="_saveButton_1wrhd_595",RN="_hasChanges_1wrhd_622",LN="_modalOverlay_1wrhd_639",ON="_modalContainer_1wrhd_653",MN="_modalHeader_1wrhd_670",BN="_modalTitle_1wrhd_682",FN="_closeButton_1wrhd_692",DN="_modalContent_1wrhd_714",UN="_warningBox_1wrhd_718",qN="_warningIcon_1wrhd_732",zN="_warningText_1wrhd_740",HN="_warningList_1wrhd_750",VN="_warningItem_1wrhd_760",WN="_passwordSection_1wrhd_764",GN="_passwordLabel_1wrhd_768",YN="_passwordInput_1wrhd_779",KN="_error_1wrhd_804",JN="_errorMessage_1wrhd_808",QN="_modalActions_1wrhd_817",XN="_buttonCancel_1wrhd_829",ZN="_buttonDelete_1wrhd_855",ej="_blockedUsersSection_1wrhd_883",tj="_sectionDescription_1wrhd_899",sj="_blockedUsersList_1wrhd_909",nj="_blockedUserItem_1wrhd_915",rj="_blockedUserInfo_1wrhd_940",oj="_blockedUserAvatar_1wrhd_946",ij="_blockedUserName_1wrhd_958",aj="_unblockButton_1wrhd_967",cj="_emptyState_1wrhd_987",lj="_emptyStateIcon_1wrhd_999",dj="_loadingState_1wrhd_1010",uj="_spinner_1wrhd_1018",hj="_loadingText_1wrhd_1028",fj="_languageWrapper_1wrhd_1043",pj="_optionIcon_1wrhd_1156",V={dark:G3,settingsPage:Y3,settingsContent:K3,settingsContainer:J3,gradientBar:Q3,settingsTitle:X3,settingsNavigation:Z3,navItem:eN,active:tN,navIcon:sN,settingsPanel:nN,sectionHeader:rN,sectionIcon:oN,sectionTitle:iN,settingsOption:aN,optionContent:cN,optionTitle:lN,optionDescription:dN,toggleWrapper:uN,toggleInput:hN,toggleSlider:fN,radioGroup:pN,radioOption:mN,radioInput:gN,themeOptions:yN,themeOption:_N,themePreview:vN,light:wN,system:bN,themeName:xN,accountInfo:SN,accountDetail:CN,accountLabel:kN,accountActions:NN,actionButton:jN,editButton:TN,logoutButton:EN,deleteButton:AN,actionIcon:IN,saveSection:$N,saveButton:PN,hasChanges:RN,modalOverlay:LN,modalContainer:ON,modalHeader:MN,modalTitle:BN,closeButton:FN,modalContent:DN,warningBox:UN,warningIcon:qN,warningText:zN,warningList:HN,warningItem:VN,passwordSection:WN,passwordLabel:GN,passwordInput:YN,error:KN,errorMessage:JN,modalActions:QN,buttonCancel:XN,buttonDelete:ZN,blockedUsersSection:ej,sectionDescription:tj,blockedUsersList:sj,blockedUserItem:nj,blockedUserInfo:rj,blockedUserAvatar:oj,blockedUserName:ij,unblockButton:aj,emptyState:cj,emptyStateIcon:lj,loadingState:dj,spinner:uj,loadingText:hj,languageWrapper:fj,optionIcon:pj},vt=De.create("Settings"),mj=()=>{const t=Zt(),{user:e,logout:s,getCurrentUser:r}=Gt(),{theme:o,setTheme:i}=Sa(),{currentUser:c,updateProfile:l,getUser:f,getBlockedUsers:h,unblockUser:a}=_n(),{t:p}=Pt(),{language:_,changeLanguage:N,supportedLanguages:g,getLanguageDisplayName:C}=Ht(),A=d.useRef(null),P=d.useRef(null),R=on(),{isTouch:j,isIOS:k,isAndroid:F}=tr(),[O,L]=d.useState([]),[E,M]=d.useState(!1),I={notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0},privacy:{showOnlineStatus:!0,showReadReceipts:!0,showLastSeen:!0,allowStoryReplies:"everyone"}},[v,b]=d.useState(I),[B,$]=d.useState("notifications"),[x,z]=d.useState(!1),[G,Y]=d.useState(!1),[oe,le]=d.useState(""),[ye,K]=d.useState(""),[ae,ue]=d.useState(!1),[we,Pe]=d.useState(!1),[ce,de]=d.useState(!0),[me,se]=d.useState(null);d.useEffect(()=>{if(we&&c)return;vt.debug("useEffect for settings loading triggered"),c?(async()=>{var D,re,fe,Re,ee,X,U,y,u,m,S,q,J,Z,Se,tt,Ye,nt,at,Bs,gs,an,be,ke,Ge,Xe,Rt,Je,Jt,Ln;try{vt.info("Fetching fresh settings from the server");const dt=await ji.getUserSettings();if(dt&&dt.success&&dt.data){vt.info("Successfully loaded settings from server:",dt.data),vt.debug("Message notifications from server:",(D=dt.data.notifications)==null?void 0:D.messages,"typeof:",typeof((re=dt.data.notifications)==null?void 0:re.messages));const Ie={notifications:{messages:((fe=dt.data.notifications)==null?void 0:fe.messages)===!1?!1:!!((Re=dt.data.notifications)!=null&&Re.messages),calls:((ee=dt.data.notifications)==null?void 0:ee.calls)===!1?!1:!!((X=dt.data.notifications)!=null&&X.calls),stories:((U=dt.data.notifications)==null?void 0:U.stories)===!1?!1:!!((y=dt.data.notifications)!=null&&y.stories),likes:((u=dt.data.notifications)==null?void 0:u.likes)===!1?!1:!!((m=dt.data.notifications)!=null&&m.likes),comments:((S=dt.data.notifications)==null?void 0:S.comments)===!1?!1:!!((q=dt.data.notifications)!=null&&q.comments)},privacy:{showOnlineStatus:((J=dt.data.privacy)==null?void 0:J.showOnlineStatus)??I.privacy.showOnlineStatus,showReadReceipts:((Z=dt.data.privacy)==null?void 0:Z.showReadReceipts)??I.privacy.showReadReceipts,showLastSeen:((Se=dt.data.privacy)==null?void 0:Se.showLastSeen)??I.privacy.showLastSeen,allowStoryReplies:((tt=dt.data.privacy)==null?void 0:tt.allowStoryReplies)??I.privacy.allowStoryReplies}};vt.debug("Normalized settings to apply:",Ie),vt.debug("Message notifications in normalized settings:",Ie.notifications.messages,"typeof:",typeof Ie.notifications.messages),b(Ie),Pe(!0);return}}catch(dt){vt.error("Error fetching settings from server:",dt)}if(c&&c.settings){vt.info("Falling back to currentUser settings:",c.settings);const dt=c.settings||{},Ie={notifications:{messages:((Ye=dt.notifications)==null?void 0:Ye.messages)===!1?!1:!!((nt=dt.notifications)!=null&&nt.messages),calls:((at=dt.notifications)==null?void 0:at.calls)===!1?!1:!!((Bs=dt.notifications)!=null&&Bs.calls),stories:((gs=dt.notifications)==null?void 0:gs.stories)===!1?!1:!!((an=dt.notifications)!=null&&an.stories),likes:((be=dt.notifications)==null?void 0:be.likes)===!1?!1:!!((ke=dt.notifications)!=null&&ke.likes),comments:((Ge=dt.notifications)==null?void 0:Ge.comments)===!1?!1:!!((Xe=dt.notifications)!=null&&Xe.comments)},privacy:{showOnlineStatus:((Rt=dt.privacy)==null?void 0:Rt.showOnlineStatus)??I.privacy.showOnlineStatus,showReadReceipts:((Je=dt.privacy)==null?void 0:Je.showReadReceipts)??I.privacy.showReadReceipts,showLastSeen:((Jt=dt.privacy)==null?void 0:Jt.showLastSeen)??I.privacy.showLastSeen,allowStoryReplies:((Ln=dt.privacy)==null?void 0:Ln.allowStoryReplies)??I.privacy.allowStoryReplies}};vt.debug("Normalized settings from user object:",Ie),vt.debug("Message notifications in normalized user settings:",Ie.notifications.messages,"typeof:",typeof Ie.notifications.messages),b(Ie),Pe(!0)}else vt.info("No settings available, using defaults"),Pe(!0)})():vt.warn("No currentUser available, skipping settings load")},[c,I,we]);const he=(T,D)=>{const re=!!v[T][D];vt.debug(`Toggling ${T}.${D}:`,`Current value: ${re} (${typeof v[T][D]})`,`New value: ${!re}`),b(fe=>{const Re={...fe,[T]:{...fe[T],[D]:!re}};return vt.debug("New settings after toggle:",Re),Re}),ue(!0)},Ue=(T,D,re)=>{b(fe=>({...fe,[T]:{...fe[T],[D]:re}})),ue(!0)},Me=T=>{i(T)},ht=async()=>{try{Y(!0),vt.info("Saving settings:",v);const T={notifications:{messages:v.notifications.messages===!1?!1:!!v.notifications.messages,calls:v.notifications.calls===!1?!1:!!v.notifications.calls,stories:v.notifications.stories===!1?!1:!!v.notifications.stories,likes:v.notifications.likes===!1?!1:!!v.notifications.likes,comments:v.notifications.comments===!1?!1:!!v.notifications.comments},privacy:{...v.privacy}};vt.debug("Normalized settings before saving:",T),vt.debug("Messages notification specifically:",T.notifications.messages);const D=await ji.updateSettings(T);if(!D.success)throw new Error(D.error||"Failed to save settings");c&&(vt.info("Updating user profile with normalized settings"),await l({settings:T})||vt.warn("User profile update returned empty response")),vt.info("Updating notification service with normalized settings:",T.notifications),ws.updateSettings(T.notifications),vt.info("Updating socket service with settings:",T.privacy),Ne.updatePrivacySettings(T.privacy),vt.info("Services updated with new settings"),H.success("Settings saved successfully"),ue(!1),vt.debug("Setting current UI state to match saved settings"),b(T)}catch(T){vt.error("Error saving settings:",T),H.error(T.message||"Failed to save settings. Please try again.")}finally{Y(!1)}},gt=()=>{ae?window.confirm(p("unsavedChangesLogout","You have unsaved changes. Are you sure you want to log out?"))&&(s(),t("/login")):(s(),t("/login"))},He=()=>{z(!0)},wt=async()=>{try{if(K(""),!oe){K(p("passwordRequired","Please enter your password to confirm account deletion"));return}const T=await ji.deleteAccount({password:oe});T.success?(H.success(p("accountDeletedSuccess","Account deleted successfully")),s(),t("/login")):K(T.error||p("deleteAccountFailed","Failed to delete account"))}catch(T){vt.error("Error deleting account:",T),K(T.error||p("deleteAccountFailedRetry","Failed to delete account. Please try again."))}},ft=()=>{z(!1),le(""),K("")};d.useEffect(()=>{if(we){de(!1);return}vt.debug("Combined loading effect running"),vt.debug("User available:",!!e,"currentUser available:",!!c),(async()=>{if(e&&!c&&e._id){vt.info("User exists but currentUser is not available yet - fetching user profile");try{typeof f=="function"&&(vt.debug("Using getUser from UserContext to fetch profile"),await f(e._id)),!c&&typeof r=="function"&&(vt.debug("Using getCurrentUser from AuthContext to fetch profile"),await r())}catch(D){vt.error("Error fetching user profile:",D)}}c&&de(!1)})()},[e,c,r,f,we]);const et=d.useCallback(async()=>{if(!c||!c._id){vt.warn("Cannot load blocked users: no current user");return}M(!0);try{vt.info("Loading blocked users from Settings component");const T=await h();vt.debug("Blocked users data:",T),T&&Array.isArray(T)?L(T):(vt.warn("Blocked users data is not an array:",T),L([]))}catch(T){vt.error("Error loading blocked users:",T),L([])}finally{M(!1)}},[h,c]);d.useEffect(()=>{B==="privacy"&&et()},[B,et]),d.useEffect(()=>{let T=null;return j&&P.current&&(T=Pr(P.current),vt.debug("Mobile scroll enhancements applied to Settings")),()=>{T&&T()}},[j]);const Fe=d.useCallback(async(T,D)=>{if(T)try{j&&Ot("selectConversation"),await a(T,D)&&L(fe=>fe.filter(Re=>Re._id!==T))}catch(re){vt.error("Error unblocking user:",re),j&&Ot("error"),H.error("Failed to unblock user")}},[a,j]);d.useEffect(()=>{var Re,ee,X,U,y,u,m,S,q,J,Z,Se,tt,Ye,nt;if(!we||!c||!c.settings)return;const T=!A.current||A.current._id!==c._id,D=(Re=A.current)==null?void 0:Re.settings,re=c.settings;if(!T&&D&&JSON.stringify(D)===JSON.stringify(re))return;vt.debug("Detected meaningful change in currentUser settings, updating UI state");const fe={notifications:{messages:((ee=re.notifications)==null?void 0:ee.messages)===!1?!1:!!((X=re.notifications)!=null&&X.messages),calls:((U=re.notifications)==null?void 0:U.calls)===!1?!1:!!((y=re.notifications)!=null&&y.calls),stories:((u=re.notifications)==null?void 0:u.stories)===!1?!1:!!((m=re.notifications)!=null&&m.stories),likes:((S=re.notifications)==null?void 0:S.likes)===!1?!1:!!((q=re.notifications)!=null&&q.likes),comments:((J=re.notifications)==null?void 0:J.comments)===!1?!1:!!((Z=re.notifications)!=null&&Z.comments)},privacy:{showOnlineStatus:((Se=re.privacy)==null?void 0:Se.showOnlineStatus)??I.privacy.showOnlineStatus,showReadReceipts:((tt=re.privacy)==null?void 0:tt.showReadReceipts)??I.privacy.showReadReceipts,showLastSeen:((Ye=re.privacy)==null?void 0:Ye.showLastSeen)??I.privacy.showLastSeen,allowStoryReplies:((nt=re.privacy)==null?void 0:nt.allowStoryReplies)??I.privacy.allowStoryReplies}};A.current=c,b(fe)},[c,I,we]);const it=()=>{var T;switch(B){case"notifications":return n.jsxs("div",{className:V.settingsContent,children:[n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("messageNotifications","Message Notifications")}),n.jsx("p",{className:V.optionDescription,children:p("messageNotificationsDesc","Get notified when you receive new messages")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.notifications.messages,onChange:()=>he("notifications","messages"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("callNotifications","Call Notifications")}),n.jsx("p",{className:V.optionDescription,children:p("callNotificationsDesc","Get notified for incoming calls")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.notifications.calls,onChange:()=>he("notifications","calls"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("storyNotifications","Story Notifications")}),n.jsx("p",{className:V.optionDescription,children:p("storyNotificationsDesc","Get notified when friends post new stories")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.notifications.stories,onChange:()=>he("notifications","stories"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("likeNotifications","Like Notifications")}),n.jsx("p",{className:V.optionDescription,children:p("likeNotificationsDesc","Get notified when someone likes your content")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.notifications.likes,onChange:()=>he("notifications","likes"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("commentNotifications","Comment Notifications")}),n.jsx("p",{className:V.optionDescription,children:p("commentNotificationsDesc","Get notified when someone comments on your content")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.notifications.comments,onChange:()=>he("notifications","comments"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]})]});case"privacy":return n.jsxs("div",{className:V.settingsContent,children:[n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("onlineStatus","Online Status")}),n.jsx("p",{className:V.optionDescription,children:p("onlineStatusDesc","Show when you're active on the app")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.privacy.showOnlineStatus,onChange:()=>he("privacy","showOnlineStatus"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("readReceipts","Read Receipts")}),n.jsx("p",{className:V.optionDescription,children:p("readReceiptsDesc","Let others know when you've read their messages")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.privacy.showReadReceipts,onChange:()=>he("privacy","showReadReceipts"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("lastSeen","Last Seen")}),n.jsx("p",{className:V.optionDescription,children:p("lastSeenDesc","Show when you were last active")})]}),n.jsxs("label",{className:V.toggleWrapper,children:[n.jsx("input",{type:"checkbox",checked:v.privacy.showLastSeen,onChange:()=>he("privacy","showLastSeen"),className:V.toggleInput}),n.jsx("span",{className:V.toggleSlider})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("storyReplies","Story Replies")}),n.jsx("p",{className:V.optionDescription,children:p("storyRepliesDesc","Control who can reply to your stories")})]}),n.jsxs("div",{className:V.radioGroup,children:[n.jsxs("label",{className:V.radioOption,children:[n.jsx("input",{type:"radio",name:"storyReplies",value:"everyone",checked:v.privacy.allowStoryReplies==="everyone",onChange:()=>Ue("privacy","allowStoryReplies","everyone"),className:V.radioInput}),p("everyone","Everyone")]}),n.jsxs("label",{className:V.radioOption,children:[n.jsx("input",{type:"radio",name:"storyReplies",value:"friends",checked:v.privacy.allowStoryReplies==="friends",onChange:()=>Ue("privacy","allowStoryReplies","friends"),className:V.radioInput}),p("friendsOnly","Friends only")]}),n.jsxs("label",{className:V.radioOption,children:[n.jsx("input",{type:"radio",name:"storyReplies",value:"none",checked:v.privacy.allowStoryReplies==="none",onChange:()=>Ue("privacy","allowStoryReplies","none"),className:V.radioInput}),p("noOne","No one")]})]})]}),n.jsxs("div",{className:V.blockedUsersSection,children:[n.jsxs("div",{className:V.sectionHeader,children:[n.jsx(va,{className:V.sectionIcon}),n.jsx("h3",{className:V.sectionTitle,children:p("blockedUsers","Blocked Users")})]}),n.jsx("p",{className:V.sectionDescription,children:p("blockedUsersDesc","Users you've blocked cannot message you or view your profile")}),E?n.jsxs("div",{className:V.loadingState,children:[n.jsx("div",{className:V.spinner}),n.jsx("p",{children:p("loadingBlockedUsers","Loading blocked users...")})]}):O&&O.length>0?n.jsx("div",{className:V.blockedUsersList,children:O.map(D=>!D||typeof D!="object"||!D._id?null:n.jsxs("div",{className:V.blockedUserItem,children:[n.jsxs("div",{className:V.blockedUserInfo,children:[n.jsx("img",{src:D.photos&&D.photos[0]?D.photos[0].url:"/default-avatar.png",alt:D.nickname||p("defaultUser","User"),className:V.blockedUserAvatar,onError:re=>{re.target.src="/default-avatar.png"}}),n.jsx("span",{className:V.blockedUserName,children:D.nickname||p("defaultUser","User")})]}),n.jsxs("button",{className:V.unblockButton,onClick:()=>Fe(D._id,D.nickname),children:[n.jsx(og,{})," ",p("unblock","Unblock")]})]},D._id))}):n.jsxs("div",{className:V.emptyState,children:[n.jsx(ag,{className:V.emptyStateIcon}),n.jsx("p",{children:p("noBlockedUsers","You haven't blocked any users")})]})]})]});case"appearance":return n.jsxs("div",{className:V.settingsContent,children:[n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("themeMode","Theme Mode")}),n.jsx("p",{className:V.optionDescription,children:p("themeModeDesc","Choose how the app appears to you")})]}),n.jsxs("div",{className:V.themeOptions,children:[n.jsxs("button",{className:`${V.themeOption} ${o==="light"?V.active:""}`,onClick:()=>Me("light"),children:[n.jsx("div",{className:`${V.themePreview} ${V.light}`}),n.jsx("span",{className:V.themeName,children:p("light","Light")})]}),n.jsxs("button",{className:`${V.themeOption} ${o==="dark"?V.active:""}`,onClick:()=>Me("dark"),children:[n.jsx("div",{className:`${V.themePreview} ${V.dark}`}),n.jsx("span",{className:V.themeName,children:p("dark","Dark")})]}),n.jsxs("button",{className:`${V.themeOption} ${o==="system"?V.active:""}`,onClick:()=>Me("system"),children:[n.jsx("div",{className:`${V.themePreview} ${V.system}`}),n.jsx("span",{className:V.themeName,children:p("system","System")})]})]})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsx("h3",{className:V.optionTitle,children:p("quickThemeToggle","Quick Theme Toggle")}),n.jsx("p",{className:V.optionDescription,children:p("quickThemeToggleDesc","Quickly switch between light and dark mode")})]}),n.jsx(Hd,{})]}),n.jsxs("div",{className:V.settingsOption,children:[n.jsxs("div",{className:V.optionContent,children:[n.jsxs("h3",{className:V.optionTitle,children:[n.jsx(qm,{className:V.optionIcon})," ",p("language","Language")]}),n.jsx("p",{className:V.optionDescription,children:p("languageDesc","Choose your preferred language")})]}),n.jsx("div",{className:V.languageWrapper,children:n.jsx(Ud,{display:"section"})})]})]});case"account":return n.jsxs("div",{className:V.settingsContent,children:[n.jsxs("div",{className:V.accountInfo,children:[n.jsxs("div",{className:V.accountDetail,children:[n.jsxs("span",{className:V.accountLabel,children:[p("username","Username"),":"]})," ",(e==null?void 0:e.username)||p("notAvailable","Not available")]}),n.jsxs("div",{className:V.accountDetail,children:[n.jsxs("span",{className:V.accountLabel,children:[p("email","Email"),":"]})," ",(e==null?void 0:e.email)||p("notAvailable","Not available")]}),n.jsxs("div",{className:V.accountDetail,children:[n.jsxs("span",{className:V.accountLabel,children:[p("memberSince","Member since"),":"]})," ",e!=null&&e.createdAt?new Date(e.createdAt).toLocaleDateString():p("notAvailable","Not available")]}),n.jsxs("div",{className:V.accountDetail,children:[n.jsxs("span",{className:V.accountLabel,children:[p("subscription","Subscription"),":"]})," ",(T=e==null?void 0:e.subscription)!=null&&T.plan?p(`${e.subscription.plan.toLowerCase()}Plan`,e.subscription.plan):p("freePlan","Free")]})]}),n.jsxs("div",{className:V.accountActions,children:[n.jsxs("button",{className:`${V.actionButton} ${V.editButton}`,onClick:()=>t("/profile"),children:[n.jsx(jr,{className:V.actionIcon}),n.jsx("span",{children:p("editProfile","Edit Profile")})]}),n.jsxs("button",{className:`${V.actionButton} ${V.logoutButton}`,onClick:gt,children:[n.jsx(Qm,{className:V.actionIcon}),n.jsx("span",{children:p("logout","Log out")})]}),n.jsxs("button",{className:`${V.actionButton} ${V.deleteButton}`,onClick:He,children:[n.jsx(Jn,{className:V.actionIcon}),n.jsx("span",{children:p("deleteAccount","Delete Account")})]})]})]});default:return null}};return!c&&ce&&!me?n.jsxs("div",{className:V.settingsPage,children:[n.jsx(Rr,{}),n.jsx("div",{className:V.settingsContent,children:n.jsxs("div",{className:V.settingsContainer,children:[n.jsx("div",{className:V.gradientBar}),n.jsx("h1",{className:V.settingsTitle,children:p("settings","Settings")}),n.jsxs("div",{className:V.loadingState,children:[n.jsx("div",{className:V.spinner}),n.jsx("p",{className:V.loadingText,children:p("loadingSettings","Loading your settings...")})]})]})})]}):n.jsxs("div",{ref:P,className:`${V.settingsPage} ${R?"mobile-optimized":""}`,children:[n.jsx(Rr,{}),n.jsx("div",{className:V.settingsContent,children:n.jsxs("div",{className:V.settingsContainer,children:[n.jsx("div",{className:V.gradientBar}),n.jsx("h1",{className:V.settingsTitle,children:p("settings","Settings")}),n.jsxs("div",{className:V.settingsNavigation,children:[n.jsxs("button",{className:`${V.navItem} ${B==="notifications"?V.active:""}`,onClick:()=>$("notifications"),children:[n.jsx(Ar,{className:V.navIcon}),n.jsx("span",{children:p("notifications","Notifications")})]}),n.jsxs("button",{className:`${V.navItem} ${B==="privacy"?V.active:""}`,onClick:()=>$("privacy"),children:[n.jsx(ns,{className:V.navIcon}),n.jsx("span",{children:p("privacy","Privacy")})]}),n.jsxs("button",{className:`${V.navItem} ${B==="appearance"?V.active:""}`,onClick:()=>$("appearance"),children:[n.jsx(Wi,{className:V.navIcon}),n.jsx("span",{children:p("appearance","Appearance")})]}),n.jsxs("button",{className:`${V.navItem} ${B==="account"?V.active:""}`,onClick:()=>$("account"),children:[n.jsx(jr,{className:V.navIcon}),n.jsx("span",{children:p("account","Account")})]})]}),n.jsxs("div",{className:V.settingsPanel,children:[n.jsxs("div",{className:V.sectionHeader,children:[B==="notifications"&&n.jsx(Ar,{className:V.sectionIcon}),B==="privacy"&&n.jsx(ns,{className:V.sectionIcon}),B==="appearance"&&n.jsx(Wi,{className:V.sectionIcon}),B==="account"&&n.jsx(jr,{className:V.sectionIcon}),n.jsxs("h2",{className:V.sectionTitle,children:[B==="notifications"&&p("notificationSettings","Notification Settings"),B==="privacy"&&p("privacySettings","Privacy Settings"),B==="appearance"&&p("appearanceSettings","Appearance Settings"),B==="account"&&p("accountSettings","Account Settings")]})]}),it(),(B==="notifications"||B==="privacy")&&n.jsx("div",{className:V.saveSection,children:n.jsxs("button",{className:`${V.saveButton} ${ae?V.hasChanges:""}`,onClick:ht,disabled:G||!ae,children:[n.jsx(Km,{}),G?p("saving","Saving..."):p("saveChanges","Save Changes")]})})]})]})}),x&&n.jsx("div",{className:V.modalOverlay,children:n.jsxs("div",{className:V.modalContainer,children:[n.jsxs("div",{className:V.modalHeader,children:[n.jsxs("h2",{className:V.modalTitle,children:[n.jsx(Jn,{})," ",p("deleteAccount","Delete Account")]}),n.jsx("button",{className:V.closeButton,onClick:ft,children:n.jsx(rs,{})})]}),n.jsxs("div",{className:V.modalContent,children:[n.jsxs("div",{className:V.warningBox,children:[n.jsx(xa,{className:V.warningIcon}),n.jsxs("p",{className:V.warningText,children:[p("deleteWarning","This action")," ",n.jsx("strong",{children:p("cannotBeUndone","cannot be undone")}),". ",p("deleteDataWarning","All your data will be permanently deleted, including:")]}),n.jsxs("ul",{className:V.warningList,children:[n.jsx("li",{className:V.warningItem,children:p("profileInformation","Your profile information")}),n.jsx("li",{className:V.warningItem,children:p("messagesAndConversations","All messages and conversations")}),n.jsx("li",{className:V.warningItem,children:p("photosAndMedia","Photos and media you've shared")}),n.jsx("li",{className:V.warningItem,children:p("storiesAndContent","Stories and other content")})]})]}),n.jsxs("div",{className:V.passwordSection,children:[n.jsx("label",{className:V.passwordLabel,htmlFor:"delete-password",children:p("enterPasswordConfirm","Enter your password to confirm:")}),n.jsx("input",{id:"delete-password",type:"password",value:oe,onChange:T=>le(T.target.value),placeholder:p("yourPassword","Your password"),className:`${V.passwordInput} ${ye?V.error:""}`}),ye&&n.jsxs("div",{className:V.errorMessage,children:[n.jsx(It,{})," ",ye]})]})]}),n.jsxs("div",{className:V.modalActions,children:[n.jsxs("button",{className:V.buttonCancel,onClick:ft,children:[n.jsx(rs,{})," ",p("cancel","Cancel")]}),n.jsxs("button",{className:V.buttonDelete,onClick:wt,disabled:!oe,children:[n.jsx(Jn,{})," ",p("deleteMyAccount","Delete My Account")]})]})]})})]})},gj=()=>{const t=Zt(),{t:e}=Pt(),{isRTL:s}=Ht();return n.jsxs("div",{className:`d-flex flex-column align-items-center justify-content-center ${s?"rtl-layout":""}`,style:{height:"80vh",textAlign:"center"},children:[n.jsx("h1",{style:{fontSize:"3rem",marginBottom:"16px"},children:"404"}),n.jsx("p",{style:{marginBottom:"24px"},children:e("notFound")}),n.jsx("button",{className:"btn btn-primary",onClick:()=>t("/"),children:e("backToHome")})]})},tl=yn("Home"),sl=()=>[{_id:"mock1",nickname:"Emma",details:{age:28,location:"New York"},photos:[{url:"https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock2",nickname:"Michael",details:{age:32,location:"Los Angeles"},photos:[{url:"https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock3",nickname:"Sophia",details:{age:26,location:"Chicago"},photos:[{url:"https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock4",nickname:"James",details:{age:30,location:"Miami"},photos:[{url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock5",nickname:"Olivia",details:{age:27,location:"Tel Aviv"},photos:[{url:"https://images.unsplash.com/photo-1524502397800-2eeaad7c3fe5?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock6",nickname:"Daniel",details:{age:33,location:"London"},photos:[{url:"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock7",nickname:"Ava",details:{age:24,location:"Paris"},photos:[{url:"https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock8",nickname:"Noah",details:{age:29,location:"Berlin"},photos:[{url:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0}],yj=()=>{const{t}=Pt(),{language:e,changeLanguage:s,dir:r}=Ht(),o=Zt(),i=on(),{isTouch:c,isIOS:l,isAndroid:f}=tr(),h=d.useRef(null),a=d.useRef(null),p=d.useRef(0),[_,N]=d.useState(""),[g,C]=d.useState([]),[A,P]=d.useState(!0),[R,j]=d.useState(null),[k,F]=d.useState(null);d.useEffect(()=>{let v=!0;return P(!0),Ae.get("/users",{params:{online:!0,limit:12}}).then(b=>{if(!v)return;const B=Array.isArray(b.data)?b.data:[];C(B.length?B:sl()),j(null)}).catch(b=>{tl.error("Error fetching online users:",b),v&&(C(sl()),j(null))}).finally(()=>{v&&(P(!1),setTimeout(()=>{document.querySelectorAll(".staggered-item").forEach(B=>B.classList.add("animated"))},300))}),()=>{v=!1}},[t]),d.useEffect(()=>{let v=null;return c&&h.current&&(v=Pr(h.current),tl.debug("Mobile scroll enhancements applied to Home")),()=>{v&&v()}},[c]),d.useEffect(()=>{if(!c||!a.current)return;let v=0,b=0;const B=G=>{v=G.changedTouches[0].screenX},$=G=>{b=G.changedTouches[0].screenX,x()},x=()=>{if(b-v>50){F("right"),c&&Ot("selectConversation");const Y=Math.min(Math.max(p.current-1,0),g.length-1);p.current=Y;const oe=a.current.querySelectorAll(".online-user-card");if(oe[Y]){const le=oe[Y].querySelector(".like-btn");le&&(le.classList.add("swiped-right"),setTimeout(()=>le.classList.remove("swiped-right"),500))}}else if(v-b>50){F("left"),c&&Ot("selectConversation");const Y=Math.min(Math.max(p.current+1,0),g.length-1);p.current=Y;const oe=a.current.querySelectorAll(".online-user-card");oe.length>0&&(oe.forEach(le=>le.classList.add("swiped-left")),setTimeout(()=>{oe.forEach(le=>le.classList.remove("swiped-left"))},300))}},z=a.current;return z.addEventListener("touchstart",B,{passive:!0}),z.addEventListener("touchend",$,{passive:!0}),()=>{z.removeEventListener("touchstart",B),z.removeEventListener("touchend",$)}},[c,g.length]);const O=v=>{v.preventDefault(),c&&Ot("send"),o("/register",{state:{email:_}})},L=()=>{c&&Ot("selectConversation"),o("/register")},E=r==="rtl"?Kn:Nr;e==="en"?t("languageHebrew","עברית"):t("languageEnglish","English");const M=[{icon:ns,title:t("privacyFirst","Privacy First"),desc:t("privacyDescription","Your privacy is our top priority. Control who sees your profile and what information you share.")},{icon:xa,title:t("secureTitle","Secure Communication"),desc:t("secureCommDescription","End‑to‑end encrypted messaging ensures your conversations remain private and secure.")},{icon:vo,title:t("matchTitle","Smart Matching"),desc:t("smartMatchingDescription","Our advanced algorithm connects you with people who match your preferences and interests.")}],I={"@context":"https://schema.org","@type":"WebSite",name:"Flirtss",url:"https://flirtss.com/",potentialAction:{"@type":"SearchAction",target:"https://flirtss.com/search?q={search_term_string}","query-input":"required name=search_term_string"}};return n.jsxs("div",{ref:h,className:`modern-home-page w-100 overflow-hidden ${i?"mobile-optimized":""}`,dir:r,children:[n.jsx(nr,{title:"Find Your Perfect Connection",description:"Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful relationships.",schema:I}),n.jsxs("section",{className:"hero-section animate-fade-in py-5 position-relative overflow-hidden",children:[n.jsxs("div",{className:"hero-bg-shapes",children:[n.jsx("div",{className:"shape shape-1"}),n.jsx("div",{className:"shape shape-2"}),n.jsx("div",{className:"shape shape-3"})]}),n.jsxs("div",{className:"hero-content mx-auto text-center p-4 max-w-lg position-relative z-2",children:[n.jsx("h1",{className:"animate-slide-up mb-4 text-shadow font-weight-bold gradient-hero-text",children:t("findYourConnection","Find Your Perfect Connection")}),n.jsx("p",{className:"animate-slide-up delay-200 mb-4 text-md opacity-90 line-height-relaxed",children:t("heroSubtitle","Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful encounters.")}),n.jsxs("form",{onSubmit:O,className:"email-signup-form d-flex gap-2 shadow-md rounded-lg overflow-hidden animate-slide-up delay-300 mx-auto max-w-md",children:[n.jsx("input",{type:"email",placeholder:t("emailPlaceholder","Enter your email"),className:"form-control border-0 py-3 flex-grow-1",value:_,onChange:v=>N(v.target.value),required:!0}),n.jsxs("button",{type:"submit",className:"btn btn-primary btn-lg d-flex align-items-center gap-2 transition-transform hover-scale",children:[n.jsx("span",{children:t("getStarted","Get Started")})," ",n.jsx(E,{})]})]})]})]}),n.jsx("section",{className:"online-users-section animate-fade-in py-5 my-4",children:n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"section-header text-center mb-5",children:[n.jsxs("h2",{className:"gradient-text animate-slide-up mb-3 d-flex align-items-center justify-content-center gap-2",children:[n.jsx(vo,{})," ",t("peopleOnlineNow","People Online Now")]}),n.jsx("p",{className:"section-subtitle animate-slide-up delay-100 text-opacity-80 max-w-md mx-auto",children:t("onlineNowSubtitle","Connect with these amazing people who are currently active on Mandarin")})]}),A?n.jsx("div",{className:"text-center py-5",children:n.jsx("div",{className:"spinner-border text-primary",role:"status",children:n.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):R?n.jsx("div",{className:"alert alert-danger",children:R}):n.jsx("div",{ref:a,className:`online-users-grid ${i?"swipe-enabled":""}`,children:g.map((v,b)=>{var B,$,x,z;return n.jsxs("div",{className:"online-user-card staggered-item shadow-sm rounded-lg overflow-hidden cursor-pointer transform-gpu hover-scale animated",onClick:L,style:{animationDelay:`${b*.1}s`},children:[n.jsxs("div",{className:"user-card-photo position-relative",children:[n.jsx("img",{src:(($=(B=v.photos)==null?void 0:B[0])==null?void 0:$.url)||"/default-avatar.png",alt:v.nickname,className:"w-100 h-100 object-cover",loading:"lazy",onError:G=>{G.target.src="/default-avatar.png"}}),v.isOnline&&n.jsx("div",{className:"user-status online position-absolute rounded-circle pulse-animation"})]}),n.jsxs("div",{className:"user-card-info p-3",children:[n.jsxs("h3",{className:"user-name mb-1 font-weight-medium text-truncate",children:[v.nickname,", ",((x=v.details)==null?void 0:x.age)||"?"]}),n.jsxs("p",{className:"user-location text-sm mb-2 d-flex align-items-center gap-1 text-opacity-70",children:[n.jsx(Ir,{})," ",((z=v.details)==null?void 0:z.location)||t("notSpecified","Not specified")]}),n.jsxs("div",{className:"user-actions d-flex gap-2 justify-content-end",children:[n.jsx("button",{className:"mini-action-btn like-btn d-flex align-items-center justify-content-center rounded-circle shadow-sm hover-scale",onClick:G=>{G.stopPropagation(),L()},"aria-label":t("like","Like"),children:n.jsx(Sd,{className:"action-icon"})}),n.jsx("button",{className:"mini-action-btn message-btn d-flex align-items-center justify-content-center rounded-circle shadow-sm hover-scale",onClick:G=>{G.stopPropagation(),L()},"aria-label":t("message","Message"),children:n.jsx(er,{className:"action-icon"})})]})]})]},v._id)})}),n.jsx("div",{className:"view-more-container animate-slide-up delay-400 text-center mt-5",children:n.jsxs("button",{className:"btn btn-secondary btn-lg d-inline-flex align-items-center gap-2",onClick:L,children:[t("joinToSeeMore","Join to See More")," ",n.jsx(E,{})]})})]})}),n.jsx("section",{className:"features-section animate-fade-in glass-effect py-5 my-4 mx-3",children:n.jsxs("div",{className:"container",children:[n.jsx("h2",{className:"gradient-text animate-slide-up mb-5 text-center",children:t("featuresTitle","Why Choose Mandarin")}),n.jsx("div",{className:"features-grid",children:M.map(({icon:v,title:b,desc:B},$)=>n.jsxs("div",{className:"feature-card animate-slide-up transition-all text-center",style:{animationDelay:`${$*.15}s`},children:[n.jsx("div",{className:"feature-icon-wrapper mb-4",children:n.jsx("div",{className:"feature-icon d-flex justify-content-center align-items-center mx-auto rounded-circle bg-primary-50",children:n.jsx(v,{})})}),n.jsx("h3",{className:"font-weight-medium mb-3",children:b}),n.jsx("p",{className:"text-opacity-70 line-height-relaxed",children:B})]},$))})]})})]})},hn=De.create("MessagesWrapper"),ro=({children:t})=>{const e=(p,_,N,g,C)=>!p||!_||!N||typeof ki!="function"?(hn.warn("setupGesturesWithRefs: Missing required elements or utilities"),null):ki({container:p,sidebar:_,chatArea:N,conversationList:g,refreshIndicator:C},{onSidebarShow:()=>{_&&_.classList.remove($e.hide),typeof Ot=="function"&&Ot("selectConversation")},onSidebarHide:()=>{_&&_.classList.add($e.hide),typeof Ot=="function"&&Ot("selectConversation")},onRefresh:async()=>{try{hn.info("Attempting to refresh conversations via wrapper..."),H.info("Refreshing conversations..."),await new Promise(P=>setTimeout(P,800)),typeof Ot=="function"&&Ot("send")}catch(P){hn.error("Error during refresh:",P),typeof Ot=="function"&&Ot("error")}},onRefreshStart:()=>{hn.info("Pull-to-refresh started")},onRefreshEnd:()=>{hn.info("Pull-to-refresh ended")}});Zt();const[s,r]=d.useState(!1),o=d.useRef(null),i=d.useRef(null),c=d.useRef(null),l=d.useRef(null),f=d.useRef(null),h=d.useRef(null);d.useEffect(()=>{if(typeof window<"u"){r(!Gc());const p=_=>{_.preventDefault(),window.deferredPrompt=_,Gc()||r(!0)};return window.addEventListener("beforeinstallprompt",p),()=>{window.removeEventListener("beforeinstallprompt",p)}}},[]),d.useEffect(()=>{const p=o.current,_=i.current,N=c.current,g=l.current,C=f.current;if(!p||typeof ki!="function")return;if(hn.debug("MessagesWrapper: Setting up gestures with refs:",{sidebarFound:!!_,chatAreaFound:!!N,conversationListFound:!!g,refreshIndicatorFound:!!C}),!_||!N){const R=setTimeout(()=>{hn.debug("MessagesWrapper: Retrying gesture setup after delay");const j=i.current,k=c.current;j&&k&&(hn.info("MessagesWrapper: Refs now available, setting up gestures"),e(o.current,j,k,l.current,f.current))},200);return()=>clearTimeout(R)}const A=e(p,_,N,g,C);let P=null;return h.current&&typeof Pr=="function"&&(P=Pr(h.current)),()=>{A&&A(),P&&P()}},[i.current,c.current,l.current,f.current,h.current]);const a=ct.useCallback(p=>{p.sidebarRef&&(i.current=p.sidebarRef.current),p.chatAreaRef&&(c.current=p.chatAreaRef.current),p.conversationsListRef&&(l.current=p.conversationsListRef.current),p.messagesAreaRef&&(h.current=p.messagesAreaRef.current),p.refreshIndicatorRef&&(f.current=p.refreshIndicatorRef.current)},[]);return n.jsx("div",{className:$e.appWrapper,ref:o,children:ct.Children.map(t,p=>ct.isValidElement(p)?typeof p.type=="string"?p:ct.cloneElement(p,{registerRefs:a}):p)})},Zd=({conversation:t,isActive:e=!1,currentUserId:s,onClick:r})=>{if(!t||!t.user)return console.warn("Invalid conversation object passed to ConversationItem"),null;const{user:o,lastMessage:i,unreadCount:c=0}=t;o.username||(console.debug(`Applying username fallback in ConversationItem for user ${o._id}`),o.username=o.nickname||"Unknown User");const l=c>0;return n.jsxs("div",{className:`${$e.conversationItem} ${e?$e.active:""}`,onClick:()=>r(t),role:"listitem","aria-selected":e,tabIndex:0,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&r(t)},children:[n.jsx(Rn,{user:o,size:"medium",borderActive:e,status:o.online?"online":"offline",showOnlineStatus:!0}),n.jsxs("div",{className:$e.conversationDetails,children:[n.jsxs("div",{className:$e.conversationHeader,children:[n.jsx("span",{className:$e.conversationName,children:o.nickname||o.username}),n.jsx("span",{className:$e.messageTime,children:i!=null&&i.createdAt?Jf(i.createdAt):""})]}),n.jsxs("div",{className:$e.messagePreview,children:[n.jsx("span",{className:$e.previewText,children:i?Yf(i,s):"No messages yet"}),l&&n.jsxs("div",{className:$e.unreadIndicator,children:[n.jsx(Im,{className:$e.unreadDot,"aria-hidden":"true"}),c>1&&n.jsx("span",{className:$e.unreadCount,"aria-label":`${c} unread messages`,children:c})]})]})]})]})};Zd.propTypes={conversation:w.shape({user:w.shape({_id:w.string.isRequired,username:w.string.isRequired,nickname:w.string,photo:w.string,online:w.bool}).isRequired,lastMessage:w.shape({content:w.string,createdAt:w.string,type:w.string,sender:w.string}),unreadCount:w.number}).isRequired,isActive:w.bool,currentUserId:w.string.isRequired,onClick:w.func.isRequired};const _j=ct.memo(Zd),eu=({conversations:t=[],activeConversation:e=null,onConversationSelect:s,onNewConversation:r,currentUserId:o,onRefresh:i,conversationsLoading:c=!1,conversationsListRef:l})=>{const f=d.useRef(null),h=a=>{f.current=a,l&&(l.current=a)};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:$e.conversationsHeader,children:[n.jsx("h2",{children:"Messages"}),n.jsx("button",{onClick:r,className:$e.newMessageBtn,"aria-label":"New conversation",title:"Start new conversation",type:"button",children:n.jsx(bd,{})})]}),n.jsx("div",{className:$e.conversationsList,ref:h,role:"list","aria-label":"Conversation list",children:t.length===0&&!c?n.jsxs("div",{className:$e.noConversations,children:[n.jsx(Gs,{size:24,"aria-hidden":"true"}),n.jsx("p",{children:"No conversations yet"}),n.jsx("button",{onClick:r,className:$e.startConversationBtn,type:"button",children:"Start a Conversation"})]}):t.map(a=>{var p;return!a||!a.user||!a.user._id?(console.warn("Skipping rendering invalid conversation item:",a),null):(a.user.username||(console.debug(`Applying username fallback for user ${typeof a.user._id=="string"?a.user._id:JSON.stringify(a.user._id)}`),a={...a,user:{...a.user,username:a.user.nickname||"Unknown User"}}),n.jsx(_j,{conversation:a,isActive:((p=e==null?void 0:e.user)==null?void 0:p._id)===a.user._id,currentUserId:o,onClick:s},a.user._id))})})]})};eu.propTypes={conversations:w.arrayOf(w.shape({user:w.shape({_id:w.string.isRequired,username:w.string.isRequired,nickname:w.string,photo:w.string,online:w.bool}).isRequired,lastMessage:w.shape({content:w.string,createdAt:w.string,type:w.string}),unreadCount:w.number})),activeConversation:w.object,onConversationSelect:w.func.isRequired,onNewConversation:w.func.isRequired,currentUserId:w.string.isRequired,onRefresh:w.func,conversationsLoading:w.bool,conversationsListRef:w.oneOfType([w.func,w.shape({current:w.any})])};const vj=ct.memo(eu),tu=({isVisible:t,onClose:e,onEmojiClick:s,customEmojis:r=null})=>{const o=d.useRef(null),i=r||Wd;return d.useEffect(()=>{const c=l=>{o.current&&!o.current.contains(l.target)&&!l.target.closest(`.${$e.emojiButton}`)&&e()};return t&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[t,e]),t?n.jsxs("div",{className:$e.emojiPicker,ref:o,role:"dialog","aria-label":"Emoji picker",children:[n.jsxs("div",{className:$e.emojiHeader,children:[n.jsx("h4",{children:"Select Emoji"}),n.jsx("button",{onClick:e,"aria-label":"Close emoji picker",type:"button",children:n.jsx(rs,{})})]}),n.jsx("div",{className:$e.emojiList,children:i.map(c=>n.jsx("button",{type:"button",onClick:()=>s(c),title:c,"aria-label":`Emoji ${c}`,children:c},c))})]}):null};tu.propTypes={isVisible:w.bool.isRequired,onClose:w.func.isRequired,onEmojiClick:w.func.isRequired,customEmojis:w.arrayOf(w.string)};const wj=ct.memo(tu),su=({onFileSelected:t,isUploading:e=!1,uploadProgress:s=0,showProgress:r=!1,acceptedFileTypes:o="*"})=>{const i=d.useRef(null),c=l=>{const f=l.target.files[0];f&&t(f),l.target.value=""};return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:i,onChange:c,style:{display:"none"},accept:o,"aria-label":"Upload file"}),r&&e&&n.jsxs("div",{className:$e.uploadProgressContainer,role:"progressbar","aria-valuenow":s,"aria-valuemin":"0","aria-valuemax":"100",children:[n.jsxs("div",{className:$e.uploadProgressLabel,children:[n.jsx(Ts,{className:"fa-spin"})," Uploading: ",Math.round(s),"%"]}),n.jsx("div",{className:$e.uploadProgressBar,children:n.jsx("div",{className:$e.uploadProgressFill,style:{width:`${s}%`}})})]})]})};su.propTypes={onFileSelected:w.func.isRequired,isUploading:w.bool,uploadProgress:w.number,showProgress:w.bool,acceptedFileTypes:w.string};const bj=ct.memo(su),nu=({userName:t=null})=>n.jsxs("div",{className:$e.typingIndicatorBubble,children:[n.jsxs("div",{className:$e.typingIndicator,children:[n.jsx("div",{className:$e.dot}),n.jsx("div",{className:$e.dot}),n.jsx("div",{className:$e.dot})]}),t&&n.jsxs("span",{className:$e.typingUserName,children:[t," is typing..."]})]});nu.propTypes={userName:w.string};const ru=({messages:t,currentUserId:e,messagesLoading:s=!1,isSending:r=!1,typingUser:o=null,isMobile:i=!1,onScroll:c,messagesEndRef:l})=>{const f=d.useRef(null),{t:h}=Pt(),a=d.useMemo(()=>({messageConversation:h("messageConversation")||"Message conversation",loadingMessages:h("loadingMessages")||"Loading messages",typing:h("typing")||"is typing"}),[h]);d.useEffect(()=>{if(l!=null&&l.current&&f.current){const _=f.current;_.scrollHeight-_.scrollTop-_.clientHeight<200&&l.current.scrollIntoView({behavior:"smooth"})}},[t,l]);const p=Array.isArray(t)?ua(t):{};return n.jsxs("div",{className:$e.messagesArea,ref:f,onScroll:c,role:"log","aria-live":"polite","aria-label":a.messageConversation||"Message conversation",children:[Object.entries(p).map(([_,N])=>n.jsxs("div",{className:$e.messageGroup,children:[n.jsx("div",{className:$e.dateSeparator,"aria-label":uc(_),children:uc(_)}),N.map(g=>n.jsx(Bo,{message:g,currentUserId:e,isSending:r},g._id||g.tempId))]},_)),o&&n.jsx(nu,{userName:o}),n.jsx("div",{ref:l,className:$e.messagesEnd,"aria-hidden":"true"})]})};ru.propTypes={messages:w.arrayOf(w.shape({_id:w.string,tempId:w.string,sender:w.string.isRequired,recipient:w.string,content:w.string,createdAt:w.string.isRequired,type:w.string.isRequired})).isRequired,currentUserId:w.string.isRequired,messagesLoading:w.bool,isSending:w.bool,typingUser:w.string,isMobile:w.bool,onScroll:w.func,messagesEndRef:w.oneOfType([w.func,w.shape({current:w.any})])};const xj=ct.memo(ru),qn=De.create("Messages"),nl=50,us=()=>Zi("system"),rl=()=>{var or,ir,ar,cr,lr,dr,ur,ve,qe,St,Ze,es;const{userId:t}=pu(),e=Zt(),{user:s,loading:r,isAuthenticated:o}=d.useContext(_a),{blockUser:i,reportUser:c,unblockUser:l}=_n(),{isUserBlocked:f,markBlockedUsers:h,fetchBlockedUsers:a,blockedUsers:p}=s1(),[_,N]=d.useState([]),[g,C]=d.useState(null),[A,P]=d.useState([]),[R,j]=d.useState(""),[k,F]=d.useState(!0),[O,L]=d.useState(!1),[E,M]=d.useState(null),[I,v]=d.useState(null),b=on(),{isTouch:B,isIOS:$,isAndroid:x}=tr(),[z,G]=d.useState(!0);d.useMemo(()=>s==null?void 0:s._id,[s==null?void 0:s._id]);const[Y,oe]=d.useState(!1),[le,ye]=d.useState(!1),[K,ae]=d.useState(null),[ue,we]=d.useState(null),[Pe,ce]=d.useState(!1),[de,me]=d.useState(0),[se,he]=d.useState(!1),[Ue,Me]=d.useState(!1),[ht,gt]=d.useState(!1),[He,wt]=d.useState(0),[ft,et]=d.useState(0),[Fe,it]=d.useState(0),[T,D]=d.useState(null),[re,fe]=d.useState(!1),[Re,ee]=d.useState(null),X=d.useRef(null),U=d.useRef(null),y=d.useRef(!1),u=d.useRef(null),m=d.useRef(null),S=d.useRef(null),q=d.useRef(null),J=d.useRef(null),Z=d.useRef(null),Se=d.useRef([]);d.useMemo(()=>["😊","😂","😍","❤️","👍","🙌","🔥","✨","🎉","🤔","😉","🥰"],[]),d.useEffect(()=>{Se.current=A,A.forEach(W=>{const ne=W._id||W.tempId;ne&&!nt.current.has(ne)&&nt.current.add(ne)}),nt.current.size>1e3&&Array.from(nt.current).slice(0,500).forEach(ne=>nt.current.delete(ne))},[A]);const tt=d.useRef(0),Ye=d.useRef({}),nt=d.useRef(new Set),at=d.useRef([]),Bs=d.useCallback(W=>{if(W.type==="system")return!1;const ne=W._id||W.tempId;if(!ne)return!1;if(nt.current.has(ne))return console.log("Duplicate message detected by ID:",ne),!0;if(W.type==="wink"&&W.content==="😉"){if(at.current.filter(Te=>Te.sender===W.sender&&Date.now()-Te.timestamp<6e4).length>0)return console.log("Duplicate wink detected by time window"),!0;at.current.push({sender:W.sender,recipient:W.recipient,timestamp:Date.now(),id:ne}),at.current=at.current.filter(Te=>Date.now()-Te.timestamp<3e5)}return nt.current.add(ne),nt.current.size>1e3&&Array.from(nt.current).slice(0,500).forEach(Te=>nt.current.delete(Te)),!1},[]);d.useEffect(()=>{if(typeof window>"u")return;const W=ne=>{ne.preventDefault(),window.deferredPrompt=ne,Me(!0)};return window.addEventListener("beforeinstallprompt",W),window.matchMedia("(display-mode: standalone)").matches&&Me(!1),()=>{typeof window<"u"&&window.removeEventListener("beforeinstallprompt",W)}},[]),d.useEffect(()=>{b?g&&G(!1):G(!0),it(0),D(null)},[b,g]),d.useEffect(()=>{if(r||!o||!(s!=null&&s._id)||y.current){!r&&!o&&(F(!1),M("Please log in to view messages."));return}if(typeof window<"u"){if(!window.__fileMessages){console.log("Initializing file URL caches"),window.__fileMessages={};try{const ne=localStorage.getItem("mandarin_file_urls");if(ne){const xe=JSON.parse(ne);xe&&typeof xe=="object"&&(window.__fileMessages=xe,console.log(`Restored ${Object.keys(xe).length} file URLs from localStorage`))}}catch(ne){console.warn("Failed to load persisted file URLs by ID",ne)}}if(!window.__fileMessagesByHash){window.__fileMessagesByHash={};try{const ne=localStorage.getItem("mandarin_file_urls_by_hash");if(ne){const xe=JSON.parse(ne);xe&&typeof xe=="object"&&(window.__fileMessagesByHash=xe,console.log(`Restored ${Object.keys(xe).length} file URLs by hash from localStorage`))}else if(window.__fileMessages&&Object.keys(window.__fileMessages).length>0){console.log("Building hash-based cache from ID-based cache");const xe=Te=>{if(!Te)return"";const Ke=Te.fileName||"",We=Te.timestamp?new Date(Te.timestamp).toISOString().substring(0,16):"";return`${Ke}-${We}`};Object.entries(window.__fileMessages).forEach(([Te,Ke])=>{if(Ke.url){const We=Ke.hash||xe(Ke);We&&(window.__fileMessagesByHash[We]={...Ke,id:Te})}});try{localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash)),console.log(`Created and persisted ${Object.keys(window.__fileMessagesByHash).length} hash-based URL entries`)}catch(Te){console.warn("Failed to persist hash-based file URLs",Te)}}}catch(ne){console.warn("Failed to load persisted file URLs by hash",ne)}}window.__fileUrlCleanupTimeout||(window.__fileUrlCleanupTimeout=setTimeout(()=>{try{if(window.__fileMessages&&Object.keys(window.__fileMessages).length>300){const ne=Object.entries(window.__fileMessages);ne.sort((xe,Te)=>(Te[1].timestamp||0)-(xe[1].timestamp||0)),window.__fileMessages=Object.fromEntries(ne.slice(0,300)),localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log(`Cleaned up file URL cache, kept ${Object.keys(window.__fileMessages).length} entries`)}if(window.__fileMessagesByHash&&Object.keys(window.__fileMessagesByHash).length>300){const ne=Object.entries(window.__fileMessagesByHash);ne.sort((xe,Te)=>(Te[1].timestamp||0)-(xe[1].timestamp||0)),window.__fileMessagesByHash=Object.fromEntries(ne.slice(0,300)),localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash))}window.__fileUrlCleanupTimeout=null}catch(ne){console.warn("Error during file URL cache cleanup",ne)}},3e4))}(async()=>{try{F(!0),M(null),await pt.initialize(s),y.current=!0,await ke()}catch(ne){console.error("Chat initialization error:",ne);const xe=ne.message||"Failed to initialize chat service.";M(xe+" Please refresh the page."),H.error(xe),y.current=!1}finally{F(!1)}})()},[s,o,r]),d.useEffect(()=>{if(!y.current||!(s!=null&&s._id)||typeof window>"u")return;const W=_e=>{var ka,Na,ja,Ta,Ea,Aa;if(qn.debug("Message received:",_e),Bs(_e)){qn.debug("Skipping duplicate message in handleMessageReceived");return}const Ft=Ee=>{const Lt=Ee.sender||"",Ut=Ee.recipient||"",Fs=(Ee.content||"").substring(0,200),Ks=Ee.createdAt?new Date(Ee.createdAt).getTime().toString().substring(0,11):"",Js=Ee.type||"",As=[];Ee.metadata&&(Ee.metadata.fileName&&As.push(`file:${Ee.metadata.fileName}`),Ee.metadata.fileSize&&As.push(`size:${Ee.metadata.fileSize}`),Ee.metadata.mimeType&&As.push(`mime:${Ee.metadata.mimeType}`),Ee.metadata.width&&Ee.metadata.height&&As.push(`dim:${Ee.metadata.width}x${Ee.metadata.height}`));const Vr=As.length?`:${As.join(":")}`:"";return`${Lt}:${Ut}:${Js}:${Ks}:${Fs}${Vr}`},hs=Ee=>{const Lt=Ee.sender||"",Ut=Ee.recipient||"",Fs=(Ee.content||"").substring(0,50),Ks=Ee.createdAt?Math.floor(new Date(Ee.createdAt).getTime()/1e4).toString():"",Js=Ee.type||"";return`${Lt}:${Ut}:${Js}:${Ks}:${Fs}`},is=(Ee=>{var Fs,Ks,Js;if(Ee._id&&Ee.sender&&Ee.recipient&&Ee.createdAt&&(Ee.content&&Ee.type==="text"||Ee.type==="file"&&Ee.metadata&&(Ee.metadata.url||Ee.metadata.fileUrl)))return Ee;let Lt=null,Ut=null;try{Lt=Ft(Ee),Ut=hs(Ee)}catch(As){console.warn("Couldn't create recovery hashes for message:",As)}return Ee.type==="file"&&Ee._id&&typeof window<"u"&&window.__fileMessages&&((Fs=window.__fileMessages[Ee._id])!=null&&Fs.url?(console.log(`Recovered file URL for message ${Ee._id} from cache`),Ee.metadata||(Ee.metadata={}),Ee.metadata.url=window.__fileMessages[Ee._id].url,Ee.metadata.fileUrl=window.__fileMessages[Ee._id].url):Lt&&((Ks=window.__fileMessages[`hash:${Lt}`])!=null&&Ks.url)?(console.log(`Recovered file URL for message using precise hash ${Lt}`),Ee.metadata||(Ee.metadata={}),Ee.metadata.url=window.__fileMessages[`hash:${Lt}`].url,Ee.metadata.fileUrl=window.__fileMessages[`hash:${Lt}`].url):Ut&&((Js=window.__fileMessages[`fuzzy:${Ut}`])!=null&&Js.url)&&(console.log(`Recovered file URL for message using fuzzy hash ${Ut}`),Ee.metadata||(Ee.metadata={}),Ee.metadata.url=window.__fileMessages[`fuzzy:${Ut}`].url,Ee.metadata.fileUrl=window.__fileMessages[`fuzzy:${Ut}`].url)),Ee.createdAt||(Ee.createdAt=new Date().toISOString()),Ee.status||(Ee.status="sent"),Ee})(_e);if(((ka=is.metadata)!=null&&ka.url&&!((Na=_e.metadata)!=null&&Na.url)||(ja=is.metadata)!=null&&ja.fileUrl&&!((Ta=_e.metadata)!=null&&Ta.fileUrl))&&(console.log("Using recovered version of message with repaired file URLs"),_e=is),_e.type==="file"&&window.__lastUploadedFile){const Ee=window.__lastUploadedFile,Lt=((Ea=_e.metadata)==null?void 0:Ea.url)||((Aa=_e.metadata)==null?void 0:Aa.fileUrl);Lt&&Lt===Ee.url&&(console.log("Identified message for the file we just uploaded",Ee.id),window.__lastUploadedFile=null)}if(_e.sender!==s._id){const Ee=new Audio("/sounds/call-connect.mp3");Ee.volume=.5,Ee.play().catch(Lt=>{console.log("Couldn't play primary notification sound, trying fallback:",Lt);const Ut=new Audio("/notification.mp3");Ut.volume=.5,Ut.play().catch(Fs=>console.log("Couldn't play fallback notification sound:",Fs))})}const Yo=_e.sender===s._id?_e.recipient:_e.sender;g&&g.user._id===Yo?(P(Ee=>{var Ks,Js,As,Vr;const Lt=Ft(_e),Ut=hs(_e);if(_e.sender===s._id){console.log("Checking own sent message for duplicates",_e);const At=Ee.filter(Tt=>{var $t,xs;return Tt.tempId&&Tt.sender===s._id&&Tt.type===_e.type&&(Tt.type==="text"&&Tt.content===_e.content||Tt.type==="wink"&&Tt.content===_e.content||Tt.type==="file"&&(($t=Tt.metadata)==null?void 0:$t.fileName)===((xs=_e.metadata)==null?void 0:xs.fileName))&&Math.abs(new Date(Tt.createdAt)-new Date(_e.createdAt))<3e4});if(At.length>0){console.log("Found optimistic message matches:",At.length);const Tt=Ee.findIndex($t=>$t.tempId===At[0].tempId);if(Tt!==-1){console.log("Replacing optimistic message with server message");const $t=[...Ee];if($t[Tt]=_e,At.length>1){const xs=At.slice(1).map(Ss=>Ss.tempId);return $t.filter(Ss=>!Ss.tempId||!xs.includes(Ss.tempId)).sort((Ss,ln)=>new Date(Ss.createdAt)-new Date(ln.createdAt))}return $t}}}let Fs=Ee.some(At=>At._id===_e._id||_e.tempId&&At.tempId===_e.tempId?(console.log("Exact ID match found, skipping duplicate"),!0):Ft(At)===Lt?(console.log("Precise hash match detected, treating as duplicate",{existing:At._id,new:_e._id,hash:Lt}),!0):At.sender===_e.sender&&At.content===_e.content&&At.type===_e.type&&Math.abs(new Date(At.createdAt)-new Date(_e.createdAt))<3e4?(console.log("Content+time match detected, treating as duplicate",{existing:At._id,new:_e._id}),!0):At.type==="wink"&&_e.type==="wink"&&At.sender===_e.sender&&At.content===_e.content&&Math.abs(new Date(At.createdAt)-new Date(_e.createdAt))<6e4?(console.log("Wink duplicate detected (within 60s window)"),!0):!1);if(_e.type==="file"&&((Ks=_e.metadata)!=null&&Ks.url||(Js=_e.metadata)!=null&&Js.fileUrl)){if(console.log("Processing file message:",_e._id),Ee.some(Tt=>Tt._id===_e._id||Ft(Tt)===Lt||hs(Tt)===Ut))return console.log("Match found (ID or hash), skipping duplicate file message"),Ee;if(_e.sender===s._id){const Tt=Ee.findIndex($t=>{var xs,Ss,ln;return $t.tempId&&$t.tempId===_e.tempId||$t.type==="file"&&((xs=$t.metadata)==null?void 0:xs.__localPlaceholder)===!0&&$t.sender===s._id&&Math.abs(new Date($t.createdAt)-new Date(_e.createdAt))<6e4&&(((Ss=$t.metadata)==null?void 0:Ss.fileName)===((ln=_e.metadata)==null?void 0:ln.fileName)||$t.content===_e.content)});if(Tt>=0){console.log("Replacing placeholder with real file message:",_e._id);const $t=_e.metadata.url||_e.metadata.fileUrl,xs=[...Ee];xs[Tt]={..._e,_id:_e._id,tempId:null,metadata:{..._e.metadata,fileUrl:$t,url:$t,serverUrl:$t,__localPlaceholder:!1,__messageHash:Lt,__fuzzyHash:Ut}};const Ss=Ee[Tt];if((Vr=(As=Ss.metadata)==null?void 0:As.fileUrl)!=null&&Vr.startsWith("blob:"))try{URL.revokeObjectURL(Ss.metadata.fileUrl),console.log("Revoked blob URL for replaced message")}catch(ln){console.warn("Error revoking URL:",ln)}if(typeof window<"u"&&$t){window.__fileMessages||(window.__fileMessages={}),_e._id&&(window.__fileMessages[_e._id]={url:$t,timestamp:Date.now(),messageHash:Lt,fuzzyHash:Ut}),window.__fileMessages[`hash:${Lt}`]={url:$t,timestamp:Date.now(),messageId:_e._id},window.__fileMessages[`fuzzy:${Ut}`]={url:$t,timestamp:Date.now(),messageId:_e._id};try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log(`Cached file URL for ${_e._id} in localStorage with hash backup`)}catch(ln){console.warn("Failed to persist file URL to localStorage",ln)}}return console.log("Updated file message with actual server data"),xs}}console.log("New file message received, adding to messages");const At={..._e,metadata:{..._e.metadata,fileUrl:_e.metadata.url||_e.metadata.fileUrl,url:_e.metadata.url||_e.metadata.fileUrl,serverUrl:_e.metadata.url||_e.metadata.fileUrl,__processed:!0,__messageHash:Lt,__fuzzyHash:Ut}};if(typeof window<"u"){if(window.__fileMessages||(window.__fileMessages={}),At._id&&(window.__fileMessages[At._id]={url:At.metadata.fileUrl,timestamp:Date.now(),messageHash:Lt,fuzzyHash:Ut}),window.__fileMessages[`hash:${Lt}`]={url:At.metadata.fileUrl,timestamp:Date.now(),messageId:At._id},window.__fileMessages[`fuzzy:${Ut}`]={url:At.metadata.fileUrl,timestamp:Date.now(),messageId:At._id},Object.keys(window.__fileMessages).length>150){const Tt=Object.entries(window.__fileMessages);Tt.sort(($t,xs)=>xs[1].timestamp-$t[1].timestamp),window.__fileMessages=Object.fromEntries(Tt.slice(0,75))}try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log(`Persisted ${Object.keys(window.__fileMessages).length} file URLs to localStorage (with hash redundancy)`)}catch(Tt){console.warn("Failed to persist file URLs to localStorage",Tt)}}return[...Ee,At].sort((Tt,$t)=>new Date(Tt.createdAt)-new Date($t.createdAt))}return Fs?(console.log("Skipping duplicate message:",_e._id),Ee):(b&&"vibrate"in navigator&&navigator.vibrate(50),[...Ee,_e].sort((At,Tt)=>new Date(At.createdAt)-new Date(Tt.createdAt)))}),pt.markConversationRead(g.user._id)):b&&"Notification"in window&&Notification.permission==="granted"?new Notification("New message",{body:`New message from ${_e.senderName||"a user"}`,icon:"/icon-192x192.png"}):"Notification"in window&&Notification.permission!=="denied"&&H.info(`New message from ${_e.senderName||"a user"}`),Es(_e)},ne=_e=>{g&&_e.userId===g.user._id&&(v(_e.userId),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>v(null),3e3))},xe=_e=>{_e.connected?H.success("Reconnected to chat server",{autoClose:2e3}):H.warning("Disconnected from chat server. Trying to reconnect...")},Te=_e=>{if(!g||_e.userId!==g.user._id)return;console.debug(`Received incoming call from ${_e.userId}`),ae({callId:_e.callId,callerName:g.user.nickname,callerId:_e.userId,timestamp:_e.timestamp}),b&&"vibrate"in navigator&&navigator.vibrate([300,100,300]);const Ft={_id:us(),sender:"system",content:`${g.user.nickname} is calling you.`,createdAt:new Date().toISOString(),type:"system"};P(hs=>[...hs,Ft])},Ke=_e=>{if(!g||_e.userId!==g.user._id)return;console.debug(`Call accepted by ${g.user.nickname}`);const Ft={_id:us(),sender:"system",content:`${g.user.nickname} accepted your call.`,createdAt:new Date().toISOString(),type:"system"};P(hs=>[...hs,Ft]),H.success(`${g.user.nickname} accepted your call`)},We=_e=>{if(!g||_e.userId!==g.user._id)return;console.debug(`Call declined by ${g.user.nickname}`);const Ft={_id:us(),sender:"system",content:`${g.user.nickname} declined your call.`,createdAt:new Date().toISOString(),type:"system"};P(hs=>[...hs,Ft]),ye(!1),H.info(`${g.user.nickname} declined your call`)},yt=_e=>{!g||_e.userId!==g.user._id||(console.debug(`Call hung up by ${g.user.nickname}`),le&&On())},Bt=pt.on("messageReceived",W),Yt=pt.on("userTyping",ne),st=pt.on("connectionChanged",xe),bt=Ne.on("incomingCall",Te),Ct=Ne.on("callAccepted",Ke),_t=Ne.on("callDeclined",We),ts=Ne.on("videoHangup",yt);return b&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission(),()=>{Bt(),Yt(),st(),bt(),Ct(),_t(),ts(),u.current&&clearTimeout(u.current)}},[g,s==null?void 0:s._id,le,b,Bs]),d.useEffect(()=>{if(y.current&&t&&_.length>0){const W=_.find(ne=>ne.user._id===t);W&&(!g||g.user._id!==W.user._id)?rr(W):!W&&t!==(s==null?void 0:s._id)&&Ge(t)}},[t,_,s==null?void 0:s._id,g,e]),d.useEffect(()=>{var ne;if(!((ne=g==null?void 0:g.user)!=null&&ne._id)||!(s!=null&&s._id)){P([]);return}if(J.current===g.user._id)return;console.log(`Loading messages for user: ${g.user._id} (previous: ${J.current})`);const W=g.user._id;return J.current=W,L(!0),(async()=>{var xe;try{await Xe(W),t!==W&&e(`/messages/${W}`,{replace:!0}),Fr(W),(xe=U.current)==null||xe.focus(),b&&G(!1)}catch(Te){console.error("Error in loading messages:",Te),M(`Failed to load messages: ${Te.message||"Unknown error"}`)}finally{J.current===W&&L(!1)}})(),()=>{console.log(`Cleanup for messages loading. Current: ${J.current}`)}},[(or=g==null?void 0:g.user)==null?void 0:or._id,s==null?void 0:s._id]),d.useEffect(()=>{const W=setTimeout(()=>{var ne;(ne=X.current)==null||ne.scrollIntoView({behavior:"smooth"})},100);return()=>clearTimeout(W)},[A]),d.useMemo(()=>{const W=new Set;return A.filter(ne=>{const xe=ne._id||ne.tempId;return!xe||W.has(xe)?!1:(W.add(xe),!0)})},[A]),d.useEffect(()=>{var W;if((W=g==null?void 0:g.user)!=null&&W._id){const ne=f(g.user._id);ne!==g.user.isBlocked&&C(xe=>xe&&{...xe,user:{...xe.user,isBlocked:ne}})}},[p,f,g]);const gs=d.useCallback(W=>{if(!S.current)return;const ne=W.touches[0].clientY,xe=W.touches[0].clientX;wt(ne),et(xe),S.current.scrollTop<=0?gt(!0):gt(!1)},[]),an=d.useCallback(W=>{var We;if(!q.current)return;const ne=W.touches[0].clientY,xe=W.touches[0].clientX,Te=ne-He,Ke=xe-ft;if(ht&&Te>0&&((We=S.current)==null?void 0:We.scrollTop)<=0){const yt=Math.min(Te*.5,80);it(yt),Z.current&&(Z.current.style.transform=`translateY(${yt}px)`,Z.current.style.opacity=`${Math.min(yt/50,1)}`),W.preventDefault()}else ht&&Te<=0&&(gt(!1),it(0),Z.current&&(Z.current.style.transform="translateY(0)",Z.current.style.opacity="0"));Math.abs(Ke)>Math.abs(Te)&&Math.abs(Ke)>10&&!ht&&(Ke>nl&&!z?D("right"):Ke<-50&&z&&D("left"))},[ht,He,ft,z,nl]),be=async W=>{if(ht&&Fe>50){Z.current&&(Z.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",Z.current.style.transform="translateY(40px)",Z.current.style.opacity="1");try{await ke(),Z.current&&Z.current.classList.add($e.refreshSuccess)}catch(ne){console.error("Error refreshing conversations:",ne),Z.current&&Z.current.classList.add($e.refreshError)}finally{setTimeout(()=>{Z.current&&(Z.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",Z.current.style.transform="translateY(0)",Z.current.style.opacity="0",Z.current.classList.remove($e.refreshSuccess,$e.refreshError)),gt(!1),it(0)},600)}}else ht&&(Z.current&&(Z.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",Z.current.style.transform="translateY(0)",Z.current.style.opacity="0"),gt(!1),it(0));T==="right"?G(!0):T==="left"&&G(!1),D(null)},ke=d.useCallback(async()=>{if(s!=null&&s._id)try{await a();const ne=(await pt.getConversations()).filter(Te=>{var Ke;return((Ke=Te==null?void 0:Te.user)==null?void 0:Ke._id)&&Te.user._id!==s._id}),xe=h(ne);if(N(xe),g&&g.user&&g.user._id){const Te=xe.find(Ke=>Ke.user._id===g.user._id);Te&&C(Te)}t&&!ne.find(Te=>Te.user._id===t)&&t!==s._id&&Ge(t)}catch(W){console.error("Error fetching conversations:",W),H.error("Failed to load conversations")}},[s==null?void 0:s._id,t]),Ge=d.useCallback(async W=>{var ne,xe,Te,Ke;if(!W||W===(s==null?void 0:s._id)){console.warn("Attempted to load own user details or null ID"),W===(s==null?void 0:s._id)&&e("/messages",{replace:!0});return}try{if(L(!0),!/^[0-9a-fA-F]{24}$/.test(W)){console.error("Invalid user ID format:",W),H.error("Invalid User ID provided."),e("/messages",{replace:!0});return}const yt=((ne=pt.getAuthToken)==null?void 0:ne.call(pt))||(typeof window<"u"?localStorage.getItem("token"):null)||(typeof window<"u"?sessionStorage.getItem("token"):null)||(typeof window<"u"?localStorage.getItem("authToken"):null)||(typeof window<"u"?sessionStorage.getItem("authToken"):null);yt||console.warn("No authentication token found for loading user details");const Bt={"Content-Type":"application/json"};yt&&(Bt.Authorization=`Bearer ${yt}`);const Yt=await Ae.get(`/users/${W}`);if(!Yt.success){qn.warn(`API error fetching user ${W}.`);let bt="Could not find or load user details.";Yt.status===404&&(bt=`User not found (${W}).`),H.error(bt),e("/messages",{replace:!0}),M(bt);return}const st=((xe=Yt.data)==null?void 0:xe.user)||Yt.user||Yt.data||Yt;if(st!=null&&st._id){const bt={user:{_id:st._id,nickname:st.nickname||st.name||"Unknown User",photo:((Ke=(Te=st.photos)==null?void 0:Te[0])==null?void 0:Ke.url)||st.photo||null,isOnline:st.isOnline||!1,accountTier:st.accountTier||"FREE"},lastMessage:null,unreadCount:0};N(Ct=>{const _t=Ct.findIndex(ts=>ts.user._id===W);if(_t>-1){const ts=[...Ct];return ts[_t]={...ts[_t],user:bt.user},ts}else return[bt,...Ct]}),C(bt),P([]),M(null)}else throw new Error("User data not found in API response")}catch(We){console.error(`Error loading user details for ${W}:`,We);let yt="Could not load user details.";We.message.includes("API request failed")?yt=`Could not retrieve user information. ${We.message}`:We.message==="User data not found in API response"&&(yt=`User details format error for ${W}.`),M(yt),H.error(yt)}finally{L(!1)}},[s==null?void 0:s._id,e]),Xe=d.useCallback(async W=>{if(!(s!=null&&s._id)||!W||W===s._id){console.warn("Attempted to load messages with self or invalid partner ID"),P([]);return}if(!/^[0-9a-fA-F]{24}$/.test(W)){console.error(`Invalid partner user ID format: ${W}`),H.error("Cannot load messages: Invalid user ID format"),P([]),M("Cannot load messages for this user (Invalid ID).");return}const xe=W;try{console.log(`Fetching messages for ${W}`);const Te=await pt.getMessages(W);if(J.current!==xe){console.log(`User changed during message fetch. Abandoning results for ${xe}`);return}console.log(`Loaded ${Te.length} messages for ${W}`);const Ke=Te.map(We=>{if(We.type==="file"&&We.metadata){let yt=null;typeof window<"u"&&window.__fileMessages&&We._id&&window.__fileMessages[We._id]&&(yt=window.__fileMessages[We._id].url,console.log(`Found cached URL for file message ${We._id}`));const Bt=yt||We.metadata.serverUrl||We.metadata.url||We.metadata.fileUrl;if(Bt&&!yt&&typeof window<"u"&&We._id){window.__fileMessages||(window.__fileMessages={}),window.__fileMessages[We._id]={url:Bt,timestamp:Date.now()},console.log(`Added URL for file message ${We._id} to cache`);try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages))}catch(Yt){console.warn("Failed to persist file URLs to localStorage",Yt)}}return{...We,metadata:{...We.metadata,fileUrl:Bt,url:Bt,serverUrl:Bt,__processed:!0}}}return We});P(Ke.sort((We,yt)=>new Date(We.createdAt)-new Date(yt.createdAt))),M(null)}catch(Te){if(J.current!==xe)return;console.error("Error fetching messages:",Te);const Ke=`Failed to load messages. ${Te.message||"Server error"}`;H.error(Ke),M(Ke),P([])}},[s==null?void 0:s._id]),Rt=async()=>{var Yt,st;const W=R.trim();if(!W||!g||!(s!=null&&s._id))return;if(g.user._id===s._id){H.error("Cannot send messages to yourself");return}if(g.user.isBlocked||f(g.user._id)){H.error("Cannot send messages to a blocked user");return}const ne=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(ne)){H.error("Cannot send message: Invalid recipient ID format."),console.error("Attempted to send message to invalid ID format:",ne);return}if((s==null?void 0:s.accountTier)==="FREE"&&W!=="😉"){H.error("Free accounts can only send winks. Upgrade to send messages.");return}const xe=Date.now(),Te=`text:${ne}:${W}`,Ke=Ye.current[Te];if(Ke&&xe-Ke.timestamp<5e3){H.info("Please wait a moment before sending the same message again");return}Ye.current[Te]={type:"text",content:W,recipient:ne,timestamp:xe},Object.keys(Ye.current).filter(bt=>xe-Ye.current[bt].timestamp>6e4).forEach(bt=>delete Ye.current[bt]);const yt=`temp-${Date.now()}`,Bt={_id:yt,tempId:yt,sender:s._id,recipient:ne,content:W,createdAt:new Date().toISOString(),type:"text",read:!1,senderName:s.nickname,senderPhoto:((st=(Yt=s.photos)==null?void 0:Yt[0])==null?void 0:st.url)||s.photo};P(bt=>[...bt,Bt].sort((Ct,_t)=>new Date(Ct.createdAt)-new Date(_t.createdAt))),Es(Bt),j(""),he(!0),U.current&&(U.current.style.height="auto"),b&&"vibrate"in navigator&&navigator.vibrate(20);try{const bt=await pt.sendMessage(ne,W);Se.current.find(_t=>_t._id&&!_t.tempId&&_t.type==="text"&&_t.sender===s._id&&_t.recipient===ne&&_t.content===W&&Math.abs(new Date(_t.createdAt)-new Date(Bt.createdAt))<5e3)?(console.log("Server text message already exists, removing optimistic message"),P(_t=>_t.filter(ts=>ts.tempId!==yt))):P(_t=>[..._t.filter(_e=>_e.tempId!==yt),bt].sort((_e,Ft)=>new Date(_e.createdAt)-new Date(Ft.createdAt))),Es(bt)}catch(bt){console.error("Error sending message:",bt),H.error(`Failed to send message: ${bt.message||"Please try again."}`),P(Ct=>Ct.filter(_t=>_t.tempId!==yt)),P(Ct=>[...Ct,{...Bt,error:!0,content:`${W} (Failed)`}].sort((_t,ts)=>new Date(_t.createdAt)-new Date(ts.createdAt))),Es({...Bt,error:!0})}finally{he(!1)}},Je=async()=>{var Bt,Yt;if(!g||!(s!=null&&s._id)||se)return;if(g.user._id===s._id){H.error("Cannot send winks to yourself");return}if(g.user.isBlocked||f(g.user._id)){H.error("Cannot send winks to a blocked user");return}const W=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(W)){H.error("Cannot send wink: Invalid recipient ID format."),console.error("Attempted to send wink to invalid ID format:",W);return}const ne=Date.now();if(ne-tt.current<5e3){H.info("Please wait a moment before sending another wink");return}tt.current=ne;const Te=`wink:${W}:${ne}`;Ye.current[Te]={type:"wink",content:"😉",recipient:W,timestamp:ne},Object.keys(Ye.current).filter(st=>ne-Ye.current[st].timestamp>6e4).forEach(st=>delete Ye.current[st]),he(!0);const We=`temp-wink-${Date.now()}`,yt={_id:We,tempId:We,sender:s._id,recipient:W,content:"😉",createdAt:new Date().toISOString(),type:"wink",read:!1,senderName:s.nickname,senderPhoto:((Yt=(Bt=s.photos)==null?void 0:Bt[0])==null?void 0:Yt.url)||s.photo};P(st=>[...st,yt].sort((bt,Ct)=>new Date(bt.createdAt)-new Date(Ct.createdAt))),Es(yt),b&&"vibrate"in navigator&&navigator.vibrate([20,30,20]);try{const st=await pt.sendMessage(W,"😉","wink");Se.current.find(Ct=>Ct._id&&!Ct.tempId&&Ct.type==="wink"&&Ct.sender===s._id&&Ct.recipient===W&&Math.abs(new Date(Ct.createdAt)-new Date(yt.createdAt))<5e3)?(console.log("Server wink message already exists, removing optimistic message"),P(Ct=>Ct.filter(_t=>_t.tempId!==We))):P(Ct=>[...Ct.filter(ts=>ts.tempId!==We),st].sort((ts,_e)=>new Date(ts.createdAt)-new Date(_e.createdAt))),Es(st)}catch(st){console.error("Error sending wink:",st),H.error(`Failed to send wink: ${st.message||"Please try again."}`),P(bt=>bt.filter(Ct=>Ct.tempId!==We)),P(bt=>[...bt,{...yt,error:!0,content:"😉 (Failed)"}].sort((Ct,_t)=>new Date(Ct.createdAt)-new Date(_t.createdAt))),Es({...yt,error:!0})}finally{he(!1)}},Jt=d.useCallback(()=>{if((s==null?void 0:s.accountTier)==="FREE")return H.error("Free accounts cannot send files. Upgrade to send files.");const W=document.querySelector('input[type="file"]');W&&W.click()},[s==null?void 0:s.accountTier]),Ln=d.useCallback(()=>{we(null),me(0),ce(!1),m.current&&(m.current.value="")},[]),dt=async()=>{var Te,Ke,We,yt,Bt,Yt;if(!ue||!((Te=g==null?void 0:g.user)!=null&&Te._id)||Pe)return;if(g.user._id===s._id){H.error("Cannot send files to yourself");return}if(g.user.isBlocked||f(g.user._id)){H.error("Cannot send files to a blocked user");return}const W=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(W)){H.error("Cannot send file: Invalid recipient ID format."),console.error("Attempted to send file to invalid ID format:",W);return}if((s==null?void 0:s.accountTier)==="FREE"){H.error("Free accounts cannot send files. Upgrade to send files.");return}ce(!0),me(10),b&&"vibrate"in navigator&&navigator.vibrate(40);const ne=`temp-file-${Date.now()}`,xe={_id:ne,tempId:ne,sender:s._id,recipient:W,content:ue.name,createdAt:new Date().toISOString(),type:"file",read:!1,metadata:{fileName:ue.name,fileType:ue.type,fileSize:ue.size,__localPlaceholder:!0,fileUrl:ue.type.startsWith("image/")?URL.createObjectURL(ue):null,url:ue.type.startsWith("image/")?URL.createObjectURL(ue):null},senderName:s.nickname,senderPhoto:((We=(Ke=s.photos)==null?void 0:Ke[0])==null?void 0:We.url)||s.photo};P(st=>[...st,xe].sort((bt,Ct)=>new Date(bt.createdAt)-new Date(Ct.createdAt)));try{const st=new XMLHttpRequest,bt=new FormData;bt.append("file",ue),bt.append("recipient",W);const _t=await new Promise((_e,Ft)=>{var cn;st.upload.onprogress=is=>{if(is.lengthComputable){const Yo=Math.round(is.loaded/is.total*90)+10;me(Yo)}},st.open("POST","/api/messages/attachments",!0);const hs=((cn=pt.getAuthToken)==null?void 0:cn.call(pt))||(typeof window<"u"?localStorage.getItem("token"):null)||(typeof window<"u"?sessionStorage.getItem("token"):null)||(typeof window<"u"?localStorage.getItem("authToken"):null)||(typeof window<"u"?sessionStorage.getItem("authToken"):null);hs?st.setRequestHeader("Authorization",`Bearer ${hs}`):console.warn("No auth token found for file upload request."),st.onload=()=>{if(st.status>=200&&st.status<300)try{const is=JSON.parse(st.responseText);is.success&&is.data?_e(is.data):Ft(new Error(is.error||"Upload processing failed"))}catch(is){Ft(new Error(`Invalid response format: ${is.message}`))}else Ft(new Error(`Upload failed: ${st.status} ${st.statusText}`))},st.onerror=()=>Ft(new Error("Network error during upload")),st.ontimeout=()=>Ft(new Error("Upload timed out")),st.timeout=6e4,st.send(bt)});if(me(100),typeof window<"u"){window.__lastUploadedFile={id:ne,url:_t.url,fileName:ue.name,timestamp:Date.now()},setTimeout(()=>{window.__lastUploadedFile&&window.__lastUploadedFile.id===ne&&(window.__lastUploadedFile=null)},6e4),window.__fileMessages||(window.__fileMessages={}),window.__fileMessages[ne]={url:_t.url,timestamp:Date.now()};try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log("Persisted uploaded file URL to localStorage")}catch(_e){console.warn("Failed to persist file URL to localStorage",_e)}}((yt=Se.current)==null?void 0:yt.find(_e=>_e._id&&!_e.tempId&&_e.type==="file"&&_e.sender===s._id&&_e.recipient===W&&Math.abs(new Date(_e.createdAt)-new Date(xe.createdAt))<5e3))?(console.log("Server message already exists, replacing optimistic message"),P(_e=>_e.filter(Ft=>Ft.tempId!==ne))):P(_e=>{const Ft=_e.filter(cn=>!cn.tempId||cn.tempId!==ne),hs={...xe,metadata:{...xe.metadata,fileUrl:_t.url,url:_t.url,__localPlaceholder:!1,serverUrl:_t.url}};return[...Ft,hs].sort((cn,is)=>new Date(cn.createdAt)-new Date(is.createdAt))}),Es({...xe,metadata:{...xe.metadata,fileUrl:_t.url,url:_t.url,serverUrl:_t.url,__localPlaceholder:!1}}),H.success("File uploaded successfully. Sending message..."),we(null),me(0),m.current&&(m.current.value=""),b&&"vibrate"in navigator&&navigator.vibrate([30,50,30])}catch(st){console.error("Failed to upload or send file:",st),H.error(st.message||"Failed to send file. Please try again."),P(bt=>bt.filter(Ct=>Ct.tempId!==ne)),(Yt=(Bt=xe.metadata)==null?void 0:Bt.fileUrl)!=null&&Yt.startsWith("blob:")&&URL.revokeObjectURL(xe.metadata.fileUrl),P(bt=>[...bt,{...xe,error:!0,content:`${ue.name} (Upload Failed)`}].sort((Ct,_t)=>new Date(Ct.createdAt)-new Date(_t.createdAt))),b&&"vibrate"in navigator&&navigator.vibrate([100,50,100])}finally{ce(!1)}};d.useCallback(W=>{j(ne=>ne+W),oe(!1),U.current&&U.current.focus(),b&&"vibrate"in navigator&&navigator.vibrate(20)},[b]);const Ie=async()=>{if(!g||!(s!=null&&s._id))return;if(!Ne.isConnected||!Ne.isConnected()){const ne={_id:us(),sender:"system",content:"Cannot start call: connection issue. Please refresh and try again.",createdAt:new Date().toISOString(),type:"system",error:!0};P(xe=>[...xe,ne]),console.error("Cannot initiate call - socket not connected");return}if(!g.user.isOnline){const ne={_id:us(),sender:"system",content:`${g.user.nickname} is currently offline. You can only call users who are online.`,createdAt:new Date().toISOString(),type:"system",error:!0};P(xe=>[...xe,ne]);return}if((s==null?void 0:s.accountTier)==="FREE"){const ne={_id:us(),sender:"system",content:"Free accounts cannot make video calls. Upgrade for video calls.",createdAt:new Date().toISOString(),type:"system",error:!0};P(xe=>[...xe,ne]);return}const W=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(W)){const ne={_id:us(),sender:"system",content:"Cannot start call: Invalid recipient ID.",createdAt:new Date().toISOString(),type:"system",error:!0};P(xe=>[...xe,ne]),console.error("Cannot initiate call - invalid recipient ID:",W);return}try{const ne={_id:us(),sender:"system",content:`Initiating call to ${g.user.nickname}...`,createdAt:new Date().toISOString(),type:"system"};P(Te=>[...Te,ne]),ye(!0),b&&"vibrate"in navigator&&navigator.vibrate([50,100,50]),await Ne.initiateVideoCall(W);const xe={_id:us(),sender:"system",content:`Calling ${g.user.nickname}... Waiting for response.`,createdAt:new Date().toISOString(),type:"system"};P(Te=>[...Te,xe]),console.debug("Call initiation request sent successfully for user:",W)}catch(ne){console.error("Video call initiation error:",ne);const xe={_id:us(),sender:"system",content:`Call failed to initiate: ${ne.message||"Could not start video call. Please try again."}`,createdAt:new Date().toISOString(),type:"system",error:!0};P(Te=>[...Te,xe]),ye(!1)}},On=d.useCallback(()=>{if(console.log("handleEndCall triggered. isCallActive:",le,"Active Convo:",g),g){const W=g.user._id;le&&/^[0-9a-fA-F]{24}$/.test(W)?(console.log("Emitting videoHangup to:",W),Ne.emit("videoHangup",{recipientId:W})):le&&console.warn("Cannot emit hangup for invalid partner ID:",W);const ne={_id:us(),sender:"system",content:"Video call ended.",createdAt:new Date().toISOString(),type:"system"};P(xe=>[...xe,ne])}else console.log("handleEndCall: No active conversation.");ye(!1),ae(null),b&&"vibrate"in navigator&&navigator.vibrate(100)},[g,le,b]),Es=d.useCallback(W=>{if(!(s!=null&&s._id)||!W)return;const ne=W.sender===s._id?W.recipient:W.sender;if(!ne||ne===s._id||!/^[0-9a-fA-F]{24}$/.test(ne)){console.warn("Skipping conversation list update due to invalid partner ID:",ne,"Message:",W);return}N(xe=>{const Te=xe.findIndex(We=>We.user._id===ne);let Ke;if(Te!==-1)return Ke={...xe[Te],lastMessage:W,unreadCount:W.sender!==s._id&&(!g||g.user._id!==ne)?(xe[Te].unreadCount||0)+1:g&&g.user._id===ne?0:xe[Te].unreadCount},[Ke,...xe.filter(We=>We.user._id!==ne)];{const We=W.senderName||`User ${ne.substring(0,6)}`,yt=W.senderPhoto||null;return Ke={user:{_id:ne,nickname:We,photo:yt,isOnline:!1,accountTier:"FREE"},lastMessage:W,unreadCount:W.sender!==s._id?1:0},[Ke,...xe]}})},[s==null?void 0:s._id,g]),Fr=d.useCallback(W=>{if(!W||W===(s==null?void 0:s._id))return;if(!/^[0-9a-fA-F]{24}$/.test(W)){console.warn("Attempted to mark conversation read for invalid ID format:",W);return}let ne=!1;N(xe=>xe.map(Te=>Te.user._id===W&&Te.unreadCount>0?(ne=!0,{...Te,unreadCount:0}):Te)),ne&&setTimeout(()=>{pt.markConversationRead(W)},50)},[s==null?void 0:s._id]),Dr=d.useCallback(()=>{if(g&&pt.isConnected&&pt.isConnected()&&(s!=null&&s._id)){const W=g.user._id;/^[0-9a-fA-F]{24}$/.test(W)?pt.sendTypingIndicator(W):console.warn("Cannot send typing indicator for invalid partner ID:",W)}},[g,s==null?void 0:s._id]),Ur=W=>{var Te;const ne=W.target.value;j(ne),ne.trim()&&((Te=g==null?void 0:g.user)!=null&&Te._id)?/^[0-9a-fA-F]{24}$/.test(g.user._id)&&(u.current&&clearTimeout(u.current),u.current=setTimeout(Dr,500)):u.current&&clearTimeout(u.current),W.target.style.height="auto";const xe=120;W.target.style.height=`${Math.min(W.target.scrollHeight,xe)}px`},rr=d.useCallback(W=>{var ne;if(!((ne=W==null?void 0:W.user)!=null&&ne._id)){console.warn("Attempted to select invalid conversation",W);return}if(g&&g.user._id===W.user._id){console.log("Already on this conversation, skipping");return}if(W.user._id===(s==null?void 0:s._id)){H.warning("You cannot message yourself");return}if(!/^[0-9a-fA-F]{24}$/.test(W.user._id)){H.error("Cannot select conversation: Invalid user ID."),console.error("Attempted to select conversation with invalid ID:",W.user._id);return}console.log(`Selecting conversation with user: ${W.user.nickname} (${W.user._id})`),j(""),we(null),v(null),M(null),P([]),J.current=null,C(W),e(`/messages/${W.user._id}`,{replace:!0}),b&&(G(!1),"vibrate"in navigator&&navigator.vibrate(20))},[g,s==null?void 0:s._id,b,e]),qr=()=>{G(!z),b&&"vibrate"in navigator&&navigator.vibrate(15)},zr=d.useCallback(async()=>{try{qn.debug("Refreshing conversations list"),F(!0);const W=await pt.getConversations();W&&Array.isArray(W)&&(N(W),qn.debug(`Loaded ${W.length} conversations`)),b&&"vibrate"in navigator&&navigator.vibrate([15,30,15])}catch(W){qn.error("Error refreshing conversations:",W),H.error("Failed to refresh conversations"),b&&"vibrate"in navigator&&navigator.vibrate([100,50,100])}finally{F(!1),gt(!1)}},[pt,b]);d.useMemo(()=>ua(A),[A]);const Hr=d.useCallback(W=>{const{scrollTop:ne,scrollHeight:xe,clientHeight:Te}=W.target},[]);return k||r?n.jsx(ro,{children:n.jsx("div",{className:$e.messagesLoading,children:n.jsx(sr,{size:"large",text:"Loading chat...",centered:!0})})}):!o&&!r?n.jsx(ro,{children:n.jsx("div",{className:$e.noActiveChat,children:n.jsxs("div",{className:$e.noActiveChatContent,children:[n.jsx("h3",{children:"Please Login"}),n.jsx("p",{children:"You need to login to view your messages."}),n.jsx("button",{className:$e.startChatButton,onClick:()=>e("/login"),children:"Go to Login"})]})})}):E&&!g&&!O&&!k?n.jsx(ro,{children:n.jsx("div",{className:$e.noActiveChat,children:n.jsxs("div",{className:`${$e.noActiveChatContent} ${$e.errorContent}`,children:[n.jsx("h3",{children:"Error"}),n.jsx("p",{children:E}),n.jsx("button",{className:$e.startChatButton,onClick:()=>window.location.reload(),children:"Retry"})]})})}):n.jsxs(ro,{children:[n.jsxs("div",{className:$e.messagesContainer,ref:q,onTouchStart:b?gs:void 0,onTouchMove:b?an:void 0,onTouchEnd:b?be:void 0,children:[n.jsx("div",{className:bs($e.sidebar,z?$e.show:$e.hide),children:n.jsx(vj,{conversations:_,activeConversation:g,onConversationSelect:rr,onNewConversation:()=>e("/dashboard"),currentUserId:s==null?void 0:s._id,onRefresh:zr,conversationsLoading:k&&_.length===0,conversationsListRef:S})}),n.jsx(Yd,{className:!z&&b?$e.fullWidth:"",isUserBlocked:((ir=g==null?void 0:g.user)==null?void 0:ir.isBlocked)||((ar=g==null?void 0:g.user)==null?void 0:ar._id)&&f(g.user._id),children:g?n.jsxs(n.Fragment,{children:[n.jsx(Jd,{conversation:g,isMobile:b,onBackClick:qr,onStartVideoCall:Ie,onProfileClick:()=>{ee(g.user._id),fe(!0)},onBlockUser:W=>{var xe;if((xe=g==null?void 0:g.user)==null?void 0:xe.isBlocked){if(window.confirm("Are you sure you want to unblock this user? They will be able to send you messages again.")){l(W).then(()=>{try{const Ke=localStorage.getItem("blockedUsers");if(Ke){const yt=JSON.parse(Ke).filter(Bt=>Bt!==W);localStorage.setItem("blockedUsers",JSON.stringify(yt))}}catch(Ke){console.warn("Failed to update blocked users in localStorage:",Ke)}a().then(()=>{ke()})}),H.success("User unblocked successfully");const Te={_id:us(),content:"You have unblocked this user. You will now receive messages from them.",type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"unblock"};P(Ke=>[...Ke,Te])}}else if(window.confirm("Are you sure you want to block this user? You will no longer receive messages from them.")){i(W).then(()=>{try{const Ke=localStorage.getItem("blockedUsers");let We=[];Ke&&(We=JSON.parse(Ke)),We.includes(W)||(We.push(W),localStorage.setItem("blockedUsers",JSON.stringify(We)))}catch(Ke){console.warn("Failed to update blocked users in localStorage:",Ke)}a().then(()=>{ke()})}),H.success("User blocked successfully");const Te={_id:us(),content:"You have blocked this user. You will no longer receive messages from them.",type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"block"};P(Ke=>[...Ke,Te])}},onReportUser:W=>{const ne=window.prompt("Please provide a reason for reporting this user:");ne&&(c(W,ne),H.success("User reported successfully. Our team will review your report."))},userTier:s==null?void 0:s.accountTier}),(s==null?void 0:s.accountTier)===ss.FREE&&n.jsx(qo,{onUpgradeClick:()=>e("/subscription")}),n.jsx(Uo,{incomingCall:K,isCallActive:le,recipientNickname:((cr=g==null?void 0:g.user)==null?void 0:cr.nickname)||"User",onAcceptCall:()=>{if(K!=null&&K.callerId&&/^[0-9a-fA-F]{24}$/.test(K.callerId)){if((s==null?void 0:s.accountTier)===ss.FREE){H.error("Free accounts cannot receive video calls. Upgrade to accept."),Ne.answerVideoCall(K.callerId,!1,K.callId),ae(null);return}Ne.answerVideoCall(K.callerId,!0,K.callId);const W={_id:us(),sender:"system",content:`You accepted the video call from ${g.user.nickname}.`,createdAt:new Date().toISOString(),type:"system"};P(ne=>[...ne,W]),ye(!0),ae(null)}else console.error("Cannot accept call: Invalid caller ID format",K==null?void 0:K.callerId),H.error("Error accepting call (Invalid ID)."),ae(null)},onDeclineCall:()=>{if(K!=null&&K.callerId&&/^[0-9a-fA-F]{24}$/.test(K.callerId)){Ne.answerVideoCall(K.callerId,!1,K.callId);const W={_id:us(),sender:"system",content:`You declined the video call from ${g.user.nickname}.`,createdAt:new Date().toISOString(),type:"system"};P(ne=>[...ne,W])}else console.error("Cannot decline call: Invalid caller ID format",K==null?void 0:K.callerId),H.error("Error declining call (Invalid ID).");ae(null)},onEndCall:On,useSmallButtons:!1}),O?n.jsx(Lr,{showTimeoutMessage:!1,handleRetry:()=>Xe(g.user._id),handleReconnect:()=>{var W;return(W=pt.reconnect)==null?void 0:W.call(pt)}}):E&&A.length===0?n.jsx(zo,{error:E,handleRetry:()=>Xe(g.user._id),handleForceInit:()=>{y.current=!1,pt.initialize(s)},showInitButton:!0}):A.length===0?n.jsx(Ho,{text:"No messages in this conversation yet.",hint:(s==null?void 0:s.accountTier)===ss.FREE?"Send a wink to start!":"Say hello to start the conversation!"}):n.jsx(xj,{messages:A,currentUserId:s==null?void 0:s._id,isSending:se,typingUser:I&&((lr=g==null?void 0:g.user)==null?void 0:lr._id)===I?g.user.nickname:null,isMobile:b,onScroll:Hr,messagesEndRef:X}),n.jsx(Do,{attachment:ue,isUploading:Pe,uploadProgress:de,onRemoveAttachment:Ln,onFileSelected:(W,ne)=>{if(ne){H.error(ne);return}W&&(we(W),H.info(`Selected file: ${W.name}`),b&&"vibrate"in navigator&&navigator.vibrate(30))},showFileInput:!1,disabled:!!K||le,userTier:s==null?void 0:s.accountTier}),n.jsx(wj,{isVisible:Y,onClose:()=>oe(!1),onEmojiClick:W=>{j(ne=>ne+W),oe(!1),setTimeout(()=>{var ne;return(ne=U.current)==null?void 0:ne.focus()},0),b&&"vibrate"in navigator&&navigator.vibrate(20)}}),n.jsx(Fo,{messageValue:R,onInputChange:Ur,onSubmit:ue?dt:Rt,onWinkSend:Je,onFileAttachClick:Jt,disabled:!!K||le||((dr=g==null?void 0:g.user)==null?void 0:dr.isBlocked)||((ur=g==null?void 0:g.user)==null?void 0:ur._id)&&f(g.user._id),isUserBlocked:((ve=g==null?void 0:g.user)==null?void 0:ve.isBlocked)||((qe=g==null?void 0:g.user)==null?void 0:qe._id)&&f(g.user._id),onEmojiClick:W=>{j(ne=>ne+W),oe(!1),setTimeout(()=>{var ne;return(ne=U.current)==null?void 0:ne.focus()},0),b&&"vibrate"in navigator&&navigator.vibrate(20)},userTier:s==null?void 0:s.accountTier,isSending:se,isUploading:Pe,attachmentSelected:!!ue,inputRef:U,placeholderText:(St=g==null?void 0:g.user)!=null&&St.isBlocked?"You have blocked this user":(s==null?void 0:s.accountTier)===ss.FREE?"Send a wink instead (Free Account)":`Message ${((Ze=g==null?void 0:g.user)==null?void 0:Ze.nickname)||""}...`}),n.jsx(bj,{onFileSelected:W=>{W&&(we(W),H.info(`Selected file: ${W.name}`),b&&"vibrate"in navigator&&navigator.vibrate(30))},isUploading:Pe,uploadProgress:de,showProgress:!1,acceptedFileTypes:"image/jpeg,image/png,image/gif,image/webp,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,audio/mpeg,audio/wav,audio/ogg,video/mp4,video/quicktime,video/webm"})]}):n.jsx("div",{className:$e.noActiveChat,children:n.jsxs("div",{className:$e.noActiveChatContent,children:[n.jsx(Gs,{size:48}),n.jsx("h3",{children:"Your Messages"}),n.jsx("p",{children:"Select a conversation from the list to start chatting."}),E&&n.jsx("p",{className:$e.errorMessage,children:E}),n.jsx("button",{className:$e.startChatButton,onClick:()=>e("/dashboard"),children:"Find someone to chat with"})]})})})]}),le&&((es=g==null?void 0:g.user)==null?void 0:es._id)&&/^[0-9a-fA-F]{24}$/.test(g.user._id)&&n.jsx("div",{className:$e.videoCallOverlay,children:n.jsx(Vo,{isActive:le,userId:s==null?void 0:s._id,recipientId:g.user._id,onEndCall:On,isIncoming:!1,callId:null})}),n.jsx(Wo,{userId:Re,isOpen:re,onClose:()=>fe(!1)})]})},Sj="_subscriptionContainer_1j9z3_2",Cj="_gradientBar_1j9z3_20",kj="_backNav_1j9z3_27",Nj="_backButton_1j9z3_33",jj="_pageTitle_1j9z3_61",Tj="_subtitle_1j9z3_81",Ej="_lead_1j9z3_93",Aj="_pricingCards_1j9z3_105",Ij="_pricingCard_1j9z3_105",$j="_premiumCard_1j9z3_138",Pj="_popularBadge_1j9z3_149",Rj="_cardHeader_1j9z3_162",Lj="_planName_1j9z3_172",Oj="_price_1j9z3_183",Mj="_period_1j9z3_190",Bj="_cardBody_1j9z3_200",Fj="_featureList_1j9z3_207",Dj="_featureItem_1j9z3_214",Uj="_iconYes_1j9z3_226",qj="_iconNo_1j9z3_233",zj="_featureIcon_1j9z3_240",Hj="_toggleContainer_1j9z3_245",Vj="_toggleBtn_1j9z3_260",Wj="_toggleBtnActive_1j9z3_276",Gj="_saveBadge_1j9z3_283",Yj="_buttonOutline_1j9z3_296",Kj="_buttonPrimary_1j9z3_331",Jj="_alreadyPremium_1j9z3_373",Qj="_premiumTitle_1j9z3_389",Xj="_premiumMessage_1j9z3_400",Zj="_spinner_1j9z3_410",Le={subscriptionContainer:Sj,gradientBar:Cj,backNav:kj,backButton:Nj,pageTitle:jj,subtitle:Tj,lead:Ej,pricingCards:Aj,pricingCard:Ij,premiumCard:$j,popularBadge:Pj,cardHeader:Rj,planName:Lj,price:Oj,period:Mj,cardBody:Bj,featureList:Fj,featureItem:Dj,iconYes:Uj,iconNo:qj,featureIcon:zj,toggleContainer:Hj,toggleBtn:Vj,toggleBtnActive:Wj,saveBadge:Gj,buttonOutline:Yj,buttonPrimary:Kj,alreadyPremium:Jj,premiumTitle:Qj,premiumMessage:Xj,spinner:Zj},ol=yn("Subscription"),eT=()=>{const{user:t,getCurrentUser:e}=Gt(),s=Zt(),[r,o]=d.useState("monthly"),[i,c]=d.useState(!1),[l,f]=d.useState(null),{t:h}=Pt(),{isRTL:a}=Ht();d.useEffect(()=>{t?p():s("/login")},[t,s]);const p=async()=>{try{const g=await na.getSubscriptionStatus();g.success&&f(g.data)}catch(g){ol.error("Error fetching subscription status:",g),H.error(h("fetchFailed"))}},_=(t==null?void 0:t.isPaid)||(t==null?void 0:t.accountTier)==="PAID"||(t==null?void 0:t.accountTier)==="FEMALE"||(t==null?void 0:t.accountTier)==="COUPLE"||l&&(l.isPaid||l.accountTier==="PAID"||l.accountTier==="FEMALE"||l.accountTier==="COUPLE"),N=async g=>{c(!0);try{(await na.upgradeSubscription(g)).success&&(await e(),H.success(h("upgradeSuccess")),s("/dashboard"))}catch(C){ol.error("Subscription error:",C),H.error(C.message||h("paymentFailed"))}finally{c(!1)}};return n.jsx("div",{className:`modern-dashboard ${a?"rtl-layout":""}`,children:n.jsx("main",{className:"dashboard-content",children:n.jsxs("div",{className:Le.subscriptionContainer,children:[n.jsx("div",{className:Le.gradientBar}),n.jsx("div",{className:Le.backNav,children:n.jsxs("button",{className:Le.backButton,onClick:()=>s("/dashboard"),children:[n.jsx(Kn,{})," ",h("backToDashboard")||"Back to Dashboard"]})}),n.jsxs("h1",{className:Le.pageTitle,children:[n.jsx(pd,{})," ",h("premiumMembership")]}),_?n.jsxs("div",{className:Le.alreadyPremium,children:[n.jsx("h3",{className:Le.premiumTitle,children:h("alreadyPremium")}),n.jsx("p",{className:Le.premiumMessage,children:h("enjoyFeatures")}),n.jsxs("button",{className:Le.buttonPrimary,onClick:()=>s("/dashboard"),children:[h("goBack")," ",h("dashboard")]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"text-center mb-5",children:[n.jsx("h2",{className:Le.subtitle,children:h("unlockFeatures")}),n.jsx("p",{className:Le.lead,children:h("upgradeExperience")})]}),n.jsx("div",{className:"d-flex justify-content-center",children:n.jsxs("div",{className:Le.toggleContainer,children:[n.jsx("button",{className:`${Le.toggleBtn} ${r==="monthly"?Le.toggleBtnActive:""}`,onClick:()=>o("monthly"),children:h("monthly")}),n.jsxs("button",{className:`${Le.toggleBtn} ${r==="yearly"?Le.toggleBtnActive:""}`,onClick:()=>o("yearly"),children:[h("yearly"),n.jsxs("span",{className:Le.saveBadge,children:[h("save")," 20%"]})]})]})}),n.jsxs("div",{className:Le.pricingCards,children:[n.jsxs("div",{className:Le.pricingCard,children:[n.jsxs("div",{className:Le.cardHeader,children:[n.jsx("h3",{className:Le.planName,children:h("freeTier")}),n.jsx("p",{className:Le.price,children:"$0"}),n.jsx("p",{className:Le.period,children:h("forever")})]}),n.jsxs("div",{className:Le.cardBody,children:[n.jsxs("ul",{className:Le.featureList,children:[n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("viewProfiles")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("sendWinks")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("limitedLikes")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("limitedStories")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(rs,{className:Le.iconNo})," ",h("sendMessages")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(rs,{className:Le.iconNo})," ",h("unlimitedLikes")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(rs,{className:Le.iconNo})," ",h("unlimitedStories")]})]}),n.jsx("button",{className:Le.buttonOutline,disabled:!0,children:h("currentPlan")})]})]}),n.jsxs("div",{className:`${Le.pricingCard} ${Le.premiumCard}`,children:[n.jsx("div",{className:Le.popularBadge,children:h("mostPopular")}),n.jsxs("div",{className:Le.cardHeader,children:[n.jsx("h3",{className:Le.planName,children:h("paidTier")}),n.jsxs("p",{className:Le.price,children:["$",r==="monthly"?"14.99":"11.99"]}),n.jsx("p",{className:Le.period,children:h(r==="monthly"?"perMonth":"perMonthYearly")})]}),n.jsxs("div",{className:Le.cardBody,children:[n.jsxs("ul",{className:Le.featureList,children:[n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("viewProfiles")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("sendWinks")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",n.jsx("strong",{children:h("unlimitedLikes")})," ",n.jsx(nn,{className:Le.featureIcon})]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",n.jsx("strong",{children:h("unlimitedStories")})," ",n.jsx(Oo,{className:Le.featureIcon})]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",n.jsx("strong",{children:h("sendMessages")})," ",n.jsx(er,{className:Le.featureIcon})]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("videoCalls")]}),n.jsxs("li",{className:Le.featureItem,children:[n.jsx(mt,{className:Le.iconYes})," ",h("prioritySearch")]})]}),n.jsx("button",{className:Le.buttonPrimary,onClick:()=>N(r),disabled:i,children:i?n.jsxs(n.Fragment,{children:[n.jsx("span",{className:Le.spinner}),n.jsx("span",{style:{marginLeft:"8px"},children:h("processing")})]}):`${h("subscribe")} ${r==="monthly"?"$14.99/month":"$143.88/year"}`})]})]})]})]})]})})})},il=yn("VerifyEmail"),tT=()=>{const[t,e]=d.useState("loading"),[s,r]=d.useState(""),o=Zt(),i=$n(),{user:c,login:l,resendVerificationEmail:f}=Gt(),{t:h}=Pt(),{isRTL:a}=Ht(),p=()=>new URLSearchParams(i.search).get("token");d.useEffect(()=>{(async()=>{var P,R;const A=p();if(!A){e("error"),r(h("tokenMissing"));return}try{const j=await Ae.post("/auth/verify-email",{token:A});if(j.success){if(e("success"),r(h("accountVerified")),c)try{await Ae.get("/auth/me")}catch(k){il.error("Error refreshing user profile:",k)}}else e("error"),r(j.error||h("verificationFailed"))}catch(j){il.error("Verification error:",j),e("error"),r(((R=(P=j.response)==null?void 0:P.data)==null?void 0:R.error)||h("verificationFailed"))}})()},[c,h]);const _=async()=>{c?(await f(),r(h("verificationEmailSent"))):r(h("loginToResend"))},N=()=>{o("/dashboard")},g=()=>{o("/login")};return n.jsxs("div",{className:`verify-email-page ${a?"rtl-layout":""}`,children:[n.jsx("div",{className:"verify-email-container",children:n.jsxs("div",{className:"verify-email-card",children:[n.jsx("div",{className:"verify-email-header",children:n.jsx("h1",{children:h("verifyEmail")})}),n.jsxs("div",{className:"verify-email-content",children:[t==="loading"&&n.jsxs("div",{className:"verify-email-loading",children:[n.jsx(Ts,{className:"spinner"}),n.jsx("p",{children:h("verifyingEmail")})]}),t==="success"&&n.jsxs("div",{className:"verify-email-success",children:[n.jsx(jm,{className:"success-icon"}),n.jsx("h2",{children:h("verificationSuccess")}),n.jsx("p",{children:s}),n.jsx("div",{className:"verify-email-actions",children:c?n.jsxs("button",{className:"primary-button",onClick:N,children:[h("goBack")," ",h("dashboard")]}):n.jsx("button",{className:"primary-button",onClick:g,children:h("signIn")})})]}),t==="error"&&n.jsxs("div",{className:"verify-email-error",children:[n.jsx(It,{className:"error-icon"}),n.jsx("h2",{children:h("verificationFailed")}),n.jsx("p",{children:s}),n.jsxs("div",{className:"verify-email-actions",children:[n.jsxs("button",{className:"secondary-button",onClick:_,children:[n.jsx(Gs,{})," ",h("resendVerificationEmail")]}),n.jsx(ot,{to:"/login",className:"text-link",children:h("backToLogin")})]})]})]})]})}),n.jsx("style",{jsx:!0,children:`
        .verify-email-page {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          background-color: #f5f5f5;
          padding: 20px;
        }
        
        .verify-email-container {
          width: 100%;
          max-width: 500px;
        }
        
        .verify-email-card {
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          overflow: hidden;
        }
        
        .verify-email-header {
          background-color: #ff4b7d;
          color: white;
          padding: 20px;
          text-align: center;
        }
        
        .verify-email-header h1 {
          margin: 0;
          font-size: 24px;
        }
        
        .verify-email-content {
          padding: 30px;
          text-align: center;
        }
        
        .verify-email-loading,
        .verify-email-success,
        .verify-email-error {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 15px;
        }
        
        .spinner {
          animation: spin 1s linear infinite;
          font-size: 40px;
          color: #ff4b7d;
        }
        
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        
        .success-icon {
          font-size: 60px;
          color: #28a745;
        }
        
        .error-icon {
          font-size: 60px;
          color: #dc3545;
        }
        
        .verify-email-actions {
          margin-top: 20px;
          display: flex;
          flex-direction: column;
          gap: 10px;
          width: 100%;
        }
        
        .primary-button {
          background-color: #ff4b7d;
          color: white;
          border: none;
          border-radius: 4px;
          padding: 12px 20px;
          font-size: 16px;
          cursor: pointer;
          width: 100%;
          transition: background-color 0.2s;
        }
        
        .primary-button:hover {
          background-color: #e6305f;
        }
        
        .secondary-button {
          background-color: #f8f9fa;
          color: #333;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 12px 20px;
          font-size: 16px;
          cursor: pointer;
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          transition: background-color 0.2s;
        }
        
        .secondary-button:hover {
          background-color: #e9ecef;
        }
        
        .text-link {
          color: #ff4b7d;
          text-decoration: none;
          margin-top: 10px;
          display: inline-block;
        }
        
        .text-link:hover {
          text-decoration: underline;
        }
      `})]})},sT=()=>{const{t}=Pt(),{dir:e}=Ht(),s={"@context":"https://schema.org","@type":"Organization",name:"Flirtss",url:"https://flirtss.com",logo:"https://flirtss.com/logo.png",description:"Flirtss is a dating platform that helps adults find meaningful connections in a safe, respectful environment.",foundingDate:"2022",address:{"@type":"PostalAddress",addressLocality:"Tel Aviv",addressCountry:"Israel"}};return n.jsxs("div",{className:"policy-page-container",dir:e,children:[n.jsx(nr,{title:"About Flirtss",description:"Learn about Flirtss - our story, mission, values, and the team behind our platform for meaningful connections.",schema:s}),n.jsx("header",{className:"modern-header",children:n.jsx("div",{className:"container header-container",children:n.jsx(ot,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),n.jsx("div",{className:"policy-content container py-5",children:n.jsx("div",{className:"row justify-content-center",children:n.jsx("div",{className:"col-12 col-lg-10",children:n.jsxs("div",{className:"policy-card",children:[n.jsx("h1",{className:"policy-title gradient-text",children:t("aboutUs","About Us")}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("ourStory","Our Story")}),n.jsx("p",{children:t("storyContent","Founded in 2022, Mandarin was created with a simple mission: to help adults find meaningful connections in a safe, respectful environment. Our team of dedicated professionals combines expertise in technology, psychology, and relationship dynamics to create a platform that prioritizes authentic interactions.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("ourMission","Our Mission")}),n.jsx("p",{children:t("missionContent","At Mandarin, we believe that everyone deserves to find connections that enrich their lives. Our mission is to provide a platform where adults can explore relationships in an environment that values privacy, consent, and mutual respect.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("ourValues","Our Values")}),n.jsxs("div",{className:"values-grid",children:[n.jsxs("div",{className:"value-item",children:[n.jsx("h3",{children:t("valuePrivacy","Privacy")}),n.jsx("p",{children:t("valuePrivacyDesc","Your personal information and interactions are yours alone. We implement industry-leading security measures to protect your data.")})]}),n.jsxs("div",{className:"value-item",children:[n.jsx("h3",{children:t("valueAuthenticity","Authenticity")}),n.jsx("p",{children:t("valueAuthenticityDesc","We encourage genuine interactions and have systems in place to verify real users and reduce fake profiles.")})]}),n.jsxs("div",{className:"value-item",children:[n.jsx("h3",{children:t("valueInclusion","Inclusion")}),n.jsx("p",{children:t("valueInclusionDesc","We welcome adults of all backgrounds, orientations, and relationship preferences in a judgment-free environment.")})]}),n.jsxs("div",{className:"value-item",children:[n.jsx("h3",{children:t("valueRespect","Respect")}),n.jsx("p",{children:t("valueRespectDesc","Mutual respect is fundamental to positive interactions. We have zero tolerance for harassment or disrespectful behavior.")})]})]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("ourTeam","Our Team")}),n.jsx("p",{children:t("teamContent","Our diverse team brings together expertise in technology, design, security, and relationship psychology. Based in Tel Aviv with team members across the globe, we work together to create an exceptional platform for meaningful connections.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("contactUs","Contact Us")}),n.jsxs("p",{children:[t("aboutContactContent","We value your feedback and are here to assist with any questions or concerns. Please reach out to our support team at support@mandarin.example.com or visit our")," ",n.jsx(ot,{to:"/support",children:t("supportPage","support page")}),"."]})]}),n.jsxs("div",{className:"policy-footer",children:[n.jsx(ot,{to:"/",className:"btn btn-outline-primary",children:t("backToHome","Back to Home")}),n.jsxs("div",{className:"policy-links",children:[n.jsx(ot,{to:"/terms",children:t("termsOfService","Terms of Service")}),n.jsx(ot,{to:"/privacy",children:t("privacyPolicy","Privacy Policy")}),n.jsx(ot,{to:"/support",children:t("contactSupport","Contact Support")})]})]})]})})})})]})},nT=()=>{const{t}=Pt(),{dir:e}=Ht(),s={"@context":"https://schema.org","@type":"FAQPage",mainEntity:[{"@type":"Question",name:"How does Flirtss protect my privacy?",acceptedAnswer:{"@type":"Answer",text:"Flirtss uses end-to-end encryption for all personal data, gives you control over who sees your photos and profile information, provides precise control over location sharing, and offers customizable privacy settings."}},{"@type":"Question",name:"What should I do if I encounter inappropriate behavior?",acceptedAnswer:{"@type":"Answer",text:"Use the 'Report' button on the user's profile or in your chat conversation, contact our support team which is available 24/7, and in case of immediate danger or threats, contact your local authorities first."}},{"@type":"Question",name:"How does Flirtss verify users?",acceptedAnswer:{"@type":"Answer",text:"Flirtss employs multiple verification methods including photo verification technology, email verification, phone number verification, and a profile review process. Look for the verified badge on profiles to identify users who have completed our verification process."}}]};return n.jsxs("div",{className:"policy-page-container",dir:e,children:[n.jsx(nr,{title:"Safety & Privacy Guidelines",description:"Learn about Mandarin Dating's comprehensive safety measures, privacy protection features, and guidelines for staying safe while using our platform.",schema:s}),n.jsx("header",{className:"modern-header",children:n.jsx("div",{className:"container header-container",children:n.jsx(ot,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),n.jsx("div",{className:"policy-content container py-5",children:n.jsx("div",{className:"row justify-content-center",children:n.jsx("div",{className:"col-12 col-lg-10",children:n.jsxs("div",{className:"policy-card",children:[n.jsx("h1",{className:"policy-title gradient-text",children:t("safetyTitle","Safety & Privacy")}),n.jsxs("section",{className:"mb-5",children:[n.jsx("div",{className:"safety-icon-container",children:n.jsx(xa,{className:"safety-main-icon"})}),n.jsx("h2",{children:t("safetyIntroduction","Your Safety is Our Priority")}),n.jsx("p",{children:t("safetyIntroContent","At Mandarin, we are committed to creating a safe, secure, and respectful environment for all our users. We have implemented comprehensive safety measures to protect your privacy and ensure positive interactions. This page outlines our commitment to your safety and provides resources to help you stay safe while using our platform.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsxs("h2",{className:"d-flex align-items-center",children:[n.jsx(ns,{className:"section-icon"}),t("privacyProtection","Privacy Protection")]}),n.jsx("p",{children:t("privacyContent","Your personal information is safeguarded by industry-leading security measures:")}),n.jsxs("ul",{className:"safety-checklist",children:[n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("dataEncryption","End-to-end encryption for all personal data")]}),n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("photoPrivacy","Control over who sees your photos and profile information")]}),n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("locationControl","Precise control over your location sharing")]}),n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("privacySettings","Customizable privacy settings for your comfort level")]})]}),n.jsxs("p",{children:[t("reviewPrivacyPolicy","For more details on how we handle your data, please review our")," ",n.jsx(ot,{to:"/privacy",className:"text-link",children:t("privacyPolicyLink","Privacy Policy")}),"."]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsxs("h2",{className:"d-flex align-items-center",children:[n.jsx(ig,{className:"section-icon"}),t("onlineSafety","Online Safety Tips")]}),n.jsx("p",{children:t("tipsIntro","While we work hard to maintain a safe platform, it's important to follow these safety guidelines:")}),n.jsxs("div",{className:"safety-tips-grid",children:[n.jsxs("div",{className:"safety-tip",children:[n.jsx("h3",{children:t("meetingTip","Meeting In Person")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("meetPublic","Always meet in a public place for your first meeting")}),n.jsx("li",{children:t("tellFriend","Tell a friend or family member about your plans")}),n.jsx("li",{children:t("stayingSober","Stay sober and clear-headed during initial meetings")}),n.jsx("li",{children:t("ownTransport","Arrange your own transportation to and from the meeting")})]})]}),n.jsxs("div",{className:"safety-tip",children:[n.jsx("h3",{children:t("personalInfoTip","Protecting Personal Information")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("limitInfo","Limit personal information in your profile and messages")}),n.jsx("li",{children:t("noFinancial","Never share financial information or send money")}),n.jsx("li",{children:t("privateComm","Keep communications on the platform until you build trust")}),n.jsx("li",{children:t("socialMedia","Be cautious about connecting on social media too quickly")})]})]}),n.jsxs("div",{className:"safety-tip",children:[n.jsx("h3",{children:t("recognizeTip","Recognizing Red Flags")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("inconsistencies","Be wary of inconsistencies in someone's story")}),n.jsx("li",{children:t("rushingRelationship","Be cautious of someone rushing the relationship")}),n.jsx("li",{children:t("avoidingQuestions","Watch for avoidance of direct questions")}),n.jsx("li",{children:t("requestingMoney","Be alert if someone requests money for any reason")})]})]}),n.jsxs("div",{className:"safety-tip",children:[n.jsx("h3",{children:t("respectTip","Respectful Communication")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("consentMatters","Always respect boundaries and consent")}),n.jsx("li",{children:t("politeDecline","Politely decline interests that don't match yours")}),n.jsx("li",{children:t("reportHarassment","Report any harassment or inappropriate messages")}),n.jsx("li",{children:t("blockOption","Use the block feature if someone makes you uncomfortable")})]})]})]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsxs("h2",{className:"d-flex align-items-center",children:[n.jsx(It,{className:"section-icon"}),t("reportingIssues","Reporting Issues")]}),n.jsx("p",{children:t("reportingContent","Your safety is our priority. If you encounter inappropriate behavior, we encourage you to report it immediately:")}),n.jsxs("ol",{className:"safety-reporting",children:[n.jsxs("li",{children:[n.jsxs("strong",{children:[t("reportingUser","Report a User"),":"]})," ",t("reportingUserDetails","Use the 'Report' button on their profile or in your chat conversation")]}),n.jsxs("li",{children:[n.jsxs("strong",{children:[t("reportingContact","Contact Support"),":"]})," ",t("reportingContactDetails","Our support team is available 24/7 to assist with urgent safety concerns")]}),n.jsxs("li",{children:[n.jsxs("strong",{children:[t("reportingAuthorities","Contact Authorities"),":"]})," ",t("reportingAuthoritiesDetails","In case of immediate danger or threats, please contact local authorities first")]})]}),n.jsx("div",{className:"safety-alert",children:n.jsxs("p",{children:[n.jsxs("strong",{children:[t("emergencySituations","For emergency situations"),": "]}),t("emergencyContact","Contact your local emergency services immediately, then notify our support team so we can take appropriate action on our platform.")]})})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("verification","User Verification")}),n.jsx("p",{children:t("verificationContent","We employ multiple verification methods to ensure the authenticity of our users:")}),n.jsxs("ul",{className:"safety-checklist",children:[n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("photoVerification","Photo verification technology")]}),n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("emailVerification","Email verification")]}),n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("phoneVerification","Phone number verification")]}),n.jsxs("li",{children:[n.jsx(mt,{className:"check-icon"}),t("profileReview","Profile review process")]})]}),n.jsx("p",{children:t("verificationBadge","Look for the verified badge on profiles to identify users who have completed our verification process.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("contactSafetyTeam","Contact Our Safety Team")}),n.jsx("p",{children:t("safetyContactContent","If you have safety concerns or suggestions, our dedicated safety team is here to help:")}),n.jsxs("p",{children:["Email: safety@mandarin.example.com",n.jsx("br",{}),"Support: ",n.jsx(ot,{to:"/support",className:"text-link",children:t("supportCenter","Support Center")})]})]}),n.jsxs("div",{className:"policy-footer",children:[n.jsx(ot,{to:"/",className:"btn btn-outline-primary",children:t("backToHome","Back to Home")}),n.jsxs("div",{className:"policy-links",children:[n.jsx(ot,{to:"/about",children:t("aboutUs","About Us")}),n.jsx(ot,{to:"/privacy",children:t("privacyPolicy","Privacy Policy")}),n.jsx(ot,{to:"/terms",children:t("termsOfService","Terms of Service")}),n.jsx(ot,{to:"/support",children:t("contactSupport","Contact Support")})]})]})]})})})})]})},rT=yn("Support"),oT=()=>{const{t}=Pt(),{dir:e}=Ht(),[s,r]=d.useState("contact"),[o,i]=d.useState(null),[c,l]=d.useState({name:"",email:"",subject:"",message:""}),[f,h]=d.useState(!1),a=C=>{const{name:A,value:P}=C.target;l({...c,[A]:P})},p=C=>{C.preventDefault(),rT.info("Form submitted:",c),h(!0),l({name:"",email:"",subject:"",message:""}),setTimeout(()=>{h(!1)},3e3)},_=C=>{i(o===C?null:C)},N=[{question:t("faq1Question","How do I create an account?"),answer:t("faq1Answer","To create an account, click on the 'Register' button on the homepage. Fill out your details, upload a profile photo, and set your preferences. Once you verify your email, your account will be activated.")},{question:t("faq2Question","How can I change my account settings?"),answer:t("faq2Answer","Navigate to the 'Settings' page after logging in. There, you can update your profile information, notification preferences, privacy settings, and account details.")},{question:t("faq3Question","Is my personal information secure?"),answer:t("faq3Answer","Yes, we take security very seriously. We use encryption to protect your data and never share your personal information with third parties without your consent. For more details, please review our Privacy Policy.")},{question:t("faq4Question","How do I cancel my subscription?"),answer:t("faq4Answer","To cancel your subscription, go to 'Settings > Subscription' and click on 'Cancel Subscription'. Your premium benefits will remain active until the end of your current billing period.")},{question:t("faq5Question","How can I report inappropriate behavior?"),answer:t("faq5Answer","If you encounter inappropriate behavior, use the 'Report' button on the user's profile or in the message thread. Our moderation team will review the report and take appropriate action within 24 hours.")},{question:t("faq6Question","What should I do if I forget my password?"),answer:t("faq6Answer","On the login page, click 'Forgot Password'. Enter your email address, and we'll send you instructions to reset your password. For security reasons, the reset link expires after 24 hours.")},{question:t("faq7Question","How do I delete my account?"),answer:t("faq7Answer","Go to 'Settings > Account' and scroll to the bottom where you'll find the 'Delete Account' option. Please note that account deletion is permanent and cannot be undone.")}],g={"@context":"https://schema.org","@type":"CustomerService",name:"Flirtss Support",url:"https://flirtss.com/support",email:"support@flirtss.com",telephone:"+972 12 345 6789",availableLanguage:["English","Hebrew"],hoursAvailable:"Mo-Fr 09:00-18:00",contactType:"customer support"};return n.jsxs("div",{className:"policy-page-container",dir:e,children:[n.jsx(nr,{title:"Support Center",description:"Get help with your Mandarin Dating account. Contact our support team, find answers to frequently asked questions, and troubleshoot common issues.",schema:g}),n.jsx("header",{className:"modern-header",children:n.jsx("div",{className:"container header-container",children:n.jsx(ot,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),n.jsx("div",{className:"policy-content container py-5",children:n.jsx("div",{className:"row justify-content-center",children:n.jsx("div",{className:"col-12 col-lg-10",children:n.jsxs("div",{className:"policy-card",children:[n.jsx("h1",{className:"policy-title gradient-text",children:t("supportTitle","Support Center")}),n.jsxs("div",{className:"support-tabs mb-4",children:[n.jsxs("button",{className:`support-tab ${s==="contact"?"active":""}`,onClick:()=>r("contact"),children:[n.jsx(Gs,{className:"tab-icon"}),t("contactUs","Contact Us")]}),n.jsxs("button",{className:`support-tab ${s==="faq"?"active":""}`,onClick:()=>r("faq"),children:[n.jsx(Ym,{className:"tab-icon"}),t("faq","FAQ")]})]}),s==="contact"&&n.jsxs("div",{className:"support-content",children:[n.jsx("div",{className:"contact-info mb-4",children:n.jsxs("div",{className:"contact-methods",children:[n.jsxs("div",{className:"contact-method",children:[n.jsx(Gs,{className:"contact-icon"}),n.jsxs("div",{children:[n.jsx("h3",{children:t("email","Email")}),n.jsx("p",{children:"support@mandarin.example.com"})]})]}),n.jsxs("div",{className:"contact-method",children:[n.jsx(wd,{className:"contact-icon"}),n.jsxs("div",{children:[n.jsx("h3",{children:t("phone","Phone")}),n.jsx("p",{children:"+972 12 345 6789"})]})]}),n.jsxs("div",{className:"contact-method",children:[n.jsx($m,{className:"contact-icon"}),n.jsxs("div",{children:[n.jsx("h3",{children:t("liveChat","Live Chat")}),n.jsx("p",{children:t("liveChatHours","Available 9AM-6PM IST")})]})]})]})}),n.jsx("h2",{className:"mb-4",children:t("contactForm","Send Us a Message")}),f?n.jsx("div",{className:"alert alert-success",children:t("formSuccess","Thank you! Your message has been sent. We'll get back to you soon.")}):n.jsxs("form",{onSubmit:p,className:"support-form",children:[n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{htmlFor:"name",children:t("formName","Your Name")}),n.jsx("input",{type:"text",id:"name",name:"name",className:"form-control",value:c.name,onChange:a,required:!0})]}),n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{htmlFor:"email",children:t("formEmail","Email Address")}),n.jsx("input",{type:"email",id:"email",name:"email",className:"form-control",value:c.email,onChange:a,required:!0})]}),n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{htmlFor:"subject",children:t("formSubject","Subject")}),n.jsx("input",{type:"text",id:"subject",name:"subject",className:"form-control",value:c.subject,onChange:a,required:!0})]}),n.jsxs("div",{className:"form-group mb-3",children:[n.jsx("label",{htmlFor:"message",children:t("formMessage","Message")}),n.jsx("textarea",{id:"message",name:"message",className:"form-control",rows:"5",value:c.message,onChange:a,required:!0})]}),n.jsx("button",{type:"submit",className:"btn btn-primary",children:t("formSubmit","Send Message")})]})]}),s==="faq"&&n.jsxs("div",{className:"support-content",children:[n.jsx("h2",{className:"mb-4",children:t("frequentlyAskedQuestions","Frequently Asked Questions")}),n.jsx("div",{className:"faq-list",children:N.map((C,A)=>n.jsxs("div",{className:`faq-item ${o===A?"expanded":""}`,children:[n.jsxs("div",{className:"faq-question",onClick:()=>_(A),children:[n.jsx("h3",{children:C.question}),o===A?n.jsx(Nm,{}):n.jsx(km,{})]}),o===A&&n.jsx("div",{className:"faq-answer",children:n.jsx("p",{children:C.answer})})]},A))})]}),n.jsxs("div",{className:"policy-footer",children:[n.jsx(ot,{to:"/",className:"btn btn-outline-primary",children:t("backToHome","Back to Home")}),n.jsxs("div",{className:"policy-links",children:[n.jsx(ot,{to:"/about",children:t("aboutUs","About Us")}),n.jsx(ot,{to:"/privacy",children:t("privacyPolicy","Privacy Policy")}),n.jsx(ot,{to:"/terms",children:t("termsOfService","Terms of Service")})]})]})]})})})})]})},iT=()=>{const{t}=Pt(),{dir:e}=Ht(),s={"@context":"https://schema.org","@type":"WebPage",name:"Terms of Service - Flirtss",description:"Terms and conditions for using the Flirtss platform.",url:"https://flirtss.com/terms",mainEntity:{"@type":"Article",name:"Flirtss Terms of Service",datePublished:"2024-04-15",dateModified:"2024-04-15",author:{"@type":"Organization",name:"Flirtss"}}};return n.jsxs("div",{className:"policy-page-container",dir:e,children:[n.jsx(nr,{title:"Terms of Service",description:"Read the Mandarin Dating terms of service, including user eligibility, account rules, acceptable conduct, and subscription terms.",schema:s}),n.jsx("header",{className:"modern-header",children:n.jsx("div",{className:"container header-container",children:n.jsx(ot,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),n.jsx("div",{className:"policy-content container py-5",children:n.jsx("div",{className:"row justify-content-center",children:n.jsx("div",{className:"col-12 col-lg-10",children:n.jsxs("div",{className:"policy-card",children:[n.jsx("h1",{className:"policy-title gradient-text",children:t("termsTitle","Terms of Service")}),n.jsxs("p",{className:"policy-last-updated",children:[t("lastUpdated","Last Updated"),": ",t("updateDate","April 15, 2024")]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("introduction","Introduction")}),n.jsx("p",{children:t("termsIntroContent",'Welcome to Mandarin. These Terms of Service ("Terms") govern your access to and use of the Mandarin application and website (the "Service"). Please read these Terms carefully before using our Service.')}),n.jsx("p",{children:t("introAgreement","By accessing or using the Service, you agree to be bound by these Terms. If you do not agree to all the terms and conditions, you may not access or use the Service.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("eligibility","Eligibility")}),n.jsx("p",{children:t("eligibilityContent","You must be at least 18 years old to use the Service. By using the Service, you represent and warrant that you meet all eligibility requirements. The Service is not available to previously removed users or those who have had their account suspended.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("accountCreation","Account Creation and Security")}),n.jsx("p",{children:t("accountContent","To use certain features of the Service, you must register for an account. You agree to provide accurate and complete information and to keep this information up to date. You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account.")}),n.jsx("p",{children:t("accountSecurity","You are solely responsible for safeguarding your password and agree to notify us immediately of any unauthorized use of your account. We reserve the right to close your account at any time for any or no reason.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("userConduct","User Conduct")}),n.jsx("p",{children:t("conductIntro","You agree not to engage in any of the following prohibited activities:")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("conductViolate","Violating any laws, regulations, or third party rights")}),n.jsx("li",{children:t("conductHarassment","Engaging in harassment, intimidation, or abusive behavior toward other users")}),n.jsx("li",{children:t("conductFalse","Providing false or misleading information or creating a false identity")}),n.jsx("li",{children:t("conductSecurity","Attempting to circumvent security features or access parts of the Service for which you do not have permission")}),n.jsx("li",{children:t("conductSolicitation","Using the Service for commercial solicitation without our prior written consent")}),n.jsx("li",{children:t("conductHarmful","Posting or transmitting malicious code or content that could harm our systems or other users")})]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("contentRights","Content and Intellectual Property Rights")}),n.jsx("p",{children:t("contentOwnership","The Service and its original content, features, and functionality are owned by Mandarin and are protected by international copyright, trademark, and other intellectual property laws.")}),n.jsx("p",{children:t("userContent","By submitting content to the Service, you grant us a worldwide, non-exclusive, royalty-free license to use, reproduce, modify, adapt, publish, translate, and distribute your content in connection with providing the Service.")}),n.jsx("p",{children:t("contentResponsibility","You are solely responsible for the content you post and warrant that you have all necessary rights to post such content.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("subscriptions","Subscriptions and Payments")}),n.jsx("p",{children:t("subscriptionContent","Some features of the Service may require a subscription. By subscribing, you agree to pay the fees in accordance with our payment terms. You authorize us to charge the payment method you provide for the subscription fees.")}),n.jsx("p",{children:t("subscriptionRenewal","Subscriptions automatically renew unless you cancel before the renewal date. You can cancel your subscription at any time through your account settings.")}),n.jsx("p",{children:t("subscriptionRefund","Payments are non-refundable except where required by law or as expressly stated in our refund policy.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("termination","Termination")}),n.jsx("p",{children:t("terminationContent","We may terminate or suspend your account and access to the Service immediately, without prior notice or liability, for any reason, including if you breach these Terms.")}),n.jsx("p",{children:t("terminationEffect","Upon termination, your right to use the Service will immediately cease. All provisions of these Terms which by their nature should survive termination shall survive termination.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("disclaimer","Disclaimer")}),n.jsx("p",{children:t("disclaimerContent",'THE SERVICE IS PROVIDED "AS IS" AND "AS AVAILABLE" WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED. TO THE FULLEST EXTENT PERMITTED BY LAW, WE DISCLAIM ALL WARRANTIES, INCLUDING BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.')})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("limitation","Limitation of Liability")}),n.jsx("p",{children:t("limitationContent","TO THE MAXIMUM EXTENT PERMITTED BY LAW, IN NO EVENT SHALL MANDARIN BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES, INCLUDING WITHOUT LIMITATION, LOSS OF PROFITS, DATA, USE, GOODWILL, OR OTHER INTANGIBLE LOSSES, RESULTING FROM YOUR ACCESS TO OR USE OF OR INABILITY TO ACCESS OR USE THE SERVICE.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("changesToTerms","Changes to Terms")}),n.jsx("p",{children:t("changesContent","We reserve the right to modify or replace these Terms at any time. If a revision is material, we will provide at least 30 days' notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("contactUs","Contact Us")}),n.jsx("p",{children:t("contactContent","If you have any questions about these Terms, please contact us at:")}),n.jsxs("p",{children:["Email: legal@mandarin.example.com",n.jsx("br",{}),"Address: 123 Legal Street, Tel Aviv, Israel"]})]}),n.jsxs("div",{className:"policy-footer",children:[n.jsx(ot,{to:"/",className:"btn btn-outline-primary",children:t("backToHome","Back to Home")}),n.jsxs("div",{className:"policy-links",children:[n.jsx(ot,{to:"/about",children:t("aboutUs","About Us")}),n.jsx(ot,{to:"/privacy",children:t("privacyPolicy","Privacy Policy")}),n.jsx(ot,{to:"/support",children:t("contactSupport","Contact Support")})]})]})]})})})})]})},aT=()=>{const{t}=Pt(),{dir:e}=Ht(),s={"@context":"https://schema.org","@type":"WebPage",name:"Privacy Policy - Flirtss",description:"Learn about how Flirtss protects your privacy and manages your personal information.",url:"https://flirtss.com/privacy",mainEntity:{"@type":"Article",name:"Flirtss Privacy Policy",datePublished:"2024-04-15",dateModified:"2024-04-15",author:{"@type":"Organization",name:"Flirtss"}}};return n.jsxs("div",{className:"policy-page-container",dir:e,children:[n.jsx(nr,{title:"Privacy Policy",description:"Learn how Mandarin Dating protects your personal information, what data we collect, and your privacy rights when using our service.",schema:s}),n.jsx("header",{className:"modern-header",children:n.jsx("div",{className:"container header-container",children:n.jsx(ot,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),n.jsx("div",{className:"policy-content container py-5",children:n.jsx("div",{className:"row justify-content-center",children:n.jsx("div",{className:"col-12 col-lg-10",children:n.jsxs("div",{className:"policy-card",children:[n.jsx("h1",{className:"policy-title gradient-text",children:t("privacyTitle","Privacy Policy")}),n.jsxs("p",{className:"policy-last-updated",children:[t("lastUpdated","Last Updated"),": ",t("privacyUpdateDate","April 15, 2024")]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("introduction","Introduction")}),n.jsx("p",{children:t("privacyIntroContent","At Mandarin, we take your privacy seriously. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our service. Please read this policy carefully to understand our practices regarding your personal data.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("informationWeCollect","Information We Collect")}),n.jsx("p",{children:t("collectIntro","We collect several types of information to provide and improve our service to you:")}),n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{children:t("personalInformation","Personal Information")}),":",t("personalInfoDetails"," Name, email address, date of birth, gender, relationship status, and preferences.")]}),n.jsxs("li",{children:[n.jsx("strong",{children:t("profileInformation","Profile Information")}),":",t("profileInfoDetails"," Photos, bio, interests, and other details you choose to share on your profile.")]}),n.jsxs("li",{children:[n.jsx("strong",{children:t("usageInformation","Usage Information")}),":",t("usageInfoDetails"," How you interact with our service, including login times, features used, and messages sent.")]}),n.jsxs("li",{children:[n.jsx("strong",{children:t("deviceInformation","Device Information")}),":",t("deviceInfoDetails"," IP address, browser type, device type, and operating system.")]}),n.jsxs("li",{children:[n.jsx("strong",{children:t("locationInformation","Location Information")}),":",t("locationInfoDetails"," General location data based on IP address or user-provided information.")]})]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("howWeUseInformation","How We Use Your Information")}),n.jsx("p",{children:t("useIntro","We use the information we collect for various purposes, including to:")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("useProvideService","Provide, maintain, and improve our services")}),n.jsx("li",{children:t("usePersonalize","Personalize your experience and provide relevant matches")}),n.jsx("li",{children:t("useCommunicate","Communicate with you about service updates and offers")}),n.jsx("li",{children:t("useSecurity","Monitor and analyze usage patterns for security and service improvement")}),n.jsx("li",{children:t("useLegal","Comply with legal obligations and enforce our terms")})]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("informationSharing","Information Sharing and Disclosure")}),n.jsx("p",{children:t("sharingIntro","We do not sell your personal information. We may share information in the following situations:")}),n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsx("strong",{children:t("sharingConsent","With Your Consent")}),":",t("sharingConsentDetails"," When you explicitly agree to share information with other users or third parties.")]}),n.jsxs("li",{children:[n.jsx("strong",{children:t("sharingServiceProviders","Service Providers")}),":",t("sharingProvidersDetails"," With trusted third parties who assist us in operating our service, such as payment processors, cloud storage providers, and analytics services.")]}),n.jsxs("li",{children:[n.jsx("strong",{children:t("sharingLegal","Legal Requirements")}),":",t("sharingLegalDetails"," When we believe disclosure is necessary to comply with a legal obligation, protect our rights, or ensure the safety of our users.")]})]})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("dataSecurity","Data Security")}),n.jsx("p",{children:t("securityContent","We implement appropriate technical and organizational measures to protect your personal information from unauthorized access, loss, or alteration. However, no method of transmission over the Internet or electronic storage is 100% secure, and we cannot guarantee absolute security.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("yourRights","Your Rights and Choices")}),n.jsx("p",{children:t("rightsContent","Depending on your location, you may have certain rights regarding your personal information, including:")}),n.jsxs("ul",{children:[n.jsx("li",{children:t("rightsAccess","Access and review your personal information")}),n.jsx("li",{children:t("rightsCorrect","Correct inaccurate or incomplete information")}),n.jsx("li",{children:t("rightsDelete","Request deletion of your personal information")}),n.jsx("li",{children:t("rightsRestrict","Restrict or object to certain processing of your data")}),n.jsx("li",{children:t("rightsPortability","Request a copy of your data in a portable format")})]}),n.jsx("p",{children:t("rightsExercise",'To exercise these rights, please contact us using the information provided in the "Contact Us" section.')})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("cookies","Cookies and Tracking Technologies")}),n.jsx("p",{children:t("cookiesContent","We use cookies and similar tracking technologies to collect information about your browsing activities and to personalize your experience. You can control cookies through your browser settings, but disabling certain cookies may limit your ability to use some features of our service.")})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("privacyChanges","Changes to This Privacy Policy")}),n.jsx("p",{children:t("privacyChangesContent",'We may update this Privacy Policy from time to time. We will notify you of any significant changes by posting the new Privacy Policy on this page and updating the "Last Updated" date at the top.')})]}),n.jsxs("section",{className:"mb-5",children:[n.jsx("h2",{children:t("contactUs","Contact Us")}),n.jsx("p",{children:t("privacyContactContent","If you have any questions or concerns about this Privacy Policy, please contact us at:")}),n.jsxs("p",{children:["Email: privacy@mandarin.example.com",n.jsx("br",{}),"Address: 123 Privacy Street, Tel Aviv, Israel"]})]}),n.jsxs("div",{className:"policy-footer",children:[n.jsx(ot,{to:"/",className:"btn btn-outline-primary",children:t("backToHome","Back to Home")}),n.jsxs("div",{className:"policy-links",children:[n.jsx(ot,{to:"/about",children:t("aboutUs","About Us")}),n.jsx(ot,{to:"/terms",children:t("termsOfService","Terms of Service")}),n.jsx(ot,{to:"/support",children:t("contactSupport","Contact Support")})]})]})]})})})})]})},cT=De.create("Analytics"),al=kn.ANALYTICS.GA4_ID;vl.initialize(al),cT.info("GA4 Initialized with ID:",al);function lT(){const t=$n();return d.useEffect(()=>{vl.send({hitType:"pageview",page:t.pathname+t.search})},[t]),null}function dT(){cm();const e=$n().pathname.includes("/messages");return d.useEffect(()=>{ku(async()=>{const{initializeMobileOptimizations:r}=await import("./mobileInit-C7fZ3VLv.js");return{initializeMobileOptimizations:r}},[]).then(({initializeMobileOptimizations:r})=>{r()});const s=()=>{if(typeof window<"u"){const r=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${r}px`)}};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),d.useEffect(()=>{const s=r=>{document.body.classList.add("direction-changing"),document.body.offsetHeight,setTimeout(()=>document.body.classList.remove("direction-changing"),kn.ANIMATIONS.DIRECTION_CHANGE_MS);const o=document.querySelector(".Toastify");o&&(r.detail.isRTL?o.classList.add("Toastify__toast--rtl"):o.classList.remove("Toastify__toast--rtl"))};return window.addEventListener("languageDirectionChanged",s),()=>{window.removeEventListener("languageDirectionChanged",s)}},[]),n.jsx(Od,{children:n.jsx(oa,{children:n.jsx(mg,{children:n.jsx(Gg,{children:n.jsx(lm,{children:n.jsx(pg,{children:n.jsx(Eg,{children:n.jsx(Cm,{children:n.jsx(gg,{children:n.jsx(vg,{children:n.jsxs("div",{className:"app-container",style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[n.jsx(Rr,{}),n.jsx(lT,{}),n.jsx(LC,{}),n.jsx("main",{className:"main-content",style:{flexGrow:1},children:n.jsxs(mu,{children:[n.jsx(as,{path:"/",element:n.jsx(yj,{})}),n.jsx(as,{path:"/login",element:n.jsx(vk,{})}),n.jsx(as,{path:"/register",element:n.jsx(S6,{})}),n.jsx(as,{path:"/verify-email",element:n.jsx(tT,{})}),n.jsx(as,{path:"/about",element:n.jsx(sT,{})}),n.jsx(as,{path:"/safety",element:n.jsx(nT,{})}),n.jsx(as,{path:"/support",element:n.jsx(oT,{})}),n.jsx(as,{path:"/terms",element:n.jsx(iT,{})}),n.jsx(as,{path:"/privacy",element:n.jsx(aT,{})}),n.jsx(as,{path:"/dashboard",element:n.jsx(Un,{useNavigateHook:!1,children:n.jsx(i3,{})})}),n.jsx(as,{path:"/profile",element:n.jsx(Un,{useNavigateHook:!1,children:n.jsx(H3,{})})}),n.jsx(as,{path:"/messages",element:n.jsx(Un,{useNavigateHook:!1,children:n.jsx(rl,{})})}),n.jsx(as,{path:"/messages/:userId",element:n.jsx(Un,{useNavigateHook:!1,children:n.jsx(rl,{})})}),n.jsx(as,{path:"/settings",element:n.jsx(Un,{useNavigateHook:!1,children:n.jsx(mj,{})})}),n.jsx(as,{path:"/subscription",element:n.jsx(Un,{useNavigateHook:!1,children:n.jsx(eT,{})})}),n.jsx(as,{path:"*",element:n.jsx(gj,{})})]})}),n.jsx(WC,{}),!e&&n.jsx(zC,{}),n.jsx(yu,{position:kn.TOAST.POSITION,autoClose:kn.TOAST.AUTO_CLOSE_MS,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:document.documentElement.dir==="rtl",pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,limit:kn.TOAST.MAX_TOASTS,theme:"colored",className:document.documentElement.dir==="rtl"?"rtl-layout Toastify__toast--rtl":""})]})})})})})})})})})})})}const{slice:uT,forEach:hT}=[];function fT(t){return hT.call(uT.call(arguments,1),e=>{if(e)for(const s in e)t[s]===void 0&&(t[s]=e[s])}),t}function pT(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(s=>s.test(t))}const cl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,mT=function(t,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},o=encodeURIComponent(e);let i=`${t}=${o}`;if(r.maxAge>0){const c=r.maxAge-0;if(Number.isNaN(c))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(c)}`}if(r.domain){if(!cl.test(r.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${r.domain}`}if(r.path){if(!cl.test(r.path))throw new TypeError("option path is invalid");i+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");i+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(i+="; Partitioned"),i},ll={create(t,e,s,r){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};s&&(o.expires=new Date,o.expires.setTime(o.expires.getTime()+s*60*1e3)),r&&(o.domain=r),document.cookie=mT(t,encodeURIComponent(e),o)},read(t){const e=`${t}=`,s=document.cookie.split(";");for(let r=0;r<s.length;r++){let o=s[r];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(e)===0)return o.substring(e.length,o.length)}return null},remove(t){this.create(t,"",-1)}};var gT={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return ll.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:s,cookieMinutes:r,cookieDomain:o,cookieOptions:i}=e;s&&typeof document<"u"&&ll.create(s,t,r,o,i)}},yT={name:"querystring",lookup(t){var r;let{lookupQuerystring:e}=t,s;if(typeof window<"u"){let{search:o}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(o=window.location.hash.substring(window.location.hash.indexOf("?")));const c=o.substring(1).split("&");for(let l=0;l<c.length;l++){const f=c[l].indexOf("=");f>0&&c[l].substring(0,f)===e&&(s=c[l].substring(f+1))}}return s}};let zn=null;const dl=()=>{if(zn!==null)return zn;try{if(zn=typeof window<"u"&&window.localStorage!==null,!zn)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{zn=!1}return zn};var _T={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&dl())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:s}=e;s&&dl()&&window.localStorage.setItem(s,t)}};let Hn=null;const ul=()=>{if(Hn!==null)return Hn;try{if(Hn=typeof window<"u"&&window.sessionStorage!==null,!Hn)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{Hn=!1}return Hn};var vT={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&ul())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:s}=e;s&&ul()&&window.sessionStorage.setItem(s,t)}},wT={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:s,userLanguage:r,language:o}=navigator;if(s)for(let i=0;i<s.length;i++)e.push(s[i]);r&&e.push(r),o&&e.push(o)}return e.length>0?e:void 0}},bT={name:"htmlTag",lookup(t){let{htmlTag:e}=t,s;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(s=r.getAttribute("lang")),s}},xT={name:"path",lookup(t){var o;let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(s)?(o=s[typeof e=="number"?e:0])==null?void 0:o.replace("/",""):void 0}},ST={name:"subdomain",lookup(t){var o,i;let{lookupFromSubdomainIndex:e}=t;const s=typeof e=="number"?e+1:1,r=typeof window<"u"&&((i=(o=window.location)==null?void 0:o.hostname)==null?void 0:i.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[s]}};let ou=!1;try{document.cookie,ou=!0}catch{}const iu=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];ou||iu.splice(1,1);const CT=()=>({order:iu,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class au{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,s)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=fT(s,this.options||{},CT()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=o=>o.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(gT),this.addDetector(yT),this.addDetector(_T),this.addDetector(vT),this.addDetector(wT),this.addDetector(bT),this.addDetector(xT),this.addDetector(ST)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,s=[];return e.forEach(r=>{if(this.detectors[r]){let o=this.detectors[r].lookup(this.options);o&&typeof o=="string"&&(o=[o]),o&&(s=s.concat(o))}}),s=s.filter(r=>r!=null&&!pT(r)).map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?s:s.length>0?s[0]:null}cacheUserLanguage(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;s&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||s.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}au.type="languageDetector";const kT="Your email is not verified. Please verify your email address to unlock all features.",NT="Resend Verification Email",jT="Resend Email ({{cooldown}}m)",TT="Resend Email",ET="Sending...",AT="Update failed",IT="Profile photo updated successfully",$T="Marital Status",PT="Cancel",RT="Edit",LT="Loading...",OT="Error",MT="Success",BT="Online",FT="Offline",DT="Send",UT="View",qT="This photo is private",zT="Request Access",HT="Request Pending",VT="Approve",WT="Reject",GT="My Profile",YT="Edit Profile",KT="Dashboard",JT="Home",QT="About",XT="Privacy",ZT="Terms",e5="Help",t5="Back",s5="More",n5="Less",r5="Show Less",o5="Photos",i5="Add Photo",a5="Uploading...",c5="Nickname",l5="Age",d5="Location",u5="Bio",h5="About Me",f5="Identity",p5="I am",m5="Looking For",g5="Interests",y5="I'm Into",_5="Turn Ons",v5="Last active",w5="Updating photo privacy...",b5="Updating profile photo...",x5="Profile updated successfully",S5="Man",C5="Woman",k5="Couple",N5="Men",j5="Women",T5="Couples",E5="New Message",A5="Type a message...",I5="No messages yet",$5="Start a conversation",P5="Search contacts",R5="Account",L5="Notifications",O5="Language",M5="Theme",B5="Email",F5="Password",D5="Forgot Password?",U5="Don't have an account?",q5="Already have an account?",z5="Failed to update profile",H5="Failed to upload photo",V5="Failed to update photo privacy",W5="Failed to update profile photo",G5="Failed to delete photo",Y5="This field is required",K5="Please enter a valid email",J5="Discover",Q5="Explore",X5="Near You",Z5="Popular",eE="Online Now",tE="New Users",sE="Basic Information",nE="Approve photo requests",rE="You have blocked this user. They will not receive any messages from you.",oE="Disconnected",iE="Connection lost",aE="Start video call",cE="View Profile",lE="Unblock User",dE="Blocked",uE="More options",hE="Unblock",fE="Browse Users",pE="Your Matches",mE="Find Matches",gE="Loading users...",yE="Loading more users...",_E="No matches found",vE="Try adjusting your filters to see more results",wE="My Stories",bE="Create Story",xE="Filter",SE="Filters",CE="Reset",kE="Apply",NE="Show Only",jE="Range",TE="Distance",EE="Verified",AE="With Photos",IE="Dismiss",$E="Never active",PE="Preferences",RE="Error",LE="Small",OE="Medium",ME="Large",BE="Load more",FE="Close",DE="Confirm",UE="Cancel",qE="An error occurred",zE="Try again",HE="Select language",VE="Switch to Hebrew",WE="Switch to English",GE="English",YE="Hebrew",KE="Currently using:",JE="Browse and connect with new people",QE="Create a new story",XE="Grid view",ZE="List view",e8="No results found",t8="Search for users",s8="Age range",n8="Use current location",r8="km away",o8="Show more tags",i8="Show less tags",a8="Nickname is required",c8="Nickname must be at least 3 characters",l8="Nickname must be less than 50 characters",d8="Nickname can only contain letters in any language, numbers, and underscores",u8="Age is required",h8="Please enter a valid age",f8="You must be at least 18 years old",p8="Age must be less than 120 years",m8="Location is required",g8="Location must be at least 2 characters",y8="Bio must be less than 500 characters",_8="Photo privacy updated to {{status}}",v8="Photo uploaded successfully",w8="Photo deleted successfully",b8="Tell others about yourself...",x8="No bio provided",S8="No interests selected",C8="No tags selected",k8="Select up to 10 interests",N8="Select up to 20 tags",j8="Select up to 20 turn ons",T8="Select up to 3 options",E8="Married",A8="Saving...",I8="Message conversation",$8="Loading messages",P8="is typing",R8="Today at",L8="Yesterday at",O8="Toggle filters",M8="Messages from {{user}}",B8="This message has been deleted",F8="Attachment",D8="Send message",U8="Type a message...",q8="Search users",z8="Conversations",H8="Your inbox is empty",V8="Start a conversation now",W8="Write your first message",G8="Read",Y8="Sending...",K8="Send a wink instead (Free Account)",J8="Upgrade to send text messages",Q8="Upgrade to send files",X8="Message Input",Z8="Select Emoji",eA="Close emoji picker",tA="Add Emoji",sA="Send Wink",nA="Attach File",rA="Send File",oA="Search",iA="Messages",aA="Profile",cA="Settings",lA="Logout",dA="Login",uA="Register",hA="Subscription",fA="Email is required",pA="Password must be at least 8 characters",mA="Password must include at least one lowercase letter",gA="Password must include at least one uppercase letter",yA="Password must include at least one number",_A="Password must include at least one special character (@$!%*?&)",vA="Passwords do not match",wA="Password must be at least 6 characters",bA="is required",xA="An unexpected error occurred",SA="Date of birth is required",CA="You must be at least 18 years old",kA="Please enter a valid date of birth",NA="Please select who you are",jA="Location cannot exceed 100 characters",TA="Please upload a profile photo",EA="Please select your marital status",AA="Please select what you're looking for",IA="Please select no more than 3 options",$A="Please select no more than 20 'I'm into' tags",PA="Please select no more than 20 'Turn ons' tags",RA="Please select at least one interest",LA="Please select no more than 10 interests",OA="You must agree to the Terms of Service",MA="You must agree to the Privacy Policy",BA="Please upload a valid image file (JPEG, JPG or PNG)",FA="Image size should be less than 5MB",DA="Create Your Account",UA="Enter your basic information",qA="Nickname",zA="Choose a nickname",HA="Your public display name (can contain letters, numbers, and underscores)",VA="Enter your email",WA="We'll never share your email with anyone else",GA="Create a password",YA="Confirm password",KA="Must be at least 8 characters with uppercase, lowercase, number, and special character",JA="Continue",QA="Account",XA="Profile",ZA="Photo",eI="Preferences",tI="Tell Us About Yourself",sI="Add some basic profile details",nI="Date of Birth",rI="You must be at least 18 years old to use this service",oI="I am a",iI="Location",aI="City, Country",cI="Your general location (e.g., Tel Aviv, Israel)",lI="Back",dI="Upload Your Photo",uI="Add a profile photo to improve your visibility",hI="Click to upload a profile photo",fI="Photos should be clear, recent and show your face",pI="Maximum size: 5MB. Formats: JPG, JPEG, PNG",mI="Change Photo",gI="Remove",yI="Your Preferences",_I="Tell us about yourself and what you're looking for",vI="Marital Status",wI="Select your status",bI="Looking For",xI="Select up to 3 options",SI="Interests",CI="Select up to 10 interests",kI="I'm into",NI="Select up to 20 tags",jI="It turns me on",TI="Select up to 20 tags",EI="I agree to the",AI="I agree to the",II="I want to receive news and special offers (optional)",$I="Create Account",PI="Creating account...",RI="OR SIGN UP WITH",LI="Sign up with Google",OI="Sign up with Facebook",MI="You have unsaved changes. Are you sure you want to log out?",BI="Account deleted successfully",FI="Failed to delete account",DI="Failed to delete account. Please try again.",UI="Message Notifications",qI="Get notified when you receive new messages",zI="Call Notifications",HI="Get notified for incoming calls",VI="Story Notifications",WI="Get notified when friends post new stories",GI="Like Notifications",YI="Get notified when someone likes your content",KI="Comment Notifications",JI="Get notified when someone comments on your content",QI="Online Status",XI="Show when you're active on the app",ZI="Read Receipts",e$="Let others know when you've read their messages",t$="Last Seen",s$="Show when you were last active",n$="Story Replies",r$="Control who can reply to your stories",o$="Everyone",i$="No one",a$="Blocked Users",c$="Users you've blocked cannot message you or view your profile",l$="Loading blocked users...",d$="User",u$="You haven't blocked any users",h$="Theme Mode",f$="Choose how the app appears to you",p$="Light",m$="Dark",g$="System",y$="Quick Theme Toggle",_$="Quickly switch between light and dark mode",v$="Choose your preferred language",w$="Username",b$="Not available",x$="Member since",S$="Free",C$="Notification Settings",k$="Privacy Settings",N$="Appearance Settings",j$="Account Settings",T$="Save Changes",E$="This action",A$="cannot be undone",I$="All your data will be permanently deleted, including:",$$="Your profile information",P$="All messages and conversations",R$="Photos and media you've shared",L$="Stories and other content",O$="Enter your password to confirm:",M$="Your password",B$="Delete My Account",F$="Please enter your password to confirm account deletion",D$="Loading your settings...",U$="Hide password",q$="Show password",z$="Confirm Password",H$="OR",V$="Email Address",W$="Welcome to Mandarin! Your account has been created successfully.",G$="Sign In",Y$="Sign Up",K$="Sign in with",J$="Don't have an account?",Q$="Remember me",X$="Compatibility",Z$="Loading profile...",eP="Unknown error",tP="Close",sP="Not found",nP="User not found",rP="Allow private photos",oP="Previous",iP="Next",aP="Pending",cP="No photos available",lP="Liked",dP="Like",uP="Message",hP="More actions",fP="Report user",pP="Block user",mP="Premium",gP="Unknown location",yP="Show more",_P="Verification token is missing",vP="Your account has been successfully verified",wP="Email verification failed",bP="Verification email has been sent",xP="Please login to resend verification email",SP="Verify Email",CP="Verifying your email address...",kP="Verification Successful",NP="Go to",jP="Back to Login",TP="עברית",EP="English",AP="Privacy First",IP="Your privacy is our top priority. Control who sees your profile and what information you share.",$P="Secure Communication",PP="End‑to‑end encrypted messaging ensures your conversations remain private and secure.",RP="Smart Matching",LP="Our advanced algorithm connects you with people who match your preferences and interests.",OP="Find Your Perfect Connection",MP="Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful encounters.",BP="Enter your email",FP="Get Started",DP="People Online Now",UP="Connect with these amazing people who are currently active on Mandarin",qP="Not specified",zP="Join to See More",HP="Why Choose Mandarin",VP="Are you sure you want to delete this photo?",WP="You cannot delete your profile photo. Please set another photo as your profile photo first.",GP="No photos available",YP="Photo",KP="Photo",JP="Previous photo",QP="Next photo",XP="Make public",ZP="Make private",eR="Friends Only",tR="Profile",sR="Set as profile photo",nR="Set as profile photo",rR="Delete photo",oR="Notifications",iR="Mark all read",aR="Refresh",cR="Refreshing...",lR="No unread notifications",dR="No notifications yet",uR="No {{filter}} notifications",hR="Real-time updates paused",fR="Reconnect",pR="Failed to fetch subscription data",mR="Successfully upgraded your subscription",gR="Payment processing failed",yR="Back to Dashboard",_R="Premium Membership",vR="You Already Have Premium Access",wR="Enjoy all premium features with your current account!",bR="Unlock Premium Features",xR="Upgrade your experience with Premium access",SR="Monthly",CR="Yearly",kR="Save",NR="Free",jR="Forever",TR="Current Plan",ER="Most Popular",AR="Premium",IR="per month",$R="per month, billed yearly",PR="View Profiles",RR="Send Winks",LR="Limited Likes",OR="Limited Stories",MR="Unlimited Likes",BR="Unlimited Stories",FR="Video Calls",DR="Priority in Search Results",UR="Processing...",qR="Subscribe Now",zR="Support Center",HR="Contact Us",VR="FAQ",WR="Live Chat",GR="Available 9AM-6PM IST",YR="Send Us a Message",KR="Thank you! Your message has been sent. We'll get back to you soon.",JR="Your Name",QR="Email Address",XR="Subject",ZR="Message",e7="Send Message",t7="Frequently Asked Questions",s7="Back to Home",n7="About Us",r7="Privacy Policy",o7="Terms of Service",i7="How do I create an account?",a7="To create an account, click on the 'Register' button on the homepage. Fill out your details, upload a profile photo, and set your preferences. Once you verify your email, your account will be activated.",c7="How can I change my account settings?",l7="Navigate to the 'Settings' page after logging in. There, you can update your profile information, notification preferences, privacy settings, and account details.",d7="Is my personal information secure?",u7="Yes, we take security very seriously. We use encryption to protect your data and never share your personal information with third parties without your consent. For more details, please review our Privacy Policy.",h7="How do I cancel my subscription?",f7="To cancel your subscription, go to 'Settings > Subscription' and click on 'Cancel Subscription'. Your premium benefits will remain active until the end of your current billing period.",p7="How can I report inappropriate behavior?",m7="If you encounter inappropriate behavior, use the 'Report' button on the user's profile or in the message thread. Our moderation team will review the report and take appropriate action within 24 hours.",g7="What should I do if I forget my password?",y7="On the login page, click 'Forgot Password'. Enter your email address, and we'll send you instructions to reset your password. For security reasons, the reset link expires after 24 hours.",_7="How do I delete my account?",v7="Go to 'Settings > Account' and scroll to the bottom where you'll find the 'Delete Account' option. Please note that account deletion is permanent and cannot be undone.",w7="Online Fun",b7="Camera Chat",x7="In a Public Place",S7="Leather/Latex Clothing",C7="Power Play",k7="Sensual Massage",N7="Risk Taking",j7="Dirty Talk",T7="Music",E7="Single",A7="Married",I7="Divorced",$7="Separated",P7="In a Relationship",R7="Consensual Non-Monogamy",L7="Role Play",O7="BDSM",M7="Gentle Touch",B7="Intense Passion",F7="Outdoor Adventure",D7="Intellectual Discussion",U7="Foodie",q7="Art Lover",z7="Fitness Enthusiast",H7="Movie Buff",V7="Travel Addict",W7="Tech Geek",G7="Nature Lover",Y7="Social Butterfly",K7="Homebody",J7="Spontaneous",Q7="Planner",X7="Night Owl",Z7="Early Bird",e9="Casual",t9="Serious Relationship",s9="Friendship",n9="Networking",r9="Dominant",o9="Submissive",i9="Switch",a9="Vanilla",c9="Kinky",l9="Experimental",d9="Voyeurism",u9="Exhibitionism",h9="Toys",f9="Blindfolds",p9="Restraints",m9="Toys",g9="Costumes",y9="Meetups",_9="Threesomes",v9="Cuckold",w9="Humiliation",b9="Crossdressing",x9="Worship",S9="Oral",C9="Massages",k9="Foreplay",N9="Bizarre",j9="Education",T9="Experiences",E9="Tantra",A9="Aggressive",I9="Pampering",$9="Teasing",P9="Kink",R9="Comedy",L9="Spirituality",O9="Community",M9="Watching",B9="Parties",F9="Lingerie",D9="Voice",U9="Kindness",q9="Dancing",z9="Creativity",H9="Success",V9="Pets",W9="Casual",G9="Dating",Y9="Friendship",K9="Travel",J9="Outdoors",Q9="Movies",X9="Music",Z9="Fitness",eL="Food",tL="Art",sL="Reading",nL="Gaming",rL="Photography",oL="Cooking",iL="Create Your Account",aL="Account",cL="Profile",lL="Photo",dL="Preferences",uL="Enter your basic information",hL="Choose a nickname",fL="Your public display name (can contain letters in any language, numbers, and underscores)",pL="Enter your email",mL="We'll never share your email with anyone else",gL="Create a password",yL="Must be at least 8 characters with uppercase, lowercase, number, and special character",_L="OR SIGN UP WITH",vL="Sign up with Google",wL="Sign up with Facebook",bL="Safety",xL="Support",SL="All rights reserved.",CL="Add some basic profile details",kL="I am a",NL="City, Country",jL="Your general location (e.g., Tel Aviv, Israel)",TL="Date of Birth",EL="You must be at least 18 years old to use this service",AL="Upload Your Photo",IL="Add a profile photo to improve your visibility",$L="Click to upload a profile photo",PL="Photos should be clear, recent and show your face",RL="Maximum size: 5MB. Formats: JPG, JPEG, PNG",LL="Change Photo",OL="Remove",ML="Your Preferences",BL="Tell us about yourself and what you're looking for",FL="Select your status",DL="Select up to 3 options",UL="Select up to 10 interests",qL="Sports",zL="I'm into",HL="Select up to 20 tags",VL="It turns me on",WL="Select up to 20 tags",GL="I agree to the",YL="I agree to the",KL="I want to receive news and special offers (optional)",JL="Create Account",QL="Single",XL="Married",ZL="Divorced",eO="Separated",tO="Widowed",sO="Polyamorous",nO={verificationNeeded:kT,resendVerificationEmail:NT,resendEmailCooldown:jT,resendEmail:TT,sending:ET,updateFailed:AT,profilePhotoUpdated:IT,maritalStatus:$T,cancel:PT,delete:"Delete",edit:RT,loading:LT,error:OT,success:MT,online:BT,offline:FT,send:DT,view:UT,privatePhoto:qT,requestAccess:zT,requestPending:HT,approve:VT,reject:WT,myProfile:GT,editProfile:YT,dashboard:KT,home:JT,about:QT,privacy:XT,terms:ZT,help:e5,back:t5,more:s5,less:n5,showLess:r5,photos:o5,addPhoto:i5,uploading:a5,nickname:c5,age:l5,location:d5,bio:u5,aboutMe:h5,identity:f5,iAm:p5,lookingFor:m5,interests:g5,intoTags:y5,turnOns:_5,lastActive:v5,updatingPhotoPrivacy:w5,updatingProfilePhoto:b5,profileUpdated:x5,man:S5,woman:C5,couple:k5,men:N5,women:j5,couples:T5,newMessage:E5,typeMessage:A5,noMessages:I5,startConversation:$5,searchContacts:P5,account:R5,notifications:L5,language:O5,theme:M5,email:B5,password:F5,forgotPassword:D5,noAccount:U5,haveAccount:q5,profileUpdateFailed:z5,photoUploadFailed:H5,photoPrivacyUpdateFailed:V5,profilePhotoUpdateFailed:W5,photoDeleteFailed:G5,required:Y5,invalidEmail:K5,discover:J5,explore:Q5,nearYou:X5,popular:Z5,onlineNow:eE,newUsers:tE,basicInfo:sE,approvePhotoRequests:nE,blockedUserMessage:rE,disconnected:oE,connectionLost:iE,startVideoCall:aE,viewProfile:cE,unblockUser:lE,blocked:dE,moreOptions:uE,unblock:hE,browseUsers:fE,yourMatches:pE,findMatches:mE,loadingUsers:gE,loadingMoreUsers:yE,noMatches:_E,tryAdjustingFilters:vE,myStories:wE,createStory:bE,filter:xE,filters:SE,reset:CE,apply:kE,showOnly:NE,range:jE,distance:TE,verified:EE,withPhotos:AE,dismiss:IE,inactive:$E,preferences:PE,errorTitle:RE,smallSize:LE,mediumSize:OE,largeSize:ME,loadMoreButton:BE,closeButton:FE,confirmButton:DE,cancelButton:UE,errorOccurred:qE,tryAgain:zE,languageSelect:HE,switchToHebrew:VE,switchToEnglish:WE,english:GE,hebrew:YE,currentlyUsing:KE,browseAndConnect:JE,createNewStory:QE,gridView:XE,listView:ZE,noResultsFound:e8,searchForUsers:t8,ageRange:s8,useCurrentLocation:n8,kmAway:r8,showMoreTags:o8,showLessTags:i8,nicknameRequired:a8,nicknameTooShort:c8,nicknameTooLong:l8,nicknameInvalid:d8,ageRequired:u8,ageInvalid:h8,ageMinimum:f8,ageMaximum:p8,locationRequired:m8,locationTooShort:g8,bioTooLong:y8,photoPrivacySuccess:_8,photoUploadSuccess:v8,photoDeleteSuccess:w8,tellAboutYourself:b8,noBioProvided:x8,noInterestsSelected:S8,noTagsSelected:C8,interestsLimit:k8,intoTagsLimit:N8,turnOnsLimit:j8,lookingForLimit:T8,maritalStatusMarried:E8,saving:A8,messageConversation:I8,loadingMessages:$8,typing:P8,todayAt:R8,yesterdayAt:L8,toggleFilters:O8,messagesFrom:M8,messageDeleted:B8,messageAttachment:F8,sendMessage:D8,messagePlaceholder:U8,searchUsers:q8,conversations:z8,emptyInbox:H8,startConversationNow:V8,writeFirstMessage:W8,readReceipt:G8,sendingMessage:Y8,freeAccountWink:K8,upgradeToSendText:J8,upgradeToSendFiles:Q8,messageInput:X8,selectEmoji:Z8,closeEmojiPicker:eA,addEmoji:tA,sendWink:sA,attachFile:nA,sendFile:rA,search:oA,messages:iA,profile:aA,settings:cA,logout:lA,login:dA,register:uA,subscription:hA,emailRequired:fA,passwordLengthError:pA,passwordLowercaseError:mA,passwordUppercaseError:gA,passwordNumberError:yA,passwordSpecialError:_A,passwordMatchError:vA,passwordRequirements:wA,validationError:bA,generalError:xA,dateOfBirthRequired:SA,ageRestriction:CA,invalidDateOfBirth:kA,selectIdentity:NA,locationTooLong:jA,profilePhotoRequired:TA,maritalStatusRequired:EA,selectLookingFor:AA,tooManyLookingFor:IA,tooManyIntoTags:$A,tooManyTurnOns:PA,interestsRequired:RA,tooManyInterests:LA,termsRequired:OA,privacyRequired:MA,uploadTypeMismatch:BA,uploadSizeLimitExceeded:FA,registerCreateAccount:DA,registerEnterBasicInfo:UA,registerNickname:qA,registerChooseNickname:zA,registerNicknameHelp:HA,registerEnterEmail:VA,registerEmailHelp:WA,registerCreatePassword:GA,registerConfirmPassword:YA,registerPasswordHelp:KA,registerContinue:JA,registerAccountStep:QA,registerProfileStep:XA,registerPhotoStep:ZA,registerPreferencesStep:eI,registerTellAboutYourself:tI,registerAddBasicProfileDetails:sI,registerDateOfBirth:nI,registerDateOfBirthHelp:rI,registerIAmA:oI,registerLocation:iI,registerLocationPlaceholder:aI,registerLocationHelp:cI,registerBack:lI,registerUploadYourPhoto:dI,registerImproveVisibility:uI,registerClickToUpload:hI,registerProfileImageHelp:fI,registerProfileImageSize:pI,registerChangePhoto:mI,registerRemovePhoto:gI,registerYourPreferences:yI,registerTellWhatLooking:_I,registerMaritalStatus:vI,registerSelectStatus:wI,registerLookingFor:bI,registerLookingForHelp:xI,registerInterests:SI,registerInterestsHelp:CI,registerImInto:kI,registerImIntoHelp:NI,registerTurnsMeOn:jI,registerTurnsMeOnHelp:TI,registerTermsAgreement:EI,registerPrivacyAgreement:AI,registerNewsletterAgreement:II,registerCreateBtn:$I,registerCreatingAccount:PI,registerSignUpWith:RI,registerSignUpGoogle:LI,registerSignUpFacebook:OI,unsavedChangesLogout:MI,accountDeletedSuccess:BI,deleteAccountFailed:FI,deleteAccountFailedRetry:DI,messageNotifications:UI,messageNotificationsDesc:qI,callNotifications:zI,callNotificationsDesc:HI,storyNotifications:VI,storyNotificationsDesc:WI,likeNotifications:GI,likeNotificationsDesc:YI,commentNotifications:KI,commentNotificationsDesc:JI,onlineStatus:QI,onlineStatusDesc:XI,readReceipts:ZI,readReceiptsDesc:e$,lastSeen:t$,lastSeenDesc:s$,storyReplies:n$,storyRepliesDesc:r$,everyone:o$,noOne:i$,blockedUsers:a$,blockedUsersDesc:c$,loadingBlockedUsers:l$,defaultUser:d$,noBlockedUsers:u$,themeMode:h$,themeModeDesc:f$,light:p$,dark:m$,system:g$,quickThemeToggle:y$,quickThemeToggleDesc:_$,languageDesc:v$,username:w$,notAvailable:b$,memberSince:x$,freePlan:S$,notificationSettings:C$,privacySettings:k$,appearanceSettings:N$,accountSettings:j$,saveChanges:T$,deleteWarning:E$,cannotBeUndone:A$,deleteDataWarning:I$,profileInformation:$$,messagesAndConversations:P$,photosAndMedia:R$,storiesAndContent:L$,enterPasswordConfirm:O$,yourPassword:M$,deleteMyAccount:B$,passwordRequired:F$,loadingSettings:D$,hidePassword:U$,showPassword:q$,confirmPassword:z$,or:H$,emailAddress:V$,registerSuccess:W$,signIn:G$,signUp:Y$,signInWith:K$,dontHaveAccount:J$,rememberMe:Q$,compatibility:X$,loadingProfile:Z$,errorUnknown:eP,close:tP,notFound:sP,userNotFound:nP,allowPrivatePhotos:rP,previous:oP,next:iP,requestAccessPending:aP,noPhotosAvailable:cP,liked:lP,like:dP,message:uP,moreActions:hP,reportUser:fP,blockUser:pP,premium:mP,unknownLocation:gP,showMore:yP,tokenMissing:_P,accountVerified:vP,verificationFailed:wP,verificationEmailSent:bP,loginToResend:xP,verifyEmail:SP,verifyingEmail:CP,verificationSuccess:kP,goBack:NP,backToLogin:jP,languageHebrew:TP,languageEnglish:EP,privacyFirst:AP,privacyDescription:IP,secureTitle:$P,secureCommDescription:PP,matchTitle:RP,smartMatchingDescription:LP,findYourConnection:OP,heroSubtitle:MP,emailPlaceholder:BP,getStarted:FP,peopleOnlineNow:DP,onlineNowSubtitle:UP,notSpecified:qP,joinToSeeMore:zP,featuresTitle:HP,confirmDeletePhoto:VP,cannotDeleteProfilePhoto:WP,noPhotos:GP,photo:YP,photoThumbnail:KP,previousPhoto:JP,nextPhoto:QP,makePublic:XP,makePrivate:ZP,private:"Private",friendsOnly:eR,profilePhoto:tR,setAsProfilePhoto:sR,setAsProfile:nR,deletePhoto:rR,notificationsTitle:oR,markAllRead:iR,refresh:aR,refreshing:cR,noUnreadNotifications:lR,noNotifications:dR,noFilteredNotifications:uR,updatesPaused:hR,reconnect:fR,fetchFailed:pR,upgradeSuccess:mR,paymentFailed:gR,backToDashboard:yR,premiumMembership:_R,alreadyPremium:vR,enjoyFeatures:wR,unlockFeatures:bR,upgradeExperience:xR,monthly:SR,yearly:CR,save:kR,freeTier:NR,forever:jR,currentPlan:TR,mostPopular:ER,paidTier:AR,perMonth:IR,perMonthYearly:$R,viewProfiles:PR,sendWinks:RR,limitedLikes:LR,limitedStories:OR,unlimitedLikes:MR,unlimitedStories:BR,videoCalls:FR,prioritySearch:DR,processing:UR,subscribe:qR,supportTitle:zR,contactUs:HR,faq:VR,liveChat:WR,liveChatHours:GR,contactForm:YR,formSuccess:KR,formName:JR,formEmail:QR,formSubject:XR,formMessage:ZR,formSubmit:e7,frequentlyAskedQuestions:t7,backToHome:s7,aboutUs:n7,privacyPolicy:r7,termsOfService:o7,faq1Question:i7,faq1Answer:a7,faq2Question:c7,faq2Answer:l7,faq3Question:d7,faq3Answer:u7,faq4Question:h7,faq4Answer:f7,faq5Question:p7,faq5Answer:m7,faq6Question:g7,faq6Answer:y7,faq7Question:_7,faq7Answer:v7,tag_online_fun:w7,tag_camera_chat:b7,tag_in_a_public_place:x7,tag_leather_latex_clothing:S7,tag_power_play:C7,tag_sensual_massage:k7,tag_risktaking:N7,tag_dirty_talk:j7,tag_music:T7,tag_single:E7,tag_married:A7,tag_divorced:I7,tag_separated:$7,tag_relationship:P7,tag_consensual_non_monogamy:R7,tag_role_play:L7,tag_bdsm:O7,tag_gentle_touch:M7,tag_intense_passion:B7,tag_outdoor_adventure:F7,tag_intellectual_discussion:D7,tag_foodie:U7,tag_art_lover:q7,tag_fitness_enthusiast:z7,tag_movie_buff:H7,tag_travel_addict:V7,tag_tech_geek:W7,tag_nature_lover:G7,tag_social_butterfly:Y7,tag_homebody:K7,tag_spontaneous:J7,tag_planner:Q7,tag_night_owl:X7,tag_early_bird:Z7,tag_casual:e9,tag_serious_relationship:t9,tag_friendship:s9,tag_networking:n9,tag_dominant:r9,tag_submissive:o9,tag_switch:i9,tag_vanilla:a9,tag_kinky:c9,tag_experimental:l9,tag_voyeurism:d9,tag_exhibitionism:u9,tag_toys:h9,tag_blindfolds:f9,tag_restraints:p9,"Fantasy fulfillment":"Fantasy fulfillment","Fantasy sharing":"Fantasy sharing",Toys:m9,"Weekend getaways":"Weekend getaways",Costumes:g9,Meetups:y9,"Power play":"Power play",Threesomes:_9,"Online fun":"Online fun","Hot chat":"Hot chat","Photo sharing":"Photo sharing","Camera chat":"Camera chat",Cuckold:v9,"Golden showers":"Golden showers","Strap-on":"Strap-on","Forced bi":"Forced bi","Erotic domination":"Erotic domination",Humiliation:w9,Crossdressing:b9,Worship:x9,"Foot fetish":"Foot fetish",Oral:S9,"From behind":"From behind","Role-play":"Role-play",Massages:C9,Foreplay:k9,"Casual meetups":"Casual meetups",Bizarre:N9,Education:j9,Experiences:T9,Tantra:E9,"Sexy ass":"Sexy ass","Dirty talk":"Dirty talk",Aggressive:A9,"Slow and gentle":"Slow and gentle","In a public place":"In a public place",Pampering:I9,"Sexy clothing":"Sexy clothing","Leather/latex clothing":"Leather/latex clothing","Watching porn":"Watching porn","Fit body":"Fit body","Bathing together":"Bathing together","Erotic writing":"Erotic writing","Eye contact":"Eye contact","Being pampered":"Being pampered","Sexy legs":"Sexy legs",Teasing:$9,"Pushing boundaries":"Pushing boundaries",Kink:P9,Comedy:R9,Spirituality:L9,Community:O9,Watching:M9,Parties:B9,"Outdoor adventures":"Outdoor adventures","Hotel fun":"Hotel fun",Lingerie:F9,Voice:D9,Kindness:U9,Dancing:q9,Creativity:z9,Success:H9,Pets:V9,Casual:W9,"Long-term":"Long-term",Dating:G9,Friendship:Y9,Travel:K9,Outdoors:J9,Movies:Q9,Music:X9,Fitness:Z9,Food:eL,Art:tL,Reading:sL,Gaming:nL,Photography:rL,Cooking:oL,createAccount:iL,accountStep:aL,profileStep:cL,photoStep:lL,preferencesStep:dL,enterBasicInfo:uL,chooseNickname:hL,nicknameHelp:fL,enterEmail:pL,emailHelp:mL,createPassword:gL,passwordHelp:yL,continue:"Continue",signUpWith:_L,signUpGoogle:vL,signUpFacebook:wL,safety:bL,contactSupport:xL,allRightsReserved:SL,addBasicProfileDetails:CL,iAmA:kL,locationPlaceholder:NL,locationHelp:jL,dateOfBirth:TL,dateOfBirthHelp:EL,uploadYourPhoto:AL,improveVisibility:IL,clickToUpload:$L,profileImageHelp:PL,profileImageSize:RL,changePhoto:LL,removePhoto:OL,yourPreferences:ML,tellWhatLooking:BL,selectStatus:FL,lookingForHelp:DL,interestsHelp:UL,Sports:qL,imInto:zL,imIntoHelp:HL,turnsMeOn:VL,turnsMeOnHelp:WL,termsAgreement:GL,privacyAgreement:YL,newsletterAgreement:KL,createBtn:JL,Single:QL,Married:XL,Divorced:ZL,Separated:eO,Widowed:tO,"In a relationship":"In a relationship","It's complicated":"It's complicated","Open relationship":"Open relationship",Polyamorous:sO},rO="המייל שלך לא מאומת. בבקשה לאמת את כתובת המייל כדי לפתוח את כל הפיצ'רים.",oO="שלח/י מחדש מייל אימות",iO="שליחה חוזרת של מייל ({{cooldown}} דקות)",aO="שליחה חוזרת של מייל",cO="שולח...",lO="העדכון נכשל",dO="תמונת הפרופיל עודכנה בהצלחה",uO="סטטוס זוגי",hO="ביטול",fO="עריכה",pO="טוען...",mO="שגיאה",gO="הצלחה",yO="מחובר",_O="לא מחובר",vO="שלח",wO="צפה",bO="הפרופיל שלי",xO="עריכת פרופיל",SO="דאשבורד",CO="בית",kO="אודות",NO="פרטיות",jO="תנאים",TO="עזרה",EO="אחורה",AO="עוד",IO="פחות",$O="הצג פחות",PO="תמונות",RO="הוסף תמונה",LO="מעלה...",OO="כינוי",MO="גיל",BO="מיקום",FO="ביו",DO="עליי",UO="זהות",qO="אני",zO="מחפש/ת",HO="תחומי עניין",VO="אני בקטע של",WO="מה שמדליק אותי",GO="פעילות אחרונה",YO="מעדכן פרטיות תמונה...",KO="מעדכן תמונת פרופיל...",JO="הפרופיל עודכן בהצלחה",QO="גבר",XO="אישה",ZO="זוג",eM="גברים",tM="נשים",sM="זוגות",nM="הודעה חדשה",rM="הקלד/י הודעה...",oM="אין הודעות עדיין",iM="התחל/י שיחה",aM="חפש/י אנשי קשר",cM="חשבון",lM="התראות",dM="שפה",uM="ערכת נושא",hM="מייל",fM="סיסמה",pM="שכחת סיסמה?",mM="אין לך חשבון?",gM="יש לך כבר חשבון?",yM="עדכון הפרופיל נכשל",_M="העלאת התמונה נכשלה",vM="עדכון פרטיות התמונה נכשל",wM="עדכון תמונת הפרופיל נכשל",bM="מחיקת התמונה נכשלה",xM="שדה חובה",SM="נא להזין כתובת מייל תקינה",CM="גילוי",kM="חקור/י",NM="קרוב אלייך",jM="פופולרי",TM="מחוברים עכשיו",EM="משתמשים חדשים",AM="מידע בסיסי",IM="אשר/י בקשות לתמונות",$M="חסמת את המשתמש/ת הזה. הוא/היא לא יקבלו ממך הודעות.",PM="מנותק",RM="החיבור אבד",LM="התחל/י שיחת וידאו",OM="צפה בפרופיל",MM="בטל/י חסימת משתמש",BM="חסום",FM="אפשרויות נוספות",DM="בטל חסימה",UM="דפדוף במשתמשים",qM="ההתאמות שלך",zM="מצא/י התאמות",HM="טוען משתמשים...",VM="טוען עוד משתמשים...",WM="לא נמצאו התאמות",GM="נסה/י לשנות את הפילטרים כדי לראות עוד תוצאות",YM="הסטוריז שלי",KM="צור/י סטורי",JM="סנן",QM="פילטרים",XM="איפוס",ZM="החל",eB="הצג רק",tB="טווח",sB="מרחק",nB="מאומת",rB="עם תמונות",oB="התעלם/י",iB="לא פעיל/ה אף פעם",aB="העדפות",cB="שגיאה",lB="קטן",dB="בינוני",uB="גדול",hB="טען עוד",fB="סגור",pB="אישור",mB="ביטול",gB="אירעה שגיאה",yB="נסה/י שוב",_B="בחר/י שפה",vB="החלף לעברית",wB="החלף לאנגלית",bB="אנגלית",xB="עברית",SB="כרגע בשימוש:",CB="דפדף/י והתחבר/י עם אנשים חדשים",kB="צור/י סטורי חדש",NB="תצוגת רשת",jB="תצוגת רשימה",TB="לא נמצאו תוצאות",EB="חפש/י משתמשים",AB="טווח גילאים",IB="השתמש/י במיקום הנוכחי",$B='ק"מ ממך',PB="הצג עוד תגיות",RB="הצג פחות תגיות",LB="כינוי הוא שדה חובה",OB="הכינוי חייב להיות לפחות 3 תווים",MB="הכינוי חייב להיות פחות מ-50 תווים",BB="הכינוי יכול להכיל רק אותיות בכל שפה, מספרים וקווים תחתונים",FB="גיל הוא שדה חובה",DB="נא להזין גיל תקין",UB="חייב/ת להיות לפחות בן/בת 18",qB="הגיל חייב להיות פחות מ-120",zB="מיקום הוא שדה חובה",HB="המיקום חייב להיות לפחות 2 תווים",VB="הביו חייב להיות פחות מ-500 תווים",WB="פרטיות התמונה עודכנה ל{{status}}",GB="התמונה הועלתה בהצלחה",YB="התמונה נמחקה בהצלחה",KB="ספר/י לאחרים על עצמך...",JB="לא סופק ביו",QB="לא נבחרו תחומי עניין",XB="לא נבחרו תגיות",ZB="בחר/י עד 10 תחומי עניין",eF="בחר/י עד 20 תגיות",tF="בחר/י עד 20 דברים שמדליקים אותך",sF="בחר/י עד 3 אפשרויות",nF="נשוי/אה",rF="שומר...",oF="שיחת הודעות",iF="טוען הודעות...",aF="מקליד/ה...",cF="היום ב",lF="אתמול ב",dF="החלף פילטרים",uF="הודעות מ{{user}}",hF="ההודעה הזו נמחקה",fF="קובץ מצורף",pF="שלח/י הודעה",mF="הקלד/י הודעה...",gF="חפש/י משתמשים",yF="שיחות",_F="תיבת הדואר הנכנס שלך ריקה",vF="התחל/י שיחה עכשיו",wF="כתוב/י את ההודעה הראשונה שלך",bF="נקרא",xF="שולח הודעה...",SF="שלח/י קריצה במקום (חשבון חינמי)",CF="שדרג/י כדי לשלוח הודעות טקסט",kF="שדרג/י כדי לשלוח קבצים",NF="קלט הודעה",jF="בחר/י אימוג'י",TF="סגור/י בורר אימוג'י",EF="הוסף/י אימוג'י",AF="שלח/י קריצה",IF="צרף/י קובץ",$F="שלח/י קובץ",PF="חיפוש",RF="הודעות",LF="פרופיל",OF="הגדרות",MF="התנתק/י",BF="התחבר/י",FF="הרשמה",DF="מנוי",UF="מייל הוא שדה חובה",qF="הסיסמה חייבת להיות לפחות 8 תווים",zF="הסיסמה חייבת לכלול לפחות אות קטנה אחת",HF="הסיסמה חייבת לכלול לפחות אות גדולה אחת",VF="הסיסמה חייבת לכלול לפחות מספר אחד",WF="הסיסמה חייבת לכלול לפחות תו מיוחד אחד (@$!%*?&)",GF="הסיסמאות לא תואמות",YF="הסיסמה חייבת להיות לפחות 6 תווים",KF="הוא שדה חובה",JF="אירעה שגיאה לא צפויה",QF="תאריך לידה הוא שדה חובה",XF="חייב/ת להיות לפחות בן/בת 18",ZF="נא להזין תאריך לידה תקין",eD="נא לבחור מי את/ה",tD="המיקום לא יכול להיות ארוך מ-100 תווים",sD="נא להעלות תמונת פרופיל",nD="נא לבחור סטטוס זוגי",rD="נא לבחור מה את/ה מחפש/ת",oD="נא לבחור לא יותר מ-3 אפשרויות",iD="נא לבחור לא יותר מ-20 תגיות 'אני בקטע של'",aD="נא לבחור לא יותר מ-20 תגיות 'מה שמדליק אותי'",cD="נא לבחור לפחות תחום עניין אחד",lD="נא לבחור לא יותר מ-10 תחומי עניין",dD="חובה להסכים לתנאי השירות",uD="חובה להסכים למדיניות הפרטיות",hD="נא להעלות קובץ תמונה תקין (JPEG, JPG או PNG)",fD="גודל התמונה צריך להיות פחות מ-5MB",pD="צור/י את החשבון שלך",mD="הזן/י את המידע הבסיסי שלך",gD="כינוי",yD="בחר/י כינוי",_D="שם התצוגה הציבורי שלך (יכול להכיל אותיות, מספרים וקווים תחתונים)",vD="הזן/י את המייל שלך",wD="לעולם לא נשתף את המייל שלך עם אף אחד אחר",bD="צור/י סיסמה",xD="אשר/י סיסמה",SD="חייב להיות לפחות 8 תווים עם אות גדולה, אות קטנה, מספר ותו מיוחד",CD="המשך/י",kD="חשבון",ND="פרופיל",jD="תמונה",TD="העדפות",ED="ספר/י לנו על עצמך",AD="הוסף/י כמה פרטי פרופיל בסיסיים",ID="תאריך לידה",$D="חייב/ת להיות לפחות בן/בת 18 כדי להשתמש בשירות זה",PD="אני",RD="מיקום",LD="עיר, מדינה",OD="המיקום הכללי שלך (למשל, תל אביב, ישראל)",MD="אחורה",BD="העלה/י את התמונה שלך",FD="הוסף/י תמונת פרופיל כדי לשפר את הנראות שלך",DD="לחץ/י להעלאת תמונת פרופיל",UD="התמונות צריכות להיות ברורות, עדכניות ולהציג את הפנים שלך",qD="גודל מקסימלי: 5MB. פורמטים: JPG, JPEG, PNG",zD="שנה/י תמונה",HD="הסר/י",VD="ההעדפות שלך",WD="ספר/י לנו על עצמך ומה את/ה מחפש/ת",GD="סטטוס זוגי",YD="בחר/י את הסטטוס שלך",KD="מחפש/ת",JD="בחר/י עד 3 אפשרויות",QD="תחומי עניין",XD="בחר/י עד 10 תחומי עניין",ZD="אני בקטע של",eU="בחר/י עד 20 תגיות",tU="זה מדליק אותי",sU="בחר/י עד 20 תגיות",nU="אני מסכים/ה ל",rU="אני מסכים/ה ל",oU="אני רוצה לקבל חדשות והצעות מיוחדות (אופציונלי)",iU="צור/י חשבון",aU="יוצר חשבון...",cU="או הירשם/י עם",lU="הירשם/י עם גוגל",dU="הירשם/י עם פייסבוק",uU="יש לך שינויים שלא נשמרו. בטוח שאת/ה רוצה להתנתק?",hU="החשבון נמחק בהצלחה",fU="מחיקת החשבון נכשלה",pU="מחיקת החשבון נכשלה. נסה/י שוב.",mU="התראות על הודעות",gU="קבל/י התראה כשאת/ה מקבל/ת הודעות חדשות",yU="התראות על שיחות",_U="קבל/י התראה על שיחות נכנסות",vU="התראות על סטוריז",wU="קבל/י התראה כשחברים מפרסמים סטוריז חדשים",bU="התראות על לייקים",xU="קבל/י התראה כשמישהו עושה לייק לתוכן שלך",SU="התראות על תגובות",CU="קבל/י התראה כשמישהו מגיב לתוכן שלך",kU="סטטוס מחובר/ת",NU="הצג/י מתי את/ה פעיל/ה באפליקציה",jU="אישורי קריאה",TU="תן/י לאחרים לדעת מתי קראת את ההודעות שלהם",EU="נראה/תה לאחרונה",AU="הצג/י מתי היית פעיל/ה לאחרונה",IU="תגובות לסטורי",$U="שלוט/י מי יכול להגיב לסטוריז שלך",PU="כולם",RU="אף אחד",LU="משתמשים חסומים",OU="משתמשים שחסמת לא יכולים לשלוח לך הודעות או לראות את הפרופיל שלך",MU="טוען משתמשים חסומים...",BU="משתמש/ת",FU="עדיין לא חסמת אף משתמש/ת",DU="מצב ערכת נושא",UU="בחר/י איך האפליקציה תיראה לך",qU="בהיר",zU="כהה",HU="מערכת",VU="החלפה מהירה של ערכת נושא",WU="החלף/י במהירות בין מצב בהיר לכהה",GU="בחר/י את השפה המועדפת עליך",YU="שם משתמש",KU="לא זמין",JU="חבר/ה מאז",QU="חינם",XU="הגדרות התראות",ZU="הגדרות פרטיות",eq="הגדרות מראה",tq="הגדרות חשבון",sq="שמור/י שינויים",nq="פעולה זו",rq="לא ניתנת לביטול",oq="כל הנתונים שלך יימחקו לצמיתות, כולל:",iq="פרטי הפרופיל שלך",aq="כל ההודעות והשיחות",cq="תמונות ומדיה ששיתפת",lq="סטוריז ותכנים אחרים",dq="הזן/י את הסיסמה שלך לאישור:",uq="הסיסמה שלך",hq="מחק/י את החשבון שלי",fq="נא להזין את הסיסמה שלך לאישור מחיקת החשבון",pq="טוען את ההגדרות שלך...",mq="הסתר/י סיסמה",gq="הצג/י סיסמה",yq="אשר/י סיסמה",_q="או",vq="כתובת מייל",wq="ברוך/ה הבא/ה למנדרין! החשבון שלך נוצר בהצלחה.",bq="התחבר/י",xq="הירשם/י",Sq="התחבר/י עם",Cq="אין לך חשבון?",kq="זכור/י אותי",Nq="התאמה",jq="טוען פרופיל...",Tq="שגיאה לא ידועה",Eq="סגור",Aq="לא נמצא",Iq="המשתמש/ת לא נמצא/ה",$q="אפשר/י תמונות פרטיות",Pq="הקודם",Rq="הבא",Lq="ממתין/ה",Oq="אשר/י",Mq="דחה/י",Bq="אין תמונות זמינות",Fq="אהבתי",Dq="לייק",Uq="הודעה",qq="פעולות נוספות",zq="דווח/י על משתמש/ת",Hq="חסום/י משתמש/ת",Vq="פרימיום",Wq="מיקום לא ידוע",Gq="הצג/י עוד",Yq="אסימון האימות חסר",Kq="החשבון שלך אומת בהצלחה",Jq="אימות המייל נכשל",Qq="מייל אימות נשלח",Xq="נא להתחבר כדי לשלוח מחדש מייל אימות",Zq="אמת/י מייל",ez="מאמת את כתובת המייל שלך...",tz="האימות הושלם בהצלחה",sz="חזור/י אל",nz="חזרה להתחברות",rz="עברית",oz="English",iz="פרטיות קודמת לכל",az="הפרטיות שלך היא בראש סדר העדיפויות שלנו. שלוט/י מי רואה את הפרופיל שלך ואיזה מידע את/ה משתפ/ת.",cz="תקשורת מאובטחת",lz="הודעות מוצפנות מקצה לקצה מבטיחות שהשיחות שלך יישארו פרטיות ומאובטחות.",dz="התאמה חכמה",uz="האלגוריתם המתקדם שלנו מחבר אותך עם אנשים שתואמים להעדפות ולתחומי העניין שלך.",hz="מצא/י את החיבור המושלם שלך",fz="גלה/י חיבורים אמיתיים בסביבה בטוחה ודיסקרטית המיועדת למבוגרים המחפשים מפגשים משמעותיים.",pz="הזן/י את המייל שלך",mz="להתחיל",gz="אנשים מחוברים עכשיו",yz="התחבר/י עם האנשים המדהימים האלה שפעילים כרגע במנדרין",_z="לא צוין",vz="הצטרף/י כדי לראות עוד",wz="למה לבחור במנדרין",bz="בטוח שאת/ה רוצה למחוק את התמונה הזו?",xz="אי אפשר למחוק את תמונת הפרופיל שלך. בבקשה הגדר/י תמונה אחרת כתמונת פרופיל קודם.",Sz="אין תמונות",Cz="תמונה",kz="התמונה הזו פרטית",Nz="תמונה ממוזערת",jz="התמונה הקודמת",Tz="התמונה הבאה",Ez="הפוך/י לציבורי",Az="הפוך/י לפרטי",Iz="לחברים בלבד",$z="פרופיל",Pz="הגדר/י כתמונת פרופיל",Rz="הגדר/י כתמונת פרופיל",Lz="מחק/י תמונה",Oz="התראות",Mz="סמן/י הכל כנקרא",Bz="רענן/י",Fz="מרענן...",Dz="אין התראות שלא נקראו",Uz="אין התראות עדיין",qz="אין התראות {{filter}}",zz="עדכונים בזמן אמת מושהים",Hz="התחבר/י מחדש",Vz="טעינת נתוני המנוי נכשלה",Wz="המנוי שלך שודרג בהצלחה",Gz="עיבוד התשלום נכשל",Yz="חזרה לדאשבורד",Kz="חברות פרימיום",Jz="יש לך כבר גישת פרימיום",Qz="תהנה/י מכל פיצ'רי הפרימיום עם החשבון הנוכחי שלך!",Xz="פתח/י פיצ'רי פרימיום",Zz="שדרג/י את החוויה שלך עם גישת פרימיום",eH="חודשי",tH="שנתי",sH="חסוך/י",nH="חינם",rH="לתמיד",oH="התוכנית הנוכחית",iH="הכי פופולרי",aH="פרימיום",cH="לחודש",lH="לחודש, בחיוב שנתי",dH="צפייה בפרופילים",uH="שליחת קריצות",hH="לייקים מוגבלים",fH="סטוריז מוגבלים",pH="לייקים ללא הגבלה",mH="סטוריז ללא הגבלה",gH="שיחות וידאו",yH="עדיפות בתוצאות חיפוש",_H="מעבד...",vH="הירשם/י עכשיו",wH="מרכז תמיכה",bH="צור/י קשר",xH="שאלות נפוצות",SH="צ'אט חי",CH="זמין 9:00-18:00 (שעון ישראל)",kH="שלח/י לנו הודעה",NH="תודה! ההודעה שלך נשלחה. נחזור אליך בקרוב.",jH="השם שלך",TH="כתובת מייל",EH="נושא",AH="הודעה",IH="שלח/י הודעה",$H="שאלות נפוצות",PH="חזרה לעמוד הבית",RH="אודותינו",LH="מדיניות פרטיות",OH="תנאי שירות",MH="איך אני יוצר/ת חשבון?",BH="כדי ליצור חשבון, לחץ/י על כפתור 'הרשמה' בעמוד הבית. מלא/י את הפרטים שלך, העלה/י תמונת פרופיל והגדר/י את ההעדפות שלך. לאחר שתאמת/י את המייל שלך, החשבון שלך יופעל.",FH="איך אני יכול/ה לשנות את הגדרות החשבון שלי?",DH="עבור/י לעמוד 'הגדרות' לאחר ההתחברות. שם, תוכל/י לעדכן את פרטי הפרופיל שלך, העדפות התראות, הגדרות פרטיות ופרטי חשבון.",UH="האם המידע האישי שלי מאובטח?",qH="כן, אנחנו לוקחים את האבטחה ברצינות רבה. אנחנו משתמשים בהצפנה כדי להגן על הנתונים שלך ולעולם לא משתפים את המידע האישי שלך עם צדדים שלישיים ללא הסכמתך. לפרטים נוספים, אנא עיין/י במדיניות הפרטיות שלנו.",zH="איך אני מבטל/ת את המנוי שלי?",HH="כדי לבטל את המנוי שלך, עבור/י ל'הגדרות > מנוי' ולחץ/י על 'ביטול מנוי'. הטבות הפרימיום שלך יישארו פעילות עד סוף תקופת החיוב הנוכחית שלך.",VH="איך אני יכול/ה לדווח על התנהגות לא הולמת?",WH="אם נתקלת בהתנהגות לא הולמת, השתמש/י בכפתור 'דווח' בפרופיל המשתמש/ת או בשרשור ההודעה. צוות הפיקוח שלנו יבדוק את הדיווח וינקוט בפעולה המתאימה תוך 24 שעות.",GH="מה עלי לעשות אם שכחתי את הסיסמה שלי?",YH="בעמוד ההתחברות, לחץ/י על 'שכחתי סיסמה'. הזן/י את כתובת המייל שלך, ואנחנו נשלח לך הוראות לאיפוס הסיסמה שלך. מטעמי אבטחה, קישור האיפוס יפוג לאחר 24 שעות.",KH="איך אני מוחק/ת את החשבון שלי?",JH="עבור/י ל'הגדרות > חשבון' וגלול/י לתחתית שם תמצא/י את האפשרות 'מחק חשבון'. שים/י לב שמחיקת חשבון היא לצמיתות ולא ניתנת לביטול.",QH="פאן אונליין",XH="צ'אט מצלמה",ZH="במקום ציבורי",eV="בגדי עור/לטקס",tV="משחקי כוח",sV="מסאז' חושני",nV="לקיחת סיכונים",rV="דיבורים מלוכלכים",oV="מוזיקה",iV="רווק/ה",aV="נשוי/אה",cV="גרוש/ה",lV="פרוד/ה",dV="במערכת יחסים",uV="אי-מונוגמיה בהסכמה",hV="משחקי תפקידים",fV="BDSM",pV="מגע עדין",mV="תשוקה עזה",gV="הרפתקאות בחוץ",yV="דיון אינטלקטואלי",_V="פודי",vV="חובב/ת אמנות",wV="חובב/ת כושר",bV="חובב/ת סרטים",xV="מכור/ה לטיולים",SV="גיק טכנולוגי",CV="חובב/ת טבע",kV="פרפר חברתי",NV="אוהב/ת בית",jV="ספונטני/ת",TV="מתכנן/ת",EV="ינשוף לילה",AV="ציפור בוקר",IV="קז'ואל",$V="קשר רציני",PV="חברות",RV="נטוורקינג",LV="דומיננטי/ת",OV="כנוע/ה",MV="ונילה",BV="קינקי",FV="ניסיוני/ת",DV="מציצנות",UV="אקסהיביציוניזם",qV="צעצועים",zV="כיסויי עיניים",HV="ריתמות",VV="רווק/ה",WV="נשוי/אה",GV="גרוש/ה",YV="פרוד/ה",KV="אלמן/ה",JV="פוליאמורי/ת",QV="קינק",XV="חיזורים",ZV="צעצועים",eW="תחפושות",tW="מפגשים",sW="שלישיות",nW="קוקולד",rW="השפלה",oW="קרוסדרסינג",iW="סגידה",aW="אוראלי",cW="עיסויים",lW="משחק מקדים",dW="ביזארי",uW="חינוך",hW="התנסויות",fW="טנטרה",pW="אגרסיבי/ת",mW="פינוק",gW="קומדיה",yW="רוחניות",_W="קהילה",vW="צפייה",wW="מסיבות",bW="הלבשה תחתונה",xW="קול",SW="טוב לב",CW="ריקוד",kW="יצירתיות",NW="הצלחה",jW="חיות מחמד",TW="קזואלי",EW="דייטים",AW="חברות",IW="טיולים",$W="חוץ",PW="סרטים",RW="מוזיקה",LW="כושר",OW="אוכל",MW="אמנות",BW="קריאה",FW="משחקים",DW="צילום",UW="בישול",qW="צור חשבון חדש",zW="חשבון",HW="פרופיל",VW="תמונה",WW="העדפות",GW="הזן מידע בסיסי",YW="בחר כינוי",KW="שם התצוגה הציבורי שלך (יכול להכיל אותיות בכל שפה, מספרים וקווים תחתונים)",JW="הזן את האימייל שלך",QW="לעולם לא נשתף את האימייל שלך עם אף אחד אחר",XW="צור סיסמה",ZW="חייבת להיות לפחות 8 תווים עם אות גדולה, אות קטנה, מספר ותו מיוחד",eG="או הירשם עם",tG="הירשם עם גוגל",sG="הירשם עם פייסבוק",nG="בטיחות",rG="תמיכה",oG="כל הזכויות שמורות.",iG="הוסף פרטי פרופיל בסיסיים",aG="תאריך לידה",cG="חובה להיות בן/בת 18 לפחות כדי להשתמש בשירות זה",lG="אני",dG="עיר, מדינה",uG="המיקום הכללי שלך (לדוגמה, תל אביב, ישראל)",hG="העלה/י את התמונה שלך",fG="הוסף/י תמונת פרופיל כדי לשפר את הנראות שלך",pG="לחץ/י להעלאת תמונת פרופיל",mG="התמונות צריכות להיות ברורות, עדכניות ולהציג את הפנים שלך",gG="גודל מקסימלי: 5MB. פורמטים: JPG, JPEG, PNG",yG="שנה/י תמונה",_G="הסר/י",vG="ההעדפות שלך",wG="ספר/י לנו על עצמך ומה את/ה מחפש/ת",bG="בחר/י את הסטטוס שלך",xG="בחר/י עד 3 אפשרויות",SG="בחר/י עד 10 תחומי עניין",CG="ספורט",kG="אני בקטע של",NG="בחר/י עד 20 תגיות",jG="זה מדליק אותי",TG="בחר/י עד 20 תגיות",EG="אני מסכים/ה ל",AG="אני מסכים/ה ל",IG="אני רוצה לקבל חדשות והצעות מיוחדות (אופציונלי)",$G="צור/י חשבון",PG={verificationNeeded:rO,resendVerificationEmail:oO,resendEmailCooldown:iO,resendEmail:aO,sending:cO,updateFailed:lO,profilePhotoUpdated:dO,maritalStatus:uO,cancel:hO,delete:"מחיקה",edit:fO,loading:pO,error:mO,success:gO,online:yO,offline:_O,send:vO,view:wO,myProfile:bO,editProfile:xO,dashboard:SO,home:CO,about:kO,privacy:NO,terms:jO,help:TO,back:EO,more:AO,less:IO,showLess:$O,photos:PO,addPhoto:RO,uploading:LO,nickname:OO,age:MO,location:BO,bio:FO,aboutMe:DO,identity:UO,iAm:qO,lookingFor:zO,interests:HO,intoTags:VO,turnOns:WO,lastActive:GO,updatingPhotoPrivacy:YO,updatingProfilePhoto:KO,profileUpdated:JO,man:QO,woman:XO,couple:ZO,men:eM,women:tM,couples:sM,newMessage:nM,typeMessage:rM,noMessages:oM,startConversation:iM,searchContacts:aM,account:cM,notifications:lM,language:dM,theme:uM,email:hM,password:fM,forgotPassword:pM,noAccount:mM,haveAccount:gM,profileUpdateFailed:yM,photoUploadFailed:_M,photoPrivacyUpdateFailed:vM,profilePhotoUpdateFailed:wM,photoDeleteFailed:bM,required:xM,invalidEmail:SM,discover:CM,explore:kM,nearYou:NM,popular:jM,onlineNow:TM,newUsers:EM,basicInfo:AM,approvePhotoRequests:IM,blockedUserMessage:$M,disconnected:PM,connectionLost:RM,startVideoCall:LM,viewProfile:OM,unblockUser:MM,blocked:BM,moreOptions:FM,unblock:DM,browseUsers:UM,yourMatches:qM,findMatches:zM,loadingUsers:HM,loadingMoreUsers:VM,noMatches:WM,tryAdjustingFilters:GM,myStories:YM,createStory:KM,filter:JM,filters:QM,reset:XM,apply:ZM,showOnly:eB,range:tB,distance:sB,verified:nB,withPhotos:rB,dismiss:oB,inactive:iB,preferences:aB,errorTitle:cB,smallSize:lB,mediumSize:dB,largeSize:uB,loadMoreButton:hB,closeButton:fB,confirmButton:pB,cancelButton:mB,errorOccurred:gB,tryAgain:yB,languageSelect:_B,switchToHebrew:vB,switchToEnglish:wB,english:bB,hebrew:xB,currentlyUsing:SB,browseAndConnect:CB,createNewStory:kB,gridView:NB,listView:jB,noResultsFound:TB,searchForUsers:EB,ageRange:AB,useCurrentLocation:IB,kmAway:$B,showMoreTags:PB,showLessTags:RB,nicknameRequired:LB,nicknameTooShort:OB,nicknameTooLong:MB,nicknameInvalid:BB,ageRequired:FB,ageInvalid:DB,ageMinimum:UB,ageMaximum:qB,locationRequired:zB,locationTooShort:HB,bioTooLong:VB,photoPrivacySuccess:WB,photoUploadSuccess:GB,photoDeleteSuccess:YB,tellAboutYourself:KB,noBioProvided:JB,noInterestsSelected:QB,noTagsSelected:XB,interestsLimit:ZB,intoTagsLimit:eF,turnOnsLimit:tF,lookingForLimit:sF,maritalStatusMarried:nF,saving:rF,messageConversation:oF,loadingMessages:iF,typing:aF,todayAt:cF,yesterdayAt:lF,toggleFilters:dF,messagesFrom:uF,messageDeleted:hF,messageAttachment:fF,sendMessage:pF,messagePlaceholder:mF,searchUsers:gF,conversations:yF,emptyInbox:_F,startConversationNow:vF,writeFirstMessage:wF,readReceipt:bF,sendingMessage:xF,freeAccountWink:SF,upgradeToSendText:CF,upgradeToSendFiles:kF,messageInput:NF,selectEmoji:jF,closeEmojiPicker:TF,addEmoji:EF,sendWink:AF,attachFile:IF,sendFile:$F,search:PF,messages:RF,profile:LF,settings:OF,logout:MF,login:BF,register:FF,subscription:DF,emailRequired:UF,passwordLengthError:qF,passwordLowercaseError:zF,passwordUppercaseError:HF,passwordNumberError:VF,passwordSpecialError:WF,passwordMatchError:GF,passwordRequirements:YF,validationError:KF,generalError:JF,dateOfBirthRequired:QF,ageRestriction:XF,invalidDateOfBirth:ZF,selectIdentity:eD,locationTooLong:tD,profilePhotoRequired:sD,maritalStatusRequired:nD,selectLookingFor:rD,tooManyLookingFor:oD,tooManyIntoTags:iD,tooManyTurnOns:aD,interestsRequired:cD,tooManyInterests:lD,termsRequired:dD,privacyRequired:uD,uploadTypeMismatch:hD,uploadSizeLimitExceeded:fD,registerCreateAccount:pD,registerEnterBasicInfo:mD,registerNickname:gD,registerChooseNickname:yD,registerNicknameHelp:_D,registerEnterEmail:vD,registerEmailHelp:wD,registerCreatePassword:bD,registerConfirmPassword:xD,registerPasswordHelp:SD,registerContinue:CD,registerAccountStep:kD,registerProfileStep:ND,registerPhotoStep:jD,registerPreferencesStep:TD,registerTellAboutYourself:ED,registerAddBasicProfileDetails:AD,registerDateOfBirth:ID,registerDateOfBirthHelp:$D,registerIAmA:PD,registerLocation:RD,registerLocationPlaceholder:LD,registerLocationHelp:OD,registerBack:MD,registerUploadYourPhoto:BD,registerImproveVisibility:FD,registerClickToUpload:DD,registerProfileImageHelp:UD,registerProfileImageSize:qD,registerChangePhoto:zD,registerRemovePhoto:HD,registerYourPreferences:VD,registerTellWhatLooking:WD,registerMaritalStatus:GD,registerSelectStatus:YD,registerLookingFor:KD,registerLookingForHelp:JD,registerInterests:QD,registerInterestsHelp:XD,registerImInto:ZD,registerImIntoHelp:eU,registerTurnsMeOn:tU,registerTurnsMeOnHelp:sU,registerTermsAgreement:nU,registerPrivacyAgreement:rU,registerNewsletterAgreement:oU,registerCreateBtn:iU,registerCreatingAccount:aU,registerSignUpWith:cU,registerSignUpGoogle:lU,registerSignUpFacebook:dU,unsavedChangesLogout:uU,accountDeletedSuccess:hU,deleteAccountFailed:fU,deleteAccountFailedRetry:pU,messageNotifications:mU,messageNotificationsDesc:gU,callNotifications:yU,callNotificationsDesc:_U,storyNotifications:vU,storyNotificationsDesc:wU,likeNotifications:bU,likeNotificationsDesc:xU,commentNotifications:SU,commentNotificationsDesc:CU,onlineStatus:kU,onlineStatusDesc:NU,readReceipts:jU,readReceiptsDesc:TU,lastSeen:EU,lastSeenDesc:AU,storyReplies:IU,storyRepliesDesc:$U,everyone:PU,noOne:RU,blockedUsers:LU,blockedUsersDesc:OU,loadingBlockedUsers:MU,defaultUser:BU,noBlockedUsers:FU,themeMode:DU,themeModeDesc:UU,light:qU,dark:zU,system:HU,quickThemeToggle:VU,quickThemeToggleDesc:WU,languageDesc:GU,username:YU,notAvailable:KU,memberSince:JU,freePlan:QU,notificationSettings:XU,privacySettings:ZU,appearanceSettings:eq,accountSettings:tq,saveChanges:sq,deleteWarning:nq,cannotBeUndone:rq,deleteDataWarning:oq,profileInformation:iq,messagesAndConversations:aq,photosAndMedia:cq,storiesAndContent:lq,enterPasswordConfirm:dq,yourPassword:uq,deleteMyAccount:hq,passwordRequired:fq,loadingSettings:pq,hidePassword:mq,showPassword:gq,confirmPassword:yq,or:_q,emailAddress:vq,registerSuccess:wq,signIn:bq,signUp:xq,signInWith:Sq,dontHaveAccount:Cq,rememberMe:kq,compatibility:Nq,loadingProfile:jq,errorUnknown:Tq,close:Eq,notFound:Aq,userNotFound:Iq,allowPrivatePhotos:$q,previous:Pq,next:Rq,requestAccessPending:Lq,approve:Oq,reject:Mq,noPhotosAvailable:Bq,liked:Fq,like:Dq,message:Uq,moreActions:qq,reportUser:zq,blockUser:Hq,premium:Vq,unknownLocation:Wq,showMore:Gq,tokenMissing:Yq,accountVerified:Kq,verificationFailed:Jq,verificationEmailSent:Qq,loginToResend:Xq,verifyEmail:Zq,verifyingEmail:ez,verificationSuccess:tz,goBack:sz,backToLogin:nz,languageHebrew:rz,languageEnglish:oz,privacyFirst:iz,privacyDescription:az,secureTitle:cz,secureCommDescription:lz,matchTitle:dz,smartMatchingDescription:uz,findYourConnection:hz,heroSubtitle:fz,emailPlaceholder:pz,getStarted:mz,peopleOnlineNow:gz,onlineNowSubtitle:yz,notSpecified:_z,joinToSeeMore:vz,featuresTitle:wz,confirmDeletePhoto:bz,cannotDeleteProfilePhoto:xz,noPhotos:Sz,photo:Cz,privatePhoto:kz,photoThumbnail:Nz,previousPhoto:jz,nextPhoto:Tz,makePublic:Ez,makePrivate:Az,private:"פרטי",friendsOnly:Iz,profilePhoto:$z,setAsProfilePhoto:Pz,setAsProfile:Rz,deletePhoto:Lz,notificationsTitle:Oz,markAllRead:Mz,refresh:Bz,refreshing:Fz,noUnreadNotifications:Dz,noNotifications:Uz,noFilteredNotifications:qz,updatesPaused:zz,reconnect:Hz,fetchFailed:Vz,upgradeSuccess:Wz,paymentFailed:Gz,backToDashboard:Yz,premiumMembership:Kz,alreadyPremium:Jz,enjoyFeatures:Qz,unlockFeatures:Xz,upgradeExperience:Zz,monthly:eH,yearly:tH,save:sH,freeTier:nH,forever:rH,currentPlan:oH,mostPopular:iH,paidTier:aH,perMonth:cH,perMonthYearly:lH,viewProfiles:dH,sendWinks:uH,limitedLikes:hH,limitedStories:fH,unlimitedLikes:pH,unlimitedStories:mH,videoCalls:gH,prioritySearch:yH,processing:_H,subscribe:vH,supportTitle:wH,contactUs:bH,faq:xH,liveChat:SH,liveChatHours:CH,contactForm:kH,formSuccess:NH,formName:jH,formEmail:TH,formSubject:EH,formMessage:AH,formSubmit:IH,frequentlyAskedQuestions:$H,backToHome:PH,aboutUs:RH,privacyPolicy:LH,termsOfService:OH,faq1Question:MH,faq1Answer:BH,faq2Question:FH,faq2Answer:DH,faq3Question:UH,faq3Answer:qH,faq4Question:zH,faq4Answer:HH,faq5Question:VH,faq5Answer:WH,faq6Question:GH,faq6Answer:YH,faq7Question:KH,faq7Answer:JH,online_fun:QH,camera_chat:XH,in_a_public_place:ZH,leather_latex_clothing:eV,power_play:tV,sensual_massage:sV,risktaking:nV,dirty_talk:rV,music:oV,single:iV,married:aV,divorced:cV,separated:lV,relationship:dV,consensual_non_monogamy:uV,role_play:hV,bdsm:fV,gentle_touch:pV,intense_passion:mV,outdoor_adventure:gV,intellectual_discussion:yV,foodie:_V,art_lover:vV,fitness_enthusiast:wV,movie_buff:bV,travel_addict:xV,tech_geek:SV,nature_lover:CV,social_butterfly:kV,homebody:NV,spontaneous:jV,planner:TV,night_owl:EV,early_bird:AV,casual:IV,serious_relationship:$V,friendship:PV,networking:RV,dominant:LV,submissive:OV,switch:"סוויץ'",vanilla:MV,kinky:BV,experimental:FV,voyeurism:DV,exhibitionism:UV,toys:qV,blindfolds:zV,restraints:HV,Single:VV,Married:WV,Divorced:GV,Separated:YV,Widowed:KV,"In a relationship":"במערכת יחסים","It's complicated":"זה מסובך","Open relationship":"מערכת יחסים פתוחה",Polyamorous:JV,Kink:QV,Teasing:XV,"Fantasy sharing":"שיתוף פנטזיות",Toys:ZV,"Weekend getaways":"בריחות סוף שבוע",Costumes:eW,"Fantasy fulfillment":"הגשמת פנטזיות",Meetups:tW,"Power play":"משחקי כוח",Threesomes:sW,"Online fun":"פאן אונליין","Hot chat":"צ'אט חם","Photo sharing":"שיתוף תמונות","Camera chat":"צ'אט מצלמה",Cuckold:nW,"Golden showers":"שירותים זהובים","Strap-on":"סטראפ-און","Forced bi":"בי בכפייה","Erotic domination":"שליטה ארוטית",Humiliation:rW,Crossdressing:oW,Worship:iW,"Foot fetish":"פטיש כפות רגליים",Oral:aW,"From behind":"מאחורה","Role-play":"משחקי תפקידים",Massages:cW,Foreplay:lW,"Casual meetups":"מפגשים קז'ואליים",Bizarre:dW,Education:uW,Experiences:hW,Tantra:fW,"Sexy ass":"ישבן סקסי","Dirty talk":"דיבורים מלוכלכים",Aggressive:pW,"Slow and gentle":"איטי ועדין","In a public place":"במקום ציבורי",Pampering:mW,"Sexy clothing":"בגדים סקסיים","Leather/latex clothing":"בגדי עור/לטקס","Watching porn":"צפייה בפורנו","Fit body":"גוף מחוטב","Bathing together":"רחצה משותפת","Erotic writing":"כתיבה ארוטית","Eye contact":"קשר עין","Being pampered":"להיות מפונק/ת","Sexy legs":"רגליים סקסיות","Pushing boundaries":"דחיקת גבולות",Comedy:gW,Spirituality:yW,Community:_W,Watching:vW,Parties:wW,"Outdoor adventures":"הרפתקאות בחוץ","Hotel fun":"כיף במלון",Lingerie:bW,Voice:xW,Kindness:SW,Dancing:CW,Creativity:kW,Success:NW,Pets:jW,Casual:TW,"Long-term":"לטווח ארוך",Dating:EW,Friendship:AW,Travel:IW,Outdoors:$W,Movies:PW,Music:RW,Fitness:LW,Food:OW,Art:MW,Reading:BW,Gaming:FW,Photography:DW,Cooking:UW,createAccount:qW,accountStep:zW,profileStep:HW,photoStep:VW,preferencesStep:WW,enterBasicInfo:GW,chooseNickname:YW,nicknameHelp:KW,enterEmail:JW,emailHelp:QW,createPassword:XW,passwordHelp:ZW,continue:"המשך",signUpWith:eG,signUpGoogle:tG,signUpFacebook:sG,safety:nG,contactSupport:rG,allRightsReserved:oG,addBasicProfileDetails:iG,dateOfBirth:aG,dateOfBirthHelp:cG,iAmA:lG,locationPlaceholder:dG,locationHelp:uG,uploadYourPhoto:hG,improveVisibility:fG,clickToUpload:pG,profileImageHelp:mG,profileImageSize:gG,changePhoto:yG,removePhoto:_G,yourPreferences:vG,tellWhatLooking:wG,selectStatus:bG,lookingForHelp:xG,interestsHelp:SG,Sports:CG,imInto:kG,imIntoHelp:NG,turnsMeOn:jG,turnsMeOnHelp:TG,termsAgreement:EG,privacyAgreement:AG,newsletterAgreement:IG,createBtn:$G};os.use(au).use(qg);const RG=De.create("i18n");os.init({resources:{en:{translation:nO},he:{translation:PG}},partialBundledLanguages:!0,supportedLngs:["en","he"],fallbackLng:["he","en"],lng:localStorage.getItem("language")||void 0,ns:["translation"],defaultNS:"translation",keySeparator:!1,nsSeparator:":",detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"]},react:{useSuspense:!0,bindI18n:"languageChanged loaded"},returnEmptyString:!1,returnNull:!1,returnObjects:!0,joinArrays:!0,parseMissingKeyHandler:t=>(RG.warn(`Missing translation key: ${t}`),t.replace(/_/g," ")),saveMissing:!1,missingKeyHandler:(t,e,s,r)=>{},interpolation:{escapeValue:!1},debug:!1});typeof globalThis>"u"&&(window.global=window);xu.createRoot(document.getElementById("root")).render(n.jsx(ct.StrictMode,{children:n.jsx(oa,{children:n.jsx(gu,{children:n.jsx(Od,{children:n.jsx(dT,{})})})})}));
//# sourceMappingURL=index-D47qPLqu.js.map
