var ih=Object.defineProperty;var ah=(e,t,s)=>t in e?ih(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Us=(e,t,s)=>ah(e,typeof t!="symbol"?t+"":t,s);import{a as ch,b as lh,g as Fn,r as p,R as pt,p as dc,u as ps,c as dh,L as yt,d as tr,N as uh,e as hh,f as fh,h as xs,B as gh}from"./vendor-BDP1-VUM.js";import{y as Z,G as Re,L as ph}from"./ui-CFgWxDLP.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var Ei={exports:{}},Mr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uc;function mh(){if(uc)return Mr;uc=1;var e=ch(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(l,u,h){var a,d={},f=null,v=null;h!==void 0&&(f=""+h),u.key!==void 0&&(f=""+u.key),u.ref!==void 0&&(v=u.ref);for(a in u)n.call(u,a)&&!i.hasOwnProperty(a)&&(d[a]=u[a]);if(l&&l.defaultProps)for(a in u=l.defaultProps,u)d[a]===void 0&&(d[a]=u[a]);return{$$typeof:t,type:l,key:f,ref:v,props:d,_owner:o.current}}return Mr.Fragment=s,Mr.jsx=c,Mr.jsxs=c,Mr}var hc;function yh(){return hc||(hc=1,Ei.exports=mh()),Ei.exports}var r=yh(),xo={},fc;function vh(){if(fc)return xo;fc=1;var e=lh();return xo.createRoot=e.createRoot,xo.hydrateRoot=e.hydrateRoot,xo}var _h=vh();const wh=Fn(_h),bh="modulepreload",xh=function(e){return"/"+e},gc={},Sh=function(t,s,n){let o=Promise.resolve();if(s&&s.length>0){let c=function(h){return Promise.all(h.map(a=>Promise.resolve(a).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=c(s.map(h=>{if(h=xh(h),h in gc)return;gc[h]=!0;const a=h.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${d}`))return;const f=document.createElement("link");if(f.rel=a?"stylesheet":bh,a||(f.as="script"),f.crossOrigin="",f.href=h,u&&f.setAttribute("nonce",u),document.head.appendChild(f),a)return new Promise((v,g)=>{f.addEventListener("load",v),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return o.then(c=>{for(const l of c||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})};var Ti,pc;function Ch(){if(pc)return Ti;pc=1;var e=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",n=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function o(i,c){if(i===c)return!0;if(i&&c&&typeof i=="object"&&typeof c=="object"){if(i.constructor!==c.constructor)return!1;var l,u,h;if(Array.isArray(i)){if(l=i.length,l!=c.length)return!1;for(u=l;u--!==0;)if(!o(i[u],c[u]))return!1;return!0}var a;if(t&&i instanceof Map&&c instanceof Map){if(i.size!==c.size)return!1;for(a=i.entries();!(u=a.next()).done;)if(!c.has(u.value[0]))return!1;for(a=i.entries();!(u=a.next()).done;)if(!o(u.value[1],c.get(u.value[0])))return!1;return!0}if(s&&i instanceof Set&&c instanceof Set){if(i.size!==c.size)return!1;for(a=i.entries();!(u=a.next()).done;)if(!c.has(u.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(i)&&ArrayBuffer.isView(c)){if(l=i.length,l!=c.length)return!1;for(u=l;u--!==0;)if(i[u]!==c[u])return!1;return!0}if(i.constructor===RegExp)return i.source===c.source&&i.flags===c.flags;if(i.valueOf!==Object.prototype.valueOf&&typeof i.valueOf=="function"&&typeof c.valueOf=="function")return i.valueOf()===c.valueOf();if(i.toString!==Object.prototype.toString&&typeof i.toString=="function"&&typeof c.toString=="function")return i.toString()===c.toString();if(h=Object.keys(i),l=h.length,l!==Object.keys(c).length)return!1;for(u=l;u--!==0;)if(!Object.prototype.hasOwnProperty.call(c,h[u]))return!1;if(e&&i instanceof Element)return!1;for(u=l;u--!==0;)if(!((h[u]==="_owner"||h[u]==="__v"||h[u]==="__o")&&i.$$typeof)&&!o(i[h[u]],c[h[u]]))return!1;return!0}return i!==i&&c!==c}return Ti=function(c,l){try{return o(c,l)}catch(u){if((u.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw u}},Ti}var kh=Ch();const Nh=Fn(kh);var Ai,mc;function Eh(){if(mc)return Ai;mc=1;var e=function(t,s,n,o,i,c,l,u){if(!t){var h;if(s===void 0)h=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=[n,o,i,c,l,u],d=0;h=new Error(s.replace(/%s/g,function(){return a[d++]})),h.name="Invariant Violation"}throw h.framesToPop=1,h}};return Ai=e,Ai}var Th=Eh();const yc=Fn(Th);var ji,vc;function Ah(){return vc||(vc=1,ji=function(t,s,n,o){var i=n?n.call(o,t,s):void 0;if(i!==void 0)return!!i;if(t===s)return!0;if(typeof t!="object"||!t||typeof s!="object"||!s)return!1;var c=Object.keys(t),l=Object.keys(s);if(c.length!==l.length)return!1;for(var u=Object.prototype.hasOwnProperty.bind(s),h=0;h<c.length;h++){var a=c[h];if(!u(a))return!1;var d=t[a],f=s[a];if(i=n?n.call(o,d,f,a):void 0,i===!1||i===void 0&&d!==f)return!1}return!0}),ji}var jh=Ah();const Ih=Fn(jh);var Wl=(e=>(e.BASE="base",e.BODY="body",e.HEAD="head",e.HTML="html",e.LINK="link",e.META="meta",e.NOSCRIPT="noscript",e.SCRIPT="script",e.STYLE="style",e.TITLE="title",e.FRAGMENT="Symbol(react.fragment)",e))(Wl||{}),Ii={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},_c=Object.values(Wl),Da={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},$h=Object.entries(Da).reduce((e,[t,s])=>(e[s]=t,e),{}),en="data-rh",gr={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},pr=(e,t)=>{for(let s=e.length-1;s>=0;s-=1){const n=e[s];if(Object.prototype.hasOwnProperty.call(n,t))return n[t]}return null},Ph=e=>{let t=pr(e,"title");const s=pr(e,gr.TITLE_TEMPLATE);if(Array.isArray(t)&&(t=t.join("")),s&&t)return s.replace(/%s/g,()=>t);const n=pr(e,gr.DEFAULT_TITLE);return t||n||void 0},Rh=e=>pr(e,gr.ON_CHANGE_CLIENT_STATE)||(()=>{}),$i=(e,t)=>t.filter(s=>typeof s[e]<"u").map(s=>s[e]).reduce((s,n)=>({...s,...n}),{}),Mh=(e,t)=>t.filter(s=>typeof s.base<"u").map(s=>s.base).reverse().reduce((s,n)=>{if(!s.length){const o=Object.keys(n);for(let i=0;i<o.length;i+=1){const l=o[i].toLowerCase();if(e.indexOf(l)!==-1&&n[l])return s.concat(n)}}return s},[]),Lh=e=>console&&typeof console.warn=="function"&&console.warn(e),Lr=(e,t,s)=>{const n={};return s.filter(o=>Array.isArray(o[e])?!0:(typeof o[e]<"u"&&Lh(`Helmet: ${e} should be of type "Array". Instead found type "${typeof o[e]}"`),!1)).map(o=>o[e]).reverse().reduce((o,i)=>{const c={};i.filter(u=>{let h;const a=Object.keys(u);for(let f=0;f<a.length;f+=1){const v=a[f],g=v.toLowerCase();t.indexOf(g)!==-1&&!(h==="rel"&&u[h].toLowerCase()==="canonical")&&!(g==="rel"&&u[g].toLowerCase()==="stylesheet")&&(h=g),t.indexOf(v)!==-1&&(v==="innerHTML"||v==="cssText"||v==="itemprop")&&(h=v)}if(!h||!u[h])return!1;const d=u[h].toLowerCase();return n[h]||(n[h]={}),c[h]||(c[h]={}),n[h][d]?!1:(c[h][d]=!0,!0)}).reverse().forEach(u=>o.push(u));const l=Object.keys(c);for(let u=0;u<l.length;u+=1){const h=l[u],a={...n[h],...c[h]};n[h]=a}return o},[]).reverse()},Oh=(e,t)=>{if(Array.isArray(e)&&e.length){for(let s=0;s<e.length;s+=1)if(e[s][t])return!0}return!1},Fh=e=>({baseTag:Mh(["href"],e),bodyAttributes:$i("bodyAttributes",e),defer:pr(e,gr.DEFER),encode:pr(e,gr.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:$i("htmlAttributes",e),linkTags:Lr("link",["rel","href"],e),metaTags:Lr("meta",["name","charset","http-equiv","property","itemprop"],e),noscriptTags:Lr("noscript",["innerHTML"],e),onChangeClientState:Rh(e),scriptTags:Lr("script",["src","innerHTML"],e),styleTags:Lr("style",["cssText"],e),title:Ph(e),titleAttributes:$i("titleAttributes",e),prioritizeSeoTags:Oh(e,gr.PRIORITIZE_SEO_TAGS)}),Gl=e=>Array.isArray(e)?e.join(""):e,Dh=(e,t)=>{const s=Object.keys(e);for(let n=0;n<s.length;n+=1)if(t[s[n]]&&t[s[n]].includes(e[s[n]]))return!0;return!1},Pi=(e,t)=>Array.isArray(e)?e.reduce((s,n)=>(Dh(n,t)?s.priority.push(n):s.default.push(n),s),{priority:[],default:[]}):{default:e,priority:[]},wc=(e,t)=>({...e,[t]:void 0}),Bh=["noscript","script","style"],la=(e,t=!0)=>t===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),Yl=e=>Object.keys(e).reduce((t,s)=>{const n=typeof e[s]<"u"?`${s}="${e[s]}"`:`${s}`;return t?`${t} ${n}`:n},""),Uh=(e,t,s,n)=>{const o=Yl(s),i=Gl(t);return o?`<${e} ${en}="true" ${o}>${la(i,n)}</${e}>`:`<${e} ${en}="true">${la(i,n)}</${e}>`},qh=(e,t,s=!0)=>t.reduce((n,o)=>{const i=o,c=Object.keys(i).filter(h=>!(h==="innerHTML"||h==="cssText")).reduce((h,a)=>{const d=typeof i[a]>"u"?a:`${a}="${la(i[a],s)}"`;return h?`${h} ${d}`:d},""),l=i.innerHTML||i.cssText||"",u=Bh.indexOf(e)===-1;return`${n}<${e} ${en}="true" ${c}${u?"/>":`>${l}</${e}>`}`},""),Kl=(e,t={})=>Object.keys(e).reduce((s,n)=>{const o=Da[n];return s[o||n]=e[n],s},t),zh=(e,t,s)=>{const n={key:t,[en]:!0},o=Kl(s,n);return[pt.createElement("title",o,t)]},Ro=(e,t)=>t.map((s,n)=>{const o={key:n,[en]:!0};return Object.keys(s).forEach(i=>{const l=Da[i]||i;if(l==="innerHTML"||l==="cssText"){const u=s.innerHTML||s.cssText;o.dangerouslySetInnerHTML={__html:u}}else o[l]=s[i]}),pt.createElement(e,o)}),qs=(e,t,s=!0)=>{switch(e){case"title":return{toComponent:()=>zh(e,t.title,t.titleAttributes),toString:()=>Uh(e,t.title,t.titleAttributes,s)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>Kl(t),toString:()=>Yl(t)};default:return{toComponent:()=>Ro(e,t),toString:()=>qh(e,t,s)}}},Hh=({metaTags:e,linkTags:t,scriptTags:s,encode:n})=>{const o=Pi(e,Ii.meta),i=Pi(t,Ii.link),c=Pi(s,Ii.script);return{priorityMethods:{toComponent:()=>[...Ro("meta",o.priority),...Ro("link",i.priority),...Ro("script",c.priority)],toString:()=>`${qs("meta",o.priority,n)} ${qs("link",i.priority,n)} ${qs("script",c.priority,n)}`},metaTags:o.default,linkTags:i.default,scriptTags:c.default}},Vh=e=>{const{baseTag:t,bodyAttributes:s,encode:n=!0,htmlAttributes:o,noscriptTags:i,styleTags:c,title:l="",titleAttributes:u,prioritizeSeoTags:h}=e;let{linkTags:a,metaTags:d,scriptTags:f}=e,v={toComponent:()=>{},toString:()=>""};return h&&({priorityMethods:v,linkTags:a,metaTags:d,scriptTags:f}=Hh(e)),{priority:v,base:qs("base",t,n),bodyAttributes:qs("bodyAttributes",s,n),htmlAttributes:qs("htmlAttributes",o,n),link:qs("link",a,n),meta:qs("meta",d,n),noscript:qs("noscript",i,n),script:qs("script",f,n),style:qs("style",c,n),title:qs("title",{title:l,titleAttributes:u},n)}},da=Vh,So=[],Jl=!!(typeof window<"u"&&window.document&&window.document.createElement),ua=class{constructor(e,t){Us(this,"instances",[]);Us(this,"canUseDOM",Jl);Us(this,"context");Us(this,"value",{setHelmet:e=>{this.context.helmet=e},helmetInstances:{get:()=>this.canUseDOM?So:this.instances,add:e=>{(this.canUseDOM?So:this.instances).push(e)},remove:e=>{const t=(this.canUseDOM?So:this.instances).indexOf(e);(this.canUseDOM?So:this.instances).splice(t,1)}}});this.context=e,this.canUseDOM=t||!1,t||(e.helmet=da({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},Wh={},Ql=pt.createContext(Wh),Jn,Ba=(Jn=class extends p.Component{constructor(s){super(s);Us(this,"helmetData");this.helmetData=new ua(this.props.context||{},Jn.canUseDOM)}render(){return pt.createElement(Ql.Provider,{value:this.helmetData.value},this.props.children)}},Us(Jn,"canUseDOM",Jl),Jn),or=(e,t)=>{const s=document.head||document.querySelector("head"),n=s.querySelectorAll(`${e}[${en}]`),o=[].slice.call(n),i=[];let c;return t&&t.length&&t.forEach(l=>{const u=document.createElement(e);for(const h in l)if(Object.prototype.hasOwnProperty.call(l,h))if(h==="innerHTML")u.innerHTML=l.innerHTML;else if(h==="cssText")u.styleSheet?u.styleSheet.cssText=l.cssText:u.appendChild(document.createTextNode(l.cssText));else{const a=h,d=typeof l[a]>"u"?"":l[a];u.setAttribute(h,d)}u.setAttribute(en,"true"),o.some((h,a)=>(c=a,u.isEqualNode(h)))?o.splice(c,1):i.push(u)}),o.forEach(l=>{var u;return(u=l.parentNode)==null?void 0:u.removeChild(l)}),i.forEach(l=>s.appendChild(l)),{oldTags:o,newTags:i}},ha=(e,t)=>{const s=document.getElementsByTagName(e)[0];if(!s)return;const n=s.getAttribute(en),o=n?n.split(","):[],i=[...o],c=Object.keys(t);for(const l of c){const u=t[l]||"";s.getAttribute(l)!==u&&s.setAttribute(l,u),o.indexOf(l)===-1&&o.push(l);const h=i.indexOf(l);h!==-1&&i.splice(h,1)}for(let l=i.length-1;l>=0;l-=1)s.removeAttribute(i[l]);o.length===i.length?s.removeAttribute(en):s.getAttribute(en)!==c.join(",")&&s.setAttribute(en,c.join(","))},Gh=(e,t)=>{typeof e<"u"&&document.title!==e&&(document.title=Gl(e)),ha("title",t)},bc=(e,t)=>{const{baseTag:s,bodyAttributes:n,htmlAttributes:o,linkTags:i,metaTags:c,noscriptTags:l,onChangeClientState:u,scriptTags:h,styleTags:a,title:d,titleAttributes:f}=e;ha("body",n),ha("html",o),Gh(d,f);const v={baseTag:or("base",s),linkTags:or("link",i),metaTags:or("meta",c),noscriptTags:or("noscript",l),scriptTags:or("script",h),styleTags:or("style",a)},g={},b={};Object.keys(v).forEach($=>{const{newTags:T,oldTags:F}=v[$];T.length&&(g[$]=T),F.length&&(b[$]=v[$].oldTags)}),t&&t(),u(e,g,b)},Or=null,Yh=e=>{Or&&cancelAnimationFrame(Or),e.defer?Or=requestAnimationFrame(()=>{bc(e,()=>{Or=null})}):(bc(e),Or=null)},Kh=Yh,xc=class extends p.Component{constructor(){super(...arguments);Us(this,"rendered",!1)}shouldComponentUpdate(t){return!Ih(t,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:t}=this.props.context;t.remove(this),this.emitChange()}emitChange(){const{helmetInstances:t,setHelmet:s}=this.props.context;let n=null;const o=Fh(t.get().map(i=>{const c={...i.props};return delete c.context,c}));Ba.canUseDOM?Kh(o):da&&(n=da(o)),s(n)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:t}=this.props.context;t.add(this),this.emitChange()}render(){return this.init(),null}},ca,Jh=(ca=class extends p.Component{shouldComponentUpdate(e){return!Nh(wc(this.props,"helmetData"),wc(e,"helmetData"))}mapNestedChildrenToProps(e,t){if(!t)return null;switch(e.type){case"script":case"noscript":return{innerHTML:t};case"style":return{cssText:t};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,t,s,n){return{...t,[e.type]:[...t[e.type]||[],{...s,...this.mapNestedChildrenToProps(e,n)}]}}mapObjectTypeChildren(e,t,s,n){switch(e.type){case"title":return{...t,[e.type]:n,titleAttributes:{...s}};case"body":return{...t,bodyAttributes:{...s}};case"html":return{...t,htmlAttributes:{...s}};default:return{...t,[e.type]:{...s}}}}mapArrayTypeChildrenToProps(e,t){let s={...t};return Object.keys(e).forEach(n=>{s={...s,[n]:e[n]}}),s}warnOnInvalidChildren(e,t){return yc(_c.some(s=>e.type===s),typeof e.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${_c.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),yc(!t||typeof t=="string"||Array.isArray(t)&&!t.some(s=>typeof s!="string"),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,t){let s={};return pt.Children.forEach(e,n=>{if(!n||!n.props)return;const{children:o,...i}=n.props,c=Object.keys(i).reduce((u,h)=>(u[$h[h]||h]=i[h],u),{});let{type:l}=n;switch(typeof l=="symbol"?l=l.toString():this.warnOnInvalidChildren(n,o),l){case"Symbol(react.fragment)":t=this.mapChildrenToProps(o,t);break;case"link":case"meta":case"noscript":case"script":case"style":s=this.flattenArrayTypeChildren(n,s,c,o);break;default:t=this.mapObjectTypeChildren(n,t,c,o);break}}),this.mapArrayTypeChildrenToProps(s,t)}render(){const{children:e,...t}=this.props;let s={...t},{helmetData:n}=t;if(e&&(s=this.mapChildrenToProps(e,s)),n&&!(n instanceof ua)){const o=n;n=new ua(o.context,!0),delete s.helmetData}return n?pt.createElement(xc,{...s,context:n.value}):pt.createElement(Ql.Consumer,null,o=>pt.createElement(xc,{...s,context:o}))}},Us(ca,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),ca),Ri={},Mi={},Li={},Sc;function Qh(){return Sc||(Sc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(){for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];if(typeof window<"u"){var l;typeof window.gtag>"u"&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(l=window).gtag.apply(l,i)}},s=t;e.default=s}(Li)),Li}var Oi={},Cc;function Xh(){return Cc||(Cc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;function s(l){return l.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(u,h,a){return h>0&&h+u.length!==a.length&&u.search(t)>-1&&a.charAt(h-2)!==":"&&(a.charAt(h+u.length)!=="-"||a.charAt(h-1)==="-")&&a.charAt(h-1).search(/[^\s-]/)<0?u.toLowerCase():u.substr(1).search(/[A-Z]|\../)>-1?u:u.charAt(0).toUpperCase()+u.substr(1)})}function n(l){return typeof l=="string"&&l.indexOf("@")!==-1}var o="REDACTED (Potential Email Address)";function i(l){return n(l)?(console.warn("This arg looks like an email address, redacting."),o):l}function c(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=l||"";return u&&(a=s(l)),h&&(a=i(a)),a}}(Oi)),Oi}var kc;function Zh(){return kc||(kc=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.GA4=void 0;var t=c(Qh()),s=c(Xh()),n=["eventCategory","eventAction","eventLabel","eventValue","hitType"],o=["title","location"],i=["page","hitType"];function c(j){return j&&j.__esModule?j:{default:j}}function l(j,I){if(j==null)return{};var S=u(j,I),C,G;if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(j);for(G=0;G<V.length;G++)C=V[G],!(I.indexOf(C)>=0)&&Object.prototype.propertyIsEnumerable.call(j,C)&&(S[C]=j[C])}return S}function u(j,I){if(j==null)return{};var S={},C=Object.keys(j),G,V;for(V=0;V<C.length;V++)G=C[V],!(I.indexOf(G)>=0)&&(S[G]=j[G]);return S}function h(j){"@babel/helpers - typeof";return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},h(j)}function a(j){return v(j)||f(j)||F(j)||d()}function d(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f(j){if(typeof Symbol<"u"&&j[Symbol.iterator]!=null||j["@@iterator"]!=null)return Array.from(j)}function v(j){if(Array.isArray(j))return M(j)}function g(j,I){var S=Object.keys(j);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(j);I&&(C=C.filter(function(G){return Object.getOwnPropertyDescriptor(j,G).enumerable})),S.push.apply(S,C)}return S}function b(j){for(var I=1;I<arguments.length;I++){var S=arguments[I]!=null?arguments[I]:{};I%2?g(Object(S),!0).forEach(function(C){N(j,C,S[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(S)):g(Object(S)).forEach(function(C){Object.defineProperty(j,C,Object.getOwnPropertyDescriptor(S,C))})}return j}function $(j,I){return U(j)||E(j,I)||F(j,I)||T()}function T(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F(j,I){if(j){if(typeof j=="string")return M(j,I);var S=Object.prototype.toString.call(j).slice(8,-1);if(S==="Object"&&j.constructor&&(S=j.constructor.name),S==="Map"||S==="Set")return Array.from(j);if(S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return M(j,I)}}function M(j,I){(I==null||I>j.length)&&(I=j.length);for(var S=0,C=new Array(I);S<I;S++)C[S]=j[S];return C}function E(j,I){var S=j==null?null:typeof Symbol<"u"&&j[Symbol.iterator]||j["@@iterator"];if(S!=null){var C,G,V,L,X=[],q=!0,z=!1;try{if(V=(S=S.call(j)).next,I!==0)for(;!(q=(C=V.call(S)).done)&&(X.push(C.value),X.length!==I);q=!0);}catch(K){z=!0,G=K}finally{try{if(!q&&S.return!=null&&(L=S.return(),Object(L)!==L))return}finally{if(z)throw G}}return X}}function U(j){if(Array.isArray(j))return j}function A(j,I){if(!(j instanceof I))throw new TypeError("Cannot call a class as a function")}function D(j,I){for(var S=0;S<I.length;S++){var C=I[S];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(j,P(C.key),C)}}function w(j,I,S){return I&&D(j.prototype,I),Object.defineProperty(j,"prototype",{writable:!1}),j}function N(j,I,S){return I=P(I),I in j?Object.defineProperty(j,I,{value:S,enumerable:!0,configurable:!0,writable:!0}):j[I]=S,j}function P(j){var I=x(j,"string");return h(I)==="symbol"?I:String(I)}function x(j,I){if(h(j)!=="object"||j===null)return j;var S=j[Symbol.toPrimitive];if(S!==void 0){var C=S.call(j,I);if(h(C)!=="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return(I==="string"?String:Number)(j)}var k=function(){function j(){var I=this;A(this,j),N(this,"reset",function(){I.isInitialized=!1,I._testMode=!1,I._currentMeasurementId,I._hasLoadedGA=!1,I._isQueuing=!1,I._queueGtag=[]}),N(this,"_gtag",function(){for(var S=arguments.length,C=new Array(S),G=0;G<S;G++)C[G]=arguments[G];I._testMode||I._isQueuing?I._queueGtag.push(C):t.default.apply(void 0,C)}),N(this,"_loadGA",function(S,C){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"https://www.googletagmanager.com/gtag/js";if(!(typeof window>"u"||typeof document>"u")&&!I._hasLoadedGA){var V=document.createElement("script");V.async=!0,V.src="".concat(G,"?id=").concat(S),C&&V.setAttribute("nonce",C),document.body.appendChild(V),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},I._hasLoadedGA=!0}}),N(this,"_toGtagOptions",function(S){if(S){var C={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"},G=Object.entries(S).reduce(function(V,L){var X=$(L,2),q=X[0],z=X[1];return C[q]?V[C[q]]=z:V[q]=z,V},{});return G}}),N(this,"initialize",function(S){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!S)throw new Error("Require GA_MEASUREMENT_ID");var G=typeof S=="string"?[{trackingId:S}]:S;I._currentMeasurementId=G[0].trackingId;var V=C.gaOptions,L=C.gtagOptions,X=C.nonce,q=C.testMode,z=q===void 0?!1:q,K=C.gtagUrl;if(I._testMode=z,z||I._loadGA(I._currentMeasurementId,X,K),I.isInitialized||(I._gtag("js",new Date),G.forEach(function(ne){var Q=b(b(b({},I._toGtagOptions(b(b({},V),ne.gaOptions))),L),ne.gtagOptions);Object.keys(Q).length?I._gtag("config",ne.trackingId,Q):I._gtag("config",ne.trackingId)})),I.isInitialized=!0,!z){var W=a(I._queueGtag);for(I._queueGtag=[],I._isQueuing=!1;W.length;){var H=W.shift();I._gtag.apply(I,a(H)),H[0]==="get"&&(I._isQueuing=!0)}}}),N(this,"set",function(S){if(!S){console.warn("`fieldsObject` is required in .set()");return}if(h(S)!=="object"){console.warn("Expected `fieldsObject` arg to be an Object");return}Object.keys(S).length===0&&console.warn("empty `fieldsObject` given to .set()"),I._gaCommand("set",S)}),N(this,"_gaCommandSendEvent",function(S,C,G,V,L){I._gtag("event",C,b(b({event_category:S,event_label:G,value:V},L&&{non_interaction:L.nonInteraction}),I._toGtagOptions(L)))}),N(this,"_gaCommandSendEventParameters",function(){for(var S=arguments.length,C=new Array(S),G=0;G<S;G++)C[G]=arguments[G];if(typeof C[0]=="string")I._gaCommandSendEvent.apply(I,a(C.slice(1)));else{var V=C[0],L=V.eventCategory,X=V.eventAction,q=V.eventLabel,z=V.eventValue;V.hitType;var K=l(V,n);I._gaCommandSendEvent(L,X,q,z,K)}}),N(this,"_gaCommandSendTiming",function(S,C,G,V){I._gtag("event","timing_complete",{name:C,value:G,event_category:S,event_label:V})}),N(this,"_gaCommandSendPageview",function(S,C){if(C&&Object.keys(C).length){var G=I._toGtagOptions(C),V=G.title,L=G.location,X=l(G,o);I._gtag("event","page_view",b(b(b(b({},S&&{page_path:S}),V&&{page_title:V}),L&&{page_location:L}),X))}else S?I._gtag("event","page_view",{page_path:S}):I._gtag("event","page_view")}),N(this,"_gaCommandSendPageviewParameters",function(){for(var S=arguments.length,C=new Array(S),G=0;G<S;G++)C[G]=arguments[G];if(typeof C[0]=="string")I._gaCommandSendPageview.apply(I,a(C.slice(1)));else{var V=C[0],L=V.page;V.hitType;var X=l(V,i);I._gaCommandSendPageview(L,X)}}),N(this,"_gaCommandSend",function(){for(var S=arguments.length,C=new Array(S),G=0;G<S;G++)C[G]=arguments[G];var V=typeof C[0]=="string"?C[0]:C[0].hitType;switch(V){case"event":I._gaCommandSendEventParameters.apply(I,C);break;case"pageview":I._gaCommandSendPageviewParameters.apply(I,C);break;case"timing":I._gaCommandSendTiming.apply(I,a(C.slice(1)));break;case"screenview":case"transaction":case"item":case"social":case"exception":console.warn("Unsupported send command: ".concat(V));break;default:console.warn("Send command doesn't exist: ".concat(V))}}),N(this,"_gaCommandSet",function(){for(var S=arguments.length,C=new Array(S),G=0;G<S;G++)C[G]=arguments[G];typeof C[0]=="string"&&(C[0]=N({},C[0],C[1])),I._gtag("set",I._toGtagOptions(C[0]))}),N(this,"_gaCommand",function(S){for(var C=arguments.length,G=new Array(C>1?C-1:0),V=1;V<C;V++)G[V-1]=arguments[V];switch(S){case"send":I._gaCommandSend.apply(I,G);break;case"set":I._gaCommandSet.apply(I,G);break;default:console.warn("Command doesn't exist: ".concat(S))}}),N(this,"ga",function(){for(var S=arguments.length,C=new Array(S),G=0;G<S;G++)C[G]=arguments[G];if(typeof C[0]=="string")I._gaCommand.apply(I,C);else{var V=C[0];I._gtag("get",I._currentMeasurementId,"client_id",function(L){I._isQueuing=!1;var X=I._queueGtag;for(V({get:function(K){return K==="clientId"?L:K==="trackingId"?I._currentMeasurementId:K==="apiVersion"?"1":void 0}});X.length;){var q=X.shift();I._gtag.apply(I,a(q))}}),I._isQueuing=!0}return I.ga}),N(this,"event",function(S,C){if(typeof S=="string")I._gtag("event",S,I._toGtagOptions(C));else{var G=S.action,V=S.category,L=S.label,X=S.value,q=S.nonInteraction,z=S.transport;if(!V||!G){console.warn("args.category AND args.action are required in event()");return}var K={hitType:"event",eventCategory:(0,s.default)(V),eventAction:(0,s.default)(G)};L&&(K.eventLabel=(0,s.default)(L)),typeof X<"u"&&(typeof X!="number"?console.warn("Expected `args.value` arg to be a Number."):K.eventValue=X),typeof q<"u"&&(typeof q!="boolean"?console.warn("`args.nonInteraction` must be a boolean."):K.nonInteraction=q),typeof z<"u"&&(typeof z!="string"?console.warn("`args.transport` must be a string."):(["beacon","xhr","image"].indexOf(z)===-1&&console.warn("`args.transport` must be either one of these values: `beacon`, `xhr` or `image`"),K.transport=z)),I._gaCommand("send",K)}}),N(this,"send",function(S){I._gaCommand("send",S)}),this.reset()}return w(j,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}}]),j}();e.GA4=k;var R=new k;e.default=R}(Mi)),Mi}var Nc;function ef(){return Nc||(Nc=1,function(e){function t(l){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},t(l)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ReactGAImplementation=void 0;var s=o(Zh());function n(l){if(typeof WeakMap!="function")return null;var u=new WeakMap,h=new WeakMap;return(n=function(d){return d?h:u})(l)}function o(l,u){if(l&&l.__esModule)return l;if(l===null||t(l)!=="object"&&typeof l!="function")return{default:l};var h=n(u);if(h&&h.has(l))return h.get(l);var a={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in l)if(f!=="default"&&Object.prototype.hasOwnProperty.call(l,f)){var v=d?Object.getOwnPropertyDescriptor(l,f):null;v&&(v.get||v.set)?Object.defineProperty(a,f,v):a[f]=l[f]}return a.default=l,h&&h.set(l,a),a}var i=s.GA4;e.ReactGAImplementation=i;var c=s.default;e.default=c}(Ri)),Ri}var tf=ef();const Xl=Fn(tf),Wn={BASE_URL:"/api",TIMEOUT:15e3,RETRIES:{MAX_QUEUE_RETRIES:3,RETRY_DELAY_MS:1e3},HEALTH_CHECK:{TIMEOUT:3e3,CONNECTION_TEST_TIMEOUT:5e3,INTERVAL:3e5},ENDPOINTS:{AUTH:{LOGIN:"/auth/login",REGISTER:"/auth/register",VERIFY:"/auth/verify-email",ME:"/auth/me",REFRESH:"/auth/refresh-token",TEST:"/auth/test-connection"},USERS:{PROFILE:"/users/profile",AVATAR:"/users/avatar",SEARCH:"/users/search",SUGGEST:"/users/suggest"},MESSAGES:{BASE:"/messages",CONVERSATIONS:"/messages/conversations"},NOTIFICATIONS:{BASE:"/notifications",READ:"/notifications/read",READ_ALL:"/notifications/read-all"},SUBSCRIPTIONS:{STATUS:"/subscription/status",UPGRADE:"/subscription/upgrade",CANCEL:"/subscription/cancel"},STORIES:{BASE:"/stories",USER:e=>`/stories/user/${e}`}}},Sn={SIZE:Number.parseInt("100",10),TTL:{DEFAULT:Number.parseInt("60000",10),MESSAGES:1e4,USER_PROFILE:12e4,STORIES:6e4,CONVERSATIONS:6e4}};var Vl;const Nt={RECONNECT:{MAX_ATTEMPTS:5,DELAY:5e3,DELAY_MAX:3e4},CONNECTION:{TIMEOUT:3e4,HEARTBEAT_INTERVAL:3e4,HEARTBEAT_TIMEOUT:6e4,MONITOR_INTERVAL:45e3,RECONNECT_DELAY_MIN:1e3,RECONNECT_DELAY_MAX:3e3,ONLINE_RECONNECT_DELAY:2e3},TRANSPORT:{DEFAULT:["polling","websocket"],FALLBACK:["polling"]},URLS:{DEV:"http://localhost:5000",PROD:((Vl=window==null?void 0:window.location)==null?void 0:Vl.origin)||"https://flirtss.com"},EVENTS:{MESSAGE_RECEIVED:"messageReceived",MESSAGE_SENT:"messageSent",MESSAGE_ERROR:"messageError",TYPING:"userTyping",INCOMING_CALL:"incomingCall",CALL_ANSWERED:"callAnswered",CALL_INITIATED:"callInitiated",CALL_ERROR:"callError",VIDEO_SIGNAL:"videoSignal",VIDEO_HANGUP:"videoHangup",VIDEO_ERROR:"videoError",VIDEO_MEDIA_CONTROL:"videoMediaControl",USER_ONLINE:"userOnline",USER_OFFLINE:"userOffline",NOTIFICATION:"notification",NEW_LIKE:"newLike",NEW_COMMENT:"newComment",NEW_STORY:"newStory",NEW_MESSAGE:"newMessage",PHOTO_PERMISSION_REQUEST:"photoPermissionRequestReceived",PHOTO_PERMISSION_RESPONSE:"photoPermissionResponseReceived",CONNECT:"connect",DISCONNECT:"disconnect",CONNECT_ERROR:"connect_error",RECONNECT:"reconnect",RECONNECT_ATTEMPT:"reconnect_attempt",RECONNECT_ERROR:"reconnect_error",RECONNECT_FAILED:"reconnect_failed",WELCOME:"welcome",PONG:"pong",ERROR:"error",AUTH_ERROR:"auth_error",SOCKET_CONNECTED:"socketConnected",SOCKET_DISCONNECTED:"socketDisconnected",SOCKET_RECONNECTED:"socketReconnected",SOCKET_CONNECTION_FAILED:"socketConnectionFailed",SOCKET_RECONNECT_FAILED:"socketReconnectFailed",NOTIFICATION_SOCKET_RECONNECTED:"notificationSocketReconnected"},NOTIFICATION:{SYNC_CHANNEL_NAME:"notification_sync",SYNC_EVENT_TYPES:["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall","newStory"],SYNC_ACTIONS:{NEW_NOTIFICATION:"NEW_NOTIFICATION",MARK_READ:"MARK_READ",MARK_ALL_READ:"MARK_ALL_READ"}},TIMEOUT:{ACK:2e3,INIT:5e3,PERMISSION_REQUEST:1e4}},Vr={MAX_SIZE:{AVATAR:5*1024*1024},ALLOWED_TYPES:{IMAGES:["image/jpeg","image/png","image/gif","image/webp"],VIDEOS:["video/mp4","video/webm","video/quicktime"],AUDIO:["audio/mpeg","audio/wav","audio/ogg"],DOCUMENTS:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]}},Nn={DEBOUNCE:{TYPING:1e3,SMOOTH_SCROLL:100},POLL:{NOTIFICATIONS:6e4},FETCH:{MESSAGES:8e3},MESSAGE:{DEDUPLICATION:1500,PENDING_EXPIRY:6e5},UI:{LOADING_TIMEOUT:1e4,INPUT_FOCUS_DELAY:300,UPLOAD_COMPLETE_DELAY:500}},ys={FREE:"FREE",PREMIUM:"PREMIUM",FEMALE:"FEMALE",COUPLE:"COUPLE"},Gn={ANIMATIONS:{DIRECTION_CHANGE_MS:50,CHAT_OPEN_DELAY_MS:50},TOAST:{AUTO_CLOSE_MS:3e3,MAX_TOASTS:5,POSITION:"top-right"},ANALYTICS:{GA4_ID:"G-Y9EQ02574T"},EMOJI:{COMMON:["😊","😂","😍","❤️","👍","🙌","🔥","✨","🎉","🤔","😉","🥰"]}};var Co={exports:{}},ko={exports:{}},Ec;function Zl(){return Ec||(Ec=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function s(o){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},s(o)}function n(o){var i=typeof o=="string"||o instanceof String;if(!i){var c=s(o);throw o===null?c="null":c==="object"&&(c=o.constructor.name),new TypeError("Expected a string but received a ".concat(c))}}e.exports=t.default,e.exports.default=t.default}(ko,ko.exports)),ko.exports}var No={exports:{}},Tc;function sf(){return Tc||(Tc=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var s=n(Zl());function n(c){return c&&c.__esModule?c:{default:c}}var o=/^(0x|0h)?[0-9A-F]+$/i;function i(c){return(0,s.default)(c),o.test(c)}e.exports=t.default,e.exports.default=t.default}(No,No.exports)),No.exports}var Ac;function nf(){return Ac||(Ac=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var s=o(Zl()),n=o(sf());function o(c){return c&&c.__esModule?c:{default:c}}function i(c){return(0,s.default)(c),(0,n.default)(c)&&c.length===24}e.exports=t.default,e.exports.default=t.default}(Co,Co.exports)),Co.exports}var rf=nf();const Hn=Fn(rf);function ed(e,t){return function(){return e.apply(t,arguments)}}const{toString:of}=Object.prototype,{getPrototypeOf:Ua}=Object,{iterator:ri,toStringTag:td}=Symbol,oi=(e=>t=>{const s=of.call(t);return e[s]||(e[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),tn=e=>(e=e.toLowerCase(),t=>oi(t)===e),ii=e=>t=>typeof t===e,{isArray:xr}=Array,Zr=ii("undefined");function af(e){return e!==null&&!Zr(e)&&e.constructor!==null&&!Zr(e.constructor)&&$s(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const sd=tn("ArrayBuffer");function cf(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&sd(e.buffer),t}const lf=ii("string"),$s=ii("function"),nd=ii("number"),ai=e=>e!==null&&typeof e=="object",df=e=>e===!0||e===!1,Mo=e=>{if(oi(e)!=="object")return!1;const t=Ua(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(td in e)&&!(ri in e)},uf=tn("Date"),hf=tn("File"),ff=tn("Blob"),gf=tn("FileList"),pf=e=>ai(e)&&$s(e.pipe),mf=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||$s(e.append)&&((t=oi(e))==="formdata"||t==="object"&&$s(e.toString)&&e.toString()==="[object FormData]"))},yf=tn("URLSearchParams"),[vf,_f,wf,bf]=["ReadableStream","Request","Response","Headers"].map(tn),xf=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function io(e,t,{allOwnKeys:s=!1}={}){if(e===null||typeof e>"u")return;let n,o;if(typeof e!="object"&&(e=[e]),xr(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{const i=s?Object.getOwnPropertyNames(e):Object.keys(e),c=i.length;let l;for(n=0;n<c;n++)l=i[n],t.call(null,e[l],l,e)}}function rd(e,t){t=t.toLowerCase();const s=Object.keys(e);let n=s.length,o;for(;n-- >0;)if(o=s[n],t===o.toLowerCase())return o;return null}const Yn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,od=e=>!Zr(e)&&e!==Yn;function fa(){const{caseless:e}=od(this)&&this||{},t={},s=(n,o)=>{const i=e&&rd(t,o)||o;Mo(t[i])&&Mo(n)?t[i]=fa(t[i],n):Mo(n)?t[i]=fa({},n):xr(n)?t[i]=n.slice():t[i]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&io(arguments[n],s);return t}const Sf=(e,t,s,{allOwnKeys:n}={})=>(io(t,(o,i)=>{s&&$s(o)?e[i]=ed(o,s):e[i]=o},{allOwnKeys:n}),e),Cf=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),kf=(e,t,s,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},Nf=(e,t,s,n)=>{let o,i,c;const l={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),i=o.length;i-- >0;)c=o[i],(!n||n(c,e,t))&&!l[c]&&(t[c]=e[c],l[c]=!0);e=s!==!1&&Ua(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},Ef=(e,t,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=t.length;const n=e.indexOf(t,s);return n!==-1&&n===s},Tf=e=>{if(!e)return null;if(xr(e))return e;let t=e.length;if(!nd(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},Af=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&Ua(Uint8Array)),jf=(e,t)=>{const n=(e&&e[ri]).call(e);let o;for(;(o=n.next())&&!o.done;){const i=o.value;t.call(e,i[0],i[1])}},If=(e,t)=>{let s;const n=[];for(;(s=e.exec(t))!==null;)n.push(s);return n},$f=tn("HTMLFormElement"),Pf=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,n,o){return n.toUpperCase()+o}),jc=(({hasOwnProperty:e})=>(t,s)=>e.call(t,s))(Object.prototype),Rf=tn("RegExp"),id=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),n={};io(s,(o,i)=>{let c;(c=t(o,i,e))!==!1&&(n[i]=c||o)}),Object.defineProperties(e,n)},Mf=e=>{id(e,(t,s)=>{if($s(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const n=e[s];if($s(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Lf=(e,t)=>{const s={},n=o=>{o.forEach(i=>{s[i]=!0})};return xr(e)?n(e):n(String(e).split(t)),s},Of=()=>{},Ff=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Df(e){return!!(e&&$s(e.append)&&e[td]==="FormData"&&e[ri])}const Bf=e=>{const t=new Array(10),s=(n,o)=>{if(ai(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[o]=n;const i=xr(n)?[]:{};return io(n,(c,l)=>{const u=s(c,o+1);!Zr(u)&&(i[l]=u)}),t[o]=void 0,i}}return n};return s(e,0)},Uf=tn("AsyncFunction"),qf=e=>e&&(ai(e)||$s(e))&&$s(e.then)&&$s(e.catch),ad=((e,t)=>e?setImmediate:t?((s,n)=>(Yn.addEventListener("message",({source:o,data:i})=>{o===Yn&&i===s&&n.length&&n.shift()()},!1),o=>{n.push(o),Yn.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",$s(Yn.postMessage)),zf=typeof queueMicrotask<"u"?queueMicrotask.bind(Yn):typeof dc<"u"&&dc.nextTick||ad,Hf=e=>e!=null&&$s(e[ri]),me={isArray:xr,isArrayBuffer:sd,isBuffer:af,isFormData:mf,isArrayBufferView:cf,isString:lf,isNumber:nd,isBoolean:df,isObject:ai,isPlainObject:Mo,isReadableStream:vf,isRequest:_f,isResponse:wf,isHeaders:bf,isUndefined:Zr,isDate:uf,isFile:hf,isBlob:ff,isRegExp:Rf,isFunction:$s,isStream:pf,isURLSearchParams:yf,isTypedArray:Af,isFileList:gf,forEach:io,merge:fa,extend:Sf,trim:xf,stripBOM:Cf,inherits:kf,toFlatObject:Nf,kindOf:oi,kindOfTest:tn,endsWith:Ef,toArray:Tf,forEachEntry:jf,matchAll:If,isHTMLForm:$f,hasOwnProperty:jc,hasOwnProp:jc,reduceDescriptors:id,freezeMethods:Mf,toObjectSet:Lf,toCamelCase:Pf,noop:Of,toFiniteNumber:Ff,findKey:rd,global:Yn,isContextDefined:od,isSpecCompliantForm:Df,toJSONObject:Bf,isAsyncFn:Uf,isThenable:qf,setImmediate:ad,asap:zf,isIterable:Hf};var cd={},ci={};ci.byteLength=Gf;ci.toByteArray=Kf;ci.fromByteArray=Xf;var dn=[],zs=[],Vf=typeof Uint8Array<"u"?Uint8Array:Array,Fi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ir=0,Wf=Fi.length;ir<Wf;++ir)dn[ir]=Fi[ir],zs[Fi.charCodeAt(ir)]=ir;zs[45]=62;zs[95]=63;function ld(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");s===-1&&(s=t);var n=s===t?0:4-s%4;return[s,n]}function Gf(e){var t=ld(e),s=t[0],n=t[1];return(s+n)*3/4-n}function Yf(e,t,s){return(t+s)*3/4-s}function Kf(e){var t,s=ld(e),n=s[0],o=s[1],i=new Vf(Yf(e,n,o)),c=0,l=o>0?n-4:n,u;for(u=0;u<l;u+=4)t=zs[e.charCodeAt(u)]<<18|zs[e.charCodeAt(u+1)]<<12|zs[e.charCodeAt(u+2)]<<6|zs[e.charCodeAt(u+3)],i[c++]=t>>16&255,i[c++]=t>>8&255,i[c++]=t&255;return o===2&&(t=zs[e.charCodeAt(u)]<<2|zs[e.charCodeAt(u+1)]>>4,i[c++]=t&255),o===1&&(t=zs[e.charCodeAt(u)]<<10|zs[e.charCodeAt(u+1)]<<4|zs[e.charCodeAt(u+2)]>>2,i[c++]=t>>8&255,i[c++]=t&255),i}function Jf(e){return dn[e>>18&63]+dn[e>>12&63]+dn[e>>6&63]+dn[e&63]}function Qf(e,t,s){for(var n,o=[],i=t;i<s;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(e[i+2]&255),o.push(Jf(n));return o.join("")}function Xf(e){for(var t,s=e.length,n=s%3,o=[],i=16383,c=0,l=s-n;c<l;c+=i)o.push(Qf(e,c,c+i>l?l:c+i));return n===1?(t=e[s-1],o.push(dn[t>>2]+dn[t<<4&63]+"==")):n===2&&(t=(e[s-2]<<8)+e[s-1],o.push(dn[t>>10]+dn[t>>4&63]+dn[t<<2&63]+"=")),o.join("")}var qa={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */qa.read=function(e,t,s,n,o){var i,c,l=o*8-n-1,u=(1<<l)-1,h=u>>1,a=-7,d=s?o-1:0,f=s?-1:1,v=e[t+d];for(d+=f,i=v&(1<<-a)-1,v>>=-a,a+=l;a>0;i=i*256+e[t+d],d+=f,a-=8);for(c=i&(1<<-a)-1,i>>=-a,a+=n;a>0;c=c*256+e[t+d],d+=f,a-=8);if(i===0)i=1-h;else{if(i===u)return c?NaN:(v?-1:1)*(1/0);c=c+Math.pow(2,n),i=i-h}return(v?-1:1)*c*Math.pow(2,i-n)};qa.write=function(e,t,s,n,o,i){var c,l,u,h=i*8-o-1,a=(1<<h)-1,d=a>>1,f=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=n?0:i-1,g=n?1:-1,b=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,c=a):(c=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-c))<1&&(c--,u*=2),c+d>=1?t+=f/u:t+=f*Math.pow(2,1-d),t*u>=2&&(c++,u/=2),c+d>=a?(l=0,c=a):c+d>=1?(l=(t*u-1)*Math.pow(2,o),c=c+d):(l=t*Math.pow(2,d-1)*Math.pow(2,o),c=0));o>=8;e[s+v]=l&255,v+=g,l/=256,o-=8);for(c=c<<o|l,h+=o;h>0;e[s+v]=c&255,v+=g,c/=256,h-=8);e[s+v-g]|=b*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=ci,s=qa,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const o=2147483647;e.kMaxLength=o;const{Uint8Array:i,ArrayBuffer:c,SharedArrayBuffer:l}=globalThis;a.TYPED_ARRAY_SUPPORT=u(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{const _=new i(1),m={foo:function(){return 42}};return Object.setPrototypeOf(m,i.prototype),Object.setPrototypeOf(_,m),_.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function h(_){if(_>o)throw new RangeError('The value "'+_+'" is invalid for option "size"');const m=new i(_);return Object.setPrototypeOf(m,a.prototype),m}function a(_,m,y){if(typeof _=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(_)}return d(_,m,y)}a.poolSize=8192;function d(_,m,y){if(typeof _=="string")return b(_,m);if(c.isView(_))return T(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(oe(_,c)||_&&oe(_.buffer,c)||typeof l<"u"&&(oe(_,l)||_&&oe(_.buffer,l)))return F(_,m,y);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const B=_.valueOf&&_.valueOf();if(B!=null&&B!==_)return a.from(B,m,y);const J=M(_);if(J)return J;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return a.from(_[Symbol.toPrimitive]("string"),m,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}a.from=function(_,m,y){return d(_,m,y)},Object.setPrototypeOf(a.prototype,i.prototype),Object.setPrototypeOf(a,i);function f(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function v(_,m,y){return f(_),_<=0?h(_):m!==void 0?typeof y=="string"?h(_).fill(m,y):h(_).fill(m):h(_)}a.alloc=function(_,m,y){return v(_,m,y)};function g(_){return f(_),h(_<0?0:E(_)|0)}a.allocUnsafe=function(_){return g(_)},a.allocUnsafeSlow=function(_){return g(_)};function b(_,m){if((typeof m!="string"||m==="")&&(m="utf8"),!a.isEncoding(m))throw new TypeError("Unknown encoding: "+m);const y=A(_,m)|0;let B=h(y);const J=B.write(_,m);return J!==y&&(B=B.slice(0,J)),B}function $(_){const m=_.length<0?0:E(_.length)|0,y=h(m);for(let B=0;B<m;B+=1)y[B]=_[B]&255;return y}function T(_){if(oe(_,i)){const m=new i(_);return F(m.buffer,m.byteOffset,m.byteLength)}return $(_)}function F(_,m,y){if(m<0||_.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<m+(y||0))throw new RangeError('"length" is outside of buffer bounds');let B;return m===void 0&&y===void 0?B=new i(_):y===void 0?B=new i(_,m):B=new i(_,m,y),Object.setPrototypeOf(B,a.prototype),B}function M(_){if(a.isBuffer(_)){const m=E(_.length)|0,y=h(m);return y.length===0||_.copy(y,0,0,m),y}if(_.length!==void 0)return typeof _.length!="number"||fe(_.length)?h(0):$(_);if(_.type==="Buffer"&&Array.isArray(_.data))return $(_.data)}function E(_){if(_>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return _|0}function U(_){return+_!=_&&(_=0),a.alloc(+_)}a.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==a.prototype},a.compare=function(m,y){if(oe(m,i)&&(m=a.from(m,m.offset,m.byteLength)),oe(y,i)&&(y=a.from(y,y.offset,y.byteLength)),!a.isBuffer(m)||!a.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===y)return 0;let B=m.length,J=y.length;for(let ce=0,pe=Math.min(B,J);ce<pe;++ce)if(m[ce]!==y[ce]){B=m[ce],J=y[ce];break}return B<J?-1:J<B?1:0},a.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(m,y){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return a.alloc(0);let B;if(y===void 0)for(y=0,B=0;B<m.length;++B)y+=m[B].length;const J=a.allocUnsafe(y);let ce=0;for(B=0;B<m.length;++B){let pe=m[B];if(oe(pe,i))ce+pe.length>J.length?(a.isBuffer(pe)||(pe=a.from(pe)),pe.copy(J,ce)):i.prototype.set.call(J,pe,ce);else if(a.isBuffer(pe))pe.copy(J,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=pe.length}return J};function A(_,m){if(a.isBuffer(_))return _.length;if(c.isView(_)||oe(_,c))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);const y=_.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&y===0)return 0;let J=!1;for(;;)switch(m){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return tt(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return de(_).length;default:if(J)return B?-1:tt(_).length;m=(""+m).toLowerCase(),J=!0}}a.byteLength=A;function D(_,m,y){let B=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,m>>>=0,y<=m))return"";for(_||(_="utf8");;)switch(_){case"hex":return q(this,m,y);case"utf8":case"utf-8":return C(this,m,y);case"ascii":return L(this,m,y);case"latin1":case"binary":return X(this,m,y);case"base64":return S(this,m,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,m,y);default:if(B)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),B=!0}}a.prototype._isBuffer=!0;function w(_,m,y){const B=_[m];_[m]=_[y],_[y]=B}a.prototype.swap16=function(){const m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<m;y+=2)w(this,y,y+1);return this},a.prototype.swap32=function(){const m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<m;y+=4)w(this,y,y+3),w(this,y+1,y+2);return this},a.prototype.swap64=function(){const m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<m;y+=8)w(this,y,y+7),w(this,y+1,y+6),w(this,y+2,y+5),w(this,y+3,y+4);return this},a.prototype.toString=function(){const m=this.length;return m===0?"":arguments.length===0?C(this,0,m):D.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(m){if(!a.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:a.compare(this,m)===0},a.prototype.inspect=function(){let m="";const y=e.INSPECT_MAX_BYTES;return m=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(m+=" ... "),"<Buffer "+m+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(m,y,B,J,ce){if(oe(m,i)&&(m=a.from(m,m.offset,m.byteLength)),!a.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(y===void 0&&(y=0),B===void 0&&(B=m?m.length:0),J===void 0&&(J=0),ce===void 0&&(ce=this.length),y<0||B>m.length||J<0||ce>this.length)throw new RangeError("out of range index");if(J>=ce&&y>=B)return 0;if(J>=ce)return-1;if(y>=B)return 1;if(y>>>=0,B>>>=0,J>>>=0,ce>>>=0,this===m)return 0;let pe=ce-J,$e=B-y;const We=Math.min(pe,$e),ct=this.slice(J,ce),ft=m.slice(y,B);for(let ht=0;ht<We;++ht)if(ct[ht]!==ft[ht]){pe=ct[ht],$e=ft[ht];break}return pe<$e?-1:$e<pe?1:0};function N(_,m,y,B,J){if(_.length===0)return-1;if(typeof y=="string"?(B=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,fe(y)&&(y=J?0:_.length-1),y<0&&(y=_.length+y),y>=_.length){if(J)return-1;y=_.length-1}else if(y<0)if(J)y=0;else return-1;if(typeof m=="string"&&(m=a.from(m,B)),a.isBuffer(m))return m.length===0?-1:P(_,m,y,B,J);if(typeof m=="number")return m=m&255,typeof i.prototype.indexOf=="function"?J?i.prototype.indexOf.call(_,m,y):i.prototype.lastIndexOf.call(_,m,y):P(_,[m],y,B,J);throw new TypeError("val must be string, number or Buffer")}function P(_,m,y,B,J){let ce=1,pe=_.length,$e=m.length;if(B!==void 0&&(B=String(B).toLowerCase(),B==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(_.length<2||m.length<2)return-1;ce=2,pe/=2,$e/=2,y/=2}function We(ft,ht){return ce===1?ft[ht]:ft.readUInt16BE(ht*ce)}let ct;if(J){let ft=-1;for(ct=y;ct<pe;ct++)if(We(_,ct)===We(m,ft===-1?0:ct-ft)){if(ft===-1&&(ft=ct),ct-ft+1===$e)return ft*ce}else ft!==-1&&(ct-=ct-ft),ft=-1}else for(y+$e>pe&&(y=pe-$e),ct=y;ct>=0;ct--){let ft=!0;for(let ht=0;ht<$e;ht++)if(We(_,ct+ht)!==We(m,ht)){ft=!1;break}if(ft)return ct}return-1}a.prototype.includes=function(m,y,B){return this.indexOf(m,y,B)!==-1},a.prototype.indexOf=function(m,y,B){return N(this,m,y,B,!0)},a.prototype.lastIndexOf=function(m,y,B){return N(this,m,y,B,!1)};function x(_,m,y,B){y=Number(y)||0;const J=_.length-y;B?(B=Number(B),B>J&&(B=J)):B=J;const ce=m.length;B>ce/2&&(B=ce/2);let pe;for(pe=0;pe<B;++pe){const $e=parseInt(m.substr(pe*2,2),16);if(fe($e))return pe;_[y+pe]=$e}return pe}function k(_,m,y,B){return ye(tt(m,_.length-y),_,y,B)}function R(_,m,y,B){return ye(we(m),_,y,B)}function j(_,m,y,B){return ye(de(m),_,y,B)}function I(_,m,y,B){return ye(ee(m,_.length-y),_,y,B)}a.prototype.write=function(m,y,B,J){if(y===void 0)J="utf8",B=this.length,y=0;else if(B===void 0&&typeof y=="string")J=y,B=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(B)?(B=B>>>0,J===void 0&&(J="utf8")):(J=B,B=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-y;if((B===void 0||B>ce)&&(B=ce),m.length>0&&(B<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");J||(J="utf8");let pe=!1;for(;;)switch(J){case"hex":return x(this,m,y,B);case"utf8":case"utf-8":return k(this,m,y,B);case"ascii":case"latin1":case"binary":return R(this,m,y,B);case"base64":return j(this,m,y,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,m,y,B);default:if(pe)throw new TypeError("Unknown encoding: "+J);J=(""+J).toLowerCase(),pe=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function S(_,m,y){return m===0&&y===_.length?t.fromByteArray(_):t.fromByteArray(_.slice(m,y))}function C(_,m,y){y=Math.min(_.length,y);const B=[];let J=m;for(;J<y;){const ce=_[J];let pe=null,$e=ce>239?4:ce>223?3:ce>191?2:1;if(J+$e<=y){let We,ct,ft,ht;switch($e){case 1:ce<128&&(pe=ce);break;case 2:We=_[J+1],(We&192)===128&&(ht=(ce&31)<<6|We&63,ht>127&&(pe=ht));break;case 3:We=_[J+1],ct=_[J+2],(We&192)===128&&(ct&192)===128&&(ht=(ce&15)<<12|(We&63)<<6|ct&63,ht>2047&&(ht<55296||ht>57343)&&(pe=ht));break;case 4:We=_[J+1],ct=_[J+2],ft=_[J+3],(We&192)===128&&(ct&192)===128&&(ft&192)===128&&(ht=(ce&15)<<18|(We&63)<<12|(ct&63)<<6|ft&63,ht>65535&&ht<1114112&&(pe=ht))}}pe===null?(pe=65533,$e=1):pe>65535&&(pe-=65536,B.push(pe>>>10&1023|55296),pe=56320|pe&1023),B.push(pe),J+=$e}return V(B)}const G=4096;function V(_){const m=_.length;if(m<=G)return String.fromCharCode.apply(String,_);let y="",B=0;for(;B<m;)y+=String.fromCharCode.apply(String,_.slice(B,B+=G));return y}function L(_,m,y){let B="";y=Math.min(_.length,y);for(let J=m;J<y;++J)B+=String.fromCharCode(_[J]&127);return B}function X(_,m,y){let B="";y=Math.min(_.length,y);for(let J=m;J<y;++J)B+=String.fromCharCode(_[J]);return B}function q(_,m,y){const B=_.length;(!m||m<0)&&(m=0),(!y||y<0||y>B)&&(y=B);let J="";for(let ce=m;ce<y;++ce)J+=ie[_[ce]];return J}function z(_,m,y){const B=_.slice(m,y);let J="";for(let ce=0;ce<B.length-1;ce+=2)J+=String.fromCharCode(B[ce]+B[ce+1]*256);return J}a.prototype.slice=function(m,y){const B=this.length;m=~~m,y=y===void 0?B:~~y,m<0?(m+=B,m<0&&(m=0)):m>B&&(m=B),y<0?(y+=B,y<0&&(y=0)):y>B&&(y=B),y<m&&(y=m);const J=this.subarray(m,y);return Object.setPrototypeOf(J,a.prototype),J};function K(_,m,y){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+m>y)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(m,y,B){m=m>>>0,y=y>>>0,B||K(m,y,this.length);let J=this[m],ce=1,pe=0;for(;++pe<y&&(ce*=256);)J+=this[m+pe]*ce;return J},a.prototype.readUintBE=a.prototype.readUIntBE=function(m,y,B){m=m>>>0,y=y>>>0,B||K(m,y,this.length);let J=this[m+--y],ce=1;for(;y>0&&(ce*=256);)J+=this[m+--y]*ce;return J},a.prototype.readUint8=a.prototype.readUInt8=function(m,y){return m=m>>>0,y||K(m,1,this.length),this[m]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(m,y){return m=m>>>0,y||K(m,2,this.length),this[m]|this[m+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(m,y){return m=m>>>0,y||K(m,2,this.length),this[m]<<8|this[m+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(m,y){return m=m>>>0,y||K(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(m,y){return m=m>>>0,y||K(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},a.prototype.readBigUInt64LE=te(function(m){m=m>>>0,Le(m,"offset");const y=this[m],B=this[m+7];(y===void 0||B===void 0)&&Me(m,this.length-8);const J=y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,ce=this[++m]+this[++m]*2**8+this[++m]*2**16+B*2**24;return BigInt(J)+(BigInt(ce)<<BigInt(32))}),a.prototype.readBigUInt64BE=te(function(m){m=m>>>0,Le(m,"offset");const y=this[m],B=this[m+7];(y===void 0||B===void 0)&&Me(m,this.length-8);const J=y*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],ce=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+B;return(BigInt(J)<<BigInt(32))+BigInt(ce)}),a.prototype.readIntLE=function(m,y,B){m=m>>>0,y=y>>>0,B||K(m,y,this.length);let J=this[m],ce=1,pe=0;for(;++pe<y&&(ce*=256);)J+=this[m+pe]*ce;return ce*=128,J>=ce&&(J-=Math.pow(2,8*y)),J},a.prototype.readIntBE=function(m,y,B){m=m>>>0,y=y>>>0,B||K(m,y,this.length);let J=y,ce=1,pe=this[m+--J];for(;J>0&&(ce*=256);)pe+=this[m+--J]*ce;return ce*=128,pe>=ce&&(pe-=Math.pow(2,8*y)),pe},a.prototype.readInt8=function(m,y){return m=m>>>0,y||K(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},a.prototype.readInt16LE=function(m,y){m=m>>>0,y||K(m,2,this.length);const B=this[m]|this[m+1]<<8;return B&32768?B|4294901760:B},a.prototype.readInt16BE=function(m,y){m=m>>>0,y||K(m,2,this.length);const B=this[m+1]|this[m]<<8;return B&32768?B|4294901760:B},a.prototype.readInt32LE=function(m,y){return m=m>>>0,y||K(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},a.prototype.readInt32BE=function(m,y){return m=m>>>0,y||K(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},a.prototype.readBigInt64LE=te(function(m){m=m>>>0,Le(m,"offset");const y=this[m],B=this[m+7];(y===void 0||B===void 0)&&Me(m,this.length-8);const J=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(B<<24);return(BigInt(J)<<BigInt(32))+BigInt(y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),a.prototype.readBigInt64BE=te(function(m){m=m>>>0,Le(m,"offset");const y=this[m],B=this[m+7];(y===void 0||B===void 0)&&Me(m,this.length-8);const J=(y<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(J)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+B)}),a.prototype.readFloatLE=function(m,y){return m=m>>>0,y||K(m,4,this.length),s.read(this,m,!0,23,4)},a.prototype.readFloatBE=function(m,y){return m=m>>>0,y||K(m,4,this.length),s.read(this,m,!1,23,4)},a.prototype.readDoubleLE=function(m,y){return m=m>>>0,y||K(m,8,this.length),s.read(this,m,!0,52,8)},a.prototype.readDoubleBE=function(m,y){return m=m>>>0,y||K(m,8,this.length),s.read(this,m,!1,52,8)};function W(_,m,y,B,J,ce){if(!a.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>J||m<ce)throw new RangeError('"value" argument is out of bounds');if(y+B>_.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(m,y,B,J){if(m=+m,y=y>>>0,B=B>>>0,!J){const $e=Math.pow(2,8*B)-1;W(this,m,y,B,$e,0)}let ce=1,pe=0;for(this[y]=m&255;++pe<B&&(ce*=256);)this[y+pe]=m/ce&255;return y+B},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(m,y,B,J){if(m=+m,y=y>>>0,B=B>>>0,!J){const $e=Math.pow(2,8*B)-1;W(this,m,y,B,$e,0)}let ce=B-1,pe=1;for(this[y+ce]=m&255;--ce>=0&&(pe*=256);)this[y+ce]=m/pe&255;return y+B},a.prototype.writeUint8=a.prototype.writeUInt8=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,1,255,0),this[y]=m&255,y+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,2,65535,0),this[y]=m&255,this[y+1]=m>>>8,y+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,2,65535,0),this[y]=m>>>8,this[y+1]=m&255,y+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,4,4294967295,0),this[y+3]=m>>>24,this[y+2]=m>>>16,this[y+1]=m>>>8,this[y]=m&255,y+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,4,4294967295,0),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4};function H(_,m,y,B,J){Se(m,B,J,_,y,7);let ce=Number(m&BigInt(4294967295));_[y++]=ce,ce=ce>>8,_[y++]=ce,ce=ce>>8,_[y++]=ce,ce=ce>>8,_[y++]=ce;let pe=Number(m>>BigInt(32)&BigInt(4294967295));return _[y++]=pe,pe=pe>>8,_[y++]=pe,pe=pe>>8,_[y++]=pe,pe=pe>>8,_[y++]=pe,y}function ne(_,m,y,B,J){Se(m,B,J,_,y,7);let ce=Number(m&BigInt(4294967295));_[y+7]=ce,ce=ce>>8,_[y+6]=ce,ce=ce>>8,_[y+5]=ce,ce=ce>>8,_[y+4]=ce;let pe=Number(m>>BigInt(32)&BigInt(4294967295));return _[y+3]=pe,pe=pe>>8,_[y+2]=pe,pe=pe>>8,_[y+1]=pe,pe=pe>>8,_[y]=pe,y+8}a.prototype.writeBigUInt64LE=te(function(m,y=0){return H(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=te(function(m,y=0){return ne(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(m,y,B,J){if(m=+m,y=y>>>0,!J){const We=Math.pow(2,8*B-1);W(this,m,y,B,We-1,-We)}let ce=0,pe=1,$e=0;for(this[y]=m&255;++ce<B&&(pe*=256);)m<0&&$e===0&&this[y+ce-1]!==0&&($e=1),this[y+ce]=(m/pe>>0)-$e&255;return y+B},a.prototype.writeIntBE=function(m,y,B,J){if(m=+m,y=y>>>0,!J){const We=Math.pow(2,8*B-1);W(this,m,y,B,We-1,-We)}let ce=B-1,pe=1,$e=0;for(this[y+ce]=m&255;--ce>=0&&(pe*=256);)m<0&&$e===0&&this[y+ce+1]!==0&&($e=1),this[y+ce]=(m/pe>>0)-$e&255;return y+B},a.prototype.writeInt8=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,1,127,-128),m<0&&(m=255+m+1),this[y]=m&255,y+1},a.prototype.writeInt16LE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,2,32767,-32768),this[y]=m&255,this[y+1]=m>>>8,y+2},a.prototype.writeInt16BE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,2,32767,-32768),this[y]=m>>>8,this[y+1]=m&255,y+2},a.prototype.writeInt32LE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,4,2147483647,-2147483648),this[y]=m&255,this[y+1]=m>>>8,this[y+2]=m>>>16,this[y+3]=m>>>24,y+4},a.prototype.writeInt32BE=function(m,y,B){return m=+m,y=y>>>0,B||W(this,m,y,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4},a.prototype.writeBigInt64LE=te(function(m,y=0){return H(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=te(function(m,y=0){return ne(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Q(_,m,y,B,J,ce){if(y+B>_.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function he(_,m,y,B,J){return m=+m,y=y>>>0,J||Q(_,m,y,4),s.write(_,m,y,B,23,4),y+4}a.prototype.writeFloatLE=function(m,y,B){return he(this,m,y,!0,B)},a.prototype.writeFloatBE=function(m,y,B){return he(this,m,y,!1,B)};function re(_,m,y,B,J){return m=+m,y=y>>>0,J||Q(_,m,y,8),s.write(_,m,y,B,52,8),y+8}a.prototype.writeDoubleLE=function(m,y,B){return re(this,m,y,!0,B)},a.prototype.writeDoubleBE=function(m,y,B){return re(this,m,y,!1,B)},a.prototype.copy=function(m,y,B,J){if(!a.isBuffer(m))throw new TypeError("argument should be a Buffer");if(B||(B=0),!J&&J!==0&&(J=this.length),y>=m.length&&(y=m.length),y||(y=0),J>0&&J<B&&(J=B),J===B||m.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("Index out of range");if(J<0)throw new RangeError("sourceEnd out of bounds");J>this.length&&(J=this.length),m.length-y<J-B&&(J=m.length-y+B);const ce=J-B;return this===m&&typeof i.prototype.copyWithin=="function"?this.copyWithin(y,B,J):i.prototype.set.call(m,this.subarray(B,J),y),ce},a.prototype.fill=function(m,y,B,J){if(typeof m=="string"){if(typeof y=="string"?(J=y,y=0,B=this.length):typeof B=="string"&&(J=B,B=this.length),J!==void 0&&typeof J!="string")throw new TypeError("encoding must be a string");if(typeof J=="string"&&!a.isEncoding(J))throw new TypeError("Unknown encoding: "+J);if(m.length===1){const pe=m.charCodeAt(0);(J==="utf8"&&pe<128||J==="latin1")&&(m=pe)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(y<0||this.length<y||this.length<B)throw new RangeError("Out of range index");if(B<=y)return this;y=y>>>0,B=B===void 0?this.length:B>>>0,m||(m=0);let ce;if(typeof m=="number")for(ce=y;ce<B;++ce)this[ce]=m;else{const pe=a.isBuffer(m)?m:a.from(m,J),$e=pe.length;if($e===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(ce=0;ce<B-y;++ce)this[ce+y]=pe[ce%$e]}return this};const _e={};function ke(_,m,y){_e[_]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:m.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(J){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:J,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}ke("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ke("ERR_INVALID_ARG_TYPE",function(_,m){return`The "${_}" argument must be of type number. Received type ${typeof m}`},TypeError),ke("ERR_OUT_OF_RANGE",function(_,m,y){let B=`The value of "${_}" is out of range.`,J=y;return Number.isInteger(y)&&Math.abs(y)>2**32?J=Be(String(y)):typeof y=="bigint"&&(J=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(J=Be(J)),J+="n"),B+=` It must be ${m}. Received ${J}`,B},RangeError);function Be(_){let m="",y=_.length;const B=_[0]==="-"?1:0;for(;y>=B+4;y-=3)m=`_${_.slice(y-3,y)}${m}`;return`${_.slice(0,y)}${m}`}function Oe(_,m,y){Le(m,"offset"),(_[m]===void 0||_[m+y]===void 0)&&Me(m,_.length-(y+1))}function Se(_,m,y,B,J,ce){if(_>y||_<m){const pe=typeof m=="bigint"?"n":"";let $e;throw m===0||m===BigInt(0)?$e=`>= 0${pe} and < 2${pe} ** ${(ce+1)*8}${pe}`:$e=`>= -(2${pe} ** ${(ce+1)*8-1}${pe}) and < 2 ** ${(ce+1)*8-1}${pe}`,new _e.ERR_OUT_OF_RANGE("value",$e,_)}Oe(B,J,ce)}function Le(_,m){if(typeof _!="number")throw new _e.ERR_INVALID_ARG_TYPE(m,"number",_)}function Me(_,m,y){throw Math.floor(_)!==_?(Le(_,y),new _e.ERR_OUT_OF_RANGE("offset","an integer",_)):m<0?new _e.ERR_BUFFER_OUT_OF_BOUNDS:new _e.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${m}`,_)}const He=/[^+/0-9A-Za-z-_]/g;function ut(_){if(_=_.split("=")[0],_=_.trim().replace(He,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function tt(_,m){m=m||1/0;let y;const B=_.length;let J=null;const ce=[];for(let pe=0;pe<B;++pe){if(y=_.charCodeAt(pe),y>55295&&y<57344){if(!J){if(y>56319){(m-=3)>-1&&ce.push(239,191,189);continue}else if(pe+1===B){(m-=3)>-1&&ce.push(239,191,189);continue}J=y;continue}if(y<56320){(m-=3)>-1&&ce.push(239,191,189),J=y;continue}y=(J-55296<<10|y-56320)+65536}else J&&(m-=3)>-1&&ce.push(239,191,189);if(J=null,y<128){if((m-=1)<0)break;ce.push(y)}else if(y<2048){if((m-=2)<0)break;ce.push(y>>6|192,y&63|128)}else if(y<65536){if((m-=3)<0)break;ce.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((m-=4)<0)break;ce.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return ce}function we(_){const m=[];for(let y=0;y<_.length;++y)m.push(_.charCodeAt(y)&255);return m}function ee(_,m){let y,B,J;const ce=[];for(let pe=0;pe<_.length&&!((m-=2)<0);++pe)y=_.charCodeAt(pe),B=y>>8,J=y%256,ce.push(J),ce.push(B);return ce}function de(_){return t.toByteArray(ut(_))}function ye(_,m,y,B){let J;for(J=0;J<B&&!(J+y>=m.length||J>=_.length);++J)m[J+y]=_[J];return J}function oe(_,m){return _ instanceof m||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===m.name}function fe(_){return _!==_}const ie=function(){const _="0123456789abcdef",m=new Array(256);for(let y=0;y<16;++y){const B=y*16;for(let J=0;J<16;++J)m[B+J]=_[y]+_[J]}return m}();function te(_){return typeof BigInt>"u"?Y:_}function Y(){throw new Error("BigInt not supported")}})(cd);const Zf=cd.Buffer;function xt(e,t,s,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}me.inherits(xt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:me.toJSONObject(this.config),code:this.code,status:this.status}}});const dd=xt.prototype,ud={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{ud[e]={value:e}});Object.defineProperties(xt,ud);Object.defineProperty(dd,"isAxiosError",{value:!0});xt.from=(e,t,s,n,o,i)=>{const c=Object.create(dd);return me.toFlatObject(e,c,function(u){return u!==Error.prototype},l=>l!=="isAxiosError"),xt.call(c,e.message,t,s,n,o),c.cause=e,c.name=e.name,i&&Object.assign(c,i),c};const eg=null;function ga(e){return me.isPlainObject(e)||me.isArray(e)}function hd(e){return me.endsWith(e,"[]")?e.slice(0,-2):e}function Ic(e,t,s){return e?e.concat(t).map(function(o,i){return o=hd(o),!s&&i?"["+o+"]":o}).join(s?".":""):t}function tg(e){return me.isArray(e)&&!e.some(ga)}const sg=me.toFlatObject(me,{},null,function(t){return/^is[A-Z]/.test(t)});function li(e,t,s){if(!me.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,s=me.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,$){return!me.isUndefined($[b])});const n=s.metaTokens,o=s.visitor||a,i=s.dots,c=s.indexes,u=(s.Blob||typeof Blob<"u"&&Blob)&&me.isSpecCompliantForm(t);if(!me.isFunction(o))throw new TypeError("visitor must be a function");function h(g){if(g===null)return"";if(me.isDate(g))return g.toISOString();if(!u&&me.isBlob(g))throw new xt("Blob is not supported. Use a Buffer instead.");return me.isArrayBuffer(g)||me.isTypedArray(g)?u&&typeof Blob=="function"?new Blob([g]):Zf.from(g):g}function a(g,b,$){let T=g;if(g&&!$&&typeof g=="object"){if(me.endsWith(b,"{}"))b=n?b:b.slice(0,-2),g=JSON.stringify(g);else if(me.isArray(g)&&tg(g)||(me.isFileList(g)||me.endsWith(b,"[]"))&&(T=me.toArray(g)))return b=hd(b),T.forEach(function(M,E){!(me.isUndefined(M)||M===null)&&t.append(c===!0?Ic([b],E,i):c===null?b:b+"[]",h(M))}),!1}return ga(g)?!0:(t.append(Ic($,b,i),h(g)),!1)}const d=[],f=Object.assign(sg,{defaultVisitor:a,convertValue:h,isVisitable:ga});function v(g,b){if(!me.isUndefined(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+b.join("."));d.push(g),me.forEach(g,function(T,F){(!(me.isUndefined(T)||T===null)&&o.call(t,T,me.isString(F)?F.trim():F,b,f))===!0&&v(T,b?b.concat(F):[F])}),d.pop()}}if(!me.isObject(e))throw new TypeError("data must be an object");return v(e),t}function $c(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function za(e,t){this._pairs=[],e&&li(e,this,t)}const fd=za.prototype;fd.append=function(t,s){this._pairs.push([t,s])};fd.toString=function(t){const s=t?function(n){return t.call(this,n,$c)}:$c;return this._pairs.map(function(o){return s(o[0])+"="+s(o[1])},"").join("&")};function ng(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function gd(e,t,s){if(!t)return e;const n=s&&s.encode||ng;me.isFunction(s)&&(s={serialize:s});const o=s&&s.serialize;let i;if(o?i=o(t,s):i=me.isURLSearchParams(t)?t.toString():new za(t,s).toString(n),i){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class Pc{constructor(){this.handlers=[]}use(t,s,n){return this.handlers.push({fulfilled:t,rejected:s,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){me.forEach(this.handlers,function(n){n!==null&&t(n)})}}const pd={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},rg=typeof URLSearchParams<"u"?URLSearchParams:za,og=typeof FormData<"u"?FormData:null,ig=typeof Blob<"u"?Blob:null,ag={isBrowser:!0,classes:{URLSearchParams:rg,FormData:og,Blob:ig},protocols:["http","https","file","blob","url","data"]},Ha=typeof window<"u"&&typeof document<"u",pa=typeof navigator=="object"&&navigator||void 0,cg=Ha&&(!pa||["ReactNative","NativeScript","NS"].indexOf(pa.product)<0),lg=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",dg=Ha&&window.location.href||"http://localhost",ug=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ha,hasStandardBrowserEnv:cg,hasStandardBrowserWebWorkerEnv:lg,navigator:pa,origin:dg},Symbol.toStringTag,{value:"Module"})),Es={...ug,...ag};function hg(e,t){return li(e,new Es.classes.URLSearchParams,Object.assign({visitor:function(s,n,o,i){return Es.isNode&&me.isBuffer(s)?(this.append(n,s.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}function fg(e){return me.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function gg(e){const t={},s=Object.keys(e);let n;const o=s.length;let i;for(n=0;n<o;n++)i=s[n],t[i]=e[i];return t}function md(e){function t(s,n,o,i){let c=s[i++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),u=i>=s.length;return c=!c&&me.isArray(o)?o.length:c,u?(me.hasOwnProp(o,c)?o[c]=[o[c],n]:o[c]=n,!l):((!o[c]||!me.isObject(o[c]))&&(o[c]=[]),t(s,n,o[c],i)&&me.isArray(o[c])&&(o[c]=gg(o[c])),!l)}if(me.isFormData(e)&&me.isFunction(e.entries)){const s={};return me.forEachEntry(e,(n,o)=>{t(fg(n),o,s,0)}),s}return null}function pg(e,t,s){if(me.isString(e))try{return(t||JSON.parse)(e),me.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(s||JSON.stringify)(e)}const ao={transitional:pd,adapter:["xhr","http","fetch"],transformRequest:[function(t,s){const n=s.getContentType()||"",o=n.indexOf("application/json")>-1,i=me.isObject(t);if(i&&me.isHTMLForm(t)&&(t=new FormData(t)),me.isFormData(t))return o?JSON.stringify(md(t)):t;if(me.isArrayBuffer(t)||me.isBuffer(t)||me.isStream(t)||me.isFile(t)||me.isBlob(t)||me.isReadableStream(t))return t;if(me.isArrayBufferView(t))return t.buffer;if(me.isURLSearchParams(t))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return hg(t,this.formSerializer).toString();if((l=me.isFileList(t))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return li(l?{"files[]":t}:t,u&&new u,this.formSerializer)}}return i||o?(s.setContentType("application/json",!1),pg(t)):t}],transformResponse:[function(t){const s=this.transitional||ao.transitional,n=s&&s.forcedJSONParsing,o=this.responseType==="json";if(me.isResponse(t)||me.isReadableStream(t))return t;if(t&&me.isString(t)&&(n&&!this.responseType||o)){const c=!(s&&s.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(l){if(c)throw l.name==="SyntaxError"?xt.from(l,xt.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Es.classes.FormData,Blob:Es.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};me.forEach(["delete","get","head","post","put","patch"],e=>{ao.headers[e]={}});const mg=me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yg=e=>{const t={};let s,n,o;return e&&e.split(`
`).forEach(function(c){o=c.indexOf(":"),s=c.substring(0,o).trim().toLowerCase(),n=c.substring(o+1).trim(),!(!s||t[s]&&mg[s])&&(s==="set-cookie"?t[s]?t[s].push(n):t[s]=[n]:t[s]=t[s]?t[s]+", "+n:n)}),t},Rc=Symbol("internals");function Fr(e){return e&&String(e).trim().toLowerCase()}function Lo(e){return e===!1||e==null?e:me.isArray(e)?e.map(Lo):String(e)}function vg(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(e);)t[n[1]]=n[2];return t}const _g=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Di(e,t,s,n,o){if(me.isFunction(n))return n.call(this,t,s);if(o&&(t=s),!!me.isString(t)){if(me.isString(n))return t.indexOf(n)!==-1;if(me.isRegExp(n))return n.test(t)}}function wg(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,s,n)=>s.toUpperCase()+n)}function bg(e,t){const s=me.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+s,{value:function(o,i,c){return this[n].call(this,t,o,i,c)},configurable:!0})})}let Ps=class{constructor(t){t&&this.set(t)}set(t,s,n){const o=this;function i(l,u,h){const a=Fr(u);if(!a)throw new Error("header name must be a non-empty string");const d=me.findKey(o,a);(!d||o[d]===void 0||h===!0||h===void 0&&o[d]!==!1)&&(o[d||u]=Lo(l))}const c=(l,u)=>me.forEach(l,(h,a)=>i(h,a,u));if(me.isPlainObject(t)||t instanceof this.constructor)c(t,s);else if(me.isString(t)&&(t=t.trim())&&!_g(t))c(yg(t),s);else if(me.isObject(t)&&me.isIterable(t)){let l={},u,h;for(const a of t){if(!me.isArray(a))throw TypeError("Object iterator must return a key-value pair");l[h=a[0]]=(u=l[h])?me.isArray(u)?[...u,a[1]]:[u,a[1]]:a[1]}c(l,s)}else t!=null&&i(s,t,n);return this}get(t,s){if(t=Fr(t),t){const n=me.findKey(this,t);if(n){const o=this[n];if(!s)return o;if(s===!0)return vg(o);if(me.isFunction(s))return s.call(this,o,n);if(me.isRegExp(s))return s.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=Fr(t),t){const n=me.findKey(this,t);return!!(n&&this[n]!==void 0&&(!s||Di(this,this[n],n,s)))}return!1}delete(t,s){const n=this;let o=!1;function i(c){if(c=Fr(c),c){const l=me.findKey(n,c);l&&(!s||Di(n,n[l],l,s))&&(delete n[l],o=!0)}}return me.isArray(t)?t.forEach(i):i(t),o}clear(t){const s=Object.keys(this);let n=s.length,o=!1;for(;n--;){const i=s[n];(!t||Di(this,this[i],i,t,!0))&&(delete this[i],o=!0)}return o}normalize(t){const s=this,n={};return me.forEach(this,(o,i)=>{const c=me.findKey(n,i);if(c){s[c]=Lo(o),delete s[i];return}const l=t?wg(i):String(i).trim();l!==i&&delete s[i],s[l]=Lo(o),n[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const s=Object.create(null);return me.forEach(this,(n,o)=>{n!=null&&n!==!1&&(s[o]=t&&me.isArray(n)?n.join(", "):n)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,s])=>t+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...s){const n=new this(t);return s.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[Rc]=this[Rc]={accessors:{}}).accessors,o=this.prototype;function i(c){const l=Fr(c);n[l]||(bg(o,c),n[l]=!0)}return me.isArray(t)?t.forEach(i):i(t),this}};Ps.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);me.reduceDescriptors(Ps.prototype,({value:e},t)=>{let s=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[s]=n}}});me.freezeMethods(Ps);function Bi(e,t){const s=this||ao,n=t||s,o=Ps.from(n.headers);let i=n.data;return me.forEach(e,function(l){i=l.call(s,i,o.normalize(),t?t.status:void 0)}),o.normalize(),i}function yd(e){return!!(e&&e.__CANCEL__)}function Sr(e,t,s){xt.call(this,e??"canceled",xt.ERR_CANCELED,t,s),this.name="CanceledError"}me.inherits(Sr,xt,{__CANCEL__:!0});function vd(e,t,s){const n=s.config.validateStatus;!s.status||!n||n(s.status)?e(s):t(new xt("Request failed with status code "+s.status,[xt.ERR_BAD_REQUEST,xt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function xg(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Sg(e,t){e=e||10;const s=new Array(e),n=new Array(e);let o=0,i=0,c;return t=t!==void 0?t:1e3,function(u){const h=Date.now(),a=n[i];c||(c=h),s[o]=u,n[o]=h;let d=i,f=0;for(;d!==o;)f+=s[d++],d=d%e;if(o=(o+1)%e,o===i&&(i=(i+1)%e),h-c<t)return;const v=a&&h-a;return v?Math.round(f*1e3/v):void 0}}function Cg(e,t){let s=0,n=1e3/t,o,i;const c=(h,a=Date.now())=>{s=a,o=null,i&&(clearTimeout(i),i=null),e.apply(null,h)};return[(...h)=>{const a=Date.now(),d=a-s;d>=n?c(h,a):(o=h,i||(i=setTimeout(()=>{i=null,c(o)},n-d)))},()=>o&&c(o)]}const Ho=(e,t,s=3)=>{let n=0;const o=Sg(50,250);return Cg(i=>{const c=i.loaded,l=i.lengthComputable?i.total:void 0,u=c-n,h=o(u),a=c<=l;n=c;const d={loaded:c,total:l,progress:l?c/l:void 0,bytes:u,rate:h||void 0,estimated:h&&l&&a?(l-c)/h:void 0,event:i,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(d)},s)},Mc=(e,t)=>{const s=e!=null;return[n=>t[0]({lengthComputable:s,total:e,loaded:n}),t[1]]},Lc=e=>(...t)=>me.asap(()=>e(...t)),kg=Es.hasStandardBrowserEnv?((e,t)=>s=>(s=new URL(s,Es.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new URL(Es.origin),Es.navigator&&/(msie|trident)/i.test(Es.navigator.userAgent)):()=>!0,Ng=Es.hasStandardBrowserEnv?{write(e,t,s,n,o,i){const c=[e+"="+encodeURIComponent(t)];me.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),me.isString(n)&&c.push("path="+n),me.isString(o)&&c.push("domain="+o),i===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Eg(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Tg(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function _d(e,t,s){let n=!Eg(t);return e&&(n||s==!1)?Tg(e,t):t}const Oc=e=>e instanceof Ps?{...e}:e;function er(e,t){t=t||{};const s={};function n(h,a,d,f){return me.isPlainObject(h)&&me.isPlainObject(a)?me.merge.call({caseless:f},h,a):me.isPlainObject(a)?me.merge({},a):me.isArray(a)?a.slice():a}function o(h,a,d,f){if(me.isUndefined(a)){if(!me.isUndefined(h))return n(void 0,h,d,f)}else return n(h,a,d,f)}function i(h,a){if(!me.isUndefined(a))return n(void 0,a)}function c(h,a){if(me.isUndefined(a)){if(!me.isUndefined(h))return n(void 0,h)}else return n(void 0,a)}function l(h,a,d){if(d in t)return n(h,a);if(d in e)return n(void 0,h)}const u={url:i,method:i,data:i,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,a,d)=>o(Oc(h),Oc(a),d,!0)};return me.forEach(Object.keys(Object.assign({},e,t)),function(a){const d=u[a]||o,f=d(e[a],t[a],a);me.isUndefined(f)&&d!==l||(s[a]=f)}),s}const wd=e=>{const t=er({},e);let{data:s,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:i,headers:c,auth:l}=t;t.headers=c=Ps.from(c),t.url=gd(_d(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let u;if(me.isFormData(s)){if(Es.hasStandardBrowserEnv||Es.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((u=c.getContentType())!==!1){const[h,...a]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];c.setContentType([h||"multipart/form-data",...a].join("; "))}}if(Es.hasStandardBrowserEnv&&(n&&me.isFunction(n)&&(n=n(t)),n||n!==!1&&kg(t.url))){const h=o&&i&&Ng.read(i);h&&c.set(o,h)}return t},Ag=typeof XMLHttpRequest<"u",jg=Ag&&function(e){return new Promise(function(s,n){const o=wd(e);let i=o.data;const c=Ps.from(o.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:h}=o,a,d,f,v,g;function b(){v&&v(),g&&g(),o.cancelToken&&o.cancelToken.unsubscribe(a),o.signal&&o.signal.removeEventListener("abort",a)}let $=new XMLHttpRequest;$.open(o.method.toUpperCase(),o.url,!0),$.timeout=o.timeout;function T(){if(!$)return;const M=Ps.from("getAllResponseHeaders"in $&&$.getAllResponseHeaders()),U={data:!l||l==="text"||l==="json"?$.responseText:$.response,status:$.status,statusText:$.statusText,headers:M,config:e,request:$};vd(function(D){s(D),b()},function(D){n(D),b()},U),$=null}"onloadend"in $?$.onloadend=T:$.onreadystatechange=function(){!$||$.readyState!==4||$.status===0&&!($.responseURL&&$.responseURL.indexOf("file:")===0)||setTimeout(T)},$.onabort=function(){$&&(n(new xt("Request aborted",xt.ECONNABORTED,e,$)),$=null)},$.onerror=function(){n(new xt("Network Error",xt.ERR_NETWORK,e,$)),$=null},$.ontimeout=function(){let E=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const U=o.transitional||pd;o.timeoutErrorMessage&&(E=o.timeoutErrorMessage),n(new xt(E,U.clarifyTimeoutError?xt.ETIMEDOUT:xt.ECONNABORTED,e,$)),$=null},i===void 0&&c.setContentType(null),"setRequestHeader"in $&&me.forEach(c.toJSON(),function(E,U){$.setRequestHeader(U,E)}),me.isUndefined(o.withCredentials)||($.withCredentials=!!o.withCredentials),l&&l!=="json"&&($.responseType=o.responseType),h&&([f,g]=Ho(h,!0),$.addEventListener("progress",f)),u&&$.upload&&([d,v]=Ho(u),$.upload.addEventListener("progress",d),$.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(a=M=>{$&&(n(!M||M.type?new Sr(null,e,$):M),$.abort(),$=null)},o.cancelToken&&o.cancelToken.subscribe(a),o.signal&&(o.signal.aborted?a():o.signal.addEventListener("abort",a)));const F=xg(o.url);if(F&&Es.protocols.indexOf(F)===-1){n(new xt("Unsupported protocol "+F+":",xt.ERR_BAD_REQUEST,e));return}$.send(i||null)})},Ig=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let n=new AbortController,o;const i=function(h){if(!o){o=!0,l();const a=h instanceof Error?h:this.reason;n.abort(a instanceof xt?a:new Sr(a instanceof Error?a.message:a))}};let c=t&&setTimeout(()=>{c=null,i(new xt(`timeout ${t} of ms exceeded`,xt.ETIMEDOUT))},t);const l=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(i):h.removeEventListener("abort",i)}),e=null)};e.forEach(h=>h.addEventListener("abort",i));const{signal:u}=n;return u.unsubscribe=()=>me.asap(l),u}},$g=function*(e,t){let s=e.byteLength;if(s<t){yield e;return}let n=0,o;for(;n<s;)o=n+t,yield e.slice(n,o),n=o},Pg=async function*(e,t){for await(const s of Rg(e))yield*$g(s,t)},Rg=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:s,value:n}=await t.read();if(s)break;yield n}}finally{await t.cancel()}},Fc=(e,t,s,n)=>{const o=Pg(e,t);let i=0,c,l=u=>{c||(c=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:h,value:a}=await o.next();if(h){l(),u.close();return}let d=a.byteLength;if(s){let f=i+=d;s(f)}u.enqueue(new Uint8Array(a))}catch(h){throw l(h),h}},cancel(u){return l(u),o.return()}},{highWaterMark:2})},di=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",bd=di&&typeof ReadableStream=="function",Mg=di&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),xd=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Lg=bd&&xd(()=>{let e=!1;const t=new Request(Es.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Dc=64*1024,ma=bd&&xd(()=>me.isReadableStream(new Response("").body)),Vo={stream:ma&&(e=>e.body)};di&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Vo[t]&&(Vo[t]=me.isFunction(e[t])?s=>s[t]():(s,n)=>{throw new xt(`Response type '${t}' is not supported`,xt.ERR_NOT_SUPPORT,n)})})})(new Response);const Og=async e=>{if(e==null)return 0;if(me.isBlob(e))return e.size;if(me.isSpecCompliantForm(e))return(await new Request(Es.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(me.isArrayBufferView(e)||me.isArrayBuffer(e))return e.byteLength;if(me.isURLSearchParams(e)&&(e=e+""),me.isString(e))return(await Mg(e)).byteLength},Fg=async(e,t)=>{const s=me.toFiniteNumber(e.getContentLength());return s??Og(t)},Dg=di&&(async e=>{let{url:t,method:s,data:n,signal:o,cancelToken:i,timeout:c,onDownloadProgress:l,onUploadProgress:u,responseType:h,headers:a,withCredentials:d="same-origin",fetchOptions:f}=wd(e);h=h?(h+"").toLowerCase():"text";let v=Ig([o,i&&i.toAbortSignal()],c),g;const b=v&&v.unsubscribe&&(()=>{v.unsubscribe()});let $;try{if(u&&Lg&&s!=="get"&&s!=="head"&&($=await Fg(a,n))!==0){let U=new Request(t,{method:"POST",body:n,duplex:"half"}),A;if(me.isFormData(n)&&(A=U.headers.get("content-type"))&&a.setContentType(A),U.body){const[D,w]=Mc($,Ho(Lc(u)));n=Fc(U.body,Dc,D,w)}}me.isString(d)||(d=d?"include":"omit");const T="credentials"in Request.prototype;g=new Request(t,{...f,signal:v,method:s.toUpperCase(),headers:a.normalize().toJSON(),body:n,duplex:"half",credentials:T?d:void 0});let F=await fetch(g);const M=ma&&(h==="stream"||h==="response");if(ma&&(l||M&&b)){const U={};["status","statusText","headers"].forEach(N=>{U[N]=F[N]});const A=me.toFiniteNumber(F.headers.get("content-length")),[D,w]=l&&Mc(A,Ho(Lc(l),!0))||[];F=new Response(Fc(F.body,Dc,D,()=>{w&&w(),b&&b()}),U)}h=h||"text";let E=await Vo[me.findKey(Vo,h)||"text"](F,e);return!M&&b&&b(),await new Promise((U,A)=>{vd(U,A,{data:E,headers:Ps.from(F.headers),status:F.status,statusText:F.statusText,config:e,request:g})})}catch(T){throw b&&b(),T&&T.name==="TypeError"&&/Load failed|fetch/i.test(T.message)?Object.assign(new xt("Network Error",xt.ERR_NETWORK,e,g),{cause:T.cause||T}):xt.from(T,T&&T.code,e,g)}}),ya={http:eg,xhr:jg,fetch:Dg};me.forEach(ya,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Bc=e=>`- ${e}`,Bg=e=>me.isFunction(e)||e===null||e===!1,Sd={getAdapter:e=>{e=me.isArray(e)?e:[e];const{length:t}=e;let s,n;const o={};for(let i=0;i<t;i++){s=e[i];let c;if(n=s,!Bg(s)&&(n=ya[(c=String(s)).toLowerCase()],n===void 0))throw new xt(`Unknown adapter '${c}'`);if(n)break;o[c||"#"+i]=n}if(!n){const i=Object.entries(o).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let c=t?i.length>1?`since :
`+i.map(Bc).join(`
`):" "+Bc(i[0]):"as no adapter specified";throw new xt("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return n},adapters:ya};function Ui(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Sr(null,e)}function Uc(e){return Ui(e),e.headers=Ps.from(e.headers),e.data=Bi.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Sd.getAdapter(e.adapter||ao.adapter)(e).then(function(n){return Ui(e),n.data=Bi.call(e,e.transformResponse,n),n.headers=Ps.from(n.headers),n},function(n){return yd(n)||(Ui(e),n&&n.response&&(n.response.data=Bi.call(e,e.transformResponse,n.response),n.response.headers=Ps.from(n.response.headers))),Promise.reject(n)})}const Cd="1.9.0",ui={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ui[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const qc={};ui.transitional=function(t,s,n){function o(i,c){return"[Axios v"+Cd+"] Transitional option '"+i+"'"+c+(n?". "+n:"")}return(i,c,l)=>{if(t===!1)throw new xt(o(c," has been removed"+(s?" in "+s:"")),xt.ERR_DEPRECATED);return s&&!qc[c]&&(qc[c]=!0,console.warn(o(c," has been deprecated since v"+s+" and will be removed in the near future"))),t?t(i,c,l):!0}};ui.spelling=function(t){return(s,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function Ug(e,t,s){if(typeof e!="object")throw new xt("options must be an object",xt.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let o=n.length;for(;o-- >0;){const i=n[o],c=t[i];if(c){const l=e[i],u=l===void 0||c(l,i,e);if(u!==!0)throw new xt("option "+i+" must be "+u,xt.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new xt("Unknown option "+i,xt.ERR_BAD_OPTION)}}const Oo={assertOptions:Ug,validators:ui},on=Oo.validators;let Qn=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Pc,response:new Pc}}async request(t,s){try{return await this._request(t,s)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,s){typeof t=="string"?(s=s||{},s.url=t):s=t||{},s=er(this.defaults,s);const{transitional:n,paramsSerializer:o,headers:i}=s;n!==void 0&&Oo.assertOptions(n,{silentJSONParsing:on.transitional(on.boolean),forcedJSONParsing:on.transitional(on.boolean),clarifyTimeoutError:on.transitional(on.boolean)},!1),o!=null&&(me.isFunction(o)?s.paramsSerializer={serialize:o}:Oo.assertOptions(o,{encode:on.function,serialize:on.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),Oo.assertOptions(s,{baseUrl:on.spelling("baseURL"),withXsrfToken:on.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let c=i&&me.merge(i.common,i[s.method]);i&&me.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),s.headers=Ps.concat(c,i);const l=[];let u=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(s)===!1||(u=u&&b.synchronous,l.unshift(b.fulfilled,b.rejected))});const h=[];this.interceptors.response.forEach(function(b){h.push(b.fulfilled,b.rejected)});let a,d=0,f;if(!u){const g=[Uc.bind(this),void 0];for(g.unshift.apply(g,l),g.push.apply(g,h),f=g.length,a=Promise.resolve(s);d<f;)a=a.then(g[d++],g[d++]);return a}f=l.length;let v=s;for(d=0;d<f;){const g=l[d++],b=l[d++];try{v=g(v)}catch($){b.call(this,$);break}}try{a=Uc.call(this,v)}catch(g){return Promise.reject(g)}for(d=0,f=h.length;d<f;)a=a.then(h[d++],h[d++]);return a}getUri(t){t=er(this.defaults,t);const s=_d(t.baseURL,t.url,t.allowAbsoluteUrls);return gd(s,t.params,t.paramsSerializer)}};me.forEach(["delete","get","head","options"],function(t){Qn.prototype[t]=function(s,n){return this.request(er(n||{},{method:t,url:s,data:(n||{}).data}))}});me.forEach(["post","put","patch"],function(t){function s(n){return function(i,c,l){return this.request(er(l||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:c}))}}Qn.prototype[t]=s(),Qn.prototype[t+"Form"]=s(!0)});let qg=class kd{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(i){s=i});const n=this;this.promise.then(o=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](o);n._listeners=null}),this.promise.then=o=>{let i;const c=new Promise(l=>{n.subscribe(l),i=l}).then(o);return c.cancel=function(){n.unsubscribe(i)},c},t(function(i,c,l){n.reason||(n.reason=new Sr(i,c,l),s(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const t=new AbortController,s=n=>{t.abort(n)};return this.subscribe(s),t.signal.unsubscribe=()=>this.unsubscribe(s),t.signal}static source(){let t;return{token:new kd(function(o){t=o}),cancel:t}}};function zg(e){return function(s){return e.apply(null,s)}}function Hg(e){return me.isObject(e)&&e.isAxiosError===!0}const va={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(va).forEach(([e,t])=>{va[t]=e});function Nd(e){const t=new Qn(e),s=ed(Qn.prototype.request,t);return me.extend(s,Qn.prototype,t,{allOwnKeys:!0}),me.extend(s,t,null,{allOwnKeys:!0}),s.create=function(o){return Nd(er(e,o))},s}const Qt=Nd(ao);Qt.Axios=Qn;Qt.CanceledError=Sr;Qt.CancelToken=qg;Qt.isCancel=yd;Qt.VERSION=Cd;Qt.toFormData=li;Qt.AxiosError=xt;Qt.Cancel=Qt.CanceledError;Qt.all=function(t){return Promise.all(t)};Qt.spread=zg;Qt.isAxiosError=Hg;Qt.mergeConfig=er;Qt.AxiosHeaders=Ps;Qt.formToJSON=e=>md(me.isHTMLForm(e)?new FormData(e):e);Qt.getAdapter=Sd.getAdapter;Qt.HttpStatusCode=va;Qt.default=Qt;const{Axios:aK,AxiosError:cK,CanceledError:lK,isCancel:dK,CancelToken:uK,VERSION:hK,all:fK,Cancel:gK,isAxiosError:pK,spread:mK,toFormData:yK,AxiosHeaders:vK,HttpStatusCode:_K,formToJSON:wK,getAdapter:bK,mergeConfig:xK}=Qt,ts={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",NONE:"none"},Xs={level:ts.ERROR,enabled:!1,includeTimestamp:!0,groupByContext:!0},zc={[ts.DEBUG]:0,[ts.INFO]:1,[ts.WARN]:2,[ts.ERROR]:3,[ts.NONE]:4},Vg=(e,t)=>{let s="";if(e&&(s+=`[${e}] `),Xs.includeTimestamp){const o=new Date().toLocaleTimeString();s+=`${o} `}return s+=t,s},un=(e,t,s,...n)=>{if(!Xs.enabled||zc[e]<zc[Xs.level])return;const o=Vg(t,s);if(Xs.groupByContext&&t&&n.length>0&&typeof n[0]=="object"){console.groupCollapsed(o),n.forEach(c=>{c!==null&&typeof c=="object"?console.dir(c):console.log(c)}),console.groupEnd();return}switch(e){case ts.DEBUG:console.debug(o,...n);break;case ts.INFO:console.info(o,...n);break;case ts.WARN:console.warn(o,...n);break;case ts.ERROR:console.error(o,...n);break;default:console.log(o,...n)}},Dn=e=>({debug:(t,...s)=>un(ts.DEBUG,e,t,...s),info:(t,...s)=>un(ts.INFO,e,t,...s),warn:(t,...s)=>un(ts.WARN,e,t,...s),error:(t,...s)=>un(ts.ERROR,e,t,...s),log:(t,...s)=>un(ts.INFO,e,t,...s)}),Ze={debug:(e,...t)=>un(ts.DEBUG,"",e,...t),info:(e,...t)=>un(ts.INFO,"",e,...t),warn:(e,...t)=>un(ts.WARN,"",e,...t),error:(e,...t)=>un(ts.ERROR,"",e,...t),log:(e,...t)=>un(ts.INFO,"",e,...t),create:e=>Dn(e),setLevel:e=>{ts[e]&&(Xs.level=e)},getLevel:()=>Xs.level,enable:()=>{Xs.enabled=!0},disable:()=>{Xs.enabled=!1},isEnabled:()=>Xs.enabled,includeTimestamp:(e=!0)=>{Xs.includeTimestamp=e},groupByContext:(e=!0)=>{Xs.groupByContext=e}},Va=Ze.create("chatUtils"),Wg=(e,t)=>{var n,o,i,c,l,u,h;if(!e)return"No messages yet";const s=e.sender===t?"You: ":"";switch(e.type){case"text":const a=e.content||"";return s+(a.length>25?`${a.substring(0,25)}...`:a);case"wink":return s+"Sent a wink 😉";case"file":return(o=(n=e.metadata)==null?void 0:n.fileType)!=null&&o.startsWith("image/")?s+"Sent an image":(c=(i=e.metadata)==null?void 0:i.fileType)!=null&&c.startsWith("video/")?s+"Sent a video":(u=(l=e.metadata)==null?void 0:l.fileType)!=null&&u.startsWith("audio/")?s+"Sent an audio file":((h=e.metadata)==null?void 0:h.fileType)==="application/pdf"?s+"Sent a PDF document":s+"Sent a file";case"video":return s+"Video Call";default:return s+"New message"}},Wa=e=>{const t={};if(!Array.isArray(e))return t;const s=new Set;return e.forEach(n=>{if(n&&n.createdAt){const o=n._id||n.tempId;if(o&&s.has(o))return;o&&s.add(o);const i=new Date(n.createdAt).toDateString();t[i]=t[i]||[],t[i].push(n)}}),t},Os=(...e)=>e.filter(Boolean).join(" "),Gg=e=>{if(!e)return"";try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}catch(t){return Va.warn("Error formatting message time:",t),""}},Hc=e=>{if(!e)return"Unknown date";try{const t=new Date(e),s=new Date,n=new Date(s);return n.setDate(n.getDate()-1),t.toDateString()===s.toDateString()?"Today":t.toDateString()===n.toDateString()?"Yesterday":t.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})}catch(t){return Va.warn("Error formatting message date separator:",t),"Unknown date"}},Yg=e=>{if(!e)return"";try{const t=new Date(e),n=Math.round((new Date-t)/1e3),o=Math.round(n/60),i=Math.round(o/60),c=Math.round(i/24);return n<60?"Just now":o<60?`${o}m ago`:i<24?`${i}h ago`:c===1?"Yesterday":c<7?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}catch(t){return Va.warn("Error formatting preview time:",t),""}},fn=Object.create(null);fn.open="0";fn.close="1";fn.ping="2";fn.pong="3";fn.message="4";fn.upgrade="5";fn.noop="6";const Fo=Object.create(null);Object.keys(fn).forEach(e=>{Fo[fn[e]]=e});const _a={type:"error",data:"parser error"},Ed=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Td=typeof ArrayBuffer=="function",Ad=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Ga=({type:e,data:t},s,n)=>Ed&&t instanceof Blob?s?n(t):Vc(t,n):Td&&(t instanceof ArrayBuffer||Ad(t))?s?n(t):Vc(new Blob([t]),n):n(fn[e]+(t||"")),Vc=(e,t)=>{const s=new FileReader;return s.onload=function(){const n=s.result.split(",")[1];t("b"+(n||""))},s.readAsDataURL(e)};function Wc(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let qi;function Kg(e,t){if(Ed&&e.data instanceof Blob)return e.data.arrayBuffer().then(Wc).then(t);if(Td&&(e.data instanceof ArrayBuffer||Ad(e.data)))return t(Wc(e.data));Ga(e,!1,s=>{qi||(qi=new TextEncoder),t(qi.encode(s))})}const Gc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wr=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<Gc.length;e++)Wr[Gc.charCodeAt(e)]=e;const Jg=e=>{let t=e.length*.75,s=e.length,n,o=0,i,c,l,u;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const h=new ArrayBuffer(t),a=new Uint8Array(h);for(n=0;n<s;n+=4)i=Wr[e.charCodeAt(n)],c=Wr[e.charCodeAt(n+1)],l=Wr[e.charCodeAt(n+2)],u=Wr[e.charCodeAt(n+3)],a[o++]=i<<2|c>>4,a[o++]=(c&15)<<4|l>>2,a[o++]=(l&3)<<6|u&63;return h},Qg=typeof ArrayBuffer=="function",Ya=(e,t)=>{if(typeof e!="string")return{type:"message",data:jd(e,t)};const s=e.charAt(0);return s==="b"?{type:"message",data:Xg(e.substring(1),t)}:Fo[s]?e.length>1?{type:Fo[s],data:e.substring(1)}:{type:Fo[s]}:_a},Xg=(e,t)=>{if(Qg){const s=Jg(e);return jd(s,t)}else return{base64:!0,data:e}},jd=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},Id="",Zg=(e,t)=>{const s=e.length,n=new Array(s);let o=0;e.forEach((i,c)=>{Ga(i,!1,l=>{n[c]=l,++o===s&&t(n.join(Id))})})},ep=(e,t)=>{const s=e.split(Id),n=[];for(let o=0;o<s.length;o++){const i=Ya(s[o],t);if(n.push(i),i.type==="error")break}return n};function tp(){return new TransformStream({transform(e,t){Kg(e,s=>{const n=s.length;let o;if(n<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,n);else if(n<65536){o=new Uint8Array(3);const i=new DataView(o.buffer);i.setUint8(0,126),i.setUint16(1,n)}else{o=new Uint8Array(9);const i=new DataView(o.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(n))}e.data&&typeof e.data!="string"&&(o[0]|=128),t.enqueue(o),t.enqueue(s)})}})}let zi;function Eo(e){return e.reduce((t,s)=>t+s.length,0)}function To(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let n=0;for(let o=0;o<t;o++)s[o]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),s}function sp(e,t){zi||(zi=new TextDecoder);const s=[];let n=0,o=-1,i=!1;return new TransformStream({transform(c,l){for(s.push(c);;){if(n===0){if(Eo(s)<1)break;const u=To(s,1);i=(u[0]&128)===128,o=u[0]&127,o<126?n=3:o===126?n=1:n=2}else if(n===1){if(Eo(s)<2)break;const u=To(s,2);o=new DataView(u.buffer,u.byteOffset,u.length).getUint16(0),n=3}else if(n===2){if(Eo(s)<8)break;const u=To(s,8),h=new DataView(u.buffer,u.byteOffset,u.length),a=h.getUint32(0);if(a>Math.pow(2,21)-1){l.enqueue(_a);break}o=a*Math.pow(2,32)+h.getUint32(4),n=3}else{if(Eo(s)<o)break;const u=To(s,o);l.enqueue(Ya(i?u:zi.decode(u),t)),n=0}if(o===0||o>e){l.enqueue(_a);break}}}})}const $d=4;function cs(e){if(e)return np(e)}function np(e){for(var t in cs.prototype)e[t]=cs.prototype[t];return e}cs.prototype.on=cs.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};cs.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this};cs.prototype.off=cs.prototype.removeListener=cs.prototype.removeAllListeners=cs.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+e];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var n,o=0;o<s.length;o++)if(n=s[o],n===t||n.fn===t){s.splice(o,1);break}return s.length===0&&delete this._callbacks["$"+e],this};cs.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s){s=s.slice(0);for(var n=0,o=s.length;n<o;++n)s[n].apply(this,t)}return this};cs.prototype.emitReserved=cs.prototype.emit;cs.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};cs.prototype.hasListeners=function(e){return!!this.listeners(e).length};const hi=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,s)=>s(t,0),Vs=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),rp="arraybuffer";function Pd(e,...t){return t.reduce((s,n)=>(e.hasOwnProperty(n)&&(s[n]=e[n]),s),{})}const op=Vs.setTimeout,ip=Vs.clearTimeout;function fi(e,t){t.useNativeTimers?(e.setTimeoutFn=op.bind(Vs),e.clearTimeoutFn=ip.bind(Vs)):(e.setTimeoutFn=Vs.setTimeout.bind(Vs),e.clearTimeoutFn=Vs.clearTimeout.bind(Vs))}const ap=1.33;function cp(e){return typeof e=="string"?lp(e):Math.ceil((e.byteLength||e.size)*ap)}function lp(e){let t=0,s=0;for(let n=0,o=e.length;n<o;n++)t=e.charCodeAt(n),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(n++,s+=4);return s}function Rd(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function dp(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}function up(e){let t={},s=e.split("&");for(let n=0,o=s.length;n<o;n++){let i=s[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}class hp extends Error{constructor(t,s,n){super(t),this.description=s,this.context=n,this.type="TransportError"}}class Ka extends cs{constructor(t){super(),this.writable=!1,fi(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,s,n){return super.emitReserved("error",new hp(t,s,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const s=Ya(t,this.socket.binaryType);this.onPacket(s)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,s={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const s=dp(t);return s.length?"?"+s:""}}class fp extends Ka{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const s=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||s()})),this.writable||(n++,this.once("drain",function(){--n||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const s=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};ep(t,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Zg(t,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=Rd()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(t,s)}}let Md=!1;try{Md=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const gp=Md;function pp(){}class mp extends fp{constructor(t){if(super(t),typeof location<"u"){const s=location.protocol==="https:";let n=location.port;n||(n=s?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}}doWrite(t,s){const n=this.request({method:"POST",data:t});n.on("success",s),n.on("error",(o,i)=>{this.onError("xhr post error",o,i)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(s,n)=>{this.onError("xhr poll error",s,n)}),this.pollXhr=t}}let mr=class Do extends cs{constructor(t,s,n){super(),this.createRequest=t,fi(this,n),this._opts=n,this._method=n.method||"GET",this._uri=s,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var t;const s=Pd(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(s);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var o;n.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=Do.requestsCount++,Do.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=pp,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Do.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};mr.requestsCount=0;mr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Yc);else if(typeof addEventListener=="function"){const e="onpagehide"in Vs?"pagehide":"unload";addEventListener(e,Yc,!1)}}function Yc(){for(let e in mr.requests)mr.requests.hasOwnProperty(e)&&mr.requests[e].abort()}const yp=function(){const e=Ld({xdomain:!1});return e&&e.responseType!==null}();class vp extends mp{constructor(t){super(t);const s=t&&t.forceBase64;this.supportsBinary=yp&&!s}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new mr(Ld,this.uri(),t)}}function Ld(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||gp))return new XMLHttpRequest}catch{}if(!t)try{return new Vs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Od=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class _p extends Ka{get name(){return"websocket"}doOpen(){const t=this.uri(),s=this.opts.protocols,n=Od?{}:Pd(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,s,n)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let s=0;s<t.length;s++){const n=t[s],o=s===t.length-1;Ga(n,this.supportsBinary,i=>{try{this.doWrite(n,i)}catch{}o&&hi(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=Rd()),this.supportsBinary||(s.b64=1),this.createUri(t,s)}}const Hi=Vs.WebSocket||Vs.MozWebSocket;class wp extends _p{createSocket(t,s,n){return Od?new Hi(t,s,n):s?new Hi(t,s):new Hi(t)}doWrite(t,s){this.ws.send(s)}}class bp extends Ka{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const s=sp(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(s).getReader(),o=tp();o.readable.pipeTo(t.writable),this._writer=o.writable.getWriter();const i=()=>{n.read().then(({done:l,value:u})=>{l||(this.onPacket(u),i())}).catch(l=>{})};i();const c={type:"open"};this.query.sid&&(c.data=`{"sid":"${this.query.sid}"}`),this._writer.write(c).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let s=0;s<t.length;s++){const n=t[s],o=s===t.length-1;this._writer.write(n).then(()=>{o&&hi(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const xp={websocket:wp,webtransport:bp,polling:vp},Sp=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Cp=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function wa(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),n=e.indexOf("]");s!=-1&&n!=-1&&(e=e.substring(0,s)+e.substring(s,n).replace(/:/g,";")+e.substring(n,e.length));let o=Sp.exec(e||""),i={},c=14;for(;c--;)i[Cp[c]]=o[c]||"";return s!=-1&&n!=-1&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=kp(i,i.path),i.queryKey=Np(i,i.query),i}function kp(e,t){const s=/\/{2,9}/g,n=t.replace(s,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&n.splice(0,1),t.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Np(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,o,i){o&&(s[o]=i)}),s}const ba=typeof addEventListener=="function"&&typeof removeEventListener=="function",Bo=[];ba&&addEventListener("offline",()=>{Bo.forEach(e=>e())},!1);class Ln extends cs{constructor(t,s){if(super(),this.binaryType=rp,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(s=t,t=null),t){const n=wa(t);s.hostname=n.host,s.secure=n.protocol==="https"||n.protocol==="wss",s.port=n.port,n.query&&(s.query=n.query)}else s.host&&(s.hostname=wa(s.host).host);fi(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(n=>{const o=n.prototype.name;this.transports.push(o),this._transportsByName[o]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=up(this.opts.query)),ba&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Bo.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const s=Object.assign({},this.opts.query);s.EIO=$d,s.transport=t,this.id&&(s.sid=this.id);const n=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Ln.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(t);s.open(),this.setTransport(s)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",Ln.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=t.data,this._onError(s);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let n=0;n<this.writeBuffer.length;n++){const o=this.writeBuffer[n].data;if(o&&(s+=cp(o)),n>0&&s>this._maxPayload)return this.writeBuffer.slice(0,n);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,hi(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,s,n){return this._sendPacket("message",t,s,n),this}send(t,s,n){return this._sendPacket("message",t,s,n),this}_sendPacket(t,s,n,o){if(typeof s=="function"&&(o=s,s=void 0),typeof n=="function"&&(o=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const i={type:t,data:s,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),t()},n=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():t()}):this.upgrading?n():t()),this}_onError(t){if(Ln.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ba&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=Bo.indexOf(this._offlineEventListener);n!==-1&&Bo.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,s),this.writeBuffer=[],this._prevBufferLen=0}}}Ln.protocol=$d;class Ep extends Ln{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let s=this.createTransport(t),n=!1;Ln.priorWebsocketSuccess=!1;const o=()=>{n||(s.send([{type:"ping",data:"probe"}]),s.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;Ln.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(a(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=s.name,this.emitReserved("upgradeError",f)}}))};function i(){n||(n=!0,a(),s.close(),s=null)}const c=d=>{const f=new Error("probe error: "+d);f.transport=s.name,i(),this.emitReserved("upgradeError",f)};function l(){c("transport closed")}function u(){c("socket closed")}function h(d){s&&d.name!==s.name&&i()}const a=()=>{s.removeListener("open",o),s.removeListener("error",c),s.removeListener("close",l),this.off("close",u),this.off("upgrading",h)};s.once("open",o),s.once("error",c),s.once("close",l),this.once("close",u),this.once("upgrading",h),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{n||s.open()},200):s.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const s=[];for(let n=0;n<t.length;n++)~this.transports.indexOf(t[n])&&s.push(t[n]);return s}}let Tp=class extends Ep{constructor(t,s={}){const n=typeof t=="object"?t:s;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(o=>xp[o]).filter(o=>!!o)),super(t,n)}};function Ap(e,t="",s){let n=e;s=s||typeof location<"u"&&location,e==null&&(e=s.protocol+"//"+s.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=s.protocol+e:e=s.host+e),/^(https?|wss?):\/\//.test(e)||(typeof s<"u"?e=s.protocol+"//"+e:e="https://"+e),n=wa(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(s&&s.port===n.port?"":":"+n.port),n}const jp=typeof ArrayBuffer=="function",Ip=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Fd=Object.prototype.toString,$p=typeof Blob=="function"||typeof Blob<"u"&&Fd.call(Blob)==="[object BlobConstructor]",Pp=typeof File=="function"||typeof File<"u"&&Fd.call(File)==="[object FileConstructor]";function Ja(e){return jp&&(e instanceof ArrayBuffer||Ip(e))||$p&&e instanceof Blob||Pp&&e instanceof File}function Uo(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let s=0,n=e.length;s<n;s++)if(Uo(e[s]))return!0;return!1}if(Ja(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Uo(e.toJSON(),!0);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&Uo(e[s]))return!0;return!1}function Rp(e){const t=[],s=e.data,n=e;return n.data=xa(s,t),n.attachments=t.length,{packet:n,buffers:t}}function xa(e,t){if(!e)return e;if(Ja(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}else if(Array.isArray(e)){const s=new Array(e.length);for(let n=0;n<e.length;n++)s[n]=xa(e[n],t);return s}else if(typeof e=="object"&&!(e instanceof Date)){const s={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=xa(e[n],t));return s}return e}function Mp(e,t){return e.data=Sa(e.data,t),delete e.attachments,e}function Sa(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=Sa(e[s],t);else if(typeof e=="object")for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=Sa(e[s],t));return e}const Lp=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Op=5;var Pt;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(Pt||(Pt={}));class Fp{constructor(t){this.replacer=t}encode(t){return(t.type===Pt.EVENT||t.type===Pt.ACK)&&Uo(t)?this.encodeAsBinary({type:t.type===Pt.EVENT?Pt.BINARY_EVENT:Pt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let s=""+t.type;return(t.type===Pt.BINARY_EVENT||t.type===Pt.BINARY_ACK)&&(s+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(s+=t.nsp+","),t.id!=null&&(s+=t.id),t.data!=null&&(s+=JSON.stringify(t.data,this.replacer)),s}encodeAsBinary(t){const s=Rp(t),n=this.encodeAsString(s.packet),o=s.buffers;return o.unshift(n),o}}function Kc(e){return Object.prototype.toString.call(e)==="[object Object]"}class Qa extends cs{constructor(t){super(),this.reviver=t}add(t){let s;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(t);const n=s.type===Pt.BINARY_EVENT;n||s.type===Pt.BINARY_ACK?(s.type=n?Pt.EVENT:Pt.ACK,this.reconstructor=new Dp(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(Ja(t)||t.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(t),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let s=0;const n={type:Number(t.charAt(0))};if(Pt[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===Pt.BINARY_EVENT||n.type===Pt.BINARY_ACK){const i=s+1;for(;t.charAt(++s)!=="-"&&s!=t.length;);const c=t.substring(i,s);if(c!=Number(c)||t.charAt(s)!=="-")throw new Error("Illegal attachments");n.attachments=Number(c)}if(t.charAt(s+1)==="/"){const i=s+1;for(;++s&&!(t.charAt(s)===","||s===t.length););n.nsp=t.substring(i,s)}else n.nsp="/";const o=t.charAt(s+1);if(o!==""&&Number(o)==o){const i=s+1;for(;++s;){const c=t.charAt(s);if(c==null||Number(c)!=c){--s;break}if(s===t.length)break}n.id=Number(t.substring(i,s+1))}if(t.charAt(++s)){const i=this.tryParse(t.substr(s));if(Qa.isPayloadValid(n.type,i))n.data=i;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,s){switch(t){case Pt.CONNECT:return Kc(s);case Pt.DISCONNECT:return s===void 0;case Pt.CONNECT_ERROR:return typeof s=="string"||Kc(s);case Pt.EVENT:case Pt.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&Lp.indexOf(s[0])===-1);case Pt.ACK:case Pt.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Dp{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const s=Mp(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Bp=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Qa,Encoder:Fp,get PacketType(){return Pt},protocol:Op},Symbol.toStringTag,{value:"Module"}));function Zs(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const Up=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Dd extends cs{constructor(t,s,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=s,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Zs(t,"open",this.onopen.bind(this)),Zs(t,"packet",this.onpacket.bind(this)),Zs(t,"error",this.onerror.bind(this)),Zs(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...s){var n,o,i;if(Up.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(s.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const c={type:Pt.EVENT,data:s};if(c.options={},c.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const a=this.ids++,d=s.pop();this._registerAckCallback(a,d),c.id=a}const l=(o=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||o===void 0?void 0:o.writable,u=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!l||(u?(this.notifyOutgoingListeners(c),this.packet(c)):this.sendBuffer.push(c)),this.flags={},this}_registerAckCallback(t,s){var n;const o=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(o===void 0){this.acks[t]=s;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);s.call(this,new Error("operation has timed out"))},o),c=(...l)=>{this.io.clearTimeoutFn(i),s.apply(this,l)};c.withError=!0,this.acks[t]=c}emitWithAck(t,...s){return new Promise((n,o)=>{const i=(c,l)=>c?o(c):n(l);i.withError=!0,s.push(i),this.emit(t,...s)})}_addToQueue(t){let s;typeof t[t.length-1]=="function"&&(s=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((o,...i)=>n!==this._queue[0]?void 0:(o!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(o)):(this._queue.shift(),s&&s(null,...i)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!t||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Pt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){const n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Pt.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Pt.EVENT:case Pt.BINARY_EVENT:this.onevent(t);break;case Pt.ACK:case Pt.BINARY_ACK:this.onack(t);break;case Pt.DISCONNECT:this.ondisconnect();break;case Pt.CONNECT_ERROR:this.destroy();const n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){const s=t.data||[];t.id!=null&&s.push(this.ack(t.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const n of s)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const s=this;let n=!1;return function(...o){n||(n=!0,s.packet({type:Pt.ACK,id:t,data:o}))}}onack(t){const s=this.acks[t.id];typeof s=="function"&&(delete this.acks[t.id],s.withError&&t.data.unshift(null),s.apply(this,t.data))}onconnect(t,s){this.id=t,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Pt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const s=this._anyListeners;for(let n=0;n<s.length;n++)if(t===s[n])return s.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const s=this._anyOutgoingListeners;for(let n=0;n<s.length;n++)if(t===s[n])return s.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const n of s)n.apply(this,t.data)}}}function Cr(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Cr.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-s:e+s}return Math.min(e,this.max)|0};Cr.prototype.reset=function(){this.attempts=0};Cr.prototype.setMin=function(e){this.ms=e};Cr.prototype.setMax=function(e){this.max=e};Cr.prototype.setJitter=function(e){this.jitter=e};class Ca extends cs{constructor(t,s){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(s=t,t=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,fi(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((n=s.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Cr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=t;const o=s.parser||Bp;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var s;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(s=this.backoff)===null||s===void 0||s.setMin(t),this)}randomizationFactor(t){var s;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(s=this.backoff)===null||s===void 0||s.setJitter(t),this)}reconnectionDelayMax(t){var s;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(s=this.backoff)===null||s===void 0||s.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Tp(this.uri,this.opts);const s=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const o=Zs(s,"open",function(){n.onopen(),t&&t()}),i=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},c=Zs(s,"error",i);if(this._timeout!==!1){const l=this._timeout,u=this.setTimeoutFn(()=>{o(),i(new Error("timeout")),s.close()},l);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}return this.subs.push(o),this.subs.push(c),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Zs(t,"ping",this.onping.bind(this)),Zs(t,"data",this.ondata.bind(this)),Zs(t,"error",this.onerror.bind(this)),Zs(t,"close",this.onclose.bind(this)),Zs(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(s){this.onclose("parse error",s)}}ondecoded(t){hi(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,s){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new Dd(this,t,s),this.nsps[t]=n),n}_destroy(t){const s=Object.keys(this.nsps);for(const n of s)if(this.nsps[n].active)return;this._close()}_packet(t){const s=this.encoder.encode(t);for(let n=0;n<s.length;n++)this.engine.write(s[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,s){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(o=>{o?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",o)):t.onreconnect()}))},s);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Dr={};function qo(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const s=Ap(e,t.path||"/socket.io"),n=s.source,o=s.id,i=s.path,c=Dr[o]&&i in Dr[o].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||c;let u;return l?u=new Ca(n,t):(Dr[o]||(Dr[o]=new Ca(n,t)),u=Dr[o]),s.query&&!t.query&&(t.query=s.queryKey),u.socket(s.path,t)}Object.assign(qo,{Manager:Ca,Socket:Dd,io:qo,connect:qo});const Je=Ze.create("SocketClient");class qp{constructor(){this.socket=null,this.connected=!1,this.reconnecting=!1,this.userId=null,this.pendingMessages=[],this.eventHandlers={},this.connectionAttempts=0,this.maxReconnectAttempts=Nt.RECONNECT.MAX_ATTEMPTS,this.reconnectDelay=Nt.RECONNECT.DELAY,this.heartbeatInterval=null,this.lastPong=null,this.notificationSyncChannel=null,this.connectionMonitorInterval=null,this.notificationEventTypes=Nt.NOTIFICATION.SYNC_EVENT_TYPES}init(t,s,n={}){if(this.socket&&this.connected)return Je.info("Socket already connected"),this.socket;this.userId=t;let o;o=window.location.origin,Je.info(`Using current origin for socket connection: ${o}`),Je.info(`Connecting to socket server at ${o}`);try{return this.socket=qo(o,{query:{token:s},auth:{token:s,userId:t},reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,reconnectionDelayMax:Nt.RECONNECT.DELAY_MAX,timeout:Nt.CONNECTION.TIMEOUT,path:"/socket.io/",transports:["polling","websocket"],autoConnect:!0,forceNew:!0,withCredentials:!0,extraHeaders:{"x-connection-type":"socket.io"},secure:window.location.protocol==="https:",upgrade:!0}),this._setupSocketHandlers(),this.setupNotificationSyncChannel(),this.startConnectionMonitoring(),this.socket}catch(i){throw Je.error("Socket initialization error:",i),i}}isConnected(){return this.socket&&this.connected}_setupSocketHandlers(){this.socket&&(this.socket.on("connect",()=>{var t,s,n,o;Je.info("Socket connected successfully"),Je.info(`Socket transport: ${((n=(s=(t=this.socket.io)==null?void 0:t.engine)==null?void 0:s.transport)==null?void 0:n.name)||"unknown"}`),Je.info(`Socket URL: ${((o=this.socket.io)==null?void 0:o.uri)||"unknown"}`),this.connected=!0,this.connectionAttempts=0,this._startHeartbeat(),this._processPendingMessages(),this._notifyEventHandlers(Nt.EVENTS.SOCKET_CONNECTED,{userId:this.userId,socketId:this.socket.id}),window.dispatchEvent(new CustomEvent(Nt.EVENTS.SOCKET_CONNECTED,{detail:{userId:this.userId,socketId:this.socket.id}}))}),this.socket.on("connect_error",t=>{var s,n,o,i,c,l,u,h,a,d,f,v;Je.error("Socket connection error:",t),this.connected=!1,this.connectionAttempts++,Je.error("Socket connection error details:",{message:t.message||"Unknown error",type:t.type||"Unknown type",transport:((o=(n=(s=this.socket.io)==null?void 0:s.engine)==null?void 0:n.transport)==null?void 0:o.name)||"Unknown transport",attempts:this.connectionAttempts,url:((i=this.socket.io)==null?void 0:i.uri)||"Unknown URL"}),this.connectionAttempts>2&&((c=t.message)!=null&&c.includes("websocket")||((h=(u=(l=this.socket.io)==null?void 0:l.engine)==null?void 0:u.transport)==null?void 0:h.name)==="websocket")&&(Je.warn("Switching to polling transport after WebSocket failures"),(a=this.socket.io)!=null&&a.opts&&(this.socket.io.opts.transports=Nt.TRANSPORT.FALLBACK,Je.info("Forced polling-only transport mode"))),this.connectionAttempts>=this.maxReconnectAttempts&&(this._notifyEventHandlers(Nt.EVENTS.SOCKET_CONNECTION_FAILED,{error:t.message,attempts:this.connectionAttempts}),this.connectionAttempts===this.maxReconnectAttempts&&Z.error("Failed to connect to the chat server.",{autoClose:5e3})),window.dispatchEvent(new CustomEvent("socketConnectionError",{detail:{error:t.message,attempts:this.connectionAttempts,transport:((v=(f=(d=this.socket.io)==null?void 0:d.engine)==null?void 0:f.transport)==null?void 0:v.name)||"unknown"}}))}),this.socket.on("disconnect",t=>{Je.info(`Socket disconnected: ${t}`),this.connected=!1,this._stopHeartbeat(),this._notifyEventHandlers(Nt.EVENTS.SOCKET_DISCONNECTED,{reason:t}),window.dispatchEvent(new CustomEvent(Nt.EVENTS.SOCKET_DISCONNECTED,{detail:{reason:t}})),(t==="io server disconnect"||t==="transport close")&&this.enhancedReconnect()}),this.socket.on("reconnect",t=>{Je.info(`Socket reconnected after ${t} attempts`),this.connected=!0,this.reconnecting=!1,this._notifyEventHandlers(Nt.EVENTS.SOCKET_RECONNECTED,{userId:this.userId,attempts:t}),window.dispatchEvent(new CustomEvent(Nt.EVENTS.SOCKET_RECONNECTED,{detail:{userId:this.userId,attempts:t}}))}),this.socket.on("reconnect_attempt",t=>{Je.debug(`Socket reconnect attempt ${t}`),this.reconnecting=!0}),this.socket.on("reconnect_error",t=>{Je.error("Socket reconnection error:",t)}),this.socket.on("reconnect_failed",()=>{Je.error("Socket reconnection failed"),this.reconnecting=!1,Z.error("Failed to reconnect to the chat server. Please reload the page."),this._notifyEventHandlers(Nt.EVENTS.SOCKET_RECONNECT_FAILED,{userId:this.userId}),window.dispatchEvent(new CustomEvent(Nt.EVENTS.SOCKET_RECONNECT_FAILED,{detail:{userId:this.userId}}))}),this.socket.on("welcome",t=>{Je.debug("Socket welcome message received:",t)}),this.socket.on("pong",()=>{this.lastPong=Date.now()}),this.socket.on("error",t=>{Je.error("Socket server error:",t),Z.error(`Server error: ${t.message||"Unknown error"}`)}),this.socket.on("auth_error",t=>{Je.error("Socket authentication error:",t),Z.error("Authentication failed. Please log in again."),window.dispatchEvent(new CustomEvent("authLogout"))}),this._registerEnhancedEventForwarder("messageReceived"),this._registerEnhancedEventForwarder("messageSent"),this._registerEnhancedEventForwarder("messageError"),this._registerEnhancedEventForwarder("userTyping"),this._registerEnhancedEventForwarder("videoSignal"),this._registerEnhancedEventForwarder("videoHangup"),this._registerEnhancedEventForwarder("videoError"),this._registerEnhancedEventForwarder("videoMediaControl"),this._registerEnhancedEventForwarder("incomingCall"),this._registerEnhancedEventForwarder("callAnswered"),this._registerEnhancedEventForwarder("callInitiated"),this._registerEnhancedEventForwarder("callError"),this._registerEnhancedEventForwarder("userOnline"),this._registerEnhancedEventForwarder("userOffline"),this._registerEnhancedEventForwarder("notification"),this._registerEnhancedEventForwarder("newLike"),this._registerEnhancedEventForwarder("photoPermissionRequestReceived"),this._registerEnhancedEventForwarder("photoPermissionResponseReceived"),this._registerEnhancedEventForwarder("newComment"),this._registerEnhancedEventForwarder("newStory"))}_registerEnhancedEventForwarder(t){this._eventDeduplicationMap||(this._eventDeduplicationMap=new Map),this._eventDeduplicationMap.has(t)||this._eventDeduplicationMap.set(t,new Map);const s=i=>{var c;return i?t==="messageReceived"||t==="messageSent"?`${i._id||i.tempId||""}|${i.sender||""}|${i.recipient||""}`:t.includes("photoPermission")?`${i.permissionId||i.requestId||""}|${i.status||""}`:t==="notification"||t==="newLike"?`${i.type||""}|${((c=i.sender)==null?void 0:c._id)||i.sender||""}|${i.timestamp||Date.now()}`:`${JSON.stringify(i).substring(0,100)}|${Date.now().toString().substring(0,10)}`:""},n=i=>{const c=this._eventDeduplicationMap.get(t);if(!c)return!1;if(i&&(i._id||i.id||i.tempId)){const u=i._id||i.id||i.tempId;if(c.has(u)){const h=c.get(u);if(Date.now()-h<5e3)return!0}}const l=s(i);if(l&&c.has(`hash:${l}`)){const u=c.get(`hash:${l}`);if(Date.now()-u<5e3)return!0}return!1},o=i=>{const c=this._eventDeduplicationMap.get(t);if(!c)return;const l=Date.now();if(i&&(i._id||i.id||i.tempId)){const h=i._id||i.id||i.tempId;c.set(h,l)}const u=s(i);u&&c.set(`hash:${u}`,l),Math.random()<.1&&this._cleanupDeduplicationMaps()};this.socket.on(t,i=>{if(n(i)){Je.debug(`Skipping duplicate ${t} event`,(i==null?void 0:i._id)||(i==null?void 0:i.id)||"");return}if(o(i),this._notifyEventHandlers(t,i),this.notificationEventTypes.includes(t)&&(window.dispatchEvent(new CustomEvent(t,{detail:i})),window.dispatchEvent(new CustomEvent("notification",{detail:i})),this.notificationSyncChannel))try{this.notificationSyncChannel.postMessage({type:Nt.NOTIFICATION.SYNC_ACTIONS.NEW_NOTIFICATION,data:i})}catch(c){Je.error("Error syncing notification to other tabs:",c)}})}setupNotificationSyncChannel(){if(typeof BroadcastChannel>"u")return Je.warn("BroadcastChannel not supported, cross-tab sync disabled"),null;try{return this.notificationSyncChannel=new BroadcastChannel(Nt.NOTIFICATION.SYNC_CHANNEL_NAME),this.notificationSyncChannel.onmessage=t=>{const{type:s,data:n}=t.data;s===Nt.NOTIFICATION.SYNC_ACTIONS.NEW_NOTIFICATION?(Je.debug("Received new notification from another tab"),window.dispatchEvent(new CustomEvent("newNotification",{detail:n}))):s===Nt.NOTIFICATION.SYNC_ACTIONS.MARK_READ?(Je.debug("Received mark-read event from another tab"),window.dispatchEvent(new CustomEvent("notificationRead",{detail:n}))):s===Nt.NOTIFICATION.SYNC_ACTIONS.MARK_ALL_READ&&(Je.debug("Received mark-all-read event from another tab"),window.dispatchEvent(new CustomEvent("allNotificationsRead")))},Je.info("Notification sync channel initialized"),this.notificationSyncChannel}catch(t){return Je.error("Error setting up notification sync channel:",t),this.notificationSyncChannel=null,null}}_startHeartbeat(){this._stopHeartbeat(),this.lastPong=Date.now(),this.heartbeatInterval=setInterval(()=>{if(this.socket&&this.connected){this.socket.emit("ping");const t=Date.now();this.lastPong&&t-this.lastPong>Nt.CONNECTION.HEARTBEAT_TIMEOUT&&(Je.warn(`No heartbeat response in ${Nt.CONNECTION.HEARTBEAT_TIMEOUT/1e3} seconds, reconnecting...`),this.enhancedReconnect())}},Nt.CONNECTION.HEARTBEAT_INTERVAL)}_stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}startConnectionMonitoring(){this.stopConnectionMonitoring(),this.connectionMonitorInterval=setInterval(()=>{this.checkSocketHealthForNotifications()},Nt.CONNECTION.MONITOR_INTERVAL),Je.info("Notification connection monitoring started")}stopConnectionMonitoring(){this.connectionMonitorInterval&&(clearInterval(this.connectionMonitorInterval),this.connectionMonitorInterval=null)}checkSocketHealthForNotifications(){if(!this.userId||!this.socket)return!1;const t=Date.now(),s=this.lastPong||0,n=t-s;return Je.debug(`Socket health check - Connected: ${this.connected}, Time since last heartbeat: ${n/1e3}s`),!this.socket||typeof this.socket.emit!="function"?(Je.warn("Invalid socket object, attempting to reconnect..."),this.enhancedReconnect(),!1):n>Nt.CONNECTION.HEARTBEAT_TIMEOUT?(Je.warn(`No socket response in the last ${Nt.CONNECTION.HEARTBEAT_TIMEOUT/1e3} seconds, reconnecting for notifications...`),this.enhancedReconnect(),!1):this.connected?!0:(Je.warn("Socket appears disconnected, reconnecting for notifications..."),this.enhancedReconnect(),!1)}_processPendingMessages(){if(!this.connected||this.pendingMessages.length===0)return;Je.info(`Processing ${this.pendingMessages.length} pending messages`);const t=[...this.pendingMessages];this.pendingMessages=[],t.forEach(s=>{this.emit(s.event,s.data)})}on(t,s){const n=(...i)=>s(...i);n._originalCallback=s,n._id=Math.random().toString(36).substr(2,9),this.eventHandlers[t]||(this.eventHandlers[t]=[]);const o=this.eventHandlers[t].find(i=>i._originalCallback===s||i===s);return o?(Je.debug(`Preventing duplicate handler for ${t} event`),()=>this.off(t,o)):(this.eventHandlers[t].push(n),this.socket&&this.socket.on(t,n),()=>this.off(t,n))}off(t,s){this.socket&&this.socket.off(t,s),this.eventHandlers[t]&&(this.eventHandlers[t]=this.eventHandlers[t].filter(n=>!(n===s||n._originalCallback===s||s._originalCallback&&n._originalCallback&&s._originalCallback===n._originalCallback)),this.eventHandlers[t].length===0&&delete this.eventHandlers[t])}_notifyEventHandlers(t,s){this.eventHandlers[t]&&this.eventHandlers[t].forEach(n=>{try{n(s)}catch(o){Je.error(`Error in ${t} handler:`,o)}})}_cleanupDeduplicationMaps(){if(!this._eventDeduplicationMap)return;const s=Date.now()-3e4;for(const[n,o]of this._eventDeduplicationMap.entries())for(const[i,c]of o.entries())c<s&&o.delete(i);if(Math.random()<.1){let n=0;for(const o of this._eventDeduplicationMap.values())n+=o.size;Je.debug(`Cleaned up event deduplication maps, current size: ${n} entries`)}}emit(t,s={}){if(!this.socket)return Je.warn(`Socket not initialized, cannot emit '${t}'`),!1;if(!this.connected){if(Je.info(`Socket not connected, queueing '${t}'`),this.pendingMessages.length<100)this.pendingMessages.push({event:t,data:s});else{const n=["message","videoSignal","notification"];if(n.includes(t)){const o=this.pendingMessages.findIndex(i=>!n.includes(i.event));o!==-1&&(this.pendingMessages.splice(o,1),this.pendingMessages.push({event:t,data:s}))}Je.warn("Pending message queue full, dropping non-priority messages")}return!0}try{if(t==="typing"){const n=Date.now();(!this._lastTypingEvent||n-this._lastTypingEvent>2e3)&&(this._lastTypingEvent=n,this.socket.emit(t,s))}else this.socket.emit(t,s);return!0}catch(n){return Je.error(`Error emitting '${t}':`,n),!1}}enhancedReconnect(){if(this.reconnecting){Je.info("Already attempting reconnection, skipping duplicate request");return}if(Je.info("Forcing socket reconnection with notification support..."),this.reconnecting=!0,this.socket)try{this.socket.disconnect(),this.socket.close()}catch(t){Je.error("Error closing socket:",t)}if(this._stopHeartbeat(),this.userId){const t=gs();if(t){const s=Nt.CONNECTION.RECONNECT_DELAY_MIN+Math.random()*(Nt.CONNECTION.RECONNECT_DELAY_MAX-Nt.CONNECTION.RECONNECT_DELAY_MIN);Je.debug(`Scheduling reconnection in ${Math.round(s)}ms`),setTimeout(()=>{try{const n=gs();if(n!==t&&Je.info("Token changed since reconnection attempt started, using fresh token"),!navigator.onLine){Je.warn("Browser is offline, waiting for connection to return");const c=()=>{Je.info("Browser back online, attempting reconnection"),window.removeEventListener("online",c),setTimeout(()=>{this.reconnecting=!1,this.enhancedReconnect()},Nt.CONNECTION.ONLINE_RECONNECT_DELAY)};window.addEventListener("online",c,{once:!0}),this.reconnecting=!1;return}const i=!1?Nt.URLS.DEV:Nt.URLS.PROD;Je.info("Initializing socket with fresh token"),this.init(this.userId,n||t),window.dispatchEvent(new CustomEvent(Nt.EVENTS.NOTIFICATION_SOCKET_RECONNECTED)),Je.info("Socket reconnected with notification support")}catch(n){if(Je.error("Socket reconnection failed:",n),n.message&&(n.message.includes("websocket")||n.message.includes("WebSocket"))){Je.warn("WebSocket error detected, trying fallback to polling transport only");try{const i=Nt.URLS.PROD;this.init(this.userId,t,{transports:Nt.TRANSPORT.FALLBACK,autoConnect:!0}),Je.info("Fallback to polling transport initiated")}catch(o){Je.error("Polling fallback also failed:",o)}}if(n.message&&(n.message.includes("auth")||n.message.includes("token"))){Je.warn("Authentication error detected, trying emergency session reset"),setTimeout(()=>{try{typeof window.fixMyUserId=="function"?window.fixMyUserId():this._attemptTokenRefresh().catch(()=>{Je.warn("Performing emergency session reset"),qe.logout(),window.location.reload()})}catch(o){Je.error("Emergency recovery failed:",o),this.reconnecting=!1}},2e3);return}}finally{this.reconnecting=!1}},s)}else Je.error("Cannot reconnect: No authentication token found"),this.reconnecting=!1}else Je.error("Cannot reconnect: No user ID"),this.reconnecting=!1}_attemptTokenRefresh(){return new Promise((t,s)=>{Je.info("Attempting to refresh authentication token"),qe.post("/auth/refresh-token",{}).then(n=>{if(n.token)Je.info("Token refresh successful"),vr(n.token,!0),this.reconnecting=!1,this.enhancedReconnect(),t();else throw new Error("No token in response")}).catch(n=>{Je.error("Token refresh failed:",n),s(n)})})}reconnect(){this.enhancedReconnect()}disconnect(){if(Je.info("Disconnecting socket"),this._stopHeartbeat(),this.stopConnectionMonitoring(),this.notificationSyncChannel)try{this.notificationSyncChannel.close(),this.notificationSyncChannel=null}catch(t){Je.error("Error closing notification sync channel:",t)}if(this.socket){try{this.socket.disconnect()}catch(t){Je.error("Error disconnecting socket:",t)}this.socket=null}this.connected=!1,this.reconnecting=!1}}const an=new qp,Vi=Ze.create("SocketService");class zp{constructor(){this.socket=an,this.initialized=!1,this.showConnectionToasts=!0,this.debugMode=!1,this.eventListeners=new Map,this.pendingMessages=[],this.userId=null,this.connectionState="disconnected",this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.connectionMonitor=null,this.internalEventHandlers=new Map}init(t,s,n={}){if(this.initialized&&this.socket.isConnected()&&this.userId===t)return this._log("Socket service already initialized and connected"),this.socket;this._clearConnectionMonitor(),this._log(`Initializing socket service for user: ${t}`),this.userId=t,this.reconnectAttempts=0;try{return n.serverUrl="https://flirtss.com",n.rejectUnauthorized=!1,n.secure=!0,n.upgrade=!0,this.socket.init(t,s,n),this.initialized=!0,this.connectionState="connecting",this.socket.on("connect",()=>{this._log("Socket connection established"),this.connectionState="connected",this.reconnectAttempts=0,this._processPendingMessages(),this._notifyEventHandlers("connect",{}),window.dispatchEvent(new CustomEvent("socketReconnected"))}),this.socket.on("disconnect",i=>{this._log(`Socket disconnected: ${i}`),this.connectionState="disconnected",this._notifyEventHandlers("disconnect",{reason:i}),this._startConnectionMonitor()}),this.socket.on("connect_error",i=>{this._log(`Socket connection error: ${i}`),this.connectionState="error",this._startConnectionMonitor()}),this._startConnectionMonitor(),this.socket}catch(o){throw this._log(`Socket initialization error: ${o.message}`,"error"),this.connectionState="error",o}}_startConnectionMonitor(){this.connectionMonitor||(this._log("Starting socket connection monitor"),this.connectionMonitor=setInterval(()=>{this.initialized&&this.connectionState!=="connected"&&this.reconnectAttempts<this.maxReconnectAttempts&&this.connectionState!=="reconnecting"&&(this._log(`Connection monitor: Socket is ${this.connectionState}, attempting reconnect`),this.reconnect())},15e3))}_clearConnectionMonitor(){this.connectionMonitor&&(clearInterval(this.connectionMonitor),this.connectionMonitor=null,this._log("Cleared socket connection monitor"))}isConnected(){return this.socket&&this.socket.isConnected()}_notifyEventHandlers(t,s){this.eventListeners.has(t)&&this.eventListeners.get(t).forEach(n=>{try{n(s)}catch(o){this._log(`Error in event handler for ${t}: ${o.message}`,"error")}})}reconnect(){if(this.connectionState==="connected")return this._log("Socket already connected, no need to reconnect"),this.reconnectAttempts=0,!0;if(this.reconnectAttempts>=this.maxReconnectAttempts)return this._log(`Maximum reconnect attempts (${this.maxReconnectAttempts}) reached, stopping reconnection attempts`,"warn"),setTimeout(()=>{this._log("Reconnect cooldown completed, resetting counter"),this.reconnectAttempts=0},3e4),!1;this.reconnectAttempts++,this._log(`Forcing socket reconnection (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connectionState="reconnecting";try{return this.socket&&typeof this.socket.reconnect=="function"?this.socket.reconnect():(this._log("Socket not initialized, cannot reconnect","warn"),!1)}catch(t){return this._log(`Reconnection error: ${t.message}`,"error"),!1}}disconnect(){return this._log("Disconnecting socket"),this._clearConnectionMonitor(),this.initialized=!1,this.connectionState="disconnected",this.pendingMessages=[],this.savedListeners=Array.from(this.eventListeners.entries()),this.eventListeners.clear(),this.socket.disconnect()}on(t,s){if(!s||typeof s!="function")return this._log(`Invalid callback for event: ${t}`,"error"),()=>{};this._log(`Registering listener for event: ${t}`),this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(s);let n;try{n=this.socket.on(t,s)}catch(o){this._log(`Error registering event listener for ${t}: ${o.message}`,"error"),n=()=>{}}return()=>{this.eventListeners.has(t)&&(this.eventListeners.get(t).delete(s),this.eventListeners.get(t).size===0&&this.eventListeners.delete(t));try{n()}catch(o){this._log(`Error unsubscribing from event ${t}: ${o.message}`,"error")}}}off(t,s){this._log(`Removing listener for event: ${t}`);try{this.socket.off(t,s)}catch(n){this._log(`Error removing event listener for ${t}: ${n.message}`,"error")}this.eventListeners.has(t)&&s?(this.eventListeners.get(t).delete(s),this.eventListeners.get(t).size===0&&this.eventListeners.delete(t)):this.eventListeners.has(t)&&!s&&this.eventListeners.delete(t)}emit(t,s={}){if(!this.socket)return this._log(`Socket not initialized, cannot emit '${t}'`,"warn"),!1;if(!this.isConnected())return this._log(`Socket not connected, queueing '${t}'`,"warn"),this.pendingMessages.push({event:t,data:s,timestamp:Date.now()}),!0;try{return this._log(`Emitting event: ${t}`),this.socket.emit(t,s),!0}catch(n){return this._log(`Error emitting '${t}': ${n.message}`,"error"),["sendMessage","messageRead","answerCall"].includes(t)&&(this._log(`Adding failed '${t}' to pending queue for retry`,"warn"),this.pendingMessages.push({event:t,data:s,timestamp:Date.now()})),!1}}async sendMessage(t,s="text",n,o={}){return this._log(`Attempting to send ${s} message to ${t}`),new Promise((i,c)=>{const l=`temp-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,u={current:null};let h=!1;if(!this.isConnected()){this._log(`Socket not connected, returning pending message with id ${l}`);const b={_id:l,sender:this.userId,recipient:t,type:s,content:n,metadata:{...o,clientMessageId:l},createdAt:new Date().toISOString(),read:!1,pending:!0,status:"pending",tempMessageId:l};return this.pendingMessages.push({event:"sendMessage",data:{recipientId:t,type:s,content:n,metadata:{...o,clientMessageId:l},tempMessageId:l},timestamp:Date.now()}),i(b)}const a=()=>{h||(h=!0,this.socket.off("messageSent",d),this.socket.off("messageError",f),u.current&&(clearTimeout(u.current),u.current=null))},d=b=>{b&&b.tempMessageId===l&&(this._log(`Message confirmed sent: ${l}`),a(),i(b))},f=b=>{b&&b.tempMessageId===l&&(this._log(`Message error for ${l}: ${b.error||"Unknown error"}`,"error"),a(),c(new Error(b.error||"Failed to send message")))};this.socket.on("messageSent",d),this.socket.on("messageError",f);const v={...o,clientMessageId:l};if(this._log(`Emitting sendMessage with tempId: ${l}`),!this.socket.emit("sendMessage",{recipientId:t,type:s,content:n,metadata:v,tempMessageId:l})){this._log(`Message emission failed immediately for ${l}`,"error"),a(),i({_id:l,sender:this.userId,recipient:t,content:n,type:s,metadata:v,createdAt:new Date().toISOString(),read:!1,status:"pending",pending:!0,tempMessageId:l});return}u.current=setTimeout(()=>{h||(this._log(`Message timeout reached for ${l}`,"warn"),a(),i({_id:l,sender:this.userId,recipient:t,content:n,type:s,metadata:v,createdAt:new Date().toISOString(),read:!1,status:"pending",pending:!0,tempMessageId:l}))},1e4)})}sendTyping(t){this.isConnected()&&this.socket.emit("typing",{recipientId:t})}_processPendingMessages(){if(this.pendingMessages.length===0)return;this._log(`Processing ${this.pendingMessages.length} pending messages`);const t=[...this.pendingMessages];this.pendingMessages=[],t.forEach((s,n)=>{setTimeout(()=>{if(Date.now()-s.timestamp>3e5){this._log(`Skipping stale pending message of type ${s.event}`,"warn");return}this._log(`Processing queued message: ${s.event}`),this.emit(s.event,s.data)},n*100)})}initiateVideoCall(t){return this._log(`Initiating video call to ${t}`),new Promise((s,n)=>{if(!this.isConnected())return this._log("Socket not connected, cannot initiate call","error"),n(new Error("Socket not connected"));const o={callId:`call-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,recipientId:t,callType:"video",userId:this.userId,caller:{userId:this.userId,name:localStorage.getItem("userNickname")||"User"},timestamp:Date.now()},i=l=>{this._log(`Call initiated successfully: ${l.callId||"unknown"}`),this.socket.off("callInitiated",i),this.socket.off("callError",c),s(l)},c=l=>{this._log(`Call initiation error: ${l.message||"unknown"}`,"error"),this.socket.off("callInitiated",i),this.socket.off("callError",c),n(new Error(l.message||"Failed to initiate call"))};this.socket.on("callInitiated",i),this.socket.on("callError",c),this.socket.emit("initiateCall",o),setTimeout(()=>{this._log("Call initiation timeout reached","warn"),this.socket.off("callInitiated",i),this.socket.off("callError",c),s({success:!0,callId:o.callId})},5e3)})}answerVideoCall(t,s,n){if(this._log(`Answering call from ${t} with accept=${s}`),!this.isConnected())return this._log("Cannot answer call: Socket not connected","error"),!1;let o=0;const i=3,c=()=>{o++;const l=this.socket.emit("answerCall",{callerId:t,accept:s,callId:n,userId:this.userId,timestamp:Date.now()});return!l&&o<i&&(this._log(`Retrying call answer (attempt ${o})`,"warn"),setTimeout(c,1e3)),l};return c()}getStatus(){return{connected:this.isConnected(),initialized:this.initialized,userId:this.userId,state:this.connectionState,reconnectAttempts:this.reconnectAttempts,pendingMessages:this.pendingMessages.length}}setShowConnectionToasts(t){this.showConnectionToasts=t}updatePrivacySettings(t){t&&(this.privacySettings=t,t.showOnlineStatus!==void 0&&(this._log(`Updating online status visibility: ${t.showOnlineStatus}`),this.isConnected()&&this.socket.emit("updatePrivacySettings",{showOnlineStatus:t.showOnlineStatus})),this._log(`Privacy settings updated: ${JSON.stringify(t)}`))}setDebugMode(t){this.debugMode=t}_log(t,s="log"){if(!(!this.debugMode&&s==="log"))switch(s){case"warn":Vi.warn(t);break;case"error":Vi.error(t);break;default:Vi.info(t)}}}const Ae=new zp,Ss=Ze.create("PermissionClient");class Hp{constructor(){this._eventUnsubscribers=new Map}requestPhotoPermission(t,s){return new Promise((n,o)=>{if(!Ae.isConnected())return Ss.warn("Cannot request photo permission: Socket not connected"),o(new Error("Socket not connected"));if(!t||!s)return Ss.warn("Missing required parameters for photo permission request"),o(new Error("Owner ID and Photo ID are required"));const i={ownerId:t,photoId:s},c=`req-${s}-${Date.now()}`;i.requestId=c,Ss.debug(`Requesting photo permission: ${s} from ${t}`);let l;const u=d=>{d.requestId===c&&(Ss.debug(`Photo permission request succeeded: ${c}`),this._cleanupEventListeners(c),d.success?n(d):o(new Error(d.error||"Failed to request permission")))},h=d=>{d.requestId===c&&(Ss.error(`Photo permission request error: ${d.error||"Unknown error"}`),this._cleanupEventListeners(c),o(new Error(d.error||"Permission request failed")))};if(this._registerEventListener(c,"photoPermissionRequested",u),this._registerEventListener(c,"photoPermissionError",h),!Ae.emit("requestPhotoPermission",i)){Ss.error(`Failed to emit photo permission request: ${c}`),this._cleanupEventListeners(c),o(new Error("Failed to send permission request"));return}l=setTimeout(()=>{Ss.warn(`Photo permission request timed out: ${c}`),this._cleanupEventListeners(c),o(new Error("Permission request timed out"))},Nt.TIMEOUT.PERMISSION_REQUEST),this._eventUnsubscribers.set(`${c}-timeout`,l)})}_registerEventListener(t,s,n){const o=Ae.on(s,n);this._eventUnsubscribers.set(`${t}-${s}`,o)}_cleanupEventListeners(t){for(const[s,n]of this._eventUnsubscribers.entries())s.startsWith(t)&&(s.endsWith("-timeout")?clearTimeout(n):n(),this._eventUnsubscribers.delete(s))}respondToPhotoPermission(t,s){return new Promise((n,o)=>{if(!Ae.isConnected())return Ss.warn("Cannot respond to photo permission: Socket not connected"),o(new Error("Socket not connected"));if(!t||!s)return Ss.warn("Missing required parameters for photo permission response"),o(new Error("Permission ID and status are required"));if(!["approved","rejected"].includes(s))return Ss.warn(`Invalid status for photo permission response: ${s}`),o(new Error("Invalid status provided"));const i={permissionId:t,status:s},c=`res-${t}-${Date.now()}`;i.requestId=c,Ss.debug(`Responding to photo permission: ${t} with ${s}`);const l=d=>{d.requestId===c&&(Ss.debug(`Photo permission response succeeded: ${c}`),this._cleanupEventListeners(c),d.success?n(d):o(new Error(d.error||"Failed to respond to permission")))},u=d=>{d.requestId===c&&(Ss.error(`Photo permission response error: ${d.error||"Unknown error"}`),this._cleanupEventListeners(c),o(new Error(d.error||"Permission response failed")))};if(this._registerEventListener(c,"photoPermissionResponded",l),this._registerEventListener(c,"photoPermissionError",u),!Ae.emit("respondToPhotoPermission",i)){Ss.error(`Failed to emit photo permission response: ${c}`),this._cleanupEventListeners(c),o(new Error("Failed to send permission response"));return}const a=setTimeout(()=>{Ss.warn(`Photo permission response timed out: ${c}`),this._cleanupEventListeners(c),o(new Error("Permission response timed out"))},Nt.TIMEOUT.PERMISSION_REQUEST);this._eventUnsubscribers.set(`${c}-timeout`,a)})}cleanup(){for(const[t,s]of this._eventUnsubscribers.entries())t.endsWith("-timeout")?clearTimeout(s):s();this._eventUnsubscribers.clear(),Ss.debug("Permission client cleaned up")}}const Vp=new Hp,sr=Ze.create("PhotoPermissions");async function Wp(e,t){try{const s=await Vp.requestPhotoPermission(e,t);return Z.success("Photo access request sent"),s}catch(s){throw sr.error("Failed to request photo access:",s),Z.error("Failed to send photo access request"),s}}async function Bd(e){try{const t=await qe.put(`/users/respond-photo-access/${e}`,{status:"approved"});return t.success&&Z.success(`Approved ${t.updatedCount} photo access requests`),t}catch(t){throw sr.error("Failed to approve photo requests:",t),Z.error("Failed to approve photo access requests"),t}}async function Gp(e,t){try{const s=await qe.put(`/users/respond-photo-access/${e}`,{status:"rejected",message:t});return s.success&&Z.success(`Rejected ${s.updatedCount} photo access requests`),s}catch(s){throw sr.error("Failed to reject photo requests:",s),Z.error("Failed to reject photo access requests"),s}}async function Ud(e,t){var s,n,o,i,c;try{const l=await qe.post(`/users/grant-photo-access/${e}`,{message:t||"Photo access granted"});if(l.success){const u=((s=l.data)==null?void 0:s.grantedCount)||l.grantedCount||0;u===0?l.totalPrivatePhotos&&((n=l.message)!=null&&n.includes("already has access to all"))?Z.info(`User already has access to all ${l.totalPrivatePhotos} of your private photos`):l.existingAccessCount&&l.totalPrivatePhotos?Z.info(`User already has access to ${l.existingAccessCount} of your ${l.totalPrivatePhotos} private photos`):Z.info(l.message||"Photo access already granted"):Z.success(`Granted access to ${u} private photos`)}return l}catch(l){sr.error("Failed to grant photo access:",((o=l.response)==null?void 0:o.data)||l);const u=((c=(i=l.response)==null?void 0:i.data)==null?void 0:c.error)||l.message||"Failed to grant photo access";throw Z.error(u),l}}async function qd(e){var t,s,n;try{const o=await qe.delete(`/users/revoke-photo-access/${e}`);return o.success&&Z.success(o.message||"Photo access revoked"),o}catch(o){sr.error("Failed to revoke photo access:",((t=o.response)==null?void 0:t.data)||o);const i=((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.error)||o.message||"Failed to revoke photo access";throw Z.error(i),o}}async function Yp(){try{return(await qe.get("/users/photos/permissions/pending/count")).pendingCount||0}catch(e){return sr.error("Failed to get pending requests count:",e),0}}function zd(e){var t;return(e==null?void 0:e.photoAccess)===!0||((t=e==null?void 0:e.photoAccess)==null?void 0:t.approved)===!0}function Hd(e){var o;const t=e==null?void 0:e.user,s=(e==null?void 0:e.pendingPhotoRequests)||0,n=zd(t);return{hasAccess:n,pendingRequests:s,canGrant:!0,canRevoke:!0,isRestricted:!n&&((o=t==null?void 0:t.photos)==null?void 0:o.some(i=>i.privacy==="private"))}}async function Kp(e,t){var o;const s=(o=e==null?void 0:e.user)==null?void 0:o._id,n=Hd(e);try{if((e==null?void 0:e.pendingPhotoRequests)>0)return await Bd(s);if(n.hasAccess)return await qd(s);{const i=`${t.nickname||"User"} has granted you access to their private photos`;return await Ud(s,i)}}catch(i){throw sr.error("Failed to toggle photo access:",i),i}}const Ao={requestPhotoAccess:Wp,approvePhotoRequests:Bd,rejectPhotoRequests:Gp,grantPhotoAccess:Ud,revokePhotoAccess:qd,getPendingRequestsCount:Yp,hasPhotoAccess:zd,getPhotoAccessStatus:Hd,togglePhotoAccess:Kp},Hs=Ze.create("utils"),Vn=e=>{if(!e)return null;const t=typeof e=="string"?e:String(e);if(/^[0-9a-fA-F]{24}$/.test(t))return t;if(t.length>24){const n=t.match(/([0-9a-fA-F]{24})/);if(n&&n[1])return n[1]}const s=t.match(/ObjectId\(['"](.*)['"]\)/);if(s&&s[1]){const n=s[1];if(/^[0-9a-fA-F]{24}$/.test(n))return n}if(typeof e=="object"&&e!==null&&e._id)return Vn(e._id);if(typeof e=="object"&&e!==null&&e.id)return Vn(e.id);if(typeof e=="object"&&e!==null&&e.sub)return Vn(e.sub);if(typeof e=="object"&&e!==null&&e.user){if(typeof e.user=="object"&&e.user!==null){if(e.user._id)return Vn(e.user._id);if(e.user.id)return Vn(e.user.id)}else if(typeof e.user=="string")return Vn(e.user)}if(typeof e=="object"&&e!==null){const o=JSON.stringify(e).match(/[0-9a-fA-F]{24}/g)||[];if(o.length>0)return o[0]}return null},Gr=new Map,yr=new Set;typeof window<"u"&&(window.__url_normalization_cache=Gr,window.__failed_urls_cache=yr);const Ns=(e,t=!1)=>{if(Hs.debug(`normalizePhotoUrl called with URL: "${e}"`),!e)return Hs.debug("URL is empty, returning placeholder.svg"),`${window.location.origin}/placeholder.svg`;if(yr.has(e))return Hs.debug(`URL "${e}" is known to fail, returning placeholder`),`${window.location.origin}/placeholder.svg`;const s=e.match(/(\d+-\d+.*\.(jpg|jpeg|png|gif|webp))/i);if(s&&yr.has(s[1]))return Hs.debug(`Filename "${s[1]}" is known to fail, returning placeholder`),`${window.location.origin}/placeholder.svg`;const n=`${e}:${t}`;if(!t&&Gr.has(n))return Hs.debug(`normalizePhotoUrl: Cache hit for "${e}", returning cached value`),Gr.get(n);if(e){const i=e.includes("man-avatar")||e.includes("women-avatar")||e.includes("couple-avatar")||e.includes("default-avatar");if(i&&e.startsWith("/")&&(Hs.debug(`normalizePhotoUrl: Converting avatar path to absolute URL: ${e}`),e=`${window.location.origin}${e}`),e.startsWith("/uploads/")&&(Hs.debug(`normalizePhotoUrl: Converting profile photo path to absolute URL: ${e}`),e=`${window.location.origin}${e}`),e.includes("_refresh=")&&(e=e.replace(/([?&])_refresh=\d+(&|$)/,"$1"),(e.endsWith("?")||e.endsWith("&"))&&(e=e.slice(0,-1))),i)return Gr.set(n,e),e}let o;if(e==="/default-avatar.png"||e==="/default-avatar1.png"||e==="/man-avatar.png"||e==="/women-avatar.png"||e==="/couple-avatar.png"||e==="/placeholder.svg")Hs.debug(`normalizePhotoUrl: Converting avatar path "${e}" to absolute URL`),o=`${window.location.origin}${e}`;else if(e.startsWith("http"))o=e;else if(/^[0-9a-f]{24}$/i.test(e))o=`${window.location.origin}/api/avatars/${e}`;else if(e.startsWith("/uploads/"))o=`${window.location.origin}${e}`;else if(e.includes("/images/")||e.includes("/photos/")){const i=e.startsWith("/uploads")?e:`/uploads${e.startsWith("/")?"":"/"}${e}`;o=`${window.location.origin}${i}`}else if(e.includes("uploads/")||e.startsWith("/uploads/")){const i=e.startsWith("/")?e:`/${e}`;o=`${window.location.origin}${i}`}else/^\d+-\d+.*\.(jpg|jpeg|png|gif|webp)$/i.test(e)?(o=`${window.location.origin}/uploads/images/${e}`,t=!0):e.startsWith("/")?o=`${window.location.origin}${e}`:o=e;if(t&&o){const i=typeof window<"u"&&window.__photo_refresh_timestamp?window.__photo_refresh_timestamp:Date.now(),c=o.includes("?")?"&":"?";o=`${o}${c}_v=${i}`}return Gr.set(n,o),o},Yr=e=>{yr.add(e);const t=e.replace(/[?&]_v=\d+$/,"");t!==e&&yr.add(t);const s=e.match(/(\d+-\d+.*\.(jpg|jpeg|png|gif|webp))/i);return s&&yr.add(s[1]),Hs.debug(`Marked URL as failed: ${e} (and ${t})`),`${window.location.origin}/placeholder.svg`},Wo=(e,t={})=>{let s="en-US";try{document.documentElement.lang==="he"?s="he-IL":navigator.languages&&navigator.languages.length?s=navigator.languages[0]:navigator.language&&(s=navigator.language)}catch(h){Hs.warn("Failed to detect locale:",h)}const{showTime:n=!0,showDate:o=!0,showRelative:i=!1,locale:c=s}=t;if(!e)return"";const l=typeof e=="string"?new Date(e):e;if(isNaN(l.getTime()))return"";if(i)if(c.startsWith("he")){const a=new Date-l,d=Math.floor(a/1e3),f=Math.floor(d/60),v=Math.floor(f/60),g=Math.floor(v/24);if(d<60)return"זה עתה";if(f<60)return`לפני ${f} דקות`;if(v<24)return`לפני ${v} שעות`;if(g<7)return`לפני ${g} ימים`}else{const a=new Date-l,d=Math.floor(a/1e3),f=Math.floor(d/60),v=Math.floor(f/60),g=Math.floor(v/24);if(d<60)return"just now";if(f<60)return`${f}m ago`;if(v<24)return`${v}h ago`;if(g<7)return`${g}d ago`}let u="";if(o)try{u=l.toLocaleDateString(c,{year:"numeric",month:"short",day:"numeric"})}catch{Hs.warn(`Locale ${c} not supported for date formatting, falling back to default`),u=l.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}if(n){let h;try{h=l.toLocaleTimeString(c,{hour:"2-digit",minute:"2-digit"})}catch{Hs.warn(`Locale ${c} not supported for time formatting, falling back to default`),h=l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}c.startsWith("he")||document.dir==="rtl"?u=o?`${h} ,${u}`:h:u=o?`${u}, ${h}`:h}return u},kn=Ze.create("TokenStorage"),gs=()=>{const e=sessionStorage.getItem("token")||localStorage.getItem("token");return e&&kn.debug("Token retrieved from storage"),e},vr=(e,t=!0)=>{e&&(sessionStorage.setItem("token",e),kn.debug("Token stored in sessionStorage"),t?(localStorage.setItem("token",e),kn.debug("Token also stored in localStorage (remember me)")):localStorage.removeItem("token"))},hr=()=>{sessionStorage.removeItem("token"),localStorage.removeItem("token"),kn.debug("Token removed from all storage")},ka=e=>{if(!e)return!0;try{const s=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(atob(s)).exp*1e3,c=Date.now()>=o-3e4;return c&&kn.debug(`Token expired at ${new Date(o).toISOString()}`),c}catch(t){return kn.error("Error parsing JWT token:",t),!0}},Jp=e=>{if(!e)return null;try{const s=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(s))}catch(t){return kn.error("Error parsing JWT token:",t),null}},Jc=e=>{if(!e)return null;try{const t=Jp(e);if(!t)return null;let s=null;return t._id?s=t._id:t.id?s=t.id:t.sub?s=t.sub:t.user&&(s=t.user._id||t.user.id),s?Vn(s):(kn.warn("No user ID found in token payload",t),null)}catch(t){return kn.error("Error extracting user ID from token:",t),null}},Qp=Wn.BASE_URL,Xp=Wn.TIMEOUT,Zp=Sn.SIZE,em=Sn.TTL.DEFAULT,tm=Wn.RETRIES.MAX_QUEUE_RETRIES;class sm{constructor(t=Zp,s=em){this.ttl=s,this.map=new Map,this.maxSize=t}_evictIfNeeded(){if(this.map.size<=this.maxSize)return;const t=this.map.keys().next().value;this.map.delete(t)}_makeKey(t,s={}){const n=t.replace(/\/+$/,""),o=n.match(/\/([0-9a-fA-F]{24})$/),i=o?n.replace(o[1],":id"):n,c=o?`:${o[1]}`:"",l=Object.keys(s).length?":"+JSON.stringify(Object.entries(s).sort()):"";return`${i}${c}${l}`}get(t,s){const n=this._makeKey(t,s),o=this.map.get(n);return!o||o.expiresAt<Date.now()?(this.map.delete(n),Ze.create("ResponseCache").debug(`Cache miss/expired: ${n}`),null):(Ze.create("ResponseCache").debug(`Cache hit: ${n}`),o.data)}set(t,s,n){if(!(n!=null&&n.success))return;const o=this._makeKey(t,s);let i=this.ttl;t.match(/\/users\/[0-9a-fA-F]{24}$/)?i=Sn.TTL.USER_PROFILE:t.includes("/messages/")?i=Sn.TTL.MESSAGES:t.includes("/stories/")?i=Sn.TTL.STORIES:t.includes("/messages/conversations")&&(i=Sn.TTL.CONVERSATIONS),this._evictIfNeeded(),this.map.set(o,{data:n,expiresAt:Date.now()+i}),Ze.create("ResponseCache").debug(`Cached ${o} (TTL ${i}ms)`)}invalidate(t="",s){if(t&&s)this.map.delete(this._makeKey(t,s));else if(t)for(const n of this.map.keys())n.startsWith(t)&&this.map.delete(n);else this.map.clear();Ze.create("ResponseCache").debug(`Invalidated cache for: ${t}`)}}class nm{constructor(t){this.onChange=t,this._online=()=>this._update(!0),this._offline=()=>this._update(!1),window.addEventListener("online",this._online),window.addEventListener("offline",this._offline),this._update(navigator.onLine)}_update(t){var s;Ze.create("NetworkMonitor").info(`Network is ${t?"online":"offline"}`),(s=this.onChange)==null||s.call(this,t),window.dispatchEvent(new CustomEvent("apiConnectionStatusChange",{detail:{isOnline:t}}))}cleanup(){window.removeEventListener("online",this._online),window.removeEventListener("offline",this._offline)}}class rm{constructor(t){this.api=t,this.queue=JSON.parse(localStorage.getItem("api_request_queue")||"[]"),this.processing=!1}add(t){this.queue.push({...t,retries:0}),localStorage.setItem("api_request_queue",JSON.stringify(this.queue)),Ze.create("RequestQueue").debug(`Queued ${t.method} ${t.url}`)}async process(){if(this.processing||!navigator.onLine)return;this.processing=!0;const t=[...this.queue];this.queue=[];for(const s of t)try{await this.api.request(s),Ze.create("RequestQueue").info(`Processed queued: ${s.method} ${s.url}`)}catch{s.retries++,s.retries<tm?this.queue.push(s):Ze.create("RequestQueue").error(`Dropped after retries: ${s.method} ${s.url}`)}localStorage.setItem("api_request_queue",JSON.stringify(this.queue)),this.processing=!1}}class om{constructor(){Us(this,"_batchRequests",new Map);Us(this,"_batchTimers",new Map);Us(this,"_pendingBatches",new Map);this.baseURL=Qp,this.metrics={total:0,success:0,fail:0,avgTime:0},this.refreshPromise=null,this.retryQueue=[],this.api=Qt.create({baseURL:this.baseURL,timeout:Xp,headers:{"Content-Type":"application/json",Accept:"application/json"}}),this.cache=new sm,this.queue=new rm(this.api),this.network=new nm(t=>{t&&this.queue.process()}),this._loadToken(),this.api.interceptors.request.use(this._onRequest.bind(this),t=>Promise.reject(t)),this.api.interceptors.response.use(this._onResponse.bind(this),this._onError.bind(this)),this._addObjectIdInterceptor()}_onRequest(t){t.metadata={start:Date.now()},this.metrics.total++;const s=gs();if(s&&ka(s)&&!t._retryAuth&&!t._skipAuthRefresh){t._retryAuth=!0,this.retryQueue.push(t),this._refreshToken().catch(()=>{});const n=Qt.CancelToken.source();t.cancelToken=n.token,n.cancel("Token expired")}return t.method==="get"&&t.headers["x-no-cache"]&&(t.params={...t.params||{},_:Date.now()}),s&&(t.headers.Authorization=`Bearer ${s}`),Ze.create("ApiService").debug(`→ ${t.method.toUpperCase()} ${t.url}`),t}_onResponse(t){const s=Date.now()-t.config.metadata.start;return this.metrics.success++,this.metrics.avgTime=(this.metrics.avgTime*(this.metrics.success-1)+s)/this.metrics.success,Ze.create("ApiService").debug(`← ${t.status} ${t.config.url} (${s}ms)`),t.config.method==="get"&&!t.config.headers["x-no-cache"]&&this.cache.set(t.config.url,t.config.params,t.data),t.data}async _onError(t){if(Qt.isCancel(t))return Promise.reject({canceled:!0});this.metrics.fail++;const s=t.config||{},n=s.url||"";if(["/users/photo-permissions","/users/photo-permissions/pending","/photo-permissions","/photo-access","/blocked"].some(u=>n.includes(u)))return Promise.reject({success:!1,silenced:!0});if(!t.response){const u=navigator.onLine?"Network error. Please try again.":"Offline — request queued.";return Z.error(u),s.method!=="get"&&this.queue.add(s),Promise.reject({success:!1,error:u})}const{status:c,data:l}=t.response;return Ze.create("ApiService").error(`✖ ${c} ${s.url}`,l),c===401&&!s._retryAuth?this._handleAuthError(s):(this._notifyError(c,(l==null?void 0:l.message)||t.message),Promise.reject({success:!1,status:c,data:l}))}async _handleAuthError(t){if(t._skipAuthRefresh)return Promise.reject({success:!1});t._retryAuth=!0;try{const s=await this._refreshToken();return t.headers.Authorization=`Bearer ${s}`,this.api.request(t)}catch{return!!gs()&&this.logout(),Promise.reject({success:!1})}}async _refreshToken(){return this.refreshPromise?this.refreshPromise:(this.refreshPromise=(async()=>{const t=gs();if(!t)throw this.refreshPromise=null,new Error("No token");try{const n=await this.api.post(Wn.ENDPOINTS.AUTH.REFRESH,{token:t},{headers:{"x-no-cache":"true"},_skipAuthRefresh:!0});if(n.success&&n.token)return vr(n.token,!!localStorage.token),this.api.defaults.headers.common.Authorization=`Bearer ${n.token}`,this._retryQueued(n.token),n.token;throw new Error("Refresh failed")}catch(s){throw Ze.create("ApiService").error("Token refresh failed:",s),vr(null,!0),this.api.defaults.headers.common.Authorization="",s}})(),this.refreshPromise.finally(()=>this.refreshPromise=null),this.refreshPromise)}_retryQueued(t){const s=[...this.retryQueue];this.retryQueue=[],s.forEach(n=>{n.headers.Authorization=`Bearer ${t}`,this.api.request(n).catch(()=>{})})}_loadToken(){const t=gs();t&&(this.api.defaults.headers.common.Authorization=`Bearer ${t}`)}logout(){hr(),delete this.api.defaults.headers.common.Authorization,window.dispatchEvent(new CustomEvent("authLogout"))}_addToBatch(t,s,n,o,i={}){this._batchRequests.has(t)||this._batchRequests.set(t,[]);const c=new Promise((l,u)=>{this._batchRequests.get(t).push({method:s,url:n,data:o,options:i,resolve:l,reject:u})});if(!this._batchTimers.has(t)){const l=setTimeout(()=>this._processBatch(t),50);this._batchTimers.set(t,l)}return c}async _processBatch(t){clearTimeout(this._batchTimers.get(t)),this._batchTimers.delete(t);const s=this._batchRequests.get(t)||[];if(this._batchRequests.delete(t),s.length!==0){if(s.length===1){const{method:n,url:o,data:i,options:c,resolve:l,reject:u}=s[0];try{const h=await this._executeSingleRequest(n,o,i,c);l(h)}catch(h){u(h)}return}Ze.create("ApiService").debug(`Batching ${s.length} requests for ${t}`);try{const n=await Promise.all(s.map(({method:o,url:i,data:c,options:l})=>this._executeSingleRequest(o,i,c,l)));s.forEach(({resolve:o},i)=>{o(n[i])})}catch(n){s.forEach(({reject:o})=>{o(n)})}}}_executeSingleRequest(t,s,n,o){switch(t.toLowerCase()){case"get":const i=this.cache.get(s,o.params||{});return i&&o.useCache!==!1?i:this.api.get(s,{params:o.params,...o});case"post":return this.cache.invalidate(s),this.api.post(s,n,o);case"put":return this.cache.invalidate(s),this.api.put(s,n,o);case"delete":return this.cache.invalidate(s),this.api.delete(s,o);default:throw new Error(`Unsupported method: ${t}`)}}async get(t,s={},n={}){if(n.batch){const i=n.batchKey||"default";return this._addToBatch(i,"get",t,null,{...n,params:s})}const o=this.cache.get(t,s);return o&&n.useCache!==!1?o:this.api.get(t,{params:s,...n})}post(t,s,n={}){if(n.batch){const o=n.batchKey||"default";return this._addToBatch(o,"post",t,s,n)}return this.cache.invalidate(t),this.api.post(t,s,n)}put(t,s,n={}){if(n.batch){const o=n.batchKey||"default";return this._addToBatch(o,"put",t,s,n)}return this.cache.invalidate(t),this.api.put(t,s,n)}delete(t,s={}){if(s.batch){const n=s.batchKey||"default";return this._addToBatch(n,"delete",t,null,s)}return this.cache.invalidate(t),this.api.delete(t,s)}upload(t,s,n,o){const i=gs(),c={"Content-Type":"multipart/form-data"};return i&&(c.Authorization=`Bearer ${i}`),this.api.post(t,s,{headers:c,onUploadProgress:n,...o})}download(t,s,n,o){return this.api.get(t,{params:s,responseType:"blob",onDownloadProgress:n,...o})}createCancelableRequest(){const t=Qt.CancelToken.source();return{request:{cancelToken:t.token},cancel:()=>t.cancel("Request canceled")}}cancelAll(t="Canceled"){var s;(s=this.api.defaults.cancelToken)==null||s.cancel(t)}testConnection(){return this.get(Wn.ENDPOINTS.AUTH.TEST,{},{timeout:Wn.HEALTH_CHECK.CONNECTION_TEST_TIMEOUT})}getHealth(){return this.get("/health",{},{timeout:Wn.HEALTH_CHECK.TIMEOUT})}getMetrics(){return{...this.metrics}}clearCache(t){this.cache.invalidate(t)}cleanup(){this.network.cleanup(),this.cancelAll("Cleanup")}_addObjectIdInterceptor(){const t=Ze.create("ApiObjectId");this.api.interceptors.response.use(s=>s,s=>{if(s.response&&s.response.status===400){const n=s.response.data;n&&n.error&&(n.error==="Invalid user ID format"||n.error==="Invalid authenticated user ID format"||n.error==="Invalid user ID format in request")&&(t.warn("⚠️ Caught ObjectId validation error:",n.error),t.info("Standardized user ID format is now used across the application"),console.warn(`ObjectId validation error: ${n.error}. This should be handled by the standardized ID format system.`))}return Promise.reject(s)}),t.info("✅ API ObjectId interceptor installed")}_notifyError(t,s){var i;if(document.hidden)return;const n=((i=s==null?void 0:s.config)==null?void 0:i.url)||"",o=typeof n=="string"?n:"";if(o.includes("/photo-permissions")||o.includes("/photo-access")||o.includes("/users/photo-permissions")||o.endsWith("/blocked")||o.includes("/permissions/pending")){Ze.create("ApiService").debug(`Silently handling error for unimplemented endpoint: ${o}`);return}if(!(s&&(s.includes("story")||s.includes("Story"))&&t===429)&&!(t===404&&(o.includes("/api/users/photo-permissions")||o.includes("/api/users/photo-access"))))switch(t){case 400:if(o.includes("/users/photo-permissions")||o.includes("/photo-permissions"))return;Z.error(`Bad request: ${s}`);break;case 401:break;case 403:Z.error(`Forbidden: ${s}`);break;case 404:Z.error(`Not found: ${s}`);break;case 429:Z.error(s||"Please wait before posting again");break;default:t>=500&&Z.error(`Server error (${t})`)}}}const qe=new om,im=Nn.POLL.NOTIFICATIONS,am=5*6e4,cm=3,lm=2e3,Ks=Ze.create("NotificationService");class dm{constructor(){this._byId=new Map,this._sorted=[],this.unreadCount=0,this.listeners=new Set,this.settings={_init:!1},this.navigate=null,this.loading=!1,this.fetching=!1,this.poller=null,this.bc=null,this._abortController=null,this._retryAttempts=0,this.notificationEventTypes=["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall","newStory"],this.socketHandlers={notification:t=>this._onSocket("generic",t),newMessage:t=>this._onSocket("message",t),newLike:t=>this._onSocket(t.isMatch?"match":"like",t),photoPermissionRequestReceived:t=>this._onSocket("photoRequest",t),photoPermissionResponseReceived:t=>this._onSocket("photoResponse",t),newComment:t=>this._onSocket("comment",t),incomingCall:t=>this._onSocket("call",t),newStory:t=>this._onSocket("story",t)},this._initBroadcast()}_initBroadcast(){if(typeof BroadcastChannel=="function")try{this.bc=new BroadcastChannel("notification_sync"),this.bc.onmessage=({data:{type:t,payload:s}})=>{t==="ADD"&&this._add(s,!1),t==="READ"&&this._markReadLocal(s.notificationId,!1),t==="READ_ALL"&&this._markAllLocal(!1)}}catch(t){Ks.error("BroadcastChannel init failed:",t)}}_sync(t,s){if(this.bc)try{this.bc.postMessage({type:t,payload:s})}catch(n){Ks.error("Broadcast sync failed:",n)}}setNavigate(t){typeof t=="function"&&(this.navigate=t)}initialize(t={}){if(this.settings._init)return;const s={messages:!0,calls:!0,stories:!0,likes:!0,comments:!0,photoRequests:!0};if(this.settings={...s,...t.notifications||{}},this.settings._init=!0,!(sessionStorage.getItem("token")||localStorage.getItem("token"))){Ks.debug("No authentication token, notification service in limited mode");return}this._setupSocket(),this.fetchNotifications(),this._managePolling()}_setupSocket(){Ae.on("connect",()=>{this._clearPoller(),this.fetchNotifications()}),Ae.on("disconnect",()=>this._managePolling());for(const[t,s]of Object.entries(this.socketHandlers))Ae.on(t,s)}_managePolling(){if(!this.settings._init)return;if(!(sessionStorage.getItem("token")||localStorage.getItem("token"))){this._clearPoller(),Ks.debug("No authentication token, polling disabled");return}const s=Ae.isConnected();!s&&!this.poller?(this.poller=setInterval(()=>this.fetchNotifications(),im),this.fetchNotifications()):s&&this.poller&&this._clearPoller()}_clearPoller(){clearInterval(this.poller),this.poller=null}async fetchNotifications(){if(!this.settings._init||this.fetching)return;if(!(sessionStorage.getItem("token")||localStorage.getItem("token"))){Ks.debug("No authentication token, skipping notification fetch");return}this.fetching=!0,this.loading=!0,this._notify(),this._abortController&&this._abortController.abort(),this._abortController=new AbortController;try{const s=await qe.get("/notifications",{_t:Date.now()},{signal:this._abortController.signal});s.success&&Array.isArray(s.data)?(this._processFetched(s.data),this._retryAttempts=0):Ks.warn("Unexpected notifications payload",s)}catch(s){if(s.name!=="AbortError"&&this._retryAttempts<cm){this._retryAttempts+=1;const n=lm*2**(this._retryAttempts-1);setTimeout(()=>this.fetchNotifications(),n)}else Ks.error("Fetch notifications failed:",s)}finally{this.loading=!1,this.fetching=!1,this._notify()}}_processFetched(t){this._byId.clear(),t.forEach(s=>{const n=this._sanitize(s);n&&this._byId.set(n._id,n)}),this._sorted=Array.from(this._byId.values()).sort((s,n)=>n.createdAtTime-s.createdAtTime),this._recount()}_sanitize(t){if(!t||!t._id)return null;const s=t.createdAt||new Date().toISOString(),n=Date.parse(s)||Date.now();return{_id:String(t._id),type:t.type||"generic",title:t.title||"",message:t.message||"",sender:t.sender||null,data:t.data||{},read:!!t.read,createdAt:s,createdAtTime:n,count:Number(t.count)||1}}_onSocket(t,s){if(!this.settings[t])return;const n={_id:s._id||`bc-${Date.now()}`,type:t,title:s.title,message:s.message,sender:s.sender,data:s,read:!1,createdAt:s.createdAt||new Date().toISOString()},o=this._sanitize(n);o&&this._add(o,!0)}_add(t,s=!0){var c;const n=Date.now(),o=((c=t.sender)==null?void 0:c._id)||"";`${t.type}${o}`;const i=this._sorted.find(l=>{var u;return l.type===t.type&&(((u=l.sender)==null?void 0:u._id)||"")===o&&n-l.createdAtTime<am});i?(i.count+=1,i.createdAt=t.createdAt,i.createdAtTime=t.createdAtTime,i.message=`${i.count} new ${i.type}${i.count>1?"s":""}`,i.read=!1):this._byId.has(t._id)||(this._sorted.unshift(t),this._byId.set(t._id,t)),this._recount(),this._notify(),s&&this._sync("ADD",t),window.dispatchEvent(new CustomEvent("newNotification",{detail:t}))}_recount(){this.unreadCount=this._sorted.reduce((t,s)=>t+(s.read?0:1),0)}_notify(){queueMicrotask(()=>{const t={notifications:[...this._sorted],unreadCount:this.unreadCount,loading:this.loading};this.listeners.forEach(s=>{try{s(t)}catch(n){Ks.error("Listener error:",n)}})})}addListener(t){return typeof t!="function"?()=>{}:(this.listeners.add(t),t({notifications:[...this._sorted],unreadCount:this.unreadCount,loading:this.loading}),()=>this.listeners.delete(t))}markAsRead(t,s=!0){this._markReadLocal(t,s),qe.put("/notifications/read",{ids:[t]}).catch(n=>Ks.warn("markAsRead API error:",n))}_markReadLocal(t,s){const n=this._byId.get(t);!n||n.read||(n.read=!0,this._recount(),this._notify(),s&&this._sync("READ",{notificationId:t}))}markAllAsRead(t=!0){this.unreadCount&&(this._markAllLocal(t),qe.put("/notifications/read-all").catch(s=>Ks.warn("markAllAsRead API error:",s)))}_markAllLocal(t){for(const s of this._sorted)s.read=!0;this._recount(),this._notify(),t&&this._sync("READ_ALL",null)}handleClick(t){var n,o,i;if(!this.navigate)return;this.markAsRead(t._id);let s="/dashboard";switch(t.type){case"message":s=`/messages/${((n=t.sender)==null?void 0:n._id)||""}`;break;case"like":case"match":s=`/user/${((o=t.sender)==null?void 0:o._id)||""}`;break;case"photoRequest":s="/settings?tab=privacy";break;case"photoResponse":s=`/user/${((i=t.sender)==null?void 0:i._id)||""}`;break;case"comment":s=`/post/${t.data.postId||t.data.referenceId||""}`;break;case"story":return window.dispatchEvent(new CustomEvent("viewStory",{detail:t.data}));case"call":return window.dispatchEvent(new CustomEvent("startCall",{detail:t.data}))}this.navigate(s)}cleanup(){for(const t of Object.keys(this.socketHandlers))Ae.off(t,this.socketHandlers[t]);Ae.off("connect"),Ae.off("disconnect"),this._abortController&&(this._abortController.abort(),this._abortController=null),this._clearPoller(),this.bc&&this.bc.close(),this.listeners.clear(),this._byId.clear(),this._sorted=[],this.unreadCount=0,this.settings._init=!1,this._retryAttempts=0,this.fetching=!1,this.loading=!1}}const um=()=>{const e=ps();p.useEffect(()=>{Ks.debug("Attaching navigation to NotificationService"),Ls.setNavigate(e),Ls.settings._init&&Ls._setupSocket()},[e])},Ls=new dm,ms=Ze.create("AuthContext"),Xa=p.createContext(),Xt=()=>{const e=p.useContext(Xa);if(!e)throw new Error("useAuth must be used within AuthProvider");return e};function hm({children:e}){const[t,s]=p.useState(null),[n,o]=p.useState(!0),[i,c]=p.useState(null),[l,u]=p.useState(!1),[h,a]=p.useState(!1),d=p.useRef(null),f=p.useRef(null),v=p.useRef(null),g=p.useRef(!1),b=p.useCallback(()=>c(null),[]),$=p.useCallback(async x=>{if(!x)return null;let k={...x};!k._id&&k.id&&(k._id=k.id),!k.id&&k._id&&(k.id=k._id);const R=j=>typeof j=="string"&&Hn(j);if(!R(k._id)){try{const j=gs();if(j){const I=Jc(j);R(I)&&(k._id=k.id=I)}}catch(j){ms.error("normalizeUser.token",j)}R(k._id)}return R(k._id)?k:(ms.error("Invalid user ID:",k._id),Z.error("Auth error: invalid profile, please log in again."),hr(),null)},[]),T=p.useCallback(x=>{var k,R;Ls.initialize((k=x.settings)==null?void 0:k.notifications),Ae.updatePrivacySettings((R=x.settings)==null?void 0:R.privacy)},[]),F=p.useCallback(x=>{clearTimeout(f.current);try{const j=JSON.parse(atob(x.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))).exp*1e3-Date.now()-5*6e4;j>6e4?f.current=setTimeout(()=>M(),j):M()}catch(k){ms.error("scheduleRefresh",k)}},[]),M=p.useCallback(()=>!l&&!gs()?Promise.resolve(null):(d.current||(d.current=(async()=>{var k;const x=gs();if(!x)return null;try{ms.info("Refreshing token…");const R=await qe.post("/auth/refresh-token",{token:x},{headers:{"x-no-cache":"true"},_isRefreshRequest:!0});if(!R.success||!R.token)throw new Error("Bad refresh");vr(R.token,!!localStorage.getItem("token")),F(R.token);const j=Jc(R.token);return t&&j&&j!==t._id&&s(I=>({...I,_id:j,id:j})),ms.info("Token refreshed"),R.token}catch(R){return ms.error("refreshToken",R),d.current=null,(((k=R==null?void 0:R.response)==null?void 0:k.status)===401||ka(gs()))&&A(),null}finally{setTimeout(()=>d.current=null,1e3)}})()),d.current),[l,F,t]),E=p.useCallback(async x=>{var k,R;o(!0),c(null);try{const j=await qe.post("/auth/register",x);if(!j.success)throw j;vr(j.token,!0),F(j.token);const I=await $(j.user);I&&(s(I),u(!0),T(I));const S=await qe.get("/auth/me");if(S.success){const C=await $(S.data);C&&s(C)}return j}catch(j){ms.error("register",j);const I=j.error||((R=(k=j.response)==null?void 0:k.data)==null?void 0:R.error)||"Registration failed";throw c(I),new Error(I)}finally{o(!1)}},[$,F,T]),U=p.useCallback(async(x,k=!0)=>{o(!0),c(null);try{const R=await qe.post("/auth/login",x);if(!R.success||!R.token)throw R;vr(R.token,k),F(R.token);const j=R.user?await $(R.user):await(async()=>{const I=await qe.get("/auth/me");return I.success?$(I.data):null})();return j&&(s(j),u(!0),T(j)),Z.success(j!=null&&j.nickname?`Welcome back, ${j.nickname}!`:"Welcome back!"),R}catch(R){ms.error("login",R);const j=R.error||R.message||"Login failed";throw c(j),Z.error(j),R}finally{o(!1)}},[$,F,T]),A=p.useCallback(async()=>{if(!l&&!gs()){ms.info("Already logged out, skipping logout process");return}o(!0);try{if(clearTimeout(f.current),await qe.logout().catch(()=>{}),hr(),localStorage.clear(),sessionStorage.clear(),"caches"in window)try{const x=await caches.keys();await Promise.all(x.map(k=>caches.delete(k)))}catch(x){ms.error("Failed to clear caches:",x)}s(null),u(!1);try{const x=new BroadcastChannel("auth-channel");x.postMessage({type:"logout"}),x.close()}catch(x){ms.error("Failed to broadcast logout:",x)}window.location.href="/login"}catch(x){ms.error("logout",x),hr(),s(null),u(!1),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"}finally{o(!1)}},[l]),D=p.useCallback(async()=>{try{const x=gs();return x?ka(x)?!!await M():(await qe.get("/auth/verify")).success?!0:!!await M():!1}catch(x){return ms.error("checkAndRefresh",x),!1}},[M]),w=p.useCallback(async()=>{o(!0);try{const x=await qe.get("/auth/me");if(!x.success)throw x;const k=await $(x.data);return k?(s(k),u(!0),T(k),k):null}catch(x){return ms.error("getCurrentUser",x),s(null),u(!1),null}finally{o(!1),a(!0),g.current=!0}},[$,T]),N=p.useCallback(async()=>{var x;try{const k=await qe.post("/auth/resend-verification");return k.success?(Z.success("Verification email sent."),!0):(Z.error(k.error||"Failed to send verification"),!1)}catch(k){return ms.error("resendVerificationEmail",k),((x=k.response)==null?void 0:x.status)===429?Z.error("Too many requests, please wait."):Z.error("Failed to send verification."),!1}},[]);p.useEffect(()=>{if(!g.current)return g.current=!0,v.current=setTimeout(()=>{n&&(ms.warn("Auth check timeout"),o(!1),a(!0),gs()&&u(!0))},8e3),(async()=>(gs()?await D()?await w():(hr(),s(null),u(!1)):(u(!1),s(null)),clearTimeout(v.current),a(!0),o(!1)))(),()=>clearTimeout(v.current)},[D,w]),p.useEffect(()=>()=>clearTimeout(f.current),[]),p.useEffect(()=>{const x=new BroadcastChannel("auth-channel"),k=R=>{R.data.type==="logout"&&(ms.info("Received logout event from another tab"),hr(),s(null),u(!1),window.location.href="/login")};return x.addEventListener("message",k),()=>{x.removeEventListener("message",k),x.close()}},[]);const P={user:t,loading:n,error:i,isAuthenticated:l,authChecked:h,register:E,login:U,logout:A,refreshToken:M,getCurrentUser:w,clearError:b,fixUserIdFormat:$,token:gs(),resendVerificationEmail:N};return r.jsx(Xa.Provider,{value:P,children:e})}var Wi,Qc;function fm(){if(Qc)return Wi;Qc=1;var e="Expected a function",t=NaN,s="[object Symbol]",n=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,u=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,h=typeof self=="object"&&self&&self.Object===Object&&self,a=u||h||Function("return this")(),d=Object.prototype,f=d.toString,v=Math.max,g=Math.min,b=function(){return a.Date.now()};function $(U,A,D){var w,N,P,x,k,R,j=0,I=!1,S=!1,C=!0;if(typeof U!="function")throw new TypeError(e);A=E(A)||0,T(D)&&(I=!!D.leading,S="maxWait"in D,P=S?v(E(D.maxWait)||0,A):P,C="trailing"in D?!!D.trailing:C);function G(ne){var Q=w,he=N;return w=N=void 0,j=ne,x=U.apply(he,Q),x}function V(ne){return j=ne,k=setTimeout(q,A),I?G(ne):x}function L(ne){var Q=ne-R,he=ne-j,re=A-Q;return S?g(re,P-he):re}function X(ne){var Q=ne-R,he=ne-j;return R===void 0||Q>=A||Q<0||S&&he>=P}function q(){var ne=b();if(X(ne))return z(ne);k=setTimeout(q,L(ne))}function z(ne){return k=void 0,C&&w?G(ne):(w=N=void 0,x)}function K(){k!==void 0&&clearTimeout(k),j=0,w=R=N=k=void 0}function W(){return k===void 0?x:z(b())}function H(){var ne=b(),Q=X(ne);if(w=arguments,N=this,R=ne,Q){if(k===void 0)return V(R);if(S)return k=setTimeout(q,A),G(R)}return k===void 0&&(k=setTimeout(q,A)),x}return H.cancel=K,H.flush=W,H}function T(U){var A=typeof U;return!!U&&(A=="object"||A=="function")}function F(U){return!!U&&typeof U=="object"}function M(U){return typeof U=="symbol"||F(U)&&f.call(U)==s}function E(U){if(typeof U=="number")return U;if(M(U))return t;if(T(U)){var A=typeof U.valueOf=="function"?U.valueOf():U;U=T(A)?A+"":A}if(typeof U!="string")return U===0?U:+U;U=U.replace(n,"");var D=i.test(U);return D||c.test(U)?l(U.slice(2),D?2:8):o.test(U)?t:+U}return Wi=$,Wi}var gm=fm();const Xc=Fn(gm),Mt=Ze.create("StoriesService"),pn="/stories",pm=Sn.TTL.STORIES;let Rn=null,Zc=0;const _r=new Map;let el=0;const mm=async()=>{try{const e=Date.now();if(Rn&&e-Zc<pm)return e-el>1e4&&(Mt.debug("Returning cached stories"),el=e),Rn;Mt.debug("Fetching all stories");const t=await qe.get(pn);return Zc=e,Array.isArray(t)?(Mt.debug("Handling legacy API format for stories"),Rn={success:!0,data:t},Rn):(Rn=t,t)}catch(e){return Mt.error("Error fetching stories",e),{success:!1,message:e.message||"Failed to fetch stories"}}},ym=async e=>{try{Mt.debug(`Fetching stories for user ${e}`);const t=await qe.get(`${pn}/user/${e}`);return Array.isArray(t)?(Mt.debug("Handling legacy API format for user stories"),{success:!0,data:t}):t}catch(t){return Mt.error(`Error fetching stories for user ${e}`,t),{success:!1,message:t.message||"Failed to fetch user stories"}}},vm=async(e,t)=>{const s=`create-story-${Date.now()}`;if(_r.has(s.substring(0,s.length-3)))return Mt.warn("Duplicate story creation request detected"),{success:!1,message:"A similar request is already in progress"};_r.set(s,!0),Mt.debug(`Starting story creation request: ${s}`);try{if(e instanceof FormData)e.append("timestamp",Date.now().toString());else if(typeof e=="object"){if(e.mediaType==="text"||e.type==="text")return Mt.debug("Redirecting to text story creation"),Vd(e,t);e.timestamp=Date.now()}Mt.debug("Uploading media story");const n=await qe.upload(pn,e,t),o={success:!0,data:n.data||n,message:"Story created successfully"};return Mt.debug("Invalidating stories cache after creation"),Rn=null,o}catch(n){return Mt.error("Error creating story",n),{success:!1,message:n.message||"Failed to create story"}}finally{setTimeout(()=>{_r.delete(s),Mt.debug(`Story request ${s} unlocked after cooldown`)},5e3)}},Vd=async(e,t)=>{const n=`create-text-story-${e.content?e.content.trim().substring(0,20):""}`;if(_r.has(n))return Mt.warn("Duplicate text story creation request detected"),{success:!1,error:"Duplicate submission"};_r.set(n,!0),Mt.debug(`Starting text story creation: ${n}`);try{const o={...e,timestamp:Date.now(),type:"text",mediaType:"text"};Mt.debug("Sending text story to API");const i=await qe.post(pn,o,{onUploadProgress:t});if(i&&typeof i=="object"){if(i.error)throw new Error(i.error);if(i.success===!1)throw new Error(i.message||"Failed to create text story")}const c=(i==null?void 0:i.status)===201||i&&(i.success||i._id);let l;return c?l={success:!0,data:i.data||i.story||i,message:"Story created successfully"}:i&&i.success?l={success:!0,data:i.data||i.story,message:"Story created successfully"}:i&&i._id?l={success:!0,data:i,message:"Story created successfully"}:i==null?l={success:!0,message:"Story created successfully",data:{created:!0,timestamp:Date.now()}}:l={success:!0,data:i,message:"Story created successfully"},Mt.debug("Invalidating stories cache after text story creation"),Rn=null,l}catch(o){return Mt.error("Error creating text story",o),{success:!1,message:o.message||"Failed to create text story"}}finally{setTimeout(()=>{_r.delete(n),Mt.debug(`Text story request ${n} unlocked after cooldown`)},5e3)}},_m=async e=>{try{Mt.debug(`Deleting story ${e}`);const t=await qe.delete(`${pn}/${e}`),s=t&&!t.success&&t.msg?{success:!0,message:t.msg}:t;return Mt.debug("Invalidating stories cache after deletion"),Rn=null,s}catch(t){return Mt.error(`Error deleting story ${e}`,t),{success:!1,message:t.message||"Failed to delete story"}}},wm=async e=>{try{Mt.debug(`Marking story ${e} as viewed`);const t=await qe.post(`${pn}/${e}/view`);return t&&!t.success&&t.msg?{success:!0,message:t.msg}:t}catch(t){return Mt.error(`Error marking story ${e} as viewed`,t),{success:!1,message:t.message||"Failed to mark story as viewed"}}},bm=async(e,t)=>{try{Mt.debug(`Reacting to story ${e} with type: ${t}`);const s=await qe.post(`${pn}/${e}/react`,{reactionType:t});return s&&s.data&&!s.success?{success:!0,data:s.data,message:"Reaction added successfully"}:s}catch(s){return Mt.error(`Error reacting to story ${e}`,s),{success:!1,message:s.message||"Failed to react to story"}}},xm=async e=>{try{return Mt.debug(`Removing reaction from story ${e}`),await qe.delete(`${pn}/${e}/react`)}catch(t){return Mt.error(`Error removing reaction from story ${e}`,t),{success:!1,message:t.message||"Failed to remove reaction"}}},Sm=async e=>{try{return Mt.debug(`Fetching reactions for story ${e}`),await qe.get(`${pn}/${e}/reactions`)}catch(t){return Mt.error(`Error fetching reactions for story ${e}`,t),{success:!1,message:t.message||"Failed to fetch story reactions"}}},Cm=async e=>{try{return Mt.debug(`Fetching viewers for story ${e}`),await qe.get(`${pn}/${e}/viewers`)}catch(t){return Mt.error(`Error fetching viewers for story ${e}`,t),{success:!1,message:t.message||"Failed to fetch story viewers"}}},Un={getAllStories:mm,getUserStories:ym,createStory:vm,createTextStory:Vd,deleteStory:_m,markStoryAsViewed:wm,reactToStory:bm,removeReaction:xm,getStoryReactions:Sm,getStoryViewers:Cm},wn=Ze.create("StoriesContext"),Wd=p.createContext(),km={stories:[],loading:!1,error:null,viewedStories:{},isCreating:!1};function Nm(e,t){switch(t.type){case"LOAD_START":return{...e,loading:!0,error:null};case"LOAD_SUCCESS":return{...e,loading:!1,stories:t.payload,error:null};case"LOAD_ERROR":return{...e,loading:!1,error:t.payload};case"ADD_STORY":return{...e,stories:e.stories.some(s=>s._id===t.payload._id)?e.stories:[t.payload,...e.stories]};case"REMOVE_STORY":return{...e,stories:e.stories.filter(s=>s._id!==t.payload)};case"CREATE_START":return{...e,isCreating:!0};case"CREATE_END":return{...e,isCreating:!1};case"VIEW_STORY":return{...e,viewedStories:{...e.viewedStories,[t.payload]:Date.now()}};default:return e}}function Em({children:e}){const{user:t,isAuthenticated:s}=Xt(),[n,o]=p.useReducer(Nm,km),i=p.useRef(0),c=p.useRef(new Map),l=p.useRef(null),u=p.useCallback(async(F=!1)=>{const M=Date.now();if(!F&&n.stories.length>0&&M-i.current<6e4)return n.stories;const E="loadStories";if(c.current.has(E))return c.current.get(E);const U=(async()=>{o({type:"LOAD_START"});try{const A=await Un.getAllStories();if(!A.success)throw new Error(A.message||"Failed to load stories");const D=A.data.map(N=>{if(N.user&&typeof N.user=="object")if(N.userData){if(typeof N.userData=="object"&&!N.userData._id)return{...N,userData:{...N.userData,_id:N.user._id||N._id}}}else return{...N,userData:{...N.user,_id:N.user._id||N._id}};return typeof N.user=="string"&&!N.userData?{...N,userData:{_id:N.user,...N.nickname&&{nickname:N.nickname}}}:N.userData&&typeof N.userData=="object"&&!N.userData._id&&typeof N.user=="string"?{...N,userData:{...N.userData,_id:N.user}}:N}),w=Array.from(new Map(D.map(N=>[N._id,N])).values());return i.current=Date.now(),o({type:"LOAD_SUCCESS",payload:w}),w}catch(A){return o({type:"LOAD_ERROR",payload:A.message}),[]}finally{c.current.delete(E)}})();return c.current.set(E,U),U},[n.stories]),h=p.useMemo(()=>Xc(u,300),[u]),a=p.useCallback(F=>{if(!F)return Promise.resolve([]);const M=`loadUserStories:${F}`;if(c.current.has(M))return c.current.get(M);const E=(async()=>{o({type:"LOAD_START"});try{const U=await Un.getUserStories(F);if(!U.success)throw new Error(U.message||"Failed to load user stories");return Array.isArray(U.data)?U.data.map(D=>{if(D.user&&typeof D.user=="object")if(D.userData){if(typeof D.userData=="object"&&!D.userData._id)return{...D,userData:{...D.userData,_id:D.user._id||D._id||F}}}else return{...D,userData:{...D.user,_id:D.user._id||D._id||F}};return typeof D.user=="string"&&!D.userData?{...D,userData:{_id:D.user,...D.nickname&&{nickname:D.nickname}}}:D.userData&&typeof D.userData=="object"&&!D.userData._id&&typeof D.user=="string"?{...D,userData:{...D.userData,_id:D.user}}:D.userData?D:{...D,userData:{_id:F}}}):[]}catch(U){return wn.error(`loadUserStories(${F})`,U),[]}finally{o({type:"LOAD_SUCCESS",payload:n.stories}),c.current.delete(M)}})();return c.current.set(M,E),E},[n.stories]),d=p.useCallback(async(F,M)=>{var E,U;if(wn.debug("createStory"),!s)return Z.error("Login required to create stories"),{success:!1};if(!n.isCreating){o({type:"CREATE_START"});try{const A={...F};if(A.mediaType==="text"&&!A.content)throw new Error("Text stories require content");const D=A.mediaType==="text"?await Un.createTextStory(A,M):await Un.createStory(A,M);if(!D)throw new Error("No response from server");if(D.message&&D.message.includes("wait")&&!D.success)return Z.info(D.message),D;if(!D.success)throw new Error(D.message||"Failed to create story");const w=D.data||D.story;if(!w)throw new Error("No story returned from API");return o({type:"ADD_STORY",payload:w}),D}catch(A){if(A.status===429||A&&A.data&&A.data.status===429){const w=((E=A.data)==null?void 0:E.message)||((U=A.data)==null?void 0:U.error)||"Please wait before posting another story";return Z.error(w),wn.error("createStory rate limited",A),{success:!1,message:w}}else return Z.error(A.message),wn.error("createStory",A),{success:!1,message:A.message}}finally{o({type:"CREATE_END"})}}},[s,n.isCreating]),f=p.useCallback(async F=>{if(!s)return Z.error("Login required to delete stories"),{success:!1};if(!F)return Z.error("Invalid story ID"),{success:!1};const M=`deleteStory:${F}`;if(c.current.has(M))return c.current.get(M);const E=(async()=>{o({type:"LOAD_START"});try{const U=await Un.deleteStory(F);if(!U.success)throw new Error(U.message||"Failed to delete story");return o({type:"REMOVE_STORY",payload:F}),Z.success("Story deleted"),U}catch(U){return Z.error(U.message),wn.error("deleteStory",U),{success:!1,message:U.message}}finally{c.current.delete(M),o({type:"LOAD_SUCCESS",payload:n.stories})}})();return c.current.set(M,E),E},[s,n.stories]),v=p.useCallback(F=>{if(!s||!F)return Promise.resolve(!1);const M=`viewStory:${F}`;if(c.current.has(M))return c.current.get(M);const E=(async()=>{try{const U=await Un.markStoryAsViewed(F);if(!U.success)throw new Error(U.message||"Failed to mark viewed");return o({type:"VIEW_STORY",payload:F}),!0}catch(U){return wn.error("viewStory",U),!1}finally{c.current.delete(M)}})();return c.current.set(M,E),E},[s]),g=p.useCallback((F,M)=>{if(!s||!F||!M)return Z.error("Invalid reaction"),Promise.resolve({success:!1});const E=`reactToStory:${F}:${M}`;if(c.current.has(E))return c.current.get(E);const U=(async()=>{try{const A=await Un.reactToStory(F,M);if(!A.success)throw new Error(A.message||"Failed to react");return Z.success("Reaction recorded"),A}catch(A){return Z.error(A.message),wn.error("reactToStory",A),{success:!1}}finally{c.current.delete(E)}})();return c.current.set(E,U),U},[s]),b=p.useCallback(F=>F?n.stories.some(M=>{var E;return String(((E=M.user)==null?void 0:E._id)||M.user)===String(F)&&!n.viewedStories[M._id]}):!1,[n.stories,n.viewedStories]),$=p.useCallback(()=>{o({type:"LOAD_ERROR",payload:null})},[]);p.useEffect(()=>{if(t!=null&&t._id)try{const F=`viewedStories:${t._id}`,M=JSON.parse(localStorage.getItem(F)||"{}");if(o({type:"VIEW_STORY",payload:null}),M&&typeof M=="object")for(const[E,U]of Object.entries(M))o({type:"VIEW_STORY",payload:E})}catch(F){wn.error("load viewedStories",F)}},[t]),p.useEffect(()=>{if(!(t!=null&&t._id))return;const M=Xc(()=>{try{localStorage.setItem(`viewedStories:${t._id}`,JSON.stringify(n.viewedStories))}catch(E){wn.error("save viewedStories",E)}},1e3);return M(),()=>M.flush()},[n.viewedStories,t]),p.useEffect(()=>{if(l.current&&clearInterval(l.current),!s)return;const F=setTimeout(()=>h(!1),500);return l.current=setInterval(()=>{document.visibilityState==="visible"&&h(!0)},5*6e4),()=>{clearTimeout(F),clearInterval(l.current)}},[s,h]);const T=p.useMemo(()=>({stories:n.stories,loading:n.loading,error:n.error,viewedStories:n.viewedStories,isCreating:n.isCreating,clearError:$,loadStories:u,loadUserStories:a,createStory:d,deleteStory:f,viewStory:v,reactToStory:g,hasUnviewedStories:b}),[n,$,u,a,d,f,v,g,b]);return r.jsx(Wd.Provider,{value:T,children:e})}function co(){const e=p.useContext(Wd);if(!e)throw new Error("useStories must be used within StoriesProvider");return e}function Gd(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(e)}function Yd(e){return Re({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(e)}function Tm(e){return Re({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"},child:[]}]})(e)}function Am(e){return Re({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"},child:[]}]})(e)}function wr(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(e)}function Jr(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(e)}function Za(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"},child:[]}]})(e)}function eo(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(e)}function Kd(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(e)}function Cn(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"},child:[]}]})(e)}function jm(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(e)}function Im(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 174.8l-39.6-39.6c-9.4-9.4-24.6-9.4-33.9 0L192 374.7 80.6 263.2c-9.4-9.4-24.6-9.4-33.9 0L7 302.9c-9.4 9.4-9.4 24.6 0 34L175 505c9.4 9.4 24.6 9.4 33.9 0l296-296.2c9.4-9.5 9.4-24.7.1-34zm-324.3 106c6.2 6.3 16.4 6.3 22.6 0l208-208.2c6.2-6.3 6.2-16.4 0-22.6L366.1 4.7c-6.2-6.3-16.4-6.3-22.6 0L192 156.2l-55.4-55.5c-6.2-6.3-16.4-6.3-22.6 0L68.7 146c-6.2 6.3-6.2 16.4 0 22.6l112 112.2z"},child:[]}]})(e)}function jt(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(e)}function $m(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"},child:[]}]})(e)}function Jd(e){return Re({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(e)}function Qd(e){return Re({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(e)}function Pm(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"},child:[]}]})(e)}function Rm(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(e)}function tl(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(e)}function kr(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"},child:[]}]})(e)}function Mm(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"},child:[]}]})(e)}function Lm(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M4.686 427.314L104 328l-32.922-31.029C55.958 281.851 66.666 256 88.048 256h112C213.303 256 224 266.745 224 280v112c0 21.382-25.803 32.09-40.922 16.971L152 376l-99.314 99.314c-6.248 6.248-16.379 6.248-22.627 0L4.686 449.941c-6.248-6.248-6.248-16.379 0-22.627zM443.314 84.686L344 184l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C234.697 256 224 245.255 224 232V120c0-21.382 25.803-32.09 40.922-16.971L296 136l99.314-99.314c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.248 6.248 6.248 16.379 0 22.627z"},child:[]}]})(e)}function Xd(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"},child:[]}]})(e)}function Zd(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(e)}function eu(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"},child:[]}]})(e)}function Om(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 464c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V200.724a48 48 0 0 1 18.387-37.776c24.913-19.529 45.501-35.365 164.2-121.511C199.412 29.17 232.797-.347 256 .003c23.198-.354 56.596 29.172 73.413 41.433 118.687 86.137 139.303 101.995 164.2 121.512A48 48 0 0 1 512 200.724V464zm-65.666-196.605c-2.563-3.728-7.7-4.595-11.339-1.907-22.845 16.873-55.462 40.705-105.582 77.079-16.825 12.266-50.21 41.781-73.413 41.43-23.211.344-56.559-29.143-73.413-41.43-50.114-36.37-82.734-60.204-105.582-77.079-3.639-2.688-8.776-1.821-11.339 1.907l-9.072 13.196a7.998 7.998 0 0 0 1.839 10.967c22.887 16.899 55.454 40.69 105.303 76.868 20.274 14.781 56.524 47.813 92.264 47.573 35.724.242 71.961-32.771 92.263-47.573 49.85-36.179 82.418-59.97 105.303-76.868a7.998 7.998 0 0 0 1.839-10.967l-9.071-13.196z"},child:[]}]})(e)}function gn(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(e)}function ec(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function Bt(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function Fm(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"},child:[]}]})(e)}function tu(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(e)}function tc(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(e)}function sl(e){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(e)}function Dm(e){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm-64 268c0 10.7-12.9 16-20.5 8.5L104 376H76c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h28l35.5-36.5c7.6-7.6 20.5-2.2 20.5 8.5v136zm33.2-47.6c9.1-9.3 9.1-24.1 0-33.4-22.1-22.8 12.2-56.2 34.4-33.5 27.2 27.9 27.2 72.4 0 100.4-21.8 22.3-56.9-10.4-34.4-33.5zm86-117.1c54.4 55.9 54.4 144.8 0 200.8-21.8 22.4-57-10.3-34.4-33.5 36.2-37.2 36.3-96.5 0-133.8-22.1-22.8 12.3-56.3 34.4-33.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(e)}function Bm(e){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z"},child:[]}]})(e)}function Um(e){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M384 121.941V128H256V0h6.059c6.365 0 12.47 2.529 16.971 7.029l97.941 97.941A24.005 24.005 0 0 1 384 121.941zM224 136V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248c-13.2 0-24-10.8-24-24zm96 144.016v111.963c0 21.445-25.943 31.998-40.971 16.971L224 353.941V392c0 13.255-10.745 24-24 24H88c-13.255 0-24-10.745-24-24V280c0-13.255 10.745-24 24-24h112c13.255 0 24 10.745 24 24v38.059l55.029-55.013c15.011-15.01 40.971-4.491 40.971 16.97z"},child:[]}]})(e)}function qm(e){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(e)}function zm(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(e)}function su(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048 34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122 53.588 0 97.844 34.783 165.217 34.783 48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016-34.338 15.948-76.454 31.854-116.95 31.854z"},child:[]}]})(e)}function Hm(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"},child:[]}]})(e)}function On(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(e)}function gi(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"},child:[]}]})(e)}function Vm(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"},child:[]}]})(e)}function Wm(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(e)}function Na(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"},child:[]}]})(e)}function vs(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(e)}function to(e){return Re({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(e)}function nl(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"},child:[]}]})(e)}function Gm(e){return Re({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"},child:[]}]})(e)}function Ym(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"},child:[]}]})(e)}function Ea(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(e)}function Km(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(e)}function nu(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"},child:[]}]})(e)}function Jm(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(e)}function Ta(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z"},child:[]}]})(e)}function ru(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(e)}function Br(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(e)}function ou(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(e)}function Qm(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"},child:[]}]})(e)}function Xm(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"},child:[]}]})(e)}function iu(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(e)}function Zm(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"},child:[]}]})(e)}function sc(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"},child:[]}]})(e)}function e1(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(e)}function t1(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M216 288h-48c-8.84 0-16 7.16-16 16v192c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V304c0-8.84-7.16-16-16-16zM88 384H40c-8.84 0-16 7.16-16 16v96c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16v-96c0-8.84-7.16-16-16-16zm256-192h-48c-8.84 0-16 7.16-16 16v288c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V208c0-8.84-7.16-16-16-16zm128-96h-48c-8.84 0-16 7.16-16 16v384c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V112c0-8.84-7.16-16-16-16zM600 0h-48c-8.84 0-16 7.16-16 16v480c0 8.84 7.16 16 16 16h48c8.84 0 16-7.16 16-16V16c0-8.84-7.16-16-16-16z"},child:[]}]})(e)}function s1(e){return Re({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"},child:[]}]})(e)}function Ws(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(e)}function n1(e){return Re({attr:{viewBox:"0 0 480 512"},child:[{tag:"path",attr:{d:"M471.99 334.43L336.06 256l135.93-78.43c7.66-4.42 10.28-14.2 5.86-21.86l-32.02-55.43c-4.42-7.65-14.21-10.28-21.87-5.86l-135.93 78.43V16c0-8.84-7.17-16-16.01-16h-64.04c-8.84 0-16.01 7.16-16.01 16v156.86L56.04 94.43c-7.66-4.42-17.45-1.79-21.87 5.86L2.15 155.71c-4.42 7.65-1.8 17.44 5.86 21.86L143.94 256 8.01 334.43c-7.66 4.42-10.28 14.21-5.86 21.86l32.02 55.43c4.42 7.65 14.21 10.27 21.87 5.86l135.93-78.43V496c0 8.84 7.17 16 16.01 16h64.04c8.84 0 16.01-7.16 16.01-16V339.14l135.93 78.43c7.66 4.42 17.45 1.8 21.87-5.86l32.02-55.43c4.42-7.65 1.8-17.43-5.86-21.85z"},child:[]}]})(e)}function Ur(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(e)}function r1(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"},child:[]}]})(e)}function Gi(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"},child:[]}]})(e)}function o1(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z"},child:[]}]})(e)}function Ts(e){return Re({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}function br(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(e)}function i1(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(e)}function a1(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"},child:[]}]})(e)}function c1(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"},child:[]}]})(e)}function Aa(e){return Re({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(e)}function l1(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(e)}function d1(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.8 458.1L362.3 248.3C412.1 230.7 448 183.8 448 128 448 57.3 390.7 0 320 0c-67.1 0-121.5 51.8-126.9 117.4L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3zM96 422.4V464c0 26.5 21.5 48 48 48h350.2L207.4 290.3C144.2 301.3 96 356 96 422.4z"},child:[]}]})(e)}function Qr(e){return Re({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(e)}function Go(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(e)}function u1(e){return Re({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.8 458.1l-55-42.5c15.4-1.4 29.2-13.7 29.2-31.1v-257c0-25.5-29.1-40.4-50.4-25.8L448 177.3v137.2l-32-24.7v-178c0-26.4-21.4-47.8-47.8-47.8H123.9L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4L42.7 82 416 370.6l178.5 138c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.5-6.9 4.2-17-2.8-22.4zM32 400.2c0 26.4 21.4 47.8 47.8 47.8h288.4c11.2 0 21.4-4 29.6-10.5L32 154.7v245.5z"},child:[]}]})(e)}function Xn(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z"},child:[]}]})(e)}function h1(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"},child:[]}]})(e)}function f1(e){return Re({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"},child:[]}]})(e)}function g1(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"},child:[]}]})(e)}function au(e){return Re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(e)}const Rs=Ze.create("UserContext"),cu=p.createContext(),p1={users:[],currentUser:null,messages:[],photoPermissions:[],likedUsers:[],loading:!1,uploadingPhoto:!1,updatingProfile:!1,likesLoading:!0,error:null};function m1(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.payload};case"GET_USERS":return{...e,users:t.payload,loading:!1};case"APPEND_USERS":return{...e,users:[...e.users,...t.payload],loading:!1};case"GET_USER":return{...e,currentUser:t.payload.user,messages:t.payload.messages,loading:!1};case"UPLOAD_PHOTO":return{...e,currentUser:e.currentUser?{...e.currentUser,photos:[...e.currentUser.photos||[],t.payload]}:null,uploadingPhoto:!1};case"PHOTO_PERMISSION_REQUESTED":return{...e,photoPermissions:[...e.photoPermissions,t.payload]};case"PHOTO_PERMISSION_UPDATED":return{...e,photoPermissions:e.photoPermissions.map(s=>s._id===t.payload._id?t.payload:s)};case"SET_LIKED_USERS":return{...e,likedUsers:t.payload,likesLoading:!1};case"ADD_LIKED_USER":return e.likedUsers.some(s=>{var n;return String(((n=s.recipient)==null?void 0:n._id)||s.recipient)===String(t.payload.recipient)})?e:{...e,likedUsers:[...e.likedUsers,t.payload]};case"REMOVE_LIKED_USER":return{...e,likedUsers:e.likedUsers.filter(s=>{var n;return String(((n=s.recipient)==null?void 0:n._id)||s.recipient)!==String(t.payload)})};case"SET_LIKES_LOADING":return{...e,likesLoading:t.payload};case"UPLOADING_PHOTO":return{...e,uploadingPhoto:!0};case"UPDATING_PROFILE":return{...e,updatingProfile:!0};case"UPDATE_PROFILE":return{...e,currentUser:t.payload,updatingProfile:!1};case"USER_ERROR":return{...e,error:t.payload,loading:!1,uploadingPhoto:!1,updatingProfile:!1,likesLoading:!1};case"CLEAR_ERROR":return{...e,error:null};default:return e}}function y1({children:e}){var N;const[t,s]=p.useReducer(m1,p1),{user:n,isAuthenticated:o}=Xt(),i=p.useRef(!1),c=p.useRef();p.useRef(null);const l=p.useCallback(async(P=1,x=20)=>{var k,R;s({type:"SET_LOADING",payload:P===1});try{const j=await qe.get(`/users?page=${P}&limit=${x}`);if(!j.success)throw new Error(j.error||"Failed to fetch users");return s({type:P===1?"GET_USERS":"APPEND_USERS",payload:j.data}),{users:j.data,hasMore:j.hasMore??((k=j.pagination)==null?void 0:k.hasNext)??j.data.length===x,totalPages:((R=j.pagination)==null?void 0:R.totalPages)??Math.ceil(j.totalCount/x)??1}}catch(j){return s({type:"USER_ERROR",payload:j.message}),{users:[],hasMore:!1,totalPages:1}}},[]),u=p.useCallback(()=>{clearTimeout(c.current),c.current=setTimeout(()=>{o&&n&&l()},500)},[l,o,n]);p.useEffect(()=>(o&&n&&u(),()=>clearTimeout(c.current)),[u,o,n]);const h=p.useCallback(async(P=!1)=>{if(!i.current||P){if(s({type:"SET_LIKES_LOADING",payload:!0}),!(n!=null&&n._id)||!Hn(n._id)){s({type:"SET_LIKED_USERS",payload:[]});return}try{const x=await qe.get("/users/likes",{},{headers:P?{"x-no-cache":"true"}:{},useCache:!P});x.success?s({type:"SET_LIKED_USERS",payload:x.data}):s({type:"SET_LIKED_USERS",payload:[]}),i.current=!0}catch{s({type:"SET_LIKED_USERS",payload:[]})}}},[n]);p.useEffect(()=>{if(o&&(n!=null&&n._id)){h(!0);const P=setInterval(()=>{document.visibilityState==="visible"&&h(!0)},5*6e4);return()=>clearInterval(P)}else s({type:"SET_LIKED_USERS",payload:[]}),i.current=!1},[h,o,n]),p.useEffect(()=>{var P;(P=t.currentUser)!=null&&P.settings&&(Rs.info("Initializing services with settings",t.currentUser.settings),Ls.initialize(t.currentUser.settings.notifications),Ae.updatePrivacySettings(t.currentUser.settings.privacy))},[(N=t.currentUser)==null?void 0:N.settings]);const a=p.useCallback(async P=>{if(!Hn(P))return s({type:"USER_ERROR",payload:"Invalid user ID"}),null;s({type:"SET_LOADING",payload:!0});try{const x=await qe.get(`/users/${P}`);if(!x.success)throw new Error(x.error);return s({type:"GET_USER",payload:x.data}),x.data}catch(x){return s({type:"USER_ERROR",payload:x.message}),null}},[]),d=p.useCallback(async P=>{s({type:"UPDATING_PROFILE"});try{const x=await qe.put("/users/profile",P);if(Rs.debug("Profile update response:",x),!x.success)throw new Error(x.error||"Profile update failed");if(!t.currentUser)return s({type:"UPDATE_PROFILE",payload:x.data}),x.data;const k={...t.currentUser,...x.data,_id:t.currentUser._id||x.data&&x.data._id};return s({type:"UPDATE_PROFILE",payload:k}),k}catch(x){return Rs.error("Profile update error details:",x),s({type:"USER_ERROR",payload:x.message}),null}},[t.currentUser]),f=p.useCallback(async(P,x="private")=>{s({type:"UPLOADING_PHOTO"});try{const k=new FormData;k.append("photo",P),k.append("privacy",x);const R=await qe.upload("/users/photos",k,j=>Rs.debug(`Upload progress: ${j}%`));if(!R.success)throw new Error(R.error);return s({type:"UPLOAD_PHOTO",payload:R.data}),R.data}catch(k){throw s({type:"USER_ERROR",payload:k.message}),k}},[]),v=p.useCallback(async(P,x)=>{try{const k=await qe.post(`/users/photos/${P}/request`,{userId:x});if(!k.success)throw new Error(k.error);return s({type:"PHOTO_PERMISSION_REQUESTED",payload:k.data}),Z.success("Access request sent"),k.data}catch(k){return s({type:"USER_ERROR",payload:k.message}),null}},[]),g=p.useCallback(async(P,x)=>{try{const k=await qe.put(`/users/photos/permissions/${P}`,{status:x});if(!k.success)throw new Error(k.error);return s({type:"PHOTO_PERMISSION_UPDATED",payload:k.data}),Z.success(`Photo ${x}`),k.data}catch(k){return s({type:"USER_ERROR",payload:k.message}),null}},[]),b=p.useCallback(P=>t.likedUsers.some(x=>{var k;return String(((k=x.recipient)==null?void 0:k._id)||x.recipient)===String(P)}),[t.likedUsers]),$=p.useCallback(async(P,x)=>{if(!Hn(P))return Z.error("Invalid user ID"),!1;if(b(P))return!0;s({type:"ADD_LIKED_USER",payload:{recipient:P,createdAt:new Date}});try{const k=await qe.post(`/users/${P}/like`,{},{headers:{"x-no-cache":"true"}});if(!k.success&&k.error!=="Already liked")throw new Error(k.error);return h(!0),Z.success(r.jsxs(r.Fragment,{children:[r.jsx(On,{className:"pulse"})," Liked ",x||""]})),k.likesRemaining!==void 0&&Z.info(`${k.likesRemaining} likes left`),!0}catch(k){return s({type:"REMOVE_LIKED_USER",payload:P}),Z.error(k.message),!1}},[h,b]),T=p.useCallback(async(P,x)=>{if(!b(P))return!0;s({type:"REMOVE_LIKED_USER",payload:P});try{const k=await qe.delete(`/users/${P}/like`,{},{headers:{"x-no-cache":"true"}});if(!k.success)throw new Error(k.error);return h(!0),Z.info(`Unliked ${x||""}`),!0}catch(k){return s({type:"ADD_LIKED_USER",payload:{recipient:P,createdAt:new Date}}),Z.error(k.message),!1}},[h,b]),F=p.useCallback(async P=>{try{const x=await qe.post("/messages/start",{recipient:P});if(!x.success)throw new Error(x.error);return x.data}catch(x){return s({type:"USER_ERROR",payload:x.message}),null}},[]),M=p.useCallback(async()=>{try{if(!n)return[];Rs.debug("Fetching blocked users list");try{const P=await qe.get("/users/blocked");if(Rs.debug(`Blocked users response: ${P!=null&&P.success?"success":"failed"}`),!(P!=null&&P.success))return[];const x=(Array.isArray(P.data)?P.data:[]).map(k=>typeof k=="object"&&k._id?k._id:typeof k=="object"&&k.id?k.id:String(k).replace(/^ObjectId\(['"](.+)['"]\)$/,"$1")).filter(k=>/^[0-9a-fA-F]{24}$/.test(k));return localStorage.setItem("blockedUsers",JSON.stringify(x)),x}catch(P){Rs.warn("Failed to fetch blocked users from API, using localStorage fallback:",P);try{const x=localStorage.getItem("blockedUsers");if(x){const k=JSON.parse(x)||[];return Rs.debug(`Loaded ${k.length} blocked users from localStorage`),k}}catch(x){Rs.warn("Error parsing blocked users from localStorage:",x)}return[]}}catch(P){return Rs.error("Error in getBlockedUsers:",P),[]}},[n]),E=p.useCallback(async(P,x="User")=>{if(!Hn(P))return Z.error("Invalid user ID"),!1;try{const k=await qe.post(`/users/${P}/block`);if(!k.success&&!k.alreadyBlocked)throw new Error(k.error);return Z.success(`Blocked ${x}`),!0}catch(k){return s({type:"USER_ERROR",payload:k.message}),!1}},[]),U=p.useCallback(async(P,x="User")=>{if(!Hn(P))return Z.error("Invalid user ID"),!1;try{const k=await qe.delete(`/users/${P}/block`);if(!k.success)throw new Error(k.error);return Z.success(`Unblocked ${x}`),!0}catch(k){return s({type:"USER_ERROR",payload:k.message}),!1}},[]),A=p.useCallback(async(P,x="")=>{if(!Hn(P))return!1;try{const k=await qe.post(`/users/${P}/report`,{reason:x});if(!k.success)throw new Error(k.error);return Z.success("User reported"),!0}catch(k){return s({type:"USER_ERROR",payload:k.message}),!1}},[]),D=p.useCallback(()=>s({type:"CLEAR_ERROR"}),[]),w=p.useCallback(async(P,x=!1)=>{var k;try{if(!P&&(n!=null&&n._id)){Rs.info("Refreshing current user data"+(x?" (immediate)":""));const R=await qe.get("/auth/me",{},{useCache:!1,headers:{"x-no-cache":"true","Cache-Control":x?"no-cache, no-store, must-revalidate":void 0,Pragma:x?"no-cache":void 0}});if(!R.success)throw new Error(R.error||"Failed to refresh user data");const j={user:R,messages:t.messages||[]};return x&&qe.clearCache("/auth/me"),s({type:"GET_USER",payload:j}),R}else{const R=P||((k=t.currentUser)==null?void 0:k._id)||(n==null?void 0:n._id);if(!R)throw new Error("No user ID available for refresh");Rs.info("Refreshing user data for ID:",R+(x?" (immediate)":""));const j=await qe.get(`/users/${R}`,{},{useCache:!1,headers:{"x-no-cache":"true","Cache-Control":x?"no-cache, no-store, must-revalidate":void 0,Pragma:x?"no-cache":void 0}});if(!j.success)throw new Error(j.error||"Failed to refresh user data");return x&&qe.clearCache(`/users/${R}`),s({type:"GET_USER",payload:j.data}),j.data}}catch(R){return Rs.error("Error refreshing user data:",R),s({type:"USER_ERROR",payload:R.message}),null}},[t.currentUser,t.messages,n]);return p.useEffect(()=>{t.error&&Z.error(t.error)},[t.error]),r.jsx(cu.Provider,{value:{...t,getUsers:l,getUser:a,updateProfile:d,uploadPhoto:f,requestPhotoPermission:v,updatePhotoPermission:g,getLikedUsers:h,isUserLiked:b,likeUser:$,unlikeUser:T,sendMessage:F,getBlockedUsers:M,blockUser:E,unblockUser:U,reportUser:A,clearError:D,refreshUserData:w},children:e})}function Bn(){const e=p.useContext(cu);if(!e)throw new Error("useUser must be used within UserProvider");return e}const lu=p.createContext(),v1=({children:e})=>{const[t,s]=p.useState(()=>{const i=localStorage.getItem("theme");return i||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,"dark")});p.useEffect(()=>{const i=window.document.documentElement;i.classList.remove("light","dark"),i.classList.add(t),localStorage.setItem("theme",t)},[t]);const n=()=>{s(i=>i==="light"?"dark":"light")},o=i=>{["light","dark","system"].includes(i)&&s(i)};return r.jsx(lu.Provider,{value:{theme:t,toggleTheme:n,setTheme:o},children:e})},nc=()=>{const e=p.useContext(lu);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e},jo=Ze.create("ModalContext"),du=p.createContext(void 0);function _1({children:e}){const[t,s]=p.useState(null),[n,o]=p.useState(!1),[i,c]=p.useState(null),l=!!i,u=p.useCallback(v=>{jo.debug("Opening chat with recipient:",(v==null?void 0:v.nickname)||(v==null?void 0:v._id)),s(v),setTimeout(()=>o(!0),Gn.ANIMATIONS.CHAT_OPEN_DELAY_MS)},[]),h=p.useCallback(()=>{jo.debug("Closing chat"),o(!1)},[]),a=p.useCallback(v=>{jo.debug("Opening profile modal for user:",v),c(v)},[]),d=p.useCallback(()=>{jo.debug("Closing profile modal"),c(null)},[]);p.useEffect(()=>{const v=g=>{const{recipient:b}=g.detail;b&&b._id&&u(b)};return window.addEventListener("openChat",v),()=>{window.removeEventListener("openChat",v)}},[u]);const f={chatRecipient:t,isChatOpen:n,openChat:u,closeChat:h,profileModalUserId:i,isProfileModalOpen:l,openProfileModal:a,closeProfileModal:d};return r.jsx(du.Provider,{value:f,children:e})}function uu(){const e=p.useContext(du);if(e===void 0)throw new Error("useModals must be used within a ModalProvider");return e}class hu{constructor(){this.cleanupFuncs=new Set}add(t){return typeof t=="function"&&this.cleanupFuncs.add(t),t}addAll(t){t.forEach(s=>this.add(s))}cleanup(){this.cleanupFuncs.forEach(t=>{try{t()}catch(s){console.error("Cleanup error:",s)}}),this.cleanupFuncs.clear()}setTimeout(t,s){const n=setTimeout(t,s),o=()=>clearTimeout(n);return this.add(o),o}setInterval(t,s){const n=setInterval(t,s),o=()=>clearInterval(n);return this.add(o),o}addSubscription(t,s){return this.add(s),s}}const Yi=Ze.create("NotificationContext"),fu=p.createContext(),w1={notifications:[],unreadCount:0,loading:!1,socketConnected:!1};function b1(e,{type:t,payload:s}){switch(t){case"SET_LOADING":return{...e,loading:s};case"SET_NOTIFICATIONS":return{...e,notifications:s,unreadCount:s.filter(n=>!n.read).length};case"ADD_NOTIFICATION":return e.notifications.some(n=>(n._id||n.id)===(s._id||s.id))?e:{...e,notifications:[s,...e.notifications],unreadCount:e.unreadCount+(s.read?0:1)};case"MARK_AS_READ":return{...e,notifications:e.notifications.map(n=>(n._id||n.id)===s?{...n,read:!0}:n),unreadCount:Math.max(0,e.unreadCount-(e.notifications.find(n=>(n._id||n.id)===s&&!n.read)?1:0))};case"MARK_ALL_AS_READ":return{...e,notifications:e.notifications.map(n=>({...n,read:!0})),unreadCount:0};case"SET_SOCKET_CONNECTED":return{...e,socketConnected:s};default:return e}}function x1({children:e}){const{user:t,isAuthenticated:s}=Xt(),{openProfileModal:n}=uu(),o=ps(),[i,c]=p.useReducer(b1,w1),l=p.useRef(new hu);p.useEffect(()=>{const g=l.current;return()=>{g.cleanup()}},[]);const u=p.useCallback(async()=>{c({type:"SET_LOADING",payload:!0});try{const g=await Ls.getNotifications();return c({type:"SET_NOTIFICATIONS",payload:g}),g}catch(g){return Yi.error("fetchNotifications",g),[]}finally{c({type:"SET_LOADING",payload:!1})}},[]);p.useEffect(()=>{Ls.setNavigate(o)},[o]),p.useEffect(()=>{var $;if(!s||!t){c({type:"SET_NOTIFICATIONS",payload:[]});return}const g=(($=t.settings)==null?void 0:$.notifications)??{};Ls.initialize({notifications:g}),u();const b=Ls.addListener(({notifications:T})=>{c({type:"SET_NOTIFICATIONS",payload:T})});return()=>b()},[s,t,u]),p.useEffect(()=>{if(!s)return;const g=(E,U)=>{c({type:"ADD_NOTIFICATION",payload:E})},b=()=>{c({type:"SET_SOCKET_CONNECTED",payload:!0}),u()},$=()=>{c({type:"SET_SOCKET_CONNECTED",payload:!1})},T=l.current,F=[T.addSubscription("notification",Ae.on("notification",E=>g(E))),T.addSubscription("newMessage",Ae.on("newMessage",E=>g(E))),T.addSubscription("newLike",Ae.on("newLike",E=>g(E))),T.addSubscription("photoPermissionRequest",Ae.on("photoPermissionRequestReceived",E=>{Yi.info("Received photo permission request notification:",E),g(E)})),T.addSubscription("photoPermissionResponse",Ae.on("photoPermissionResponseReceived",E=>{Yi.info("Received photo permission response notification:",E),g(E)})),T.addSubscription("newComment",Ae.on("newComment",E=>g(E))),T.addSubscription("incomingCall",Ae.on("incomingCall",E=>g(E))),T.addSubscription("connect",Ae.on("connect",b)),T.addSubscription("disconnect",Ae.on("disconnect",$))];c({type:"SET_SOCKET_CONNECTED",payload:Ae.isConnected()});const M=setInterval(()=>{const E=Ae.isConnected();c({type:"SET_SOCKET_CONNECTED",payload:E})},1e3);return()=>{clearInterval(M),F.forEach(E=>{typeof E=="function"&&E()})}},[s,u]),p.useEffect(()=>{const g=l.current;if(s&&!i.socketConnected)return g.setInterval(()=>{var $;Ae.isConnected()||(u(),($=Ae.reconnect)==null||$.call(Ae))},3e4)},[s,i.socketConnected,u]);const h=p.useCallback(()=>{const g=Ls.addTestNotification();c({type:"ADD_NOTIFICATION",payload:g})},[]),a=p.useCallback(g=>{c({type:"MARK_AS_READ",payload:g}),Ls.markAsRead(g)},[]),d=p.useCallback(()=>{c({type:"MARK_ALL_AS_READ"}),Ls.markAllAsRead()},[]),f=p.useCallback(g=>{var M,E,U,A,D,w,N;if(!g)return;const b=g._id||g.id;g.read||a(b);const $=g.type,T=g.data||{},F=((M=g.sender)==null?void 0:M._id)||((E=T.sender)==null?void 0:E._id)||((U=T.requester)==null?void 0:U._id)||((A=T.user)==null?void 0:A._id)||((D=T.owner)==null?void 0:D._id)||$==="match"&&((w=T.matchedUser)==null?void 0:w._id)||$==="comment"&&((N=T.commenter)==null?void 0:N._id);($==="message"||$==="newMessage")&&F?o(`/messages/${F}`):F&&n&&n(F)},[a,o,n]),v=p.useMemo(()=>({notifications:i.notifications,unreadCount:i.unreadCount,loading:i.loading,socketConnected:i.socketConnected,fetchNotifications:u,addTestNotification:h,markAsRead:a,markAllAsRead:d,handleNotificationClick:f}),[i,u,h,a,d,f]);return r.jsx(fu.Provider,{value:v,children:e})}function gu(){const e=p.useContext(fu);if(!e)throw new Error("useNotifications must be used within NotificationProvider");return e}const Vt=Ze.create("ChatService"),S1=Sn.TTL.MESSAGES,C1=Sn.TTL.CONVERSATIONS,k1=Nt.TIMEOUT.INIT,N1=Nt.TIMEOUT.ACK,E1=Nn.FETCH.MESSAGES,T1=Nn.MESSAGE.DEDUPLICATION,A1=Nn.MESSAGE.PENDING_EXPIRY,Ki="mandarin_file_urls",Ji="mandarin_file_urls_by_hash";function rl(e){return typeof e=="string"&&/^[0-9a-fA-F]{24}$/.test(e)}function j1(){try{const e=gs();if(!e)return null;const t=JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")));return t.id||t.sub||t.user&&(t.user._id||t.user._id)}catch{return null}}class I1{constructor(){this.initialized=!1,this.user=null,this.initPromise=null,this.activeChats=new Map,this.eventListeners=new Map,this.messageCache=new Map,this.messageCacheTs=new Map,this.conversationsCache=null,this.conversationsTs=0,this.processed=new Set,this.pendingMessages=[],this.socketUnsubscribers=[],this._registerSocketHandlers()}_registerSocketHandlers(){Ae.on("connect",()=>{Vt.info("Socket connected – processing pending messages"),this._processPending(),this._notify("connectionChanged",{connected:!0})}),Ae.on("disconnect",()=>{Vt.warn("Socket disconnected"),this._notify("connectionChanged",{connected:!1})})}async initialize(t){var s;return this.initialized&&((s=this.user)==null?void 0:s._id)===(t==null?void 0:t._id)?!0:this.initPromise?this.initPromise:(this.initPromise=new Promise(async(n,o)=>{const i=setTimeout(()=>o(new Error("Init timeout")),k1);try{let c=t==null?void 0:t._id;if(rl(c)||(c=j1()),!rl(c))throw new Error("Invalid user ID");this.user={...t,_id:c,id:c},Vt.info(`Initializing ChatService for ${c}`);const l=gs();if(this._setupSocketListeners(),l){Ae.init(c,l);const u=5e3,h=Date.now();for(;!Ae.isConnected()&&Date.now()-h<u;)await new Promise(a=>setTimeout(a,100));Ae.isConnected()?Vt.info("Socket connected successfully"):Vt.warn("Socket connection timeout, proceeding anyway")}this.initialized=!0,clearTimeout(i),n(!0)}catch(c){clearTimeout(i),Vt.error("Initialization failed:",c),this.initialized=!0,n(!0)}finally{this.initPromise=null}}),this.initPromise)}_setupSocketListeners(){this._cleanupSocketListeners();const t=(s,n)=>{const o=Ae.on(s,n);this.socketUnsubscribers.push(o)};t("connect",()=>{Vt.info("Socket connected"),this._processPending(),this._notify("connectionChanged",{connected:!0})}),t("disconnect",()=>{Vt.warn("Socket disconnected"),this._notify("connectionChanged",{connected:!1})}),t("messageReceived",s=>this._onSocketMessage(s,!1)),t("messageSent",s=>this._onSocketMessage(s,!0)),t("messageError",s=>this._notify("messageError",s)),t("typing",s=>{s&&s.userId&&this._notify("userTyping",s)})}_cleanupSocketListeners(){this.socketUnsubscribers.forEach(t=>t()),this.socketUnsubscribers=[]}_onSocketMessage(t,s){s?t._id:t.sender;const n=s?t.recipient:t.sender;this._cacheMessage(n,t),this._notify(s?"messageUpdated":"messageReceived",t)}_cacheMessage(t,s){if(!t||!s)return;const n=`${s._id||s.tempId}-${t}`;if(this.processed.has(n))return;this.processed.add(n),setTimeout(()=>this.processed.delete(n),T1);let o=this.messageCache.get(t)||[];const i=o.findIndex(c=>c._id===s._id||c.tempId===s.tempId);i>=0?o[i]={...o[i],...s}:o.push(s),o.sort((c,l)=>new Date(c.createdAt)-new Date(l.createdAt)),this.messageCache.set(t,o),this.messageCacheTs.set(t,Date.now())}async getMessages(t,s=1,n=20){var h;if(await this.initialize(this.user||{}),!t)return{messages:[],partner:null};const o=Date.now(),i=this.messageCache.get(t)||[],c=(h=this.partnerCache)==null?void 0:h.get(t),l=o-(this.messageCacheTs.get(t)||0)<S1;if(s===1&&i.length&&l&&c)return Vt.debug(`getMessages: using cache for ${t}`),{messages:i,partner:c};try{Vt.debug(`getMessages: fetching page ${s} for ${t}`);const a=await Promise.race([qe.get(`/messages/${t}`,{page:s,limit:n,_t:o}),new Promise((d,f)=>setTimeout(()=>f(new Error("Timeout")),E1))]);if(a.success&&(a.partner&&(this.partnerCache||(this.partnerCache=new Map),this.partnerCache.set(t,a.partner)),Array.isArray(a.data))){const d=a.data.map(f=>({...f,tempId:f.tempId||null,createdAt:f.createdAt||new Date().toISOString()})).sort((f,v)=>new Date(f.createdAt)-new Date(v.createdAt));return s===1&&(this.messageCache.set(t,d),this.messageCacheTs.set(t,o)),{messages:d,partner:a.partner}}throw new Error(a.error||"Invalid response")}catch(a){return Vt.warn(`getMessages failed, fallback to cache: ${a.message}`),{messages:i,partner:c}}}async sendMessage(t,s,n="text",o={}){if(await this.initialize(this.user||{}),!t)throw new Error("Recipient required");const i=`temp-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,c={tempId:i,_id:i,sender:this.user._id,recipient:t,content:s,type:n,metadata:o,createdAt:new Date().toISOString(),status:"sending",pending:!0};return this._cacheMessage(t,c),Ae.isConnected()?new Promise((l,u)=>{let h=!1;const a=g=>{g.tempId===i&&(h=!0,this._cacheMessage(t,{...g,status:"sent",pending:!1}),f(),l(g))},d=g=>{g.tempId===i&&(h=!0,this._cacheMessage(t,{...c,status:"error",error:g.error||g.message}),f(),u(g))},f=()=>{clearTimeout(v),Ae.off("messageSent",a),Ae.off("messageError",d)};Ae.on("messageSent",a),Ae.on("messageError",d),Ae.emit("sendMessage",{recipientId:t,content:s,type:n,metadata:o,tempId:i});const v=setTimeout(()=>{h||(f(),Vt.warn(`Socket ack timeout for ${i}, falling back to API`),this.pendingMessages.push({recipientId:t,content:s,type:n,metadata:o,tempId:i}),this._sendViaApi(t,s,n,o,i).then(l).catch(u))},N1)}):(Vt.warn("Socket disconnected – sending via API"),this.pendingMessages.push({recipientId:t,content:s,type:n,metadata:o,tempId:i}),this._sendViaApi(t,s,n,o,i))}async _sendViaApi(t,s,n,o,i){this._cacheMessage(t,{tempId:i,status:"sending-api"});try{const c=await qe.post("/messages",{recipient:t,content:s,type:n,metadata:o});if(!c.success||!c.data)throw new Error(c.error||"API send failed");const l={...c.data,tempId:i,status:"sent",pending:!1};return this._cacheMessage(t,l),l}catch(c){throw Vt.error(`API sendMessage error: ${c.message}`),this._cacheMessage(t,{tempId:i,status:"error",error:c.message}),c}}_processPending(){if(!Ae.isConnected())return;const t=[...this.pendingMessages];this.pendingMessages=[],t.forEach(s=>{Date.now()-s.timestamp>A1||Ae.emit("sendMessage",{recipientId:s.recipientId||s.recipient,content:s.content,type:s.type,metadata:s.metadata,tempId:s.tempId})})}async markConversationRead(t){if(!this.initialized||!t)return null;try{const s=await qe.put(`/messages/conversation/${t}/read`),o=(this.messageCache.get(t)||[]).map(i=>i.sender===t?{...i,read:!0,readAt:new Date().toISOString()}:i);return this.messageCache.set(t,o),s}catch(s){return Vt.error(`markConversationRead failed: ${s.message}`),null}}async getConversations(){await this.initialize(this.user||{});const t=Date.now();if(this.conversationsCache&&t-this.conversationsTs<C1)return this.conversationsCache;const s=[this._fetchDirect(),qe.get("/messages/conversations").then(n=>{if(n.success)return n.data;throw new Error})];try{const n=await Promise.any(s);if(Array.isArray(n)){const o=await this._enhanceWithPhotoRequests(n);return this.conversationsCache=o,this.conversationsTs=t,o}throw new Error("Bad data")}catch{return this.conversationsCache||[]}}async _enhanceWithPhotoRequests(t){try{const s=await qe.get("/users/photos/permissions",{status:"pending"});console.log("Pending photo permissions response:",s);const o=(s.data||[]).reduce((i,c)=>{var u;const l=((u=c.requestedBy)==null?void 0:u._id)||c.requestedBy;return i[l]=(i[l]||0)+1,i},{});return console.log("Pending photo request counts map:",o),t.map(i=>({...i,pendingPhotoRequests:o[i.user._id]||0}))}catch(s){return Vt.warn("Failed to enhance conversations with photo requests:",s),t}}async _fetchDirect(){try{const t=await qe.get("/messages/conversations",{},{headers:{"Cache-Control":"no-cache"}});return Array.isArray(t.data)?t.data:[]}catch(t){return Vt.error("Failed to fetch conversations directly:",t),[]}}sendTypingIndicator(t){return this.initialized&&Ae.isConnected()&&t?typeof Ae.sendTyping=="function"?Ae.sendTyping(t):Ae.emit("typing",{recipientId:t}):!1}on(t,s){return this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(s),()=>this.eventListeners.get(t).delete(s)}_notify(t,s){const n=this.eventListeners.get(t);n&&n.forEach(o=>{try{o(s)}catch(i){Vt.error(`Listener ${t} error:`,i)}})}isReady(){var t;return this.initialized&&!!((t=this.user)!=null&&t._id)}isConnected(){const t=Ae.isConnected();return Vt.debug(`ChatService.isConnected: ${t}`),t}_initFileCache(){if(!this._fileUrlCache){Vt.debug("Initializing file URL caches"),this._fileUrlCache={},this._fileUrlCacheByHash={};try{const t=localStorage.getItem(Ki);if(t){const n=JSON.parse(t);n&&typeof n=="object"&&(this._fileUrlCache=n,Vt.debug(`Restored ${Object.keys(n).length} file URLs from localStorage`))}const s=localStorage.getItem(Ji);if(s){const n=JSON.parse(s);n&&typeof n=="object"&&(this._fileUrlCacheByHash=n,Vt.debug(`Restored ${Object.keys(n).length} file URLs by hash`))}else Object.keys(this._fileUrlCache).length>0&&this._rebuildHashCache()}catch(t){Vt.error("Failed to load persisted file URLs",t),this._fileUrlCache={},this._fileUrlCacheByHash={}}}}_rebuildHashCache(){Vt.debug("Building hash-based cache from ID-based cache"),Object.entries(this._fileUrlCache).forEach(([t,s])=>{if(s!=null&&s.url){const n=s.hash||this._generateMessageHash(s);n&&(this._fileUrlCacheByHash[n]={...s,id:t})}}),this._persistFileCaches()}_generateMessageHash(t){if(!t)return"";const s=t.fileName||"",n=t.timestamp?new Date(t.timestamp).toISOString().substring(0,16):"";return`${s}-${n}`}_persistFileCaches(){try{localStorage.setItem(Ki,JSON.stringify(this._fileUrlCache)),localStorage.setItem(Ji,JSON.stringify(this._fileUrlCacheByHash))}catch(t){Vt.error("Failed to persist file URL caches",t)}}getFileUrl(t){return this._initFileCache(),this._fileUrlCache[t]||null}getFileUrlByHash(t){return this._initFileCache(),this._fileUrlCacheByHash[t]||null}addFileUrl(t,s){if(this._initFileCache(),!t||!(s!=null&&s.url))return;const n={...s,timestamp:s.timestamp||new Date().toISOString()};n.hash||(n.hash=this._generateMessageHash(n)),this._fileUrlCache[t]=n,n.hash&&(this._fileUrlCacheByHash[n.hash]={...n,id:t}),this._persistFileCaches()}removeFileUrl(t){this._initFileCache();const s=this._fileUrlCache[t];s&&(s.hash&&this._fileUrlCacheByHash[s.hash]&&delete this._fileUrlCacheByHash[s.hash],delete this._fileUrlCache[t],this._persistFileCaches())}clearFileCaches(){this._fileUrlCache={},this._fileUrlCacheByHash={};try{localStorage.removeItem(Ki),localStorage.removeItem(Ji)}catch(t){Vt.error("Failed to clear file URL caches from localStorage",t)}}cleanup(){this._cleanupSocketListeners(),this.eventListeners.clear(),this.messageCache.clear(),this.messageCacheTs.clear(),this.pendingMessages=[],this.initialized=!1,this.user=null,this.conversationsCache=null,this.conversationsTs=0,this.processed.clear(),Vt.info("ChatService cleaned up")}}const Et=new I1,rs=Ze.create("ChatContext"),pu=p.createContext();function $1({children:e}){const{user:t,isAuthenticated:s}=Xt(),[n,o]=p.useState(!1),[i,c]=p.useState(!1),[l,u]=p.useState(null),[h,a]=p.useState(!1),[d,f]=p.useState([]),[v,g]=p.useState([]),[b,$]=p.useState(null),[T,F]=p.useState(!1),[M,E]=p.useState(!0),[U,A]=p.useState(1),[D,w]=p.useState(!1),[N,P]=p.useState(!1),x=p.useRef(!0),k=p.useRef(new hu),R=p.useRef(null);p.useEffect(()=>(x.current=!0,(async()=>{if(!(!s||!(t!=null&&t._id))){c(!0),u(null);try{if(rs.info("Initializing chat service..."),await Et.initialize(t),x.current){o(!0);const he=Et.isConnected();a(he),rs.info(`Initial connection status: ${he}`),j()}}catch(he){rs.error("Failed to initialize chat service:",he),x.current&&(u(he.message||"Failed to initialize chat"),o(!0))}finally{x.current&&c(!1)}}})(),()=>{x.current=!1,I(),k.current.cleanup()}),[s,t]);const j=p.useCallback(()=>{k.current.cleanup(),k.current.addCleanup(Et.on("connectionChanged",({connected:Q})=>{x.current&&a(Q)})),k.current.addCleanup(Et.on("messageReceived",Q=>{x.current&&(b===Q.sender&&(f(he=>he.some(re=>re._id===Q._id)?he:[...he,Q].sort((re,_e)=>new Date(re.createdAt)-new Date(_e.createdAt))),Et.markConversationRead(Q.sender)),S(Q))})),k.current.addCleanup(Et.on("messageSent",Q=>{x.current&&(b===Q.recipient&&C(Q),S(Q))})),k.current.addCleanup(Et.on("messageError",Q=>{x.current&&(Q.tempId&&f(he=>he.map(re=>re.tempId===Q.tempId?{...re,status:"error",error:!0,errorMessage:Q.error}:re)),P(!1),u(Q.error||"Error sending message"))})),k.current.addCleanup(Et.on("userTyping",Q=>{x.current&&b===Q.userId&&(F(!0),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{x.current&&F(!1)},3e3))}))},[b]),I=p.useCallback(()=>{k.current.cleanup(),R.current&&(clearTimeout(R.current),R.current=null)},[]),S=p.useCallback(Q=>{g(he=>{const re=he.findIndex(ke=>ke._id===(Q.recipient===(t==null?void 0:t._id)?Q.sender:Q.recipient));if(re===-1)return he;const _e=[...he];return _e[re]={..._e[re],lastMessage:Q,unreadCount:b===_e[re]._id?0:(_e[re].unreadCount||0)+1},_e.sort((ke,Be)=>{var Le,Me;const Oe=(Le=ke.lastMessage)!=null&&Le.createdAt?new Date(ke.lastMessage.createdAt):new Date(0);return((Me=Be.lastMessage)!=null&&Me.createdAt?new Date(Be.lastMessage.createdAt):new Date(0))-Oe})})},[b,t]),C=p.useCallback(Q=>{f(he=>he.map(re=>re._id===Q._id||re.tempId===Q.tempId?{...re,...Q,status:"sent",pending:!1,error:!1}:re))},[]),G=p.useCallback(async()=>{if(!n||!s)return rs.warn("Not initialized or authenticated, can't get conversations"),[];try{rs.info("ChatContext: Getting conversations from service");const Q=await Et.getConversations();return rs.info(`ChatContext: Got ${(Q==null?void 0:Q.length)||0} conversations from service`),x.current&&Array.isArray(Q)?(rs.info("ChatContext: Setting conversations in state"),g(Q),Q):(rs.warn("ChatContext: Got non-array or component unmounted, returning empty array"),[])}catch(Q){return rs.error("Failed to fetch conversations:",Q),[]}},[n,s]),V=p.useCallback(Q=>{if(rs.info(`setActiveConvo called with recipientId: ${Q}, current: ${b}, initialized: ${n}`),Q===b){rs.debug("Already the active conversation, skipping");return}$(Q),Q&&(n?(rs.info(`Loading messages for conversation: ${Q}`),Et.markConversationRead(Q),A(1),E(!0),F(!1)):rs.warn(`Chat not initialized yet, will load messages for ${Q} when ready`))},[b,n]),L=p.useCallback(async(Q,he=!1)=>{if(!Q||!n||i&&!he)return rs.debug(`Skipping loadMessages - recipientId: ${Q}, initialized: ${n}, loading: ${i}, forceRefresh: ${he}`),d;c(!0),u(null);try{const re=await Et.getMessages(Q),_e=(re==null?void 0:re.messages)||[];if(!x.current)return[];if(b===Q){const ke=[],Be=new Set;[..._e].reverse().forEach(Oe=>{Be.has(Oe._id)||(ke.push(Oe),Be.add(Oe._id))}),f(ke),E(_e.length>=20),A(1)}return _e}catch(re){return rs.error("Failed to load messages:",re),x.current&&u(re.message||"Failed to load messages"),[]}finally{x.current&&c(!1)}},[b,n,i,d]);p.useEffect(()=>{n&&b&&(rs.info(`Loading messages for conversation: ${b}`),L(b))},[n,b,L]);const X=p.useCallback(async()=>{if(!b||!n||D||!M)return[];w(!0);try{const Q=U+1,he=await Et.getMessages(b,Q),re=(he==null?void 0:he.messages)||[];return x.current?(re.length>0?(f(_e=>{const ke=[..._e],Be=new Set(_e.map(Oe=>Oe._id));return re.forEach(Oe=>{Be.has(Oe._id)||(ke.push(Oe),Be.add(Oe._id))}),ke.sort((Oe,Se)=>new Date(Oe.createdAt)-new Date(Se.createdAt))}),E(re.length>=20),A(Q)):E(!1),re):[]}catch(Q){return rs.error("Failed to load more messages:",Q),u("Failed to load more messages"),[]}finally{w(!1)}},[b,n,D,M,U]),q=p.useCallback(async(Q,he="text",re=null)=>{if(!b||!n||!h){const _e="Cannot send message: Chat is not ready";throw rs.error(_e),new Error(_e)}P(!0);try{const _e=new Date;if(d.some(Le=>Le.content===Q&&Le.type===he&&Le.sender===(t==null?void 0:t._id)&&Le.recipient===b&&_e-new Date(Le.createdAt)<5e3))return rs.debug("Skipping duplicate message send"),P(!1),null;const Be=`temp-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,Oe={_id:Be,tempId:Be,sender:t._id,recipient:b,content:Q,type:he,metadata:re||{},createdAt:new Date().toISOString(),status:"sending",pending:!0};f(Le=>[...Le,Oe].sort((Me,He)=>new Date(Me.createdAt)-new Date(He.createdAt)));const Se=await Et.sendMessage(b,Q,he,re);return x.current&&(f(Le=>Le.map(Me=>Me.tempId===Be?{...Me,...Se,status:"sent",pending:!1}:Me)),P(!1)),Se}catch(_e){throw rs.error("Failed to send message:",_e),x.current&&(u(_e.message||"Failed to send message"),P(!1)),_e}},[b,n,h,d,t]),z=p.useCallback(()=>{b&&n&&h&&Et.sendTypingIndicator(b)},[b,n,h]),K=p.useCallback(()=>{u(null)},[]),W=p.useCallback(()=>b?L(b,!0):Promise.resolve([]),[b,L]),H=p.useCallback(Q=>Q&&n?Et.markConversationRead(Q):Promise.resolve(null),[n]),ne={initialized:n,loading:i,error:l,isConnected:h,messages:d,conversations:v,activeConversation:b,typingStatus:T,hasMore:M,loadingMore:D,sending:N,user:t,isAuthenticated:s,getConversations:G,setActiveConversation:V,loadMessages:L,loadMoreMessages:X,sendMessage:q,sendTyping:z,resetError:K,refresh:W,markConversationRead:H};return r.jsx(pu.Provider,{value:ne,children:e})}const P1=()=>{const e=p.useContext(pu);if(!e)throw new Error("useChat must be used within a ChatProvider");return e},R1=(e,t,s,n)=>{var i,c,l,u;const o=[s,{code:t,...n||{}}];if((c=(i=e==null?void 0:e.services)==null?void 0:i.logger)!=null&&c.forward)return e.services.logger.forward(o,"warn","react-i18next::",!0);Zn(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),(u=(l=e==null?void 0:e.services)==null?void 0:l.logger)!=null&&u.warn?e.services.logger.warn(...o):console!=null&&console.warn&&console.warn(...o)},ol={},ja=(e,t,s,n)=>{Zn(s)&&ol[s]||(Zn(s)&&(ol[s]=new Date),R1(e,t,s,n))},mu=(e,t)=>()=>{if(e.isInitialized)t();else{const s=()=>{setTimeout(()=>{e.off("initialized",s)},0),t()};e.on("initialized",s)}},Ia=(e,t,s)=>{e.loadNamespaces(t,mu(e,s))},il=(e,t,s,n)=>{if(Zn(s)&&(s=[s]),e.options.preload&&e.options.preload.indexOf(t)>-1)return Ia(e,s,n);s.forEach(o=>{e.options.ns.indexOf(o)<0&&e.options.ns.push(o)}),e.loadLanguages(t,mu(e,n))},M1=(e,t,s={})=>!t.languages||!t.languages.length?(ja(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:s.lng,precheck:(n,o)=>{var i;if(((i=s.bindI18n)==null?void 0:i.indexOf("languageChanging"))>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!o(n.isLanguageChangingTo,e))return!1}}),Zn=e=>typeof e=="string",L1=e=>typeof e=="object"&&e!==null,O1=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,F1={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},D1=e=>F1[e],B1=e=>e.replace(O1,D1);let $a={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:B1};const U1=(e={})=>{$a={...$a,...e}},q1=()=>$a;let yu;const z1=e=>{yu=e},H1=()=>yu,V1={type:"3rdParty",init(e){U1(e.options.react),z1(e)}},W1=p.createContext();class G1{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(s=>{this.usedNamespaces[s]||(this.usedNamespaces[s]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Y1=(e,t)=>{const s=p.useRef();return p.useEffect(()=>{s.current=e},[e,t]),s.current},vu=(e,t,s,n)=>e.getFixedT(t,s,n),K1=(e,t,s,n)=>p.useCallback(vu(e,t,s,n),[e,t,s,n]),Ht=(e,t={})=>{var E,U,A,D;const{i18n:s}=t,{i18n:n,defaultNS:o}=p.useContext(W1)||{},i=s||n||H1();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new G1),!i){ja(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const w=(P,x)=>Zn(x)?x:L1(x)&&Zn(x.defaultValue)?x.defaultValue:Array.isArray(P)?P[P.length-1]:P,N=[w,{},!1];return N.t=w,N.i18n={},N.ready=!1,N}(E=i.options.react)!=null&&E.wait&&ja(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const c={...q1(),...i.options.react,...t},{useSuspense:l,keyPrefix:u}=c;let h=o||((U=i.options)==null?void 0:U.defaultNS);h=Zn(h)?[h]:h||["translation"],(D=(A=i.reportNamespaces).addUsedNamespaces)==null||D.call(A,h);const a=(i.isInitialized||i.initializedStoreOnce)&&h.every(w=>M1(w,i,c)),d=K1(i,t.lng||null,c.nsMode==="fallback"?h:h[0],u),f=()=>d,v=()=>vu(i,t.lng||null,c.nsMode==="fallback"?h:h[0],u),[g,b]=p.useState(f);let $=h.join();t.lng&&($=`${t.lng}${$}`);const T=Y1($),F=p.useRef(!0);p.useEffect(()=>{const{bindI18n:w,bindI18nStore:N}=c;F.current=!0,!a&&!l&&(t.lng?il(i,t.lng,h,()=>{F.current&&b(v)}):Ia(i,h,()=>{F.current&&b(v)})),a&&T&&T!==$&&F.current&&b(v);const P=()=>{F.current&&b(v)};return w&&(i==null||i.on(w,P)),N&&(i==null||i.store.on(N,P)),()=>{F.current=!1,i&&(w==null||w.split(" ").forEach(x=>i.off(x,P))),N&&i&&N.split(" ").forEach(x=>i.store.off(x,P))}},[i,$]),p.useEffect(()=>{F.current&&a&&b(f)},[i,u,a]);const M=[g,i,a];if(M.t=g,M.i18n=i,M.ready=a,a||!a&&!l)return M;throw new Promise(w=>{t.lng?il(i,t.lng,h,()=>w()):Ia(i,h,()=>w())})},qr=Ze.create("LanguageContext"),_u=p.createContext();function J1({children:e}){const{i18n:t}=Ht(),[s,n]=p.useState(localStorage.getItem("language")||"en"),[o,i]=p.useState(s==="he"),c=a=>{try{qr.info("Changing language to:",a),t.changeLanguage(a),n(a),i(a==="he"),localStorage.setItem("language",a),document.documentElement.dir=a==="he"?"rtl":"ltr",document.documentElement.lang=a,document.body.classList.remove("rtl","ltr"),document.body.classList.add(a==="he"?"rtl":"ltr"),window.dispatchEvent(new CustomEvent("languageDirectionChanged",{detail:{isRTL:a==="he",language:a}})),qr.info("Language changed successfully to:",a,"RTL:",a==="he")}catch(d){qr.error("Error changing language:",d)}};p.useEffect(()=>{const a=localStorage.getItem("language");if(a){c(a);return}(async()=>{try{const f=Intl.DateTimeFormat().resolvedOptions().timeZone,v=f==="Asia/Jerusalem",g=navigator.language.split("-")[0],b=g==="he"||navigator.language==="he-IL",T=new URLSearchParams(window.location.search).get("country"),F=T==="IL"||T==="Israel",M=window.__userCountry==="IL"||window.__userCountry==="Israel",E=v||b||F||M;qr.info("Israeli user detection:",{timeZone:f,isIsraeliTimeZone:v,browserLanguage:g,isHebrewLanguage:b,countryParam:T,isIsraeliParam:F,isIsraeliIP:M,result:E}),c(E||g==="he"?"he":"en")}catch(f){qr.error("Error detecting user location:",f);const g=navigator.language.split("-")[0]==="he"?"he":"en";c(g)}})()},[]);const l=()=>{var a,d;return((d=(a=t.options)==null?void 0:a.supportedLngs)==null?void 0:d.filter(f=>f!=="cimode"))||["en","he"]},u=a=>a==="en"?"English":a==="he"?"עברית":a,h={language:s,isRTL:o,changeLanguage:c,t:t.t,supportedLanguages:l(),getLanguageDisplayName:u};return r.jsx(_u.Provider,{value:h,children:e})}function ss(){const e=p.useContext(_u);if(!e)throw new Error("useLanguage must be used within a LanguageProvider");return e}const al=Ze.create("useApi"),wu=(e={})=>{const[t,s]=p.useState(!1),[n,o]=p.useState(null),[i,c]=p.useState(null),l=p.useRef({}),u=p.useCallback(()=>{Object.values(l.current).forEach(F=>{typeof F=="function"&&F()}),l.current={}},[]),h=p.useCallback(async(F,M={})=>{const{onSuccess:E,onError:U,key:A="default"}=M;s(!0),o(null);try{const D=await F();if(!D)return e.logErrors!==!1&&al.warn("API response is null or undefined"),delete l.current[A],null;if(!D.success)throw new Error(D.error||"API request failed");return D.data!==void 0&&c(D.data),delete l.current[A],E&&E(D.data),D.data}catch(D){const w=D.error||D.message||"An error occurred",P=A&&typeof A=="string"&&["/users/photo-permissions","/users/photo-permissions/pending","/photo-permissions","/photo-access","/blocked"].some(x=>A.includes(x));return!P&&!D.silenced&&o(w),delete l.current[A],U&&U(w),e.logErrors!==!1&&!P&&!D.silenced&&al.error(`API error: ${w}`,D),null}finally{s(!1)}},[e.logErrors]),a=(F={})=>{const M={...F};if(!M.Authorization&&!M["x-auth-token"]){const E=localStorage.getItem("token")||sessionStorage.getItem("token")||localStorage.getItem("authToken")||sessionStorage.getItem("authToken");E&&(M.Authorization=`Bearer ${E}`,M["x-auth-token"]=E)}return M},d=p.useCallback((F,M,E={})=>{const U=E.key||F;l.current[U]&&e.cancelDuplicates&&l.current[U]();const{request:A,cancel:D}=qe.createCancelableRequest();return l.current[U]=D,h(()=>{const w=a();return qe.get(F,M,{request:A,headers:w})},{...E,key:U})},[h,e.cancelDuplicates]),f=p.useCallback((F,M,E={})=>{const U=E.key||F;l.current[U]&&e.cancelDuplicates&&l.current[U]();const{request:A,cancel:D}=qe.createCancelableRequest();return l.current[U]=D,h(()=>{const w=a();return qe.post(F,M,{request:A,headers:w})},{...E,key:U})},[h,e.cancelDuplicates]),v=p.useCallback((F,M,E={})=>{const U=E.key||F;l.current[U]&&e.cancelDuplicates&&l.current[U]();const{request:A,cancel:D}=qe.createCancelableRequest();return l.current[U]=D,h(()=>{const w=a();return qe.put(F,M,{request:A,headers:w})},{...E,key:U})},[h,e.cancelDuplicates]),g=p.useCallback((F,M,E={})=>{const U=E.key||F;l.current[U]&&e.cancelDuplicates&&l.current[U]();const{request:A,cancel:D}=qe.createCancelableRequest();return l.current[U]=D,h(()=>{const w=a();return qe.delete(F,M,{request:A,headers:w})},{...E,key:U})},[h,e.cancelDuplicates]),b=p.useCallback((F,M,E,U={})=>{const A=U.key||F;l.current[A]&&e.cancelDuplicates&&l.current[A]();const{request:D,cancel:w}=qe.createCancelableRequest();return l.current[A]=w,h(()=>qe.upload(F,M,E,{request:D}),{...U,key:A})},[h,e.cancelDuplicates]),$=p.useCallback(()=>{o(null)},[]),T=p.useCallback(()=>{s(!1),o(null),c(null)},[]);return{loading:t,error:n,data:i,get:d,post:f,put:v,delete:g,upload:b,clearError:$,reset:T,cancelAllRequests:u}};p.createContext(null);const zr=Ze.create("InactivityTimer"),qn=10*60*1e3;function Q1(){const{logout:e,isAuthenticated:t}=Xt(),s=p.useRef(null),n=p.useRef(Date.now()),o=p.useCallback(()=>{n.current=Date.now(),s.current&&clearTimeout(s.current),t&&(s.current=setTimeout(()=>{zr.info("Auto-logout due to inactivity"),e()},qn))},[t,e]),i=p.useCallback(()=>{const l=Date.now(),u=n.current;l-u>=qn&&(zr.info("Auto-logout due to inactivity"),e())},[e]);p.useEffect(()=>{if(!t)return;const l=["mousedown","mousemove","keypress","keydown","scroll","touchstart","touchmove","click","focus","wheel","DOMMouseScroll","MSPointerDown","MSPointerMove"],u=()=>{o()},h=()=>{if(document.hidden)sessionStorage.setItem("tabHiddenTime",Date.now().toString());else{const f=sessionStorage.getItem("tabHiddenTime");f&&(Date.now()-parseInt(f)>=qn?(zr.info("Auto-logout due to tab being hidden for too long"),e()):o(),sessionStorage.removeItem("tabHiddenTime"))}},a=f=>{sessionStorage.setItem("lastActivity",Date.now().toString())};return(()=>{const f=sessionStorage.getItem("lastActivity");if(f){const v=Date.now()-parseInt(f);if(v>=qn)zr.info("Auto-logout due to inactivity (session restore)"),e();else{const g=qn-v;s.current=setTimeout(()=>{zr.info("Auto-logout due to inactivity"),e()},g)}sessionStorage.removeItem("lastActivity")}})(),o(),l.forEach(f=>{window.addEventListener(f,u,{passive:!0})}),document.addEventListener("visibilitychange",h),window.addEventListener("beforeunload",a),()=>{s.current&&clearTimeout(s.current),l.forEach(f=>{window.removeEventListener(f,u)}),document.removeEventListener("visibilitychange",h),window.removeEventListener("beforeunload",a)}},[t,o,i,e]);const c=p.useCallback(()=>{const l=Date.now(),u=n.current,h=l-u,a=qn-h;return Math.max(0,a)},[]);return{resetTimer:o,getTimeRemaining:c,INACTIVITY_TIMEOUT:qn}}const X1=Ze.create("ErrorBoundary");class bu extends p.Component{constructor(t){super(t),this.state={hasError:!1,errorMessage:"",errorStack:""}}static getDerivedStateFromError(t){return{hasError:!0,errorMessage:t.message||"An unknown error occurred"}}componentDidCatch(t,s){const n=t.message||"An unknown error occurred",o=t.stack||s.componentStack||"";X1.error("ErrorBoundary caught an error",n,o),this.setState({errorMessage:n,errorStack:o})}render(){return this.state.hasError?r.jsxs("div",{className:"error-boundary",children:[r.jsx("h1",{children:"Something went wrong"}),r.jsx("p",{children:"We're sorry, but an error occurred. Please try refreshing the page."}),r.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Refresh Page"}),!1]}):this.props.children}}var Qi={exports:{}},Xi,cl;function Z1(){if(cl)return Xi;cl=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Xi=e,Xi}var Zi,ll;function ey(){if(ll)return Zi;ll=1;var e=Z1();function t(){}function s(){}return s.resetWarningCache=t,Zi=function(){function n(c,l,u,h,a,d){if(d!==e){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function o(){return n}var i={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:o,element:n,elementType:n,instanceOf:o,node:n,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:s,resetWarningCache:t};return i.PropTypes=i,i},Zi}var dl;function ty(){return dl||(dl=1,Qi.exports=ey()()),Qi.exports}var sy=ty();const O=Fn(sy);function ny(e,t){return t.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(n){if(n!=="default"&&!(n in e)){var o=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:function(){return s[n]}})}})}),Object.freeze(e)}function xu(e,t){return new Promise(function(s,n){let o;return ry(e).then(function(i){try{return o=i,s(new Blob([t.slice(0,2),o,t.slice(2)],{type:"image/jpeg"}))}catch(c){return n(c)}},n)})}const ry=e=>new Promise((t,s)=>{const n=new FileReader;n.addEventListener("load",({target:{result:o}})=>{const i=new DataView(o);let c=0;if(i.getUint16(c)!==65496)return s("not a valid JPEG");for(c+=2;;){const l=i.getUint16(c);if(l===65498)break;const u=i.getUint16(c+2);if(l===65505&&i.getUint32(c+4)===1165519206){const h=c+10;let a;switch(i.getUint16(h)){case 18761:a=!0;break;case 19789:a=!1;break;default:return s("TIFF header contains invalid endian")}if(i.getUint16(h+2,a)!==42)return s("TIFF header contains invalid version");const d=i.getUint32(h+4,a),f=h+d+2+12*i.getUint16(h+d,a);for(let v=h+d+2;v<f;v+=12)if(i.getUint16(v,a)==274){if(i.getUint16(v+2,a)!==3)return s("Orientation data type is invalid");if(i.getUint32(v+4,a)!==1)return s("Orientation data count is invalid");i.setUint16(v+8,1,a);break}return t(o.slice(c,c+2+u))}c+=2+u}return t(new Blob)}),n.readAsArrayBuffer(e)});var Yo={},oy={get exports(){return Yo},set exports(e){Yo=e}};(function(e){var t,s,n={};oy.exports=n,n.parse=function(o,i){for(var c=n.bin.readUshort,l=n.bin.readUint,u=0,h={},a=new Uint8Array(o),d=a.length-4;l(a,d)!=101010256;)d--;u=d,u+=4;var f=c(a,u+=4);c(a,u+=2);var v=l(a,u+=2),g=l(a,u+=4);u+=4,u=g;for(var b=0;b<f;b++){l(a,u),u+=4,u+=4,u+=4,l(a,u+=4),v=l(a,u+=4);var $=l(a,u+=4),T=c(a,u+=4),F=c(a,u+2),M=c(a,u+4);u+=6;var E=l(a,u+=8);u+=4,u+=T+F+M,n._readLocal(a,E,h,v,$,i)}return h},n._readLocal=function(o,i,c,l,u,h){var a=n.bin.readUshort,d=n.bin.readUint;d(o,i),a(o,i+=4),a(o,i+=2);var f=a(o,i+=2);d(o,i+=2),d(o,i+=4),i+=4;var v=a(o,i+=8),g=a(o,i+=2);i+=2;var b=n.bin.readUTF8(o,i,v);if(i+=v,i+=g,h)c[b]={size:u,csize:l};else{var $=new Uint8Array(o.buffer,i);if(f==0)c[b]=new Uint8Array($.buffer.slice(i,i+l));else{if(f!=8)throw"unknown compression method: "+f;var T=new Uint8Array(u);n.inflateRaw($,T),c[b]=T}}},n.inflateRaw=function(o,i){return n.F.inflate(o,i)},n.inflate=function(o,i){return o[0],o[1],n.inflateRaw(new Uint8Array(o.buffer,o.byteOffset+2,o.length-6),i)},n.deflate=function(o,i){i==null&&(i={level:6});var c=0,l=new Uint8Array(50+Math.floor(1.1*o.length));l[c]=120,l[c+1]=156,c+=2,c=n.F.deflateRaw(o,l,c,i.level);var u=n.adler(o,0,o.length);return l[c+0]=u>>>24&255,l[c+1]=u>>>16&255,l[c+2]=u>>>8&255,l[c+3]=u>>>0&255,new Uint8Array(l.buffer,0,c+4)},n.deflateRaw=function(o,i){i==null&&(i={level:6});var c=new Uint8Array(50+Math.floor(1.1*o.length)),l=n.F.deflateRaw(o,c,l,i.level);return new Uint8Array(c.buffer,0,l)},n.encode=function(o,i){i==null&&(i=!1);var c=0,l=n.bin.writeUint,u=n.bin.writeUshort,h={};for(var a in o){var d=!n._noNeed(a)&&!i,f=o[a],v=n.crc.crc(f,0,f.length);h[a]={cpr:d,usize:f.length,crc:v,file:d?n.deflateRaw(f):f}}for(var a in h)c+=h[a].file.length+30+46+2*n.bin.sizeUTF8(a);c+=22;var g=new Uint8Array(c),b=0,$=[];for(var a in h){var T=h[a];$.push(b),b=n._writeHeader(g,b,a,T,0)}var F=0,M=b;for(var a in h)T=h[a],$.push(b),b=n._writeHeader(g,b,a,T,1,$[F++]);var E=b-M;return l(g,b,101010256),b+=4,u(g,b+=4,F),u(g,b+=2,F),l(g,b+=2,E),l(g,b+=4,M),b+=4,b+=2,g.buffer},n._noNeed=function(o){var i=o.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},n._writeHeader=function(o,i,c,l,u,h){var a=n.bin.writeUint,d=n.bin.writeUshort,f=l.file;return a(o,i,u==0?67324752:33639248),i+=4,u==1&&(i+=2),d(o,i,20),d(o,i+=2,0),d(o,i+=2,l.cpr?8:0),a(o,i+=2,0),a(o,i+=4,l.crc),a(o,i+=4,f.length),a(o,i+=4,l.usize),d(o,i+=4,n.bin.sizeUTF8(c)),d(o,i+=2,0),i+=2,u==1&&(i+=2,i+=2,a(o,i+=6,h),i+=4),i+=n.bin.writeUTF8(o,i,c),u==0&&(o.set(f,i),i+=f.length),i},n.crc={table:function(){for(var o=new Uint32Array(256),i=0;i<256;i++){for(var c=i,l=0;l<8;l++)1&c?c=3988292384^c>>>1:c>>>=1;o[i]=c}return o}(),update:function(o,i,c,l){for(var u=0;u<l;u++)o=n.crc.table[255&(o^i[c+u])]^o>>>8;return o},crc:function(o,i,c){return 4294967295^n.crc.update(4294967295,o,i,c)}},n.adler=function(o,i,c){for(var l=1,u=0,h=i,a=i+c;h<a;){for(var d=Math.min(h+5552,a);h<d;)u+=l+=o[h++];l%=65521,u%=65521}return u<<16|l},n.bin={readUshort:function(o,i){return o[i]|o[i+1]<<8},writeUshort:function(o,i,c){o[i]=255&c,o[i+1]=c>>8&255},readUint:function(o,i){return 16777216*o[i+3]+(o[i+2]<<16|o[i+1]<<8|o[i])},writeUint:function(o,i,c){o[i]=255&c,o[i+1]=c>>8&255,o[i+2]=c>>16&255,o[i+3]=c>>24&255},readASCII:function(o,i,c){for(var l="",u=0;u<c;u++)l+=String.fromCharCode(o[i+u]);return l},writeASCII:function(o,i,c){for(var l=0;l<c.length;l++)o[i+l]=c.charCodeAt(l)},pad:function(o){return o.length<2?"0"+o:o},readUTF8:function(o,i,c){for(var l,u="",h=0;h<c;h++)u+="%"+n.bin.pad(o[i+h].toString(16));try{l=decodeURIComponent(u)}catch{return n.bin.readASCII(o,i,c)}return l},writeUTF8:function(o,i,c){for(var l=c.length,u=0,h=0;h<l;h++){var a=c.charCodeAt(h);if((4294967168&a)==0)o[i+u]=a,u++;else if((4294965248&a)==0)o[i+u]=192|a>>6,o[i+u+1]=128|a>>0&63,u+=2;else if((4294901760&a)==0)o[i+u]=224|a>>12,o[i+u+1]=128|a>>6&63,o[i+u+2]=128|a>>0&63,u+=3;else{if((4292870144&a)!=0)throw"e";o[i+u]=240|a>>18,o[i+u+1]=128|a>>12&63,o[i+u+2]=128|a>>6&63,o[i+u+3]=128|a>>0&63,u+=4}}return u},sizeUTF8:function(o){for(var i=o.length,c=0,l=0;l<i;l++){var u=o.charCodeAt(l);if((4294967168&u)==0)c++;else if((4294965248&u)==0)c+=2;else if((4294901760&u)==0)c+=3;else{if((4292870144&u)!=0)throw"e";c+=4}}return c}},n.F={},n.F.deflateRaw=function(o,i,c,l){var u=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][l],h=n.F.U,a=n.F._goodIndex;n.F._hash;var d=n.F._putsE,f=0,v=c<<3,g=0,b=o.length;if(l==0){for(;f<b;)d(i,v,f+(x=Math.min(65535,b-f))==b?1:0),v=n.F._copyExact(o,f,x,i,v+8),f+=x;return v>>>3}var $=h.lits,T=h.strt,F=h.prev,M=0,E=0,U=0,A=0,D=0,w=0;for(b>2&&(T[w=n.F._hash(o,0)]=0),f=0;f<b;f++){if(D=w,f+1<b-2){w=n.F._hash(o,f+1);var N=f+1&32767;F[N]=T[w],T[w]=N}if(g<=f){(M>14e3||E>26697)&&b-f>100&&(g<f&&($[M]=f-g,M+=2,g=f),v=n.F._writeBlock(f==b-1||g==b?1:0,$,M,A,o,U,f-U,i,v),M=E=A=0,U=f);var P=0;f<b-2&&(P=n.F._bestMatch(o,f,F,D,Math.min(u[2],b-f),u[3]));var x=P>>>16,k=65535&P;if(P!=0){k=65535&P;var R=a(x=P>>>16,h.of0);h.lhst[257+R]++;var j=a(k,h.df0);h.dhst[j]++,A+=h.exb[R]+h.dxb[j],$[M]=x<<23|f-g,$[M+1]=k<<16|R<<8|j,M+=2,g=f+x}else h.lhst[o[f]]++;E++}}for(U==f&&o.length!=0||(g<f&&($[M]=f-g,M+=2,g=f),v=n.F._writeBlock(1,$,M,A,o,U,f-U,i,v),M=0,E=0,M=E=A=0,U=f);(7&v)!=0;)v++;return v>>>3},n.F._bestMatch=function(o,i,c,l,u,h){var a=32767&i,d=c[a],f=a-d+32768&32767;if(d==a||l!=n.F._hash(o,i-f))return 0;for(var v=0,g=0,b=Math.min(32767,i);f<=b&&--h!=0&&d!=a;){if(v==0||o[i+v]==o[i+v-f]){var $=n.F._howLong(o,i,f);if($>v){if(g=f,(v=$)>=u)break;f+2<$&&($=f+2);for(var T=0,F=0;F<$-2;F++){var M=i-f+F+32768&32767,E=M-c[M]+32768&32767;E>T&&(T=E,d=M)}}}f+=(a=d)-(d=c[a])+32768&32767}return v<<16|g},n.F._howLong=function(o,i,c){if(o[i]!=o[i-c]||o[i+1]!=o[i+1-c]||o[i+2]!=o[i+2-c])return 0;var l=i,u=Math.min(o.length,i+258);for(i+=3;i<u&&o[i]==o[i-c];)i++;return i-l},n.F._hash=function(o,i){return(o[i]<<8|o[i+1])+(o[i+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(o,i,c,l,u,h,a,d,f){var v,g,b,$,T,F,M,E,U,A=n.F.U,D=n.F._putsF,w=n.F._putsE;A.lhst[256]++,g=(v=n.F.getTrees())[0],b=v[1],$=v[2],T=v[3],F=v[4],M=v[5],E=v[6],U=v[7];var N=32+((f+3&7)==0?0:8-(f+3&7))+(a<<3),P=l+n.F.contSize(A.fltree,A.lhst)+n.F.contSize(A.fdtree,A.dhst),x=l+n.F.contSize(A.ltree,A.lhst)+n.F.contSize(A.dtree,A.dhst);x+=14+3*M+n.F.contSize(A.itree,A.ihst)+(2*A.ihst[16]+3*A.ihst[17]+7*A.ihst[18]);for(var k=0;k<286;k++)A.lhst[k]=0;for(k=0;k<30;k++)A.dhst[k]=0;for(k=0;k<19;k++)A.ihst[k]=0;var R=N<P&&N<x?0:P<x?1:2;if(D(d,f,o),D(d,f+1,R),f+=3,R==0){for(;(7&f)!=0;)f++;f=n.F._copyExact(u,h,a,d,f)}else{var j,I;if(R==1&&(j=A.fltree,I=A.fdtree),R==2){n.F.makeCodes(A.ltree,g),n.F.revCodes(A.ltree,g),n.F.makeCodes(A.dtree,b),n.F.revCodes(A.dtree,b),n.F.makeCodes(A.itree,$),n.F.revCodes(A.itree,$),j=A.ltree,I=A.dtree,w(d,f,T-257),w(d,f+=5,F-1),w(d,f+=5,M-4),f+=4;for(var S=0;S<M;S++)w(d,f+3*S,A.itree[1+(A.ordr[S]<<1)]);f+=3*M,f=n.F._codeTiny(E,A.itree,d,f),f=n.F._codeTiny(U,A.itree,d,f)}for(var C=h,G=0;G<c;G+=2){for(var V=i[G],L=V>>>23,X=C+(8388607&V);C<X;)f=n.F._writeLit(u[C++],j,d,f);if(L!=0){var q=i[G+1],z=q>>16,K=q>>8&255,W=255&q;w(d,f=n.F._writeLit(257+K,j,d,f),L-A.of0[K]),f+=A.exb[K],D(d,f=n.F._writeLit(W,I,d,f),z-A.df0[W]),f+=A.dxb[W],C+=L}}f=n.F._writeLit(256,j,d,f)}return f},n.F._copyExact=function(o,i,c,l,u){var h=u>>>3;return l[h]=c,l[h+1]=c>>>8,l[h+2]=255-l[h],l[h+3]=255-l[h+1],h+=4,l.set(new Uint8Array(o.buffer,i,c),h),u+(c+4<<3)},n.F.getTrees=function(){for(var o=n.F.U,i=n.F._hufTree(o.lhst,o.ltree,15),c=n.F._hufTree(o.dhst,o.dtree,15),l=[],u=n.F._lenCodes(o.ltree,l),h=[],a=n.F._lenCodes(o.dtree,h),d=0;d<l.length;d+=2)o.ihst[l[d]]++;for(d=0;d<h.length;d+=2)o.ihst[h[d]]++;for(var f=n.F._hufTree(o.ihst,o.itree,7),v=19;v>4&&o.itree[1+(o.ordr[v-1]<<1)]==0;)v--;return[i,c,f,u,a,v,l,h]},n.F.getSecond=function(o){for(var i=[],c=0;c<o.length;c+=2)i.push(o[c+1]);return i},n.F.nonZero=function(o){for(var i="",c=0;c<o.length;c+=2)o[c+1]!=0&&(i+=(c>>1)+",");return i},n.F.contSize=function(o,i){for(var c=0,l=0;l<i.length;l++)c+=i[l]*o[1+(l<<1)];return c},n.F._codeTiny=function(o,i,c,l){for(var u=0;u<o.length;u+=2){var h=o[u],a=o[u+1];l=n.F._writeLit(h,i,c,l);var d=h==16?2:h==17?3:7;h>15&&(n.F._putsE(c,l,a,d),l+=d)}return l},n.F._lenCodes=function(o,i){for(var c=o.length;c!=2&&o[c-1]==0;)c-=2;for(var l=0;l<c;l+=2){var u=o[l+1],h=l+3<c?o[l+3]:-1,a=l+5<c?o[l+5]:-1,d=l==0?-1:o[l-1];if(u==0&&h==u&&a==u){for(var f=l+5;f+2<c&&o[f+2]==u;)f+=2;(v=Math.min(f+1-l>>>1,138))<11?i.push(17,v-3):i.push(18,v-11),l+=2*v-2}else if(u==d&&h==u&&a==u){for(f=l+5;f+2<c&&o[f+2]==u;)f+=2;var v=Math.min(f+1-l>>>1,6);i.push(16,v-3),l+=2*v-2}else i.push(u,0)}return c>>>1},n.F._hufTree=function(o,i,c){var l=[],u=o.length,h=i.length,a=0;for(a=0;a<h;a+=2)i[a]=0,i[a+1]=0;for(a=0;a<u;a++)o[a]!=0&&l.push({lit:a,f:o[a]});var d=l.length,f=l.slice(0);if(d==0)return 0;if(d==1){var v=l[0].lit;return f=v==0?1:0,i[1+(v<<1)]=1,i[1+(f<<1)]=1,1}l.sort(function(E,U){return E.f-U.f});var g=l[0],b=l[1],$=0,T=1,F=2;for(l[0]={lit:-1,f:g.f+b.f,l:g,r:b,d:0};T!=d-1;)g=$!=T&&(F==d||l[$].f<l[F].f)?l[$++]:l[F++],b=$!=T&&(F==d||l[$].f<l[F].f)?l[$++]:l[F++],l[T++]={lit:-1,f:g.f+b.f,l:g,r:b};var M=n.F.setDepth(l[T-1],0);for(M>c&&(n.F.restrictDepth(f,c,M),M=c),a=0;a<d;a++)i[1+(f[a].lit<<1)]=f[a].d;return M},n.F.setDepth=function(o,i){return o.lit!=-1?(o.d=i,i):Math.max(n.F.setDepth(o.l,i+1),n.F.setDepth(o.r,i+1))},n.F.restrictDepth=function(o,i,c){var l=0,u=1<<c-i,h=0;for(o.sort(function(d,f){return f.d==d.d?d.f-f.f:f.d-d.d}),l=0;l<o.length&&o[l].d>i;l++){var a=o[l].d;o[l].d=i,h+=u-(1<<c-a)}for(h>>>=c-i;h>0;)(a=o[l].d)<i?(o[l].d++,h-=1<<i-a-1):l++;for(;l>=0;l--)o[l].d==i&&h<0&&(o[l].d--,h++);h!=0&&console.log("debt left")},n.F._goodIndex=function(o,i){var c=0;return i[16|c]<=o&&(c|=16),i[8|c]<=o&&(c|=8),i[4|c]<=o&&(c|=4),i[2|c]<=o&&(c|=2),i[1|c]<=o&&(c|=1),c},n.F._writeLit=function(o,i,c,l){return n.F._putsF(c,l,i[o<<1]),l+i[1+(o<<1)]},n.F.inflate=function(o,i){var c=Uint8Array;if(o[0]==3&&o[1]==0)return i||new c(0);var l=n.F,u=l._bitsF,h=l._bitsE,a=l._decodeTiny,d=l.makeCodes,f=l.codes2map,v=l._get17,g=l.U,b=i==null;b&&(i=new c(o.length>>>2<<3));for(var $,T,F=0,M=0,E=0,U=0,A=0,D=0,w=0,N=0,P=0;F==0;)if(F=u(o,P,1),M=u(o,P+1,2),P+=3,M!=0){if(b&&(i=n.F._check(i,N+(1<<17))),M==1&&($=g.flmap,T=g.fdmap,D=511,w=31),M==2){E=h(o,P,5)+257,U=h(o,P+5,5)+1,A=h(o,P+10,4)+4,P+=14;for(var x=0;x<38;x+=2)g.itree[x]=0,g.itree[x+1]=0;var k=1;for(x=0;x<A;x++){var R=h(o,P+3*x,3);g.itree[1+(g.ordr[x]<<1)]=R,R>k&&(k=R)}P+=3*A,d(g.itree,k),f(g.itree,k,g.imap),$=g.lmap,T=g.dmap,P=a(g.imap,(1<<k)-1,E+U,o,P,g.ttree);var j=l._copyOut(g.ttree,0,E,g.ltree);D=(1<<j)-1;var I=l._copyOut(g.ttree,E,U,g.dtree);w=(1<<I)-1,d(g.ltree,j),f(g.ltree,j,$),d(g.dtree,I),f(g.dtree,I,T)}for(;;){var S=$[v(o,P)&D];P+=15&S;var C=S>>>4;if(!(C>>>8))i[N++]=C;else{if(C==256)break;var G=N+C-254;if(C>264){var V=g.ldef[C-257];G=N+(V>>>3)+h(o,P,7&V),P+=7&V}var L=T[v(o,P)&w];P+=15&L;var X=L>>>4,q=g.ddef[X],z=(q>>>4)+u(o,P,15&q);for(P+=15&q,b&&(i=n.F._check(i,N+(1<<17)));N<G;)i[N]=i[N++-z],i[N]=i[N++-z],i[N]=i[N++-z],i[N]=i[N++-z];N=G}}}else{(7&P)!=0&&(P+=8-(7&P));var K=4+(P>>>3),W=o[K-4]|o[K-3]<<8;b&&(i=n.F._check(i,N+W)),i.set(new c(o.buffer,o.byteOffset+K,W),N),P=K+W<<3,N+=W}return i.length==N?i:i.slice(0,N)},n.F._check=function(o,i){var c=o.length;if(i<=c)return o;var l=new Uint8Array(Math.max(c<<1,i));return l.set(o,0),l},n.F._decodeTiny=function(o,i,c,l,u,h){for(var a=n.F._bitsE,d=n.F._get17,f=0;f<c;){var v=o[d(l,u)&i];u+=15&v;var g=v>>>4;if(g<=15)h[f]=g,f++;else{var b=0,$=0;g==16?($=3+a(l,u,2),u+=2,b=h[f-1]):g==17?($=3+a(l,u,3),u+=3):g==18&&($=11+a(l,u,7),u+=7);for(var T=f+$;f<T;)h[f]=b,f++}}return u},n.F._copyOut=function(o,i,c,l){for(var u=0,h=0,a=l.length>>>1;h<c;){var d=o[h+i];l[h<<1]=0,l[1+(h<<1)]=d,d>u&&(u=d),h++}for(;h<a;)l[h<<1]=0,l[1+(h<<1)]=0,h++;return u},n.F.makeCodes=function(o,i){for(var c,l,u,h,a=n.F.U,d=o.length,f=a.bl_count,v=0;v<=i;v++)f[v]=0;for(v=1;v<d;v+=2)f[o[v]]++;var g=a.next_code;for(c=0,f[0]=0,l=1;l<=i;l++)c=c+f[l-1]<<1,g[l]=c;for(u=0;u<d;u+=2)(h=o[u+1])!=0&&(o[u]=g[h],g[h]++)},n.F.codes2map=function(o,i,c){for(var l=o.length,u=n.F.U.rev15,h=0;h<l;h+=2)if(o[h+1]!=0)for(var a=h>>1,d=o[h+1],f=a<<4|d,v=i-d,g=o[h]<<v,b=g+(1<<v);g!=b;)c[u[g]>>>15-i]=f,g++},n.F.revCodes=function(o,i){for(var c=n.F.U.rev15,l=15-i,u=0;u<o.length;u+=2){var h=o[u]<<i-o[u+1];o[u]=c[h]>>>l}},n.F._putsE=function(o,i,c){c<<=7&i;var l=i>>>3;o[l]|=c,o[l+1]|=c>>>8},n.F._putsF=function(o,i,c){c<<=7&i;var l=i>>>3;o[l]|=c,o[l+1]|=c>>>8,o[l+2]|=c>>>16},n.F._bitsE=function(o,i,c){return(o[i>>>3]|o[1+(i>>>3)]<<8)>>>(7&i)&(1<<c)-1},n.F._bitsF=function(o,i,c){return(o[i>>>3]|o[1+(i>>>3)]<<8|o[2+(i>>>3)]<<16)>>>(7&i)&(1<<c)-1},n.F._get17=function(o,i){return(o[i>>>3]|o[1+(i>>>3)]<<8|o[2+(i>>>3)]<<16)>>>(7&i)},n.F._get25=function(o,i){return(o[i>>>3]|o[1+(i>>>3)]<<8|o[2+(i>>>3)]<<16|o[3+(i>>>3)]<<24)>>>(7&i)},n.F.U=(t=Uint16Array,s=Uint32Array,{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new s(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new s(286),dhst:new s(30),ihst:new s(19),lits:new s(15e3),strt:new t(65536),prev:new t(32768)}),function(){for(var o=n.F.U,i=0;i<32768;i++){var c=i;c=(4278255360&(c=(4042322160&(c=(3435973836&(c=(2863311530&c)>>>1|(1431655765&c)<<1))>>>2|(858993459&c)<<2))>>>4|(252645135&c)<<4))>>>8|(16711935&c)<<8,o.rev15[i]=(c>>>16|c<<16)>>>17}function l(u,h,a){for(;h--!=0;)u.push(0,a)}for(i=0;i<32;i++)o.ldef[i]=o.of0[i]<<3|o.exb[i],o.ddef[i]=o.df0[i]<<4|o.dxb[i];l(o.fltree,144,8),l(o.fltree,112,9),l(o.fltree,24,7),l(o.fltree,8,8),n.F.makeCodes(o.fltree,9),n.F.codes2map(o.fltree,9,o.flmap),n.F.revCodes(o.fltree,9),l(o.fdtree,32,5),n.F.makeCodes(o.fdtree,5),n.F.codes2map(o.fdtree,5,o.fdmap),n.F.revCodes(o.fdtree,5),l(o.itree,19,0),l(o.ltree,286,0),l(o.dtree,30,0),l(o.ttree,320,0)}()})();var iy=ny({__proto__:null,default:Yo},[Yo]);const Js=function(){var e={nextZero(a,d){for(;a[d]!=0;)d++;return d},readUshort:(a,d)=>a[d]<<8|a[d+1],writeUshort(a,d,f){a[d]=f>>8&255,a[d+1]=255&f},readUint:(a,d)=>16777216*a[d]+(a[d+1]<<16|a[d+2]<<8|a[d+3]),writeUint(a,d,f){a[d]=f>>24&255,a[d+1]=f>>16&255,a[d+2]=f>>8&255,a[d+3]=255&f},readASCII(a,d,f){let v="";for(let g=0;g<f;g++)v+=String.fromCharCode(a[d+g]);return v},writeASCII(a,d,f){for(let v=0;v<f.length;v++)a[d+v]=f.charCodeAt(v)},readBytes(a,d,f){const v=[];for(let g=0;g<f;g++)v.push(a[d+g]);return v},pad:a=>a.length<2?`0${a}`:a,readUTF8(a,d,f){let v,g="";for(let b=0;b<f;b++)g+=`%${e.pad(a[d+b].toString(16))}`;try{v=decodeURIComponent(g)}catch{return e.readASCII(a,d,f)}return v}};function t(a,d,f,v){const g=d*f,b=i(v),$=Math.ceil(d*b/8),T=new Uint8Array(4*g),F=new Uint32Array(T.buffer),{ctype:M}=v,{depth:E}=v,U=e.readUshort;if(M==6){const V=g<<2;if(E==8)for(var A=0;A<V;A+=4)T[A]=a[A],T[A+1]=a[A+1],T[A+2]=a[A+2],T[A+3]=a[A+3];if(E==16)for(A=0;A<V;A++)T[A]=a[A<<1]}else if(M==2){const V=v.tabs.tRNS;if(V==null){if(E==8)for(A=0;A<g;A++){var D=3*A;F[A]=255<<24|a[D+2]<<16|a[D+1]<<8|a[D]}if(E==16)for(A=0;A<g;A++)D=6*A,F[A]=255<<24|a[D+4]<<16|a[D+2]<<8|a[D]}else{var w=V[0];const L=V[1],X=V[2];if(E==8)for(A=0;A<g;A++){var N=A<<2;D=3*A,F[A]=255<<24|a[D+2]<<16|a[D+1]<<8|a[D],a[D]==w&&a[D+1]==L&&a[D+2]==X&&(T[N+3]=0)}if(E==16)for(A=0;A<g;A++)N=A<<2,D=6*A,F[A]=255<<24|a[D+4]<<16|a[D+2]<<8|a[D],U(a,D)==w&&U(a,D+2)==L&&U(a,D+4)==X&&(T[N+3]=0)}}else if(M==3){const V=v.tabs.PLTE,L=v.tabs.tRNS,X=L?L.length:0;if(E==1)for(var P=0;P<f;P++){var x=P*$,k=P*d;for(A=0;A<d;A++){N=k+A<<2;var R=3*(j=a[x+(A>>3)]>>7-((7&A)<<0)&1);T[N]=V[R],T[N+1]=V[R+1],T[N+2]=V[R+2],T[N+3]=j<X?L[j]:255}}if(E==2)for(P=0;P<f;P++)for(x=P*$,k=P*d,A=0;A<d;A++)N=k+A<<2,R=3*(j=a[x+(A>>2)]>>6-((3&A)<<1)&3),T[N]=V[R],T[N+1]=V[R+1],T[N+2]=V[R+2],T[N+3]=j<X?L[j]:255;if(E==4)for(P=0;P<f;P++)for(x=P*$,k=P*d,A=0;A<d;A++)N=k+A<<2,R=3*(j=a[x+(A>>1)]>>4-((1&A)<<2)&15),T[N]=V[R],T[N+1]=V[R+1],T[N+2]=V[R+2],T[N+3]=j<X?L[j]:255;if(E==8)for(A=0;A<g;A++){var j;N=A<<2,R=3*(j=a[A]),T[N]=V[R],T[N+1]=V[R+1],T[N+2]=V[R+2],T[N+3]=j<X?L[j]:255}}else if(M==4){if(E==8)for(A=0;A<g;A++){N=A<<2;var I=a[S=A<<1];T[N]=I,T[N+1]=I,T[N+2]=I,T[N+3]=a[S+1]}if(E==16)for(A=0;A<g;A++){var S;N=A<<2,I=a[S=A<<2],T[N]=I,T[N+1]=I,T[N+2]=I,T[N+3]=a[S+2]}}else if(M==0)for(w=v.tabs.tRNS?v.tabs.tRNS:-1,P=0;P<f;P++){const V=P*$,L=P*d;if(E==1)for(var C=0;C<d;C++){var G=(I=255*(a[V+(C>>>3)]>>>7-(7&C)&1))==255*w?0:255;F[L+C]=G<<24|I<<16|I<<8|I}else if(E==2)for(C=0;C<d;C++)G=(I=85*(a[V+(C>>>2)]>>>6-((3&C)<<1)&3))==85*w?0:255,F[L+C]=G<<24|I<<16|I<<8|I;else if(E==4)for(C=0;C<d;C++)G=(I=17*(a[V+(C>>>1)]>>>4-((1&C)<<2)&15))==17*w?0:255,F[L+C]=G<<24|I<<16|I<<8|I;else if(E==8)for(C=0;C<d;C++)G=(I=a[V+C])==w?0:255,F[L+C]=G<<24|I<<16|I<<8|I;else if(E==16)for(C=0;C<d;C++)I=a[V+(C<<1)],G=U(a,V+(C<<1))==w?0:255,F[L+C]=G<<24|I<<16|I<<8|I}return T}function s(a,d,f,v){const g=i(a),b=Math.ceil(f*g/8),$=new Uint8Array((b+1+a.interlace)*v);return d=a.tabs.CgBI?o(d,$):n(d,$),a.interlace==0?d=c(d,a,0,f,v):a.interlace==1&&(d=function(F,M){const E=M.width,U=M.height,A=i(M),D=A>>3,w=Math.ceil(E*A/8),N=new Uint8Array(U*w);let P=0;const x=[0,0,4,0,2,0,1],k=[0,4,0,2,0,1,0],R=[8,8,8,4,4,2,2],j=[8,8,4,4,2,2,1];let I=0;for(;I<7;){const C=R[I],G=j[I];let V=0,L=0,X=x[I];for(;X<U;)X+=C,L++;let q=k[I];for(;q<E;)q+=G,V++;const z=Math.ceil(V*A/8);c(F,M,P,V,L);let K=0,W=x[I];for(;W<U;){let H=k[I],ne=P+K*z<<3;for(;H<E;){var S;if(A==1&&(S=(S=F[ne>>3])>>7-(7&ne)&1,N[W*w+(H>>3)]|=S<<7-((7&H)<<0)),A==2&&(S=(S=F[ne>>3])>>6-(7&ne)&3,N[W*w+(H>>2)]|=S<<6-((3&H)<<1)),A==4&&(S=(S=F[ne>>3])>>4-(7&ne)&15,N[W*w+(H>>1)]|=S<<4-((1&H)<<2)),A>=8){const Q=W*w+H*D;for(let he=0;he<D;he++)N[Q+he]=F[(ne>>3)+he]}ne+=A,H+=G}K++,W+=C}V*L!=0&&(P+=L*(1+z)),I+=1}return N}(d,a)),d}function n(a,d){return o(new Uint8Array(a.buffer,2,a.length-6),d)}var o=function(){const a={H:{}};return a.H.N=function(d,f){const v=Uint8Array;let g,b,$=0,T=0,F=0,M=0,E=0,U=0,A=0,D=0,w=0;if(d[0]==3&&d[1]==0)return f||new v(0);const N=a.H,P=N.b,x=N.e,k=N.R,R=N.n,j=N.A,I=N.Z,S=N.m,C=f==null;for(C&&(f=new v(d.length>>>2<<5));$==0;)if($=P(d,w,1),T=P(d,w+1,2),w+=3,T!=0){if(C&&(f=a.H.W(f,D+(1<<17))),T==1&&(g=S.J,b=S.h,U=511,A=31),T==2){F=x(d,w,5)+257,M=x(d,w+5,5)+1,E=x(d,w+10,4)+4,w+=14;let V=1;for(var G=0;G<38;G+=2)S.Q[G]=0,S.Q[G+1]=0;for(G=0;G<E;G++){const q=x(d,w+3*G,3);S.Q[1+(S.X[G]<<1)]=q,q>V&&(V=q)}w+=3*E,R(S.Q,V),j(S.Q,V,S.u),g=S.w,b=S.d,w=k(S.u,(1<<V)-1,F+M,d,w,S.v);const L=N.V(S.v,0,F,S.C);U=(1<<L)-1;const X=N.V(S.v,F,M,S.D);A=(1<<X)-1,R(S.C,L),j(S.C,L,g),R(S.D,X),j(S.D,X,b)}for(;;){const V=g[I(d,w)&U];w+=15&V;const L=V>>>4;if(!(L>>>8))f[D++]=L;else{if(L==256)break;{let X=D+L-254;if(L>264){const H=S.q[L-257];X=D+(H>>>3)+x(d,w,7&H),w+=7&H}const q=b[I(d,w)&A];w+=15&q;const z=q>>>4,K=S.c[z],W=(K>>>4)+P(d,w,15&K);for(w+=15&K;D<X;)f[D]=f[D++-W],f[D]=f[D++-W],f[D]=f[D++-W],f[D]=f[D++-W];D=X}}}}else{(7&w)!=0&&(w+=8-(7&w));const V=4+(w>>>3),L=d[V-4]|d[V-3]<<8;C&&(f=a.H.W(f,D+L)),f.set(new v(d.buffer,d.byteOffset+V,L),D),w=V+L<<3,D+=L}return f.length==D?f:f.slice(0,D)},a.H.W=function(d,f){const v=d.length;if(f<=v)return d;const g=new Uint8Array(v<<1);return g.set(d,0),g},a.H.R=function(d,f,v,g,b,$){const T=a.H.e,F=a.H.Z;let M=0;for(;M<v;){const E=d[F(g,b)&f];b+=15&E;const U=E>>>4;if(U<=15)$[M]=U,M++;else{let A=0,D=0;U==16?(D=3+T(g,b,2),b+=2,A=$[M-1]):U==17?(D=3+T(g,b,3),b+=3):U==18&&(D=11+T(g,b,7),b+=7);const w=M+D;for(;M<w;)$[M]=A,M++}}return b},a.H.V=function(d,f,v,g){let b=0,$=0;const T=g.length>>>1;for(;$<v;){const F=d[$+f];g[$<<1]=0,g[1+($<<1)]=F,F>b&&(b=F),$++}for(;$<T;)g[$<<1]=0,g[1+($<<1)]=0,$++;return b},a.H.n=function(d,f){const v=a.H.m,g=d.length;let b,$,T,F;const M=v.j;for(var E=0;E<=f;E++)M[E]=0;for(E=1;E<g;E+=2)M[d[E]]++;const U=v.K;for(b=0,M[0]=0,$=1;$<=f;$++)b=b+M[$-1]<<1,U[$]=b;for(T=0;T<g;T+=2)F=d[T+1],F!=0&&(d[T]=U[F],U[F]++)},a.H.A=function(d,f,v){const g=d.length,b=a.H.m.r;for(let $=0;$<g;$+=2)if(d[$+1]!=0){const T=$>>1,F=d[$+1],M=T<<4|F,E=f-F;let U=d[$]<<E;const A=U+(1<<E);for(;U!=A;)v[b[U]>>>15-f]=M,U++}},a.H.l=function(d,f){const v=a.H.m.r,g=15-f;for(let b=0;b<d.length;b+=2){const $=d[b]<<f-d[b+1];d[b]=v[$]>>>g}},a.H.M=function(d,f,v){v<<=7&f;const g=f>>>3;d[g]|=v,d[g+1]|=v>>>8},a.H.I=function(d,f,v){v<<=7&f;const g=f>>>3;d[g]|=v,d[g+1]|=v>>>8,d[g+2]|=v>>>16},a.H.e=function(d,f,v){return(d[f>>>3]|d[1+(f>>>3)]<<8)>>>(7&f)&(1<<v)-1},a.H.b=function(d,f,v){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)&(1<<v)-1},a.H.Z=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)},a.H.i=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16|d[3+(f>>>3)]<<24)>>>(7&f)},a.H.m=function(){const d=Uint16Array,f=Uint32Array;return{K:new d(16),j:new d(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new d(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new f(32),J:new d(512),_:[],h:new d(32),$:[],w:new d(32768),C:[],v:[],d:new d(32768),D:[],u:new d(512),Q:[],r:new d(32768),s:new f(286),Y:new f(30),a:new f(19),t:new f(15e3),k:new d(65536),g:new d(32768)}}(),function(){const d=a.H.m;for(var f=0;f<32768;f++){let g=f;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,d.r[f]=(g>>>16|g<<16)>>>17}function v(g,b,$){for(;b--!=0;)g.push(0,$)}for(f=0;f<32;f++)d.q[f]=d.S[f]<<3|d.T[f],d.c[f]=d.p[f]<<4|d.z[f];v(d._,144,8),v(d._,112,9),v(d._,24,7),v(d._,8,8),a.H.n(d._,9),a.H.A(d._,9,d.J),a.H.l(d._,9),v(d.$,32,5),a.H.n(d.$,5),a.H.A(d.$,5,d.h),a.H.l(d.$,5),v(d.Q,19,0),v(d.C,286,0),v(d.D,30,0),v(d.v,320,0)}(),a.H.N}();function i(a){return[1,null,3,1,2,null,4][a.ctype]*a.depth}function c(a,d,f,v,g){let b=i(d);const $=Math.ceil(v*b/8);let T,F;b=Math.ceil(b/8);let M=a[f],E=0;if(M>1&&(a[f]=[0,0,1][M-2]),M==3)for(E=b;E<$;E++)a[E+1]=a[E+1]+(a[E+1-b]>>>1)&255;for(let U=0;U<g;U++)if(T=f+U*$,F=T+U+1,M=a[F-1],E=0,M==0)for(;E<$;E++)a[T+E]=a[F+E];else if(M==1){for(;E<b;E++)a[T+E]=a[F+E];for(;E<$;E++)a[T+E]=a[F+E]+a[T+E-b]}else if(M==2)for(;E<$;E++)a[T+E]=a[F+E]+a[T+E-$];else if(M==3){for(;E<b;E++)a[T+E]=a[F+E]+(a[T+E-$]>>>1);for(;E<$;E++)a[T+E]=a[F+E]+(a[T+E-$]+a[T+E-b]>>>1)}else{for(;E<b;E++)a[T+E]=a[F+E]+l(0,a[T+E-$],0);for(;E<$;E++)a[T+E]=a[F+E]+l(a[T+E-b],a[T+E-$],a[T+E-b-$])}return a}function l(a,d,f){const v=a+d-f,g=v-a,b=v-d,$=v-f;return g*g<=b*b&&g*g<=$*$?a:b*b<=$*$?d:f}function u(a,d,f){f.width=e.readUint(a,d),d+=4,f.height=e.readUint(a,d),d+=4,f.depth=a[d],d++,f.ctype=a[d],d++,f.compress=a[d],d++,f.filter=a[d],d++,f.interlace=a[d],d++}function h(a,d,f,v,g,b,$,T,F){const M=Math.min(d,g),E=Math.min(f,b);let U=0,A=0;for(let I=0;I<E;I++)for(let S=0;S<M;S++)if($>=0&&T>=0?(U=I*d+S<<2,A=(T+I)*g+$+S<<2):(U=(-T+I)*d-$+S<<2,A=I*g+S<<2),F==0)v[A]=a[U],v[A+1]=a[U+1],v[A+2]=a[U+2],v[A+3]=a[U+3];else if(F==1){var D=a[U+3]*.00392156862745098,w=a[U]*D,N=a[U+1]*D,P=a[U+2]*D,x=v[A+3]*(1/255),k=v[A]*x,R=v[A+1]*x,j=v[A+2]*x;const C=1-D,G=D+x*C,V=G==0?0:1/G;v[A+3]=255*G,v[A+0]=(w+k*C)*V,v[A+1]=(N+R*C)*V,v[A+2]=(P+j*C)*V}else if(F==2)D=a[U+3],w=a[U],N=a[U+1],P=a[U+2],x=v[A+3],k=v[A],R=v[A+1],j=v[A+2],D==x&&w==k&&N==R&&P==j?(v[A]=0,v[A+1]=0,v[A+2]=0,v[A+3]=0):(v[A]=w,v[A+1]=N,v[A+2]=P,v[A+3]=D);else if(F==3){if(D=a[U+3],w=a[U],N=a[U+1],P=a[U+2],x=v[A+3],k=v[A],R=v[A+1],j=v[A+2],D==x&&w==k&&N==R&&P==j)continue;if(D<220&&x>20)return!1}return!0}return{decode:function(d){const f=new Uint8Array(d);let v=8;const g=e,b=g.readUshort,$=g.readUint,T={tabs:{},frames:[]},F=new Uint8Array(f.length);let M,E=0,U=0;const A=[137,80,78,71,13,10,26,10];for(var D=0;D<8;D++)if(f[D]!=A[D])throw"The input is not a PNG file!";for(;v<f.length;){const I=g.readUint(f,v);v+=4;const S=g.readASCII(f,v,4);if(v+=4,S=="IHDR")u(f,v,T);else if(S=="iCCP"){for(var w=v;f[w]!=0;)w++;g.readASCII(f,v,w-v),f[w+1];const C=f.slice(w+2,v+I);let G=null;try{G=n(C)}catch{G=o(C)}T.tabs[S]=G}else if(S=="CgBI")T.tabs[S]=f.slice(v,v+4);else if(S=="IDAT"){for(D=0;D<I;D++)F[E+D]=f[v+D];E+=I}else if(S=="acTL")T.tabs[S]={num_frames:$(f,v),num_plays:$(f,v+4)},M=new Uint8Array(f.length);else if(S=="fcTL"){U!=0&&((j=T.frames[T.frames.length-1]).data=s(T,M.slice(0,U),j.rect.width,j.rect.height),U=0);const C={x:$(f,v+12),y:$(f,v+16),width:$(f,v+4),height:$(f,v+8)};let G=b(f,v+22);G=b(f,v+20)/(G==0?100:G);const V={rect:C,delay:Math.round(1e3*G),dispose:f[v+24],blend:f[v+25]};T.frames.push(V)}else if(S=="fdAT"){for(D=0;D<I-4;D++)M[U+D]=f[v+D+4];U+=I-4}else if(S=="pHYs")T.tabs[S]=[g.readUint(f,v),g.readUint(f,v+4),f[v+8]];else if(S=="cHRM")for(T.tabs[S]=[],D=0;D<8;D++)T.tabs[S].push(g.readUint(f,v+4*D));else if(S=="tEXt"||S=="zTXt"){T.tabs[S]==null&&(T.tabs[S]={});var N=g.nextZero(f,v),P=g.readASCII(f,v,N-v),x=v+I-N-1;if(S=="tEXt")R=g.readASCII(f,N+1,x);else{var k=n(f.slice(N+2,N+2+x));R=g.readUTF8(k,0,k.length)}T.tabs[S][P]=R}else if(S=="iTXt"){T.tabs[S]==null&&(T.tabs[S]={}),N=0,w=v,N=g.nextZero(f,w),P=g.readASCII(f,w,N-w);const C=f[w=N+1];var R;f[w+1],w+=2,N=g.nextZero(f,w),g.readASCII(f,w,N-w),w=N+1,N=g.nextZero(f,w),g.readUTF8(f,w,N-w),x=I-((w=N+1)-v),C==0?R=g.readUTF8(f,w,x):(k=n(f.slice(w,w+x)),R=g.readUTF8(k,0,k.length)),T.tabs[S][P]=R}else if(S=="PLTE")T.tabs[S]=g.readBytes(f,v,I);else if(S=="hIST"){const C=T.tabs.PLTE.length/3;for(T.tabs[S]=[],D=0;D<C;D++)T.tabs[S].push(b(f,v+2*D))}else if(S=="tRNS")T.ctype==3?T.tabs[S]=g.readBytes(f,v,I):T.ctype==0?T.tabs[S]=b(f,v):T.ctype==2&&(T.tabs[S]=[b(f,v),b(f,v+2),b(f,v+4)]);else if(S=="gAMA")T.tabs[S]=g.readUint(f,v)/1e5;else if(S=="sRGB")T.tabs[S]=f[v];else if(S=="bKGD")T.ctype==0||T.ctype==4?T.tabs[S]=[b(f,v)]:T.ctype==2||T.ctype==6?T.tabs[S]=[b(f,v),b(f,v+2),b(f,v+4)]:T.ctype==3&&(T.tabs[S]=f[v]);else if(S=="IEND")break;v+=I,g.readUint(f,v),v+=4}var j;return U!=0&&((j=T.frames[T.frames.length-1]).data=s(T,M.slice(0,U),j.rect.width,j.rect.height)),T.data=s(T,F,T.width,T.height),delete T.compress,delete T.interlace,delete T.filter,T},toRGBA8:function(d){const f=d.width,v=d.height;if(d.tabs.acTL==null)return[t(d.data,f,v,d).buffer];const g=[];d.frames[0].data==null&&(d.frames[0].data=d.data);const b=f*v*4,$=new Uint8Array(b),T=new Uint8Array(b),F=new Uint8Array(b);for(let E=0;E<d.frames.length;E++){const U=d.frames[E],A=U.rect.x,D=U.rect.y,w=U.rect.width,N=U.rect.height,P=t(U.data,w,N,d);if(E!=0)for(var M=0;M<b;M++)F[M]=$[M];if(U.blend==0?h(P,w,N,$,f,v,A,D,0):U.blend==1&&h(P,w,N,$,f,v,A,D,1),g.push($.buffer.slice(0)),U.dispose!=0){if(U.dispose==1)h(T,w,N,$,f,v,A,D,0);else if(U.dispose==2)for(M=0;M<b;M++)$[M]=F[M]}}return g},_paeth:l,_copyTile:h,_bin:e}}();(function(){const{_copyTile:e}=Js,{_bin:t}=Js,s=Js._paeth;var n={table:function(){const w=new Uint32Array(256);for(let N=0;N<256;N++){let P=N;for(let x=0;x<8;x++)1&P?P=3988292384^P>>>1:P>>>=1;w[N]=P}return w}(),update(w,N,P,x){for(let k=0;k<x;k++)w=n.table[255&(w^N[P+k])]^w>>>8;return w},crc:(w,N,P)=>4294967295^n.update(4294967295,w,N,P)};function o(w,N,P,x){N[P]+=w[0]*x>>4,N[P+1]+=w[1]*x>>4,N[P+2]+=w[2]*x>>4,N[P+3]+=w[3]*x>>4}function i(w){return Math.max(0,Math.min(255,w))}function c(w,N){const P=w[0]-N[0],x=w[1]-N[1],k=w[2]-N[2],R=w[3]-N[3];return P*P+x*x+k*k+R*R}function l(w,N,P,x,k,R,j){j==null&&(j=1);const I=x.length,S=[];for(var C=0;C<I;C++){const W=x[C];S.push([W>>>0&255,W>>>8&255,W>>>16&255,W>>>24&255])}for(C=0;C<I;C++){let W=4294967295;for(var G=0,V=0;V<I;V++){var L=c(S[C],S[V]);V!=C&&L<W&&(W=L,G=V)}}const X=new Uint32Array(k.buffer),q=new Int16Array(N*P*4),z=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(C=0;C<z.length;C++)z[C]=255*((z[C]+.5)/16-.5);for(let W=0;W<P;W++)for(let H=0;H<N;H++){var K;C=4*(W*N+H),j!=2?K=[i(w[C]+q[C]),i(w[C+1]+q[C+1]),i(w[C+2]+q[C+2]),i(w[C+3]+q[C+3])]:(L=z[4*(3&W)+(3&H)],K=[i(w[C]+L),i(w[C+1]+L),i(w[C+2]+L),i(w[C+3]+L)]),G=0;let ne=16777215;for(V=0;V<I;V++){const re=c(K,S[V]);re<ne&&(ne=re,G=V)}const Q=S[G],he=[K[0]-Q[0],K[1]-Q[1],K[2]-Q[2],K[3]-Q[3]];j==1&&(H!=N-1&&o(he,q,C+4,7),W!=P-1&&(H!=0&&o(he,q,C+4*N-4,3),o(he,q,C+4*N,5),H!=N-1&&o(he,q,C+4*N+4,1))),R[C>>2]=G,X[C>>2]=x[G]}}function u(w,N,P,x,k){k==null&&(k={});const{crc:R}=n,j=t.writeUint,I=t.writeUshort,S=t.writeASCII;let C=8;const G=w.frames.length>1;let V,L=!1,X=33+(G?20:0);if(k.sRGB!=null&&(X+=13),k.pHYs!=null&&(X+=21),k.iCCP!=null&&(V=pako.deflate(k.iCCP),X+=21+V.length+4),w.ctype==3){for(var q=w.plte.length,z=0;z<q;z++)w.plte[z]>>>24!=255&&(L=!0);X+=8+3*q+4+(L?8+1*q+4:0)}for(var K=0;K<w.frames.length;K++)G&&(X+=38),X+=(Q=w.frames[K]).cimg.length+12,K!=0&&(X+=4);X+=12;const W=new Uint8Array(X),H=[137,80,78,71,13,10,26,10];for(z=0;z<8;z++)W[z]=H[z];if(j(W,C,13),C+=4,S(W,C,"IHDR"),C+=4,j(W,C,N),C+=4,j(W,C,P),C+=4,W[C]=w.depth,C++,W[C]=w.ctype,C++,W[C]=0,C++,W[C]=0,C++,W[C]=0,C++,j(W,C,R(W,C-17,17)),C+=4,k.sRGB!=null&&(j(W,C,1),C+=4,S(W,C,"sRGB"),C+=4,W[C]=k.sRGB,C++,j(W,C,R(W,C-5,5)),C+=4),k.iCCP!=null){const he=13+V.length;j(W,C,he),C+=4,S(W,C,"iCCP"),C+=4,S(W,C,"ICC profile"),C+=11,C+=2,W.set(V,C),C+=V.length,j(W,C,R(W,C-(he+4),he+4)),C+=4}if(k.pHYs!=null&&(j(W,C,9),C+=4,S(W,C,"pHYs"),C+=4,j(W,C,k.pHYs[0]),C+=4,j(W,C,k.pHYs[1]),C+=4,W[C]=k.pHYs[2],C++,j(W,C,R(W,C-13,13)),C+=4),G&&(j(W,C,8),C+=4,S(W,C,"acTL"),C+=4,j(W,C,w.frames.length),C+=4,j(W,C,k.loop!=null?k.loop:0),C+=4,j(W,C,R(W,C-12,12)),C+=4),w.ctype==3){for(j(W,C,3*(q=w.plte.length)),C+=4,S(W,C,"PLTE"),C+=4,z=0;z<q;z++){const he=3*z,re=w.plte[z],_e=255&re,ke=re>>>8&255,Be=re>>>16&255;W[C+he+0]=_e,W[C+he+1]=ke,W[C+he+2]=Be}if(C+=3*q,j(W,C,R(W,C-3*q-4,3*q+4)),C+=4,L){for(j(W,C,q),C+=4,S(W,C,"tRNS"),C+=4,z=0;z<q;z++)W[C+z]=w.plte[z]>>>24&255;C+=q,j(W,C,R(W,C-q-4,q+4)),C+=4}}let ne=0;for(K=0;K<w.frames.length;K++){var Q=w.frames[K];G&&(j(W,C,26),C+=4,S(W,C,"fcTL"),C+=4,j(W,C,ne++),C+=4,j(W,C,Q.rect.width),C+=4,j(W,C,Q.rect.height),C+=4,j(W,C,Q.rect.x),C+=4,j(W,C,Q.rect.y),C+=4,I(W,C,x[K]),C+=2,I(W,C,1e3),C+=2,W[C]=Q.dispose,C++,W[C]=Q.blend,C++,j(W,C,R(W,C-30,30)),C+=4);const he=Q.cimg;j(W,C,(q=he.length)+(K==0?0:4)),C+=4;const re=C;S(W,C,K==0?"IDAT":"fdAT"),C+=4,K!=0&&(j(W,C,ne++),C+=4),W.set(he,C),C+=q,j(W,C,R(W,re,C-re)),C+=4}return j(W,C,0),C+=4,S(W,C,"IEND"),C+=4,j(W,C,R(W,C-4,4)),C+=4,W.buffer}function h(w,N,P){for(let x=0;x<w.frames.length;x++){const k=w.frames[x];k.rect.width;const R=k.rect.height,j=new Uint8Array(R*k.bpl+R);k.cimg=v(k.img,R,k.bpp,k.bpl,j,N,P)}}function a(w,N,P,x,k){const R=k[0],j=k[1],I=k[2],S=k[3],C=k[4],G=k[5];let V=6,L=8,X=255;for(var q=0;q<w.length;q++){const Le=new Uint8Array(w[q]);for(var z=Le.length,K=0;K<z;K+=4)X&=Le[K+3]}const W=X!=255,H=function(Me,He,ut,tt,we,ee){const de=[];for(var ye=0;ye<Me.length;ye++){const _=new Uint8Array(Me[ye]),m=new Uint32Array(_.buffer);var oe;let y=0,B=0,J=He,ce=ut,pe=tt?1:0;if(ye!=0){const $e=ee||tt||ye==1||de[ye-2].dispose!=0?1:2;let We=0,ct=1e9;for(let ft=0;ft<$e;ft++){var fe=new Uint8Array(Me[ye-1-ft]);const ht=new Uint32Array(Me[ye-1-ft]);let qt=He,Gt=ut,ns=-1,As=-1;for(let Ie=0;Ie<ut;Ie++)for(let et=0;et<He;et++)m[te=Ie*He+et]!=ht[te]&&(et<qt&&(qt=et),et>ns&&(ns=et),Ie<Gt&&(Gt=Ie),Ie>As&&(As=Ie));ns==-1&&(qt=Gt=ns=As=0),we&&((1&qt)==1&&qt--,(1&Gt)==1&&Gt--);const Ne=(ns-qt+1)*(As-Gt+1);Ne<ct&&(ct=Ne,We=ft,y=qt,B=Gt,J=ns-qt+1,ce=As-Gt+1)}fe=new Uint8Array(Me[ye-1-We]),We==1&&(de[ye-1].dispose=2),oe=new Uint8Array(J*ce*4),e(fe,He,ut,oe,J,ce,-y,-B,0),pe=e(_,He,ut,oe,J,ce,-y,-B,3)?1:0,pe==1?f(_,He,ut,oe,{x:y,y:B,width:J,height:ce}):e(_,He,ut,oe,J,ce,-y,-B,0)}else oe=_.slice(0);de.push({rect:{x:y,y:B,width:J,height:ce},img:oe,blend:pe,dispose:0})}if(tt)for(ye=0;ye<de.length;ye++){if((Y=de[ye]).blend==1)continue;const _=Y.rect,m=de[ye-1].rect,y=Math.min(_.x,m.x),B=Math.min(_.y,m.y),J={x:y,y:B,width:Math.max(_.x+_.width,m.x+m.width)-y,height:Math.max(_.y+_.height,m.y+m.height)-B};de[ye-1].dispose=1,ye-1!=0&&d(Me,He,ut,de,ye-1,J,we),d(Me,He,ut,de,ye,J,we)}let ie=0;if(Me.length!=1)for(var te=0;te<de.length;te++){var Y;ie+=(Y=de[te]).rect.width*Y.rect.height}return de}(w,N,P,R,j,I),ne={},Q=[],he=[];if(x!=0){const Le=[];for(K=0;K<H.length;K++)Le.push(H[K].img.buffer);const Me=function(we){let ee=0;for(var de=0;de<we.length;de++)ee+=we[de].byteLength;const ye=new Uint8Array(ee);let oe=0;for(de=0;de<we.length;de++){const fe=new Uint8Array(we[de]),ie=fe.length;for(let te=0;te<ie;te+=4){let Y=fe[te],_=fe[te+1],m=fe[te+2];const y=fe[te+3];y==0&&(Y=_=m=0),ye[oe+te]=Y,ye[oe+te+1]=_,ye[oe+te+2]=m,ye[oe+te+3]=y}oe+=ie}return ye.buffer}(Le),He=b(Me,x);for(K=0;K<He.plte.length;K++)Q.push(He.plte[K].est.rgba);let ut=0;for(K=0;K<H.length;K++){const tt=(_e=H[K]).img.length;var re=new Uint8Array(He.inds.buffer,ut>>2,tt>>2);he.push(re);const we=new Uint8Array(He.abuf,ut,tt);G&&l(_e.img,_e.rect.width,_e.rect.height,Q,we,re),_e.img.set(we),ut+=tt}}else for(q=0;q<H.length;q++){var _e=H[q];const Le=new Uint32Array(_e.img.buffer);var ke=_e.rect.width;for(z=Le.length,re=new Uint8Array(z),he.push(re),K=0;K<z;K++){const Me=Le[K];if(K!=0&&Me==Le[K-1])re[K]=re[K-1];else if(K>ke&&Me==Le[K-ke])re[K]=re[K-ke];else{let He=ne[Me];if(He==null&&(ne[Me]=He=Q.length,Q.push(Me),Q.length>=300))break;re[K]=He}}}const Be=Q.length;for(Be<=256&&C==0&&(L=Be<=2?1:Be<=4?2:Be<=16?4:8,L=Math.max(L,S)),q=0;q<H.length;q++){(_e=H[q]).rect.x,_e.rect.y,ke=_e.rect.width;const Le=_e.rect.height;let Me=_e.img;new Uint32Array(Me.buffer);let He=4*ke,ut=4;if(Be<=256&&C==0){He=Math.ceil(L*ke/8);var Oe=new Uint8Array(He*Le);const tt=he[q];for(let we=0;we<Le;we++){K=we*He;const ee=we*ke;if(L==8)for(var Se=0;Se<ke;Se++)Oe[K+Se]=tt[ee+Se];else if(L==4)for(Se=0;Se<ke;Se++)Oe[K+(Se>>1)]|=tt[ee+Se]<<4-4*(1&Se);else if(L==2)for(Se=0;Se<ke;Se++)Oe[K+(Se>>2)]|=tt[ee+Se]<<6-2*(3&Se);else if(L==1)for(Se=0;Se<ke;Se++)Oe[K+(Se>>3)]|=tt[ee+Se]<<7-1*(7&Se)}Me=Oe,V=3,ut=1}else if(W==0&&H.length==1){Oe=new Uint8Array(ke*Le*3);const tt=ke*Le;for(K=0;K<tt;K++){const we=3*K,ee=4*K;Oe[we]=Me[ee],Oe[we+1]=Me[ee+1],Oe[we+2]=Me[ee+2]}Me=Oe,V=2,ut=3,He=3*ke}_e.img=Me,_e.bpl=He,_e.bpp=ut}return{ctype:V,depth:L,plte:Q,frames:H}}function d(w,N,P,x,k,R,j){const I=Uint8Array,S=Uint32Array,C=new I(w[k-1]),G=new S(w[k-1]),V=k+1<w.length?new I(w[k+1]):null,L=new I(w[k]),X=new S(L.buffer);let q=N,z=P,K=-1,W=-1;for(let ne=0;ne<R.height;ne++)for(let Q=0;Q<R.width;Q++){const he=R.x+Q,re=R.y+ne,_e=re*N+he,ke=X[_e];ke==0||x[k-1].dispose==0&&G[_e]==ke&&(V==null||V[4*_e+3]!=0)||(he<q&&(q=he),he>K&&(K=he),re<z&&(z=re),re>W&&(W=re))}K==-1&&(q=z=K=W=0),j&&((1&q)==1&&q--,(1&z)==1&&z--),R={x:q,y:z,width:K-q+1,height:W-z+1};const H=x[k];H.rect=R,H.blend=1,H.img=new Uint8Array(R.width*R.height*4),x[k-1].dispose==0?(e(C,N,P,H.img,R.width,R.height,-R.x,-R.y,0),f(L,N,P,H.img,R)):e(L,N,P,H.img,R.width,R.height,-R.x,-R.y,0)}function f(w,N,P,x,k){e(w,N,P,x,k.width,k.height,-k.x,-k.y,2)}function v(w,N,P,x,k,R,j){const I=[];let S,C=[0,1,2,3,4];R!=-1?C=[R]:(N*x>5e5||P==1)&&(C=[0]),j&&(S={level:0});const G=iy;for(var V=0;V<C.length;V++){for(let q=0;q<N;q++)g(k,w,q,x,P,C[V]);I.push(G.deflate(k,S))}let L,X=1e9;for(V=0;V<I.length;V++)I[V].length<X&&(L=V,X=I[V].length);return I[L]}function g(w,N,P,x,k,R){const j=P*x;let I=j+P;if(w[I]=R,I++,R==0)if(x<500)for(var S=0;S<x;S++)w[I+S]=N[j+S];else w.set(new Uint8Array(N.buffer,j,x),I);else if(R==1){for(S=0;S<k;S++)w[I+S]=N[j+S];for(S=k;S<x;S++)w[I+S]=N[j+S]-N[j+S-k]+256&255}else if(P==0){for(S=0;S<k;S++)w[I+S]=N[j+S];if(R==2)for(S=k;S<x;S++)w[I+S]=N[j+S];if(R==3)for(S=k;S<x;S++)w[I+S]=N[j+S]-(N[j+S-k]>>1)+256&255;if(R==4)for(S=k;S<x;S++)w[I+S]=N[j+S]-s(N[j+S-k],0,0)+256&255}else{if(R==2)for(S=0;S<x;S++)w[I+S]=N[j+S]+256-N[j+S-x]&255;if(R==3){for(S=0;S<k;S++)w[I+S]=N[j+S]+256-(N[j+S-x]>>1)&255;for(S=k;S<x;S++)w[I+S]=N[j+S]+256-(N[j+S-x]+N[j+S-k]>>1)&255}if(R==4){for(S=0;S<k;S++)w[I+S]=N[j+S]+256-s(0,N[j+S-x],0)&255;for(S=k;S<x;S++)w[I+S]=N[j+S]+256-s(N[j+S-k],N[j+S-x],N[j+S-k-x])&255}}}function b(w,N){const P=new Uint8Array(w),x=P.slice(0),k=new Uint32Array(x.buffer),R=$(x,N),j=R[0],I=R[1],S=P.length,C=new Uint8Array(S>>2);let G;if(P.length<2e7)for(var V=0;V<S;V+=4)G=T(j,L=P[V]*(1/255),X=P[V+1]*(1/255),q=P[V+2]*(1/255),z=P[V+3]*(1/255)),C[V>>2]=G.ind,k[V>>2]=G.est.rgba;else for(V=0;V<S;V+=4){var L=P[V]*.00392156862745098,X=P[V+1]*(1/255),q=P[V+2]*(1/255),z=P[V+3]*(1/255);for(G=j;G.left;)G=F(G.est,L,X,q,z)<=0?G.left:G.right;C[V>>2]=G.ind,k[V>>2]=G.est.rgba}return{abuf:x.buffer,inds:C,plte:I}}function $(w,N,P){P==null&&(P=1e-4);const x=new Uint32Array(w.buffer),k={i0:0,i1:w.length,bst:null,est:null,tdst:0,left:null,right:null};k.bst=U(w,k.i0,k.i1),k.est=A(k.bst);const R=[k];for(;R.length<N;){let I=0,S=0;for(var j=0;j<R.length;j++)R[j].est.L>I&&(I=R[j].est.L,S=j);if(I<P)break;const C=R[S],G=M(w,x,C.i0,C.i1,C.est.e,C.est.eMq255);if(C.i0>=G||C.i1<=G){C.est.L=0;continue}const V={i0:C.i0,i1:G,bst:null,est:null,tdst:0,left:null,right:null};V.bst=U(w,V.i0,V.i1),V.est=A(V.bst);const L={i0:G,i1:C.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:C.bst.N-V.bst.N},j=0;j<16;j++)L.bst.R[j]=C.bst.R[j]-V.bst.R[j];for(j=0;j<4;j++)L.bst.m[j]=C.bst.m[j]-V.bst.m[j];L.est=A(L.bst),C.left=V,C.right=L,R[S]=V,R.push(L)}for(R.sort((I,S)=>S.bst.N-I.bst.N),j=0;j<R.length;j++)R[j].ind=j;return[k,R]}function T(w,N,P,x,k){if(w.left==null)return w.tdst=function(V,L,X,q,z){const K=L-V[0],W=X-V[1],H=q-V[2],ne=z-V[3];return K*K+W*W+H*H+ne*ne}(w.est.q,N,P,x,k),w;const R=F(w.est,N,P,x,k);let j=w.left,I=w.right;R>0&&(j=w.right,I=w.left);const S=T(j,N,P,x,k);if(S.tdst<=R*R)return S;const C=T(I,N,P,x,k);return C.tdst<S.tdst?C:S}function F(w,N,P,x,k){const{e:R}=w;return R[0]*N+R[1]*P+R[2]*x+R[3]*k-w.eMq}function M(w,N,P,x,k,R){for(x-=4;P<x;){for(;E(w,P,k)<=R;)P+=4;for(;E(w,x,k)>R;)x-=4;if(P>=x)break;const j=N[P>>2];N[P>>2]=N[x>>2],N[x>>2]=j,P+=4,x-=4}for(;E(w,P,k)>R;)P-=4;return P+4}function E(w,N,P){return w[N]*P[0]+w[N+1]*P[1]+w[N+2]*P[2]+w[N+3]*P[3]}function U(w,N,P){const x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=[0,0,0,0],R=P-N>>2;for(let j=N;j<P;j+=4){const I=w[j]*.00392156862745098,S=w[j+1]*(1/255),C=w[j+2]*(1/255),G=w[j+3]*(1/255);k[0]+=I,k[1]+=S,k[2]+=C,k[3]+=G,x[0]+=I*I,x[1]+=I*S,x[2]+=I*C,x[3]+=I*G,x[5]+=S*S,x[6]+=S*C,x[7]+=S*G,x[10]+=C*C,x[11]+=C*G,x[15]+=G*G}return x[4]=x[1],x[8]=x[2],x[9]=x[6],x[12]=x[3],x[13]=x[7],x[14]=x[11],{R:x,m:k,N:R}}function A(w){const{R:N}=w,{m:P}=w,{N:x}=w,k=P[0],R=P[1],j=P[2],I=P[3],S=x==0?0:1/x,C=[N[0]-k*k*S,N[1]-k*R*S,N[2]-k*j*S,N[3]-k*I*S,N[4]-R*k*S,N[5]-R*R*S,N[6]-R*j*S,N[7]-R*I*S,N[8]-j*k*S,N[9]-j*R*S,N[10]-j*j*S,N[11]-j*I*S,N[12]-I*k*S,N[13]-I*R*S,N[14]-I*j*S,N[15]-I*I*S],G=C,V=D;let L=[Math.random(),Math.random(),Math.random(),Math.random()],X=0,q=0;if(x!=0)for(let K=0;K<16&&(L=V.multVec(G,L),q=Math.sqrt(V.dot(L,L)),L=V.sml(1/q,L),!(K!=0&&Math.abs(q-X)<1e-9));K++)X=q;const z=[k*S,R*S,j*S,I*S];return{Cov:C,q:z,e:L,L:X,eMq255:V.dot(V.sml(255,z),L),eMq:V.dot(L,z),rgba:(Math.round(255*z[3])<<24|Math.round(255*z[2])<<16|Math.round(255*z[1])<<8|Math.round(255*z[0])<<0)>>>0}}var D={multVec:(w,N)=>[w[0]*N[0]+w[1]*N[1]+w[2]*N[2]+w[3]*N[3],w[4]*N[0]+w[5]*N[1]+w[6]*N[2]+w[7]*N[3],w[8]*N[0]+w[9]*N[1]+w[10]*N[2]+w[11]*N[3],w[12]*N[0]+w[13]*N[1]+w[14]*N[2]+w[15]*N[3]],dot:(w,N)=>w[0]*N[0]+w[1]*N[1]+w[2]*N[2]+w[3]*N[3],sml:(w,N)=>[w*N[0],w*N[1],w*N[2],w*N[3]]};Js.encode=function(N,P,x,k,R,j,I){k==null&&(k=0),I==null&&(I=!1);const S=a(N,P,x,k,[!1,!1,!1,0,I,!1]);return h(S,-1),u(S,P,x,R,j)},Js.encodeLL=function(N,P,x,k,R,j,I,S){const C={ctype:0+(k==1?0:2)+(R==0?0:4),depth:j,frames:[]},G=(k+R)*j,V=G*P;for(let L=0;L<N.length;L++)C.frames.push({rect:{x:0,y:0,width:P,height:x},img:new Uint8Array(N[L]),blend:0,dispose:1,bpp:Math.ceil(G/8),bpl:Math.ceil(V/8)});return h(C,0,!0),u(C,P,x,I,S)},Js.encode.compress=a,Js.encode.dither=l,Js.quantize=b,Js.quantize.getKDtree=$,Js.quantize.getNearest=T})();const Su={toArrayBuffer(e,t){const s=e.width,n=e.height,o=s<<2,i=e.getContext("2d").getImageData(0,0,s,n),c=new Uint32Array(i.data.buffer),l=(32*s+31)/32<<2,u=l*n,h=122+u,a=new ArrayBuffer(h),d=new DataView(a),f=1<<20;let v,g,b,$,T=f,F=0,M=0,E=0;function U(w){d.setUint16(M,w,!0),M+=2}function A(w){d.setUint32(M,w,!0),M+=4}function D(w){M+=w}U(19778),A(h),D(4),A(122),A(108),A(s),A(-n>>>0),U(1),U(32),A(3),A(u),A(2835),A(2835),D(8),A(16711680),A(65280),A(255),A(4278190080),A(1466527264),function w(){for(;F<n&&T>0;){for($=122+F*l,v=0;v<o;)T--,g=c[E++],b=g>>>24,d.setUint32($+v,g<<8|b),v+=4;F++}E<c.length?(T=f,setTimeout(w,Su._dly)):t(a)}()},toBlob(e,t){this.toArrayBuffer(e,s=>{t(new Blob([s],{type:"image/bmp"}))})},_dly:9};var Is={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},ay={[Is.CHROME]:16384,[Is.FIREFOX]:11180,[Is.DESKTOP_SAFARI]:16384,[Is.IE]:8192,[Is.IOS]:4096,[Is.ETC]:8192};const rc=typeof window<"u",Cu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ko=rc&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),cy=(rc||Cu)&&(Ko&&Ko.getOriginalSymbol(window,"File")||typeof File<"u"&&File),ku=(rc||Cu)&&(Ko&&Ko.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function oc(e,t,s=Date.now()){return new Promise(n=>{const o=e.split(","),i=o[0].match(/:(.*?);/)[1],c=globalThis.atob(o[1]);let l=c.length;const u=new Uint8Array(l);for(;l--;)u[l]=c.charCodeAt(l);const h=new Blob([u],{type:i});h.name=t,h.lastModified=s,n(h)})}function Nu(e){return new Promise((t,s)=>{const n=new ku;n.onload=()=>t(n.result),n.onerror=o=>s(o),n.readAsDataURL(e)})}function Eu(e){return new Promise((t,s)=>{const n=new Image;n.onload=()=>t(n),n.onerror=o=>s(o),n.src=e})}function Kn(){if(Kn.cachedResult!==void 0)return Kn.cachedResult;let e=Is.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=Is.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=Is.IOS:/Safari/i.test(t)?e=Is.DESKTOP_SAFARI:/Firefox/i.test(t)?e=Is.FIREFOX:(/MSIE/i.test(t)||document.documentMode)&&(e=Is.IE),Kn.cachedResult=e,Kn.cachedResult}function Tu(e,t){const s=Kn(),n=ay[s];let o=e,i=t,c=o*i;const l=o>i?i/o:o/i;for(;c>n*n;){const u=(n+o)/2,h=(n+i)/2;u<h?(i=h,o=h*l):(i=u*l,o=u),c=o*i}return{width:o,height:i}}function pi(e,t){let s,n;try{if(s=new OffscreenCanvas(e,t),n=s.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{s=document.createElement("canvas"),n=s.getContext("2d")}return s.width=e,s.height=t,[s,n]}function Au(e,t){const{width:s,height:n}=Tu(e.width,e.height),[o,i]=pi(s,n);return t&&/jpe?g/.test(t)&&(i.fillStyle="white",i.fillRect(0,0,o.width,o.height)),i.drawImage(e,0,0,o.width,o.height),o}function zo(){return zo.cachedResult!==void 0||(zo.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),zo.cachedResult}function Jo(e,t={}){return new Promise(function(s,n){let o,i;var c=function(){try{return i=Au(o,t.fileType||e.type),s([o,i])}catch(u){return n(u)}},l=function(u){try{var h=function(a){try{throw a}catch(d){return n(d)}};try{let a;return Nu(e).then(function(d){try{return a=d,Eu(a).then(function(f){try{return o=f,function(){try{return c()}catch(v){return n(v)}}()}catch(v){return h(v)}},h)}catch(f){return h(f)}},h)}catch(a){h(a)}}catch(a){return n(a)}};try{if(zo()||[Is.DESKTOP_SAFARI,Is.MOBILE_SAFARI].includes(Kn()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(u){try{return o=u,c()}catch{return l()}},l)}catch{l()}})}function Qo(e,t,s,n,o=1){return new Promise(function(i,c){let l;if(t==="image/png"){let h,a,d;return h=e.getContext("2d"),{data:a}=h.getImageData(0,0,e.width,e.height),d=Js.encode([a.buffer],e.width,e.height,4096*o),l=new Blob([d],{type:t}),l.name=s,l.lastModified=n,u.call(this)}{let h=function(){return u.call(this)};if(t==="image/bmp")return new Promise(a=>Su.toBlob(e,a)).then((function(a){try{return l=a,l.name=s,l.lastModified=n,h.call(this)}catch(d){return c(d)}}).bind(this),c);{let a=function(){return h.call(this)};if(typeof OffscreenCanvas=="function"&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:o}).then((function(d){try{return l=d,l.name=s,l.lastModified=n,a.call(this)}catch(f){return c(f)}}).bind(this),c);{let d;return d=e.toDataURL(t,o),oc(d,s,n).then((function(f){try{return l=f,a.call(this)}catch(v){return c(v)}}).bind(this),c)}}}function u(){return i(l)}})}function ln(e){e.width=0,e.height=0}function fr(){return new Promise(function(e,t){let s,n,o,i;return fr.cachedResult!==void 0?e(fr.cachedResult):oc("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(c){try{return s=c,Jo(s).then(function(l){try{return n=l[1],Qo(n,s.type,s.name,s.lastModified).then(function(u){try{return o=u,ln(n),Jo(o).then(function(h){try{return i=h[0],fr.cachedResult=i.width===1&&i.height===2,e(fr.cachedResult)}catch(a){return t(a)}},t)}catch(h){return t(h)}},t)}catch(u){return t(u)}},t)}catch(l){return t(l)}},t)})}function ju(e){return new Promise((t,s)=>{const n=new ku;n.onload=o=>{const i=new DataView(o.target.result);if(i.getUint16(0,!1)!=65496)return t(-2);const c=i.byteLength;let l=2;for(;l<c;){if(i.getUint16(l+2,!1)<=8)return t(-1);const u=i.getUint16(l,!1);if(l+=2,u==65505){if(i.getUint32(l+=2,!1)!=1165519206)return t(-1);const h=i.getUint16(l+=6,!1)==18761;l+=i.getUint32(l+4,h);const a=i.getUint16(l,h);l+=2;for(let d=0;d<a;d++)if(i.getUint16(l+12*d,h)==274)return t(i.getUint16(l+12*d+8,h))}else{if((65280&u)!=65280)break;l+=i.getUint16(l,!1)}}return t(-1)},n.onerror=o=>s(o),n.readAsArrayBuffer(e)})}function Iu(e,t){const{width:s}=e,{height:n}=e,{maxWidthOrHeight:o}=t;let i,c=e;return isFinite(o)&&(s>o||n>o)&&([c,i]=pi(s,n),s>n?(c.width=o,c.height=n/s*o):(c.width=s/n*o,c.height=o),i.drawImage(e,0,0,c.width,c.height),ln(e)),c}function $u(e,t){const{width:s}=e,{height:n}=e,[o,i]=pi(s,n);switch(t>4&&t<9?(o.width=n,o.height=s):(o.width=s,o.height=n),t){case 2:i.transform(-1,0,0,1,s,0);break;case 3:i.transform(-1,0,0,-1,s,n);break;case 4:i.transform(1,0,0,-1,0,n);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,n,0);break;case 7:i.transform(0,-1,-1,0,n,s);break;case 8:i.transform(0,-1,1,0,0,s)}return i.drawImage(e,0,0,s,n),ln(e),o}function ul(e,t,s=0){return new Promise(function(n,o){let i,c,l,u,h,a,d,f,v,g,b,$,T,F,M,E,U,A,D,w;function N(x=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;i+=x,t.onProgress(Math.min(i,100))}function P(x){if(t.signal&&t.signal.aborted)throw t.signal.reason;i=Math.min(Math.max(x,i),100),t.onProgress(i)}return i=s,c=t.maxIteration||10,l=1024*t.maxSizeMB*1024,N(),Jo(e,t).then((function(x){try{return[,u]=x,N(),h=Iu(u,t),N(),new Promise(function(k,R){var j;if(!(j=t.exifOrientation))return ju(e).then((function(S){try{return j=S,I.call(this)}catch(C){return R(C)}}).bind(this),R);function I(){return k(j)}return I.call(this)}).then((function(k){try{return a=k,N(),fr().then((function(R){try{return d=R?h:$u(h,a),N(),f=t.initialQuality||1,v=t.fileType||e.type,Qo(d,v,e.name,e.lastModified,f).then((function(j){try{{let S=function(){if(c--&&(M>l||M>T)){let G,V;return G=w?.95*D.width:D.width,V=w?.95*D.height:D.height,[U,A]=pi(G,V),A.drawImage(D,0,0,G,V),f*=v==="image/png"?.85:.95,Qo(U,v,e.name,e.lastModified,f).then(function(L){try{return E=L,ln(D),D=U,M=E.size,P(Math.min(99,Math.floor((F-M)/(F-l)*100))),S}catch(X){return o(X)}},o)}return[1]},C=function(){return ln(D),ln(U),ln(h),ln(d),ln(u),P(100),n(E)};if(g=j,N(),b=g.size>l,$=g.size>e.size,!b&&!$)return P(100),n(g);var I;return T=e.size,F=g.size,M=F,D=d,w=!t.alwaysKeepResolution&&b,(I=(function(G){for(;G;){if(G.then)return void G.then(I,o);try{if(G.pop){if(G.length)return G.pop()?C.call(this):G;G=S}else G=G.call(this)}catch(V){return o(V)}}}).bind(this))(S)}}catch(S){return o(S)}}).bind(this),o)}catch(j){return o(j)}}).bind(this),o)}catch(R){return o(R)}}).bind(this),o)}catch(k){return o(k)}}).bind(this),o)})}const ly=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let ea;function dy(e,t){return new Promise((s,n)=>{ea||(ea=function(c){const l=[];return l.push(c),URL.createObjectURL(new Blob(l))}(ly));const o=new Worker(ea);o.addEventListener("message",function(c){if(t.signal&&t.signal.aborted)o.terminate();else if(c.data.progress===void 0){if(c.data.error)return n(new Error(c.data.error)),void o.terminate();s(c.data.file),o.terminate()}else t.onProgress(c.data.progress)}),o.addEventListener("error",n),t.signal&&t.signal.addEventListener("abort",()=>{n(t.signal.reason),o.terminate()}),o.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})})}function ks(e,t){return new Promise(function(s,n){let o,i,c,l,u,h;if(o={...t},c=0,{onProgress:l}=o,o.maxSizeMB=o.maxSizeMB||Number.POSITIVE_INFINITY,u=typeof o.useWebWorker!="boolean"||o.useWebWorker,delete o.useWebWorker,o.onProgress=v=>{c=v,typeof l=="function"&&l(c)},!(e instanceof Blob||e instanceof cy))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return n(new Error("The file given is not an image"));if(h=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!u||typeof Worker!="function"||h)return ul(e,o).then((function(v){try{return i=v,f.call(this)}catch(g){return n(g)}}).bind(this),n);var a=(function(){try{return f.call(this)}catch(v){return n(v)}}).bind(this),d=function(v){try{return ul(e,o).then(function(g){try{return i=g,a()}catch(b){return n(b)}},n)}catch(g){return n(g)}};try{return o.libURL=o.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",dy(e,o).then(function(v){try{return i=v,a()}catch{return d()}},d)}catch{d()}function f(){try{i.name=e.name,i.lastModified=e.lastModified}catch{}try{o.preserveExif&&e.type==="image/jpeg"&&(!o.fileType||o.fileType&&o.fileType===e.type)&&(i=xu(e,i))}catch{}return s(i)}})}ks.getDataUrlFromFile=Nu,ks.getFilefromDataUrl=oc,ks.loadImage=Eu,ks.drawImageInCanvas=Au,ks.drawFileInCanvas=Jo,ks.canvasToFile=Qo,ks.getExifOrientation=ju,ks.handleMaxWidthOrHeight=Iu,ks.followExifOrientation=$u,ks.cleanupCanvasMemory=ln,ks.isAutoOrientationInBrowser=fr,ks.approximateBelowMaximumCanvasSizeOfBrowser=Tu,ks.copyExifWithoutOrientation=xu,ks.getBrowserName=Kn,ks.version="2.0.2";const Ge=Ze.create("usePhotoManagement"),nr=()=>{const e=wu(),{refreshUserData:t}=Bn(),[s,n]=p.useState(!1),[o,i]=p.useState(0),[c,l]=p.useState(!1),[u,h]=p.useState({}),[a,d]=p.useState([]),[f,v]=p.useState(!1),[g,b]=p.useState(0),$=p.useRef(!1),T=p.useRef(500),F=3,M="mandarin_pending_uploads";p.useEffect(()=>{try{const L=localStorage.getItem(M);if(L){const X=JSON.parse(L);Array.isArray(X)&&X.length>0&&(d(X),Ge.debug(`Loaded ${X.length} pending uploads from localStorage`))}}catch(L){Ge.error("Error loading pending uploads from localStorage:",L)}},[]);const E=L=>{try{L.length>0?localStorage.setItem(M,JSON.stringify(L)):localStorage.removeItem(M)}catch(X){Ge.error("Error saving pending uploads to localStorage:",X)}},U=p.useCallback(L=>{d(X=>{if(X.some(K=>K.file.name===L.file.name&&K.file.size===L.file.size&&K.file.lastModified===L.file.lastModified))return Ge.debug("Upload already in queue, skipping duplicate:",L.file.name),X;const z=[...X,L];return E(z),Ge.debug("Added upload to queue:",{fileName:L.file.name,queueLength:z.length}),z})},[]),A=p.useCallback(L=>{const X=typeof window<"u"?window.__url_normalization_cache:null;L?X&&(X.delete(L),X.delete(`${L}:true`),Ge.debug(`Cleared cache for specific URL: ${L}`)):X&&(X.clear(),Ge.debug("Cleared entire URL cache"))},[]),D=p.useCallback((L=!1)=>{if(A(),L&&typeof window<"u"){Ge.debug("Forcing complete page refresh by reloading the window"),window.location.reload();return}if(typeof window<"u"){window.__photo_refresh_timestamp=Date.now();const X=new CustomEvent("avatar:refresh",{detail:{timestamp:window.__photo_refresh_timestamp}});window.dispatchEvent(X),document.body.classList.add("photo-refreshed"),setTimeout(()=>{document.body.classList.remove("photo-refreshed")},100);const q=window.scrollY;document.body.style.zoom="99.99%",setTimeout(()=>{document.body.style.zoom="100%",window.scrollTo(0,q)},50),Ge.debug("Avatar refresh event dispatched with timestamp:",window.__photo_refresh_timestamp)}},[A]);p.useEffect(()=>{const L=async()=>{var K,W;if(!navigator.onLine||s||f||a.length===0)return;Ge.debug(`Processing ${a.length} pending uploads`),v(!0);const[q,...z]=a;try{const H=await N(q);if(H&&H._id)Ge.debug("Upload retry successful, removing from queue"),d(z),E(z),b(0),Z.success("Photo uploaded successfully");else throw new Error("Upload result missing expected data")}catch(H){if(Ge.error("Failed to process pending upload:",H),((W=(K=H.response)==null?void 0:K.data)==null?void 0:W.success)===!0){Ge.warn("Error thrown but response indicates success - treating as successful"),d(z),E(z),b(0),Z.success("Photo uploaded successfully");return}const ne=g+1;b(ne);const Q=H.message||"Unknown error";ne>=F?(d(z),E(z),H.shouldRetry===!1?Z.error(Q):Z.error(`Failed to upload photo after ${F} attempts: ${Q}`),b(0)):Z.info(`Retrying photo upload (${ne}/${F}) - ${Q}`)}finally{v(!1)}};navigator.onLine&&L();const X=()=>{Z.info("Back online. Resuming photo uploads..."),L()};return window.addEventListener("online",X),()=>{window.removeEventListener("online",X)}},[a,s,f,g]);const w=async(L,X={})=>{const q={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:L.type};try{Ge.debug(`Compressing image: ${L.name} (${(L.size/1024/1024).toFixed(2)}MB)`);const z=await ks(L,{...q,...X});return Ge.debug(`Compression complete: ${z.name} (${(z.size/1024/1024).toFixed(2)}MB)`),z}catch(z){return Ge.error("Image compression error:",z),L}},N=async L=>{var W,H;if(!L||!L.file)throw new Error("Invalid upload data");const{file:X,privacy:q,shouldSetAsProfile:z}=L;Ge.debug("Processing upload:",{fileName:X.name,fileSize:X.size,privacy:q,shouldSetAsProfile:z,isNewRegistration:L.isNewRegistration,retry:L.retry,previousError:L.error});const K=new FormData;K.append("photo",X),K.append("privacy",q||"private"),z&&K.append("isProfile","true"),L.isNewRegistration&&(Ge.debug(`Waiting ${T.current}ms for token processing`),await new Promise(ne=>setTimeout(ne,T.current)),T.current=Math.min(3e3,T.current*1.5)),n(!0),i(0);try{Ge.debug("Starting upload to /users/photos");const ne=await e.upload("/users/photos",K,Q=>{const he=Math.round(Q.loaded*100/Q.total);i(he),L.onProgress&&typeof L.onProgress=="function"&&L.onProgress(he)});if(Ge.debug("Upload response:",ne),ne&&ne.success===!0&&ne.data)return D(),await new Promise(Q=>setTimeout(Q,300)),Ge.debug("Upload successful:",ne.data),ne.data;{const Q=new Error((ne==null?void 0:ne.error)||(ne==null?void 0:ne.message)||"Failed to upload photo - unexpected response");if(Ge.error("Upload failed with response:",ne),(ne==null?void 0:ne.success)===!0)return Ge.warn("Response indicates success but in unexpected format"),ne.data||ne.photo||ne;throw Q}}catch(ne){throw Ge.error("Upload error in processUpload:",{message:ne.message,response:ne.response,status:(W=ne.response)==null?void 0:W.status,data:(H=ne.response)==null?void 0:H.data}),ne}finally{n(!1),i(0)}},P=p.useCallback(()=>`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[]),x=p.useCallback(async(L,X="private",q,z=!1,K={})=>{var _e,ke;if(!L)throw new Error("No file provided");const W=["image/jpeg","image/jpg","image/png","image/gif"];if(!W.includes(L.type))throw Ge.error(`Invalid file type: ${L.type}. Allowed types: ${W.join(", ")}`),new Error(`Invalid file type. Only JPEG, PNG, and GIF images are allowed. You uploaded: ${L.type}`);const H=5*1024*1024;if(L.size>H)throw Ge.error(`File too large: ${L.size} bytes (${(L.size/1024/1024).toFixed(2)}MB)`),new Error(`File size exceeds 5MB limit. Your file is ${(L.size/1024/1024).toFixed(2)}MB`);X&&!["public","private","friends_only"].includes(X)&&(X="private");const{isNewRegistration:ne=!1,compressImage:Q=!0,addToQueueOnFailure:he=!0,compressionOptions:re={}}=K;try{let Be=L;if(Q&&L.size>500*1024&&(Be=await w(L,re)),!navigator.onLine){Ge.debug("Device is offline. Adding upload to queue."),Z.info("You appear to be offline. The photo will upload when connection is restored.");const Le={file:Be,privacy:X,shouldSetAsProfile:z,onProgress:q,isNewRegistration:ne,timestamp:Date.now()};return U(Le),{queued:!0,message:"Upload queued until online"}}n(!0),i(0),ne&&(Ge.debug(`Waiting ${T.current}ms for token processing`),await new Promise(Le=>setTimeout(Le,T.current)));const Oe=new FormData;Oe.append("photo",Be),Oe.append("privacy",X),z&&Oe.append("isProfile","true");const Se=await e.upload("/users/photos",Oe,Le=>{const Me=Math.round(Le.loaded*100/Le.total);i(Me),q&&typeof q=="function"&&q(Me)});if(Ge.debug("Upload response structure:",{hasResponse:!!Se,hasSuccess:!!(Se!=null&&Se.success),hasData:!!(Se!=null&&Se.data),keys:Se?Object.keys(Se):[],response:Se}),Se&&Se.success===!0&&Se.data)return D(),await new Promise(Le=>setTimeout(Le,300)),T.current=500,Ge.debug("Upload successful, returning photo data:",Se.data),Se.data;throw Ge.error("Upload response not in expected format:",Se),new Error((Se==null?void 0:Se.error)||(Se==null?void 0:Se.message)||"Upload failed - unexpected response format")}catch(Be){Ge.error("Photo upload error:",Be);let Oe=Be.message||"Failed to upload photo",Se=!0;if(Be.response){const Me=Be.response.status,He=Be.response.data;Me===400?He!=null&&He.error?(Oe=He.error,(Oe.includes("Max 10 photos")||Oe.includes("Only jpg/png/gif images allowed")||Oe.includes("No file uploaded"))&&(Se=!1)):Oe="Bad request: Request failed with status code 400":Me===401?(Oe="Authentication expired. Please log in again.",Se=!1):Me===413?(Oe="File too large. Maximum size is 5MB.",Se=!1):Me===429?Oe="Too many requests. Please wait a moment.":Me>=500?Oe="Server error. Will retry automatically.":He!=null&&He.error&&(Oe=He.error)}else navigator.onLine||(Oe="No internet connection. Will retry when online.");if(he&&Se&&navigator.onLine){Ge.debug("Adding failed upload to retry queue",{errorMessage:Oe,shouldRetry:Se,errorCode:(_e=Be.response)==null?void 0:_e.status});const Me=(ke=Be.response)==null?void 0:ke.data;if((Me==null?void 0:Me.success)===!0&&(Me!=null&&Me.data))return Ge.warn("Not adding to retry queue - response indicates success despite error throw"),Me.data;const He={file:L,privacy:X,shouldSetAsProfile:z,onProgress:q,isNewRegistration:ne,timestamp:Date.now(),retry:!0,error:Oe};U(He),Z.info("Upload failed. Will retry automatically.")}else Se||Z.error(Oe);const Le=new Error(Oe);throw Le.originalError=Be,Le.shouldRetry=Se,Le}finally{n(!1),i(0)}},[e,D,U,w]),k=p.useCallback(async(L,X,q)=>{if(!L)throw new Error("No photo ID provided");if(!["public","private","friends_only"].includes(X))throw new Error("Privacy must be 'public', 'private', or 'friends_only'");if(!$.current){if(typeof L=="string"&&L.startsWith("temp-")){Z.warning("Please wait for the photo to finish uploading");return}$.current=!0,l(!0);try{const z=await e.put(`/users/photos/${L}/privacy`,{privacy:X}),K=(z==null?void 0:z.data)||z;return D(),q&&await t(q,!0),K}catch(z){throw Ge.error("Photo privacy update error:",z),z}finally{$.current=!1,l(!1)}}},[e,t,D]),R=p.useCallback(async(L,X)=>{if(!L)throw new Error("No photo ID provided");if(!$.current){if(typeof L=="string"&&L.startsWith("temp-")){Z.warning("Please wait for the photo to finish uploading");return}$.current=!0,l(!0);try{const q=await e.get("/auth/me");if(!q||!q.photos)throw new Error("Failed to get user information");const z=q.photos.find(H=>H._id===L);if(!z)throw new Error("Photo not found");const W=(z.privacy||"private")==="private"?"public":"private";return await k(L,W,X)}catch(q){throw Ge.error("Photo privacy toggle error:",q),q}finally{$.current=!1,l(!1)}}},[e,k]),j=p.useCallback(async(L,X)=>{var q;if(!L)throw new Error("No photo ID provided");if(!$.current){if(typeof L=="string"&&L.startsWith("temp-")){Z.warning("Please wait for the photo to finish uploading");return}$.current=!0,l(!0);try{const z=await e.get("/auth/me"),K=(q=z==null?void 0:z.photos)==null?void 0:q.find(ne=>ne._id===L);K&&(K.privacy==="private"||K.privacy==="friends_only"||K.isPrivate)&&(Ge.debug(`Setting photo ${L} to public because it's being set as profile photo`),await e.put(`/users/photos/${L}/privacy`,{privacy:"public"}));const W=await e.put(`/users/photos/${L}/profile`),H=(W==null?void 0:W.data)||W;return A(),D(),X&&await t(X,!0),H}catch(z){throw Ge.error("Set profile photo error:",z),z}finally{$.current=!1,l(!1)}}},[e,t,A,D]),I=p.useCallback(async(L,X)=>{var q;if(!L)throw new Error("No photo ID provided");if(!$.current){if(typeof L=="string"&&L.startsWith("temp-"))return!0;$.current=!0,l(!0);try{Ge.debug("Checking if photo is profile photo:",L);const z=await e.get("/auth/me"),K=(q=z==null?void 0:z.photos)==null?void 0:q.find(H=>H._id===L);if(K!=null&&K.isProfile)throw new Error("Cannot delete profile photo. Set another photo as profile first.");Ge.debug("Sending delete request for photo:",L);const W=await e.delete(`/users/photos/${L}`);if(Ge.debug("Delete response:",W),(W==null?void 0:W.success)===!1||W!=null&&W.error)throw new Error(W.error||"Failed to delete photo");return Ge.debug("Photo deleted successfully"),D(),setTimeout(()=>{window.location.reload()},500),!0}catch(z){throw Ge.error("Delete photo error:",z),z}finally{$.current=!1,l(!1)}}},[e,t,D]),S=p.useCallback((L,X)=>{Ge.debug(`Image with ID ${L} failed to load`),h(q=>({...q,[L]:!0})),X&&Yr(X)},[]),C=p.useCallback(L=>!L||!Array.isArray(L)?[]:L.map(X=>X._id?X.isPrivate!==void 0&&!X.privacy?{...X,privacy:X.isPrivate?"private":"public"}:X:{...X,_id:P(),url:X.url||"/placeholder.svg",privacy:X.privacy||"private",isProfile:X.isProfile??!1,isDeleted:X.isDeleted??!1,uploadedAt:X.uploadedAt||new Date}),[P]),G=p.useCallback(L=>{if(!L||!Array.isArray(L))return[];const X=L.filter(z=>!z.isDeleted),q=C(X);return q.length>0&&!q.some(z=>z.isProfile)&&(q[0].isProfile=!0),q.forEach(z=>{(!z.privacy||!["public","private","friends_only"].includes(z.privacy))&&(z.privacy="private")}),q},[C]),V=p.useCallback(L=>{const X=q=>{if(Ge.debug("getDefaultAvatar called with user:",q?"User object present":"No user object"),!q)return Ge.debug("No user provided, returning default avatar"),"/default-avatar.png";if(Ge.debug("User contains details.iAm:",q.details&&q.details.iAm?"YES":"NO"),q.details&&Ge.debug("User details object:",JSON.stringify(q.details)),q.details&&q.details.iAm){const z=typeof q.details.iAm=="string"?q.details.iAm.toLowerCase():"";if(Ge.debug("details.iAm value (normalized):",z),z==="woman"||z==="women"||z==="female")return Ge.debug("Returning women avatar based on details.iAm"),"/women-avatar.png";if(z==="man"||z==="male")return Ge.debug("Returning man avatar based on details.iAm"),"/man-avatar.png";if(z==="couple"||z==="other")return Ge.debug("Returning couple avatar based on details.iAm"),"/couple-avatar.png"}if(Ge.debug("User gender field:",q.gender||"Not defined"),q.gender){const z=typeof q.gender=="string"?q.gender.toLowerCase():"";if(z==="female"||z==="woman"||z==="women")return Ge.debug("Returning women avatar based on gender field"),"/women-avatar.png";if(z==="male"||z==="man")return Ge.debug("Returning man avatar based on gender field"),"/man-avatar.png";if(z==="couple"||z==="other")return Ge.debug("Returning couple avatar based on gender field"),"/couple-avatar.png"}return Ge.debug("No matching gender/identity found, returning default avatar"),"/default-avatar.png"};if(!L)return Ns(X());if(L.photos){const q=L.photos;if(Ge.debug(`User has photos array with ${q?q.length:0} photos`),q&&q.length>0&&Ge.debug(`First photo URL: ${q[0].url||"undefined"}`),!q||q.length===0)return Ge.debug("No photos found, returning gender-specific avatar"),Ns(X(L),!0);const z=q.filter(W=>!W.isDeleted&&W.url);if(Ge.debug(`User has ${z.length} non-deleted photos with URLs`),z.length===0)return Ge.debug("No available photos after filtering, returning gender-specific avatar"),Ns(X(L),!0);const K=z.find(W=>W.isProfile===!0);return K&&K.url?(Ge.debug("Found profile photo with URL:",K.url),Ns(K.url,!0)):(Ge.debug("No profile photo found, using first available photo:",z[0].url),Ns(z[0].url,!0))}if(Array.isArray(L)){if(Ge.debug(`Received photos array with ${L.length} items`),L.length===0)return Ge.debug("Empty photos array, returning default avatar"),Ns("/default-avatar.png",!0);const q=L.filter(K=>!K.isDeleted&&K.url);if(Ge.debug(`Found ${q.length} available photos after filtering`),q.length===0)return Ge.debug("No available photos after filtering, returning default avatar"),Ns("/default-avatar.png",!0);const z=q.find(K=>K.isProfile===!0);return z&&z.url?(Ge.debug("Found profile photo with URL:",z.url),Ns(z.url,!0)):(Ge.debug("No profile photo found, using first available photo:",q[0].url),Ns(q[0].url,!0))}return Ns(typeof L=="string"?L:"/default-avatar.png")},[]);return{isUploading:s,uploadProgress:o,isProcessingPhoto:c,photoLoadErrors:u,pendingUploads:a,isRetrying:f,retryCount:g,uploadPhoto:x,setPhotoPrivacy:k,togglePhotoPrivacy:R,setProfilePhoto:j,deletePhoto:I,compressImage:w,processUpload:N,addToPendingUploads:U,handlePhotoLoadError:S,ensurePhotoIds:C,processPhotos:G,getProfilePhotoUrl:V,generateTempId:P,normalizePhotoUrl:Ns,clearCache:A,refreshAllAvatars:D}},ls=Ze.create("Avatar"),ta=e=>e?e.includes("default-avatar.png")||e.includes("default-avatar.jpg"):!1,uy=(e,t)=>{const s={"video-user":"/man-avatar.png","image-user":"/women-avatar.png",mrbig111:"/man-avatar.png","test-man":"/man-avatar.png","test-woman":"/women-avatar.png","test-couple":"/couple-avatar.png"};if(e&&s[e])return s[e];{if(s[t])return s[t];const n=t.toLowerCase();if(n.includes("mr")||n.includes("man")||n.includes("guy"))return"/man-avatar.png";if(n.includes("ms")||n.includes("mrs")||n.includes("woman")||n.includes("girl")||n.includes("lady"))return"/women-avatar.png";if(n.includes("couple")||n.includes("pair")||n.includes("together"))return"/couple-avatar.png"}return null},Pu=({src:e,alt:t,size:s="medium",status:n=null,className:o="",onClick:i,online:c=!1,placeholder:l="/default-avatar.png",statusPosition:u="bottom-right",showFallback:h=!0,user:a=null,showOnlineStatus:d=!1})=>{const{normalizePhotoUrl:f,getProfilePhotoUrl:v,handlePhotoLoadError:g,clearCache:b}=nr(),{userSrc:$,userAlt:T,userOnline:F}=p.useMemo(()=>{var z,K,W;let L=a?v(a):e||null;const X=(a==null?void 0:a.nickname)||t||"User",q=d&&(a==null?void 0:a.isOnline)||c;if(((a==null?void 0:a._id)==="mrbig111"||X==="mrbig111")&&(a==null?void 0:a._id)!=="681f446dccf1f0d2bb3d2631")ls.debug("Immediate fix for mrbig111 user - forcing man avatar"),L=`${window.location.origin}/man-avatar.png`;else if((a==null?void 0:a._id)==="681f446dccf1f0d2bb3d2631")if(L&&!ta(L)&&!L.includes("man-avatar")&&L.includes("/uploads/images/"))try{const H=window.localStorage.getItem("user_681f446dccf1f0d2bb3d2631_photo");let ne=!0;if(H){const Q=JSON.parse(H);Q.url===L&&Q.timestamp&&Date.now()-Q.timestamp<5*60*1e3&&(ne=!1)}if(ne){const Q={url:L,timestamp:Date.now()};window.localStorage.setItem("user_681f446dccf1f0d2bb3d2631_photo",JSON.stringify(Q))}}catch{}else{let H=!1;try{const ne=window.localStorage.getItem("user_681f446dccf1f0d2bb3d2631_photo");if(ne){const Q=JSON.parse(ne);Q.url&&Q.url.includes("/uploads/images/")&&(L=Q.url,H=!0)}}catch{}H||(ls.debug("Forcing women avatar for user 681f446dccf1f0d2bb3d2631"),L=`${window.location.origin}/women-avatar.png`)}else if((a==null?void 0:a._id)==="video-user"||(a==null?void 0:a._id)==="image-user"){const H=a._id==="video-user"?"man":"women";ls.debug(`Immediate fix for ${a._id} - forcing ${H} avatar`),L=`${window.location.origin}/${H}-avatar.png`}else{const H=uy(a==null?void 0:a._id,X);if(H)ls.debug(`Applying special case avatar for ${X}:`,H),L=`${window.location.origin}${H}?_refresh=${Date.now()}`;else if(L&&ta(L)&&a){const ne=((K=(z=a.details)==null?void 0:z.iAm)==null?void 0:K.toLowerCase())||"",Q=((W=a.gender)==null?void 0:W.toLowerCase())||"";let he=null;ne==="man"||ne==="male"?he="/man-avatar.png":ne==="woman"||ne==="women"||ne==="female"?he="/women-avatar.png":ne==="couple"||ne==="other"?he="/couple-avatar.png":Q==="male"||Q==="man"?he="/man-avatar.png":Q==="female"||Q==="woman"||Q==="women"?he="/women-avatar.png":(Q==="couple"||Q==="other")&&(he="/couple-avatar.png"),he&&(ls.debug(`Replacing default avatar with gender-specific avatar for ${X}:`,he),L=`${window.location.origin}${he}`)}}return{userSrc:L,userAlt:X,userOnline:q}},[a,t,e,c,d,v]);e=$,t=T,c=F;const[M,E]=pt.useState(e),[U,A]=pt.useState(!1),[D,w]=pt.useState(""),N=pt.useRef(new Map),x=(()=>{if(l&&l!=="/default-avatar.png")return ls.debug("Using custom placeholder as default avatar:",l),l.startsWith("http")?l:`${window.location.origin}${l}`;if(a&&a.details&&a.details.iAm){if(a.details.iAm==="woman")return ls.debug("Using women-avatar for default based on iAm"),`${window.location.origin}/women-avatar.png`;if(a.details.iAm==="man")return ls.debug("Using man-avatar for default based on iAm"),`${window.location.origin}/man-avatar.png`;if(a.details.iAm==="couple")return ls.debug("Using couple-avatar for default based on iAm"),`${window.location.origin}/couple-avatar.png`}if(a&&a.gender){const L=typeof a.gender=="string"?a.gender.toLowerCase():"";if(L==="female"||L==="woman")return ls.debug("Using women-avatar for default based on gender"),`${window.location.origin}/women-avatar.png`;if(L==="male"||L==="man")return ls.debug("Using man-avatar for default based on gender"),`${window.location.origin}/man-avatar.png`;if(L==="couple"||L==="other")return ls.debug("Using couple-avatar for default based on gender"),`${window.location.origin}/couple-avatar.png`}if(a&&a._id){if(a._id==="video-user")return ls.debug("Using man-avatar for video-user"),`${window.location.origin}/man-avatar.png`;if(a._id==="image-user")return ls.debug("Using women-avatar for image-user"),`${window.location.origin}/women-avatar.png`}return ls.debug("No gender info found, using generic default avatar"),`${window.location.origin}/default-avatar.png`})(),[k]=pt.useState("avatar-"+Math.floor(Math.random()*1e4)),R=()=>{b(),A(!1),N.current.clear()};p.useEffect(()=>{const L=()=>{N.current.clear(),A(!1)};window.addEventListener("avatar:refresh",L);const X=()=>{U&&R()};return window.addEventListener("load",X),()=>{window.removeEventListener("avatar:refresh",L),window.removeEventListener("load",X)}},[U]),pt.useEffect(()=>{var L;if(e!==M||!e&&!U){if(e&&N.current.has(e)){const K=N.current.get(e);if(K.error){E(K.fallback),A(!0);return}}if(e&&typeof e=="string"&&e.includes("unsplash.com")){E(x),A(!0);return}const X=a&&((L=a.photos)==null?void 0:L.length)>0,q=N.current.has(e);let z;X&&!q?(z=f(e,!0),N.current.set(e,{processed:z,error:!1})):q&&!N.current.get(e).error?z=N.current.get(e).processed:z=f(e,!1),E(z),A(!1),e&&typeof e=="string"&&/^[0-9a-f]{24}$/i.test(e)&&ls.debug(`Avatar for user ID: ${e}`)}},[e,x,M,U,f,a]);const j=pt.useRef(new Map),I=L=>{const X=L.target.src;w(`Failed to load image: ${X}`);const q=typeof e=="string"&&/\d+-\d+\.(jpg|jpeg|png|gif|webp)$/i.test(e);j.current.has(e)||j.current.set(e,0);const z=j.current.get(e),K=q?3:1;if(X.includes("unsplash.com")||ls.error(`Image failed to load: ${X}`,{originalSrc:e,attempt:z+1,maxRetries:K}),z<K){j.current.set(e,z+1),setTimeout(()=>{N.current.delete(e);const H=f(e,!0);ls.debug(`Retrying image load (${z+1}/${K}): ${H}`),E(H),A(!1)},q?1500:500);return}if(h){const W=x;e&&(N.current.set(e,{error:!0,fallback:W}),X&&g(e,X)),E(W),A(!0)}};let S;try{S=M,S&&(S.includes("/man-avatar.png")||S.includes("/women-avatar.png")||S.includes("/couple-avatar.png")||S.includes("/default-avatar.png"))&&(S.includes("_refresh=")&&(S=S.replace(/([?&])_refresh=\d+(&|$)/,"$1"),(S.endsWith("?")||S.endsWith("&"))&&(S=S.slice(0,-1))),S.startsWith("/")&&(S=`${window.location.origin}${S}`))}catch(L){ls.error(`Error with image source: ${L.message}`,{src:M}),S=`${window.location.origin}/default-avatar.png`}const C={tiny:"avatar-xs",small:"avatar-sm",medium:"avatar-md",large:"avatar-lg",xlarge:"avatar-xl"},G={backgroundImage:`url(${S})`,backgroundSize:"cover",backgroundPosition:"center"},V=L=>{i||(R(),L.stopPropagation())};return r.jsxs("div",{className:`avatar ${C[s]||""} ${c?"avatar-online":""} ${o}`,onClick:i,onDoubleClick:V,style:G,role:i?"button":void 0,tabIndex:i?0:void 0,"data-debug":D,"data-component-id":k,children:[r.jsx("img",{src:S,alt:t,onError:I,style:{display:"none"},crossOrigin:"anonymous","data-src-type":S!=null&&S.includes("man-avatar.png")?"man":S!=null&&S.includes("women-avatar.png")?"woman":S!=null&&S.includes("couple-avatar.png")?"couple":ta(S)?"default":"custom"},`img-${k}`),n&&r.jsx("span",{className:`avatar-status status-${n} status-${u}`})]})};Pu.propTypes={src:O.string,alt:O.string,size:O.oneOf(["tiny","small","medium","large","xlarge"]),status:O.oneOf([null,"online","offline","busy","away"]),className:O.string,onClick:O.func,online:O.bool,placeholder:O.string,statusPosition:O.oneOf(["top-right","top-left","bottom-right","bottom-left"]),showFallback:O.bool,user:O.object,showOnlineStatus:O.bool};const lo=pt.memo(Pu,(e,t)=>{var s,n;return e.src!==t.src||e.alt!==t.alt||e.size!==t.size||e.status!==t.status||e.className!==t.className||e.online!==t.online||e.placeholder!==t.placeholder||e.statusPosition!==t.statusPosition||e.showFallback!==t.showFallback||e.showOnlineStatus!==t.showOnlineStatus||e.onClick!==t.onClick?!1:!e.user&&!t.user?!0:!e.user||!t.user?!1:e.user._id===t.user._id&&e.user.nickname===t.user.nickname&&e.user.isOnline===t.user.isOnline&&JSON.stringify(e.user.photos)===JSON.stringify(t.user.photos)&&((s=e.user.details)==null?void 0:s.iAm)===((n=t.user.details)==null?void 0:n.iAm)&&e.user.gender===t.user.gender}),xn=({children:e,onClick:t,type:s="button",variant:n="primary",size:o="medium",className:i="",disabled:c=!1,fullWidth:l=!1,icon:u,iconPosition:h="left",isLoading:a=!1,loadingText:d,...f})=>{const{t:v}=Ht(),g=p.useMemo(()=>({loading:v("loading")||"Loading..."}),[v]),b=`btn btn-${n} btn-${o} ${l?"btn-full-width":""}`,$=u?`btn-with-icon icon-${h}`:"",T=a?"btn-loading":"",F=d||g.loading;return r.jsx("button",{type:s,className:`${b} ${$} ${T} ${i}`,onClick:t,disabled:c||a,...f,children:a?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"loading-spinner"}),F]}):r.jsxs(r.Fragment,{children:[u&&h==="left"&&r.jsx("span",{className:"btn-icon",children:u}),r.jsx("span",{className:"btn-text",children:e}),u&&h==="right"&&r.jsx("span",{className:"btn-icon",children:u})]})})};xn.propTypes={children:O.node.isRequired,onClick:O.func,type:O.oneOf(["button","submit","reset"]),variant:O.oneOf(["primary","secondary","success","danger","warning","info","light","dark","link"]),size:O.oneOf(["small","medium","large"]),className:O.string,disabled:O.bool,fullWidth:O.bool,icon:O.node,iconPosition:O.oneOf(["left","right"]),isLoading:O.bool,loadingText:O.string};O.node.isRequired,O.node,O.node,O.string,O.string,O.string,O.string,O.node,O.bool,O.func,O.bool;O.oneOfType([O.string,O.object]).isRequired,O.string,O.oneOf(["error","warning","info"]),O.func,O.bool,O.string,O.object;const hl=Ze.create("useChat"),hy=(e=null)=>{const t=e?String(e):null,s=P1();p.useEffect(()=>{t&&(hl.debug(`useChat: Setting active conversation to ${t}`),s.setActiveConversation(t))},[t,s.setActiveConversation]);const n=p.useCallback(async(d,f="text",v=null)=>{if(!t){const g="Cannot send message: Missing recipient ID";throw hl.error(g),new Error(g)}return s.activeConversation!==t&&await s.setActiveConversation(t),s.sendMessage(d,f,v)},[t,s]),o=p.useCallback(async(d=!1)=>t?s.loadMessages(t,d):[],[t,s.loadMessages]),i=p.useCallback(async()=>!t||s.activeConversation!==t?[]:s.loadMoreMessages(),[t,s.activeConversation,s.loadMoreMessages]),c=p.useCallback(()=>t?(s.activeConversation!==t&&s.setActiveConversation(t),s.refresh()):Promise.resolve([]),[t,s]),l=p.useCallback(()=>{t&&(s.activeConversation!==t&&s.setActiveConversation(t),s.sendTyping())},[t,s]),u=t?s.messages.filter(d=>{var f,v;return d.sender===t&&d.recipient===((f=s.user)==null?void 0:f._id)||d.sender===((v=s.user)==null?void 0:v._id)&&d.recipient===t}):[],h=p.useCallback(()=>t?s.markConversationRead(t):Promise.resolve(null),[t,s.markConversationRead]),a=p.useCallback(()=>s.getConversations?s.getConversations():Promise.resolve([]),[s]);return{conversations:s.conversations,messages:u,loading:s.loading,sending:s.sending,error:s.error,hasMore:s.hasMore,typingStatus:s.typingStatus,isConnected:s.isConnected,initialized:s.initialized,activeConversation:s.activeConversation,loadMessages:o,loadMoreMessages:i,sendMessage:n,sendTyping:l,refresh:c,markConversationRead:h,getConversations:a,setActiveConversation:s.setActiveConversation}},Pa={md:768,lg:992},Ru=e=>{const t=o=>typeof window<"u"?window.matchMedia(o).matches:!1,[s,n]=p.useState(t(e));return p.useEffect(()=>{if(typeof window>"u")return;const o=window.matchMedia(e);n(o.matches);const i=c=>n(c.matches);return o.addEventListener?o.addEventListener("change",i):o.addListener(i),()=>{o.removeEventListener?o.removeEventListener("change",i):o.removeListener(i)}},[e]),s},En=()=>Ru(`(max-width: ${Pa.md-1}px)`),fy=()=>Ru(`(min-width: ${Pa.md}px) and (max-width: ${Pa.lg-1}px)`),Nr=()=>{const[e,t]=p.useState({isMobile:!1,isTouch:!1,isIOS:!1,isAndroid:!1,isSafari:!1,isPWA:!1,isLandscape:!1}),s=En();return p.useEffect(()=>{if(typeof window>"u")return;const n=navigator.userAgent||navigator.vendor||window.opera,o="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,i=/iPad|iPhone|iPod/.test(n)&&!window.MSStream,c=/android/i.test(n),l=/^((?!chrome|android).)*safari/i.test(n),u=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),h=window.matchMedia("(orientation: landscape)").matches;t({isMobile:s,isTouch:o,isIOS:i,isAndroid:c,isSafari:l,isPWA:u,isLandscape:h});const a=()=>{t(d=>({...d,isLandscape:window.matchMedia("(orientation: landscape)").matches}))};return window.addEventListener("orientationchange",a),window.addEventListener("resize",a),()=>{window.removeEventListener("orientationchange",a),window.removeEventListener("resize",a)}},[s]),e};let fl=0;const Ra=(e="local")=>{fl++;const t=Math.random().toString(36).substring(2,9);return`${e}-${Date.now()}-${fl}-${t}`},Mu=e=>{const t=(e==null?void 0:e.type)||(e==null?void 0:e.fileType)||(e==null?void 0:e.mimeType)||"";return t?t.startsWith("image/")?r.jsx(gi,{}):t.startsWith("video/")?r.jsx(Um,{}):t.startsWith("audio/")?r.jsx(Dm,{}):t==="application/pdf"?r.jsx(Bm,{}):t.includes("word")?r.jsx(sl,{}):r.jsx(sl,{}):r.jsx(qm,{})},jn=Ze.create("useBlockedUsers"),gy=()=>{const[e,t]=p.useState([]),[s,n]=p.useState(!1),[o,i]=p.useState(null),{user:c,isAuthenticated:l}=Xt(),u=p.useCallback(()=>{const f=localStorage.getItem("blockedUsers");let v=[];if(f)try{v=JSON.parse(f)||[],jn.debug(`Loaded ${v.length} blocked users from localStorage`)}catch(g){jn.warn("Error parsing blocked users from localStorage:",g),v=[]}return v},[]),h=p.useCallback(async()=>{var f,v;if(!l||!(c!=null&&c._id))return[];n(!0),i(null);try{if(localStorage.getItem("blocked_users_endpoint_missing")==="true"){jn.debug("Skipping blocked users API call - endpoint known to be missing");const b=u();return t(b),n(!1),b}try{jn.debug("Attempting to fetch blocked users from API...");const b=await qe.get("/users/blocked",{},{timeout:5e3});if(b&&b.success&&Array.isArray(b.data)){const $=b.data.map(T=>typeof T=="object"&&T._id?T._id:typeof T=="object"&&T.id?T.id:String(T).replace(/^ObjectId\(['"](.+)['"]\)$/,"$1")).filter(T=>/^[0-9a-fA-F]{24}$/.test(T));return jn.debug(`Successfully loaded ${$.length} blocked users from API`),localStorage.setItem("blockedUsers",JSON.stringify($)),localStorage.removeItem("blocked_users_endpoint_missing"),t($),n(!1),$}else throw new Error("Invalid response format from API")}catch(b){jn.warn("Failed to fetch blocked users from API, using localStorage fallback:",b),(((f=b==null?void 0:b.response)==null?void 0:f.status)===400||((v=b==null?void 0:b.response)==null?void 0:v.status)===404)&&(jn.info("Marking blocked users endpoint as missing for future reference"),localStorage.setItem("blocked_users_endpoint_missing","true"));const $=u();return t($),n(!1),$}}catch(g){return jn.error("Error fetching blocked users:",g),i("Failed to load blocked users"),n(!1),[]}},[l,c,u]),a=p.useCallback(f=>f?e.includes(f):!1,[e]),d=p.useCallback(f=>Array.isArray(f)?f.map(v=>{var g;return(g=v==null?void 0:v.user)!=null&&g._id?{...v,user:{...v.user,isBlocked:a(v.user._id)}}:v!=null&&v._id?{...v,isBlocked:a(v._id)}:v}):f,[a]);return p.useEffect(()=>{l&&(c!=null&&c._id)&&h()},[l,c,h]),{blockedUsers:e,isUserBlocked:a,markBlockedUsers:d,fetchBlockedUsers:h,loading:s,error:o}},py=()=>{const e=p.useRef(!1);return p.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),{isMounted:()=>e.current}},my=e=>{const t=p.useRef(null);return p.useEffect(()=>{const s=n=>{t.current&&!t.current.contains(n.target)&&e()};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[e]),t};O.string,O.node,O.node,O.node.isRequired,O.bool,O.node,O.string,O.string,O.string,O.bool,O.oneOf(["top","left","right"]);const mt=e=>typeof e=="string",Hr=()=>{let e,t;const s=new Promise((n,o)=>{e=n,t=o});return s.resolve=e,s.reject=t,s},gl=e=>e==null?"":""+e,yy=(e,t,s)=>{e.forEach(n=>{t[n]&&(s[n]=t[n])})},vy=/###/g,pl=e=>e&&e.indexOf("###")>-1?e.replace(vy,"."):e,ml=e=>!e||mt(e),Xr=(e,t,s)=>{const n=mt(t)?t.split("."):t;let o=0;for(;o<n.length-1;){if(ml(e))return{};const i=pl(n[o]);!e[i]&&s&&(e[i]=new s),Object.prototype.hasOwnProperty.call(e,i)?e=e[i]:e={},++o}return ml(e)?{}:{obj:e,k:pl(n[o])}},yl=(e,t,s)=>{const{obj:n,k:o}=Xr(e,t,Object);if(n!==void 0||t.length===1){n[o]=s;return}let i=t[t.length-1],c=t.slice(0,t.length-1),l=Xr(e,c,Object);for(;l.obj===void 0&&c.length;)i=`${c[c.length-1]}.${i}`,c=c.slice(0,c.length-1),l=Xr(e,c,Object),l!=null&&l.obj&&typeof l.obj[`${l.k}.${i}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${i}`]=s},_y=(e,t,s,n)=>{const{obj:o,k:i}=Xr(e,t,Object);o[i]=o[i]||[],o[i].push(s)},Xo=(e,t)=>{const{obj:s,k:n}=Xr(e,t);if(s&&Object.prototype.hasOwnProperty.call(s,n))return s[n]},wy=(e,t,s)=>{const n=Xo(e,s);return n!==void 0?n:Xo(t,s)},Lu=(e,t,s)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?mt(e[n])||e[n]instanceof String||mt(t[n])||t[n]instanceof String?s&&(e[n]=t[n]):Lu(e[n],t[n],s):e[n]=t[n]);return e},ar=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var by={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const xy=e=>mt(e)?e.replace(/[&<>"'\/]/g,t=>by[t]):e;class Sy{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const s=this.regExpMap.get(t);if(s!==void 0)return s;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const Cy=[" ",",","?","!",";"],ky=new Sy(20),Ny=(e,t,s)=>{t=t||"",s=s||"";const n=Cy.filter(c=>t.indexOf(c)<0&&s.indexOf(c)<0);if(n.length===0)return!0;const o=ky.getRegExp(`(${n.map(c=>c==="?"?"\\?":c).join("|")})`);let i=!o.test(e);if(!i){const c=e.indexOf(s);c>0&&!o.test(e.substring(0,c))&&(i=!0)}return i},Ma=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(s);let o=e;for(let i=0;i<n.length;){if(!o||typeof o!="object")return;let c,l="";for(let u=i;u<n.length;++u)if(u!==i&&(l+=s),l+=n[u],c=o[l],c!==void 0){if(["string","number","boolean"].indexOf(typeof c)>-1&&u<n.length-1)continue;i+=u-i+1;break}o=c}return o},Zo=e=>e==null?void 0:e.replace("_","-"),Ey={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var s,n;(n=(s=console==null?void 0:console[e])==null?void 0:s.apply)==null||n.call(s,console,t)}};class ei{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(t,s)}init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=s.prefix||"i18next:",this.logger=t||Ey,this.options=s,this.debug=s.debug}log(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return this.forward(s,"log","",!0)}warn(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return this.forward(s,"warn","",!0)}error(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return this.forward(s,"error","")}deprecate(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return this.forward(s,"warn","WARNING DEPRECATED: ",!0)}forward(t,s,n,o){return o&&!this.debug?null:(mt(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[s](t))}create(t){return new ei(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new ei(this.logger,t)}}var hn=new ei;class mi{constructor(){this.observers={}}on(t,s){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const o=this.observers[n].get(s)||0;this.observers[n].set(s,o+1)}),this}off(t,s){if(this.observers[t]){if(!s){delete this.observers[t];return}this.observers[t].delete(s)}}emit(t){for(var s=arguments.length,n=new Array(s>1?s-1:0),o=1;o<s;o++)n[o-1]=arguments[o];this.observers[t]&&Array.from(this.observers[t].entries()).forEach(c=>{let[l,u]=c;for(let h=0;h<u;h++)l(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(c=>{let[l,u]=c;for(let h=0;h<u;h++)l.apply(l,[t,...n])})}}class vl extends mi{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=t||{},this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const s=this.options.ns.indexOf(t);s>-1&&this.options.ns.splice(s,1)}getResource(t,s,n){var h,a;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,c=o.ignoreJSONStructure!==void 0?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;t.indexOf(".")>-1?l=t.split("."):(l=[t,s],n&&(Array.isArray(n)?l.push(...n):mt(n)&&i?l.push(...n.split(i)):l.push(n)));const u=Xo(this.data,l);return!u&&!s&&!n&&t.indexOf(".")>-1&&(t=l[0],s=l[1],n=l.slice(2).join(".")),u||!c||!mt(n)?u:Ma((a=(h=this.data)==null?void 0:h[t])==null?void 0:a[s],n,i)}addResource(t,s,n,o){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const c=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let l=[t,s];n&&(l=l.concat(c?n.split(c):n)),t.indexOf(".")>-1&&(l=t.split("."),o=s,s=l[1]),this.addNamespaces(s),yl(this.data,l,o),i.silent||this.emit("added",t,s,n,o)}addResources(t,s,n){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in n)(mt(n[i])||Array.isArray(n[i]))&&this.addResource(t,s,i,n[i],{silent:!0});o.silent||this.emit("added",t,s,n)}addResourceBundle(t,s,n,o,i){let c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},l=[t,s];t.indexOf(".")>-1&&(l=t.split("."),o=n,n=s,s=l[1]),this.addNamespaces(s);let u=Xo(this.data,l)||{};c.skipCopy||(n=JSON.parse(JSON.stringify(n))),o?Lu(u,n,i):u={...u,...n},yl(this.data,l,u),c.silent||this.emit("added",t,s,n)}removeResourceBundle(t,s){this.hasResourceBundle(t,s)&&delete this.data[t][s],this.removeNamespaces(s),this.emit("removed",t,s)}hasResourceBundle(t,s){return this.getResource(t,s)!==void 0}getResourceBundle(t,s){return s||(s=this.options.defaultNS),this.getResource(t,s)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const s=this.getDataByLanguage(t);return!!(s&&Object.keys(s)||[]).find(o=>s[o]&&Object.keys(s[o]).length>0)}toJSON(){return this.data}}var Ou={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,s,n,o){return e.forEach(i=>{var c;t=((c=this.processors[i])==null?void 0:c.process(t,s,n,o))??t}),t}};const _l={},wl=e=>!mt(e)&&typeof e!="boolean"&&typeof e!="number";class ti extends mi{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),yy(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=s,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=hn.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(t==null)return!1;const n=this.resolve(t,s);return(n==null?void 0:n.res)!==void 0}extractFromKey(t,s){let n=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let i=s.ns||this.options.defaultNS||[];const c=n&&t.indexOf(n)>-1,l=!this.options.userDefinedKeySeparator&&!s.keySeparator&&!this.options.userDefinedNsSeparator&&!s.nsSeparator&&!Ny(t,n,o);if(c&&!l){const u=t.match(this.interpolator.nestingRegexp);if(u&&u.length>0)return{key:t,namespaces:mt(i)?[i]:i};const h=t.split(n);(n!==o||n===o&&this.options.ns.indexOf(h[0])>-1)&&(i=h.shift()),t=h.join(o)}return{key:t,namespaces:mt(i)?[i]:i}}translate(t,s,n){if(typeof s!="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),typeof s=="object"&&(s={...s}),s||(s={}),t==null)return"";Array.isArray(t)||(t=[String(t)]);const o=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,i=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,{key:c,namespaces:l}=this.extractFromKey(t[t.length-1],s),u=l[l.length-1],h=s.lng||this.language,a=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((h==null?void 0:h.toLowerCase())==="cimode"){if(a){const x=s.nsSeparator||this.options.nsSeparator;return o?{res:`${u}${x}${c}`,usedKey:c,exactUsedKey:c,usedLng:h,usedNS:u,usedParams:this.getUsedParamsDetails(s)}:`${u}${x}${c}`}return o?{res:c,usedKey:c,exactUsedKey:c,usedLng:h,usedNS:u,usedParams:this.getUsedParamsDetails(s)}:c}const d=this.resolve(t,s);let f=d==null?void 0:d.res;const v=(d==null?void 0:d.usedKey)||c,g=(d==null?void 0:d.exactUsedKey)||c,b=["[object Number]","[object Function]","[object RegExp]"],$=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,F=s.count!==void 0&&!mt(s.count),M=ti.hasDefaultValue(s),E=F?this.pluralResolver.getSuffix(h,s.count,s):"",U=s.ordinal&&F?this.pluralResolver.getSuffix(h,s.count,{ordinal:!1}):"",A=F&&!s.ordinal&&s.count===0,D=A&&s[`defaultValue${this.options.pluralSeparator}zero`]||s[`defaultValue${E}`]||s[`defaultValue${U}`]||s.defaultValue;let w=f;T&&!f&&M&&(w=D);const N=wl(w),P=Object.prototype.toString.apply(w);if(T&&w&&N&&b.indexOf(P)<0&&!(mt($)&&Array.isArray(w))){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const x=this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,w,{...s,ns:l}):`key '${c} (${this.language})' returned an object instead of string.`;return o?(d.res=x,d.usedParams=this.getUsedParamsDetails(s),d):x}if(i){const x=Array.isArray(w),k=x?[]:{},R=x?g:v;for(const j in w)if(Object.prototype.hasOwnProperty.call(w,j)){const I=`${R}${i}${j}`;M&&!f?k[j]=this.translate(I,{...s,defaultValue:wl(D)?D[j]:void 0,joinArrays:!1,ns:l}):k[j]=this.translate(I,{...s,joinArrays:!1,ns:l}),k[j]===I&&(k[j]=w[j])}f=k}}else if(T&&mt($)&&Array.isArray(f))f=f.join($),f&&(f=this.extendTranslation(f,t,s,n));else{let x=!1,k=!1;!this.isValidLookup(f)&&M&&(x=!0,f=D),this.isValidLookup(f)||(k=!0,f=c);const j=(s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&k?void 0:f,I=M&&D!==f&&this.options.updateMissing;if(k||x||I){if(this.logger.log(I?"updateKey":"missingKey",h,u,c,I?D:f),i){const V=this.resolve(c,{...s,keySeparator:!1});V&&V.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let S=[];const C=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&C&&C[0])for(let V=0;V<C.length;V++)S.push(C[V]);else this.options.saveMissingTo==="all"?S=this.languageUtils.toResolveHierarchy(s.lng||this.language):S.push(s.lng||this.language);const G=(V,L,X)=>{var z;const q=M&&X!==f?X:j;this.options.missingKeyHandler?this.options.missingKeyHandler(V,u,L,q,I,s):(z=this.backendConnector)!=null&&z.saveMissing&&this.backendConnector.saveMissing(V,u,L,q,I,s),this.emit("missingKey",V,u,L,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&F?S.forEach(V=>{const L=this.pluralResolver.getSuffixes(V,s);A&&s[`defaultValue${this.options.pluralSeparator}zero`]&&L.indexOf(`${this.options.pluralSeparator}zero`)<0&&L.push(`${this.options.pluralSeparator}zero`),L.forEach(X=>{G([V],c+X,s[`defaultValue${X}`]||D)})}):G(S,c,D))}f=this.extendTranslation(f,t,s,d,n),k&&f===c&&this.options.appendNamespaceToMissingKey&&(f=`${u}:${c}`),(k||x)&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}:${c}`:c,x?f:void 0))}return o?(d.res=f,d.usedParams=this.getUsedParamsDetails(s),d):f}extendTranslation(t,s,n,o,i){var h,a;var c=this;if((h=this.i18nFormat)!=null&&h.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const d=mt(t)&&(((a=n==null?void 0:n.interpolation)==null?void 0:a.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let f;if(d){const g=t.match(this.interpolator.nestingRegexp);f=g&&g.length}let v=n.replace&&!mt(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(v={...this.options.interpolation.defaultVariables,...v}),t=this.interpolator.interpolate(t,v,n.lng||this.language||o.usedLng,n),d){const g=t.match(this.interpolator.nestingRegexp),b=g&&g.length;f<b&&(n.nest=!1)}!n.lng&&o&&o.res&&(n.lng=this.language||o.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,function(){for(var g=arguments.length,b=new Array(g),$=0;$<g;$++)b[$]=arguments[$];return(i==null?void 0:i[0])===b[0]&&!n.context?(c.logger.warn(`It seems you are nesting recursively key: ${b[0]} in key: ${s[0]}`),null):c.translate(...b,s)},n)),n.interpolation&&this.interpolator.reset()}const l=n.postProcess||this.options.postProcess,u=mt(l)?[l]:l;return t!=null&&(u!=null&&u.length)&&n.applyPostProcessor!==!1&&(t=Ou.handle(u,t,s,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...o,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n,o,i,c,l;return mt(t)&&(t=[t]),t.forEach(u=>{if(this.isValidLookup(n))return;const h=this.extractFromKey(u,s),a=h.key;o=a;let d=h.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const f=s.count!==void 0&&!mt(s.count),v=f&&!s.ordinal&&s.count===0,g=s.context!==void 0&&(mt(s.context)||typeof s.context=="number")&&s.context!=="",b=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);d.forEach($=>{var T,F;this.isValidLookup(n)||(l=$,!_l[`${b[0]}-${$}`]&&((T=this.utils)!=null&&T.hasLoadedNamespace)&&!((F=this.utils)!=null&&F.hasLoadedNamespace(l))&&(_l[`${b[0]}-${$}`]=!0,this.logger.warn(`key "${o}" for languages "${b.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),b.forEach(M=>{var A;if(this.isValidLookup(n))return;c=M;const E=[a];if((A=this.i18nFormat)!=null&&A.addLookupKeys)this.i18nFormat.addLookupKeys(E,a,M,$,s);else{let D;f&&(D=this.pluralResolver.getSuffix(M,s.count,s));const w=`${this.options.pluralSeparator}zero`,N=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(E.push(a+D),s.ordinal&&D.indexOf(N)===0&&E.push(a+D.replace(N,this.options.pluralSeparator)),v&&E.push(a+w)),g){const P=`${a}${this.options.contextSeparator}${s.context}`;E.push(P),f&&(E.push(P+D),s.ordinal&&D.indexOf(N)===0&&E.push(P+D.replace(N,this.options.pluralSeparator)),v&&E.push(P+w))}}let U;for(;U=E.pop();)this.isValidLookup(n)||(i=U,n=this.getResource(M,$,U,s))}))})}),{res:n,usedKey:o,exactUsedKey:i,usedLng:c,usedNS:l}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,s,n){var i;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(i=this.i18nFormat)!=null&&i.getResource?this.i18nFormat.getResource(t,s,n,o):this.resourceStore.getResource(t,s,n,o)}getUsedParamsDetails(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!mt(t.replace);let o=n?t.replace:t;if(n&&typeof t.count<"u"&&(o.count=t.count),this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),!n){o={...o};for(const i of s)delete o[i]}return o}static hasDefaultValue(t){const s="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&s===n.substring(0,s.length)&&t[n]!==void 0)return!0;return!1}}class bl{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=hn.create("languageUtils")}getScriptPartFromCode(t){if(t=Zo(t),!t||t.indexOf("-")<0)return null;const s=t.split("-");return s.length===2||(s.pop(),s[s.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(s.join("-"))}getLanguagePartFromCode(t){if(t=Zo(t),!t||t.indexOf("-")<0)return t;const s=t.split("-");return this.formatLanguageCode(s[0])}formatLanguageCode(t){if(mt(t)&&t.indexOf("-")>-1){let s;try{s=Intl.getCanonicalLocales(t)[0]}catch{}return s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let s;return t.forEach(n=>{if(s)return;const o=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(o))&&(s=o)}),!s&&this.options.supportedLngs&&t.forEach(n=>{if(s)return;const o=this.getLanguagePartFromCode(n);if(this.isSupportedCode(o))return s=o;s=this.options.supportedLngs.find(i=>{if(i===o)return i;if(!(i.indexOf("-")<0&&o.indexOf("-")<0)&&(i.indexOf("-")>0&&o.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===o||i.indexOf(o)===0&&o.length>1))return i})}),s||(s=this.getFallbackCodes(this.options.fallbackLng)[0]),s}getFallbackCodes(t,s){if(!t)return[];if(typeof t=="function"&&(t=t(s)),mt(t)&&(t=[t]),Array.isArray(t))return t;if(!s)return t.default||[];let n=t[s];return n||(n=t[this.getScriptPartFromCode(s)]),n||(n=t[this.formatLanguageCode(s)]),n||(n=t[this.getLanguagePartFromCode(s)]),n||(n=t.default),n||[]}toResolveHierarchy(t,s){const n=this.getFallbackCodes(s||this.options.fallbackLng||[],t),o=[],i=c=>{c&&(this.isSupportedCode(c)?o.push(c):this.logger.warn(`rejecting language code not found in supportedLngs: ${c}`))};return mt(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(t))):mt(t)&&i(this.formatLanguageCode(t)),n.forEach(c=>{o.indexOf(c)<0&&i(this.formatLanguageCode(c))}),o}}const xl={zero:0,one:1,two:2,few:3,many:4,other:5},Sl={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Ty{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=t,this.options=s,this.logger=hn.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,s){this.rules[t]=s}clearCache(){this.pluralRulesCache={}}getRule(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=Zo(t==="dev"?"en":t),o=s.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:n,type:o});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let c;try{c=new Intl.PluralRules(n,{type:o})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Sl;if(!t.match(/-|_/))return Sl;const u=this.languageUtils.getLanguagePartFromCode(t);c=this.getRule(u,s)}return this.pluralRulesCache[i]=c,c}needsPlural(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=this.getRule(t,s);return n||(n=this.getRule("dev",s)),(n==null?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(t,n).map(o=>`${s}${o}`)}getSuffixes(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=this.getRule(t,s);return n||(n=this.getRule("dev",s)),n?n.resolvedOptions().pluralCategories.sort((o,i)=>xl[o]-xl[i]).map(o=>`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${o}`):[]}getSuffix(t,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const o=this.getRule(t,n);return o?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${o.select(s)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",s,n))}}const Cl=function(e,t,s){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=wy(e,t,s);return!i&&o&&mt(s)&&(i=Ma(e,s,n),i===void 0&&(i=Ma(t,s,n))),i},sa=e=>e.replace(/\$/g,"$$$$");class Ay{constructor(){var s;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=hn.create("interpolator"),this.options=t,this.format=((s=t==null?void 0:t.interpolation)==null?void 0:s.format)||(n=>n),this.init(t)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});const{escape:s,escapeValue:n,useRawValueToEscape:o,prefix:i,prefixEscaped:c,suffix:l,suffixEscaped:u,formatSeparator:h,unescapeSuffix:a,unescapePrefix:d,nestingPrefix:f,nestingPrefixEscaped:v,nestingSuffix:g,nestingSuffixEscaped:b,nestingOptionsSeparator:$,maxReplaces:T,alwaysFormat:F}=t.interpolation;this.escape=s!==void 0?s:xy,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=o!==void 0?o:!1,this.prefix=i?ar(i):c||"{{",this.suffix=l?ar(l):u||"}}",this.formatSeparator=h||",",this.unescapePrefix=a?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":a||"",this.nestingPrefix=f?ar(f):v||ar("$t("),this.nestingSuffix=g?ar(g):b||ar(")"),this.nestingOptionsSeparator=$||",",this.maxReplaces=T||1e3,this.alwaysFormat=F!==void 0?F:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(s,n)=>(s==null?void 0:s.source)===n?(s.lastIndex=0,s):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(t,s,n,o){var v;let i,c,l;const u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=g=>{if(g.indexOf(this.formatSeparator)<0){const F=Cl(s,u,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(F,void 0,n,{...o,...s,interpolationkey:g}):F}const b=g.split(this.formatSeparator),$=b.shift().trim(),T=b.join(this.formatSeparator).trim();return this.format(Cl(s,u,$,this.options.keySeparator,this.options.ignoreJSONStructure),T,n,{...o,...s,interpolationkey:$})};this.resetRegExp();const a=(o==null?void 0:o.missingInterpolationHandler)||this.options.missingInterpolationHandler,d=((v=o==null?void 0:o.interpolation)==null?void 0:v.skipOnVariables)!==void 0?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>sa(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?sa(this.escape(g)):sa(g)}].forEach(g=>{for(l=0;i=g.regex.exec(t);){const b=i[1].trim();if(c=h(b),c===void 0)if(typeof a=="function"){const T=a(t,i,o);c=mt(T)?T:""}else if(o&&Object.prototype.hasOwnProperty.call(o,b))c="";else if(d){c=i[0];continue}else this.logger.warn(`missed to pass in variable ${b} for interpolating ${t}`),c="";else!mt(c)&&!this.useRawValueToEscape&&(c=gl(c));const $=g.safeValue(c);if(t=t.replace(i[0],$),d?(g.regex.lastIndex+=c.length,g.regex.lastIndex-=i[0].length):g.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),t}nest(t,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o,i,c;const l=(u,h)=>{const a=this.nestingOptionsSeparator;if(u.indexOf(a)<0)return u;const d=u.split(new RegExp(`${a}[ ]*{`));let f=`{${d[1]}`;u=d[0],f=this.interpolate(f,c);const v=f.match(/'/g),g=f.match(/"/g);(((v==null?void 0:v.length)??0)%2===0&&!g||g.length%2!==0)&&(f=f.replace(/'/g,'"'));try{c=JSON.parse(f),h&&(c={...h,...c})}catch(b){return this.logger.warn(`failed parsing options string in nesting for key ${u}`,b),`${u}${a}${f}`}return c.defaultValue&&c.defaultValue.indexOf(this.prefix)>-1&&delete c.defaultValue,u};for(;o=this.nestingRegexp.exec(t);){let u=[];c={...n},c=c.replace&&!mt(c.replace)?c.replace:c,c.applyPostProcessor=!1,delete c.defaultValue;let h=!1;if(o[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(o[1])){const a=o[1].split(this.formatSeparator).map(d=>d.trim());o[1]=a.shift(),u=a,h=!0}if(i=s(l.call(this,o[1].trim(),c),c),i&&o[0]===t&&!mt(i))return i;mt(i)||(i=gl(i)),i||(this.logger.warn(`missed to resolve ${o[1]} for nesting ${t}`),i=""),h&&(i=u.reduce((a,d)=>this.format(a,d,n.lng,{...n,interpolationkey:o[1].trim()}),i.trim())),t=t.replace(o[0],i),this.regexp.lastIndex=0}return t}}const jy=e=>{let t=e.toLowerCase().trim();const s={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const o=n[1].substring(0,n[1].length-1);t==="currency"&&o.indexOf(":")<0?s.currency||(s.currency=o.trim()):t==="relativetime"&&o.indexOf(":")<0?s.range||(s.range=o.trim()):o.split(";").forEach(c=>{if(c){const[l,...u]=c.split(":"),h=u.join(":").trim().replace(/^'+|'+$/g,""),a=l.trim();s[a]||(s[a]=h),h==="false"&&(s[a]=!1),h==="true"&&(s[a]=!0),isNaN(h)||(s[a]=parseInt(h,10))}})}return{formatName:t,formatOptions:s}},cr=e=>{const t={};return(s,n,o)=>{let i=o;o&&o.interpolationkey&&o.formatParams&&o.formatParams[o.interpolationkey]&&o[o.interpolationkey]&&(i={...i,[o.interpolationkey]:void 0});const c=n+JSON.stringify(i);let l=t[c];return l||(l=e(Zo(n),o),t[c]=l),l(s)}};class Iy{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=hn.create("formatter"),this.options=t,this.formats={number:cr((s,n)=>{const o=new Intl.NumberFormat(s,{...n});return i=>o.format(i)}),currency:cr((s,n)=>{const o=new Intl.NumberFormat(s,{...n,style:"currency"});return i=>o.format(i)}),datetime:cr((s,n)=>{const o=new Intl.DateTimeFormat(s,{...n});return i=>o.format(i)}),relativetime:cr((s,n)=>{const o=new Intl.RelativeTimeFormat(s,{...n});return i=>o.format(i,n.range||"day")}),list:cr((s,n)=>{const o=new Intl.ListFormat(s,{...n});return i=>o.format(i)})},this.init(t)}init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=s.interpolation.formatSeparator||","}add(t,s){this.formats[t.toLowerCase().trim()]=s}addCached(t,s){this.formats[t.toLowerCase().trim()]=cr(s)}format(t,s,n){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=s.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(l=>l.indexOf(")")>-1)){const l=i.findIndex(u=>u.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,l)].join(this.formatSeparator)}return i.reduce((l,u)=>{var d;const{formatName:h,formatOptions:a}=jy(u);if(this.formats[h]){let f=l;try{const v=((d=o==null?void 0:o.formatParams)==null?void 0:d[o.interpolationkey])||{},g=v.locale||v.lng||o.locale||o.lng||n;f=this.formats[h](l,g,{...a,...o,...v})}catch(v){this.logger.warn(v)}return f}else this.logger.warn(`there was no format function for ${h}`);return l},t)}}const $y=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class Py extends mi{constructor(t,s,n){var i,c;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=t,this.store=s,this.services=n,this.languageUtils=n.languageUtils,this.options=o,this.logger=hn.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],(c=(i=this.backend)==null?void 0:i.init)==null||c.call(i,n,o.backend,o)}queueLoad(t,s,n,o){const i={},c={},l={},u={};return t.forEach(h=>{let a=!0;s.forEach(d=>{const f=`${h}|${d}`;!n.reload&&this.store.hasResourceBundle(h,d)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?c[f]===void 0&&(c[f]=!0):(this.state[f]=1,a=!1,c[f]===void 0&&(c[f]=!0),i[f]===void 0&&(i[f]=!0),u[d]===void 0&&(u[d]=!0)))}),a||(l[h]=!0)}),(Object.keys(i).length||Object.keys(c).length)&&this.queue.push({pending:c,pendingCount:Object.keys(c).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(i),pending:Object.keys(c),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(u)}}loaded(t,s,n){const o=t.split("|"),i=o[0],c=o[1];s&&this.emit("failedLoading",i,c,s),!s&&n&&this.store.addResourceBundle(i,c,n,void 0,void 0,{skipCopy:!0}),this.state[t]=s?-1:2,s&&n&&(this.state[t]=0);const l={};this.queue.forEach(u=>{_y(u.loaded,[i],c),$y(u,t),s&&u.errors.push(s),u.pendingCount===0&&!u.done&&(Object.keys(u.loaded).forEach(h=>{l[h]||(l[h]={});const a=u.loaded[h];a.length&&a.forEach(d=>{l[h][d]===void 0&&(l[h][d]=!0)})}),u.done=!0,u.errors.length?u.callback(u.errors):u.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(u=>!u.done)}read(t,s,n){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,c=arguments.length>5?arguments[5]:void 0;if(!t.length)return c(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:s,fcName:n,tried:o,wait:i,callback:c});return}this.readingCalls++;const l=(h,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(h&&a&&o<this.maxRetries){setTimeout(()=>{this.read.call(this,t,s,n,o+1,i*2,c)},i);return}c(h,a)},u=this.backend[n].bind(this.backend);if(u.length===2){try{const h=u(t,s);h&&typeof h.then=="function"?h.then(a=>l(null,a)).catch(l):l(null,h)}catch(h){l(h)}return}return u(t,s,l)}prepareLoading(t,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),o&&o();mt(t)&&(t=this.languageUtils.toResolveHierarchy(t)),mt(s)&&(s=[s]);const i=this.queueLoad(t,s,n,o);if(!i.toLoad.length)return i.pending.length||o(),null;i.toLoad.forEach(c=>{this.loadOne(c)})}load(t,s,n){this.prepareLoading(t,s,{},n)}reload(t,s,n){this.prepareLoading(t,s,{reload:!0},n)}loadOne(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=t.split("|"),o=n[0],i=n[1];this.read(o,i,"read",void 0,void 0,(c,l)=>{c&&this.logger.warn(`${s}loading namespace ${i} for language ${o} failed`,c),!c&&l&&this.logger.log(`${s}loaded namespace ${i} for language ${o}`,l),this.loaded(t,c,l)})}saveMissing(t,s,n,o,i){var u,h,a,d,f;let c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((h=(u=this.services)==null?void 0:u.utils)!=null&&h.hasLoadedNamespace&&!((d=(a=this.services)==null?void 0:a.utils)!=null&&d.hasLoadedNamespace(s))){this.logger.warn(`did not save key "${n}" as the namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if((f=this.backend)!=null&&f.create){const v={...c,isUpdate:i},g=this.backend.create.bind(this.backend);if(g.length<6)try{let b;g.length===5?b=g(t,s,n,o,v):b=g(t,s,n,o),b&&typeof b.then=="function"?b.then($=>l(null,$)).catch(l):l(null,b)}catch(b){l(b)}else g(t,s,n,o,l,v)}!t||!t[0]||this.store.addResource(t[0],s,n,o)}}}const kl=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),mt(e[1])&&(t.defaultValue=e[1]),mt(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const s=e[3]||e[2];Object.keys(s).forEach(n=>{t[n]=s[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Nl=e=>{var t,s;return mt(e.ns)&&(e.ns=[e.ns]),mt(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),mt(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((s=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:s.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},Io=()=>{},Ry=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(s=>{typeof e[s]=="function"&&(e[s]=e[s].bind(e))})};class so extends mi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Nl(t),this.services={},this.logger=hn,this.modules={external:[]},Ry(this),s&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,s),this;setTimeout(()=>{this.init(t,s)},0)}}init(){var t=this;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof s=="function"&&(n=s,s={}),s.defaultNS==null&&s.ns&&(mt(s.ns)?s.defaultNS=s.ns:s.ns.indexOf("translation")<0&&(s.defaultNS=s.ns[0]));const o=kl();this.options={...o,...this.options,...Nl(s)},this.options.interpolation={...o.interpolation,...this.options.interpolation},s.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=s.keySeparator),s.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=s.nsSeparator);const i=a=>a?typeof a=="function"?new a:a:null;if(!this.options.isClone){this.modules.logger?hn.init(i(this.modules.logger),this.options):hn.init(null,this.options);let a;this.modules.formatter?a=this.modules.formatter:a=Iy;const d=new bl(this.options);this.store=new vl(this.options.resources,this.options);const f=this.services;f.logger=hn,f.resourceStore=this.store,f.languageUtils=d,f.pluralResolver=new Ty(d,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),a&&(!this.options.interpolation.format||this.options.interpolation.format===o.interpolation.format)&&(f.formatter=i(a),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new Ay(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new Py(i(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(v){for(var g=arguments.length,b=new Array(g>1?g-1:0),$=1;$<g;$++)b[$-1]=arguments[$];t.emit(v,...b)}),this.modules.languageDetector&&(f.languageDetector=i(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=i(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new ti(this.services,this.options),this.translator.on("*",function(v){for(var g=arguments.length,b=new Array(g>1?g-1:0),$=1;$<g;$++)b[$-1]=arguments[$];t.emit(v,...b)}),this.modules.external.forEach(v=>{v.init&&v.init(this)})}if(this.format=this.options.interpolation.format,n||(n=Io),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const a=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);a.length>0&&a[0]!=="dev"&&(this.options.lng=a[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(a=>{this[a]=function(){return t.store[a](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(a=>{this[a]=function(){return t.store[a](...arguments),t}});const u=Hr(),h=()=>{const a=(d,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),u.resolve(f),n(d,f)};if(this.languages&&!this.isInitialized)return a(null,this.t.bind(this));this.changeLanguage(this.options.lng,a)};return this.options.resources||!this.options.initAsync?h():setTimeout(h,0),u}loadResources(t){var i,c;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Io;const o=mt(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if((o==null?void 0:o.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const l=[],u=h=>{if(!h||h==="cimode")return;this.services.languageUtils.toResolveHierarchy(h).forEach(d=>{d!=="cimode"&&l.indexOf(d)<0&&l.push(d)})};o?u(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(a=>u(a)),(c=(i=this.options.preload)==null?void 0:i.forEach)==null||c.call(i,h=>u(h)),this.services.backendConnector.load(l,this.options.ns,h=>{!h&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(h)})}else n(null)}reloadResources(t,s,n){const o=Hr();return typeof t=="function"&&(n=t,t=void 0),typeof s=="function"&&(n=s,s=void 0),t||(t=this.languages),s||(s=this.options.ns),n||(n=Io),this.services.backendConnector.reload(t,s,i=>{o.resolve(),n(i)}),o}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&Ou.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1))for(let s=0;s<this.languages.length;s++){const n=this.languages[s];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}changeLanguage(t,s){var n=this;this.isLanguageChangingTo=t;const o=Hr();this.emit("languageChanging",t);const i=u=>{this.language=u,this.languages=this.services.languageUtils.toResolveHierarchy(u),this.resolvedLanguage=void 0,this.setResolvedLanguage(u)},c=(u,h)=>{h?(i(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,o.resolve(function(){return n.t(...arguments)}),s&&s(u,function(){return n.t(...arguments)})},l=u=>{var a,d;!t&&!u&&this.services.languageDetector&&(u=[]);const h=mt(u)?u:this.services.languageUtils.getBestMatchFromCodes(u);h&&(this.language||i(h),this.translator.language||this.translator.changeLanguage(h),(d=(a=this.services.languageDetector)==null?void 0:a.cacheUserLanguage)==null||d.call(a,h)),this.loadResources(h,f=>{c(f,h)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?l(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(l):this.services.languageDetector.detect(l):l(t),o}getFixedT(t,s,n){var o=this;const i=function(c,l){let u;if(typeof l!="object"){for(var h=arguments.length,a=new Array(h>2?h-2:0),d=2;d<h;d++)a[d-2]=arguments[d];u=o.options.overloadTranslationOptionHandler([c,l].concat(a))}else u={...l};u.lng=u.lng||i.lng,u.lngs=u.lngs||i.lngs,u.ns=u.ns||i.ns,u.keyPrefix!==""&&(u.keyPrefix=u.keyPrefix||n||i.keyPrefix);const f=o.options.keySeparator||".";let v;return u.keyPrefix&&Array.isArray(c)?v=c.map(g=>`${u.keyPrefix}${f}${g}`):v=u.keyPrefix?`${u.keyPrefix}${f}${c}`:c,o.t(v,u)};return mt(t)?i.lng=t:i.lngs=t,i.ns=s,i.keyPrefix=n,i}t(){var o;for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return(o=this.translator)==null?void 0:o.translate(...s)}exists(){var o;for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return(o=this.translator)==null?void 0:o.exists(...s)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=s.lng||this.resolvedLanguage||this.languages[0],o=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const c=(l,u)=>{const h=this.services.backendConnector.state[`${l}|${u}`];return h===-1||h===0||h===2};if(s.precheck){const l=s.precheck(this,c);if(l!==void 0)return l}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||c(n,t)&&(!o||c(i,t)))}loadNamespaces(t,s){const n=Hr();return this.options.ns?(mt(t)&&(t=[t]),t.forEach(o=>{this.options.ns.indexOf(o)<0&&this.options.ns.push(o)}),this.loadResources(o=>{n.resolve(),s&&s(o)}),n):(s&&s(),Promise.resolve())}loadLanguages(t,s){const n=Hr();mt(t)&&(t=[t]);const o=this.options.preload||[],i=t.filter(c=>o.indexOf(c)<0&&this.services.languageUtils.isSupportedCode(c));return i.length?(this.options.preload=o.concat(i),this.loadResources(c=>{n.resolve(),s&&s(c)}),n):(s&&s(),Promise.resolve())}dir(t){var o,i;if(t||(t=this.resolvedLanguage||(((o=this.languages)==null?void 0:o.length)>0?this.languages[0]:this.language)),!t)return"rtl";const s=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=((i=this.services)==null?void 0:i.languageUtils)||new bl(kl());return s.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;return new so(t,s)}cloneInstance(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Io;const n=t.forkResourceStore;n&&delete t.forkResourceStore;const o={...this.options,...t,isClone:!0},i=new so(o);if((t.debug!==void 0||t.prefix!==void 0)&&(i.logger=i.logger.clone(t)),["store","services","language"].forEach(l=>{i[l]=this[l]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},n){const l=Object.keys(this.store.data).reduce((u,h)=>(u[h]={...this.store.data[h]},Object.keys(u[h]).reduce((a,d)=>(a[d]={...u[h][d]},a),{})),{});i.store=new vl(l,o),i.services.resourceStore=i.store}return i.translator=new ti(i.services,o),i.translator.on("*",function(l){for(var u=arguments.length,h=new Array(u>1?u-1:0),a=1;a<u;a++)h[a-1]=arguments[a];i.emit(l,...h)}),i.init(o,s),i.translator.options=o,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const _s=so.createInstance();_s.createInstance=so.createInstance;_s.createInstance;_s.dir;_s.init;_s.loadResources;_s.reloadResources;_s.use;_s.changeLanguage;_s.getFixedT;_s.t;_s.exists;_s.setDefaultNamespace;_s.hasLoadedNamespace;_s.loadNamespaces;_s.loadLanguages;const Fu=({className:e="",display:t="toggle"})=>{const{language:s,changeLanguage:n}=ss(),{t:o}=Ht(),i=p.useMemo(()=>({languageSelect:o("languageSelect")||"Select language",switchToHebrew:o("switchToHebrew")||"Switch to Hebrew",switchToEnglish:o("switchToEnglish")||"Switch to English",english:o("english")||"English",hebrew:o("hebrew")||"Hebrew",language:o("language")||"Language",currentlyUsing:o("currentlyUsing")||"Currently using:"}),[o]),c=()=>{n(s==="en"?"he":"en")},l=()=>r.jsx("div",{className:`language-selector ${e}`,children:r.jsx("button",{onClick:c,className:"language-toggle-btn","aria-label":s==="en"?i.switchToHebrew||"Switch to Hebrew":i.switchToEnglish||"Switch to English",children:s==="en"?"עברית":"English"})}),u=()=>r.jsxs("div",{className:"settings-section language-settings-section",children:[r.jsx("h3",{className:"settings-heading",children:i.language}),r.jsxs("div",{className:"settings-content language-settings",children:[r.jsxs("div",{className:"language-options",children:[r.jsxs("div",{className:`language-option ${s==="en"?"active":""}`,onClick:()=>n("en"),children:[r.jsx("div",{className:"language-flag",children:"🇺🇸"}),r.jsxs("div",{className:"language-info",children:[r.jsx("div",{className:"language-name",children:i.english||"English"}),r.jsx("div",{className:"language-native",children:"English"})]}),s==="en"&&r.jsx("div",{className:"language-active-indicator",children:"✓"})]}),r.jsxs("div",{className:`language-option ${s==="he"?"active":""}`,onClick:()=>n("he"),children:[r.jsx("div",{className:"language-flag",children:"🇮🇱"}),r.jsxs("div",{className:"language-info",children:[r.jsx("div",{className:"language-name",children:i.hebrew||"Hebrew"}),r.jsx("div",{className:"language-native",children:"עברית"})]}),s==="he"&&r.jsx("div",{className:"language-active-indicator",children:"✓"})]})]}),r.jsx("div",{className:"language-notice",children:i.currentlyUsing||"Currently using:"})]})]});return r.jsxs(r.Fragment,{children:[(t==="toggle"||t==="both")&&l(),(t==="section"||t==="both")&&u()]})},Er=({size:e="medium",color:t="primary",centered:s=!1,fullPage:n=!1,text:o="",className:i="",overlay:c=!1})=>{const{t:l}=Ht(),u=p.useMemo(()=>({loading:l("loading")||"Loading..."}),[l]),h=e==="small"?"spinner-sm":e==="large"?"spinner-lg":"",a=`spinner-${t}`,d=`spinner-container
    ${s?"centered":""}
    ${n?"full-page":""}
    ${c?"with-overlay":""}
    ${i}`,f=o||u.loading;return r.jsxs("div",{className:d,role:"status","aria-live":"polite",children:[c&&r.jsx("div",{className:"spinner-overlay"}),r.jsxs("div",{className:`spinner ${h} ${a}`,"aria-hidden":"true",children:[r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"}),r.jsx("div",{className:"spinner-blade"})]}),f&&r.jsx("p",{className:"spinner-text",children:f}),r.jsx("span",{className:"sr-only",children:u.loading})]})};Er.propTypes={size:O.oneOf(["small","medium","large"]),color:O.oneOf(["primary","secondary","light","dark"]),centered:O.bool,fullPage:O.bool,text:O.string,className:O.string,overlay:O.bool};O.bool,O.oneOfType([O.string,O.object]),O.node,O.string,O.string,O.oneOf(["small","medium","large"]),O.object,O.func,O.bool,O.bool,O.string,O.func;const Kr=({isOpen:e,onClose:t,title:s,children:n,footer:o,size:i="medium",closeOnClickOutside:c=!0,closeOnEsc:l=!0,showCloseButton:u=!0,className:h="",contentClassName:a="",headerClassName:d="",bodyClassName:f="",footerClassName:v="",modalRoot:g=document.body,bottomSheetOnMobile:b=!0})=>{const $=p.useRef(null),T=p.useRef(null),F=En(),{isTouch:M}=Nr(),[E,U]=p.useState(null),[A,D]=p.useState(0),[w,N]=p.useState(!1),{language:P="en",isRTL:x=!1}=ss()||{},k=x||document.documentElement.dir==="rtl"||document.documentElement.lang==="he",R=b&&F,j=my(()=>{c&&e&&t()}),I=X=>{if(!R)return;const q=X.target;(q.closest(".modal-header")||q.classList.contains("modal-drag-indicator"))&&(U(X.touches[0].clientY),N(!0))},S=X=>{if(!w||E===null)return;const z=X.touches[0].clientY-E;z>0&&(D(z),X.preventDefault())},C=()=>{var z;if(!w)return;const X=((z=$.current)==null?void 0:z.offsetHeight)||0,q=Math.min(100,X*.3);A>q&&t(),N(!1),U(null),D(0)};p.useEffect(()=>{if(!e)return;T.current=document.activeElement;const X=q=>{var z;if(l&&q.key==="Escape"&&t(),q.key==="Tab"){const K=((z=$.current)==null?void 0:z.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))||[];if(K.length===0)return;const W=K[0],H=K[K.length-1];q.shiftKey?document.activeElement===W&&(H.focus(),q.preventDefault()):document.activeElement===H&&(W.focus(),q.preventDefault())}};return document.addEventListener("keydown",X),document.body.style.overflow="hidden",setTimeout(()=>{var z;const q=(z=$.current)==null?void 0:z.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');q!=null&&q[0]&&q[0].focus()},0),()=>{document.removeEventListener("keydown",X),document.body.style.overflow="",T.current&&T.current.focus()}},[e,l,t,c]);const G={small:"modal-sm",medium:"modal-md",large:"modal-lg",xlarge:"modal-xl",fullscreen:"modal-fullscreen"};if(!e)return null;const V=k?r.jsx("style",{children:`
      .modal, .modal-body, .modal-header, .modal-footer {
        direction: rtl !important;
        text-align: right !important;
      }
      .modal-close {
        right: auto !important;
        left: 1rem !important;
      }
      `}):null,L=r.jsxs("div",{className:`modal-overlay ${e?"open":""} ${R?"mobile-modal-overlay":""}`,onClick:c?t:void 0,children:[V,r.jsxs("div",{className:`modal ${G[i]||""} ${h} ${k?"rtl-layout":""} 
          ${R?"mobile-modal bottom-sheet":""} ${w?"is-dragging":""}`,ref:X=>{$.current=X,j&&(j.current=X)},onClick:X=>X.stopPropagation(),onTouchStart:I,onTouchMove:S,onTouchEnd:C,role:"dialog","aria-modal":"true","aria-labelledby":s?"modal-title":void 0,dir:k?"rtl":"ltr","data-language":P,style:w?{transform:`translateY(${A}px)`}:{},children:[R&&r.jsx("div",{className:"modal-drag-indicator"}),r.jsxs("div",{className:`modal-header ${d} ${k?"rtl-layout":""}`,children:[s&&r.jsx("h2",{className:"modal-title",id:"modal-title",children:s}),u&&r.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close modal",children:r.jsx(Ts,{})})]}),r.jsx("div",{className:`modal-body ${f} ${k?"rtl-layout":""}`,dir:k?"rtl":"ltr",children:n}),o&&r.jsx("div",{className:`modal-footer ${v} ${k?"rtl-layout":""}`,children:o})]})]});return dh.createPortal(L,g)};Kr.propTypes={isOpen:O.bool.isRequired,onClose:O.func.isRequired,title:O.node,children:O.node.isRequired,footer:O.node,size:O.oneOf(["small","medium","large","xlarge","fullscreen"]),closeOnClickOutside:O.bool,closeOnEsc:O.bool,showCloseButton:O.bool,className:O.string,contentClassName:O.string,headerClassName:O.string,bodyClassName:O.string,footerClassName:O.string,modalRoot:O.object,bottomSheetOnMobile:O.bool};const na=80,My=.4,Ly=80,$o=300,ra=(e,t)=>{const{container:s,sidebar:n,chatArea:o,conversationList:i,refreshIndicator:c}=e,{onSidebarShow:l,onSidebarHide:u,onRefresh:h,onRefreshStart:a,onRefreshEnd:d}=t;let f=0,v=0,g=!1,b=!1,$=0,T=0;const F=()=>i&&i.scrollTop<=1,M=w=>{f=w.touches[0].clientX,v=w.touches[0].clientY,g=!1,b=!1,T=0,$=0},E=()=>window.visualViewport?window.visualViewport.height<window.innerHeight*.8:document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName),U=w=>{if(!w.touches[0]||E())return;const N=w.touches[0].clientX,P=w.touches[0].clientY,x=N-f,k=P-v;if(!g&&!b&&(Math.abs(x)>Math.abs(k)&&Math.abs(x)>10?g=!0:k>10&&F()&&(b=!0,a&&a())),g){T=x,w.preventDefault();const R=!n.classList.contains("hide");if(R&&x<0||!R&&x>0){const I=x*.5;if(n.dataset.swiping="true",R)I<0&&(n.style.transform=`translateX(${I}px)`);else{const S=Math.min(0,-100+I/s.offsetWidth*100);n.style.transform=`translateX(${S}%)`}}}b&&!g&&(w.preventDefault(),$=Math.min(k*My,Ly),c&&(c.style.transform=`translateY(${$}px)`,$>na?c.textContent="Release to refresh":c.textContent="Pull down to refresh"))},A=w=>{if(n&&n.dataset.swiping&&delete n.dataset.swiping,g){const N=!n.classList.contains("hide");N&&T<-80?u&&(n.classList.add("animating"),u()):!N&&T>na?l&&(n.classList.add("animating"),l()):n.style.transform="",setTimeout(()=>{n.classList.remove("animating"),n.style.transition="",n.style.transform=""},$o)}b&&c&&(c.style.transition=`transform ${$o}ms ease`,$>na?(c.style.transform="translateY(40px)",h&&h(),c.classList.add("refreshSuccess"),setTimeout(()=>{c.style.transform="translateY(0)",c.classList.remove("refreshSuccess"),d&&d()},1e3)):(c.style.transform="translateY(0)",setTimeout(()=>{d&&d()},$o)),setTimeout(()=>{c.style.transition=""},$o))};if("ontouchstart"in window||navigator.maxTouchPoints>0)return s?(s.addEventListener("touchstart",M,{passive:!0}),s.addEventListener("touchmove",U,{passive:!1}),s.addEventListener("touchend",A,{passive:!0}),()=>{s.removeEventListener("touchstart",M),s.removeEventListener("touchmove",U),s.removeEventListener("touchend",A)}):null},Yt=e=>{if("vibrate"in navigator)switch(e){case"send":navigator.vibrate(20);break;case"sendFile":navigator.vibrate(40);break;case"wink":navigator.vibrate([20,30,20]);break;case"selectConversation":navigator.vibrate(20);break;case"callStart":navigator.vibrate([50,100,50]);break;case"callEnd":navigator.vibrate(100);break;case"error":navigator.vibrate([100,50,100]);break;default:navigator.vibrate(15)}},no=e=>{if(!e)return null;const t=()=>{/iPad|iPhone|iPod/.test(navigator.userAgent)&&(e.style.WebkitOverflowScrolling="touch"),e.classList.add("scrolling"),clearTimeout(e.scrollTimeout),e.scrollTimeout=setTimeout(()=>{e.classList.remove("scrolling")},200)};return e.addEventListener("scroll",t,{passive:!0}),()=>{e.removeEventListener("scroll",t)}},El=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");O.node.isRequired,O.string,O.bool,O.func,O.func,O.number,O.bool,O.func,O.string;const Oy="_photoGallery_2n68h_7",Fy="_galleryTitle_2n68h_28",Dy="_mainPhotoContainer_2n68h_50",By="_mainPhoto_2n68h_50",Uy="_navButton_2n68h_71",qy="_prevButton_2n68h_99",zy="_nextButton_2n68h_103",Hy="_galleryGrid_2n68h_108",Vy="_mobileGallery_2n68h_117",Wy="_photoItem_2n68h_123",Gy="_profilePhotoItem_2n68h_148",Yy="_photoImage_2n68h_164",Ky="_hasPrivatePhoto_2n68h_188",Jy="_photoControls_2n68h_209",Qy="_photoControlButton_2n68h_236",Xy="_controlIcon_2n68h_283",Zy="_privatePhoto_2n68h_294",e0="_lockIcon_2n68h_310",t0="_privateIndicator_2n68h_332",s0="_profileIndicator_2n68h_333",n0="_friendsIndicator_2n68h_334",r0="_profileStar_2n68h_387",o0="_privacyOverlay_2n68h_399",i0="_overlayIcon_2n68h_424",a0="_thumbnailsContainer_2n68h_436",c0="_thumbnails_2n68h_436",l0="_thumbnail_2n68h_436",d0="_activeThumbnail_2n68h_458",u0="_thumbnailImage_2n68h_462",h0="_privateThumbnail_2n68h_468",f0="_thumbnailLockIcon_2n68h_480",g0="_profileBadge_2n68h_490",p0="_thumbnailControls_2n68h_506",m0="_controlButton_2n68h_523",y0="_addPhotoThumbnail_2n68h_541",v0="_uploadPhotoButton_2n68h_571",_0="_uploadProgressContainer_2n68h_602",w0="_uploadProgressBar_2n68h_610",b0="_progressBar_2n68h_611",x0="_uploadProgressFill_2n68h_619",S0="_progressFill_2n68h_620",C0="_uploadProgressText_2n68h_626",k0="_progressText_2n68h_627",N0="_uploadProgress_2n68h_602",E0="_noPhotosMessage_2n68h_640",T0="_placeholder_2n68h_657",A0="_placeholderIcon_2n68h_662",j0="_placeholderText_2n68h_667",I0="_spinner_2n68h_673",Ke={photoGallery:Oy,galleryTitle:Fy,mainPhotoContainer:Dy,mainPhoto:By,navButton:Uy,prevButton:qy,nextButton:zy,galleryGrid:Hy,mobileGallery:Vy,photoItem:Wy,profilePhotoItem:Gy,photoImage:Yy,hasPrivatePhoto:Ky,photoControls:Jy,photoControlButton:Qy,controlIcon:Xy,privatePhoto:Zy,lockIcon:e0,privateIndicator:t0,profileIndicator:s0,friendsIndicator:n0,profileStar:r0,privacyOverlay:o0,overlayIcon:i0,thumbnailsContainer:a0,thumbnails:c0,thumbnail:l0,activeThumbnail:d0,thumbnailImage:u0,privateThumbnail:h0,thumbnailLockIcon:f0,profileBadge:g0,thumbnailControls:p0,controlButton:m0,addPhotoThumbnail:y0,uploadPhotoButton:v0,uploadProgressContainer:_0,uploadProgressBar:w0,progressBar:b0,uploadProgressFill:x0,progressFill:S0,uploadProgressText:C0,progressText:k0,uploadProgress:N0,noPhotosMessage:E0,placeholder:T0,placeholderIcon:A0,placeholderText:j0,spinner:I0},In=Ze.create("PhotoGallery"),Du=({photos:e=[],onPhotoChange:t,onSetProfilePhoto:s,onSetPrivacy:n,onDeletePhoto:o,canEdit:i=!1,canTogglePrivacy:c=!1,userId:l,isOwner:u=!0,canViewPrivate:h=!1,isProcessing:a=!1,isUploading:d=!1,uploadProgress:f=0,gridView:v=!1})=>{const{t:g}=Ht(),b=En();p.useRef(0);const{isUploading:$,uploadProgress:T,isProcessingPhoto:F,uploadPhoto:M,togglePhotoPrivacy:E,setProfilePhoto:U,deletePhoto:A}=nr(),D=d||$,w=f||T,N=a||F,[P,x]=p.useState(0),[k,R]=p.useState(`gallery-${Math.floor(Math.random()*1e4)}`),j=p.useRef(null);p.useEffect(()=>{const H=()=>{In.debug("Avatar refresh event received, updating PhotoGallery"),S(ne=>ne+1)};return window.addEventListener("avatar:refresh",H),()=>window.removeEventListener("avatar:refresh",H)},[]);const[I,S]=p.useState(0),C=Array.isArray(e)?e.filter(H=>H&&typeof H=="object"&&H._id&&!H.isDeleted):[],G=C[P]||null,V=async H=>{const ne=H.target.files[0];if(ne)try{const Q=await M(ne,"private");Q&&t&&t([...C.filter(he=>!he._id.startsWith("temp-")),Q]),j.current&&(j.current.value="")}catch(Q){In.error("Failed to upload photo:",Q)}},L=async(H,ne)=>{if(ne==null||ne.stopPropagation(),!N)try{const Q=C.find(_e=>_e._id===H);if(!Q)return;const he=Q.privacy||(Q.isPrivate?"private":"public");let re;if(typeof n=="function")re=he==="private"?"public":"private",await n(H,re,ne);else{switch(he){case"private":re="public";break;case"public":re="friends_only";break;case"friends_only":default:re="private"}if(await E(H,l,re),t){const _e=C.map(ke=>ke._id===H?{...ke,privacy:re,isPrivate:re==="private"}:ke);t(_e)}}}catch(Q){In.error("Failed to update photo privacy:",Q)}},X=async(H,ne)=>{if(ne==null||ne.stopPropagation(),!N)try{if(typeof s=="function")await s(H);else if(await U(H,l),t){const he=C.map(re=>({...re,isProfile:re._id===H}));t(he)}const Q=C.findIndex(he=>he._id===H);Q!==-1&&x(Q)}catch(Q){In.error("Failed to set profile photo:",Q)}},q=async(H,ne)=>{if(ne==null||ne.stopPropagation(),N)return;if(typeof H=="string"&&H.startsWith("temp-")){t&&t(C.filter(he=>he._id!==H));return}if(!window.confirm(g("confirmDeletePhoto","Are you sure you want to delete this photo?")))return;const Q=C.findIndex(he=>he._id===H);if(Q!==-1&&C[Q].isProfile){alert(g("cannotDeleteProfilePhoto","You cannot delete your profile photo. Please set another photo as your profile photo first."));return}try{if(typeof o=="function")await o(H,ne);else if(await A(H,l),t){const he=C.filter(re=>re._id!==H);t(he),Q<=P&&P>0?x(P-1):he.length===0&&x(0)}}catch(he){In.error("Failed to delete photo:",he)}},z=()=>{j.current&&i&&j.current.click()},K=()=>{P<C.length-1&&x(P+1)},W=()=>{P>0&&x(P-1)};return C.length===0?r.jsxs("div",{className:Ke.photoGallery,children:[r.jsx("h3",{className:Ke.galleryTitle,children:g("photos")}),r.jsx("div",{className:Ke.noPhotosMessage,children:r.jsxs("div",{className:Ke.placeholder,children:[r.jsx("div",{className:Ke.placeholderIcon,children:r.jsx(Cn,{size:48})}),r.jsx("p",{className:Ke.placeholderText,children:g("noPhotos","No photos available")}),i&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:Ke.uploadPhotoButton,onClick:z,disabled:D,children:D?r.jsxs(r.Fragment,{children:[r.jsx(Ws,{className:Ke.spinner}),g("uploading","Uploading...")]}):r.jsxs(r.Fragment,{children:[r.jsx(Cn,{}),g("addPhoto","Add Photo")]})}),r.jsx("input",{type:"file",ref:j,onChange:V,accept:"image/*",style:{display:"none"}})]})]})})]}):v?r.jsxs("div",{className:`${Ke.photoGallery} ${b?Ke.mobileGallery:""}`,children:[r.jsx("h3",{className:Ke.galleryTitle,children:g("photos")}),r.jsxs("div",{className:Ke.galleryGrid,children:[C.map(H=>{const ne=H.privacy||(H.isPrivate?"private":"public"),Q=ne==="private",he=Q&&!u&&!h;return r.jsxs("div",{className:`${Ke.photoItem} 
                          ${H.isProfile?Ke.profilePhotoItem:""} 
                          ${Q?Ke.hasPrivatePhoto:""}`,onClick:re=>X(H._id,re),children:[he?r.jsx("div",{className:Ke.privatePhoto,children:r.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:g("privatePhoto"),className:Ke.photoImage},`private-photo-${H._id}`)}):r.jsx("img",{src:Ns(H.url,!0),alt:g("photo"),className:Ke.photoImage,style:{opacity:Q?.7:1,filter:Q?"grayscale(0.3)":"none"},onError:re=>{In.debug(`Failed to load photo: ${H._id}`),re.target.src=`${window.location.origin}/placeholder.svg?height=100&width=100`}},`photo-${H._id}-${k}`),(i||c)&&r.jsxs("div",{className:Ke.photoControls,children:[c&&r.jsx("button",{onClick:re=>L(H._id,re),className:Ke.photoControlButton,title:g(ne==="private"?"makePublic":"makePrivate"),disabled:N,"aria-label":g(ne==="private"?"makePublic":"makePrivate"),children:ne==="private"?r.jsx(Na,{className:Ke.controlIcon}):r.jsx(vs,{className:Ke.controlIcon})}),i&&!H.isProfile&&r.jsx("button",{onClick:re=>X(H._id,re),className:Ke.photoControlButton,title:g("setAsProfilePhoto"),disabled:N,"aria-label":g("setAsProfilePhoto"),children:r.jsx(Ur,{className:Ke.controlIcon})}),i&&!H.isProfile&&r.jsx("button",{onClick:re=>q(H._id,re),className:Ke.photoControlButton,title:g("deletePhoto"),disabled:N,"aria-label":g("deletePhoto"),children:r.jsx(br,{className:Ke.controlIcon})})]}),ne==="private"&&r.jsx("div",{className:Ke.privacyOverlay,children:r.jsx(vs,{className:Ke.overlayIcon})}),H.isProfile&&r.jsx("div",{className:Ke.profileIndicator,children:r.jsx(Ur,{className:Ke.profileStar})})]},H._id)}),i&&r.jsxs("div",{className:Ke.addPhotoThumbnail,onClick:z,children:[r.jsx(Cn,{}),r.jsx("input",{type:"file",ref:j,onChange:V,accept:"image/*",style:{display:"none"}})]})]}),D&&r.jsxs("div",{className:Ke.uploadProgressContainer,children:[r.jsx("div",{className:Ke.uploadProgressBar,children:r.jsx("div",{className:Ke.uploadProgressFill,style:{width:`${w}%`}})}),r.jsxs("p",{className:Ke.uploadProgressText,children:[g("uploading","Uploading...")," ",w,"%"]})]})]}):r.jsxs("div",{className:Ke.photoGallery,children:[r.jsx("h3",{className:Ke.galleryTitle,children:g("photos")}),r.jsxs("div",{className:Ke.mainPhotoContainer,children:[(()=>{if(!G)return null;const H=G.privacy||(G.isPrivate?"private":"public");return H==="private"&&!u&&!h?r.jsxs("div",{className:Ke.privatePhoto,children:[r.jsx(vs,{className:Ke.lockIcon}),r.jsx("p",{children:g("privatePhoto","This photo is private")})]}):r.jsxs(r.Fragment,{children:[r.jsx("img",{src:Ns(G.url,!0),alt:g("photo","Photo"),className:Ke.mainPhoto,style:{opacity:H==="private"&&u?.7:1,filter:H==="private"&&u?"grayscale(0.3)":"none"},onError:Q=>{In.debug(`Failed to load main photo: ${G._id}`),Q.target.src=`${window.location.origin}/placeholder.svg`}},`main-photo-${G._id}-${k}`),H==="private"&&r.jsxs("div",{className:Ke.privateIndicator,children:[r.jsx(vs,{}),g("private","Private")]}),H==="friends_only"&&r.jsxs("div",{className:Ke.friendsIndicator,children:[r.jsx(Go,{}),g("friendsOnly","Friends Only")]}),G.isProfile&&r.jsxs("div",{className:Ke.profileIndicator,children:[r.jsx(Ur,{}),g("profilePhoto","Profile")]})]})})(),C.length>1&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:`${Ke.navButton} ${Ke.prevButton}`,onClick:W,disabled:P===0,"aria-label":g("previousPhoto","Previous photo"),children:r.jsx(Jd,{})}),r.jsx("button",{className:`${Ke.navButton} ${Ke.nextButton}`,onClick:K,disabled:P===C.length-1,"aria-label":g("nextPhoto","Next photo"),children:r.jsx(Qd,{})})]})]}),r.jsx("div",{className:Ke.thumbnailsContainer,children:r.jsxs("div",{className:Ke.thumbnails,children:[C.map((H,ne)=>{const Q=H.privacy||(H.isPrivate?"private":"public"),he=Q==="private"&&!u&&!h;return r.jsxs("div",{className:`${Ke.thumbnail} ${ne===P?Ke.activeThumbnail:""}`,onClick:()=>x(ne),children:[he?r.jsxs("div",{className:Ke.privateThumbnail,children:[r.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:g("privatePhoto","Private photo"),className:Ke.thumbnailImage}),r.jsx(vs,{className:Ke.thumbnailLockIcon})]}):r.jsx("img",{src:Ns(H.url,!0),alt:g("photoThumbnail",`Photo ${ne+1}`),className:Ke.thumbnailImage,style:{opacity:Q==="private"&&u?.7:1,filter:Q==="private"&&u?"grayscale(0.3)":"none"},onError:re=>{In.debug(`Failed to load thumbnail: ${H._id}`),re.target.src=`${window.location.origin}/placeholder.svg?height=60&width=60`}},`thumbnail-${H._id}-${k}`),H.isProfile&&r.jsx("div",{className:Ke.profileBadge,children:r.jsx(Ur,{})}),(i||c)&&r.jsxs("div",{className:Ke.thumbnailControls,children:[c&&r.jsx("button",{onClick:re=>L(H._id,re),className:Ke.controlButton,"aria-label":Q==="private"?g("makePublic","Make public"):g("makePrivate","Make private"),title:Q==="private"?g("makePublic","Make public"):g("makePrivate","Make private"),children:Q==="private"?r.jsx(Na,{}):r.jsx(vs,{})}),i&&!H.isProfile&&r.jsx("button",{onClick:re=>X(H._id,re),className:Ke.controlButton,"aria-label":g("setAsProfile","Set as profile photo"),title:g("setAsProfile","Set as profile photo"),children:r.jsx(Ur,{})}),i&&!H.isProfile&&r.jsx("button",{onClick:re=>q(H._id,re),className:Ke.controlButton,"aria-label":g("deletePhoto","Delete photo"),title:g("deletePhoto","Delete photo"),children:r.jsx(br,{})})]})]},H._id||`photo-${ne}`)}),i&&r.jsxs("div",{className:Ke.addPhotoThumbnail,onClick:z,children:[r.jsx(Cn,{}),r.jsx("input",{type:"file",ref:j,onChange:V,accept:"image/*",style:{display:"none"}})]})]})}),D&&r.jsxs("div",{className:Ke.uploadProgress,children:[r.jsx("div",{className:Ke.progressBar,children:r.jsx("div",{className:Ke.progressFill,style:{width:`${w}%`}})}),r.jsxs("p",{className:Ke.progressText,children:[g("uploading","Uploading...")," ",w,"%"]})]})]})};Du.propTypes={photos:O.arrayOf(O.shape({_id:O.oneOfType([O.string,O.object]),url:O.string.isRequired,privacy:O.string,isPrivate:O.bool,isProfile:O.bool,isDeleted:O.bool})),onPhotoChange:O.func,onSetProfilePhoto:O.func,onSetPrivacy:O.func,onDeletePhoto:O.func,canEdit:O.bool,canTogglePrivacy:O.bool,userId:O.string,isOwner:O.bool,canViewPrivate:O.bool,isProcessing:O.bool,isUploading:O.bool,uploadProgress:O.number,gridView:O.bool};const $0=pt.memo(Du),P0=(e,t,s={})=>{const{debug:n=!1}=s,o=n?(l,u)=>{const h=t?t(l,u):!0;if(!h){const a=Object.keys(u).filter(f=>l[f]!==u[f]),d=e.displayName||e.name||"Component";Ze.debug(`[withMemo] ${d} re-rendering due to props changes:`,a)}return h}:t,i=p.memo(e,o),c=e.displayName||e.name||"Component";return i.displayName=`withMemo(${c})`,i},Ft=Ze.create("NotificationsComponent");let Qs;try{Qs=new BroadcastChannel("notifications_sync"),Ft.info("BroadcastChannel API available for cross-tab sync.")}catch{Ft.warn("BroadcastChannel not supported in this browser. Cross-tab sync disabled."),Qs=null}const Bu=pt.memo(({notification:e,onClick:t})=>{const s=d=>{var f,v,g,b,$,T,F,M,E;return((f=d.sender)==null?void 0:f.nickname)||((g=(v=d.data)==null?void 0:v.sender)==null?void 0:g.nickname)||(($=(b=d.data)==null?void 0:b.requester)==null?void 0:$.nickname)||((F=(T=d.data)==null?void 0:T.owner)==null?void 0:F.nickname)||((E=(M=d.data)==null?void 0:M.user)==null?void 0:E.nickname)||"Someone"},n=d=>{switch(d){case"message":return gn;case"like":case"match":return On;case"photoRequest":case"photoResponse":return Cn;case"story":return gi;case"comment":return kr;case"call":return ru;default:return eo}},o=d=>{var f;switch(d.type){case"message":return d.count>1?`sent you ${d.count} messages`:"sent you a message";case"like":return"liked your profile";case"match":return"matched with you";case"photoRequest":return Ft.debug("Rendering photoRequest notification:",d),"requested access to your private photos";case"photoResponse":return Ft.debug("Rendering photoResponse notification:",d),(((f=d.data)==null?void 0:f.status)||"")==="approved"?"approved your photo request":"declined your photo request";case"story":return d.count>1?`shared ${d.count} new stories`:"shared a new story";case"comment":return d.count>1?`left ${d.count} comments on your post`:"commented on your post";case"call":return"called you";default:return"sent a notification"}};if(!e)return Ft.warn("NotificationItem received null notification prop."),null;const i=n(e.type),c=Wo(e.createdAt,{showRelative:!0,showTime:!1,showDate:!1}),l=e.count>1?e.count:null,u=s(e),h=o(e),a=p.useCallback(d=>{d.preventDefault(),d.stopPropagation(),Ft.debug("Notification item clicked:",e._id),t&&t(e)},[e,t]);return!e._id||!e.type||!e.createdAt?(Ft.error("Rendering NotificationItem with invalid data:",e),r.jsx("div",{className:"notification-item error",children:"Invalid notification data"})):r.jsxs("div",{className:`notification-item ${e.read?"":"unread"}`,onClick:a,role:"listitem","aria-labelledby":`notification-title-${e._id}`,"aria-describedby":`notification-desc-${e._id}`,children:[r.jsx("div",{className:"notification-icon","aria-hidden":"true",children:r.jsx(i,{})}),r.jsxs("div",{className:"notification-content",children:[r.jsxs("div",{className:"notification-title",id:`notification-title-${e._id}`,children:[r.jsx("span",{className:"notification-sender",children:u})," ",h,l&&r.jsxs("span",{className:"notification-count",children:[" (",l,")"]})]}),r.jsx("div",{className:"notification-message",id:`notification-desc-${e._id}`,children:e.message||e.content||e.title||""}),r.jsxs("div",{className:"notification-time",children:[c,!e.read&&r.jsx("span",{className:"notification-status",children:"• New"})]})]})]})});Bu.displayName="NotificationItem";const R0=({showHeader:e=!0,showFilters:t=!0,isDropdown:s=!1,isMobile:n=!1,onClose:o,maxHeight:i=400,className:c="",style:l={},customFilters:u=null})=>{const{t:h}=Ht(),{notifications:a,unreadCount:d,loading:f,socketConnected:v,markAllAsRead:g,addTestNotification:b,handleNotificationClick:$,fetchNotifications:T}=gu(),[F,M]=p.useState("all"),[E,U]=p.useState([]),[A,D]=p.useState(!1),[w,N]=p.useState(()=>typeof document<"u"?document.visibilityState:"visible"),P=p.useRef(null),x=p.useRef(Date.now()),k=p.useRef(null),R=p.useRef(!0);p.useEffect(()=>(R.current=!0,()=>{R.current=!1}),[]),p.useEffect(()=>{const q=()=>{if(typeof document>"u")return;const z=document.visibilityState;Ft.debug("Document visibility changed:",z),N(z),z==="visible"&&Date.now()-x.current>3e4&&(Ft.info("Tab became visible after >30s, refreshing notifications."),T(),x.current=Date.now())};if(typeof document<"u")return document.addEventListener("visibilitychange",q),()=>{document.removeEventListener("visibilitychange",q)}},[T]),p.useEffect(()=>{const q=z=>{if(!(z!=null&&z.data))return;const{type:K,data:W}=z.data;Ft.debug("Received cross-tab message:",K,W),(K==="NOTIFICATION_READ"||K==="NOTIFICATION_RECEIVED"||K==="NOTIFICATIONS_CLEARED")&&(Ft.info(`Cross-tab sync (${K}), refreshing notifications.`),T())};if(Qs)return Qs.addEventListener("message",q),()=>{Qs.removeEventListener("message",q)}},[T]),p.useEffect(()=>{const q=z=>{Ft.debug("⚡ DIRECT socket notification received in COMPONENT:",z),T(),x.current=Date.now(),Qs&&Qs.postMessage({type:"NOTIFICATION_RECEIVED",data:z})};if(Ae&&Ae.isConnected){Ft.debug("📱 Attaching socket event listeners in NotificationsComponent.");const K=["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall"].map(W=>Ae.on(W,q));return Ft.debug("Socket check - Connected:",Ae.isConnected()),()=>{Ft.debug("🧹 Cleaning up socket listeners in NotificationsComponent."),K.forEach(W=>{typeof W=="function"&&W()}),k.current&&clearTimeout(k.current)}}else Ft.warn("Socket service or socket instance not available for direct listeners.")},[T]);const j=p.useRef(v);p.useEffect(()=>{if(Ft.debug(`Socket connection state changed. Previous: ${j.current}, Current: ${v}`),!v&&j.current){Ft.warn("Socket disconnected. Initiating polling fallback.");const q=6e4,z=()=>{R.current&&!Ae.isConnected()?(Ft.debug("Polling for notifications (socket disconnected)."),T(),x.current=Date.now(),k.current=setTimeout(z,q)):(Ft.info("Polling stopped (component unmounted or socket reconnected)."),k.current&&(clearTimeout(k.current),k.current=null))};k.current&&clearTimeout(k.current),k.current=setTimeout(z,5e3)}return v&&!j.current&&(Ft.info("Socket reconnected. Stopping any active polling and refreshing."),k.current&&(clearTimeout(k.current),k.current=null),T(),x.current=Date.now()),j.current=v,()=>{k.current&&clearTimeout(k.current)}},[v,T]);const I=p.useRef((a==null?void 0:a.length)||0);p.useEffect(()=>{const q=(a==null?void 0:a.length)||0;q>I.current&&P.current&&(Ft.debug("New notifications detected, scrolling list to top."),P.current.scrollTop=0),I.current=q},[a]),p.useEffect(()=>{if(!a){U([]);return}Ft.debug(`Filtering notifications. Count: ${a.length}, Filter: ${F}`);let q=[...a];if(F!=="all")if(F==="unread")q=q.filter(W=>!W.read);else{const H={Photos:["photoRequest","photoResponse"],Likes:["like","match"],Messages:["message"]}[F]||[F];q=q.filter(ne=>H.includes(ne.type))}const z=[],K={};q.forEach(W=>{var Q,he,re,_e,ke;const ne=`${((Q=W.sender)==null?void 0:Q._id)||((re=(he=W.data)==null?void 0:he.sender)==null?void 0:re._id)||((ke=(_e=W.data)==null?void 0:_e.requester)==null?void 0:ke._id)||"unknown_sender"}_${W.type}`;K[ne]?(K[ne].count+=1,K[ne].originalItems.push(W),new Date(W.createdAt)>new Date(K[ne].createdAt)&&(K[ne].createdAt=W.createdAt)):K[ne]={...W,count:1,originalItems:[W]}}),Object.values(K).forEach(W=>z.push(W)),z.sort((W,H)=>new Date(H.createdAt)-new Date(W.createdAt)),U(z),Ft.debug(`Filtered notifications count: ${z.length}`)},[a,F]);const S=p.useCallback(async q=>{if(q&&(q.preventDefault(),q.stopPropagation()),!A){Ft.info("Manual refresh triggered."),D(!0);try{await T(),x.current=Date.now(),Z.success("Notifications refreshed!")}catch(z){Ft.error("Failed to refresh notifications:",z),Z.error("Could not refresh notifications. Please try again.")}finally{setTimeout(()=>{R.current&&D(!1)},300)}}},[T,A]),C=p.useCallback(q=>{Ft.debug("Filter changed to:",q),M(q),P.current&&(P.current.scrollTop=0)},[]),G=p.useCallback(q=>{q&&(q.preventDefault(),q.stopPropagation()),Ft.info("Marking all notifications as read."),g(),Qs&&Qs.postMessage({type:"NOTIFICATION_READ",data:{all:!0}}),Z.success("All notifications marked as read.")},[g]),V=p.useCallback(q=>{Ft.debug("Handling click for notification:",q._id),$(q),!q.read&&Qs&&Qs.postMessage({type:"NOTIFICATION_READ",data:{id:q._id}}),s&&o&&o()},[$,s,o]);p.useCallback(q=>{q&&(q.preventDefault(),q.stopPropagation()),Ft.info("Adding test notification."),b()},[b]);const L=p.useCallback(()=>{const q=[{id:"all",label:"All"},{id:"unread",label:"Unread"},{id:"Messages",label:"Messages"},{id:"Likes",label:"Likes"},{id:"Photos",label:"Photos"}];return u&&Array.isArray(u)?q.filter(z=>u.includes(z.id)):q},[u]),X=()=>{const q=L();return r.jsx("div",{className:"notification-filters",role:"tablist","aria-label":"Notification Filters",children:q.map(z=>r.jsx(xn,{className:`filter-btn ${F===z.id?"active":""}`,onClick:()=>C(z.id),variant:F===z.id?"primary":"secondary",size:"small",role:"tab","aria-selected":F===z.id,"aria-controls":"notification-list-panel",children:z.label},z.id))})};return f&&(a==null?void 0:a.length)===0?r.jsx("div",{className:`notification-loading ${c}`,style:l,children:r.jsx(Er,{size:"medium",text:h("loading","Loading notifications..."),centered:!0})}):!E||E.length===0?r.jsxs("div",{className:`notification-empty ${c}`,style:l,children:[r.jsx(eo,{size:32,"aria-hidden":"true"}),r.jsx("p",{children:F==="unread"?h("noUnreadNotifications","No unread notifications"):F==="all"?h("noNotifications","No notifications yet"):h("noFilteredNotifications","No {{filter}} notifications",{filter:F.toLowerCase()})}),r.jsxs("div",{className:"notification-empty-actions",children:[r.jsx(xn,{onClick:S,disabled:A,isLoading:A,variant:"secondary",size:"small",icon:r.jsx(Gi,{}),children:A?h("refreshing","Refreshing..."):h("refresh","Refresh")}),!1]}),!v&&r.jsxs("div",{className:"notification-connection-status",children:[r.jsxs("div",{className:"connection-info",children:[" ",r.jsx("span",{className:"connection-dot disconnected",title:"Disconnected"}),r.jsx("small",{children:h("updatesPaused","Real-time updates paused")})]}),r.jsx(xn,{onClick:()=>{Ft.info("Manual reconnect attempt triggered."),Ae!=null&&Ae.reconnect?(Ae.reconnect(),Z.info("Attempting to reconnect...")):Z.warn("Reconnect function not available.")},variant:"link",size:"small",icon:r.jsx(Gi,{}),className:"reconnect-btn",title:"Attempt to reconnect",children:h("reconnect","Reconnect")})]})]}):r.jsxs("div",{className:`notification-container ${c}`,style:l,role:"region","aria-label":"Notifications",children:[e&&r.jsxs("div",{className:"notification-header",children:[r.jsxs("div",{className:"notification-header-title",children:[r.jsx("span",{children:h("notificationsTitle","Notifications")}),F!=="all"&&r.jsxs("span",{className:"notification-filter-indicator",children:["(",F,")"]}),r.jsxs("div",{className:"notification-connection-indicator",title:v?"Real-time connection active":"Disconnected - Updates via polling",children:[r.jsx("span",{className:`connection-dot ${v?"connected":"disconnected"}`}),!v&&r.jsx("small",{className:"connection-status-text",children:h("offline","Offline")})]})]}),r.jsxs("div",{className:"notification-header-actions",children:[r.jsx(xn,{className:"notification-header-action",onClick:S,title:"Refresh notifications",variant:"link",size:"small",icon:r.jsx(Gi,{className:A?"spin":""}),disabled:A,"aria-label":"Refresh notifications",children:h("refresh","Refresh")}),d>0&&r.jsxs(xn,{className:"notification-header-action",onClick:G,variant:"link",size:"small",title:"Mark all notifications as read","aria-label":`Mark all ${d} as read`,children:[h("markAllRead","Mark all read")," (",d,")"]}),s&&o&&r.jsx(xn,{className:"notification-close-btn",onClick:o,variant:"secondary",size:"small",icon:r.jsx(Ts,{}),"aria-label":"Close notifications",children:h("close","Close")})]})]}),t&&!n&&X(),r.jsx("div",{ref:P,className:"notification-list",style:{maxHeight:`${i}px`},role:"list",id:"notification-list-panel","aria-live":"polite",children:E.map(q=>r.jsx(Bu,{notification:q,onClick:V},q._id||`notification-${Math.random()}`))}),t&&n&&r.jsx("div",{className:"notification-footer",children:X()})]})};function Uu(){const{theme:e,toggleTheme:t}=nc(),[s,n]=p.useState(!1);return p.useEffect(()=>{n(!0)},[]),s?r.jsx("button",{onClick:t,className:"theme-toggle-btn","aria-label":e==="dark"?"Switch to light mode":"Switch to dark mode",children:e==="dark"?r.jsx(r1,{}):r.jsx(Ym,{})}):null}const Tl=Ze.create("LayoutComponents"),M0=pt.memo(lo,(e,t)=>{var s,n,o,i,c,l,u,h;return((s=e.user)==null?void 0:s._id)===((n=t.user)==null?void 0:n._id)&&((o=e.user)==null?void 0:o.nickname)===((i=t.user)==null?void 0:i.nickname)&&((c=e.user)==null?void 0:c.online)===((l=t.user)==null?void 0:l.online)&&JSON.stringify((u=e.user)==null?void 0:u.photos)===JSON.stringify((h=t.user)==null?void 0:h.photos)&&e.size===t.size&&e.showOnlineStatus===t.showOnlineStatus&&e.className===t.className}),ro=()=>{const[e,t]=p.useState(!1),[s,n]=p.useState(!1),[o,i]=p.useState(!1),c=p.useRef(null),l=p.useRef(null),u=p.useRef(null),{unreadCount:h,addTestNotification:a}=gu(),{isAuthenticated:d,logout:f,user:v}=Xt(),{t:g}=Ht(),{isRTL:b}=ss(),$=ps();nr();const T=async A=>{A.preventDefault(),await f()},F=()=>{$("/profile")},M=A=>{A&&(A.preventDefault(),A.stopPropagation()),Tl.debug("Toggle notification dropdown"),t(D=>!D),n(!1)},E=A=>{A.preventDefault(),A.stopPropagation(),n(!s),t(!1)};p.useEffect(()=>{const A=D=>{const w=D.target.closest(".notification-button");c.current&&!c.current.contains(D.target)&&!w&&t(!1),l.current&&!l.current.contains(D.target)&&!D.target.closest(".user-menu")&&n(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const U=()=>{t(!1)};return r.jsx("header",{className:`app-header ${b?"rtl-header":""}`,children:r.jsxs("div",{className:"header-inner",children:[r.jsx("div",{className:"header-logo",onClick:()=>$("/"),children:r.jsx("span",{children:"Mandarin"})}),d&&r.jsx("nav",{className:"header-nav",children:r.jsxs("ul",{className:"nav-tabs",children:[r.jsx("li",{children:r.jsxs("button",{className:`nav-tab ${window.location.pathname==="/dashboard"?"active":""}`,onClick:()=>$("/dashboard"),children:[r.jsx(iu,{}),r.jsx("span",{className:"nav-text",children:g("search")})]})}),r.jsx("li",{children:r.jsxs("button",{className:`nav-tab ${window.location.pathname==="/messages"?"active":""}`,onClick:()=>$("/messages"),children:[r.jsx(Om,{}),r.jsx("span",{className:"nav-text",children:g("messages")})]})})]})}),r.jsxs("div",{className:"header-actions",children:[r.jsx(Uu,{}),r.jsx(Fu,{className:"navbar-language-selector"}),d?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"notification-wrapper",children:[r.jsxs("button",{ref:u,"aria-label":"Notifications",className:`notification-button ${o?"notification-pulse":""}`,onClick:A=>{A.stopPropagation(),A.preventDefault(),Tl.debug("Notification button clicked"),M(A)},style:{position:"relative",zIndex:102,cursor:"pointer"},children:[r.jsx(eo,{}),h>0&&r.jsx("span",{className:"notification-badge",children:h>9?"9+":h})]}),e&&r.jsx("div",{ref:c,className:"notification-dropdown",children:r.jsx(R0,{isDropdown:!0,maxHeight:400,onClose:U,className:"notification-dropdown-content",customFilters:["all","unread"]})})]}),r.jsx("div",{className:"user-menu",children:r.jsxs("div",{className:"user-avatar-container",onClick:E,children:[v?r.jsx(M0,{user:v,size:"small",alt:v.nickname,status:v.online?"online":null,showOnlineStatus:!0,className:"navbar-avatar"}):r.jsx(Aa,{className:"user-avatar-icon"}),s&&r.jsxs("div",{ref:l,className:"user-dropdown",children:[r.jsxs("div",{className:"user-dropdown-item",onClick:F,children:[r.jsx(Aa,{}),g("profile")]}),r.jsxs("div",{className:"user-dropdown-item",onClick:()=>$("/settings"),children:[r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"12",r:"3"}),r.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),g("settings")]}),r.jsxs("div",{className:"user-dropdown-item",onClick:()=>$("/subscription"),children:[r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("circle",{cx:"12",cy:"8",r:"7"}),r.jsx("polyline",{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"})]}),g("subscription")]}),r.jsx("div",{className:"user-dropdown-divider"}),r.jsxs("div",{className:"user-dropdown-item danger",onClick:T,children:[r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),r.jsx("polyline",{points:"16 17 21 12 16 7"}),r.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),g("logout")]})]})]})})]}):r.jsxs("div",{className:"auth-buttons",children:[r.jsx(yt,{to:"/login",className:"btn btn-outline me-2",children:g("login")}),r.jsx(yt,{to:"/register",className:"btn btn-primary",children:g("register")})]})]})]})})},L0="_userCard_1uxoq_4 _userCardVars_1uxoq_4",O0="_cardPhoto_1uxoq_114",F0="_online_1uxoq_149",D0="_userInfo_1uxoq_166",B0="_userNameRow_1uxoq_174",U0="_userName_1uxoq_174",q0="_userAge_1uxoq_196",z0="_unreadBadge_1uxoq_207",H0="_lastActive_1uxoq_222",V0="_location_1uxoq_223",W0="_icon_1uxoq_237",G0="_tagsContainer_1uxoq_248",Y0="_detailsRow_1uxoq_252",K0="_detailItem_1uxoq_259",J0="_detailLabel_1uxoq_266",Q0="_tag_1uxoq_248",X0="_identityTag_1uxoq_297",Z0="_identityWoman_1uxoq_307",ev="_identityMan_1uxoq_319",tv="_identityCouple_1uxoq_331",sv="_lookingForTag_1uxoq_344",nv="_intoTag_1uxoq_356",rv="_interestTag_1uxoq_368",ov="_moreCount_1uxoq_381",iv="_tagCategory_1uxoq_400",av="_categoryTitle_1uxoq_404",cv="_tagsGroup_1uxoq_415",lv="_tagsToggle_1uxoq_423",dv="_toggleBtn_1uxoq_427",uv="_actions_1uxoq_449",hv="_actionBtn_1uxoq_456",fv="_likeBtn_1uxoq_483",gv="_messageBtn_1uxoq_493",pv="_active_1uxoq_503",mv="_listItem_1uxoq_514 _userCardVars_1uxoq_4",yv="_listPhotoContainer_1uxoq_543",vv="_listPhoto_1uxoq_543",_v="_listInfo_1uxoq_556",wv="_listHeader_1uxoq_563",bv="_listName_1uxoq_570",xv="_listLastActive_1uxoq_585",Sv="_listActions_1uxoq_598",ot={userCard:L0,cardPhoto:O0,online:F0,userInfo:D0,userNameRow:B0,userName:U0,userAge:q0,unreadBadge:z0,lastActive:H0,location:V0,icon:W0,tagsContainer:G0,detailsRow:Y0,detailItem:K0,detailLabel:J0,tag:Q0,identityTag:X0,identityWoman:Z0,identityMan:ev,identityCouple:tv,lookingForTag:sv,intoTag:nv,interestTag:rv,moreCount:ov,tagCategory:iv,categoryTitle:av,tagsGroup:cv,tagsToggle:lv,toggleBtn:dv,actions:uv,actionBtn:hv,likeBtn:fv,messageBtn:gv,active:pv,listItem:mv,listPhotoContainer:yv,listPhoto:vv,listInfo:_v,listHeader:wv,listName:bv,listLastActive:xv,listActions:Sv},oa=Ze.create("UserCard"),Mn={IDENTITY:"identity",LOOKING_FOR:"lookingFor",INTO:"into",INTEREST:"interest"},La=(e,t="")=>{const s=ot.tag,n=t.toLowerCase();if(n.includes("woman"))return`${s} ${ot.identityWoman}`;if(n.includes("man"))return`${s} ${ot.identityMan}`;if(n.includes("couple"))return`${s} ${ot.identityCouple}`;switch(e){case Mn.IDENTITY:return`${s} ${ot.identityTag}`;case Mn.LOOKING_FOR:return`${s} ${ot.lookingForTag}`;case Mn.INTO:return`${s} ${ot.intoTag}`;case Mn.INTEREST:return`${s} ${ot.interestTag}`;default:return s}},Oa=({title:e,tags:t,tagType:s,translationNamespace:n,t:o,showAll:i,toggleShowAll:c,maxVisible:l=3})=>{if(!t||t.length===0)return null;const u=(d,f)=>f?o(f)||f:"",h=i?t:t.slice(0,l),a=t.length>l;return r.jsxs("div",{className:ot.tagCategory,children:[e&&r.jsx("h4",{className:ot.categoryTitle,children:e}),r.jsxs("div",{className:ot.tagsGroup,children:[h.map((d,f)=>r.jsx("span",{className:La(s,d),children:u("",d)},`${s}-${f}`)),a&&!i&&r.jsxs("span",{className:ot.moreCount,onClick:c,children:["+",t.length-l]})]})]})},qu=({user:e,isLiked:t=!1,onLike:s,viewMode:n="grid",onMessage:o,onClick:i,showExtendedDetails:c=!0,unreadMessageCount:l=0,hasUnreadMessages:u=!1})=>{const[h,a]=p.useState(!1),[d,f]=p.useState(!1),[v,g]=p.useState(null),[b,$]=p.useState(!1),T=ps(),{t:F}=Ht(),{isRTL:M}=ss(),{user:E}=Xt(),{getProfilePhotoUrl:U,handlePhotoLoadError:A,refreshAllAvatars:D}=nr(),w=p.useMemo(()=>({like:F("like")||"like",liked:F("liked")||"liked",message:F("message")||"message",online:F("online")||"online",offline:F("offline")||"offline",lastActive:F("lastActive")||"Last active",viewProfile:F("view")||"View",showMore:F("showMore")||"Show more",showLess:F("showLess")||"Show less"}),[F]),[N,P]=p.useState(Date.now());p.useEffect(()=>{const H=ne=>{var he;const Q=((he=ne==null?void 0:ne.detail)==null?void 0:he.timestamp)||Date.now();P(Q),typeof window<"u"&&(window.__photo_refresh_timestamp=Q)};return window.addEventListener("avatar:refresh",H),()=>{window.removeEventListener("avatar:refresh",H)}},[e.nickname]),p.useEffect(()=>{const H=new BroadcastChannel("photo-access-cache"),ne=Q=>{Q.data.type==="invalidate"&&Q.data.userId===(e==null?void 0:e._id)&&(g(null),$(!1))};return H.addEventListener("message",ne),()=>{H.removeEventListener("message",ne),H.close()}},[e==null?void 0:e._id]),p.useEffect(()=>{if(!(e!=null&&e._id)||e._id===(E==null?void 0:E._id)||b)return;try{const Q=JSON.parse(localStorage.getItem("photo-permissions-status")||"{}")[e._id],he=5*60*1e3;if(Q&&Q.timestamp&&Date.now()-Q.timestamp<he){g(Q.status);return}}catch(ne){oa.error("Failed to read localStorage:",ne)}$(!0);const H=`/users/${e._id}/photo-access-status`;qe.get(H).then(ne=>{let Q="none";if(ne&&ne.success&&(Q=ne.status||"none"),g(Q),Q!=="none")try{const he=JSON.parse(localStorage.getItem("photo-permissions-status")||"{}");he[e._id]={status:Q,timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(he))}catch(he){oa.error("Failed to update localStorage:",he)}}).catch(ne=>{oa.error("Failed to fetch photo access status:",ne),g("none")}).finally(()=>{$(!1)})},[e==null?void 0:e._id,E==null?void 0:E._id,v]);const x=p.useCallback(H=>{var ne;(ne=H==null?void 0:H.target)!=null&&ne.closest("button")||(i?i():e!=null&&e._id&&T(`/user/${e._id}`))},[i,T,e==null?void 0:e._id]),k=p.useCallback(H=>{H.stopPropagation(),H.preventDefault(),s&&(e!=null&&e._id)&&s(e._id,e.nickname)},[s,e==null?void 0:e._id,e==null?void 0:e.nickname]),R=p.useCallback(H=>{if(H.stopPropagation(),H.preventDefault(),o)o(H,e);else if(e){const ne=new CustomEvent("openChat",{detail:{recipient:e}});window.dispatchEvent(ne)}},[o,e]),j=p.useCallback(H=>{H==null||H.stopPropagation(),a(ne=>!ne)},[]),I=p.useCallback(H=>{H==null||H.stopPropagation(),f(ne=>!ne)},[]),S=p.useCallback(H=>H?!!(H.privacy==="private"||H.isPrivate||!("privacy"in H)&&!("isPrivate"in H)):!1,[]),C=p.useMemo(()=>E&&e&&E._id===e._id,[E,e]),G=p.useCallback(H=>{if(!H)return`${window.location.origin}/default-avatar.png`;if(H.details&&H.details.iAm){if(H.details.iAm==="woman")return`${window.location.origin}/women-avatar.png`;if(H.details.iAm==="man")return`${window.location.origin}/man-avatar.png`;if(H.details.iAm==="couple")return`${window.location.origin}/couple-avatar.png`}return`${window.location.origin}/default-avatar.png`},[]),V=p.useMemo(()=>{var he;if(!((he=e==null?void 0:e.photos)!=null&&he.length))return G(e);const H=e.photos.find(re=>re.isProfile)||e.photos[0];if(S(H)&&!C){if(b||v===null)return`${window.location.origin}/private-photo.png`;if(v!=="approved")return`${window.location.origin}/private-photo.png`}const ne=window.__photo_refresh_timestamp||N||Date.now(),Q=U(e);if(Q&&!Q.includes("_v=")&&!Q.includes("&_t=")){const re=Q.includes("?")?"&":"?";return`${Q}${re}_v=${ne}`}return Q},[e,U,S,C,N,G,v,b]);p.useEffect(()=>{if(!document.getElementById("private-photo-styles")){const H=document.createElement("style");H.id="private-photo-styles",H.innerHTML=`
        .private-photo-placeholder {
          object-fit: cover !important;
          width: 100% !important;
          height: 100% !important;
          border-radius: 4px !important;
        }
      `,document.head.appendChild(H)}},[]);const L=p.useMemo(()=>{if(!(e!=null&&e.details))return{age:null,location:null,identity:null,status:null,tags:{lookingFor:[],into:[],interests:[]}};const{age:H,location:ne,iAm:Q,maritalStatus:he,lookingFor:re=[],intoTags:_e=[],interests:ke=[]}=e.details;return{age:H,location:ne||F("unknownLocation")||"Unknown location",identity:Q||null,status:he||null,tags:{lookingFor:re,into:_e,interests:ke}}},[e==null?void 0:e.details,F]),X=p.useMemo(()=>e!=null&&e.isOnline?w.online:e!=null&&e.lastActive?Wo(e.lastActive,{showRelative:!0,showTime:!1,showDate:!1}):F("inactive")||"Never active",[e==null?void 0:e.lastActive,e==null?void 0:e.isOnline,F,w]);if(!e)return null;const q=()=>r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:k,"aria-label":`${t?"Unlike":"Like"} ${e.nickname}`,className:`${ot.actionBtn} ${ot.likeBtn} ${t?ot.active:""}`,children:[r.jsx(On,{}),t?w.liked:w.like]}),r.jsxs("button",{onClick:R,"aria-label":`Message ${e.nickname}`,className:`${ot.actionBtn} ${ot.messageBtn}`,children:[r.jsx(kr,{}),w.message]})]}),z=({isShowingMore:H,onToggle:ne,showMoreText:Q,showLessText:he})=>r.jsx("div",{className:ot.tagsToggle,children:r.jsx("span",{className:ot.toggleBtn,onClick:ne,children:H?r.jsxs(r.Fragment,{children:[he||w.showLess," ",r.jsx(Pm,{size:12})]}):r.jsxs(r.Fragment,{children:[Q||w.showMore," ",r.jsx($m,{size:12})]})})}),K=()=>r.jsx("div",{className:ot.tagsContainer,children:r.jsxs("div",{className:ot.detailsRow,children:[L.identity&&r.jsxs("div",{className:ot.detailItem,children:[r.jsxs("span",{className:ot.detailLabel,children:[F("iAm")||"I am",":"]}),r.jsx("span",{className:La(Mn.IDENTITY,L.identity),children:F(L.identity)||L.identity})]}),L.tags.lookingFor.length>0&&r.jsxs("div",{className:ot.detailItem,children:[r.jsxs("span",{className:ot.detailLabel,children:[F("lookingFor")||"Looking for",":"]}),r.jsx("span",{className:La(Mn.LOOKING_FOR,L.tags.lookingFor[0]),children:F(L.tags.lookingFor[0])||L.tags.lookingFor[0]}),L.tags.lookingFor.length>1&&r.jsxs("span",{className:ot.moreCount,children:["+",L.tags.lookingFor.length-1]})]})]})}),W=()=>r.jsxs(r.Fragment,{children:[(L.tags.lookingFor.length>0||L.tags.into.length>0||L.tags.interests.length>0)&&z({isShowingMore:d,onToggle:I,showMoreText:w.showMore,showLessText:w.showLess}),d&&r.jsxs(r.Fragment,{children:[r.jsx(Oa,{title:F("interests")||"Interests",tags:L.tags.interests,tagType:Mn.INTEREST,translationNamespace:"",t:F,showAll:h,toggleShowAll:j,maxVisible:n==="grid"?3:2}),r.jsx(Oa,{title:F("preferences")||"Preferences",tags:L.tags.into,tagType:Mn.INTO,translationNamespace:"",t:F,showAll:h,toggleShowAll:j,maxVisible:n==="grid"?3:2}),(L.tags.lookingFor.length>(n==="grid"?3:2)||L.tags.into.length>(n==="grid"?3:2)||L.tags.interests.length>(n==="grid"?3:2))&&z({isShowingMore:h,onToggle:j,showMoreText:F("showMore")||"Show more",showLessText:F("showLess")||"Show less"})]})]});return n==="grid"?r.jsxs("div",{className:ot.userCard,onClick:x,"data-userid":e._id,children:[r.jsxs("div",{className:ot.cardPhoto,children:[(()=>{var re,_e;const H=((re=e.photos)==null?void 0:re.find(ke=>ke.isProfile))||((_e=e.photos)==null?void 0:_e[0]),Q=S(H)&&C?.7:1,he=`user-${e._id}-photo-${(H==null?void 0:H._id)||"0"}-${window.__photo_refresh_timestamp||N||Date.now()}`;return r.jsx("img",{src:V,alt:e.nickname,loading:"lazy",crossOrigin:"anonymous",className:V.includes("private-photo.png")?"private-photo-placeholder":"",style:{opacity:Q,objectFit:"cover",width:"100%",height:"100%"},onError:ke=>{const Be=parseInt(ke.target.dataset.retryCount||"0");if(Be>=3){ke.target.onerror=null,Yr(ke.target.src),Yr(V);const Le=G(e);ke.target.src=Le;return}ke.target.dataset.retryCount=(Be+1).toString();const Oe=ke.target.src,Se=new URL(Oe);Se.searchParams.set("_v",Date.now().toString()),ke.target.src=Se.toString(),H!=null&&H._id&&Be===2&&(A(H._id,V),D())}},he)})(),e.isOnline&&r.jsx("span",{className:`${ot.onlineStatusIndicator} ${ot.online}`})]}),r.jsxs("div",{className:ot.userInfo,children:[r.jsxs("div",{className:ot.userNameRow,children:[r.jsxs("h3",{className:ot.userName,children:[e.nickname,L.age&&r.jsxs("span",{className:ot.userAge,children:[", ",L.age]})]}),u&&r.jsx("span",{className:ot.unreadBadge,children:l})]}),r.jsxs("p",{className:ot.lastActive,children:[r.jsx(tl,{className:ot.icon}),X]}),r.jsxs("p",{className:ot.location,children:[r.jsx(to,{className:ot.icon}),L.location]}),c&&r.jsxs(r.Fragment,{children:[K(),r.jsx("div",{className:ot.tagsContainer,children:W()})]}),r.jsx("div",{className:ot.actions,children:q()})]})]}):r.jsxs("div",{className:ot.listItem,onClick:x,"data-userid":e._id,children:[r.jsxs("div",{className:ot.listPhotoContainer,children:[(()=>{var re,_e;const H=((re=e.photos)==null?void 0:re.find(ke=>ke.isProfile))||((_e=e.photos)==null?void 0:_e[0]),Q=S(H)&&C?.7:1,he=`list-user-${e._id}-photo-${(H==null?void 0:H._id)||"0"}-${window.__photo_refresh_timestamp||N||Date.now()}`;return r.jsx("img",{src:V,alt:e.nickname,loading:"lazy",crossOrigin:"anonymous",className:`${ot.listPhoto} ${V.includes("private-photo.png")?"private-photo-placeholder":""}`,style:{opacity:Q,objectFit:"cover"},onError:ke=>{const Be=parseInt(ke.target.dataset.retryCount||"0");if(Be>=3){ke.target.onerror=null,Yr(ke.target.src),Yr(V);const Le=G(e);ke.target.src=Le;return}ke.target.dataset.retryCount=(Be+1).toString();const Oe=ke.target.src,Se=new URL(Oe);Se.searchParams.set("_v",Date.now().toString()),ke.target.src=Se.toString(),H!=null&&H._id&&Be===2&&(A(H._id,V),D())}},he)})(),e.isOnline&&r.jsx("span",{className:`${ot.onlineStatusIndicator} ${ot.online}`})]}),r.jsxs("div",{className:ot.listInfo,children:[r.jsxs("div",{className:ot.listHeader,children:[r.jsxs("h3",{className:ot.listName,children:[e.nickname,L.age&&r.jsxs("span",{className:ot.userAge,children:[", ",L.age]})]}),u&&r.jsx("span",{className:ot.unreadBadge,children:l})]}),r.jsxs("p",{className:ot.listLastActive,children:[r.jsx(tl,{className:ot.icon}),X]}),r.jsxs("p",{className:ot.location,children:[r.jsx(to,{className:ot.icon}),L.location]}),c&&r.jsxs(r.Fragment,{children:[K(),r.jsx("div",{className:ot.tagsContainer,children:W()})]})]}),r.jsx("div",{className:ot.listActions,children:q()})]})};qu.propTypes={user:O.shape({_id:O.string.isRequired,nickname:O.string.isRequired,isOnline:O.bool,lastActive:O.string,photos:O.arrayOf(O.shape({url:O.string})),details:O.shape({age:O.oneOfType([O.number,O.string]),gender:O.string,location:O.string,maritalStatus:O.string,iAm:O.string,lookingFor:O.arrayOf(O.string),intoTags:O.arrayOf(O.string),interests:O.arrayOf(O.string)})}).isRequired,isLiked:O.bool,onLike:O.func,viewMode:O.oneOf(["grid","list"]),onMessage:O.func,onClick:O.func,showExtendedDetails:O.bool,unreadMessageCount:O.number,hasUnreadMessages:O.bool};Oa.propTypes={title:O.string,tags:O.arrayOf(O.string).isRequired,tagType:O.string.isRequired,translationNamespace:O.string.isRequired,t:O.func.isRequired,showAll:O.bool.isRequired,toggleShowAll:O.func.isRequired,maxVisible:O.number};const Cv=P0(qu,(e,t)=>e.user._id===t.user._id&&e.isLiked===t.isLiked&&e.viewMode===t.viewMode&&e.hasUnreadMessages===t.hasUnreadMessages&&e.unreadMessageCount===t.unreadMessageCount&&e.user.isOnline===t.user.isOnline,{debug:!1}),si=Vr.MAX_SIZE.AVATAR,ni=[...Vr.ALLOWED_TYPES.IMAGES,...Vr.ALLOWED_TYPES.DOCUMENTS,...Vr.ALLOWED_TYPES.AUDIO,...Vr.ALLOWED_TYPES.VIDEOS,"text/plain"],zu=Gn.EMOJI.COMMON,kv=Nn.UI.LOADING_TIMEOUT,Nv=Nt.CONNECTION.RECONNECT_DELAY_MIN,Ev=Nn.UI.INPUT_FOCUS_DELAY,Tv=Nn.DEBOUNCE.TYPING,Av=Nn.DEBOUNCE.SMOOTH_SCROLL,jv=Nn.UI.UPLOAD_COMPLETE_DELAY,Iv="_appWrapper_1e6bd_6",$v="_messagesContainer_1e6bd_23",Pv="_sidebar_1e6bd_34",Rv="_chatArea_1e6bd_48",Mv="_hide_1e6bd_71",Lv="_fullWidth_1e6bd_84",Ov="_sidebarHeader_1e6bd_90",Fv="_chatHeader_1e6bd_90",Dv="_sidebarActions_1e6bd_111",Bv="_chatActions_1e6bd_111",Uv="_userInfo_1e6bd_118",qv="_userName_1e6bd_124",zv="_blockedTag_1e6bd_134",Hv="_pulseBg_1e6bd_1",Vv="_userStatus_1e6bd_152",Wv="_blockedStatus_1e6bd_158",Gv="_videoCallButton_1e6bd_163",Yv="_moreOptionsButton_1e6bd_163",Kv="_chatHeaderBtn_1e6bd_163",Jv="_spinner_1e6bd_182",Qv="_spin_1e6bd_182",Xv="_photoAccessGranted_1e6bd_197",Zv="_headerDropdown_1e6bd_206",e_="_dropdownItem_1e6bd_221",t_="_backButton_1e6bd_271",s_="_newConversationButton_1e6bd_290 _backButton_1e6bd_271",n_="_conversationsHeader_1e6bd_297",r_="_newMessageBtn_1e6bd_311",o_="_conversationsList_1e6bd_332",i_="_noConversations_1e6bd_341",a_="_startConversationBtn_1e6bd_361",c_="_conversationItem_1e6bd_376",l_="_active_1e6bd_391",d_="_unread_1e6bd_396",u_="_conversationName_1e6bd_396",h_="_avatarContainer_1e6bd_400",f_="_onlineStatusIndicator_1e6bd_406",g_="_online_1e6bd_406",p_="_conversationInfo_1e6bd_420",m_="_unreadBadge_1e6bd_443",y_="_conversationPreview_1e6bd_457",v_="_conversationTime_1e6bd_465",__="_chatUser_1e6bd_486",w_="_chatUserDetails_1e6bd_494",b_="_statusText_1e6bd_510",x_="_offline_1e6bd_521",S_="_messagesArea_1e6bd_535",C_="_messageGroup_1e6bd_550",k_="_dateSeparator_1e6bd_557",N_="_messageWrapper_1e6bd_595",E_="_sent_1e6bd_605",T_="_messageBubble_1e6bd_609",A_="_bubbleIn_1e6bd_1",j_="_received_1e6bd_641",I_="_systemMessage_1e6bd_651",$_="_systemMessageContent_1e6bd_677",P_="_errorContent_1e6bd_682",R_="_messageContent_1e6bd_688",M_="_messageMeta_1e6bd_693",L_="_metaSent_1e6bd_704",O_="_metaReceived_1e6bd_708",F_="_messageTime_1e6bd_712",D_="_statusIndicator_1e6bd_725",B_="_fileMessage_1e6bd_764",U_="_imageContainer_1e6bd_771",q_="_imageAttachment_1e6bd_781",z_="_loading_1e6bd_795",H_="_shine_1e6bd_1",V_="_imgCaption_1e6bd_807",W_="_fileAttachment_1e6bd_823",G_="_fileName_1e6bd_834",Y_="_fileSize_1e6bd_840",K_="_downloadLink_1e6bd_845",J_="_typingIndicatorBubble_1e6bd_858",Q_="_typingIndicator_1e6bd_858",X_="_dot_1e6bd_874",Z_="_typingAnimation_1e6bd_1",ew="_typingUserName_1e6bd_905",tw="_inputWrapper_1e6bd_912",sw="_inputArea_1e6bd_922",nw="_messageInput_1e6bd_933",rw="_blockedInput_1e6bd_958",ow="_emojiButton_1e6bd_964",iw="_attachButton_1e6bd_964",aw="_winkButton_1e6bd_964",cw="_sendButton_1e6bd_964",lw="_disabled_1e6bd_997",dw="_sending_1e6bd_1003",uw="_emojiPicker_1e6bd_1018",hw="_emojiHeader_1e6bd_1030",fw="_emojiList_1e6bd_1051",gw="_noActiveChat_1e6bd_1072",pw="_noMessages_1e6bd_1072",mw="_noActiveChatContent_1e6bd_1082",yw="_noMessagesContent_1e6bd_1082",vw="_startChatButton_1e6bd_1104",_w="_activeCallBanner_1e6bd_1123",ww="_incomingCallBanner_1e6bd_1123",bw="_incomingCallInfo_1e6bd_1143",xw="_activeCallInfo_1e6bd_1143",Sw="_callIcon_1e6bd_1149",Cw="_pulse_1e6bd_1",kw="_incomingCallActions_1e6bd_1164",Nw="_acceptCallBtn_1e6bd_1169",Ew="_declineCallBtn_1e6bd_1169",Tw="_endCallBtn_1e6bd_1169",Aw="_acceptCallBtnSmall_1e6bd_1182",jw="_declineCallBtnSmall_1e6bd_1182",Iw="_premiumBanner_1e6bd_1215",$w="_premiumInfo_1e6bd_1232",Pw="_premiumIcon_1e6bd_1238",Rw="_crownIcon_1e6bd_1238",Mw="_upgradeButton_1e6bd_1243",Lw="_upgradeBtn_1e6bd_1243",Ow="_pullToRefreshIndicator_1e6bd_1262",Fw="_refreshSuccess_1e6bd_1279",Dw="_refreshError_1e6bd_1283",Bw="_videoCallOverlay_1e6bd_1288",Uw="_appInstallBanner_1e6bd_1299",qw="_show_1e6bd_1314",zw="_appInstallText_1e6bd_1321",Hw="_installButton_1e6bd_1325",Vw="_attachmentPreview_1e6bd_1342",Ww="_attachmentInfo_1e6bd_1351",Gw="_attachmentName_1e6bd_1358",Yw="_attachmentSize_1e6bd_1366",Kw="_removeAttachment_1e6bd_1372",Jw="_uploadProgressContainer_1e6bd_1380",Qw="_uploadProgressLabel_1e6bd_1387",Xw="_uploadProgressBar_1e6bd_1394",Zw="_uploadProgressFill_1e6bd_1401",eb="_loadingMessages_1e6bd_1408",tb="_loadingActions_1e6bd_1417",sb="_retryButton_1e6bd_1423",nb="_reconnectButton_1e6bd_1423",rb="_initButton_1e6bd_1423",ob="_messageErrorDisplay_1e6bd_1438",ib="_errorIconLarge_1e6bd_1452",ab="_errorActions_1e6bd_1458",cb="_messagesLoading_1e6bd_1464",lb="_messageError_1e6bd_1438",db="_winkMessage_1e6bd_1501",ub="_blockedUserBanner_1e6bd_1507",hb="_unblockButton_1e6bd_1529",fb="_blockedChatArea_1e6bd_1547",gb="_winkContent_1e6bd_1556",pb="_messageLabel_1e6bd_1562",mb="_placeholderMessage_1e6bd_1569",yb="_error_1e6bd_682",vb="_pending_1e6bd_1578",_b="_actionButton_1e6bd_1602",wb="_messagesEnd_1e6bd_1844",Ve={appWrapper:Iv,messagesContainer:$v,sidebar:Pv,chatArea:Rv,hide:Mv,fullWidth:Lv,sidebarHeader:Ov,chatHeader:Fv,sidebarActions:Dv,chatActions:Bv,userInfo:Uv,userName:qv,blockedTag:zv,pulseBg:Hv,userStatus:Vv,blockedStatus:Wv,videoCallButton:Gv,moreOptionsButton:Yv,chatHeaderBtn:Kv,spinner:Jv,spin:Qv,photoAccessGranted:Xv,headerDropdown:Zv,dropdownItem:e_,backButton:t_,newConversationButton:s_,conversationsHeader:n_,newMessageBtn:r_,conversationsList:o_,noConversations:i_,startConversationBtn:a_,conversationItem:c_,active:l_,unread:d_,conversationName:u_,avatarContainer:h_,onlineStatusIndicator:f_,online:g_,conversationInfo:p_,unreadBadge:m_,conversationPreview:y_,conversationTime:v_,chatUser:__,chatUserDetails:w_,statusText:b_,offline:x_,messagesArea:S_,messageGroup:C_,dateSeparator:k_,messageWrapper:N_,sent:E_,messageBubble:T_,bubbleIn:A_,received:j_,systemMessage:I_,systemMessageContent:$_,errorContent:P_,messageContent:R_,messageMeta:M_,metaSent:L_,metaReceived:O_,messageTime:F_,statusIndicator:D_,fileMessage:B_,imageContainer:U_,imageAttachment:q_,loading:z_,shine:H_,imgCaption:V_,fileAttachment:W_,fileName:G_,fileSize:Y_,downloadLink:K_,typingIndicatorBubble:J_,typingIndicator:Q_,dot:X_,typingAnimation:Z_,typingUserName:ew,inputWrapper:tw,inputArea:sw,messageInput:nw,blockedInput:rw,emojiButton:ow,attachButton:iw,winkButton:aw,sendButton:cw,disabled:lw,sending:dw,emojiPicker:uw,emojiHeader:hw,emojiList:fw,noActiveChat:gw,noMessages:pw,noActiveChatContent:mw,noMessagesContent:yw,startChatButton:vw,activeCallBanner:_w,incomingCallBanner:ww,incomingCallInfo:bw,activeCallInfo:xw,callIcon:Sw,pulse:Cw,incomingCallActions:kw,acceptCallBtn:Nw,declineCallBtn:Ew,endCallBtn:Tw,acceptCallBtnSmall:Aw,declineCallBtnSmall:jw,premiumBanner:Iw,premiumInfo:$w,premiumIcon:Pw,crownIcon:Rw,upgradeButton:Mw,upgradeBtn:Lw,pullToRefreshIndicator:Ow,refreshSuccess:Fw,refreshError:Dw,videoCallOverlay:Bw,appInstallBanner:Uw,show:qw,appInstallText:zw,installButton:Hw,attachmentPreview:Vw,attachmentInfo:Ww,attachmentName:Gw,attachmentSize:Yw,removeAttachment:Kw,uploadProgressContainer:Jw,uploadProgressLabel:Qw,uploadProgressBar:Xw,uploadProgressFill:Zw,loadingMessages:eb,loadingActions:tb,retryButton:sb,reconnectButton:nb,initButton:rb,messageErrorDisplay:ob,errorIconLarge:ib,errorActions:ab,messagesLoading:cb,messageError:lb,winkMessage:db,blockedUserBanner:ub,unblockButton:hb,blockedChatArea:fb,winkContent:gb,messageLabel:pb,placeholderMessage:mb,error:yb,pending:vb,actionButton:_b,messagesEnd:wb},ds=Ze.create("MessageItem"),yi=pt.memo(({message:e,currentUserId:t,isSending:s=!1,customStyles:n=null})=>{var F;const o=n||Ve;if(!e||!e._id&&!e.tempId)return ds.warn("Invalid message object passed to MessageItem:",e),null;const i=M=>{var D,w;if(!M)return"";const E=(M.content||"").substring(0,30),U=((D=M.metadata)==null?void 0:D.fileName)||"",A=((w=M.createdAt)==null?void 0:w.substring(0,16))||"";return`${M.sender}-${A}-${U}-${E}-${M.type}`},c=pt.useMemo(()=>e.type==="file"?i(e):null,[e]),l=e.sender===t,u=e.type==="system",h=((F=e.metadata)==null?void 0:F.__localPlaceholder)===!0,a=e.error===!0;l&&!u&&ds.debug(`MessageItem: Rendering sent message ${e._id||e.tempId}, read: ${e.read}, pending: ${e.pending}, sender: ${e.sender}, currentUserId: ${t}`);let d=null;l&&!u&&!a?e.pending||e.tempId&&s?d=r.jsx(Ws,{className:"fa-spin",size:14,title:"Sending...",style:{color:"#65abff"}}):e.read?d=r.jsx(Im,{size:14,title:"Read",style:{color:"#4caf50"}}):d=r.jsx(jt,{size:14,title:"Sent",style:{color:"#65abff"}}):a&&(d=r.jsx(ec,{size:14,title:"Failed to send",style:{color:"#f44336"}}));const f=()=>r.jsx(r.Fragment,{children:a?r.jsxs("div",{className:o.errorMessageContent||o.messageContent,children:[r.jsx("span",{className:o.errorIcon,"aria-hidden":"true",children:"!"}),r.jsx("span",{children:e.content||"Failed to send"})]}):r.jsx("p",{className:o.messageContent,children:e.content||""})}),v=()=>r.jsxs("div",{className:o.winkContent,children:[r.jsx("p",{className:o.messageContent,children:"😉"}),r.jsx("span",{className:o.messageLabel,children:"Wink"})]}),g=()=>{var x,k;const{metadata:M}=e;if(!M)return r.jsx("p",{className:o.messageContent,children:"Attachment unavailable"});const E=M.fileUrl||M.url||M.serverUrl,U=h&&((x=M.url)!=null&&x.startsWith("blob:"))?M.url:null;let A=null;typeof window<"u"&&window.__fileMessages&&(e._id&&window.__fileMessages[e._id]?A=window.__fileMessages[e._id].url:c&&window.__fileMessagesByHash&&window.__fileMessagesByHash[c]&&(A=window.__fileMessagesByHash[c].url));const D=U||A||E,w=(k=M.fileType)==null?void 0:k.startsWith("image/"),N=R=>{if(typeof window<"u"&&R&&!R.startsWith("blob:")){window.__fileMessages||(window.__fileMessages={}),window.__fileMessagesByHash||(window.__fileMessagesByHash={});const j={url:R,timestamp:Date.now(),fileName:M.fileName};return e._id&&(window.__fileMessages[e._id]={...j,hash:c}),c&&(window.__fileMessagesByHash[c]={...j,id:e._id}),window.__fileUrlPersistTimeout||(window.__fileUrlPersistTimeout=setTimeout(()=>{try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash)),ds.debug(`Persisted ${Object.keys(window.__fileMessages).length} file URLs to localStorage`)}catch(I){ds.warn("Failed to persist file URLs to localStorage",I)}window.__fileUrlPersistTimeout=null},1e3)),!0}return!1},P=R=>M&&R?(M.url=R,M.fileUrl=R,M.serverUrl=R,!0):!1;return r.jsx("div",{className:o.fileMessage,children:w?r.jsxs("div",{className:o.imageContainer,children:[D?r.jsx("a",{href:E||"#",target:"_blank",rel:"noopener noreferrer",className:o.imageLink,onClick:R=>R.stopPropagation(),title:`View ${M.fileName||"image"}`,children:r.jsx("img",{src:D,alt:M.fileName||"Image attachment",className:Os(o.imageAttachment,h&&o.loading),loading:"lazy",style:{display:"block",visibility:"visible",minHeight:"100px"},onError:R=>{if(ds.error(`Failed to load image: ${D}`),R.target.onerror=null,R.target.src="/placeholder-error.svg",R.target.classList.remove(o.loading),typeof window<"u"){let j=!1;if(e._id&&window.__fileMessages&&window.__fileMessages[e._id]){const I=window.__fileMessages[e._id].url;I&&I!==D&&(ds.debug(`Attempting to recover image URL by ID: ${I}`),setTimeout(()=>{R.target.src=I,P(I)},100),j=!0)}if(!j&&c&&window.__fileMessagesByHash&&window.__fileMessagesByHash[c]){const I=window.__fileMessagesByHash[c].url;I&&I!==D&&(ds.debug(`Attempting to recover image URL by hash: ${I}`),setTimeout(()=>{R.target.src=I,P(I),e._id&&(window.__fileMessages[e._id]={url:I,timestamp:Date.now(),hash:c})},150),j=!0)}if(!j&&D&&D.startsWith("http")){const I=D.startsWith("https")?D.replace("https","http"):D.replace("http","https");ds.debug(`Attempting protocol switch recovery: ${I}`),setTimeout(()=>{R.target.src=I,R.target.complete&&R.target.naturalWidth>0&&(P(I),N(I))},200)}}},onLoad:R=>{R.target.classList.remove(o.loading);const j=R.target.src;j&&!j.startsWith("blob:")&&j!=="/placeholder-error.svg"&&(P(j),N(j))}})}):r.jsx("div",{className:o.imagePlaceholder,children:h?"Uploading...":"Image unavailable"}),r.jsxs("div",{className:o.imgCaption,children:[E?r.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",onClick:R=>R.stopPropagation(),title:`View ${M.fileName||"image"}`,children:M.fileName||"Image"}):r.jsx("span",{children:M.fileName||"Image"}),M.fileSize&&` (${Math.round(M.fileSize/1024)} KB)`,h&&!a&&r.jsx("span",{className:o.uploadingIndicatorSmall,children:" (Uploading...)"}),a&&r.jsx("span",{className:o.errorIndicatorSmall,children:" (Upload Failed)"})]})]}):r.jsxs("div",{className:o.fileAttachment,children:[r.jsx("span",{"aria-hidden":"true",children:Mu(M)}),r.jsxs("div",{className:o.fileInfo,children:[r.jsx("span",{className:o.fileName,children:M.fileName||"File"}),M.fileSize&&r.jsx("span",{className:o.fileSize,children:`(${Math.round(M.fileSize/1024)} KB)`}),!h&&E&&!a&&r.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",className:o.downloadLink,onClick:R=>R.stopPropagation(),download:M.fileName||!0,children:"Download"}),h&&!a&&r.jsx("span",{className:o.uploadingIndicator,children:"Uploading..."}),a&&r.jsx("span",{className:o.errorIndicator,children:"Upload Failed"})]})]})})},b=()=>r.jsx("div",{className:Os(o.systemMessageContent,e.error&&o.errorContent),children:r.jsx("p",{children:e.content})}),$=()=>r.jsxs("div",{className:o.videoCallMessage,children:[r.jsx(Xn,{className:o.videoIcon,"aria-hidden":"true"}),r.jsx("p",{className:o.messageContent,children:e.content||"Video Call Event"})]}),T=()=>{switch(e.type){case"text":return f();case"wink":return v();case"file":return g();case"system":return b();case"video":return $();default:return ds.warn(`Unsupported message type: ${e.type}`,e),r.jsx("p",{className:o.messageContent,children:"Unsupported message"})}};return pt.useEffect(()=>{if(e.type!=="file"||!e.metadata)return;const M=()=>{let E=null;if(typeof window<"u"){if(!window.__fileMessages){window.__fileMessages={};try{const U=localStorage.getItem("mandarin_file_urls");U&&(window.__fileMessages=JSON.parse(U)||{},ds.debug(`Loaded ${Object.keys(window.__fileMessages).length} file URLs from localStorage`))}catch(U){ds.warn("Error loading file URLs from localStorage",U)}}if(!window.__fileMessagesByHash){window.__fileMessagesByHash={};try{const U=localStorage.getItem("mandarin_file_urls_by_hash");U&&(window.__fileMessagesByHash=JSON.parse(U)||{})}catch(U){ds.warn("Error loading file URL hashes from localStorage",U)}}if(e._id&&window.__fileMessages[e._id])E=window.__fileMessages[e._id].url,ds.debug(`Found cached URL for ${e._id} via ID lookup`);else if(c&&window.__fileMessagesByHash[c])E=window.__fileMessagesByHash[c].url,ds.debug("Found cached URL for message via hash lookup"),e._id&&(window.__fileMessages[e._id]={url:E,timestamp:Date.now(),hash:c});else if(e.metadata.fileName){const U=Object.values(window.__fileMessages).filter(A=>A.fileName===e.metadata.fileName);U.length>0&&(E=U.sort((D,w)=>w.timestamp-D.timestamp)[0].url,ds.debug(`Found cached URL via filename match: ${e.metadata.fileName}`))}}return E&&e.metadata?(ds.debug(`Restoring file URL: ${E.substring(0,50)}...`),e.metadata.url=E,e.metadata.fileUrl=E,e.metadata.serverUrl=E,typeof window<"u"&&(e._id&&(window.__fileMessages[e._id]={url:E,timestamp:Date.now(),hash:c,fileName:e.metadata.fileName}),c&&(window.__fileMessagesByHash[c]={url:E,timestamp:Date.now(),id:e._id,fileName:e.metadata.fileName}),window.__fileUrlPersistTimeout||(window.__fileUrlPersistTimeout=setTimeout(()=>{try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash)),ds.debug("Persisted file URLs to localStorage")}catch(U){ds.warn("Failed to persist file URLs to localStorage",U)}window.__fileUrlPersistTimeout=null},1e3))),!0):!1};M(),(!e.metadata.url||!e.metadata.fileUrl)&&e._id&&setTimeout(()=>{!e.metadata.url&&!e.metadata.fileUrl&&(ds.debug(`Retrying URL recovery for message ${e._id}`),M())},500)},[e,c]),r.jsxs("div",{className:o.messageWrapper,children:[r.jsx("div",{className:Os(o.messageBubble||o.message,l?o.sent:o.received,u?o.systemMessage:"",a?o.error:"",e.type==="wink"?o.winkMessage:"",h?o.placeholderMessage:"",e.pending?o.pending:""),"data-system-type":e.systemType||"",role:u?"status":"listitem","aria-label":u?"System message":`${l?"Sent":"Received"} ${e.type} message`,children:T()}),!u&&r.jsxs("div",{className:Os(o.messageMeta,l?o.metaSent:o.metaReceived),children:[r.jsx("span",{className:o.messageTime,title:new Date(e.createdAt).toLocaleString(),children:Gg(e.createdAt)}),l&&r.jsx("span",{className:o.statusIndicator,"aria-hidden":"true",children:d})]})]})});yi.displayName="MessageItem";yi.propTypes={message:O.shape({_id:O.string,tempId:O.string,sender:O.string.isRequired,recipient:O.string,content:O.string,createdAt:O.string.isRequired,type:O.string.isRequired,read:O.bool,pending:O.bool,error:O.bool,metadata:O.shape({fileName:O.string,fileType:O.string,fileSize:O.number,fileUrl:O.string,url:O.string,__localPlaceholder:O.bool}),senderName:O.string,senderPhoto:O.string}).isRequired,currentUserId:O.string.isRequired,isSending:O.bool,customStyles:O.object};const vi=pt.memo(({messageValue:e,onInputChange:t,onSubmit:s,onWinkSend:n=()=>{},onFileAttachClick:o,onEmojiClick:i,userTier:c=ys.FREE,isSending:l=!1,isUploading:u=!1,attachmentSelected:h=!1,disabled:a=!1,isUserBlocked:d=!1,inputRef:f,placeholderText:v="Type a message...",customStyles:g=null})=>{const b=g||Ve,[$,T]=p.useState(!1),F=p.useRef(null),{t:M}=Ht(),E=p.useMemo(()=>({messagePlaceholder:M("messagePlaceholder")||"Type a message...",sendMessage:M("sendMessage")||"Send Message",sendFile:M("sendFile")||"Send File",attachFile:M("attachFile")||"Attach File",addEmoji:M("addEmoji")||"Add Emoji",closeEmojiPicker:M("closeEmojiPicker")||"Close emoji picker",selectEmoji:M("selectEmoji")||"Select Emoji",sendWink:M("sendWink")||"Send Wink",blockedUserMessage:M("blockedUserMessage")||"Cannot send messages to blocked users",upgradeToSendText:M("upgradeToSendText")||"Upgrade to send text messages",upgradeToSendFiles:M("upgradeToSendFiles")||"Upgrade to send files",freeAccountWink:M("freeAccountWink")||"Send a wink instead (Free Account)",messageInput:M("messageInput")||"Message Input"}),[M]),U=I=>{t(I)},A=I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),!l&&!u&&!a&&(e.trim()||h)&&(s(),I.target&&(I.target.style.height="auto")))},D=I=>{i(I),T(!1)};p.useEffect(()=>{const I=S=>{F.current&&!F.current.contains(S.target)&&!S.target.closest(`.${b.emojiButton}`)&&T(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]);const w=c===ys.FREE&&!h,N=(e.trim().length>0||h)&&!l&&!u&&!a,P=w?E.freeAccountWink||"Send a wink instead (Free Account)":v||E.messagePlaceholder||"Type a message...",x=a||l||u||w,k=a||l||u||c===ys.FREE,R=a||l||u,j=a||l||u;return r.jsxs("div",{className:b.inputWrapper,children:[$&&r.jsxs("div",{className:b.emojiPicker,ref:F,role:"dialog","aria-label":"Emoji picker",children:[r.jsxs("div",{className:b.emojiHeader,children:[r.jsx("h4",{children:E.selectEmoji||"Select Emoji"}),r.jsx("button",{onClick:()=>T(!1),"aria-label":E.closeEmojiPicker||"Close emoji picker",type:"button",children:r.jsx(Ts,{})})]}),r.jsx("div",{className:b.emojiList,children:zu.map(I=>r.jsx("button",{type:"button",onClick:()=>D(I),title:I,"aria-label":`Emoji ${I}`,children:I},I))})]}),r.jsxs("div",{className:b.inputArea,children:[r.jsx("button",{type:"button",className:b.emojiButton,onClick:()=>T(!$),disabled:j,title:"Add Emoji","aria-label":"Add Emoji","aria-expanded":$,children:r.jsx(s1,{})}),r.jsx("textarea",{ref:f,className:Os(b.messageInput,d&&b.blockedInput),placeholder:d?E.blockedUserMessage||"Cannot send messages to blocked users":P,value:e,onChange:U,onKeyPress:A,rows:1,disabled:x||d,title:d?E.blockedUserMessage||"This user is blocked":w?E.upgradeToSendText||"Upgrade to send text messages":E.messagePlaceholder||"Type a message (Shift+Enter for newline)","aria-label":E.messageInput||"Message Input"}),r.jsx("button",{type:"button",className:b.attachButton,onClick:o,disabled:k,title:c===ys.FREE?E.upgradeToSendFiles||"Upgrade to send files":E.attachFile||"Attach File","aria-label":E.attachFile||"Attach File",children:r.jsx(nu,{})}),r.jsx("button",{type:"button",className:b.winkButton,onClick:n,disabled:R,title:E.sendWink||"Send Wink","aria-label":E.sendWink||"Send Wink",children:r.jsx(On,{})}),r.jsx("button",{type:"button",onClick:s,className:Os(b.sendButton,!N&&b.disabled,(l||u)&&b.sending),disabled:!N,title:h?E.sendFile||"Send File":E.sendMessage||"Send Message","aria-label":h?E.sendFile||"Send File":E.sendMessage||"Send Message",children:l||u?r.jsx(Ws,{className:"fa-spin"}):r.jsx(Km,{})})]})]})});vi.displayName="ChatInput";vi.propTypes={messageValue:O.string.isRequired,onInputChange:O.func.isRequired,onSubmit:O.func.isRequired,onWinkSend:O.func,onFileAttachClick:O.func.isRequired,onEmojiClick:O.func.isRequired,userTier:O.string,isSending:O.bool,isUploading:O.bool,attachmentSelected:O.bool,disabled:O.bool,isUserBlocked:O.bool,inputRef:O.oneOfType([O.func,O.shape({current:O.instanceOf(Element)})]),placeholderText:O.string,customStyles:O.object};const Al=Ze.create("AttachmentPreview"),_i=pt.memo(({attachment:e,isUploading:t=!1,uploadProgress:s=0,onRemoveAttachment:n=()=>{},onFileSelected:o,onAttachmentClick:i,error:c=null,disabled:l=!1,userTier:u=null,showFileInput:h=!0,fileInputAccept:a=ni.join(","),customStyles:d=null})=>{const f=p.useRef(null),v=d||Ve,g=e!=null&&e.size?e.size<1024*1024?`(${Math.round(e.size/1024)} KB)`:`(${(e.size/(1024*1024)).toFixed(1)} MB)`:"",b=p.useCallback(T=>{var M;const F=(M=T.target.files)==null?void 0:M[0];if(F){if(F.size>si){const E=`File too large. Maximum size is ${si/1048576}MB.`;Al.warn(E,F),o&&o(null,E),T.target.value=null;return}if(!ni.includes(F.type)){const E=`File type (${F.type||"unknown"}) not supported.`;Al.warn(E,F),o&&o(null,E),T.target.value=null;return}o&&o(F),T.target.value=null}},[o]),$=p.useCallback(()=>{l||(i?i():f.current&&f.current.click())},[l,i]);return e?r.jsxs("div",{className:Os(v.attachmentPreview,c&&v.error),children:[r.jsxs("div",{className:v.attachmentInfo,children:[r.jsx("span",{className:v.fileIconPreview,children:Mu(e)}),r.jsx("span",{className:v.attachmentName,title:e.name,children:e.name}),r.jsx("span",{className:v.attachmentSize,children:g}),c&&r.jsx("span",{className:v.errorMessagePreview,children:c})]}),t?r.jsxs("div",{className:v.uploadProgressContainer,children:[r.jsx("div",{className:v.uploadProgressBar,style:{width:`${s}%`},role:"progressbar","aria-valuenow":s,"aria-valuemin":"0","aria-valuemax":"100"}),r.jsxs("span",{className:v.uploadProgressText,children:[s,"%"]})]}):r.jsx("button",{type:"button",className:v.removeAttachment,onClick:n,disabled:t||l,title:"Remove attachment","aria-label":"Remove attachment",children:r.jsx(Ts,{})})]}):h?r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"file",ref:f,style:{display:"none"},onChange:b,accept:a,disabled:l,"aria-hidden":"true"}),i&&r.jsx("button",{type:"button",className:v.attachButton,onClick:$,disabled:l||u==="FREE",title:u==="FREE"?"Upgrade to send files":"Attach File","aria-label":"Attach File",children:r.jsx(nu,{})})]}):null});_i.displayName="AttachmentPreview";_i.propTypes={attachment:O.object,isUploading:O.bool,uploadProgress:O.number,onRemoveAttachment:O.func,onFileSelected:O.func,onAttachmentClick:O.func,error:O.string,disabled:O.bool,userTier:O.string,showFileInput:O.bool,fileInputAccept:O.string,customStyles:O.object};const wi=pt.memo(({incomingCall:e=null,isCallActive:t,recipientNickname:s="user",onAcceptCall:n,onDeclineCall:o,onEndCall:i,useSmallButtons:c=!1,customStyles:l=null})=>{const u=l||Ve,h=c?u.declineCallBtnSmall:u.declineCallBtn,a=c?u.acceptCallBtnSmall:u.acceptCallBtn;return r.jsxs(r.Fragment,{children:[e&&!t&&r.jsxs("div",{className:u.incomingCallBanner,role:"alert","aria-live":"assertive",children:[r.jsxs("div",{className:u.incomingCallInfo,children:[r.jsx(Xn,{className:Os(u.callIcon,u.pulse)}),r.jsxs("span",{children:[e.callerName||"Someone"," is calling you"]})]}),r.jsxs("div",{className:u.incomingCallActions,children:[r.jsxs("button",{className:h,onClick:o,"aria-label":"Decline call",title:"Decline Call",children:[r.jsx(Ts,{})," ",!c&&"Decline"]}),r.jsxs("button",{className:a,onClick:n,"aria-label":"Accept call",title:"Accept Call",children:[r.jsx(Xn,{})," ",!c&&"Accept"]})]})]}),t&&r.jsxs("div",{className:u.activeCallBanner,role:"status",children:[r.jsxs("div",{className:u.activeCallInfo,children:[r.jsx(Xn,{className:u.callIcon}),r.jsxs("span",{children:["Call with ",s]})]}),r.jsxs("button",{className:u.endCallBtn,onClick:i,"aria-label":"End call",title:"End Call",children:[r.jsx(Ta,{})," End Call"]})]})]})});wi.displayName="CallBanners";wi.propTypes={incomingCall:O.shape({callId:O.string.isRequired,callerName:O.string,callerId:O.string.isRequired}),isCallActive:O.bool.isRequired,recipientNickname:O.string,onAcceptCall:O.func.isRequired,onDeclineCall:O.func.isRequired,onEndCall:O.func.isRequired,useSmallButtons:O.bool,customStyles:O.object};const bi=pt.memo(({onUpgradeClick:e,customStyles:t=null})=>{const s=t||Ve;return r.jsxs("div",{className:s.premiumBanner,role:"complementary","aria-label":"Premium subscription banner",children:[r.jsxs("div",{className:s.premiumInfo,children:[r.jsx(Xd,{className:s.premiumIcon,"aria-hidden":"true"}),r.jsx("span",{children:"Upgrade to send messages and make calls"})]}),r.jsx("button",{className:s.upgradeBtn,onClick:e,"aria-label":"Upgrade to premium",type:"button",children:"Upgrade Now"})]})});bi.displayName="PremiumBanner";bi.propTypes={onUpgradeClick:O.func.isRequired,customStyles:O.object};const Hu=({children:e,isUserBlocked:t=!1,className:s="",...n})=>{const o=typeof s=="boolean"?s?"active":"":s||"";return r.jsx("div",{className:Os(Ve.chatArea,t&&Ve.blockedChatArea,o),...n,children:e})};Hu.propTypes={children:O.node.isRequired,isUserBlocked:O.bool,className:O.string};const Vu=pt.memo(Hu),Wu=({conversation:e,isMobile:t=!1,onBackClick:s,onStartVideoCall:n,onProfileClick:o,onBlockUser:i,onReportUser:c,userTier:l,customStyles:u,pendingPhotoRequests:h,isApprovingRequests:a,onApprovePhotoRequests:d,isActionDisabled:f,isConnected:v,photoAccess:g=!1})=>{const b=u||Ve,[$,T]=p.useState(!1),F=p.useRef(null),M=p.useRef(null),{t:E}=Ht(),U=p.useMemo(()=>({approvePhotoRequests:E("approvePhotoRequests")||"Approve photo requests",blockedUserMessage:E("blockedUserMessage")||"You have blocked this user. They will not receive any messages from you.",disconnected:E("disconnected")||"Disconnected",connectionLost:E("connectionLost")||"Connection lost",startVideoCall:E("startVideoCall")||"Start video call",viewProfile:E("viewProfile")||"View Profile",blockUser:E("blockUser")||"Block User",unblockUser:E("unblockUser")||"Unblock User",reportUser:E("reportUser")||"Report User",blocked:E("blocked")||"Blocked",online:E("online")||"Online",offline:E("offline")||"Offline",moreOptions:E("moreOptions")||"More options",unblock:E("unblock")||"Unblock"}),[E]);if(p.useEffect(()=>{const k=R=>{F.current&&!F.current.contains(R.target)&&!M.current.contains(R.target)&&T(!1)};return document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[]),!e||!e.user)return null;const{user:A}=e,D=A.nickname||A.username||"User",w=k=>{k.stopPropagation(),T(R=>!R)},N=k=>{k.stopPropagation(),T(!1),o()},P=k=>{k.stopPropagation(),T(!1),i&&i(A._id)},x=k=>{k.stopPropagation(),T(!1),c&&c(A._id)};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:b.chatHeader,children:[t&&r.jsx("button",{className:b.backButton,onClick:s,"aria-label":"Back to conversations",type:"button",children:r.jsx(wr,{})}),r.jsxs("div",{className:b.conversationInfo,onClick:o,role:"button",tabIndex:0,"aria-label":`View ${D}'s profile`,onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&o()},children:[r.jsx(lo,{user:A,size:"medium",status:A.online?"online":"offline",showOnlineStatus:!0}),r.jsxs("div",{className:b.userInfo,children:[r.jsxs("h3",{className:b.userName,children:[D,A.isBlocked&&r.jsx("span",{className:b.blockedTag,children:U.blocked||"Blocked"})]}),r.jsx("span",{className:`${b.userStatus} ${A.isBlocked?b.blockedStatus:""}`,children:A.isBlocked?U.blocked||"Blocked":A.online?U.online||"Online":U.offline||"Offline"}),v===!1&&r.jsxs("span",{className:b.connectionStatus,title:U.connectionLost||"Connection lost",children:[r.jsx(ec,{className:b.statusIcon}),r.jsx("span",{children:U.disconnected||"Disconnected"})]})]})]}),r.jsxs("div",{className:b.chatActions,children:[d&&r.jsx("button",{className:`${b.chatHeaderBtn||b.videoCallButton} ${g?b.photoAccessGranted:""}`,onClick:d,title:h>0?`Approve ${h} photo request(s)`:g?"Revoke photo access":"Grant photo access","aria-label":g?"Revoke photo access":"Grant photo access",disabled:a,type:"button",children:a?r.jsx(Ws,{className:"fa-spin"}):g?r.jsx(Na,{}):r.jsx(vs,{})}),r.jsx("button",{className:b.videoCallButton,onClick:n,"aria-label":U.startVideoCall||"Start video call",title:U.startVideoCall||"Start video call",type:"button",disabled:l==="FREE"||(f!==void 0?f:!1),children:r.jsx(Xn,{})}),r.jsx("button",{ref:M,className:b.moreOptionsButton,onClick:w,"aria-label":U.moreOptions||"More options",title:U.moreOptions||"More options",type:"button",children:r.jsx(eu,{})}),$&&r.jsxs("div",{ref:F,className:b.headerDropdown,children:[r.jsxs("button",{className:b.dropdownItem,onClick:N,type:"button",children:[r.jsx(Qr,{})," ",U.viewProfile||"View Profile"]}),r.jsxs("button",{className:b.dropdownItem,onClick:P,type:"button",children:[r.jsx(Za,{})," ",A.isBlocked?U.unblockUser||"Unblock User":U.blockUser||"Block User"]}),r.jsxs("button",{className:b.dropdownItem,onClick:x,type:"button",children:[r.jsx(su,{})," ",U.reportUser||"Report User"]})]})]})]}),A.isBlocked&&r.jsxs("div",{className:b.blockedUserBanner,role:"alert",children:[r.jsxs("div",{children:[r.jsx(Bt,{}),U.blockedUserMessage||"You have blocked this user. They will not receive any messages from you."]}),r.jsx("button",{className:b.unblockButton,onClick:P,type:"button",children:U.unblock||"Unblock"})]})]})};Wu.propTypes={conversation:O.shape({user:O.shape({_id:O.string.isRequired,username:O.string,nickname:O.string,photo:O.string,online:O.bool,isBlocked:O.bool}).isRequired,pendingPhotoRequests:O.number}),isMobile:O.bool,onBackClick:O.func.isRequired,onStartVideoCall:O.func.isRequired,onProfileClick:O.func.isRequired,onBlockUser:O.func,onReportUser:O.func,userTier:O.string,customStyles:O.object,pendingPhotoRequests:O.number,isApprovingRequests:O.bool,onApprovePhotoRequests:O.func,isActionDisabled:O.bool,isConnected:O.bool,photoAccess:O.bool};const Gu=pt.memo(Wu),oo=pt.memo(({showTimeoutMessage:e,handleRetry:t,handleReconnect:s,customStyles:n=null})=>{const o=n||Ve;return r.jsxs("div",{className:o.loadingMessages,role:"status","aria-live":"polite",children:[r.jsx(Er,{size:"medium",text:e?"Taking longer than expected...":"Loading messages...",centered:!0}),e&&r.jsxs("div",{className:o.loadingActions,children:[r.jsx("button",{className:o.retryButton,onClick:t,"aria-label":"Retry loading messages",type:"button",children:"Retry Load"}),r.jsx("button",{className:o.reconnectButton,onClick:s,"aria-label":"Force reconnect",type:"button",children:"Reconnect"})]})]})});oo.displayName="LoadingIndicator";oo.propTypes={showTimeoutMessage:O.bool.isRequired,handleRetry:O.func.isRequired,handleReconnect:O.func.isRequired,customStyles:O.object};const xi=pt.memo(({error:e="An unknown error occurred.",handleRetry:t,handleForceInit:s,showInitButton:n=!1,customStyles:o=null})=>{const i=o||Ve;return r.jsxs("div",{className:i.messageErrorDisplay,role:"alert",children:[r.jsx(ec,{className:i.errorIconLarge,"aria-hidden":"true"}),r.jsx("p",{children:e}),r.jsxs("div",{className:i.errorActions,children:[r.jsx("button",{onClick:t,className:i.retryButton,"aria-label":"Retry loading messages",type:"button",children:"Retry Loading"}),n&&r.jsx("button",{onClick:s,className:i.initButton,"aria-label":"Force initialization",type:"button",children:"Force Init"})]})]})});xi.displayName="ErrorMessage";xi.propTypes={error:O.string,handleRetry:O.func.isRequired,handleForceInit:O.func.isRequired,showInitButton:O.bool,customStyles:O.object};const ic=pt.memo(({handleReconnect:e,isInitializing:t,customStyles:s=null})=>{const n=s||Ve;return r.jsxs("div",{className:n.loadingMessages,role:"status","aria-live":"polite",children:[r.jsx(Er,{size:"medium",text:t?"Initializing chat...":"Trying to reconnect...",centered:!0}),r.jsx("div",{className:n.errorActions,children:r.jsx("button",{onClick:e,className:n.retryButton,"aria-label":"Force reconnection",type:"button",children:"Reconnect Now"})})]})});ic.displayName="ConnectionIssueMessage";ic.propTypes={handleReconnect:O.func.isRequired,isInitializing:O.bool.isRequired,customStyles:O.object};const Si=pt.memo(({text:e="No messages yet.",hint:t=null,customStyles:s=null})=>{const n=s||Ve;return r.jsx("div",{className:n.noMessages,role:"status",children:r.jsxs("div",{className:n.noMessagesContent,children:[r.jsx(gn,{size:40,"aria-hidden":"true"}),r.jsx("p",{children:e}),t&&r.jsx("p",{className:n.hint,children:t})]})})});Si.displayName="NoMessagesPlaceholder";Si.propTypes={text:O.string,hint:O.string,customStyles:O.object};const bb="_dark_vfayn_1",xb="_container_vfayn_1",Sb="_btn_vfayn_1",Cb="_card_vfayn_1",kb="_fadeIn_vfayn_1",Nb="_slideUp_vfayn_1",Eb="_slideDown_vfayn_1",Tb="_slideLeft_vfayn_1",Ab="_slideRight_vfayn_1",jb="_pulse_vfayn_1",Ib="_spin_vfayn_157",$b="_videoCall_vfayn_4",Pb="_videoContainer_vfayn_26",Rb="_remoteVideoWrapper_vfayn_43",Mb="_remoteVideo_vfayn_43",Lb="_videoPlaceholder_vfayn_60",Ob="_remoteVideoPlaceholder_vfayn_67",Fb="_connectionQualityIndicator_vfayn_74",Db="_qualityCanvas_vfayn_87",Bb="_qualityText_vfayn_91",Ub="_remoteAudioIndicator_vfayn_98",qb="_localAudioIndicator_vfayn_109",zb="_audioLevelCanvas_vfayn_120",Hb="_connectingIndicator_vfayn_125",Vb="_waitingIndicator_vfayn_126",Wb="_errorIndicator_vfayn_127",Gb="_waitingSubtext_vfayn_151",Yb="_retryCount_vfayn_168",Kb="_errorMessage_vfayn_177",Jb="_errorIcon_vfayn_190",Qb="_retryButton_vfayn_196",Xb="_errorEndCallButton_vfayn_197",Zb="_audioOffIndicator_vfayn_228",e2="_localVideoWrapper_vfayn_243",t2="_localVideo_vfayn_243",s2="_localVideoPlaceholder_vfayn_270",n2="_callInfo_vfayn_277",r2="_videoStats_vfayn_293",o2="_callControls_vfayn_299",i2="_visible_vfayn_315",a2="_hidden_vfayn_320",c2="_controlButton_vfayn_326",l2="_active_vfayn_347",d2="_endCall_vfayn_351",u2="_qualityDot_vfayn_360",h2="_excellent_vfayn_371",f2="_good_vfayn_372",g2="_fair_vfayn_373",p2="_poor_vfayn_374",m2="_unknown_vfayn_375",y2="_callDuration_vfayn_385",v2="_fadeOut_vfayn_1",dt={dark:bb,"no-underline":"_no-underline_vfayn_1","app-wrapper":"_app-wrapper_vfayn_1","app-main":"_app-main_vfayn_1",container:xb,"main-content":"_main-content_vfayn_1",btn:Sb,"btn-sm":"_btn-sm_vfayn_1","btn-lg":"_btn-lg_vfayn_1","btn-primary":"_btn-primary_vfayn_1","btn-secondary":"_btn-secondary_vfayn_1","btn-outline":"_btn-outline_vfayn_1",card:Cb,"form-control":"_form-control_vfayn_1","section-title":"_section-title_vfayn_1","section-subtitle":"_section-subtitle_vfayn_1","gradient-text":"_gradient-text_vfayn_1","gradient-hero-text":"_gradient-hero-text_vfayn_1","glass-effect":"_glass-effect_vfayn_1","direction-changing":"_direction-changing_vfayn_1","sr-only":"_sr-only_vfayn_1","not-sr-only":"_not-sr-only_vfayn_1","skip-to-content":"_skip-to-content_vfayn_1","animate-fade-in":"_animate-fade-in_vfayn_1",fadeIn:kb,"animate-slide-up":"_animate-slide-up_vfayn_1",slideUp:Nb,"animate-slide-down":"_animate-slide-down_vfayn_1",slideDown:Eb,"animate-slide-left":"_animate-slide-left_vfayn_1",slideLeft:Tb,"animate-slide-right":"_animate-slide-right_vfayn_1",slideRight:Ab,"animate-pulse":"_animate-pulse_vfayn_1",pulse:jb,"animate-spin":"_animate-spin_vfayn_1",spin:Ib,"delay-100":"_delay-100_vfayn_1","delay-200":"_delay-200_vfayn_1","delay-300":"_delay-300_vfayn_1","delay-400":"_delay-400_vfayn_1","delay-500":"_delay-500_vfayn_1","hover-scale":"_hover-scale_vfayn_1","hover-translate-y":"_hover-translate-y_vfayn_1","hover-shadow":"_hover-shadow_vfayn_1","transform-gpu":"_transform-gpu_vfayn_1",videoCall:$b,videoContainer:Pb,remoteVideoWrapper:Rb,remoteVideo:Mb,videoPlaceholder:Lb,remoteVideoPlaceholder:Ob,connectionQualityIndicator:Fb,qualityCanvas:Db,qualityText:Bb,remoteAudioIndicator:Ub,localAudioIndicator:qb,audioLevelCanvas:zb,connectingIndicator:Hb,waitingIndicator:Vb,errorIndicator:Wb,waitingSubtext:Gb,retryCount:Yb,errorMessage:Kb,errorIcon:Jb,retryButton:Qb,errorEndCallButton:Xb,audioOffIndicator:Zb,localVideoWrapper:e2,localVideo:t2,localVideoPlaceholder:s2,callInfo:n2,videoStats:r2,callControls:o2,visible:i2,hidden:a2,controlButton:c2,active:l2,endCall:d2,qualityDot:u2,excellent:h2,good:f2,fair:g2,poor:p2,unknown:m2,callDuration:y2,fadeOut:v2},De=Ze.create("VideoCall"),_2=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:"turn:turn.example.org:3478",username:"turnuser",credential:"turnpassword"},{urls:"turn:turn.example.org:443?transport=tcp",username:"turnuser",credential:"turnpassword"}],fs={peerConnection:{iceServers:_2,iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},media:{video:{width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:24,max:30}},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},timeouts:{signaling:2e4,connection:3e4,reconnect:2e3,unansweredCall:45e3},retry:{maxCount:3},intervals:{stats:5e3,audioMeter:100}},os={drawConnectionQuality:(e,t)=>{if(!e)return;const s=e.getContext("2d");if(!s)return;s.clearRect(0,0,e.width,e.height);let n="#aaaaaa",o=0;switch(t){case"excellent":n="#4caf50",o=4;break;case"good":n="#8bc34a",o=3;break;case"fair":n="#ffc107",o=2;break;case"poor":n="#f44336",o=1;break;default:o=0}const i=Math.floor(e.width/5),c=Math.floor(i/4),l=i-c;s.fillStyle=n;for(let u=0;u<4;u++){const h=Math.floor(e.height*(.4+u*.2)),a=u*i,d=e.height-h;u<o?s.fillRect(a,d,l,h):(s.strokeStyle="#888888",s.lineWidth=1,s.strokeRect(a,d,l,h))}},drawAudioLevel:(e,t)=>{if(!e)return;const s=e.getContext("2d");if(!s)return;s.clearRect(0,0,e.width,e.height);const n=Math.min(1,Math.max(0,t)),o=s.createLinearGradient(0,e.height,0,0);o.addColorStop(0,"#4caf50"),o.addColorStop(.5,"#ffeb3b"),o.addColorStop(1,"#f44336"),s.fillStyle=o;const i=Math.round(e.height*n);s.fillRect(0,e.height-i,e.width,i),s.fillStyle="#222";for(let c=0;c<=10;c++){const l=e.height-c*e.height/10,u=c%5===0?10:5;s.fillRect(0,l,u,1)}},drawPlaceholderVideo:(e,t)=>{if(!e)return;const s=e.getContext("2d");if(!s)return;s.clearRect(0,0,e.width,e.height),s.fillStyle="#222",s.fillRect(0,0,e.width,e.height),s.fillStyle="#fff",s.font="20px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText(t||"Video Off",e.width/2,e.height/2),s.strokeStyle="#fff",s.lineWidth=2;const n=50,o=(e.width-n)/2,i=(e.height-n)/2-40;s.beginPath(),s.rect(o,i,n,n*.7),s.stroke(),s.beginPath(),s.arc(o+n/2,i+n*.35,n*.25,0,Math.PI*2),s.stroke(),s.beginPath(),s.moveTo(o-5,i-5),s.lineTo(o+n+5,i+n*.7+5),s.stroke()}},cn={getCandidateFingerprint:e=>e?typeof e=="string"?e:[e.candidate,e.sdpMid,e.sdpMLineIndex].join("|"):"",getSignalId:e=>{var t,s,n;if(!e||!e.type)return`invalid-${Date.now()}`;if(e.type==="ice-candidate")return`ice-${cn.getCandidateFingerprint(e.candidate)}`;if(e.type==="offer"||e.type==="answer"){const o=((s=(t=e.sdp)==null?void 0:t.sdp)==null?void 0:s.slice(0,150))||((n=e.sdp)==null?void 0:n.slice(0,150))||"";return`${e.type}-${o}`}return`${e.type}-${Date.now()}`},getConnectionQuality:e=>{if(!e)return"unknown";const t=e.iceConnectionState,s=e.connectionState;return s==="failed"||t==="failed"||s==="disconnected"||t==="disconnected"?"poor":s==="connecting"||t==="checking"?"fair":s==="connected"&&t==="connected"?"good":s==="connected"&&t==="completed"?"excellent":"unknown"},formatErrorMessage:e=>{if(!e)return null;if(typeof e=="string"){if(e.includes("Permission denied"))return"Camera or microphone access was denied. Please check browser permissions.";if(e.includes("NotFoundError")||e.includes("Devices not found"))return"Camera or microphone not found. Please check if they are connected and enabled.";if(e.includes("timed out"))return"Connection timed out. The other user may be offline.";if(e.includes("Could not access"))return"Unable to access camera or microphone. Please check connections and browser permissions.";if(e.includes("multiple attempts"))return"Connection failed after several attempts. Please check your network or try again later.";if(e.includes("Failed to set remote answer sdp: Called in wrong state"))return"Connection synchronization error. Attempting to recover...";if(e.includes("Failed to execute 'addIceCandidate'"))return"Network negotiation issue occurred. Attempting to continue...";if(e.includes("No answer"))return"No answer from the recipient. They may be away or unable to accept calls right now."}return`An unexpected error occurred${e?`: ${e.toString().split(":")[0]}`:""}. Please try again.`}},jl=e=>{const t=Math.floor(e/60),s=Math.floor(e%60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},Ci=({isOpen:e,user:t,recipient:s,onEndCall:n,socketService:o,isIncoming:i=!1,callId:c=null})=>{const l=s==null?void 0:s._id,u=(s==null?void 0:s.nickname)||"User",h=t==null?void 0:t._id,a={localVideo:p.useRef(null),remoteVideo:p.useRef(null),localPlaceholder:p.useRef(null),remotePlaceholder:p.useRef(null),qualityCanvas:p.useRef(null),localAudioCanvas:p.useRef(null),remoteAudioCanvas:p.useRef(null),localStream:p.useRef(null),peerConnection:p.useRef(null),audioAnalyser:p.useRef(null),audioData:p.useRef(null),remoteAudioAnalyser:p.useRef(null),remoteAudioData:p.useRef(null),signallingTimeout:p.useRef(null),connectionTimeout:p.useRef(null),reconnectTimeout:p.useRef(null),candidateFlushTimeout:p.useRef(null),statsInterval:p.useRef(null),audioMeterInterval:p.useRef(null),unansweredCallTimeout:p.useRef(null),iceCandidateQueue:p.useRef([]),processedCandidates:p.useRef(new Set),processedSignals:p.useRef(new Set),incomingSignalQueue:p.useRef([]),negotiationInProgress:p.useRef(!1),isMounted:p.useRef(!1),connectionCompleted:p.useRef(!1),callAnswered:p.useRef(!1)},[d,f]=p.useState(!0),[v,g]=p.useState(!1),[b,$]=p.useState(!1),[T,F]=p.useState(!1),[M,E]=p.useState(!1),[U,A]=p.useState(!1),[D,w]=p.useState(!1),[N,P]=p.useState(null),[x,k]=p.useState(0),[R,j]=p.useState(0),[I,S]=p.useState(!0),[C,G]=p.useState("unknown"),[V,L]=p.useState(0),[X,q]=p.useState(0),[z,K]=p.useState({resolution:"",frameRate:0,bitrate:0}),[W,H]=p.useState(!1),ne=p.useCallback(async()=>{if(De.debug("Initializing local media..."),f(!0),P(null),a.localStream.current){De.debug("Reusing existing media stream."),a.localVideo.current&&a.localVideo.current.srcObject!==a.localStream.current&&(a.localVideo.current.srcObject=a.localStream.current),!a.audioAnalyser.current&&a.localStream.current.getAudioTracks().length>0&&Q();return}try{let Y=null;try{De.debug("Requesting user media with video and audio constraints."),Y=await navigator.mediaDevices.getUserMedia({video:fs.media.video,audio:fs.media.audio}),De.debug("Acquired video and audio stream."),$(!1),F(!1)}catch(_){De.warn(`Media acquisition with audio+video failed: ${_.message}. Trying fallbacks.`);try{Y=await navigator.mediaDevices.getUserMedia({video:fs.media.video}),$(!0),F(!1),Z.warning("Microphone access failed. You are muted."),De.warn("Acquired video-only stream.")}catch(m){De.warn(`Video-only acquisition failed: ${m.message}. Trying audio only.`);try{Y=await navigator.mediaDevices.getUserMedia({audio:fs.media.audio}),$(!1),F(!0),Z.warning("Camera access failed. Using audio only."),De.warn("Acquired audio-only stream.")}catch(y){throw De.error(`All media acquisition attempts failed: ${y.message}`),new Error("Could not access camera or microphone. Check connections & browser permissions.")}}}if(!Y)throw new Error("Media stream acquisition failed unexpectedly.");a.localStream.current=Y,a.localVideo.current&&(a.localVideo.current.srcObject=Y,a.localVideo.current.muted=!0,(Y.getVideoTracks().length===0||!Y.getVideoTracks()[0].enabled)&&(F(!0),a.localPlaceholder.current&&os.drawPlaceholderVideo(a.localPlaceholder.current,"Camera Off"))),Y.getAudioTracks().length>0&&Q(),De.info("Media initialized successfully.")}catch(Y){throw De.error("Media initialization failed:",Y),P(`Media Error: ${Y.message}`),f(!1),Y}},[]),Q=p.useCallback(()=>{if(!(!a.localStream.current||!a.localStream.current.getAudioTracks().length))try{const Y=new(window.AudioContext||window.webkitAudioContext),_=Y.createMediaStreamSource(a.localStream.current),m=Y.createAnalyser();m.fftSize=256,_.connect(m),a.audioAnalyser.current=m,a.audioData.current=new Uint8Array(m.frequencyBinCount),a.audioMeterInterval.current&&clearInterval(a.audioMeterInterval.current),a.audioMeterInterval.current=setInterval(()=>{he()},fs.intervals.audioMeter),De.debug("Audio visualization setup complete")}catch(Y){De.warn("Could not setup audio visualization:",Y)}},[]),he=p.useCallback(()=>{if(a.audioAnalyser.current&&a.audioData.current&&!b){a.audioAnalyser.current.getByteFrequencyData(a.audioData.current);const _=Array.from(a.audioData.current).reduce((m,y)=>m+y,0)/a.audioData.current.length/255;L(_),a.localAudioCanvas.current&&os.drawAudioLevel(a.localAudioCanvas.current,_)}else b&&a.localAudioCanvas.current&&(os.drawAudioLevel(a.localAudioCanvas.current,0),L(0));if(a.remoteAudioAnalyser.current&&a.remoteAudioData.current&&!M){a.remoteAudioAnalyser.current.getByteFrequencyData(a.remoteAudioData.current);const _=Array.from(a.remoteAudioData.current).reduce((m,y)=>m+y,0)/a.remoteAudioData.current.length/255;q(_),a.remoteAudioCanvas.current&&os.drawAudioLevel(a.remoteAudioCanvas.current,_)}else M&&a.remoteAudioCanvas.current&&(os.drawAudioLevel(a.remoteAudioCanvas.current,0),q(0))},[b,M]),re=p.useCallback(async()=>{if(!a.peerConnection.current)return;if(a.candidateFlushTimeout.current&&(clearTimeout(a.candidateFlushTimeout.current),a.candidateFlushTimeout.current=null),!a.peerConnection.current.remoteDescription){De.debug("Remote description not set yet, delaying candidate flush"),a.candidateFlushTimeout.current=setTimeout(re,500);return}const Y=[...a.iceCandidateQueue.current];a.iceCandidateQueue.current=[],Y.length>0&&De.debug(`Flushing ${Y.length} queued ICE candidates.`);for(const _ of Y)try{const m=cn.getCandidateFingerprint(_);a.processedCandidates.current.has(m)||(await a.peerConnection.current.addIceCandidate(new RTCIceCandidate(_)),a.processedCandidates.current.add(m))}catch(m){De.error("Error adding queued ICE candidate:",m),(m.name==="OperationError"||m.message.includes("prerequisite"))&&a.iceCandidateQueue.current.push(_)}a.iceCandidateQueue.current.length>0&&!a.candidateFlushTimeout.current&&(a.candidateFlushTimeout.current=setTimeout(re,1e3))},[]),_e=p.useCallback(async(Y={})=>{if(!o){De.warn("createOffer: socketService prop is not available.");return}if(!a.peerConnection.current){De.error("Cannot create offer: Peer connection does not exist.");return}const _=a.peerConnection.current;if(_.signalingState!=="stable"){De.warn(`Cannot create offer in signaling state: ${_.signalingState}. Aborting.`);return}if(a.negotiationInProgress.current){De.warn("Negotiation already in progress, skipping offer creation.");return}try{a.negotiationInProgress.current=!0;const m={offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:(Y==null?void 0:Y.iceRestart)||!1},y=await _.createOffer(m);if(_.signalingState!=="stable"){De.warn(`Signaling state changed to ${_.signalingState} during offer creation. Aborting.`),a.negotiationInProgress.current=!1;return}await _.setLocalDescription(y);const B={type:"offer",sdp:_.localDescription},J=cn.getSignalId(B);a.processedSignals.current.add(J),o.emit("videoSignal",{recipientId:l,signal:B,from:{userId:h,callId:c}}),re(),!i&&!a.callAnswered.current&&(H(!0),a.unansweredCallTimeout.current&&clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=setTimeout(()=>{!a.callAnswered.current&&a.isMounted.current&&(De.warn("Call went unanswered for too long. Ending call attempt."),P("No answer from the recipient. They may be away or unable to accept calls right now."),f(!1),H(!1),n&&setTimeout(()=>{a.isMounted.current&&n()},5e3))},fs.timeouts.unansweredCall))}catch(m){De.error("Error creating or setting offer:",m),P(`Signaling Error: ${m.message}`),a.negotiationInProgress.current=!1,tt(_e)}},[l,h,c,re,i,n,o]),ke=p.useCallback(async()=>{De.debug(`Starting signaling. Role: ${i?"Callee (Incoming)":"Caller (Outgoing)"}`),a.signallingTimeout.current&&clearTimeout(a.signallingTimeout.current),a.signallingTimeout.current=setTimeout(()=>{a.isMounted.current&&!v&&d&&(De.error("Signaling timeout reached. Connection failed."),P("Connection timed out. The other user may be offline or have network issues."),f(!1),H(!1))},fs.timeouts.signaling);try{if(!a.peerConnection.current)throw new Error("Peer connection not initialized before starting signaling.");i?De.debug("Incoming call: Waiting for offer from caller."):(De.debug("Outgoing call: Creating initial offer."),await _e())}catch(Y){De.error("Error during signaling initiation:",Y),P(`Signaling Error: ${Y.message}`),f(!1),H(!1)}},[i,_e,v,d]),Be=p.useCallback(()=>{if(a.incomingSignalQueue.current.length>0){De.debug(`Flushing ${a.incomingSignalQueue.current.length} queued incoming signals`);const Y=[...a.incomingSignalQueue.current];a.incomingSignalQueue.current=[],Y.forEach(_=>{ut(_)})}},[]),Oe=p.useCallback(Y=>{if(!o){De.warn("handleICECandidate: socketService prop is not available.");return}if(Y.candidate&&a.peerConnection.current){const _=cn.getCandidateFingerprint(Y.candidate);if(a.processedCandidates.current.has(_))return;a.processedCandidates.current.add(_),o.emit("videoSignal",{recipientId:l,signal:{type:"ice-candidate",candidate:Y.candidate.toJSON()},from:{userId:h,callId:c}})}},[l,h,c,o]),Se=p.useCallback(Y=>{try{if(!Y.streams||Y.streams.length===0){De.warn("Remote track received without a stream.");return}const _=Y.streams[0];if(Y.track.kind==="audio"&&!a.remoteAudioAnalyser.current)try{const m=new(window.AudioContext||window.webkitAudioContext),y=m.createMediaStreamSource(_),B=m.createAnalyser();B.fftSize=256,y.connect(B),a.remoteAudioAnalyser.current=B,a.remoteAudioData.current=new Uint8Array(B.frequencyBinCount)}catch(m){De.warn("Could not setup remote audio visualization:",m)}if(a.remoteVideo.current&&a.remoteVideo.current.srcObject!==_&&(a.remoteVideo.current.srcObject=_,a.connectionCompleted.current=!0,a.callAnswered.current=!0,g(!0),f(!1),H(!1),P(null),k(0),a.connectionTimeout.current&&(clearTimeout(a.connectionTimeout.current),a.connectionTimeout.current=null),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null)),Y.track.kind==="audio"){const m=Y.track.muted||!Y.track.enabled;E(m),Y.track.onmute=()=>E(!0),Y.track.onunmute=()=>E(!1),Y.track.onended=()=>E(!0)}else if(Y.track.kind==="video"){const m=Y.track.muted||!Y.track.enabled;A(m),m&&a.remotePlaceholder.current&&os.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off"),Y.track.onmute=()=>{A(!0),a.remotePlaceholder.current&&os.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off")},Y.track.onunmute=()=>A(!1),Y.track.onended=()=>{A(!0),a.remotePlaceholder.current&&os.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Video Ended")}}}catch(_){De.error("Error handling remote track:",_)}},[]),Le=p.useCallback(()=>{if(!a.peerConnection.current)return;const Y=a.peerConnection.current,_=Y.connectionState,m=Y.iceConnectionState,y=cn.getConnectionQuality(Y);G(y),a.qualityCanvas.current&&os.drawConnectionQuality(a.qualityCanvas.current,y),De.debug(`Connection states changed - RTCPeerConnection: ${_}, ICE: ${m}`),_==="connected"||m==="connected"||m==="completed"?(a.connectionCompleted.current=!0,a.callAnswered.current=!0,g(!0),f(!1),H(!1),P(null),a.negotiationInProgress.current=!1,k(0),a.connectionTimeout.current&&(clearTimeout(a.connectionTimeout.current),a.connectionTimeout.current=null),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null),re()):_==="disconnected"||m==="disconnected"?(De.warn(`Connection state: ${_}, ICE state: ${m}`),setTimeout(()=>{var B,J,ce;a.isMounted.current&&(((B=a.peerConnection.current)==null?void 0:B.connectionState)==="disconnected"||((J=a.peerConnection.current)==null?void 0:J.iceConnectionState)==="disconnected")&&(De.warn("Connection still disconnected after grace period"),g(!1),((ce=a.peerConnection.current)==null?void 0:ce.iceConnectionState)==="disconnected"&&tt(_e))},3e3)):_==="failed"||m==="failed"?(De.error(`Connection failed - state: ${_}, ICE: ${m}`),g(!1),f(!1),P("Connection failed. Please retry."),we(Me,ke)):_==="closed"?(De.info("Connection closed"),g(!1),f(!1)):(_==="connecting"||m==="checking")&&(v||f(!0))},[re,v]),Me=p.useCallback(async()=>{De.debug("Creating new RTCPeerConnection"),a.peerConnection.current&&(a.peerConnection.current.close(),a.peerConnection.current=null),a.processedCandidates.current.clear(),a.processedSignals.current.clear(),a.iceCandidateQueue.current=[],a.incomingSignalQueue.current=[],a.negotiationInProgress.current=!1;try{const Y=new RTCPeerConnection(fs.peerConnection);if(a.localStream.current)a.localStream.current.getTracks().forEach(_=>{try{Y.addTrack(_,a.localStream.current)}catch(m){De.error(`Failed to add ${_.kind} track:`,m)}});else throw De.warn("No local stream available when creating peer connection."),new Error("Local media stream missing.");return Y.ontrack=Se,Y.onicecandidate=Oe,Y.onconnectionstatechange=Le,Y.oniceconnectionstatechange=Le,Y.onicegatheringstatechange=()=>{Y.iceGatheringState==="complete"&&re()},Y.onsignalingstatechange=()=>{a.negotiationInProgress.current=Y.signalingState!=="stable"},a.peerConnection.current=Y,Be(),Y}catch(Y){throw De.error("Fatal error creating peer connection:",Y),P(`Failed to initialize connection: ${Y.message}`),f(!1),Y}},[Se,Oe,Le,re,Be]),He=p.useCallback(async()=>{if(!o){De.warn("createAnswer: socketService prop is not available.");return}if(!a.peerConnection.current){De.error("Cannot create answer: Peer connection does not exist.");return}const Y=a.peerConnection.current;if(Y.signalingState!=="have-remote-offer"){De.warn(`Cannot create answer in signaling state: ${Y.signalingState}. Aborting.`);return}try{a.negotiationInProgress.current=!0;const _=await Y.createAnswer();if(Y.signalingState!=="have-remote-offer"){De.warn("Signaling state changed during answer creation. Aborting."),a.negotiationInProgress.current=!1;return}await Y.setLocalDescription(_);const m={type:"answer",sdp:Y.localDescription},y=cn.getSignalId(m);a.processedSignals.current.add(y),o.emit("videoSignal",{recipientId:l,signal:m,from:{userId:h,callId:c}}),re(),i&&(a.callAnswered.current=!0)}catch(_){De.error("Error creating or setting answer:",_),P(`Signaling Error: ${_.message}`),a.negotiationInProgress.current=!1,tt(_e)}},[l,h,c,re,_e,i,o]),ut=p.useCallback(Y=>{if(!Y||!Y.signal||!Y.signal.type||!Y.userId){De.warn("Received invalid signal data structure.");return}if(Y.userId!==l)return;const _=Y.signal,m=_.type;if(!a.peerConnection.current){De.warn(`Peer connection not ready. Queuing '${m}' signal.`),a.incomingSignalQueue.current.push(Y);return}const y=a.peerConnection.current,B=y.signalingState,J=cn.getSignalId(_);if(!a.processedSignals.current.has(J))try{switch(m){case"request-offer":B==="stable"&&!a.negotiationInProgress.current&&_e().catch(We=>De.error("Error creating offer:",We));break;case"offer":a.processedSignals.current.add(J),i||(H(!1),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null)),a.negotiationInProgress.current&&B==="have-local-offer"?(De.warn("Offer collision detected (both peers sending offers)."),h>l?(De.debug("This peer is polite. Rolling back local offer and accepting remote offer."),a.negotiationInProgress.current=!1,y.setLocalDescription({type:"rollback"}).then(()=>y.setRemoteDescription(new RTCSessionDescription(_.sdp))).then(()=>(re(),He())).catch(ct=>{De.error("Error handling polite offer collision:",ct)})):De.debug("This peer is impolite. Ignoring remote offer, expecting peer to accept ours.")):B==="stable"||B==="have-remote-offer"?y.setRemoteDescription(new RTCSessionDescription(_.sdp)).then(()=>{if(re(),y.signalingState==="have-remote-offer")return He()}).catch(We=>{De.error("Error setting remote description:",We),P(`Signaling Error: ${We.message}`)}):(De.error(`Cannot handle offer in unexpected state: ${B}.`),tt(_e));break;case"answer":i||(a.callAnswered.current=!0,H(!1),a.unansweredCallTimeout.current&&(clearTimeout(a.unansweredCallTimeout.current),a.unansweredCallTimeout.current=null)),B==="have-local-offer"&&(a.processedSignals.current.add(J),y.setRemoteDescription(new RTCSessionDescription(_.sdp)).then(()=>{De.debug("Remote answer set successfully. Connection should establish soon."),a.negotiationInProgress.current=!1,re()}).catch(We=>{De.error("Error setting remote answer description:",We),P(`Signaling Error: ${We.message}`)}));break;case"ice-candidate":if(!_.candidate)return;const pe=new RTCIceCandidate(_.candidate),$e=cn.getCandidateFingerprint(pe);if(a.processedCandidates.current.has($e))return;y.remoteDescription?y.addIceCandidate(pe).then(()=>{a.processedCandidates.current.add($e)}).catch(We=>{De.error("Error adding remote ICE candidate:",We),y.signalingState!=="closed"&&a.iceCandidateQueue.current.push(pe)}):(De.debug("Queuing remote ICE candidate (no remote description yet)."),a.iceCandidateQueue.current.push(pe));break}}catch(ce){De.error(`Error processing signal type ${m}:`,ce),P(`Signaling Error: ${ce.message}`),a.negotiationInProgress.current=!1,tt(_e)}},[l,h,c,_e,He,re,i]),tt=p.useCallback(Y=>{if(!a.peerConnection.current||!a.isMounted.current)return;const _=a.peerConnection.current;De.warn("Attempting connection recovery (ICE Restart)."),G(cn.getConnectionQuality(_)),a.qualityCanvas.current&&os.drawConnectionQuality(a.qualityCanvas.current,"poor"),typeof _.restartIce=="function"&&(_.iceConnectionState==="disconnected"||_.iceConnectionState==="failed")?(De.debug("Performing ICE restart."),a.negotiationInProgress.current=!1,_.restartIce(),!i&&_.signalingState==="stable"&&(De.debug("Initiator attempting offer creation after ICE restart."),setTimeout(()=>{var m;a.isMounted.current&&((m=a.peerConnection.current)==null?void 0:m.signalingState)==="stable"&&Y({iceRestart:!0}).catch(y=>De.error("Error creating recovery offer:",y))},500))):(De.warn(`ICE restart not applicable or supported. State: ${_.iceConnectionState}. Attempting full reconnect.`),we(Me,ke))},[i,Me,ke]),we=p.useCallback((Y,_)=>{if(!a.isMounted.current)return;if(x>=fs.retry.maxCount){De.error("Max reconnection attempts reached. Giving up."),P("Failed to establish connection after multiple attempts. Please check network or try again later."),f(!1);return}if(a.reconnectTimeout.current){De.debug("Reconnect attempt already scheduled.");return}f(!0),g(!1),k(y=>y+1);const m=x+1;De.warn(`Attempting full reconnect (${m}/${fs.retry.maxCount}) in ${fs.timeouts.reconnect}ms...`),P(`Connection lost. Attempting to reconnect (${m}/${fs.retry.maxCount})...`),a.reconnectTimeout.current=setTimeout(async()=>{if(a.reconnectTimeout.current=null,!!a.isMounted.current)try{if(await Y(),!a.isMounted.current)return;await _()}catch(y){De.error(`Error during reconnection attempt ${m}:`,y),P(`Reconnection failed: ${y.message}`),f(!1),m<fs.retry.maxCount?we(Y,_):(De.error("Final reconnection attempt failed."),P("Failed to reconnect. Please try again later."))}},fs.timeouts.reconnect)},[x,Me]),ee=p.useCallback(async()=>{if(!(!a.peerConnection.current||!v))try{const Y=await a.peerConnection.current.getStats();let _=null,m=null;if(Y.forEach(y=>{y.type==="inbound-rtp"&&y.kind==="video"&&(_=y),y.type==="candidate-pair"&&y.state==="succeeded"&&(m=y)}),_){const y=_.frameWidth||0,B=_.frameHeight||0,J=Math.round(_.framesPerSecond||0);K({resolution:y&&B?`${y}x${B}`:"",frameRate:J,bitrate:Math.round((_.bytesReceived||0)/1024/8)})}if(m&&_){const y=m.currentRoundTripTime||0,B=_.packetsLost||0,J=_.packetsReceived||1,ce=B/(B+J),pe=_.jitter||0;let $e="unknown";y<.1&&ce<.01&&pe<.01?$e="excellent":y<.3&&ce<.05&&pe<.03?$e="good":y<.5&&ce<.1&&pe<.05?$e="fair":$e="poor",G($e),a.qualityCanvas.current&&os.drawConnectionQuality(a.qualityCanvas.current,$e)}}catch(Y){De.warn("Error getting WebRTC stats:",Y)}},[v]),de=p.useCallback(()=>{De.info("Closing VideoCall connection and cleaning up resources.");const Y=["signallingTimeout","connectionTimeout","reconnectTimeout","candidateFlushTimeout","unansweredCallTimeout"],_=["statsInterval","audioMeterInterval"];Y.forEach(m=>{a[m].current&&(clearTimeout(a[m].current),a[m].current=null)}),_.forEach(m=>{a[m].current&&(clearInterval(a[m].current),a[m].current=null)}),a.localStream.current&&(a.localStream.current.getTracks().forEach(m=>{m.stop()}),a.localStream.current=null),a.audioAnalyser.current=null,a.audioData.current=null,a.remoteAudioAnalyser.current=null,a.remoteAudioData.current=null,a.localVideo.current&&(a.localVideo.current.srcObject=null),a.remoteVideo.current&&(a.remoteVideo.current.srcObject=null),a.peerConnection.current&&(a.peerConnection.current.close(),a.peerConnection.current=null),a.iceCandidateQueue.current=[],a.incomingSignalQueue.current=[],a.processedCandidates.current.clear(),a.processedSignals.current.clear(),a.negotiationInProgress.current=!1,a.connectionCompleted.current=!1,a.callAnswered.current=!1},[]),ye=p.useCallback(()=>{if(!o){De.warn("toggleMute: socketService prop is not available.");return}if(!a.localStream.current)return;const Y=a.localStream.current.getAudioTracks();if(Y.length>0){const _=!b;Y[0].enabled=!_,$(_),a.localAudioCanvas.current&&os.drawAudioLevel(a.localAudioCanvas.current,_?0:V),o.emit("videoMediaControl",{recipientId:l,type:"audio",muted:_})}},[b,l,V,o]),oe=p.useCallback(()=>{if(!o){De.warn("toggleVideo: socketService prop is not available.");return}if(!a.localStream.current)return;const Y=a.localStream.current.getVideoTracks();if(Y.length>0){const _=!T;Y[0].enabled=!_,F(_),a.localPlaceholder.current&&_&&os.drawPlaceholderVideo(a.localPlaceholder.current,"Camera Off"),o.emit("videoMediaControl",{recipientId:l,type:"video",muted:_})}},[T,l,o]),fe=p.useCallback(()=>{if(!o){De.warn("handleEndCall: socketService prop is not available."),n&&n();return}o.emit("videoHangup",{recipientId:l}),n&&n()},[l,n,o]),ie=p.useCallback(()=>{const Y=document.querySelector(`.${dt.videoContainer}`);Y&&(document.fullscreenElement?document.exitFullscreen().then(()=>w(!1)):Y.requestFullscreen().then(()=>w(!0)).catch(_=>Z.error(`Could not enter fullscreen: ${_.message}`)))},[]);p.useEffect(()=>(a.isMounted.current=!0,()=>{a.isMounted.current=!1,de()}),[de]),p.useEffect(()=>{if(e&&a.isMounted.current){a.connectionCompleted.current=!1,a.callAnswered.current=!1,a.connectionTimeout.current=setTimeout(()=>{a.isMounted.current&&!a.connectionCompleted.current&&(P("Connection failed to establish after 30 seconds."),f(!1),H(!1))},fs.timeouts.connection),(async()=>{try{if(P(null),f(!0),k(0),H(!1),await ne(),!a.isMounted.current||(await Me(),!a.isMounted.current)||(await ke(),!a.isMounted.current))return}catch(m){a.isMounted.current&&(f(!1),H(!1),P(`Setup failed: ${m.message}`))}})(),a.statsInterval.current=setInterval(()=>{ee()},fs.intervals.stats);const _=setInterval(()=>{j(m=>m+1)},1e3);return()=>{clearInterval(_),de(),j(0)}}else!e&&a.peerConnection.current&&(de(),g(!1),f(!1),H(!1),P(null),k(0),j(0))},[e,ne,Me,ke,de,ee]),p.useEffect(()=>{if(!e||!o||!l){De.debug("Socket listener effect skipped: component not open or props missing.");return}De.debug("Setting up socket listeners for VideoCall");const Y=$e=>ut($e),_=$e=>{$e.userId===l&&(De.info("Received hangup signal from peer."),Z.info("The other user has ended the call."),n&&n())},m=$e=>{$e.userId===l&&(De.debug(`Received media control: type=${$e.type}, muted=${$e.muted}`),$e.type==="audio"&&(E($e.muted),a.remoteAudioCanvas.current&&os.drawAudioLevel(a.remoteAudioCanvas.current,$e.muted?0:X)),$e.type==="video"&&(A($e.muted),$e.muted&&a.remotePlaceholder.current&&os.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off")))},y=$e=>{De.error(`Received remote error signal: ${$e==null?void 0:$e.error}`),P(`Remote Error: ${($e==null?void 0:$e.error)||"Unknown issue"}`),f(!1),H(!1)},B=o.on("videoSignal",Y),J=o.on("videoHangup",_),ce=o.on("videoMediaControl",m),pe=o.on("videoError",y);return()=>{De.debug("Cleaning up socket listeners for VideoCall"),typeof B=="function"&&B(),typeof J=="function"&&J(),typeof ce=="function"&&ce(),typeof pe=="function"&&pe()}},[e,l,n,ut,X,o]),p.useEffect(()=>{let Y=null;const _=()=>{S(!0),Y&&clearTimeout(Y),Y=setTimeout(()=>{a.isMounted.current&&S(!1)},3e3)},m=document.querySelector(`.${dt.videoContainer}`);return m&&(m.addEventListener("mousemove",_),_()),()=>{Y&&clearTimeout(Y),m==null||m.removeEventListener("mousemove",_)}},[]),p.useEffect(()=>{a.qualityCanvas.current&&os.drawConnectionQuality(a.qualityCanvas.current,C),a.localAudioCanvas.current&&os.drawAudioLevel(a.localAudioCanvas.current,b?0:V),a.remoteAudioCanvas.current&&os.drawAudioLevel(a.remoteAudioCanvas.current,M?0:X),T&&a.localPlaceholder.current&&os.drawPlaceholderVideo(a.localPlaceholder.current,"Camera Off"),U&&a.remotePlaceholder.current&&os.drawPlaceholderVideo(a.remotePlaceholder.current,"Remote Camera Off")},[C,V,X,b,M,T,U]);const te=()=>r.jsxs("div",{className:`${dt.callControls} ${I?dt.visible:dt.hidden}`,children:[r.jsx("button",{className:`${dt.controlButton} ${b?dt.active:""}`,onClick:ye,"aria-label":b?"Unmute Microphone":"Mute Microphone","aria-pressed":b,children:b?r.jsx(nl,{}):r.jsx(Gm,{})}),r.jsx("button",{className:`${dt.controlButton} ${T?dt.active:""}`,onClick:oe,"aria-label":T?"Turn Camera On":"Turn Camera Off","aria-pressed":T,children:T?r.jsx(u1,{}):r.jsx(Xn,{})}),r.jsx("button",{className:`${dt.controlButton} ${dt.endCall}`,onClick:fe,"aria-label":"End Call",children:r.jsx(Ta,{})}),r.jsx("button",{className:`${dt.controlButton} ${D?dt.active:""}`,onClick:ie,"aria-label":D?"Exit Fullscreen":"Enter Fullscreen","aria-pressed":D,children:D?r.jsx(Lm,{}):r.jsx(Fm,{})}),r.jsxs("button",{className:dt.controlButton,"aria-label":"Show connection quality",children:[r.jsx(t1,{}),r.jsx("span",{className:`${dt.qualityDot} ${dt[C]}`})]})]});return r.jsx("div",{className:dt.videoCall,children:r.jsxs("div",{className:dt.videoContainer,children:[r.jsxs("div",{className:dt.remoteVideoWrapper,children:[r.jsx("video",{ref:a.remoteVideo,className:dt.remoteVideo,autoPlay:!0,playsInline:!0}),U&&r.jsx("canvas",{ref:a.remotePlaceholder,className:`${dt.videoPlaceholder} ${dt.remoteVideoPlaceholder}`,width:"640",height:"480"}),r.jsxs("div",{className:dt.connectionQualityIndicator,children:[r.jsx("canvas",{ref:a.qualityCanvas,width:"100",height:"30",className:`${dt.qualityCanvas} ${dt[C]}`}),r.jsx("span",{className:`${dt.qualityText} ${dt[C]}`,children:C})]}),r.jsx("div",{className:dt.remoteAudioIndicator,children:r.jsx("canvas",{ref:a.remoteAudioCanvas,width:"15",height:"80",className:dt.audioLevelCanvas})}),M&&!d&&!N&&r.jsx("div",{className:dt.audioOffIndicator,children:r.jsx(nl,{"aria-label":"Remote peer muted"})}),W&&!N&&r.jsxs("div",{className:dt.waitingIndicator,children:[r.jsx(Ws,{className:dt.spin,"aria-hidden":"true"}),r.jsxs("span",{children:["Calling ",u,"..."]}),r.jsx("span",{className:dt.waitingSubtext,children:"Waiting for answer"})]}),d&&!v&&!W&&r.jsxs("div",{className:dt.connectingIndicator,children:[r.jsx(Ws,{className:dt.spin,"aria-hidden":"true"}),r.jsx("span",{children:"Connecting..."}),x>0&&r.jsxs("span",{className:dt.retryCount,children:["Attempt ",x,"/",fs.retry.maxCount]})]}),N&&!d&&r.jsx("div",{className:dt.errorIndicator,children:r.jsxs("div",{className:dt.errorMessage,children:[r.jsx(Bt,{className:dt.errorIcon}),r.jsx("span",{children:cn.formatErrorMessage(N)}),x<fs.retry.maxCount&&!v&&r.jsxs("button",{className:dt.retryButton,onClick:()=>we(Me,ke),"aria-label":"Retry connection",children:[r.jsx(a1,{})," Retry"]}),r.jsxs("button",{className:dt.errorEndCallButton,onClick:fe,"aria-label":"End Call",children:[r.jsx(Ta,{})," End Call"]})]})})]}),r.jsxs("div",{className:dt.localVideoWrapper,children:[r.jsx("video",{ref:a.localVideo,className:dt.localVideo,autoPlay:!0,playsInline:!0,muted:!0}),T&&r.jsx("canvas",{ref:a.localPlaceholder,className:`${dt.videoPlaceholder} ${dt.localVideoPlaceholder}`,width:"160",height:"120"}),r.jsx("div",{className:dt.localAudioIndicator,children:r.jsx("canvas",{ref:a.localAudioCanvas,width:"10",height:"60",className:dt.audioLevelCanvas})})]}),r.jsxs("div",{className:dt.callInfo,children:[r.jsx("span",{className:dt.callDuration,"aria-label":`Call duration: ${jl(R)}`,children:jl(R)}),v&&z.resolution&&r.jsxs("span",{className:dt.videoStats,children:[z.resolution," • ",z.frameRate," fps"]})]}),te()]})})};Ci.propTypes={isOpen:O.bool.isRequired,user:O.shape({_id:O.string.isRequired}),recipient:O.shape({_id:O.string.isRequired,nickname:O.string}),onEndCall:O.func.isRequired,socketService:O.object.isRequired,isIncoming:O.bool,callId:O.string};Ci.defaultProps={isIncoming:!1,callId:null,user:null,recipient:null};const w2="_storiesCarouselContainer_1vzgs_14",b2="_storiesCarousel_1vzgs_14",x2="_carouselNavButton_1vzgs_42",S2="_carouselNavButtonLeft_1vzgs_67",C2="_carouselNavButtonRight_1vzgs_71",k2="_storyThumbnail_1vzgs_76",N2="_avatarBorder_1vzgs_92",E2="_avatarBorderViewed_1vzgs_104",T2="_imageContainer_1vzgs_112",A2="_thumbnailImage_1vzgs_127",j2="_username_1vzgs_146",I2="_comingSoonBadge_1vzgs_163",$2="_mediaTypeIcon_1vzgs_178",P2="_storiesViewerOverlay_1vzgs_200",R2="_storiesViewerContainer_1vzgs_214",M2="_storiesViewerHeader_1vzgs_225",L2="_storiesProgressContainer_1vzgs_237",O2="_storiesProgressBar_1vzgs_244",F2="_storiesProgressFill_1vzgs_252",D2="_storiesUserInfo_1vzgs_265",B2="_storiesUserAvatar_1vzgs_271",U2="_storiesUserDetails_1vzgs_280",q2="_storiesUsername_1vzgs_284",z2="_storiesTimestamp_1vzgs_291",H2="_storiesCloseBtn_1vzgs_297",V2="_storiesViewerContent_1vzgs_314",W2="_storiesImageContainer_1vzgs_327",G2="_storiesVideoContainer_1vzgs_328",Y2="_storiesTextContent_1vzgs_329",K2="_storiesMedia_1vzgs_339",J2="_storyCaption_1vzgs_359",Q2="_storiesViewerNavigation_1vzgs_372",X2="_storiesNavLeft_1vzgs_382",Z2="_storiesNavRight_1vzgs_383",e4="_storiesActions_1vzgs_390",t4="_storyActionButton_1vzgs_400",s4="_active_1vzgs_416",n4="_videoControl_1vzgs_423",r4="_pauseIndicator_1vzgs_440",o4="_doubleTapHeart_1vzgs_457",i4="_spinner_1vzgs_476",a4="_errorMessage_1vzgs_493",c4="_storyCreatorModal_1vzgs_532",l4="_storyPreviewFrame_1vzgs_539",d4="_storyCreatorContainer_1vzgs_881",u4="_storyCreatorOverlay_1vzgs_893",h4="_storyCreatorHeader_1vzgs_922",f4="_storyCreatorTitle_1vzgs_936",g4="_storyCreatorCloseButton_1vzgs_943",p4="_storyCreatorContent_1vzgs_963",m4="_storyCreatorPreview_1vzgs_970",y4="_storyTextContent_1vzgs_996",v4="_storyPlaceholder_1vzgs_1007",_4="_storyCreatorTabs_1vzgs_1013",w4="_storyCreatorTab_1vzgs_1013",b4="_storyCreatorTabContent_1vzgs_1064",x4="_storyCreatorInput_1vzgs_1073",S4="_storyCreatorCharCount_1vzgs_1100",C4="_storyCreatorFooter_1vzgs_1111",k4="_storyCreatorButton_1vzgs_1125",N4="_storyCreatorPrimaryButton_1vzgs_1138",E4="_storyCreatorOutlineButton_1vzgs_1156",T4="_uploadProgressContainer_1vzgs_1178",A4="_storyCreatorProgressContainer_1vzgs_1185",j4="_storyCreatorProgressFill_1vzgs_1197",I4="_storyCreatorBackgroundOptions_1vzgs_1220",$4="_storyCreatorBackgroundOption_1vzgs_1220",P4="_selected_1vzgs_1239",xe={storiesCarouselContainer:w2,storiesCarousel:b2,carouselNavButton:x2,carouselNavButtonLeft:S2,carouselNavButtonRight:C2,storyThumbnail:k2,avatarBorder:N2,avatarBorderViewed:E2,imageContainer:T2,thumbnailImage:A2,username:j2,comingSoonBadge:I2,mediaTypeIcon:$2,storiesViewerOverlay:P2,storiesViewerContainer:R2,storiesViewerHeader:M2,storiesProgressContainer:L2,storiesProgressBar:O2,storiesProgressFill:F2,storiesUserInfo:D2,storiesUserAvatar:B2,storiesUserDetails:U2,storiesUsername:q2,storiesTimestamp:z2,storiesCloseBtn:H2,storiesViewerContent:V2,storiesImageContainer:W2,storiesVideoContainer:G2,storiesTextContent:Y2,storiesMedia:K2,storyCaption:J2,storiesViewerNavigation:Q2,storiesNavLeft:X2,storiesNavRight:Z2,storiesActions:e4,storyActionButton:t4,active:s4,videoControl:n4,pauseIndicator:r4,doubleTapHeart:o4,spinner:i4,errorMessage:a4,storyCreatorModal:c4,storyPreviewFrame:l4,storyCreatorContainer:d4,storyCreatorOverlay:u4,storyCreatorHeader:h4,storyCreatorTitle:f4,storyCreatorCloseButton:g4,storyCreatorContent:p4,storyCreatorPreview:m4,storyTextContent:y4,storyPlaceholder:v4,storyCreatorTabs:_4,storyCreatorTab:w4,storyCreatorTabContent:b4,storyCreatorInput:x4,storyCreatorCharCount:S4,storyCreatorFooter:C4,storyCreatorButton:k4,storyCreatorPrimaryButton:N4,storyCreatorOutlineButton:E4,uploadProgressContainer:T4,storyCreatorProgressContainer:A4,storyCreatorProgressFill:j4,storyCreatorBackgroundOptions:I4,storyCreatorBackgroundOption:$4,selected:P4},zn=Ze.create("StoriesViewer"),Yu=({storyId:e,userId:t,onClose:s})=>{const{stories:n=[],viewStory:o,loadUserStories:i,loadStories:c,reactToStory:l}=co()||{},{user:u}=Bn()||{},{user:h,isAuthenticated:a}=Xt()||{},d=h||u,[f,v]=p.useState(0),[g,b]=p.useState(0),[$,T]=p.useState(!1),[F,M]=p.useState(!1),[E,U]=p.useState(null),[A,D]=p.useState([]),[w,N]=p.useState(!0),[P,x]=p.useState(!1),[k,R]=p.useState(!1),[j,I]=p.useState(!1),[S,C]=p.useState(!1),[G,V]=p.useState({x:0,y:0}),[L,X]=p.useState(!1),q=p.useRef(null),K=100/(5e3/100),W=p.useRef(null),H=p.useRef(null),ne=p.useRef(null),Q=p.useRef({x:0,y:0,time:0}),he=p.useRef(0),re=t?A:n;p.useEffect(()=>{(!n||!n.length)&&c&&c(!0).catch(ie=>zn.error("Error loading stories:",ie))},[n,c]),p.useEffect(()=>{(async()=>{if(!(!t||!i)){M(!0);try{const te=await i(t),Y=[],_=new Set;(Array.isArray(te)?te:n.filter(y=>{var J;return(typeof y.user=="string"?y.user:(J=y.user)==null?void 0:J._id)===t})).forEach(y=>{y._id&&!_.has(y._id)&&(_.add(y._id),Y.push(y))}),Y.length||U("No stories available for this user"),D(Y)}catch(te){zn.error("Error loading user stories:",te),U("Failed to load stories")}finally{M(!1)}}})()},[t,i,n]),p.useEffect(()=>{if(re.length>0&&f>=0&&f<re.length){const ie=re[f];if(ie&&ie.reactions&&Array.isArray(ie.reactions)&&d){const te=ie.reactions.some(Y=>Y.user===d._id||Y.user&&Y.user._id===d._id);x(te)}else x(!1)}},[f,re,d]),p.useEffect(()=>{if(e&&(t?A:n).length){const te=(t?A:n).findIndex(Y=>Y._id===e);te!==-1&&v(te)}},[e,t,A,n]),p.useEffect(()=>{if(!o||!re.length)return;const ie=re[f];ie&&d&&ie._id&&o(ie._id).catch(te=>{zn.error("Error marking story as viewed:",te)})},[f,re,d,o]),p.useEffect(()=>{if(W.current)if($)W.current.pause();else{const ie=W.current.play();ie!==void 0&&ie.catch(te=>{zn.error("Error playing video:",te),te.name==="NotAllowedError"&&!w&&(N(!0),W.current.muted=!0,W.current.play().catch(Y=>zn.error("Still couldn't play even with mute:",Y)))})}},[$,f,w]),p.useEffect(()=>{if($||F||E||!re.length){q.current&&(clearInterval(q.current),q.current=null);return}b(0),q.current&&(clearInterval(q.current),q.current=null);const ie=re[f];if(!(ie&&(ie.mediaType==="video"||ie.type==="video")&&W.current))return q.current=setInterval(()=>{b(te=>te>=100?(clearInterval(q.current),q.current=null,f<re.length-1?v(Y=>Y+1):s==null||s(),0):te+K)},100),()=>{q.current&&(clearInterval(q.current),q.current=null)}},[f,re,$,s,F,E,K]);const _e=p.useCallback(()=>{if(W.current){const ie=W.current.duration,te=W.current.currentTime;if(ie>0){const Y=te/ie*100;b(Y),Y>=99.5&&(f<re.length-1?v(_=>_+1):s==null||s())}}},[f,re.length,s]),ke=p.useCallback(ie=>{if(ie&&(ie.stopPropagation(),ie.preventDefault()),j){I(!1);return}k||f>0&&(R(!0),v(te=>te-1),b(0),setTimeout(()=>R(!1),300))},[f,k,j]),Be=p.useCallback(ie=>{if(ie&&(ie.stopPropagation(),ie.preventDefault()),j){I(!1);return}k||(R(!0),f<re.length-1?(v(te=>te+1),b(0)):s==null||s(),setTimeout(()=>R(!1),300))},[f,re,s,k,j]),Oe=p.useCallback(ie=>{ie&&(ie.stopPropagation(),ie.preventDefault()),I(!0),N(te=>{const Y=!te;return W.current&&(W.current.muted=Y),Y}),setTimeout(()=>I(!1),300)},[]),Se=p.useCallback(ie=>{if(ie&&(ie.stopPropagation(),ie.preventDefault()),I(!0),P){setTimeout(()=>I(!1),300);return}if(!a||!d){Z.error("You must be logged in to react to stories"),setTimeout(()=>I(!1),300);return}if(!re||f>=re.length){setTimeout(()=>I(!1),300);return}const te=re[f];if(!te||!te._id){setTimeout(()=>I(!1),300);return}const Y=te._id;Y&&l?(x(!0),l(Y,"like").then(_=>{if(!_||!_.success)throw new Error((_==null?void 0:_.message)||"Failed to react to story");if(_.data&&Array.isArray(_.data)){const m=[...re];m[f]&&(m[f].reactions=_.data,t&&D(m))}}).catch(_=>{zn.error("Error reacting to story:",_),x(!1),Z.error("Failed to react to story")}).finally(()=>{setTimeout(()=>I(!1),300)})):setTimeout(()=>I(!1),300)},[d,a,re,f,l,P,t]),Le=p.useCallback(ie=>{ie&&H.current&&H.current.contains(ie.target)||(ie&&(ie.stopPropagation(),ie.preventDefault()),T(te=>!te))},[]),Me=p.useCallback(ie=>{Q.current={x:ie.touches[0].clientX,y:ie.touches[0].clientY,time:Date.now()},ne.current=setTimeout(()=>{C(!0),T(!0)},500)},[]),He=p.useCallback(ie=>{const te=ie.touches[0].clientX,Y=ie.touches[0].clientY,_=Q.current.x,m=Q.current.y,y=Math.abs(te-_),B=Math.abs(Y-m);(y>10||B>10)&&ne.current&&(clearTimeout(ne.current),ne.current=null)},[]),ut=p.useCallback(ie=>{if(ne.current&&(clearTimeout(ne.current),ne.current=null),S){C(!1),T(!1);return}const te=ie.changedTouches[0].clientX,Y=ie.changedTouches[0].clientY,_=Q.current.x,m=Q.current.y,y=_-te,B=m-Y,J=Date.now()-Q.current.time,ce=Date.now(),pe=ce-he.current;pe<300&&pe>0&&Math.abs(y)<10&&Math.abs(B)<10?(P||(V({x:te,y:Y}),X(!0),setTimeout(()=>{X(!1)},1e3),Se(ie)),he.current=0):(J<300&&(Math.abs(y)>Math.abs(B)&&Math.abs(y)>30?y>0?Be(ie):ke(ie):Math.abs(B)>Math.abs(y)&&Math.abs(B)>50?B>0||s==null||s():Le(ie)),he.current=ce)},[Be,ke,Se,s,Le,S,P]);p.useEffect(()=>{const ie=te=>{k||(te.key==="ArrowLeft"?ke():te.key==="ArrowRight"||te.key===" "||te.key==="Spacebar"?Be():te.key==="Escape"&&(s==null||s()))};return document.addEventListener("keydown",ie),()=>document.removeEventListener("keydown",ie)},[ke,Be,s,k]),p.useEffect(()=>()=>{ne.current&&clearTimeout(ne.current),q.current&&clearInterval(q.current)},[]);const tt=p.useCallback(()=>s==null?void 0:s(),[s]),we=p.useMemo(()=>re&&re.length>0&&f<re.length?re[f]:null,[re,f]),ee=p.useCallback(()=>{if(!re||!re.length||f>=re.length)return"Unknown User";const ie=re[f];if(!ie)return"Unknown User";const te=ie.user||ie.userData||{};return!te||typeof te=="string"?"Unknown User":te.nickname||te.username||te.name||"User"},[re,f]);p.useCallback(()=>{if(!re||!re.length||f>=re.length)return"/api/avatars/default";const ie=re[f];if(!ie)return"/api/avatars/default";const te=ie.user||ie.userData||{};return!te||typeof te=="string"?"/api/avatars/default":te.profilePicture||te.avatar||`/api/avatars/${te._id||"default"}`},[re,f]);const de=p.useCallback(()=>{if(!re||!re.length||f>=re.length)return"Recently";const ie=re[f];if(!ie||!ie.createdAt)return"Recently";try{return new Date(ie.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return"Recently"}},[re,f]),ye=p.useCallback(()=>{var te,Y;if(!re||!re.length||f>=re.length)return r.jsx("div",{className:xe.storiesTextContent,children:r.jsx("p",{children:"No story available"})});const ie=re[f];if(!ie)return r.jsx("div",{className:xe.storiesTextContent,children:r.jsx("p",{children:"Story not found"})});if(ie.mediaType==="text"||ie.type==="text"){const _={};return ie.backgroundStyle?_.background=ie.backgroundStyle:ie.backgroundColor&&(_.background=ie.backgroundColor),ie.fontStyle&&(_.fontFamily=ie.fontStyle),r.jsxs("div",{className:xe.storiesTextContent,style:_,children:[r.jsx("div",{className:xe.storyUserOverlay,children:r.jsx("span",{className:xe.storyNickname,children:ee()})}),ie.text||ie.content||"",$&&r.jsx("div",{className:xe.pauseIndicator,children:r.jsx(Br,{size:24})})]})}if(((te=ie.mediaType)!=null&&te.startsWith("image")||ie.type==="image")&&(ie.mediaUrl||ie.media)){const _=ie.mediaUrl||ie.media;return r.jsxs("div",{className:xe.storiesImageContainer,children:[r.jsx("div",{className:xe.storyUserOverlay,children:r.jsx("span",{className:xe.storyNickname,children:ee()})}),r.jsx("img",{src:_||"/placeholder.svg",alt:"Story",className:xe.storiesMedia,crossOrigin:"anonymous",loading:"lazy",decoding:"async",onError:m=>{m.target.onerror=null,m.target.src="/placeholder.svg"}}),$&&r.jsx("div",{className:xe.pauseIndicator,children:r.jsx(Br,{size:24})}),ie.content&&ie.content.trim()&&r.jsx("div",{className:xe.storyCaption,children:ie.content})]})}if(((Y=ie.mediaType)!=null&&Y.startsWith("video")||ie.type==="video")&&(ie.mediaUrl||ie.media)){const _=ie.mediaUrl||ie.media;return r.jsxs("div",{className:xe.storiesVideoContainer,children:[r.jsx("div",{className:xe.storyUserOverlay,children:r.jsx("span",{className:xe.storyNickname,children:ee()})}),r.jsx("video",{ref:W,src:_,className:xe.storiesMedia,autoPlay:!0,muted:w,loop:!1,playsInline:!0,crossOrigin:"anonymous",onTimeUpdate:_e,onError:m=>{zn.error("Video failed to load:",m)}}),$&&r.jsx("div",{className:xe.pauseIndicator,children:r.jsx(Br,{size:24})}),r.jsx("button",{className:xe.videoControl,onClick:Oe,"aria-label":w?"Unmute video":"Mute video",children:w?r.jsx(h1,{size:16}):r.jsx(f1,{size:16})}),ie.content&&ie.content.trim()&&r.jsx("div",{className:xe.storyCaption,children:ie.content})]})}return r.jsxs("div",{className:xe.storiesTextContent,children:[r.jsx("div",{className:xe.storyUserOverlay,children:r.jsx("span",{className:xe.storyNickname,children:ee()})}),r.jsx("p",{children:ie.text||ie.content||"No content available"}),$&&r.jsx("div",{className:xe.pauseIndicator,children:r.jsx(Br,{size:24})})]})},[re,f,$,w,ee,_e,Oe]),oe=p.useMemo(()=>F?"loading":E?"error":!re.length||f>=re.length?"empty":we?"normal":"notAvailable",[F,E,re,f,we]),fe=p.useMemo(()=>L?r.jsx("div",{className:xe.doubleTapHeart,style:{position:"absolute",left:`${G.x-40}px`,top:`${G.y-40}px`,width:"80px",height:"80px",color:"#FD1D1D",fontSize:"80px",zIndex:9999,pointerEvents:"none"},children:r.jsx(On,{})}):null,[L,G]);return oe==="loading"?r.jsx("div",{className:xe.storiesViewerOverlay,children:r.jsxs("div",{className:xe.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[r.jsx("div",{className:xe.spinner}),r.jsx("p",{style:{color:"white",marginTop:"15px"},children:"Loading stories..."})]})}):oe==="error"?r.jsx("div",{className:xe.storiesViewerOverlay,children:r.jsxs("div",{className:xe.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[r.jsx("p",{style:{color:"white"},children:E}),r.jsx("button",{onClick:tt,style:{marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Close"})]})}):oe==="empty"?r.jsx("div",{className:xe.storiesViewerOverlay,children:r.jsxs("div",{className:xe.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[r.jsx("p",{style:{color:"white"},children:"No stories available"}),r.jsx("button",{onClick:tt,style:{marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Close"})]})}):oe==="notAvailable"?r.jsx("div",{className:xe.storiesViewerOverlay,children:r.jsxs("div",{className:xe.storiesViewerContainer,style:{justifyContent:"center",alignItems:"center"},children:[r.jsx("p",{style:{color:"white"},children:"Story not available"}),r.jsx("button",{onClick:tt,style:{marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Close"})]})}):r.jsx("div",{className:xe.storiesViewerOverlay,children:r.jsxs("div",{className:xe.storiesViewerContainer,children:[r.jsxs("div",{className:xe.storiesViewerHeader,children:[r.jsx("div",{className:xe.storiesProgressContainer,children:re.map((ie,te)=>r.jsxs("div",{className:`${xe.storiesProgressBar} ${te<f?"completed":""}`,"aria-label":`Story ${te+1} of ${re.length}`,role:"progressbar","aria-valuenow":te===f?g:te<f?100:0,"aria-valuemin":"0","aria-valuemax":"100",children:[te===f&&r.jsx("div",{className:xe.storiesProgressFill,style:{width:`${g}%`}}),te<f&&r.jsx("div",{className:xe.storiesProgressFill,style:{width:"100%"}})]},te))}),r.jsxs("div",{className:xe.storiesUserInfo,children:[r.jsx(lo,{user:(()=>{var ie;return console.debug("StoriesViewer user data:",{currentStoryUser:we==null?void 0:we.user,userDataExists:!!(we!=null&&we.userData),userType:typeof(we==null?void 0:we.user),nickname:ee()}),we!=null&&we.userData&&typeof we.userData=="object"?!we.userData._id&&(typeof we.user=="string"||typeof we.user=="object"&&((ie=we.user)!=null&&ie._id))?{...we.userData,_id:typeof we.user=="string"?we.user:we.user._id}:we.userData:typeof(we==null?void 0:we.user)=="object"&&we.user?we.user:{_id:typeof(we==null?void 0:we.user)=="string"?we.user:void 0,nickname:ee()}})(),alt:ee(),className:xe.storiesUserAvatar,size:"small"}),r.jsxs("div",{className:xe.storiesUserDetails,children:[r.jsx("span",{className:xe.storiesUsername,children:ee()}),r.jsx("span",{className:xe.storiesTimestamp,children:de()})]})]}),r.jsx("button",{className:xe.storiesCloseBtn,onClick:tt,"aria-label":"Close stories",children:r.jsx(Ts,{})})]}),r.jsxs("div",{className:xe.storiesViewerContent,onClick:Le,onTouchStart:Me,onTouchMove:He,onTouchEnd:ut,children:[ye(),fe]}),r.jsxs("div",{className:xe.storiesViewerNavigation,"aria-label":"Story navigation",children:[r.jsx("div",{className:xe.storiesNavLeft,onClick:ke,"aria-label":"Previous story",role:"button",tabIndex:"0"}),r.jsx("div",{className:xe.storiesNavRight,onClick:Be,"aria-label":"Next story",role:"button",tabIndex:"0"})]}),r.jsxs("div",{ref:H,className:xe.storiesActions,onClick:ie=>{ie.stopPropagation(),ie.preventDefault(),I(!0)},children:[r.jsx("button",{className:`${xe.storyActionButton} ${P?xe.active:""}`,onClick:Se,"aria-label":"Like story","aria-pressed":P,children:P?r.jsx(On,{size:20}):r.jsx(au,{size:20})}),r.jsx("button",{className:xe.storyActionButton,onClick:ie=>{ie.stopPropagation(),ie.preventDefault(),I(!0),Z.info("Comments feature coming soon!"),setTimeout(()=>I(!1),300)},"aria-label":"Comment on story",children:r.jsx(kr,{size:20})}),r.jsx("button",{className:xe.storyActionButton,onClick:ie=>{ie.stopPropagation(),ie.preventDefault(),I(!0),Z.info("Share feature coming soon!"),setTimeout(()=>I(!1),300)},"aria-label":"Share story",children:r.jsx(Zm,{size:20})}),r.jsx("button",{className:xe.storyActionButton,onClick:ie=>{ie.stopPropagation(),ie.preventDefault(),I(!0),Le(ie),setTimeout(()=>I(!1),300)},"aria-label":$?"Play story":"Pause story",children:$?r.jsx(Br,{size:20}):r.jsx(Jm,{size:20})})]})]})})},R4=({story:e,onClick:t,hasUnviewedStories:s,user:n,mediaType:o})=>{const{user:i}=Bn(),c=p.useRef(0),l=p.useMemo(()=>{var g,b,$;if((n==null?void 0:n._id)==="681f446dccf1f0d2bb3d2631"||((g=e==null?void 0:e.user)==null?void 0:g._id)==="681f446dccf1f0d2bb3d2631"||typeof(e==null?void 0:e.user)=="string"&&e.user==="681f446dccf1f0d2bb3d2631")return{_id:"681f446dccf1f0d2bb3d2631",nickname:(n==null?void 0:n.nickname)||((b=e==null?void 0:e.userData)==null?void 0:b.nickname)||"Woman User",details:{iAm:"woman"},gender:"female",photos:(n==null?void 0:n.photos)||(($=e==null?void 0:e.userData)==null?void 0:$.photos)||[]};if(n){if(!n.details&&((e==null?void 0:e._id)==="coming-soon-video"||(e==null?void 0:e._id)==="coming-soon-image")){const T=(e==null?void 0:e._id)||"";return{...n,details:{iAm:T.includes("video")?"man":"woman"},gender:T.includes("video")?"male":"female"}}return n}if(!e)return{};if(e.userData&&typeof e.userData=="object")return!e.userData._id&&typeof e.user=="string"?{...e.userData,_id:e.user}:e.userData;if(e.user&&typeof e.user=="object"){if(e.user._id)return e.user;{const T={...e.user};return e._id&&!T._id&&(T._id=e._id),T}}return typeof e.user=="string"?{_id:e.user,nickname:e.nickname||e.userName||e.username||void 0}:{}},[e,n]);l._id;const u=l.nickname||l.username||l.name||"User",h=p.useMemo(()=>typeof s<"u"?!s:!i||!i._id||!(e!=null&&e.viewers)||!Array.isArray(e.viewers)?!1:e.viewers.includes(i._id),[s,i,e]),a=p.useMemo(()=>o==="video"||o==="image",[o]),d=g=>{if(a){g.preventDefault(),g.stopPropagation();return}g.preventDefault(),g.stopPropagation(),typeof t=="function"&&t()},f=g=>{c.current=Date.now()},v=g=>{Date.now()-c.current<300&&d(g)};return!e&&!n?null:r.jsxs("div",{className:xe.storyThumbnail,onClick:d,onTouchStart:f,onTouchEnd:v,"aria-label":`${u}'s story ${h?"viewed":"not viewed"}`,role:"button",children:[r.jsx("div",{className:`${xe.avatarBorder} ${h?xe.avatarBorderViewed:""}`,children:r.jsxs("div",{className:xe.imageContainer,children:[r.jsx(lo,{user:l,alt:`${u}'s avatar`,className:xe.thumbnailImage,size:"medium",showFallback:!0}),o==="video"&&r.jsx("div",{className:xe.mediaTypeIcon,children:r.jsx(Xn,{})}),o==="image"&&r.jsx("div",{className:xe.mediaTypeIcon,children:r.jsx(gi,{})})]})}),a&&r.jsxs("div",{className:xe.comingSoonBadge,children:[r.jsx(n1,{size:8,style:{marginRight:"2px"}})," Coming Soon"]}),r.jsx("div",{className:xe.username,children:u})]})},Ku=pt.memo(R4,(e,t)=>{var s,n,o,i,c,l;return((s=e.story)==null?void 0:s._id)===((n=t.story)==null?void 0:n._id)&&e.onClick===t.onClick&&e.hasUnviewedStories===t.hasUnviewedStories&&e.mediaType===t.mediaType&&JSON.stringify(e.user)===JSON.stringify(t.user)&&JSON.stringify((o=e.story)==null?void 0:o.user)===JSON.stringify((i=t.story)==null?void 0:i.user)&&JSON.stringify((c=e.story)==null?void 0:c.userData)===JSON.stringify((l=t.story)==null?void 0:l.userData)}),M4="_modalContainer_11vrg_6",L4="_modalHeader_11vrg_19",O4="_profileContent_11vrg_43",F4="_loadingContainer_11vrg_53",D4="_errorContainer_11vrg_54",B4="_notFoundContainer_11vrg_55",U4="_errorTitle_11vrg_66",q4="_notFoundTitle_11vrg_67",z4="_errorText_11vrg_77",H4="_notFoundText_11vrg_78",V4="_requestNotification_11vrg_92",W4="_fadeIn_11vrg_1",G4="_notificationContent_11vrg_103",Y4="_notificationIcon_11vrg_109",K4="_notificationText_11vrg_115",J4="_notificationActions_11vrg_126",Q4="_approveBtn_11vrg_132",X4="_rejectBtn_11vrg_133",Z4="_spinner_11vrg_178",ex="_spin_11vrg_178",tx="_profileLayout_11vrg_185",sx="_photosSection_11vrg_195",nx="_storiesThumbnail_11vrg_202",rx="_galleryContainer_11vrg_210",ox="_gallery_11vrg_210",ix="_imageContainer_11vrg_229",ax="_galleryImage_11vrg_234",cx="_privatePhoto_11vrg_246",lx="_lockIcon_11vrg_262",dx="_permissionStatus_11vrg_279",ux="_pending_11vrg_287",hx="_rejected_11vrg_291",fx="_approved_11vrg_295",gx="_requestAccessBtn_11vrg_300",px="_onlineBadge_11vrg_329",mx="_pulse_11vrg_347",yx="_nav_11vrg_356",vx="_navPrev_11vrg_386",_x="_navNext_11vrg_389",wx="_thumbnails_11vrg_393",bx="_thumbnail_11vrg_393",xx="_thumbnailActive_11vrg_423",Sx="_thumbnailImg_11vrg_429",Cx="_privateThumbnail_11vrg_436",kx="_actions_11vrg_471",Nx="_actionBtn_11vrg_477",Ex="_likeBtn_11vrg_521",Tx="_likedBtn_11vrg_532",Ax="_messageBtn_11vrg_541",jx="_moreActions_11vrg_552",Ix="_toggleBtn_11vrg_557",$x="_dropdown_11vrg_582",Px="_slideUp_11vrg_1",Rx="_dropdownItem_11vrg_597",Mx="_detailsSection_11vrg_627",Lx="_headline_11vrg_636",Ox="_headlineTitle_11vrg_643",Fx="_premiumBadge_11vrg_652",Dx="_location_11vrg_669",Bx="_icon_11vrg_678",Ux="_onlineStatus_11vrg_685",qx="_isOnline_11vrg_696",zx="_activity_11vrg_711",Hx="_activityItem_11vrg_720",Vx="_compatibilitySection_11vrg_733",Wx="_sectionTitle_11vrg_744",Gx="_compatibilityScore_11vrg_755",Yx="_scoreCircle_11vrg_761",Kx="_scoreBg_11vrg_772",Jx="_scoreFill_11vrg_777",Qx="_scoreValue_11vrg_784",Xx="_compatibilityDetails_11vrg_794",Zx="_compatibilityFactor_11vrg_801",eS="_factorLabel_11vrg_807",tS="_factorBar_11vrg_814",sS="_factorFill_11vrg_822",nS="_section_11vrg_744",rS="_aboutText_11vrg_855",oS="_tagsContainer_11vrg_863",iS="_tag_11vrg_863",aS="_identityTag_11vrg_891",cS="_statusTag_11vrg_892",lS="_lookingForTag_11vrg_893",dS="_intoTag_11vrg_894",uS="_turnOnTag_11vrg_895",hS="_interestsTags_11vrg_897",fS="_interestTag_11vrg_903",gS="_commonTag_11vrg_925",pS="_commonIcon_11vrg_932",mS="_showMoreBtn_11vrg_937",yS="_chatOverlay_11vrg_960",vS="_dark_11vrg_976",_S="_darkToggleBtn_11vrg_1033",wS="_darkDropdown_11vrg_1046",bS="_darkDropdownItem_11vrg_1052",xS="_darkDropdownIcon_11vrg_1056",SS="_darkOnlineStatus_11vrg_1074",CS="_darkCompatibilitySection_11vrg_1088",kS="_darkScoreBg_11vrg_1095",NS="_darkScoreValue_11vrg_1098",ES="_darkFactorLabel_11vrg_1101",TS="_darkFactorBar_11vrg_1105",AS="_darkFactorFill_11vrg_1109",jS="_noPhotosText_11vrg_1118",IS="_darkTag_11vrg_1140",$S="_darkIdentityTag_11vrg_1150",PS="_darkStatusTag_11vrg_1155",RS="_darkLookingForTag_11vrg_1160",MS="_darkIntoTag_11vrg_1165",LS="_darkTurnOnTag_11vrg_1170",OS="_darkInterestTag_11vrg_1175",FS="_darkCommonTag_11vrg_1180",DS="_darkCommonIcon_11vrg_1186",BS="_darkShowMoreBtn_11vrg_1189",ue={modalContainer:M4,modalHeader:L4,profileContent:O4,loadingContainer:F4,errorContainer:D4,notFoundContainer:B4,errorTitle:U4,notFoundTitle:q4,errorText:z4,notFoundText:H4,requestNotification:V4,fadeIn:W4,notificationContent:G4,notificationIcon:Y4,notificationText:K4,notificationActions:J4,approveBtn:Q4,rejectBtn:X4,spinner:Z4,spin:ex,profileLayout:tx,photosSection:sx,storiesThumbnail:nx,galleryContainer:rx,gallery:ox,imageContainer:ix,galleryImage:ax,privatePhoto:cx,lockIcon:lx,permissionStatus:dx,pending:ux,rejected:hx,approved:fx,requestAccessBtn:gx,onlineBadge:px,pulse:mx,nav:yx,navPrev:vx,navNext:_x,thumbnails:wx,thumbnail:bx,thumbnailActive:xx,thumbnailImg:Sx,privateThumbnail:Cx,actions:kx,actionBtn:Nx,likeBtn:Ex,likedBtn:Tx,messageBtn:Ax,moreActions:jx,toggleBtn:Ix,dropdown:$x,slideUp:Px,dropdownItem:Rx,detailsSection:Mx,headline:Lx,headlineTitle:Ox,premiumBadge:Fx,location:Dx,icon:Bx,onlineStatus:Ux,isOnline:qx,activity:zx,activityItem:Hx,compatibilitySection:Vx,sectionTitle:Wx,compatibilityScore:Gx,scoreCircle:Yx,scoreBg:Kx,scoreFill:Jx,scoreValue:Qx,compatibilityDetails:Xx,compatibilityFactor:Zx,factorLabel:eS,factorBar:tS,factorFill:sS,section:nS,aboutText:rS,tagsContainer:oS,tag:iS,identityTag:aS,statusTag:cS,lookingForTag:lS,intoTag:dS,turnOnTag:uS,interestsTags:hS,interestTag:fS,commonTag:gS,commonIcon:pS,showMoreBtn:mS,chatOverlay:yS,dark:vS,darkToggleBtn:_S,darkDropdown:wS,darkDropdownItem:bS,darkDropdownIcon:xS,darkOnlineStatus:SS,darkCompatibilitySection:CS,darkScoreBg:kS,darkScoreValue:NS,darkFactorLabel:ES,darkFactorBar:TS,darkFactorFill:AS,noPhotosText:jS,darkTag:IS,darkIdentityTag:$S,darkStatusTag:PS,darkLookingForTag:RS,darkIntoTag:MS,darkTurnOnTag:LS,darkInterestTag:OS,darkCommonTag:FS,darkCommonIcon:DS,darkShowMoreBtn:BS},ki=({userId:e,isOpen:t,onClose:s})=>{var uo,ho,fo,go,rr,Gs,po,mo,yo,Ar,vo,_o,wo,jr,Ir,$r;const{user:n}=Xt(),o=En(),{isTouch:i,isIOS:c,isAndroid:l}=Nr(),{getUser:u,currentUser:h,likeUser:a,unlikeUser:d,isUserLiked:f,error:v,blockUser:g,reportUser:b,sendMessage:$}=Bn(),{loadUserStories:T,hasUnviewedStories:F}=co(),{theme:M}=nc(),{t:E,language:U}=ss(),A=p.useMemo(()=>({compatibilityTitle:E("compatibility"),location:E("location"),age:E("age"),interests:E("interests"),aboutMe:E("aboutMe"),iAm:E("identity"),maritalStatus:E("maritalStatus"),lookingFor:E("lookingFor"),imInto:E("intoTags"),itTurnsMeOn:E("turnOns"),onlineNow:E("online"),offline:E("offline"),lastActive:E("lastActive"),memberSince:E("memberSince")}),[E]),[D,w]=p.useState([]),[N,P]=p.useState(!1),[x,k]=p.useState(0),[R,j]=p.useState(!1),[I,S]=p.useState(!1),[C,G]=p.useState(!1),[V,L]=p.useState({}),[X,q]=p.useState(!1),[z,K]=p.useState(!1),[W,H]=p.useState([]),[ne,Q]=p.useState(!1),[he,re]=p.useState(!1),[_e,ke]=p.useState(null),[Be,Oe]=p.useState(!1),[Se,Le]=p.useState(`image-${Math.floor(Math.random()*1e4)}`),Me=p.useMemo(()=>{if(e&&n&&e!==n._id)try{const Ce=localStorage.getItem("photo-permissions-status");if(Ce){const lt=JSON.parse(Ce);if(lt&&lt[e])return{status:lt[e].status,isLoading:!1,source:"localStorage"}}}catch(Ce){_.error("Failed to load initial permission status from localStorage:",Ce)}return{status:null,isLoading:!1,source:"default"}},[e,n]),[He,ut]=p.useState(Me),tt=p.useRef(null),we=p.useRef(!1),ee=p.useRef(!1),de=p.useRef(!1),ye=ps(),oe=wu(),{isMounted:fe}=py(),{normalizePhotoUrl:ie,handlePhotoLoadError:te,clearCache:Y}=nr(),_=Ze.create("UserProfileModal"),m=p.useMemo(()=>n&&h&&n._id===h._id,[n,h]),y=p.useMemo(()=>!h||!n?0:es(),[h,n]),B=p.useMemo(()=>{var Ce;return!h||!n||!((Ce=h.details)!=null&&Ce.interests)?[]:h.details.interests.filter(lt=>{var St,It;return(It=(St=n.details)==null?void 0:St.interests)==null?void 0:It.includes(lt)})},[h,n]);p.useMemo(()=>W.some(Ce=>Ce.user&&h&&Ce.user._id===h._id),[W,h]),p.useMemo(()=>W.find(Ce=>Ce.user&&h&&Ce.user._id===h._id),[W,h]),m||He.status;const J=p.useRef(null),ce=p.useRef(!1);p.useEffect(()=>!e||!t||ce.current||J.current===e&&_e?void 0:(ce.current=!0,(async()=>{var lt;Oe(!0),J.current=e;try{if(u&&typeof u=="function"){const St=await u(e);St&&fe()&&ke(St.user||St)}else{const St=await oe.get(`/users/${e}`);if(St&&fe()){const It=((lt=St==null?void 0:St.data)==null?void 0:lt.user)||(St==null?void 0:St.data)||St;ke(It)}}}catch(St){fe()&&_.error("Error fetching user:",St)}finally{fe()&&(Oe(!1),ce.current=!1)}})(),()=>{ce.current=!1,t||(J.current=null)}),[e,t]),p.useCallback(()=>{_.debug("This function is no longer used - direct API call is made instead")},[]);const pe=p.useCallback(async()=>{_.debug("Photo permission system has been removed")},[]),$e=p.useRef(!1),We=p.useRef(!1),ct=p.useRef(!1),ft=p.useRef(!1),ht=p.useRef(!1);p.useEffect(()=>{if(!e||!t){ct.current&&(ct.current=!1,$e.current=!1,We.current=!1,ee.current=!1,we.current=!1,de.current=!1,ft.current=!1,ht.current=!1,P(!1),G(!1),ut({status:null,isLoading:!1}),L({}),q(!1),K(!1),k(0),w([]),H([]),Le(Date.now()),_.debug(`Modal cleanup ran for userId: ${e}`));return}return ct.current||(ct.current=!0,_.debug(`Modal opened for userId: ${e}`),k(0),S(!1),j(!1),L({}),P(!1),G(!1),Le(Date.now()),q(!1),K(!1),Q(!1),re(!1)),!we.current&&T&&(we.current=!0,Promise.resolve(T(e)).then(Ce=>{fe()&&Ce&&Array.isArray(Ce)&&w(Ce)}).catch(Ce=>{_.error("Error loading stories:",Ce)}).finally(()=>{fe()&&(we.current=!1)})),!ft.current&&e!==(n==null?void 0:n._id)&&(ft.current=!0,oe.get(`/users/${e}/photo-access-status`).then(Ce=>{var lt;if(fe()&&Ce&&Ce.success){const St=Ce.status||((lt=Ce.data)==null?void 0:lt.status)||null;St&&ut(It=>{if(It.status==="pending"&&St==="none")return It;if(It.status!==St){try{const Rt=JSON.parse(localStorage.getItem("photo-permissions-status")||"{}");Rt[e]={status:St,timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(Rt))}catch(Rt){_.error("Failed to update localStorage:",Rt)}return{status:St,isLoading:!1,source:"api"}}return It})}}).catch(Ce=>{_.error("Error loading photo access status:",Ce),fe()&&ut(lt=>lt.status==="pending"?lt:{status:"none",isLoading:!1,source:"api-error"})})),(n==null?void 0:n._id)===e&&!de.current&&(de.current=!0,pe()),()=>{t||($e.current=!1,ft.current=!1,we.current=!1,de.current=!1)}},[e,t,n==null?void 0:n._id]),p.useEffect(()=>{if(!t||!e||!an||!an.isConnected||!an.isConnected()||ht.current)return;ht.current=!0,_.debug(`Setting up photo permission notification listeners for user ${e}`);const Ce=Rt=>{var ws,mn;if(_.debug("Photo permission response received:",Rt),Rt&&Rt.status&&Rt.sender&&Rt.sender._id===e){if(_.debug(`Received permission response from ${e}: ${Rt.status}`),ut({status:Rt.status,isLoading:!1,source:"notification"}),Rt.status==="approved"){Z.success(`${((ws=Rt.sender)==null?void 0:ws.nickname)||"User"} approved your photo request!`,{position:"top-center",autoClose:5e3,icon:"🔓"});try{const yn=localStorage.getItem("photo-permissions-status")||"{}",Pr=JSON.parse(yn);Pr[e]={status:"approved",timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(Pr))}catch(yn){_.error("Failed to update permission status in localStorage:",yn)}const Fs=Date.now();Y(),Le(Fs),window.dispatchEvent(new CustomEvent("avatar:refresh",{detail:{timestamp:Fs}}))}else if(Rt.status==="rejected"){Z.info(`${((mn=Rt.sender)==null?void 0:mn.nickname)||"User"} declined your photo request`,{position:"top-center",autoClose:5e3,icon:"🔒"});try{const Fs=localStorage.getItem("photo-permissions-status")||"{}",yn=JSON.parse(Fs);yn[e]={status:"rejected",timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(yn))}catch(Fs){_.error("Failed to update permission status in localStorage:",Fs)}}}},lt=Rt=>{if(_.debug("Photo access revoked received:",Rt),Rt&&Rt.ownerId===e){_.debug(`Photo access has been revoked by ${Rt.ownerNickname}`),ut({status:"none",isLoading:!1,source:"socket"});try{const mn=localStorage.getItem("photo-permissions-status")||"{}",Fs=JSON.parse(mn);delete Fs[e],localStorage.setItem("photo-permissions-status",JSON.stringify(Fs)),_.debug(`Cleared permission status in localStorage for user ${e}`)}catch(mn){_.error("Failed to clear permission status in localStorage:",mn)}const ws=Date.now();Y(),Le(ws),window.dispatchEvent(new CustomEvent("avatar:refresh",{detail:{timestamp:ws}})),Z.info(`${Rt.ownerNickname||"User"} has revoked your access to their private photos`,{position:"top-center",autoClose:5e3,icon:"🔒"})}},St=an.on("photoPermissionResponseReceived",Ce),It=an.on("photoAccessRevoked",lt);return()=>{typeof St=="function"&&St(),typeof It=="function"&&It(),ht.current=!1}},[e,t,h,Y]);const qt=async Ce=>{if(!Ce||!h||He.isLoading){_.warn("Cannot request private photos: missing user ID or already loading");return}i&&Yt("send"),ut(lt=>({...lt,isLoading:!0}));try{if(_.debug(`Requesting private photos access for user ${Ce}`),an&&an.isConnected&&an.isConnected()){_.debug("Using socket to request photo permission");try{const It=`req-${Math.floor(Math.random()*1e9).toString(16)}`,Rt=Math.floor(Math.random()*1e9).toString(16),ws=Math.floor(Date.now()/1e3)*1e3;an.emit("requestPhotoPermission",{ownerId:Ce,photoId:Ce,permissionId:Ce,requestId:It,timestamp:ws}),_.debug(`Emitted photo permission request: ${It}`),window.dispatchEvent(new CustomEvent("mandarin:photoRequest",{detail:{userId:Ce,requestId:It,timestamp:ws}})),_.debug(`Photo permission request sent via socket with requestId: ${It}`)}catch(It){throw _.error("Socket-based permission request failed, using local fallback:",It),new Error("Socket request failed")}}else _.warn("Socket not available, using local simulation"),await new Promise(It=>setTimeout(It,1e3));try{const It=localStorage.getItem("photo-permissions-status")||"{}",Rt=JSON.parse(It);Rt[Ce]={status:"pending",timestamp:Date.now()},localStorage.setItem("photo-permissions-status",JSON.stringify(Rt)),_.debug(`Saved photo permission request for user ${Ce} to localStorage`)}catch(It){_.error("Failed to save photo permission status to localStorage:",It)}Z.success(r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("div",{style:{backgroundColor:"#4a76a8",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"16px"},children:r.jsx(Cn,{})}),r.jsx("span",{style:{fontWeight:"bold"},children:"Access request sent!"})]}),r.jsxs("p",{style:{margin:"0",fontSize:"14px"},children:["Waiting for ",h.nickname||"user"," to approve your request"]})]}),{position:"top-center",autoClose:6e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,icon:"🔒"}),ut({status:"pending",isLoading:!1,source:"user-request"});const St=Date.now();Y(),Le(St),window.__photo_refresh_timestamp=St,window.dispatchEvent(new CustomEvent("avatar:refresh",{detail:{timestamp:St}}))}catch(lt){if(!fe())return;_.error("Error requesting private photos access:",lt),ut({status:null,isLoading:!1}),Z.error("Failed to request access to private photos")}},Gt=p.useCallback(Ce=>{var St;_.debug(`Image with ID ${Ce} failed to load`),L(It=>({...It,[Ce]:!0}));const lt=(St=h==null?void 0:h.photos)==null?void 0:St.find(It=>It._id===Ce);lt&&lt.url&&te(Ce,lt.url),Y()},[h,_,te,Y]),ns=p.useCallback(async()=>{const Ce=h||_e;if(!(!Ce||X)){i&&Yt(f&&f(Ce._id)?"wink":"send"),q(!0);try{f&&f(Ce._id)?await d(Ce._id,Ce.nickname):await a(Ce._id,Ce.nickname)}catch(lt){i&&Yt("error"),_.error("Error toggling like:",lt),Z.error("Failed to update like status")}finally{fe()&&q(!1)}}},[h,_e,X,f,d,a,fe,_,i]),As=p.useCallback(async()=>{if(e){i&&Yt("selectConversation");try{await g(e),Z.success("User blocked successfully"),s()}catch(Ce){i&&Yt("error"),_.error("Error blocking user:",Ce),Z.error("Failed to block user")}}},[e,g,s,_,i]),Ne=p.useCallback(async()=>{if(e){i&&Yt("selectConversation");try{await b(e),Z.success("User reported successfully"),s()}catch(Ce){i&&Yt("error"),_.error("Error reporting user:",Ce),Z.error("Failed to report user")}}},[e,b,s,_,i]);p.useCallback(async()=>{if(e){i&&Yt("send"),K(!0);try{await $(e),ye("/messages"),s()}catch(Ce){i&&Yt("error"),_.error("Error sending message:",Ce),Z.error("Failed to start conversation")}finally{fe()&&K(!1)}}},[e,$,ye,s,fe,_,i]);const Ie=p.useCallback(()=>G(!0),[]),et=p.useCallback(()=>G(!1),[]),at=p.useCallback(()=>P(!1),[]),Tt=p.useCallback(()=>{var lt;const Ce=(lt=h||_e)==null?void 0:lt.photos;Ce&&x<Ce.length-1&&k(x+1)},[h,_e,x]),st=p.useCallback(()=>{x>0&&k(x-1)},[x]);function es(){if(!(h!=null&&h.details)||!(n!=null&&n.details))return 0;let Ce=0;h.details.location===n.details.location&&(Ce+=25);const lt=Math.abs((h.details.age||0)-(n.details.age||0));lt<=5?Ce+=25:lt<=10?Ce+=15:Ce+=5;const St=h.details.interests||[],It=n.details.interests||[],Rt=St.filter(ws=>It.includes(ws)).length;return Ce+=Math.min(50,Rt*10),Math.min(100,Ce)}const vt=Ce=>!Ce||typeof Ce!="string"?"":Ce.charAt(0).toUpperCase()+Ce.slice(1);if(!t)return null;if(Be)return r.jsx(Kr,{isOpen:t,onClose:s,size:"large",children:r.jsx("div",{className:ue.loadingContainer,children:r.jsx(Er,{text:E("loadingProfile"),size:"large",centered:!0})})});if(v)return r.jsx(Kr,{isOpen:t,onClose:s,size:"small",children:r.jsxs("div",{className:ue.errorContainer,children:[r.jsx("h3",{className:ue.errorTitle,children:E("errorUnknown")}),r.jsx("p",{className:ue.errorText,children:v}),r.jsx(xn,{variant:"primary",onClick:s,children:E("close")})]})});const Pe=h||_e;return Pe?r.jsx(Kr,{isOpen:t,onClose:s,size:o?"fullscreen":"xlarge",className:`${ue.modalContainer} ${o?ue.mobileModal:""}`,showCloseButton:!0,bottomSheetOnMobile:o,headerClassName:ue.modalHeader,bodyClassName:"modern-user-profile",closeOnClickOutside:!0,children:r.jsxs("div",{className:ue.profileContent,ref:tt,children:[r.jsxs("div",{className:ue.profileLayout,children:[r.jsxs("div",{className:ue.photosSection,children:[D&&D.length>0&&r.jsx("div",{className:ue.storiesThumbnail,children:r.jsx(Ku,{user:Pe,hasUnviewedStories:F&&F(Pe._id),onClick:Ie})}),Pe&&Pe.photos&&Pe.photos.length>0?r.jsxs("div",{className:ue.galleryContainer,children:[r.jsxs("div",{className:ue.gallery,children:[Pe.photos[x]&&Pe.photos[x].privacy==="private"&&!Pe.photos[x].hasPermission?r.jsxs("div",{className:ue.privatePhoto,children:[r.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:E("privatePhoto"),style:{width:"100%",height:"100%",objectFit:"cover",opacity:.7,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:0,borderRadius:"inherit"}}),r.jsxs("div",{style:{position:"absolute",zIndex:1,top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.5)",borderRadius:"inherit"},children:[r.jsx(vs,{className:ue.lockIcon,style:{fontSize:"3rem",color:"white",margin:"0 0 1rem 0"}}),r.jsx("p",{style:{color:"white",fontWeight:"bold",marginBottom:"1rem"},children:E("privatePhoto")||"Private Photo"}),r.jsxs("button",{className:ue.requestAccessBtn,onClick:()=>qt(Pe._id),disabled:He.isLoading||He.status==="pending",children:[He.isLoading?r.jsx(Ws,{className:ue.spinner}):r.jsx(tc,{}),He.status==="pending"?E("requestPending","Request Pending"):E("requestAccess")||"Request Access"]})]})]}):Pe.photos[x]&&r.jsx("div",{className:ue.imageContainer,children:r.jsx("img",{src:`${ie(Pe.photos[x].url,!0)}&_key=${Se}`,alt:`${Pe.nickname}'s photo`,className:ue.galleryImage,onError:()=>Gt(Pe.photos[x]._id)})}),Pe.isOnline&&r.jsxs("div",{className:ue.onlineBadge,children:[r.jsx("span",{className:ue.pulse}),E("online")]}),Pe.photos.length>1&&r.jsxs(r.Fragment,{children:[r.jsx("button",{className:`${ue.nav} ${ue.navPrev}`,onClick:st,disabled:x===0,"aria-label":E("previous"),children:r.jsx(Jd,{})}),r.jsx("button",{className:`${ue.nav} ${ue.navNext}`,onClick:Tt,disabled:x===Pe.photos.length-1,"aria-label":E("next"),children:r.jsx(Qd,{})})]})]}),Pe.photos.length>1&&r.jsx("div",{className:ue.thumbnails,children:Pe.photos.map((Ce,lt)=>r.jsx("div",{className:`${ue.thumbnail} ${lt===x?ue.thumbnailActive:""}`,onClick:()=>k(lt),children:Ce.privacy==="private"&&!Ce.hasPermission?r.jsxs("div",{className:ue.privateThumbnail,children:[r.jsx("img",{src:`${window.location.origin}/private-photo.png`,alt:E("privatePhoto","Private photo"),className:ue.thumbnailImg,style:{width:"100%",height:"100%",objectFit:"cover"}}),r.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"inherit"},children:r.jsx(vs,{style:{color:"white",fontSize:"1.25rem"}})}),He.status&&r.jsxs("div",{className:`${ue.permissionStatus} ${ue[He.status]}`,style:{zIndex:2},children:[He.status==="pending"&&(E("requestAccessPending")||"Pending"),He.status==="approved"&&(E("approve")||"Approved"),He.status==="rejected"&&(E("reject")||"Rejected")]})]}):r.jsx("img",{src:`${ie(Ce.url,!0)}&_key=${Se}`,alt:`${Pe.nickname} ${lt+1}`,className:ue.thumbnailImg,onError:()=>Gt(Ce._id)})},Ce._id||lt))})]}):r.jsx("div",{className:ue.gallery,children:(()=>{var St,It,Rt,ws;let Ce="/default-avatar.png",lt="Default avatar";return _.debug("UserProfileModal: Rendering gender-specific avatar"),_.debug("UserProfileModal: User details:",Pe==null?void 0:Pe.details),_.debug("UserProfileModal: User iAm value:",(St=Pe==null?void 0:Pe.details)==null?void 0:St.iAm),_.debug("UserProfileModal: User gender:",Pe==null?void 0:Pe.gender),((It=Pe==null?void 0:Pe.details)==null?void 0:It.iAm)==="woman"?(Ce="/women-avatar.png",lt="Women avatar"):((Rt=Pe==null?void 0:Pe.details)==null?void 0:Rt.iAm)==="man"?(Ce="/man-avatar.png",lt="Man avatar"):((ws=Pe==null?void 0:Pe.details)==null?void 0:ws.iAm)==="couple"&&(Ce="/couple-avatar.png",lt="Couple avatar"),_.debug(`UserProfileModal: Using ${lt} at path ${Ce}`),r.jsx(r.Fragment,{children:r.jsxs("div",{style:{width:"100%",height:"100%",maxHeight:"380px",aspectRatio:"1 / 1",borderRadius:"var(--radius-xl)",backgroundImage:`url(${window.location.origin}${Ce}?_refresh=${Se})`,backgroundSize:"cover",backgroundPosition:"center",boxShadow:"var(--shadow-inner)",position:"relative"},children:[Pe.isOnline&&r.jsxs("div",{className:ue.onlineBadge,children:[r.jsx("span",{className:ue.pulse}),E("online")]}),r.jsx("p",{className:ue.noPhotosText,children:E("noPhotosAvailable")})]})})})()}),r.jsxs("div",{className:ue.actions,children:[!m&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:`${ue.actionBtn} ${f&&f(Pe._id)?ue.likedBtn:ue.likeBtn}`,onClick:ns,disabled:X,children:[X?r.jsx(Ws,{className:ue.spinner}):r.jsx(On,{}),f&&f(Pe._id)?E("liked"):E("like")]}),r.jsxs("button",{className:`${ue.actionBtn} ${ue.messageBtn}`,onClick:()=>P(!0),disabled:z,children:[z?r.jsx(Ws,{className:ue.spinner}):r.jsx(kr,{}),E("message")]})]}),r.jsxs("div",{className:ue.moreActions,children:[r.jsx("button",{className:`${ue.toggleBtn} ${M==="dark"?ue.darkToggleBtn:""}`,onClick:()=>j(!R),"aria-label":E("moreActions"),children:r.jsx(eu,{})}),R&&r.jsxs("div",{className:`${ue.dropdown} ${M==="dark"?ue.darkDropdown:""}`,children:[r.jsxs("button",{className:`${ue.dropdownItem} ${M==="dark"?ue.darkDropdownItem:""}`,onClick:Ne,children:[r.jsx(su,{className:M==="dark"?ue.darkDropdownIcon:""}),E("reportUser")]}),r.jsxs("button",{className:`${ue.dropdownItem} ${M==="dark"?ue.darkDropdownItem:""}`,onClick:As,children:[r.jsx(Za,{className:M==="dark"?ue.darkDropdownIcon:""}),E("blockUser")]})]})]})]})]}),r.jsxs("div",{className:ue.detailsSection,children:[r.jsxs("div",{className:ue.headline,children:[r.jsxs("h1",{className:ue.headlineTitle,children:[Pe.nickname,", ",((uo=Pe.details)==null?void 0:uo.age)||"?"]}),Pe.role==="premium"&&r.jsxs("div",{className:ue.premiumBadge,children:[r.jsx(i1,{})," ",E("premium","Premium")]})]}),r.jsxs("div",{className:ue.location,children:[r.jsx(to,{className:ue.icon}),r.jsx("span",{children:((ho=Pe.details)==null?void 0:ho.location)||E("unknownLocation")}),r.jsx("div",{className:`${ue.onlineStatus} ${Pe.isOnline?ue.isOnline:""} ${M==="dark"?ue.darkOnlineStatus:""}`,children:Pe.isOnline?A.onlineNow:A.offline})]}),r.jsxs("div",{className:ue.activity,children:[r.jsxs("div",{className:ue.activityItem,children:[r.jsx(g1,{className:ue.icon}),r.jsx("span",{children:Pe.isOnline?A.onlineNow:`${A.lastActive} ${Wo(Pe.lastActive,{showTime:!1})}`})]}),r.jsxs("div",{className:ue.activityItem,children:[r.jsx(Kd,{className:ue.icon}),r.jsxs("span",{children:[A.memberSince," ",Wo(Pe.createdAt,{showTime:!1})]})]})]}),!m&&r.jsxs("div",{className:`${ue.compatibilitySection} ${M==="dark"?ue.darkCompatibilitySection:""}`,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.compatibilityTitle}),r.jsxs("div",{className:ue.compatibilityScore,children:[r.jsxs("div",{className:ue.scoreCircle,children:[r.jsxs("svg",{viewBox:"0 0 100 100",children:[r.jsx("defs",{children:r.jsxs("linearGradient",{id:`compatibility-gradient-${e||"default"}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[r.jsx("stop",{offset:"0%",style:{stopColor:"var(--compat-gradient-start, var(--primary-400))"}}),r.jsx("stop",{offset:"100%",style:{stopColor:"var(--compat-gradient-end, var(--primary-500))"}})]})}),r.jsx("circle",{className:`${ue.scoreBg} ${M==="dark"?ue.darkScoreBg:""}`,cx:"50",cy:"50",r:"45"}),r.jsx("circle",{className:ue.scoreFill,cx:"50",cy:"50",r:"45",strokeDasharray:"283",strokeDashoffset:283-283*y/100,style:{stroke:`url(#compatibility-gradient-${e||"default"})`}})]}),r.jsxs("div",{className:`${ue.scoreValue} ${M==="dark"?ue.darkScoreValue:""}`,children:[y,"%"]})]}),r.jsxs("div",{className:ue.compatibilityDetails,children:[r.jsxs("div",{className:ue.compatibilityFactor,children:[r.jsx("span",{className:`${ue.factorLabel} ${M==="dark"?ue.darkFactorLabel:""}`,children:E("location")}),r.jsx("div",{className:`${ue.factorBar} ${M==="dark"?ue.darkFactorBar:""}`,children:r.jsx("div",{className:`${ue.factorFill} ${M==="dark"?ue.darkFactorFill:""}`,style:{width:((fo=h.details)==null?void 0:fo.location)===((go=n==null?void 0:n.details)==null?void 0:go.location)?"100%":"30%"}})})]}),r.jsxs("div",{className:ue.compatibilityFactor,children:[r.jsx("span",{className:`${ue.factorLabel} ${M==="dark"?ue.darkFactorLabel:""}`,children:E("age")}),r.jsx("div",{className:`${ue.factorBar} ${M==="dark"?ue.darkFactorBar:""}`,children:r.jsx("div",{className:`${ue.factorFill} ${M==="dark"?ue.darkFactorFill:""}`,style:{width:Math.abs((((rr=h.details)==null?void 0:rr.age)||0)-(((Gs=n==null?void 0:n.details)==null?void 0:Gs.age)||0))<=5?"90%":Math.abs((((po=h.details)==null?void 0:po.age)||0)-(((mo=n==null?void 0:n.details)==null?void 0:mo.age)||0))<=10?"60%":"30%"}})})]}),r.jsxs("div",{className:ue.compatibilityFactor,children:[r.jsx("span",{className:`${ue.factorLabel} ${M==="dark"?ue.darkFactorLabel:""}`,children:E("interests")}),r.jsx("div",{className:`${ue.factorBar} ${M==="dark"?ue.darkFactorBar:""}`,children:r.jsx("div",{className:`${ue.factorFill} ${M==="dark"?ue.darkFactorFill:""}`,style:{width:`${Math.min(100,B.length*20)}%`}})})]})]})]})]}),((yo=Pe.details)==null?void 0:yo.bio)&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.aboutMe}),r.jsx("p",{className:ue.aboutText,children:Pe.details.bio})]}),((Ar=Pe.details)==null?void 0:Ar.iAm)&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.iAm}),r.jsx("div",{className:ue.tagsContainer,children:r.jsx("span",{className:`${ue.tag} ${ue.identityTag} ${M==="dark"?ue.darkTag+" "+ue.darkIdentityTag:""}`,children:E(Pe.details.iAm)||vt(Pe.details.iAm)})})]}),((vo=Pe.details)==null?void 0:vo.maritalStatus)&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.maritalStatus}),r.jsx("div",{className:ue.tagsContainer,children:r.jsx("span",{className:`${ue.tag} ${ue.statusTag} ${M==="dark"?ue.darkTag+" "+ue.darkStatusTag:""}`,children:E(Pe.details.maritalStatus)||Pe.details.maritalStatus})})]}),((_o=Pe.details)==null?void 0:_o.lookingFor)&&Pe.details.lookingFor.length>0&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.lookingFor}),r.jsx("div",{className:ue.tagsContainer,children:Pe.details.lookingFor.map((Ce,lt)=>r.jsx("span",{className:`${ue.tag} ${ue.lookingForTag} ${M==="dark"?ue.darkTag+" "+ue.darkLookingForTag:""}`,children:E(Ce)||Ce},lt))})]}),((wo=Pe.details)==null?void 0:wo.intoTags)&&Pe.details.intoTags.length>0&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.imInto}),r.jsx("div",{className:ue.tagsContainer,children:Pe.details.intoTags.map((Ce,lt)=>r.jsx("span",{className:`${ue.tag} ${ue.intoTag} ${M==="dark"?ue.darkTag+" "+ue.darkIntoTag:""}`,children:E(Ce)||Ce},lt))})]}),((jr=Pe.details)==null?void 0:jr.turnOns)&&Pe.details.turnOns.length>0&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.itTurnsMeOn}),r.jsx("div",{className:ue.tagsContainer,children:Pe.details.turnOns.map((Ce,lt)=>r.jsx("span",{className:`${ue.tag} ${ue.turnOnTag} ${M==="dark"?ue.darkTag+" "+ue.darkTurnOnTag:""}`,children:E(Ce)||Ce},lt))})]}),(($r=(Ir=Pe.details)==null?void 0:Ir.interests)==null?void 0:$r.length)>0&&r.jsxs("div",{className:ue.section,children:[r.jsx("h2",{className:ue.sectionTitle,children:A.interests}),r.jsxs("div",{className:ue.interestsTags,children:[(I?Pe.details.interests:Pe.details.interests.slice(0,8)).map(Ce=>r.jsxs("span",{className:`
                        ${ue.interestTag}
                        ${B.includes(Ce)?ue.commonTag:""}
                        ${M==="dark"?ue.darkInterestTag:""}
                        ${M==="dark"&&B.includes(Ce)?ue.darkCommonTag:""}
                      `,children:[E(Ce)||Ce,B.includes(Ce)&&r.jsx(jt,{className:`${ue.commonIcon} ${M==="dark"?ue.darkCommonIcon:""}`})]},Ce)),!I&&Pe.details.interests.length>8&&r.jsxs("button",{className:`${ue.showMoreBtn} ${M==="dark"?ue.darkShowMoreBtn:""}`,onClick:()=>S(!0),children:["+",Pe.details.interests.length-8," ",E("showMore")]})]})]})]})]}),N&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:ue.chatOverlay,onClick:at}),r.jsx(Ni,{recipient:Pe,isOpen:N,onClose:at})]}),C&&r.jsx(Yu,{userId:Pe._id,onClose:et})]})}):r.jsx(Kr,{isOpen:t,onClose:s,size:"small",children:r.jsxs("div",{className:ue.notFoundContainer,children:[r.jsx("h3",{className:ue.notFoundTitle,children:E("notFound")}),r.jsx("p",{className:ue.notFoundText,children:E("userNotFound")}),r.jsx(xn,{variant:"primary",onClick:s,children:E("close")})]})})},US="_chatContainer_dulfn_8",qS="_minimized_dulfn_26",zS="_collapsed_dulfn_30",HS="_opening_dulfn_40",VS="_slideUp_dulfn_1",WS="_chatHeader_dulfn_45",GS="_backButton_dulfn_59",YS="_conversationInfo_dulfn_74",KS="_userInfo_dulfn_83",JS="_userName_dulfn_89",QS="_blockedTag_dulfn_101",XS="_pulseBg_dulfn_1",ZS="_userStatus_dulfn_119",eC="_blockedStatus_dulfn_127",tC="_statusOnline_dulfn_132",sC="_statusOffline_dulfn_132",nC="_statusBlocked_dulfn_132",rC="_connectionStatus_dulfn_142",oC="_statusIcon_dulfn_154",iC="_chatActions_dulfn_159",aC="_chatHeaderBtn_dulfn_165",cC="_videoCallButton_dulfn_165",lC="_moreOptionsButton_dulfn_165",dC="_headerDropdown_dulfn_184",uC="_fadeIn_dulfn_1",hC="_dropdownItem_dulfn_203",fC="_blockedUserBanner_dulfn_223",gC="_unblockButton_dulfn_246",pC="_premiumBanner_dulfn_263",mC="_premiumIcon_dulfn_275",yC="_premiumText_dulfn_281",vC="_upgradeBtn_dulfn_287",_C="_activeCallBanner_dulfn_307",wC="_callIcon_dulfn_318",bC="_endCallBtn_dulfn_323",xC="_incomingCallBanner_dulfn_342",SC="_slidein_dulfn_1",CC="_incomingCallInfo_dulfn_358",kC="_pulse_dulfn_369",NC="_incomingCallActions_dulfn_373",EC="_acceptCallBtnSmall_dulfn_378",TC="_declineCallBtnSmall_dulfn_378",AC="_messagesContainer_dulfn_422",jC="_loadingMessages_dulfn_432",IC="_noMessages_dulfn_432",$C="_spinner_dulfn_444",PC="_spin_dulfn_444",RC="_messageDate_dulfn_454",MC="_messageWrapper_dulfn_481",LC="_sent_dulfn_491",OC="_message_dulfn_422",FC="_messageFadeIn_dulfn_1",DC="_messageBubble_dulfn_520",BC="_received_dulfn_540",UC="_messageContent_dulfn_554",qC="_messageMeta_dulfn_559",zC="_metaReceived_dulfn_571",HC="_metaSent_dulfn_575",VC="_messageTime_dulfn_580",WC="_readIndicator_dulfn_589",GC="_sentIndicator_dulfn_589",YC="_statusIndicator_dulfn_589",KC="_errorIndicator_dulfn_606",JC="_pending_dulfn_620",QC="_pendingIndicator_dulfn_620",XC="_error_dulfn_606",ZC="_systemMessage_dulfn_636",e6="_systemMessageContent_dulfn_665",t6="_errorContent_dulfn_675",s6="_winkMessage_dulfn_681",n6="_messageLabel_dulfn_692",r6="_videoCallMessage_dulfn_704",o6="_videoIcon_dulfn_710",i6="_fileMessage_dulfn_721",a6="_imageAttachment_dulfn_725",c6="_fileAttachment_dulfn_742",l6="_fileIcon_dulfn_758",d6="_fileName_dulfn_768",u6="_fileSize_dulfn_774",h6="_downloadLink_dulfn_783",f6="_typingIndicator_dulfn_810",g6="_typing_dulfn_810",p6="_messageError_dulfn_852",m6="_errorActions_dulfn_869",y6="_retryButton_dulfn_875",v6="_initButton_dulfn_875",_6="_refreshButton_dulfn_899",w6="_attachmentPreview_dulfn_918",b6="_attachmentInfo_dulfn_927",x6="_attachmentName_dulfn_933",S6="_attachmentSize_dulfn_942",C6="_removeAttachment_dulfn_947",k6="_uploadProgressContainer_dulfn_961",N6="_uploadProgressBar_dulfn_971",E6="_uploadProgressText_dulfn_978",T6="_chatArea_dulfn_1028",A6="_blockedChatArea_dulfn_1035",j6="_inputWrapper_dulfn_1041",I6="_inputArea_dulfn_1048",$6="_messageInput_dulfn_1057",P6="_blockedInput_dulfn_1079",R6="_emojiButton_dulfn_1086",M6="_attachButton_dulfn_1087",L6="_winkButton_dulfn_1088",O6="_sendButton_dulfn_1089",F6="_disabled_dulfn_1117",D6="_sending_dulfn_1126",B6="_rotate_dulfn_1",U6="_emojiPicker_dulfn_1140",q6="_emojiHeader_dulfn_1152",z6="_emojiList_dulfn_1166",H6="_videoCallOverlay_dulfn_1257",V6="_incomingCallOverlay_dulfn_1257",W6="_active_dulfn_307",Zt={chatContainer:US,minimized:qS,collapsed:zS,opening:HS,slideUp:VS,chatHeader:WS,backButton:GS,conversationInfo:YS,userInfo:KS,userName:JS,blockedTag:QS,pulseBg:XS,userStatus:ZS,blockedStatus:eC,statusOnline:tC,statusOffline:sC,statusBlocked:nC,connectionStatus:rC,statusIcon:oC,chatActions:iC,chatHeaderBtn:aC,videoCallButton:cC,moreOptionsButton:lC,headerDropdown:dC,fadeIn:uC,dropdownItem:hC,blockedUserBanner:fC,unblockButton:gC,premiumBanner:pC,premiumIcon:mC,premiumText:yC,upgradeBtn:vC,activeCallBanner:_C,callIcon:wC,endCallBtn:bC,incomingCallBanner:xC,slidein:SC,incomingCallInfo:CC,pulse:kC,incomingCallActions:NC,acceptCallBtnSmall:EC,declineCallBtnSmall:TC,messagesContainer:AC,loadingMessages:jC,noMessages:IC,spinner:$C,spin:PC,messageDate:RC,messageWrapper:MC,sent:LC,message:OC,messageFadeIn:FC,messageBubble:DC,received:BC,messageContent:UC,messageMeta:qC,metaReceived:zC,metaSent:HC,messageTime:VC,readIndicator:WC,sentIndicator:GC,statusIndicator:YC,errorIndicator:KC,pending:JC,pendingIndicator:QC,error:XC,systemMessage:ZC,systemMessageContent:e6,errorContent:t6,winkMessage:s6,messageLabel:n6,videoCallMessage:r6,videoIcon:o6,fileMessage:i6,imageAttachment:a6,fileAttachment:c6,fileIcon:l6,fileName:d6,fileSize:u6,downloadLink:h6,typingIndicator:f6,typing:g6,messageError:p6,errorActions:m6,retryButton:y6,initButton:v6,refreshButton:_6,attachmentPreview:w6,attachmentInfo:b6,attachmentName:x6,attachmentSize:S6,removeAttachment:C6,uploadProgressContainer:k6,uploadProgressBar:N6,uploadProgressText:E6,chatArea:T6,blockedChatArea:A6,inputWrapper:j6,inputArea:I6,messageInput:$6,blockedInput:P6,emojiButton:R6,attachButton:M6,winkButton:L6,sendButton:O6,disabled:F6,sending:D6,rotate:B6,emojiPicker:U6,emojiHeader:q6,emojiList:z6,videoCallOverlay:H6,incomingCallOverlay:V6,active:W6},bt=Ze.create("EmbeddedChat"),Ni=({recipient:e,isOpen:t=!0,onClose:s=()=>{}})=>{const{user:n}=Xt(),o=ps(),i=e==null?void 0:e._id,{messages:c,loading:l,error:u,sendMessage:h,sendFileMessage:a,typingStatus:d,sendTyping:f,loadMoreMessages:v,hasMore:g,sending:b,initialized:$,isConnected:T,refresh:F}=hy(i),[M,E]=p.useState(""),[U,A]=p.useState(null),[D,w]=p.useState(!1),[N,P]=p.useState(0),[x,k]=p.useState(0),[R,j]=p.useState(!1),[I,S]=p.useState(null),[C,G]=p.useState(!1),[V,L]=p.useState(!1),[X,q]=p.useState(!1),[z,K]=p.useState(null),[W,H]=p.useState(new Set),[ne,Q]=p.useState([]),he=p.useRef(null),re=p.useRef(null),_e=p.useRef(null),ke=p.useRef(null),Be=p.useRef(null),Oe=p.useRef(null),Se=p.useRef(!1),Le=p.useRef(0),Me=p.useMemo(()=>{if(!c)return[];const Ne=[],Ie=new Set,et=new Map,at=[...c,...ne];return at.sort((Tt,st)=>new Date(Tt.createdAt)-new Date(st.createdAt)),at.forEach(Tt=>{if(!Tt||!Tt.type&&!Tt.content)return;const st=Tt._id||Tt.tempId;if(st&&Ie.has(st)){bt.debug(`Skipping duplicate message by ID: ${st}`);return}if(st&&Ie.add(st),Tt.type==="wink"&&Tt.content==="😉"){const es=Tt.sender||"",vt=Math.floor(new Date(Tt.createdAt).getTime()/3e5),Pe=`${es}:${vt}`;if(et.has(Pe)){bt.debug(`Skipping duplicate wink from ${es} in time window ${vt}`);return}et.set(Pe,Tt)}Ne.push(Tt)}),Ne},[c,ne]),He=p.useMemo(()=>Wa(Me),[Me]),ut=n==null?void 0:n._id,tt=p.useCallback(Ne=>{if(!Ne)return!1;const Ie=W.has(Ne),et=(e==null?void 0:e.isBlocked)||!1;return Ie||et},[W,e==null?void 0:e.isBlocked]),we=p.useCallback((Ne,Ie=!1)=>{const et={_id:Ra("system"),sender:"system",content:Ne,createdAt:new Date().toISOString(),type:"system",error:Ie};Q(at=>at.some(Tt=>Tt._id===et._id)?at:[...at,et].sort((Tt,st)=>new Date(Tt.createdAt)-new Date(st.createdAt)))},[]);p.useEffect(()=>(bt.debug("EmbeddedChat mounted for recipient:",e==null?void 0:e.nickname),()=>{bt.debug("EmbeddedChat unmounted"),ke.current&&clearTimeout(ke.current),Be.current&&clearTimeout(Be.current)}),[i,e==null?void 0:e.nickname]),p.useEffect(()=>{(async()=>{try{const Ie=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");Ie.length>0&&(bt.debug(`Loading ${Ie.length} blocked users from localStorage`),H(new Set(Ie)),e!=null&&e._id&&Ie.includes(e._id)&&!e.isBlocked&&(bt.debug("Marking current recipient as blocked from localStorage data"),e.isBlocked=!0))}catch(Ie){bt.error("Error loading blocked users from localStorage:",Ie)}if(n!=null&&n._id)try{if(bt.debug("Fetching blocked users from server"),e!=null&&e._id)try{bt.debug(`Checking if user ${e._id} is blocked (as workaround for 400 error)`),n.blockedUsers&&Array.isArray(n.blockedUsers)&&n.blockedUsers.includes(e._id)&&(bt.debug(`User ${e._id} is marked as blocked in user object`),e.isBlocked=!0)}catch(et){bt.debug(`Could not check specific user blocked status: ${et.message}`)}const Ie=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");Ie.length>0&&(bt.debug(`Using ${Ie.length} blocked users from localStorage due to API error`),H(new Set(Ie)))}catch(Ie){bt.error("Error with blocked users handling:",Ie)}})()},[e==null?void 0:e._id,n==null?void 0:n._id]),p.useEffect(()=>{const Ne=he.current,Ie=Oe.current;if(!Ne||!Ie||!t){Se.current=!t;return}if($&&Me.length>0&&!Se.current)Ne.scrollIntoView({behavior:"instant",block:"end"}),Se.current=!0;else if(Se.current&&Me.length>0){if(Ie.scrollHeight-Ie.scrollTop-Ie.clientHeight<150){const Tt=setTimeout(()=>{Ne.scrollIntoView({behavior:"smooth",block:"end"})},Av);return()=>clearTimeout(Tt)}}else $||(Se.current=!1)},[Me,$,t]),p.useEffect(()=>(l?(L(!1),Be.current=setTimeout(()=>L(!0),kv)):(Be.current&&clearTimeout(Be.current),L(!1)),()=>{Be.current&&clearTimeout(Be.current)}),[l]);const ee=p.useCallback(async()=>{var Ne,Ie;if(!(!i||!(n!=null&&n._id)))try{const et=await qe.get("/users/photos/permissions",{params:{requestedBy:i,status:"pending"}}),at=((Ne=et==null?void 0:et.data)==null?void 0:Ne.data)||[];k(at.length)}catch(et){bt.error("Error checking photo permissions:",((Ie=et.response)==null?void 0:Ie.data)||et.message),k(0)}},[i,n==null?void 0:n._id]);p.useEffect(()=>{t&&i&&(n!=null&&n._id)&&ee()},[t,i,n==null?void 0:n._id,ee]),p.useEffect(()=>{if(t&&i&&!C&&$){const Ne=setTimeout(()=>{var Ie;return(Ie=re.current)==null?void 0:Ie.focus()},Ev);return()=>clearTimeout(Ne)}},[t,i,C,$]),p.useEffect(()=>{if(!t||!i||!(n!=null&&n._id)||!Ae)return;const Ne=st=>{var es;st.userId===i&&(bt.debug("Incoming call:",st),S({callId:st.callId,callerName:((es=st.caller)==null?void 0:es.name)||(e==null?void 0:e.nickname)||"Unknown",callerId:st.userId}),we(`${(e==null?void 0:e.nickname)||"Someone"} is calling you.`))},Ie=st=>{st.userId===i&&(bt.debug("Call accepted:",st),I||(we(`${(e==null?void 0:e.nickname)||"User"} accepted your call.`),G(!0),S(null),Z.success(`${e==null?void 0:e.nickname} accepted your call`)))},et=st=>{st.userId===i&&(bt.debug("Call declined:",st),C&&!I?(we(`${(e==null?void 0:e.nickname)||"User"} declined your call.`),G(!1)):I&&I.callerId===i&&(we(`Call from ${e==null?void 0:e.nickname} was declined/cancelled.`),S(null)),Z.info(`${e==null?void 0:e.nickname} declined the call`))},at=st=>{(st.userId===i||st.userId===n._id)&&(bt.debug("Hangup received:",st),C&&(we("Video call ended."),G(!1)),I&&I.callerId===st.userId&&(we(`Call attempt from ${e==null?void 0:e.nickname} ended.`),S(null)),(C||I)&&Z.info("Video call ended"),G(!1),S(null))},Tt=[Ae.on("incomingCall",Ne),Ae.on("callAccepted",Ie),Ae.on("callDeclined",et),Ae.on("videoHangup",at)];return()=>Tt.forEach(st=>st==null?void 0:st())},[t,i,e==null?void 0:e.nickname,n==null?void 0:n._id,C,I,we]);const de=p.useCallback(async Ne=>{var Ie,et;if(Ne==null||Ne.stopPropagation(),!(x===0||!i||R)){j(!0);try{const at=await qe.post("/users/photos/approve-all",{requesterId:i});if((Ie=at.data)!=null&&Ie.success){const Tt=at.data.approvedCount||x;Z.success(`Approved ${Tt} photo request${Tt!==1?"s":""}.`),we(`Photo access approved for ${(e==null?void 0:e.nickname)||"user"}.`),k(0),h&&(n==null?void 0:n.accountTier)!==ys.FREE&&h("I've approved your request to view my private photos.","text")}else throw new Error(((et=at.data)==null?void 0:et.message)||"Approval failed")}catch(at){bt.error("Error approving photo requests:",at),Z.error(`Error approving requests: ${at.message||"Please try again."}`),we("Failed to approve photo requests.",!0)}finally{j(!1)}}},[i,x,R,n==null?void 0:n.accountTier,h,we,e==null?void 0:e.nickname]),ye=p.useCallback(Ne=>{const Ie=Ne.target.value;E(Ie),ke.current&&clearTimeout(ke.current),Ie.trim()&&i&&f&&T&&(ke.current=setTimeout(f,Tv))},[i,f,T]),oe=p.useCallback(async(Ne,Ie="text")=>{if(!$||!T||!i||!/^[0-9a-fA-F]{24}$/.test(i))return Z.error("Cannot send message. Chat not ready or recipient invalid."),bt.warn("sendMessageWrapper pre-condition failed.",{initialized:$,isConnected:T,recipientId:i}),T||we("Message failed: No connection.",!0),!1;const et=Ie==="file"&&Ne instanceof File,at=et?a:h;if(!at)return bt.error(`Send function not available for type: ${Ie}`),Z.error(`Cannot send ${Ie} message.`),!1;let Tt=null;try{if(Ie==="text"&&typeof Ne=="string"){Tt=Ra("msg");const st={}}return et?await at(Ne,i):await at(Ne,Ie),bt.debug(`${Ie} message sent/initiated.`),!0}catch(st){return bt.error(`Failed to send ${Ie} message:`,st),Z.error(st.message||`Failed to send ${Ie}.`),we(`Failed to send ${Ie==="file"?"file":"message"}.`,!0),!1}},[$,T,i,h,a,we,n==null?void 0:n._id]),fe=p.useCallback(async()=>{var Ne;if(tt(e==null?void 0:e._id)){Z.error("Cannot send messages to blocked users");return}if(U){if(!U||D||b||(n==null?void 0:n.accountTier)===ys.FREE){(n==null?void 0:n.accountTier)===ys.FREE&&Z.error("Upgrade to Premium to send files.");return}w(!0),P(0);const Ie=setInterval(()=>P(at=>Math.min(at+10,90)),200),et=await oe(U,"file");clearInterval(Ie),et?(P(100),setTimeout(()=>{A(null),w(!1),P(0),_e.current&&(_e.current.value="")},jv)):(w(!1),P(0),Z.error("File upload failed."))}else{const Ie=M.trim();if(!Ie||b||D)return;if((n==null?void 0:n.accountTier)===ys.FREE&&Ie!=="😉"){Z.error("Free accounts can only send winks 😉.");return}E(""),await oe(Ie,"text")?(Ne=re.current)==null||Ne.focus():E(Ie)}},[U,M,b,D,n==null?void 0:n.accountTier,oe,e,tt]),ie=p.useCallback(async()=>{if(b||D||!i||tt(e==null?void 0:e._id)){tt(e==null?void 0:e._id)&&Z.error("Cannot send winks to blocked users");return}const Ne=Date.now();if(Ne-Le.current<5e3){Z.info("Please wait a moment before sending another wink");return}Le.current=Ne,await oe("😉","wink")},[b,D,i,oe,tt,e]),te=p.useCallback(()=>{var Ne;if((n==null?void 0:n.accountTier)===ys.FREE){Z.error("Upgrade to Premium to send files.");return}if(tt(e==null?void 0:e._id)){Z.error("Cannot send files to blocked users");return}D||(Ne=_e.current)==null||Ne.click()},[n==null?void 0:n.accountTier,D,tt,e]),Y=p.useCallback(Ne=>{var et;const Ie=(et=Ne.target.files)==null?void 0:et[0];if(Ie){if(tt(e==null?void 0:e._id)){Z.error("Cannot send files to blocked users"),Ne.target.value=null;return}if(Ie.size>si){Z.error(`File too large. Max size: ${si/1024/1024}MB.`),Ne.target.value=null;return}if(!ni.includes(Ie.type)){Z.error(`File type (${Ie.type||"unknown"}) not supported.`),Ne.target.value=null;return}A(Ie),E(""),w(!1),P(0),Z.info(`Selected: ${Ie.name}. Click send.`),Ne.target.value=null}},[tt,e]),_=p.useCallback(()=>{var Ne;A(null),P(0),w(!1),_e.current&&(_e.current.value=""),(Ne=re.current)==null||Ne.focus()},[]),m=p.useCallback(Ne=>{E(Ie=>Ie+Ne),setTimeout(()=>{var Ie;return(Ie=re.current)==null?void 0:Ie.focus()},0)},[]),y=p.useCallback(async Ne=>{if(Ne==null||Ne.stopPropagation(),!(Ae!=null&&Ae.isConnected())||!(e!=null&&e.isOnline)||(n==null?void 0:n.accountTier)===ys.FREE||!i||C||I){Ae!=null&&Ae.isConnected()?e!=null&&e.isOnline?(n==null?void 0:n.accountTier)===ys.FREE?we("Upgrade to Premium to make video calls.",!0):C||I?bt.warn("Call attempt while call active/incoming."):we("Cannot start call: Invalid state.",!0):we(`${e.nickname} is offline.`,!0):we("Cannot start call: Connection issue.",!0);return}we(`Initiating call to ${e.nickname}...`);try{await Ae.initiateVideoCall(i),we(`Calling ${e.nickname}... Waiting...`)}catch(Ie){bt.error("Video call initiation error:",Ie),we(Ie.message||"Could not start video call.",!0)}},[e,i,n==null?void 0:n.accountTier,C,I,we,T]),B=p.useCallback(Ne=>{Ne==null||Ne.stopPropagation(),C&&i&&Ae&&(bt.debug("Ending active call via button."),Ae.emit("videoHangup",{recipientId:i})),we("Video call ended."),G(!1),S(null)},[C,i,we]),J=p.useCallback(()=>{if(!(!I||!Ae)){if((n==null?void 0:n.accountTier)===ys.FREE){Z.error("Upgrade required to receive video calls."),Ae.answerVideoCall(I.callerId,!1,I.callId),we(`Declined call from ${I.callerName} (Upgrade required).`),S(null);return}bt.debug("Accepting call:",I.callId),Ae.answerVideoCall(I.callerId,!0,I.callId),we(`Accepted call from ${I.callerName}.`),G(!0),S(null)}},[I,n==null?void 0:n.accountTier,we]),ce=p.useCallback(()=>{!I||!Ae||(bt.debug("Declining call:",I.callId),Ae.answerVideoCall(I.callerId,!1,I.callId),we(`Declined call from ${I.callerName}.`),S(null))},[I,we]),pe=p.useCallback(async Ne=>{var Ie;if(!Ne||!(n!=null&&n._id)){bt.warn("Block/unblock attempted with invalid parameters:",{userId:Ne,currentUser:n==null?void 0:n._id}),Z.error("Unable to process block/unblock request. Please try again.");return}try{const et=tt(Ne),at=et?"unblock":"block";bt.debug(`Attempting to ${at} user:`,Ne);let Tt=!1;try{Tt=((Ie=(await qe.post(`/users/${at}/${Ne}`)).data)==null?void 0:Ie.success)||!1}catch(st){bt.error(`API error for ${at} user:`,st)}H(st=>{try{const es=new Set(st);return at==="block"?es.add(Ne):es.delete(Ne),es}catch(es){return bt.error("Error updating blockedUsers state:",es),st}});try{(e==null?void 0:e._id)===Ne&&(e.isBlocked=!et)}catch(st){bt.error("Error updating recipient.isBlocked:",st)}try{const st=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");if(at==="block"&&!st.includes(Ne))st.push(Ne);else if(at==="unblock"){const es=st.indexOf(Ne);es>-1&&st.splice(es,1)}localStorage.setItem("mandarin_blocked_users",JSON.stringify(st)),bt.debug(`Updated blocked users in localStorage: ${st.length} users`)}catch(st){bt.error("Error updating localStorage blocked users:",st)}Z.success(`User ${at==="block"?"blocked":"unblocked"} successfully`),we(`User ${at==="block"?"blocked":"unblocked"}.`)}catch(et){if(bt.error(`Error ${tt(Ne)?"unblocking":"blocking"} user:`,et),Z.error(`Failed to ${tt(Ne)?"unblock":"block"} user. Please try again.`),!tt(Ne)){if(bt.debug("Applying fallback local blocking for better UX despite error"),H(at=>{const Tt=new Set(at);return Tt.add(Ne),Tt}),(e==null?void 0:e._id)===Ne)try{e.isBlocked=!0}catch(at){bt.error("Error updating recipient.isBlocked in error handler:",at)}try{const at=JSON.parse(localStorage.getItem("mandarin_blocked_users")||"[]");at.includes(Ne)||(at.push(Ne),localStorage.setItem("mandarin_blocked_users",JSON.stringify(at)))}catch(at){bt.error("Error updating localStorage in fallback:",at)}}}},[n==null?void 0:n._id,tt,e,we]),$e=p.useCallback(async Ne=>{var Ie;if(!Ne||!(n!=null&&n._id)){bt.warn("Report user attempted with invalid parameters:",{userId:Ne,currentUser:n==null?void 0:n._id}),Z.error("Unable to process report request. Please try again.");return}try{bt.debug("Attempting to report user:",Ne);const et=await qe.post(`/users/report/${Ne}`);(Ie=et.data)!=null&&Ie.success?(Z.success("User reported successfully"),we("User reported to moderators."),tt(Ne)||setTimeout(()=>{Z.info("Consider blocking this user if they are bothering you.",{autoClose:8e3,onClick:()=>pe(Ne)})},1500)):(bt.warn("API reported failure for report:",et.data),Z.error("Failed to report user. Server reported an issue."))}catch(et){bt.error("Error reporting user:",et),Z.error("Failed to report user. Please try again."),we("Attempted to report user to moderators, but there was a network issue.",!0)}},[n==null?void 0:n._id,we,tt,pe]),We=p.useCallback(()=>{e!=null&&e._id&&(q(!0),K(e._id))},[e]),ct=p.useCallback(()=>{L(!1),F()},[F]),ft=p.useCallback(()=>{var Ne;Z.info("Attempting reconnect..."),(Ne=Ae==null?void 0:Ae.reconnect)==null||Ne.call(Ae),setTimeout(F,Nv)},[F]),ht=p.useCallback(()=>{Z.info("Re-initializing chat..."),ft()},[ft]);if(!t)return null;if(!e)return r.jsxs("div",{className:Os(Zt.chatContainer,Zt.opening),children:[r.jsx(oo,{showTimeoutMessage:!1,handleRetry:()=>{},handleReconnect:()=>{}}),r.jsx("p",{children:"Loading recipient..."})]});const qt=C||!!I||!$||!T,Gt=D||b||C||!!I,ns=tt(e._id),As={user:{...e,username:e.username||e.nickname||e._id,isBlocked:ns},pendingPhotoRequests:x};return Gt||e.isOnline,r.jsxs("div",{className:Os(Zt.chatContainer,Zt.opening),children:[r.jsx(Gu,{conversation:As,isMobile:!1,onBackClick:s,onStartVideoCall:y,onProfileClick:We,onBlockUser:pe,onReportUser:$e,userTier:n==null?void 0:n.accountTier,pendingPhotoRequests:x,isApprovingRequests:R,onApprovePhotoRequests:de,isActionDisabled:Gt,isConnected:T,customStyles:Zt}),(n==null?void 0:n.accountTier)===ys.FREE&&r.jsx(bi,{onUpgradeClick:()=>o("/subscription"),customStyles:Zt}),r.jsx(wi,{incomingCall:I,isCallActive:C,recipientNickname:e.nickname,onAcceptCall:J,onDeclineCall:ce,onEndCall:B,useSmallButtons:!0,customStyles:Zt}),r.jsx(Vu,{className:Zt.chatArea,isUserBlocked:ns,children:r.jsxs("div",{className:Zt.messagesContainer,ref:Oe,children:[l&&!Me.length?r.jsx(oo,{showTimeoutMessage:V,handleRetry:ct,handleReconnect:ft,customStyles:Zt}):u?r.jsx(xi,{error:u,handleRetry:ct,handleForceInit:ht,showInitButton:!$,customStyles:Zt}):!$||!T&&!Me.length?r.jsx(ic,{handleReconnect:ft,isInitializing:!$,customStyles:Zt}):Me.length===0&&!l?r.jsx(Si,{text:"No messages yet. Say hello!",customStyles:Zt}):r.jsxs(r.Fragment,{children:[g&&r.jsx("button",{onClick:v,className:Zt.loadMoreButton,disabled:l,children:l?"Loading...":"Load More"}),Object.entries(He).map(([Ne,Ie])=>r.jsxs(pt.Fragment,{children:[r.jsx("div",{className:Zt.messageDate,children:Ne}),Ie.map(et=>r.jsx(yi,{message:et,currentUserId:ut,isSending:b&&et.tempId===et._id,customStyles:Zt},et._id||et.tempId))]},Ne)),d&&r.jsx("div",{className:Zt.typingIndicatorBubble,children:r.jsxs("div",{className:Zt.typingIndicator,children:[r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{})]})})]}),r.jsx("div",{ref:he,style:{height:"1px"}})]})}),r.jsx(_i,{attachment:U,isUploading:D,uploadProgress:N,onRemoveAttachment:_,onFileSelected:Y,showFileInput:!1,disabled:qt,userTier:n==null?void 0:n.accountTier,customStyles:Zt}),r.jsx(vi,{messageValue:M,onInputChange:ye,onSubmit:fe,onWinkSend:ie,onFileAttachClick:te,onEmojiClick:m,userTier:n==null?void 0:n.accountTier,isSending:b,isUploading:D,attachmentSelected:!!U,disabled:qt,isUserBlocked:ns,inputRef:re,placeholderText:ns?"Cannot send messages to blocked users":e?`Message ${e.nickname}...`:"Type a message...",customStyles:Zt}),r.jsx("input",{type:"file",ref:_e,style:{display:"none"},onChange:Y,accept:ni.join(","),"aria-hidden":"true"}),C&&i&&ut&&r.jsx("div",{className:Os(Zt.videoCallOverlay,Zt.active),children:r.jsx(Ci,{isActive:C,userId:ut,recipientId:i,onEndCall:B,isIncoming:!1,callId:null})}),z&&r.jsx(ki,{userId:z,isOpen:X,onClose:()=>q(!1)})]})};Ni.propTypes={recipient:O.shape({_id:O.string.isRequired,nickname:O.string.isRequired,isOnline:O.bool,photos:O.arrayOf(O.shape({url:O.string}))}),isOpen:O.bool,onClose:O.func};const ia=Ze.create("StoriesCarousel"),G6=(e,t)=>{let s,n;return function(){const o=this,i=arguments;n?(clearTimeout(s),s=setTimeout(function(){Date.now()-n>=t&&(e.apply(o,i),n=Date.now())},t-(Date.now()-n))):(e.apply(o,i),n=Date.now())}},Y6=({onStoryClick:e})=>{const t=co()||{},{stories:s=[],loadStories:n,loading:o,hasUnviewedStories:i}=t,[c,l]=p.useState(!0),[u,h]=p.useState(null),[a,d]=p.useState(!1),f=p.useRef(!1),v=p.useRef(null),g=p.useRef(0),b=p.useRef(!1),$=[{_id:"coming-soon-video",mediaType:"video",user:{_id:"video-user",nickname:"Video Stories",details:{iAm:"man"},gender:"male"},userData:{_id:"video-user",nickname:"Video Stories",details:{iAm:"man"},gender:"male"}},{_id:"coming-soon-image",mediaType:"image",user:{_id:"image-user",nickname:"Image Stories",details:{iAm:"woman"},gender:"female"},userData:{_id:"image-user",nickname:"Image Stories",details:{iAm:"woman"},gender:"female"}}],T=p.useMemo(()=>{if(s&&s.length>0){const w=[],N=new Set,P=new Set;s.forEach(R=>{if(R&&R._id&&!N.has(R._id)){N.add(R._id);const j={...R};typeof R.user=="string"&&R.userData&&!R.userData._id&&(j.userData={...R.userData,_id:R.user}),w.push(j)}});const x=[];return[...w].sort((R,j)=>new Date(j.createdAt||0)-new Date(R.createdAt||0)).forEach(R=>{const j=R.user?typeof R.user=="string"?R.user:R.user._id:R.userData?R.userData._id:null;j&&!P.has(j)&&(P.add(j),x.push(R))}),[...x,...$]}else return $},[s,$]);p.useEffect(()=>{const w=async()=>{if(!f.current){f.current=!0,l(!0),h(null);try{typeof n=="function"?await n(!1):ia.warn("Stories functionality is not available - loadStories function not found")}catch(N){ia.error("Error loading stories:",N),h("Failed to load stories")}finally{l(!1),f.current=!1,d(!0)}}};!a&&!f.current&&typeof n=="function"&&w()},[n,a]);const F=p.useCallback(G6(w=>{typeof e=="function"?e(w):ia.warn("Story click handler not provided")},300),[e]),M=p.useCallback(w=>{if(!v.current)return;const N=300,P=v.current.scrollLeft;v.current.scrollTo({left:w==="right"?P+N:P-N,behavior:"smooth"})},[]),E=p.useCallback(w=>{g.current=w.touches[0].clientX,b.current=!0},[]),U=p.useCallback(w=>{b.current&&w.preventDefault()},[]),A=p.useCallback(w=>{if(!b.current)return;const N=w.changedTouches[0].clientX,P=g.current-N;Math.abs(P)>20&&(P>0?M("right"):M("left")),b.current=!1},[M]);p.useEffect(()=>{const w=v.current;if(w)return w.addEventListener("touchstart",E,{passive:!1}),w.addEventListener("touchmove",U,{passive:!1}),w.addEventListener("touchend",A),()=>{w.removeEventListener("touchstart",E),w.removeEventListener("touchmove",U),w.removeEventListener("touchend",A)}},[E,U,A]);const D=p.useMemo(()=>T.map(w=>{const N=w.userData&&typeof w.userData=="object"?w.userData:w.user&&typeof w.user=="object"?w.user:typeof w.user=="string"?{_id:w.user}:{};return(w._id==="coming-soon-video"||w._id==="coming-soon-image")&&(N.details=N.details||{},N.details.iAm=w._id==="coming-soon-video"?"man":"woman",N.gender=w._id==="coming-soon-video"?"male":"female"),r.jsx(Ku,{story:w,user:N,onClick:()=>F(w._id),hasUnviewedStories:typeof i=="function"&&w.user?i(typeof w.user=="string"?w.user:w.user._id):!1,mediaType:w.mediaType},w._id||`story-${Math.random()}`)}),[T,F,i]);return(c||o)&&!a?r.jsx("div",{className:xe.storiesCarouselContainer,children:r.jsxs("div",{className:xe.loadingContainer,children:[r.jsx("div",{className:xe.spinner}),r.jsx("p",{children:"Loading stories..."})]})}):u?r.jsx("div",{className:xe.storiesCarouselContainer,children:r.jsx("div",{className:xe.errorContainer,children:r.jsx("p",{children:u})})}):r.jsxs("div",{className:xe.storiesCarouselContainer,role:"region","aria-label":"Stories",children:[T.length>4&&r.jsx("button",{className:`${xe.carouselNavButton} ${xe.carouselNavButtonLeft}`,onClick:()=>M("left"),"aria-label":"Scroll stories left",children:"‹"}),r.jsx("div",{className:xe.storiesCarousel,ref:v,style:{overscrollBehavior:"contain"},children:D}),T.length>4&&r.jsx("button",{className:`${xe.carouselNavButton} ${xe.carouselNavButtonRight}`,onClick:()=>M("right"),"aria-label":"Scroll stories right",children:"›"})]})},K6=pt.memo(Y6),Il=Ze.create("StoryCreator"),$l=[{id:"gradient-1",name:"Sunset",style:"linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)"},{id:"gradient-2",name:"Ocean",style:"linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"},{id:"gradient-3",name:"Passion",style:"linear-gradient(135deg, #f6d365 0%, #fda085 100%)"},{id:"gradient-4",name:"Midnight",style:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)"},{id:"gradient-5",name:"Forest",style:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},{id:"gradient-6",name:"Berry",style:"linear-gradient(135deg, #c471f5 0%, #fa71cd 100%)"},{id:"gradient-7",name:"Dusk",style:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{id:"gradient-8",name:"Fire",style:"linear-gradient(135deg, #f83600 0%, #f9d423 100%)"}],J6=[{id:"font-1",name:"Classic",style:"'Helvetica', sans-serif"},{id:"font-2",name:"Elegant",style:"'Georgia', serif"},{id:"font-3",name:"Modern",style:"'Montserrat', sans-serif"},{id:"font-4",name:"Playful",style:"'Comic Sans MS', cursive"},{id:"font-5",name:"Bold",style:"'Impact', sans-serif"}],Q6=({onClose:e,onSubmit:t})=>{const{user:s}=Xt(),{createStory:n}=co(),{t:o}=Ht(),{isRTL:i}=ss(),[c,l]=p.useState(""),[u,h]=p.useState($l[0]),[a,d]=p.useState(J6[0]),[f,v]=p.useState(!1),[g,b]=p.useState(0),[$,T]=p.useState(""),[F,M]=p.useState("text"),[E,U]=p.useState(!1),A=R=>R.trim().toLowerCase().substring(0,20),D=()=>{const R=`story_submission_${A(c)}`;return localStorage.getItem(R)},w=()=>{const R=`story_submission_${A(c)}`;localStorage.setItem(R,Date.now().toString()),localStorage.setItem("lastStoryCreated",Date.now().toString()),setTimeout(()=>{try{localStorage.removeItem(R)}catch(j){Il.error("Failed to clean up submission record",j)}},1e4)},N=async()=>{if(E||f){Z.info(o("waitForStoryCreation")||"Story creation in progress...");return}if(!c.trim()){Z.error(o("addTextError")||"Please add some text to your story");return}if(!s){Z.error(o("loginRequired")||"Please log in to create stories");return}if(D()){Z.info("This story was already submitted. Please wait or create a different story.");return}if(localStorage.getItem("lastStoryCreated")){const j=parseInt(localStorage.getItem("lastStoryCreated"),10),S=Date.now()-j;if(S<5e3){const C=Math.ceil((5e3-S)/1e3);Z.info(`Please wait ${C} seconds before posting another story`);return}}w(),T(""),v(!0),U(!0),b(0);try{const j={content:c.trim(),text:c.trim(),backgroundStyle:u.style,backgroundColor:u.style,fontStyle:a.style,mediaType:"text",type:"text"},I=await n(j,P);if(I&&I.message&&I.message.includes("wait")&&!I.success){T(I.message),setTimeout(()=>e==null?void 0:e(),1500);return}I&&(I.success===!0||I._id||I.data&&I.data._id)?(Z.success("Story created successfully!"),t&&(I.data?t(I.data):(I._id,t(I))),e==null||e()):T((I==null?void 0:I.message)||(I==null?void 0:I.error)||"Failed to create story")}catch(j){Il.error("Error creating story:",j),T(j.message||o("somethingWentWrong")),Z.error(j.message||o("somethingWentWrong"))}finally{v(!1),U(!1)}},P=R=>{if(R&&typeof R=="number")b(R);else if(R&&R.total>0){const j=Math.round(R.loaded*100/R.total);b(j)}},x=p.useCallback(R=>({background:R.style}),[]),k=p.useCallback(R=>({fontFamily:R.style}),[]);return p.useEffect(()=>{const R=j=>{j.key==="Escape"&&!f&&!E&&(e==null||e())};return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)},[e,f,E]),r.jsxs("div",{className:`${xe.storyCreatorContainer} ${i?"rtl-layout":""}`,children:[r.jsx("div",{className:xe.storyCreatorOverlay,onClick:f||E?void 0:e}),r.jsxs("div",{className:xe.storyCreatorModal,children:[r.jsxs("div",{className:xe.storyCreatorHeader,children:[r.jsx("h2",{className:xe.storyCreatorTitle,children:o("createStory")}),r.jsx("button",{className:xe.storyCreatorCloseButton,onClick:f||E?void 0:e,disabled:f||E,"aria-label":"Close",children:r.jsx(Ts,{})})]}),r.jsxs("div",{className:xe.storyCreatorContent,children:[r.jsx("div",{className:xe.storyCreatorPreview,children:r.jsx("div",{className:xe.storyPreviewFrame,style:{...x(u),...k(a)},children:c?r.jsx("div",{className:xe.storyTextContent,children:c}):r.jsx("div",{className:xe.storyPlaceholder,children:o("typeSomething")})})}),r.jsxs("div",{className:xe.storyCreatorTabs,children:[r.jsxs("button",{className:`${xe.storyCreatorTab} ${F==="text"?xe.active:""}`,onClick:()=>M("text"),disabled:E||f,children:[r.jsx(Hm,{})," ",o("text")]}),r.jsxs("button",{className:`${xe.storyCreatorTab} ${F==="background"?xe.active:""}`,onClick:()=>M("background"),disabled:E||f,children:[r.jsx(Ea,{})," ",o("background")]})]}),F==="text"&&r.jsxs("div",{className:xe.storyCreatorTabContent,children:[r.jsx("textarea",{className:xe.storyCreatorInput,value:c,onChange:R=>l(R.target.value),placeholder:o("whatsOnYourMind"),maxLength:150,disabled:E||f}),r.jsxs("small",{className:xe.storyCreatorCharCount,children:[c.length,"/150"]})]}),F==="background"&&r.jsx("div",{className:xe.storyCreatorTabContent,children:r.jsx("div",{className:xe.storyCreatorBackgroundOptions,children:$l.map(R=>r.jsx("div",{className:`${xe.storyCreatorBackgroundOption} ${u.id===R.id?xe.selected:""}`,style:x(R),onClick:()=>{!E&&!f&&h(R)},title:R.name},R.id))})}),$&&r.jsx("div",{className:xe.errorMessage,children:$})]}),r.jsx("div",{className:xe.storyCreatorFooter,children:f?r.jsxs("div",{className:xe.uploadProgressContainer,children:[r.jsx("div",{className:xe.storyCreatorProgressContainer,children:r.jsx("div",{className:xe.storyCreatorProgressFill,style:{width:`${g}%`}})}),r.jsxs("span",{children:[g,"%"]})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{className:`${xe.storyCreatorButton} ${xe.storyCreatorOutlineButton}`,onClick:e,disabled:f||E,children:o("cancel")}),r.jsx("button",{className:`${xe.storyCreatorButton} ${xe.storyCreatorPrimaryButton}`,onClick:N,disabled:f||E||!c.trim(),children:E?r.jsxs(r.Fragment,{children:[r.jsx(Ws,{className:xe.spinner}),r.jsx("span",{children:o("creating")})]}):r.jsxs(r.Fragment,{children:[r.jsx(jt,{}),r.jsx("span",{children:o("createStory")})]})})]})})]})]})},X6=Ze.create("PrivateRoute"),lr=({children:e,useNavigateHook:t=!1})=>{const{user:s,isAuthenticated:n,loading:o,error:i}=Xt(),c=tr(),l=ps(),[u,h]=p.useState(!1);if(p.useEffect(()=>{if(i){h(!0);const a=setTimeout(()=>{h(!1)},3e3);return()=>clearTimeout(a)}},[i]),p.useEffect(()=>{t&&!o&&!n&&(X6.debug("Not authenticated, redirecting to login"),l("/login",{replace:!0,state:{from:c.pathname}}))},[n,o,l,c.pathname,t]),o)return r.jsxs("div",{className:"loading-container",children:[r.jsx("div",{className:"spinner"}),r.jsx("p",{className:"loading-text",children:"Loading..."})]});if(i||u){const a=typeof i=="object"&&i!==null?i.message||JSON.stringify(i):String(i||"Authentication error");return r.jsx("div",{className:"auth-error",children:r.jsxs("div",{className:"auth-error-content",children:[r.jsx(Bt,{className:"auth-error-icon"}),r.jsx("h3",{children:"Authentication Error"}),r.jsx("p",{children:a}),r.jsx("button",{onClick:()=>l("/login"),className:"btn btn-primary",children:"Go to Login"})]})})}return!t&&!n?r.jsx(uh,{to:"/login",state:{from:c.pathname},replace:!0}):n?e:null},Tr=({title:e,description:t,image:s="/images/flirtss-social-share.jpg",schema:n,meta:o={},canonicalUrl:i})=>{const c=tr(),{language:l,isRTL:u}=ss(),h="https://flirtss.com",a=i||`${h}${c.pathname}`,d="Flirtss",f=e?`${e} | ${d}`:d,g=t||"Find meaningful relationships and make genuine connections with singles in your area.",b=s.startsWith("http")?s:`${h}${s}`;return r.jsx(Jh,{htmlAttributes:{lang:l,dir:u?"rtl":"ltr"},title:f,meta:[{name:"description",content:g},{property:"og:title",content:f},{property:"og:description",content:g},{property:"og:url",content:a},{property:"og:type",content:"website"},{property:"og:image",content:b},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:f},{name:"twitter:description",content:g},{name:"twitter:image",content:b},...Object.entries(o).map(([$,T])=>({name:$,content:T}))],link:[{rel:"canonical",href:a}],children:n&&r.jsx("script",{type:"application/ld+json",children:JSON.stringify(n)})})},Ju=Ze.create("VerificationBanner"),Z6=()=>{try{return Xt()?r.jsx(ek,{}):null}catch(e){return Ju.warn("Auth context not available for VerificationBanner:",e.message),null}},ek=()=>{const{user:e,resendVerificationEmail:t}=Xt(),[s,n]=p.useState(!0),[o,i]=p.useState(!1),[c,l]=p.useState(0),{t:u}=Ht();p.useEffect(()=>{const d=localStorage.getItem("verificationBannerDismissed");if(d){const f=new Date(d),g=new Date().getTime()-f.getTime(),b=24*60*60*1e3;g<b?n(!1):(localStorage.removeItem("verificationBannerDismissed"),n(!0))}},[]),p.useEffect(()=>{let d;return c>0&&(d=setInterval(()=>{l(f=>f-1)},6e4)),()=>clearInterval(d)},[c]);const h=async()=>{i(!0);try{await t()&&l(60)}catch(d){Ju.error("Error resending verification email:",d)}finally{i(!1)}},a=()=>{n(!1),localStorage.setItem("verificationBannerDismissed",new Date().toISOString())};return!e||e.isVerified||!s?null:r.jsxs("div",{className:"verification-banner",children:[r.jsx("div",{className:"container",children:r.jsxs("div",{className:"banner-content",children:[r.jsx(Bt,{className:"banner-icon"}),r.jsx("p",{children:u("verificationNeeded")||"Your email is not verified. Please verify your email address to unlock all features."}),r.jsxs("div",{className:"banner-actions",children:[r.jsx("button",{className:"resend-btn",onClick:h,disabled:o||c>0,"aria-label":u("resendVerificationEmail")||"Resend verification email",children:o?r.jsx(r.Fragment,{children:u("sending")||"Sending..."}):c>0?u("resendEmailCooldown",{cooldown:c})||`Resend Email (${c}m)`:r.jsxs(r.Fragment,{children:[r.jsx(gn,{})," ",u("resendEmail")||"Resend Email"]})}),r.jsx("button",{className:"dismiss-btn",onClick:a,"aria-label":u("dismiss")||"Dismiss banner",children:r.jsx(Ts,{})})]})]})}),r.jsx("style",{jsx:!0,children:`
        .verification-banner {
          background-color: #fef08a;
          color: #92400e;
          padding: 12px 20px;
          text-align: center;
          position: absolute;
          top: 64px;
          left: 0;
          width: 100%;
          z-index: 100;
          border-bottom: 1px solid #fcd34d;
        }

        .container {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          justify-content: center;
          align-items: center;
        }

        .banner-content {
          display: flex;
          align-items: center;
          gap: 16px;
        }

        .banner-icon {
          font-size: 20px;
        }

        .banner-actions {
          display: flex;
          gap: 10px;
        }

        .resend-btn,
        .dismiss-btn {
          background: none;
          border: none;
          color: #92400e;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          transition: background-color 0.2s ease;
        }

        .resend-btn:hover,
        .dismiss-btn:hover {
          background-color: rgba(255, 255, 255, 0.2);
        }

        .resend-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        @media (max-width: 768px) {
          .banner-content {
            flex-direction: column;
            text-align: center;
          }

          .banner-actions {
            flex-direction: column;
          }
        }
      `})]})},tk="_modernFooter_19xca_4",sk="_footerContent_19xca_19",nk="_footerLogo_19xca_40",rk="_footerLinks_19xca_51",ok="_footerSocial_19xca_108",ik="_socialIcon_19xca_114",ak="_footerBottom_19xca_146",bn={modernFooter:tk,footerContent:sk,footerLogo:nk,footerLinks:rk,footerSocial:ok,socialIcon:ik,footerBottom:ak},ck=()=>{const{t:e}=Ht();return r.jsxs("footer",{className:bn.modernFooter,children:[" ",r.jsxs("div",{className:`container ${bn.footerContent}`,children:[" ",r.jsx(yt,{to:"/",className:bn.footerLogo,children:"Mandarin"})," ",r.jsxs("div",{className:bn.footerLinks,children:[" ",r.jsx(yt,{to:"/about",children:e("aboutUs","About Us")}),r.jsx(yt,{to:"/safety",children:e("safety","Safety")})," ",r.jsx(yt,{to:"/support",children:e("contactSupport","Support")}),r.jsx(yt,{to:"/terms",children:e("termsOfService","Terms")}),r.jsx(yt,{to:"/privacy",children:e("privacyPolicy","Privacy")})," "]}),r.jsxs("div",{className:bn.footerSocial,children:[" ",r.jsx("a",{href:"#","aria-label":"Facebook",className:bn.socialIcon,children:"FB"}),r.jsx("a",{href:"#","aria-label":"Instagram",className:bn.socialIcon,children:"IG"}),r.jsx("a",{href:"#","aria-label":"Twitter",className:bn.socialIcon,children:"TW"})]})]}),r.jsxs("div",{className:bn.footerBottom,children:[" ","© ",new Date().getFullYear()," Mandarin."," ",e("allRightsReserved","All rights reserved.")]})]})},lk=Ze.create("ModalContainer"),dk=()=>{const{chatRecipient:e,isChatOpen:t,closeChat:s,profileModalUserId:n,isProfileModalOpen:o,closeProfileModal:i}=uu(),c=t||o;return pt.useEffect(()=>{c&&lk.debug("Active modals:",{chat:t?(e==null?void 0:e.nickname)||(e==null?void 0:e._id):!1,profile:o?n:!1})},[t,o,e,n,c]),r.jsxs(r.Fragment,{children:[t&&e&&r.jsx(Ni,{recipient:e,isOpen:t,onClose:s}),r.jsx(ki,{userId:n,isOpen:o,onClose:i})]})},uk=pt.memo(dk);function hk({children:e}){const{isAuthenticated:t}=Xt();return Q1(),e}const fk="_loginContainer_19osi_2",gk="_gradientBar_19osi_18",pk="_pageTitle_19osi_25",mk="_subtitle_19osi_41",yk="_formGroup_19osi_52",vk="_formLabel_19osi_56",_k="_inputWrapper_19osi_67",wk="_inputIcon_19osi_73",bk="_input_19osi_67",xk="_errorMessage_19osi_103",Sk="_togglePassword_19osi_112",Ck="_rememberForgotWrapper_19osi_134",kk="_checkboxLabel_19osi_141",Nk="_checkbox_19osi_141",Ek="_forgotPassword_19osi_160",Tk="_submitButton_19osi_172",Ak="_spinner_19osi_200",jk="_divider_19osi_214",Ik="_socialButton_19osi_247",$k="_googleIcon_19osi_281",Pk="_facebookIcon_19osi_285",Rk="_footer_19osi_289",Mk="_footerLink_19osi_300",Lk="_alert_19osi_312",Ok="_alertDanger_19osi_321",Lt={loginContainer:fk,gradientBar:gk,pageTitle:pk,subtitle:mk,formGroup:yk,formLabel:vk,inputWrapper:_k,inputIcon:wk,input:bk,errorMessage:xk,togglePassword:Sk,rememberForgotWrapper:Ck,checkboxLabel:kk,checkbox:Nk,forgotPassword:Ek,submitButton:Tk,spinner:Ak,divider:jk,socialButton:Ik,googleIcon:$k,facebookIcon:Pk,footer:Rk,footerLink:Mk,alert:Lk,alertDanger:Ok},Fk=Dn("Login"),Dk=()=>{var D;const[e,t]=p.useState({email:"",password:""}),[s,n]=p.useState(!1),[o,i]=p.useState(!1),[c,l]=p.useState({}),[u,h]=p.useState(!1),{login:a,error:d,clearError:f,isAuthenticated:v}=Xt(),{t:g}=Ht(),{isRTL:b}=ss(),$=ps(),T=tr(),F=((D=T.state)==null?void 0:D.from)||"/dashboard";p.useEffect(()=>{v&&$(F)},[v,$,F]),p.useEffect(()=>{var w;(w=T.state)!=null&&w.email&&t(N=>({...N,email:T.state.email})),f()},[]),p.useEffect(()=>{d&&(l({general:d}),h(!1))},[d]);const M=()=>{const w={},N=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return e.email?N.test(e.email)||(w.email=g("validationError")):w.email=g("email")+" "+g("validationError"),e.password?e.password.length<6&&(w.password=g("passwordRequirements")):w.password=g("password")+" "+g("validationError"),w},E=w=>{const{name:N,value:P}=w.target;t({...e,[N]:P}),c[N]&&l({...c,[N]:""})},U=async w=>{w.preventDefault();const N=M();if(Object.keys(N).length>0){l(N);return}l({}),h(!0);try{await a({email:e.email,password:e.password})}catch(P){Fk.error("Login error",P)}},A=()=>{n(!s)};return r.jsx("div",{className:`auth-page login-page d-flex min-vh-100 bg-light-subtle ${b?"rtl-layout":""}`,children:r.jsxs("div",{className:Lt.loginContainer,children:[r.jsx("div",{className:Lt.gradientBar}),r.jsxs("div",{className:"text-center mb-4",children:[r.jsx(yt,{to:"/",className:Lt.pageTitle,children:"Mandarin"}),r.jsx("p",{className:Lt.subtitle,children:g("signIn")})]}),c.general&&r.jsxs("div",{className:`${Lt.alert} ${Lt.alertDanger}`,children:[r.jsx(Bt,{}),r.jsx("p",{className:"mb-0",children:c.general})]}),r.jsxs("form",{onSubmit:U,children:[r.jsxs("div",{className:Lt.formGroup,children:[r.jsx("label",{className:Lt.formLabel,htmlFor:"email",children:g("email")}),r.jsxs("div",{className:Lt.inputWrapper,children:[r.jsx(gn,{className:Lt.inputIcon}),r.jsx("input",{type:"email",id:"email",name:"email",className:Lt.input,placeholder:g("email"),value:e.email,onChange:E,disabled:u,autoComplete:"email"})]}),c.email&&r.jsxs("p",{className:Lt.errorMessage,children:[r.jsx(Bt,{}),c.email]})]}),r.jsxs("div",{className:Lt.formGroup,children:[r.jsx("label",{className:Lt.formLabel,htmlFor:"password",children:g("password")}),r.jsxs("div",{className:Lt.inputWrapper,children:[r.jsx(vs,{className:Lt.inputIcon}),r.jsx("input",{type:s?"text":"password",id:"password",name:"password",className:Lt.input,placeholder:g("password"),value:e.password,onChange:E,disabled:u,autoComplete:"current-password"}),r.jsx("button",{type:"button",className:Lt.togglePassword,onClick:A,tabIndex:-1,children:s?r.jsx(tu,{}):r.jsx(tc,{})})]}),c.password&&r.jsxs("p",{className:Lt.errorMessage,children:[r.jsx(Bt,{}),c.password]})]}),r.jsxs("div",{className:Lt.rememberForgotWrapper,children:[r.jsxs("label",{className:Lt.checkboxLabel,children:[r.jsx("input",{type:"checkbox",className:Lt.checkbox,checked:o,onChange:()=>i(!o),disabled:u}),g("rememberMe")]}),r.jsx(yt,{to:"/forgot-password",className:Lt.forgotPassword,children:g("forgotPassword")})]}),r.jsx("button",{type:"submit",className:Lt.submitButton,disabled:u,children:u?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:Lt.spinner}),r.jsx("span",{children:g("loading")})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{children:g("signIn")}),r.jsx(Jr,{})]})})]}),r.jsx("div",{className:Lt.divider,children:g("or")}),r.jsxs("div",{children:[r.jsxs("button",{className:Lt.socialButton,children:[r.jsx(Yd,{className:Lt.googleIcon}),r.jsxs("span",{children:[g("signInWith")," Google"]})]}),r.jsxs("button",{className:Lt.socialButton,children:[r.jsx(Gd,{className:Lt.facebookIcon}),r.jsxs("span",{children:[g("signInWith")," Facebook"]})]})]}),r.jsxs("div",{className:Lt.footer,children:[g("dontHaveAccount")," ",r.jsx(yt,{to:"/register",className:Lt.footerLink,children:g("signUp")})]})]})})},Bk="_registerContainer_7o157_3",Uk="_gradientBar_7o157_19",qk="_pageTitle_7o157_31",zk="_subtitle_7o157_47",Hk="_progressContainer_7o157_58",Vk="_progressSteps_7o157_62",Wk="_progressLine_7o157_71",Gk="_progressStep_7o157_62",Yk="_stepCircle_7o157_92",Kk="_stepLabel_7o157_114",Jk="_active_7o157_124",Qk="_stepHeader_7o157_140",Xk="_formGroup_7o157_165",Zk="_formLabel_7o157_169",e5="_inputWrapper_7o157_185",t5="_inputIcon_7o157_191",s5="_input_7o157_185",n5="_errorMessage_7o157_233",r5="_helpText_7o157_248",o5="_togglePassword_7o157_263",i5="_formActions_7o157_291",a5="_button_7o157_297",c5="_buttonOutline_7o157_310",l5="_buttonPrimary_7o157_331",d5="_spinner_7o157_353",u5="_alert_7o157_367",h5="_alertDanger_7o157_376",f5="_tagContainer_7o157_385",g5="_tag_7o157_385",p5="_selected_7o157_418",m5="_tagCheck_7o157_430",y5="_checkboxGroup_7o157_434",v5="_checkboxLabel_7o157_438",_5="_checkboxLabelError_7o157_457",w5="_checkbox_7o157_434",b5="_divider_7o157_467",x5="_socialButtons_7o157_511",S5="_socialButton_7o157_511",C5="_googleIcon_7o157_554",k5="_facebookIcon_7o157_558",N5="_footer_7o157_562",E5="_footerLink_7o157_573",T5="_photoUploadContainer_7o157_585",A5="_uploadProgressContainer_7o157_592",j5="_uploadProgressBar_7o157_607",I5="_uploadProgressFill_7o157_620",$5="_uploadProgressText_7o157_627",P5="_photoUploadArea_7o157_638",R5="_hasImage_7o157_665",M5="_photoUploadIcon_7o157_670",L5="_photoUploadText_7o157_676",O5="_profileImagePreview_7o157_687",F5="_uploadGuidelines_7o157_693",D5="_photoActions_7o157_704",B5="_photoActionButton_7o157_711",U5="_changePhotoButton_7o157_722",q5="_removePhotoButton_7o157_726",le={registerContainer:Bk,gradientBar:Uk,pageTitle:qk,subtitle:zk,progressContainer:Hk,progressSteps:Vk,progressLine:Wk,progressStep:Gk,stepCircle:Yk,stepLabel:Kk,active:Jk,stepHeader:Qk,formGroup:Xk,formLabel:Zk,inputWrapper:e5,inputIcon:t5,input:s5,errorMessage:n5,helpText:r5,togglePassword:o5,formActions:i5,button:a5,buttonOutline:c5,buttonPrimary:l5,spinner:d5,alert:u5,alertDanger:h5,tagContainer:f5,tag:g5,selected:p5,tagCheck:m5,checkboxGroup:y5,checkboxLabel:v5,checkboxLabelError:_5,checkbox:w5,divider:b5,socialButtons:x5,socialButton:S5,googleIcon:C5,facebookIcon:k5,footer:N5,footerLink:E5,photoUploadContainer:T5,uploadProgressContainer:A5,uploadProgressBar:j5,uploadProgressFill:I5,uploadProgressText:$5,photoUploadArea:P5,hasImage:R5,photoUploadIcon:M5,photoUploadText:L5,profileImagePreview:O5,uploadGuidelines:F5,photoActions:D5,photoActionButton:B5,changePhotoButton:U5,removePhotoButton:q5},$n=Dn("Register"),z5=()=>{var ye;const{t:e}=Ht(),[t,s]=p.useState(1),[n,o]=p.useState({nickname:"",email:"",password:"",confirmPassword:"",dateOfBirth:"",location:"",interests:[],lookingFor:[],agreeTerms:!1,agreePrivacy:!1,newsletter:!1,iAm:"",intoTags:[],turnOns:[],maritalStatus:"",profilePhoto:null}),[i,c]=p.useState(null),l=p.useRef(null),[u,h]=p.useState(!1),[a,d]=p.useState({}),[f,v]=p.useState(!1),[g,b]=p.useState(!1),[$,T]=p.useState(!1),[F,M]=p.useState([]),{isRTL:E}=ss(),{register:U,error:A,isAuthenticated:D}=Xt(),w=ps(),N=tr(),{uploadPhoto:P,isUploading:x,uploadProgress:k,pendingUploads:R}=nr(),j=["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art","Reading","Gaming","Photography","Dancing","Cooking","Sports"],I=["woman","man","couple"],S=["women","men","couples"],C=["Meetups","Power play","Threesomes","Online fun","Hot chat","Photo sharing","Camera chat","Cuckold","Golden showers","Strap-on","Forced bi","Erotic domination","Humiliation","Crossdressing","Worship","Foot fetish","Oral","From behind","Role-play","Toys","Massages","Foreplay","Casual meetups","Fantasy fulfillment","Bizarre","Education","Experiences","Tantra"],G=["Sexy ass","Dirty talk","Aggressive","Slow and gentle","In a public place","Pampering","Sexy clothing","Leather/latex clothing","Watching porn","Fit body","Bathing together","Erotic writing","Eye contact","Being pampered","Sexy legs","Teasing","Pushing boundaries"],V=["Single","Married","Divorced","Separated","Widowed","In a relationship","It's complicated","Open relationship","Polyamorous"],L=["Tel Aviv, Israel","Jerusalem, Israel","Haifa, Israel","Eilat, Israel","Beer Sheva, Israel","Netanya, Israel","Herzliya, Israel","Ashdod, Israel","Ashkelon, Israel","Tiberias, Israel","Ramat Gan, Israel","Rishon LeZion, Israel","Petah Tikva, Israel","Holon, Israel","Bat Yam, Israel","Rehovot, Israel","Kfar Saba, Israel","Raanana, Israel","Nahariya, Israel","Acre, Israel"],X=oe=>{if(!oe)return 0;const fe=new Date(oe),ie=new Date;let te=ie.getFullYear()-fe.getFullYear();const Y=ie.getMonth()-fe.getMonth();return(Y<0||Y===0&&ie.getDate()<fe.getDate())&&te--,te};p.useEffect(()=>{var oe;D&&w("/dashboard"),(oe=N.state)!=null&&oe.email&&o(fe=>({...fe,email:N.state.email}))},[D,w,(ye=N.state)==null?void 0:ye.email]),p.useEffect(()=>{R.length>0&&D&&(Z.info(e("pendingUploadsNotice","You have {{count}} photos pending upload that will complete when you're online.",{count:R.length})),$n.debug(`Found ${R.length} pending uploads in queue`))},[R.length,D,e]),p.useEffect(()=>{if(A){const oe=typeof A=="string"?A:e("generalError","An unexpected error occurred.");d(ie=>({...ie,general:oe})),v(!1);const fe=document.querySelector(`.${le.alertDanger}`);fe&&fe.scrollIntoView({behavior:"smooth",block:"start"})}},[A,e]);const q=p.useCallback(oe=>{const fe={},ie=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(oe===1&&(n.nickname.trim()?n.nickname.length<3?fe.nickname=e("nicknameTooShort","Nickname must be at least 3 characters"):n.nickname.length>50?fe.nickname=e("nicknameTooLong","Nickname cannot exceed 50 characters"):/^[\p{L}\p{N}_]+$/u.test(n.nickname)||(fe.nickname=e("nicknameInvalid","Nickname can contain letters in any language, numbers, and underscores")):fe.nickname=e("nicknameRequired","Nickname is required"),n.email?ie.test(n.email.toLowerCase())||(fe.email=e("invalidEmail","Please enter a valid email address")):fe.email=e("emailRequired","Email is required"),n.password?n.password.length<8?fe.password=e("passwordLengthError","Password must be at least 8 characters"):/(?=.*[a-z])/.test(n.password)?/(?=.*[A-Z])/.test(n.password)?/(?=.*\d)/.test(n.password)?/(?=.*[@$!%*?&])/.test(n.password)||(fe.password=e("passwordSpecialError","Password must include at least one special character (@$!%*?&)")):fe.password=e("passwordNumberError","Password must include at least one number"):fe.password=e("passwordUppercaseError","Password must include at least one uppercase letter"):fe.password=e("passwordLowercaseError","Password must include at least one lowercase letter"):fe.password=e("passwordRequired","Password is required"),n.password!==n.confirmPassword&&(fe.confirmPassword=e("passwordMatchError","Passwords do not match"))),oe===2){if(!n.dateOfBirth)fe.dateOfBirth=e("dateOfBirthRequired","Date of birth is required");else{const te=X(n.dateOfBirth);te<18?fe.dateOfBirth=e("ageRestriction","You must be at least 18 years old"):te>120&&(fe.dateOfBirth=e("invalidDateOfBirth","Please enter a valid date of birth"))}n.iAm||(fe.iAm=e("selectIdentity","Please select who you are")),n.location.trim()?n.location.length<2?fe.location=e("locationTooShort","Location must be at least 2 characters"):n.location.length>100&&(fe.location=e("locationTooLong","Location cannot exceed 100 characters")):fe.location=e("locationRequired","Location is required")}return oe===3&&(n.profilePhoto||(fe.profilePhoto=e("profilePhotoRequired","Please upload a profile photo"))),oe===4&&(n.maritalStatus||(fe.maritalStatus=e("maritalStatusRequired","Please select your marital status")),n.lookingFor.length===0?fe.lookingFor=e("selectLookingFor","Please select what you're looking for"):n.lookingFor.length>3&&(fe.lookingFor=e("tooManyLookingFor","Please select no more than 3 options")),n.intoTags.length>20&&(fe.intoTags=e("tooManyIntoTags","Please select no more than 20 'I'm into' tags")),n.turnOns.length>20&&(fe.turnOns=e("tooManyTurnOns","Please select no more than 20 'Turn ons' tags")),n.interests.length===0?fe.interests=e("interestsRequired","Please select at least one interest"):n.interests.length>10&&(fe.interests=e("tooManyInterests","Please select no more than 10 interests")),n.agreeTerms||(fe.agreeTerms=e("termsRequired","You must agree to the Terms of Service")),n.agreePrivacy||(fe.agreePrivacy=e("privacyRequired","You must agree to the Privacy Policy"))),fe},[n,e]),z=oe=>{const{name:fe,value:ie,type:te,checked:Y}=oe.target;o(_=>({..._,[fe]:te==="checkbox"?Y:ie})),a[fe]&&d(_=>({..._,[fe]:""}))},K=oe=>{const fe=oe.target.value;if(o({...n,location:fe}),a.location&&d({...a,location:""}),fe.length>1){const ie=L.filter(te=>te.toLowerCase().includes(fe.toLowerCase()));M(ie)}else M([])},W=()=>{T(!0);const oe=q(t);if(Object.keys(oe).length>0){d(oe);const fe=document.querySelector(`.${le.errorMessage}`);fe&&fe.scrollIntoView({behavior:"smooth",block:"start"});return}d({}),s(t+1),T(!1),window.scrollTo({top:0,behavior:"smooth"})},H=()=>{s(t-1),d({}),T(!1),window.scrollTo({top:0,behavior:"smooth"})},ne=oe=>{o(fe=>{const ie=fe.interests||[],te=ie.includes(oe)?ie.filter(Y=>Y!==oe):[...ie,oe];return te.length>10?(Z.warning(e("tooManyInterests","Please select no more than 10 interests")),fe):(a.interests&&te.length>0&&d({...a,interests:""}),{...fe,interests:te})})},Q=oe=>{o(fe=>{const ie=fe.lookingFor||[],te=ie.includes(oe)?ie.filter(Y=>Y!==oe):[...ie,oe];return te.length>3?(Z.warning(e("tooManyLookingFor","Please select no more than 3 options")),fe):(a.lookingFor&&te.length>0&&d({...a,lookingFor:""}),{...fe,lookingFor:te})})},he=oe=>{o(fe=>({...fe,iAm:fe.iAm===oe?"":oe})),a.iAm&&oe&&d({...a,iAm:""})},re=oe=>{o(fe=>{const ie=fe.intoTags||[],te=ie.includes(oe)?ie.filter(Y=>Y!==oe):[...ie,oe];return te.length>20?(Z.warning(e("tooManyIntoTags","Please select no more than 20 'I'm into' tags")),fe):(a.intoTags&&d({...a,intoTags:""}),{...fe,intoTags:te})})},_e=oe=>{o(fe=>{const ie=fe.turnOns||[],te=ie.includes(oe)?ie.filter(Y=>Y!==oe):[...ie,oe];return te.length>20?(Z.warning(e("tooManyTurnOns","Please select no more than 20 'Turn ons' tags")),fe):(a.turnOns&&d({...a,turnOns:""}),{...fe,turnOns:te})})},ke=oe=>{o({...n,maritalStatus:oe.target.value}),a.maritalStatus&&d({...a,maritalStatus:""})},Be=async oe=>{const fe=oe.target.files[0];if(!fe)return;if(!["image/jpeg","image/png","image/jpg"].includes(fe.type)){Z.error(e("uploadTypeMismatch","Please upload a valid image file (JPEG, JPG or PNG)"));return}if(fe.size>5*1024*1024){Z.error(e("uploadSizeLimitExceeded","Image size should be less than 5MB"));return}try{fe.size>2*1024*1024&&b(!0),o({...n,profilePhoto:fe});const te=new FileReader;te.onloadend=()=>{c(te.result),b(!1)},te.readAsDataURL(fe),a.profilePhoto&&d({...a,profilePhoto:""}),$n.debug(`Selected photo: ${fe.name}, size: ${(fe.size/1024/1024).toFixed(2)}MB`)}catch(te){b(!1),$n.error("Error processing photo:",te),Z.error(e("photoProcessingError","Error processing photo"))}},Oe=()=>{o({...n,profilePhoto:null}),c(null),b(!1),l.current&&(l.current.value="")},Se=()=>{l.current&&l.current.click()},Le=async oe=>{oe==null||oe.preventDefault();const fe=q(4);if(Object.keys(fe).length>0){d(fe);const ie=document.querySelector(`.${le.errorMessage}`);ie&&ie.scrollIntoView({behavior:"smooth",block:"center"});return}!navigator.onLine&&n.profilePhoto&&Z.info(e("offlinePhotoUploadWarn","You are currently offline. Your profile will be created, and your photo will upload automatically when you reconnect.")),d({}),v(!0),b(!1);try{let ie="";n.iAm.toLowerCase()==="woman"?ie="female":n.iAm.toLowerCase()==="man"?ie="male":n.iAm.toLowerCase()==="couple"&&(ie="other");let te="FREE";n.iAm.toLowerCase()==="woman"?te="FEMALE":n.iAm.toLowerCase()==="couple"&&(te="COUPLE");const Y={nickname:n.nickname.trim(),email:n.email.trim().toLowerCase(),password:n.password,accountTier:te,isCouple:n.iAm.toLowerCase()==="couple",details:{age:X(n.dateOfBirth),gender:ie,location:n.location.trim(),bio:"",interests:n.interests,iAm:n.iAm,lookingFor:n.lookingFor,intoTags:n.intoTags,turnOns:n.turnOns,maritalStatus:n.maritalStatus,dateOfBirth:n.dateOfBirth}},_=await U(Y);if(_&&_.token){if(n.profilePhoto instanceof File)try{const m=await P(n.profilePhoto,"public",null,!0,{isNewRegistration:!0,compressImage:!0,addToQueueOnFailure:!0,compressionOptions:{maxSizeMB:1,maxWidthOrHeight:1920}});m?m.queued?(Z.info(e("photoQueuedUpload","Profile photo will be uploaded when you're online")),$n.debug("Profile photo queued for upload:",m)):$n.debug("Profile photo uploaded successfully via hook:",m):($n.error("Photo upload returned no result"),Z.error(e("photoUploadFailed","Failed to upload profile photo")))}catch(m){$n.error("Error uploading photo via hook:",m),document.visibilityState==="visible"&&m.message&&!m.message.includes("success")&&Z.error(e("photoUploadFailed","Failed to upload profile photo:")+" "+(m.message||""))}Z.success(e("registerSuccess","Welcome to Mandarin! Your account has been created successfully.")),setTimeout(()=>{w("/dashboard")},800)}}catch(ie){$n.error("Registration error caught in component:",ie),!a.general&&!A&&d(Y=>({...Y,general:ie.message||e("generalError","An unexpected error occurred. Please try again.")}));const te=document.querySelector(`.${le.errorMessage}, .${le.alertDanger}`);te&&te.scrollIntoView({behavior:"smooth",block:"start"})}finally{v(!1)}},Me=()=>{h(!u)},He=()=>r.jsx("div",{className:le.progressContainer,children:r.jsxs("div",{className:le.progressSteps,children:[r.jsxs("div",{className:`${le.progressStep} ${t>=1?le.active:""}`,children:[r.jsx("div",{className:le.stepCircle,children:t>1?r.jsx(jt,{}):1}),r.jsx("span",{className:le.stepLabel,children:e("accountStep","Account")})]}),r.jsx("div",{className:le.progressLine}),r.jsxs("div",{className:`${le.progressStep} ${t>=2?le.active:""}`,children:[r.jsx("div",{className:le.stepCircle,children:t>2?r.jsx(jt,{}):2}),r.jsx("span",{className:le.stepLabel,children:e("profileStep","Profile")})]}),r.jsx("div",{className:le.progressLine}),r.jsxs("div",{className:`${le.progressStep} ${t>=3?le.active:""}`,children:[r.jsx("div",{className:le.stepCircle,children:t>3?r.jsx(jt,{}):3}),r.jsx("span",{className:le.stepLabel,children:e("photoStep","Photo")})]}),r.jsx("div",{className:le.progressLine}),r.jsxs("div",{className:`${le.progressStep} ${t>=4?le.active:""}`,children:[r.jsx("div",{className:le.stepCircle,children:t>4?r.jsx(jt,{}):4}),r.jsx("span",{className:le.stepLabel,children:e("preferencesStep","Preferences")})]})]})}),ut=()=>r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:le.stepHeader,children:[r.jsx("h3",{children:e("createAccount","Create Your Account")}),r.jsx("p",{children:e("enterBasicInfo","Enter your basic information")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,htmlFor:"nickname",children:e("nickname","Nickname")}),r.jsxs("div",{className:le.inputWrapper,children:[r.jsx(Qr,{className:le.inputIcon}),r.jsx("input",{type:"text",id:"nickname",name:"nickname",placeholder:e("chooseNickname","Choose a nickname"),className:le.input,value:n.nickname,onChange:z,maxLength:50,autoComplete:"nickname"})]}),a.nickname?r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.nickname]}):r.jsx("p",{className:le.helpText,children:e("nicknameHelp","Your public display name (can contain letters, numbers, and underscores)")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,htmlFor:"email",children:e("emailAddress","Email Address")}),r.jsxs("div",{className:le.inputWrapper,children:[r.jsx(gn,{className:le.inputIcon}),r.jsx("input",{type:"email",id:"email",name:"email",placeholder:e("enterEmail","Enter your email"),className:le.input,value:n.email,onChange:z,autoComplete:"username"})]}),a.email?r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.email]}):r.jsx("p",{className:le.helpText,children:e("emailHelp","We'll never share your email with anyone else")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,htmlFor:"password",children:e("password","Password")}),r.jsxs("div",{className:le.inputWrapper,children:[r.jsx(vs,{className:le.inputIcon}),r.jsx("input",{type:u?"text":"password",id:"password",name:"password",placeholder:e("createPassword","Create a password"),className:le.input,value:n.password,onChange:z,autoComplete:"new-password"}),r.jsx("button",{type:"button",className:le.togglePassword,onClick:Me,tabIndex:-1,"aria-label":u?e("hidePassword","Hide password"):e("showPassword","Show password"),children:u?r.jsx(tu,{}):r.jsx(tc,{})})]}),a.password?r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.password]}):r.jsx("p",{className:le.helpText,children:e("passwordHelp","Must be at least 8 characters with uppercase, lowercase, number, and special character")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,htmlFor:"confirmPassword",children:e("confirmPassword","Confirm Password")}),r.jsxs("div",{className:le.inputWrapper,children:[r.jsx(vs,{className:le.inputIcon}),r.jsx("input",{type:u?"text":"password",id:"confirmPassword",name:"confirmPassword",placeholder:e("confirmPassword","Confirm password"),className:le.input,value:n.confirmPassword,onChange:z,autoComplete:"new-password"})]}),a.confirmPassword&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.confirmPassword]})]}),r.jsxs("div",{className:le.formActions,children:[r.jsx("div",{}),r.jsxs("button",{type:"button",className:`${le.button} ${le.buttonPrimary}`,onClick:W,disabled:f,children:[e("continue","Continue")," ",r.jsx(Jr,{})]})]})]}),tt=()=>r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:le.stepHeader,children:[r.jsx("h3",{children:e("tellAboutYourself","Tell Us About Yourself")}),r.jsx("p",{children:e("addBasicProfileDetails","Add some basic profile details")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,htmlFor:"dateOfBirth",children:e("dateOfBirth","Date of Birth")}),r.jsxs("div",{className:le.inputWrapper,children:[r.jsx(Kd,{className:le.inputIcon}),r.jsx("input",{type:"date",id:"dateOfBirth",name:"dateOfBirth",className:le.input,value:n.dateOfBirth,onChange:z,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0]})]}),a.dateOfBirth?r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.dateOfBirth]}):r.jsx("p",{className:le.helpText,children:e("dateOfBirthHelp","You must be at least 18 years old to use this service")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,children:e("iAmA","I am a")}),r.jsx("div",{className:le.tagContainer,children:I.map(oe=>r.jsxs("button",{type:"button",className:`${le.tag} ${n.iAm===oe?le.selected:""}`,onClick:()=>he(oe),children:[e(oe)||oe.charAt(0).toUpperCase()+oe.slice(1),n.iAm===oe&&r.jsx(jt,{className:le.tagCheck})]},oe))}),a.iAm&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.iAm]})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,htmlFor:"location",children:e("location","Location")}),r.jsxs("div",{className:le.inputWrapper,children:[r.jsx(to,{className:le.inputIcon}),r.jsx("input",{type:"text",id:"location",name:"location",placeholder:e("locationPlaceholder","City, Country"),className:le.input,value:n.location,onChange:K,maxLength:100,list:"location-suggestions"}),r.jsx("datalist",{id:"location-suggestions",children:L.map((oe,fe)=>r.jsx("option",{value:oe},fe))})]}),a.location?r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.location]}):r.jsx("p",{className:le.helpText,children:e("locationHelp","Your general location (e.g., Tel Aviv, Israel)")})]}),r.jsxs("div",{className:le.formActions,children:[r.jsxs("button",{type:"button",className:`${le.button} ${le.buttonOutline}`,onClick:H,children:[r.jsx(wr,{})," ",e("back","Back")]}),r.jsxs("button",{type:"button",className:`${le.button} ${le.buttonPrimary}`,onClick:W,disabled:f,children:[e("continue","Continue")," ",r.jsx(Jr,{})]})]})]}),we=()=>r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:le.stepHeader,children:[r.jsx("h3",{children:e("uploadYourPhoto","Upload Your Photo")}),r.jsx("p",{children:e("improveVisibility","Add a profile photo to improve your visibility")})]}),r.jsxs("div",{className:le.photoUploadContainer,children:[x?r.jsxs("div",{className:le.uploadProgressContainer,children:[r.jsx("div",{className:le.uploadProgressBar,children:r.jsx("div",{className:le.uploadProgressFill,style:{width:`${k}%`}})}),r.jsxs("p",{className:le.uploadProgressText,children:[e("uploading","Uploading")," ",k,"%"]})]}):g?r.jsx("div",{className:le.uploadProgressContainer,children:r.jsxs("div",{className:le.processingContainer,children:[r.jsx("div",{className:le.spinner}),r.jsx("p",{children:e("processingPhoto","Processing photo...")})]})}):r.jsxs("div",{className:`${le.photoUploadArea} ${i?le.hasImage:""}`,onClick:Se,children:[r.jsx("input",{type:"file",ref:l,accept:"image/jpeg,image/png,image/jpg",onChange:Be,className:"d-none"}),i?r.jsx("img",{src:i,alt:e("profilePhoto","Profile Preview"),className:le.profileImagePreview}):r.jsxs(r.Fragment,{children:[r.jsx(Cn,{className:le.photoUploadIcon}),r.jsx("p",{className:le.photoUploadText,children:e("clickToUpload","Click to upload a profile photo")})]})]}),r.jsxs("p",{className:le.uploadGuidelines,children:[e("profileImageHelp","Photos should be clear, recent and show your face."),r.jsx("br",{}),e("profileImageSize","Maximum size: 5MB. Formats: JPG, JPEG, PNG.")]}),a.profilePhoto&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.profilePhoto]}),i&&!x&&!g&&r.jsxs("div",{className:le.photoActions,children:[r.jsxs("button",{type:"button",className:`${le.photoActionButton} ${le.changePhotoButton}`,onClick:Se,disabled:x||g,children:[r.jsx(Zd,{})," ",e("changePhoto","Change Photo")]}),r.jsxs("button",{type:"button",className:`${le.photoActionButton} ${le.removePhotoButton}`,onClick:Oe,disabled:x||g,children:[r.jsx(br,{})," ",e("removePhoto","Remove")]})]})]}),r.jsxs("div",{className:le.formActions,children:[r.jsxs("button",{type:"button",className:`${le.button} ${le.buttonOutline}`,onClick:H,disabled:f||x||g,children:[r.jsx(wr,{})," ",e("back","Back")]}),r.jsxs("button",{type:"button",className:`${le.button} ${le.buttonPrimary}`,onClick:W,disabled:f||x||g,children:[e("continue","Continue")," ",r.jsx(Jr,{})]})]})]}),ee=()=>r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:le.stepHeader,children:[r.jsx("h3",{children:e("yourPreferences","Your Preferences")}),r.jsx("p",{children:e("tellWhatLooking","Tell us about yourself and what you're looking for")})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,children:e("maritalStatus","Marital Status")}),r.jsxs("select",{className:le.input,name:"maritalStatus",value:n.maritalStatus,onChange:ke,style:{paddingLeft:"1rem"},children:[r.jsx("option",{value:"",children:e("selectStatus","Select your status")}),V.map(oe=>r.jsx("option",{value:oe,children:e(oe)||oe},oe))]}),a.maritalStatus&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.maritalStatus]})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,children:e("lookingFor","Looking For")}),r.jsx("p",{className:le.helpText,children:e("lookingForHelp","Select up to 3 options")}),r.jsx("div",{className:le.tagContainer,children:S.map(oe=>r.jsxs("button",{type:"button",className:`${le.tag} ${n.lookingFor.includes(oe)?le.selected:""}`,onClick:()=>Q(oe),disabled:!n.lookingFor.includes(oe)&&n.lookingFor.length>=3,children:[e(oe)||oe.charAt(0).toUpperCase()+oe.slice(1),n.lookingFor.includes(oe)&&r.jsx(jt,{className:le.tagCheck})]},oe))}),a.lookingFor&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.lookingFor]})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,children:e("interests","Interests")}),r.jsx("p",{className:le.helpText,children:e("interestsHelp","Select up to 10 interests")}),r.jsx("div",{className:le.tagContainer,children:j.map(oe=>r.jsxs("button",{type:"button",className:`${le.tag} ${n.interests.includes(oe)?le.selected:""}`,onClick:()=>ne(oe),disabled:!n.interests.includes(oe)&&n.interests.length>=10,children:[e(oe)||oe,n.interests.includes(oe)&&r.jsx(jt,{className:le.tagCheck})]},oe))}),a.interests&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.interests]})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,children:e("imInto","I'm into")}),r.jsx("p",{className:le.helpText,children:e("imIntoHelp","Select up to 20 tags")}),r.jsx("div",{className:le.tagContainer,children:C.map(oe=>r.jsxs("button",{type:"button",className:`${le.tag} ${n.intoTags.includes(oe)?le.selected:""}`,onClick:()=>re(oe),disabled:!n.intoTags.includes(oe)&&n.intoTags.length>=20,children:[e(oe)||oe,n.intoTags.includes(oe)&&r.jsx(jt,{className:le.tagCheck})]},oe))}),a.intoTags&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.intoTags]})]}),r.jsxs("div",{className:le.formGroup,children:[r.jsx("label",{className:le.formLabel,children:e("turnsMeOn","It turns me on")}),r.jsx("p",{className:le.helpText,children:e("turnsMeOnHelp","Select up to 20 tags")}),r.jsx("div",{className:le.tagContainer,children:G.map(oe=>r.jsxs("button",{type:"button",className:`${le.tag} ${n.turnOns.includes(oe)?le.selected:""}`,onClick:()=>_e(oe),disabled:!n.turnOns.includes(oe)&&n.turnOns.length>=20,children:[e(oe)||oe,n.turnOns.includes(oe)&&r.jsx(jt,{className:le.tagCheck})]},oe))}),a.turnOns&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.turnOns]})]}),r.jsxs("div",{className:le.checkboxGroup,children:[r.jsxs("label",{className:`${le.checkboxLabel} ${a.agreeTerms?le.checkboxLabelError:""}`,children:[r.jsx("input",{type:"checkbox",className:le.checkbox,name:"agreeTerms",checked:n.agreeTerms,onChange:z}),e("termsAgreement","I agree to the")," ",r.jsx(yt,{to:"/terms",target:"_blank",rel:"noopener noreferrer",className:le.footerLink,children:e("termsOfService","Terms of Service")})]}),a.agreeTerms&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.agreeTerms]})]}),r.jsxs("div",{className:le.checkboxGroup,children:[r.jsxs("label",{className:`${le.checkboxLabel} ${a.agreePrivacy?le.checkboxLabelError:""}`,children:[r.jsx("input",{type:"checkbox",className:le.checkbox,name:"agreePrivacy",checked:n.agreePrivacy,onChange:z}),e("privacyAgreement","I agree to the")," ",r.jsx(yt,{to:"/privacy",target:"_blank",rel:"noopener noreferrer",className:le.footerLink,children:e("privacyPolicy","Privacy Policy")})]}),a.agreePrivacy&&r.jsxs("p",{className:le.errorMessage,children:[r.jsx(Bt,{})," ",a.agreePrivacy]})]}),r.jsx("div",{className:le.checkboxGroup,children:r.jsxs("label",{className:le.checkboxLabel,children:[r.jsx("input",{type:"checkbox",className:le.checkbox,name:"newsletter",checked:n.newsletter,onChange:z}),e("newsletterAgreement","I want to receive news and special offers (optional)")]})}),r.jsxs("div",{className:le.formActions,children:[r.jsxs("button",{type:"button",className:`${le.button} ${le.buttonOutline}`,onClick:H,disabled:f,children:[r.jsx(wr,{})," ",e("back","Back")]}),r.jsx("button",{type:"submit",className:`${le.button} ${le.buttonPrimary}`,disabled:f,onClick:Le,children:f?r.jsxs(r.Fragment,{children:[" ",r.jsx("span",{className:le.spinner})," ",r.jsx("span",{children:e("creatingAccount","Creating account...")})," "]}):r.jsxs(r.Fragment,{children:[" ",r.jsx("span",{children:e("createBtn","Create Account")})," ",r.jsx(jt,{})," "]})})]})]}),de=()=>{switch(t){case 1:return ut();case 2:return tt();case 3:return we();case 4:return ee();default:return null}};return r.jsx("div",{className:`auth-page register-page d-flex min-vh-100 bg-light-subtle ${E?"rtl-layout":""}`,children:r.jsxs("div",{className:le.registerContainer,children:[r.jsx("div",{className:le.gradientBar}),r.jsxs("div",{className:"text-center mb-4",children:[r.jsx(yt,{to:"/",className:le.pageTitle,children:"Mandarin"}),r.jsx("p",{className:le.subtitle,children:e("createAccount","Create Your Account")})]}),a.general&&r.jsxs("div",{className:`${le.alert} ${le.alertDanger}`,children:[r.jsx(Bt,{}),r.jsx("p",{className:"mb-0",children:typeof a.general=="string"?a.general:e("generalError","An error occurred")})]}),He(),r.jsx("form",{onSubmit:oe=>{oe.preventDefault(),t===4&&Le()},children:de()}),t===1&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:le.divider,children:e("signUpWith","OR SIGN UP WITH")}),r.jsxs("div",{className:le.socialButtons,children:[r.jsxs("button",{type:"button",className:le.socialButton,children:[" ",r.jsx(Yd,{className:le.googleIcon}),r.jsx("span",{children:e("signUpGoogle","Sign up with Google")})]}),r.jsxs("button",{type:"button",className:le.socialButton,children:[" ",r.jsx(Gd,{className:le.facebookIcon}),r.jsx("span",{children:e("signUpFacebook","Sign up with Facebook")})]})]})]}),r.jsxs("div",{className:le.footer,children:[e("haveAccount","Already have an account?")," "," ",r.jsx(yt,{to:"/login",className:le.footerLink,children:e("signIn","Sign In")})]})]})})},H5="_container_auyyq_40",V5="_dashboardPage_auyyq_9",W5="_dashboardContent_auyyq_26",G5="_gradientBar_auyyq_78",Y5="_storiesSection_auyyq_89",K5="_storiesHeader_auyyq_106",J5="_storiesTitle_auyyq_119",Q5="_dashboardHeader_auyyq_131",X5="_dashboardTitle_auyyq_147",Z5="_dashboardSubtitle_auyyq_158",eN="_dashboardActions_auyyq_164",tN="_viewToggle_auyyq_170",sN="_viewToggleButton_auyyq_183",nN="_active_auyyq_202",rN="_filterButton_auyyq_209",oN="_filterPanel_auyyq_240",iN="_filterSection_auyyq_263",aN="_filterOptions_auyyq_278",cN="_rangeSlider_auyyq_284",lN="_rangeValues_auyyq_289",dN="_rangeValue_auyyq_289",uN="_rangeInput_auyyq_304",hN="_filterOption_auyyq_278",fN="_tagsContainer_auyyq_386",gN="_filterTag_auyyq_394",pN="_filterActions_auyyq_436",mN="_usersSection_auyyq_444",yN="_usersGrid_auyyq_455",vN="_usersList_auyyq_462",_N="_userCardWrapper_auyyq_469",wN="_contentLoader_auyyq_479",bN="_loadingContainer_auyyq_488",xN="_spinner_auyyq_493",SN="_loadingText_auyyq_509",CN="_noResultsIcon_auyyq_515",kN="_chatOverlay_auyyq_522",it={container:H5,dashboardPage:V5,dashboardContent:W5,gradientBar:G5,storiesSection:Y5,storiesHeader:K5,storiesTitle:J5,dashboardHeader:Q5,dashboardTitle:X5,dashboardSubtitle:Z5,dashboardActions:eN,viewToggle:tN,viewToggleButton:sN,active:nN,filterButton:rN,filterPanel:oN,filterSection:iN,filterOptions:aN,rangeSlider:cN,rangeValues:lN,rangeValue:dN,rangeInput:uN,filterOption:hN,tagsContainer:fN,filterTag:gN,filterActions:pN,usersSection:mN,usersGrid:yN,usersList:vN,userCardWrapper:_N,contentLoader:wN,loadingContainer:bN,spinner:xN,loadingText:SN,noResultsIcon:CN,chatOverlay:kN},Pl=Dn("Dashboard"),NN=()=>{ps();const{user:e}=Xt(),{users:t,getUsers:s,loading:n,likeUser:o,unlikeUser:i,isUserLiked:c,likesLoading:l,getLikedUsers:u}=Bn(),h=0,{createStory:a}=co(),{t:d}=Ht(),{isRTL:f}=ss(),v=En();fy();const g=p.useMemo(()=>({browseUsers:d("browseUsers")||"Browse Users",yourMatches:d("yourMatches")||"Your Matches",findMatches:d("findMatches")||"Find your perfect matches",loadingUsers:d("loadingUsers")||"Loading users",loadingMoreUsers:d("loadingMoreUsers")||"Loading more users",noMatches:d("noMatches")||"No matches found",tryAdjustingFilters:d("tryAdjustingFilters")||"Try adjusting your filters",myStories:d("myStories")||"My Stories",createStory:d("createStory")||"Create Story",loading:d("loading")||"Loading",filter:d("filter")||"Filter",filters:d("filters")||"Filters",reset:d("reset")||"Reset",apply:d("apply")||"Apply",online:d("online")||"Online",showOnly:d("showOnly")||"Show Only",range:d("range")||"Range",age:d("age")||"Age",distance:d("distance")||"Distance",verified:d("verified")||"Verified",withPhotos:d("withPhotos")||"With Photos",interests:d("interests")||"Interests",gridView:d("gridView")||"Grid View",listView:d("listView")||"List View",toggleFilters:d("toggleFilters")||"Toggle Filters",browseAndConnect:d("browseAndConnect")||"Browse and Connect",kmAway:d("kmAway")||"km away"}),[d]),[b,$]=p.useState(1),[T,F]=p.useState(!0),[M,E]=p.useState(!1),U=p.useRef(),A=p.useRef(null),[D,w]=p.useState("discover"),[N,P]=p.useState(!1),[x,k]=p.useState({ageMin:18,ageMax:99,distance:100,online:!1,verified:!1,withPhotos:!1,interests:[]}),[R,j]=p.useState(null),[I,S]=p.useState(!1),[C,G]=p.useState("grid"),[V,L]=p.useState({}),[X,q]=p.useState(!1),[z,K]=p.useState(null),[W,H]=p.useState(!1),[ne,Q]=p.useState(null),[he,re]=p.useState(!1),[_e,ke]=p.useState(!1);p.useCallback(te=>{L(Y=>({...Y,[te]:!0}))},[]),p.useEffect(()=>{Be(1).then(()=>{ke(!0)})},[x]);const Be=p.useCallback(async te=>{E(te!==1);try{const Y=await s(te,20);return F(Y.hasMore),$(te),Y}catch(Y){return Pl.error("Error loading users:",Y),Z.error("Failed to load users. Please try again."),null}finally{E(!1)}},[s]),Oe=p.useCallback(()=>{!M&&T&&Be(b+1)},[M,T,b,Be]);p.useEffect(()=>{const te=U.current;return te&&te.disconnect(),U.current=new IntersectionObserver(Y=>{Y[0].isIntersecting&&T&&!M&&!n&&Oe()},{root:null,threshold:.1,rootMargin:"100px"}),A.current&&T&&U.current.observe(A.current),()=>{te&&te.disconnect()}},[T,M,n,Oe,t.length]),p.useEffect(()=>{const te=setInterval(()=>{document.visibilityState==="visible"&&Be(1)},3e5),Y=()=>{document.visibilityState==="visible"&&Be(1)};return document.addEventListener("visibilitychange",Y),()=>{clearInterval(te),document.removeEventListener("visibilitychange",Y),S(!1),j(null)}},[Be]);const Se=p.useMemo(()=>t.filter(te=>{var _,m;if(te._id===(e==null?void 0:e._id))return!1;const Y=((_=te.details)==null?void 0:_.age)||25;if(Y<x.ageMin||Y>x.ageMax||x.online&&!te.isOnline||x.withPhotos&&(!te.photos||te.photos.length===0))return!1;if(x.interests.length>0){const y=((m=te.details)==null?void 0:m.interests)||[];if(!x.interests.some(J=>y.includes(J)))return!1}return!0}),[t,e,x]),Le=p.useMemo(()=>{const te=new Map;return Se.forEach(_=>{_&&_._id&&te.set(_._id,_)}),Array.from(te.values()).sort((_,m)=>_.isOnline&&!m.isOnline?-1:!_.isOnline&&m.isOnline?1:new Date(m.lastActive)-new Date(_.lastActive))},[Se]),Me=["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art"],He=te=>{k(Y=>Y.interests.includes(te)?{...Y,interests:Y.interests.filter(_=>_!==te)}:{...Y,interests:[...Y.interests,te]})},ut=te=>{Q(te),re(!0)},tt=(te,Y)=>{te.stopPropagation(),j(Y),S(!0)},we=()=>{S(!1),j(null)},ee=te=>{if(!a||W){Z.info(W?"Story creation in progress, please wait...":"Story creation is not available right now");return}H(!0),a(te).then(Y=>{Y&&(Y.success===!0||Y._id||Y.data&&Y.data._id)||Y&&Y.message&&Y.message.includes("wait")?q(!1):Z.error(Y&&Y.error||"Failed to create story")}).catch(Y=>{Z.error("An error occurred while creating your story"),Pl.error("Story creation error:",Y)}).finally(()=>{H(!1)})};p.useEffect(()=>{L({})},[x]);const de=p.useCallback(te=>Array.isArray(h)&&h.some(Y=>Y.sender===te),[h]),ye=p.useCallback(te=>Array.isArray(h)?h.filter(Y=>Y.sender===te).length:0,[h]),oe=p.useCallback(()=>{k({ageMin:18,ageMax:99,distance:100,online:!1,verified:!1,withPhotos:!1,interests:[]}),$(1),F(!0)},[]);p.useEffect(()=>{const te=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.scrollHeight-300&&T&&!M&&!n&&Oe()};return window.addEventListener("scroll",te),()=>window.removeEventListener("scroll",te)},[T,M,n,Oe]);const fe=p.useCallback((te,Y)=>{c(te)?i(te,Y).then(m=>{m&&setTimeout(()=>u(!0),300)}):o(te,Y).then(m=>{m&&setTimeout(()=>u(!0),300)})},[c,i,o,u]),ie=(n||l)&&b===1&&!_e;return r.jsxs("div",{className:`${it.dashboardPage} ${f?"rtl-layout":""} ${v?"mobile-device":""}`,children:[N&&v&&r.jsx("div",{className:`mobile-modal-backdrop ${N?"open":""}`,onClick:()=>P(!1)}),r.jsx(ro,{}),r.jsx("main",{className:it.dashboardContent,children:r.jsxs("div",{className:it.container,children:[r.jsx("div",{className:it.gradientBar}),r.jsxs("div",{className:it.storiesSection,children:[r.jsxs("div",{className:it.storiesHeader,children:[r.jsx("h2",{className:it.storiesTitle,children:g.myStories}),r.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>!W&&q(!0),"aria-label":"Create a new story",disabled:W,children:[r.jsx(ou,{}),r.jsx("span",{children:W?g.loading:g.createStory})]})]}),r.jsx(K6,{onStoryClick:te=>{z||K(te)}})]}),r.jsxs("div",{className:it.dashboardHeader,children:[r.jsxs("div",{children:[r.jsx("h1",{className:it.dashboardTitle,children:D==="discover"?g.browseUsers:g.yourMatches}),r.jsx("p",{className:it.dashboardSubtitle,children:g.findMatches})]}),r.jsxs("div",{className:it.dashboardActions,children:[r.jsxs("div",{className:it.viewToggle,children:[r.jsx("button",{className:`${it.viewToggleButton} ${C==="grid"?it.active:""}`,onClick:()=>G("grid"),title:"Grid View","aria-label":"Grid view",children:r.jsx(o1,{})}),r.jsx("button",{className:`${it.viewToggleButton} ${C==="list"?it.active:""}`,onClick:()=>G("list"),title:"List View","aria-label":"List view",children:r.jsx(Wm,{})})]}),r.jsxs("button",{className:`${it.filterButton} ${N?it.active:""}`,onClick:()=>P(!N),"aria-expanded":N,"aria-label":"Toggle filters",children:[r.jsx(zm,{}),r.jsx("span",{children:g.filter})]})]})]}),N&&r.jsxs("div",{className:`${it.filterPanel} animate-fade-in ${v?"mobile-modal":""}`,children:[v&&r.jsxs("div",{className:"mobile-modal-header",children:[r.jsx("div",{className:"mobile-modal-drag-indicator"}),r.jsx("h3",{className:"mobile-modal-title",children:g.filters}),r.jsx("button",{className:"mobile-modal-close",onClick:()=>P(!1),"aria-label":"Close filters",children:r.jsx(Ts,{})})]}),r.jsxs("div",{className:it.filterSection,children:[r.jsxs("h3",{children:[g.age," ",g.range]}),r.jsx("div",{className:`${it.filterOptions} ${v?"touch-target":""}`,children:r.jsxs("div",{className:it.rangeSlider,children:[r.jsxs("div",{className:it.rangeValues,children:[r.jsx("span",{children:x.ageMin}),r.jsx("span",{children:x.ageMax})]}),r.jsx("input",{type:"range",min:"18",max:"99",value:x.ageMin,onChange:te=>k({...x,ageMin:Number.parseInt(te.target.value)}),className:it.rangeInput,"aria-label":"Minimum age"}),r.jsx("input",{type:"range",min:"18",max:"99",value:x.ageMax,onChange:te=>k({...x,ageMax:Number.parseInt(te.target.value)}),className:it.rangeInput,"aria-label":"Maximum age"})]})})]}),r.jsxs("div",{className:it.filterSection,children:[r.jsx("h3",{children:g.distance}),r.jsx("div",{className:it.filterOptions,children:r.jsxs("div",{className:it.rangeSlider,children:[r.jsx("div",{className:it.rangeValue,children:r.jsxs("span",{children:[x.distance," km"]})}),r.jsx("input",{type:"range",min:"5",max:"100",value:x.distance,onChange:te=>k({...x,distance:Number.parseInt(te.target.value)}),className:it.rangeInput,"aria-label":"Maximum distance"})]})})]}),r.jsxs("div",{className:it.filterSection,children:[r.jsx("h3",{children:g.showOnly}),r.jsxs("div",{className:`${it.filterOptions} d-flex flex-column`,children:[r.jsxs("label",{className:it.filterOption,children:[r.jsx("input",{type:"checkbox",checked:x.online,onChange:()=>k({...x,online:!x.online}),"aria-label":"Show only online users"}),r.jsx("span",{children:g.online})]}),r.jsxs("label",{className:it.filterOption,children:[r.jsx("input",{type:"checkbox",checked:x.verified,onChange:()=>k({...x,verified:!x.verified}),"aria-label":"Show only verified profiles"}),r.jsx("span",{children:g.verified})]}),r.jsxs("label",{className:it.filterOption,children:[r.jsx("input",{type:"checkbox",checked:x.withPhotos,onChange:()=>k({...x,withPhotos:!x.withPhotos}),"aria-label":"Show only profiles with photos"}),r.jsx("span",{children:g.withPhotos})]})]})]}),r.jsxs("div",{className:it.filterSection,children:[r.jsx("h3",{children:g.interests}),r.jsx("div",{className:it.tagsContainer,children:Me.map(te=>r.jsx("button",{className:`${it.filterTag} ${x.interests.includes(te)?it.active:""}`,onClick:()=>He(te),"aria-pressed":x.interests.includes(te),children:te},te))})]}),r.jsxs("div",{className:it.filterActions,children:[r.jsx("button",{className:"btn btn-outline",onClick:oe,"aria-label":"Reset filters",children:g.reset}),r.jsxs("button",{className:"btn btn-primary",onClick:()=>P(!1),"aria-label":"Apply filters",children:[g.apply," ",g.filter]})]})]}),r.jsx("div",{className:`${it.usersSection} ${v?"mobile-optimized":""}`,children:r.jsx("div",{className:`${C==="grid"?it.usersGrid:it.usersList} ${v?"compact-grid":""}`,children:ie?r.jsx("div",{className:it.contentLoader,children:r.jsxs("div",{className:it.loadingContainer,children:[r.jsx("div",{className:it.spinner}),r.jsxs("p",{className:it.loadingText,children:[g.loadingUsers,"..."]})]})}):Le.length>0?r.jsxs(r.Fragment,{children:[Le.map((te,Y)=>{const _=Y===Le.length-1;return r.jsx("div",{className:it.userCardWrapper,ref:_?A:null,children:r.jsx(Cv,{user:te,isLiked:c(te._id),onLike:fe,viewMode:C,onMessage:m=>tt(m,te),onClick:()=>ut(te._id),showExtendedDetails:!0,hasUnreadMessages:de(te._id),unreadMessageCount:ye(te._id)})},te._id)}),M&&r.jsx("div",{className:it.contentLoader,style:{minHeight:"100px"},children:r.jsxs("div",{className:it.loadingContainer,children:[r.jsx("div",{className:it.spinner}),r.jsxs("p",{className:it.loadingText,children:[g.loadingMoreUsers,"..."]})]})})]}):r.jsx("div",{className:it.contentLoader,children:r.jsxs("div",{className:it.loadingContainer,children:[r.jsx("div",{className:it.noResultsIcon,children:r.jsx(iu,{})}),r.jsx("h3",{children:g.noMatches}),r.jsx("p",{children:g.tryAdjustingFilters}),r.jsxs("button",{className:"btn btn-primary",onClick:oe,"aria-label":"Reset filters",children:[g.reset," ",g.filter]})]})})})})]})}),I&&R&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:it.chatOverlay,onClick:we}),r.jsx(Ni,{recipient:R,isOpen:I,onClose:we})]}),X&&r.jsx(Q6,{onClose:()=>q(!1),onSubmit:ee}),z&&r.jsx(Yu,{storyId:z,onClose:()=>K(null)}),he&&r.jsx(ki,{userId:ne,isOpen:he,onClose:()=>re(!1)})]})},EN="_btn_vy4l6_761",TN="_profilePage_vy4l6_3",AN="_dashboardContent_vy4l6_18",jN="_photoSection_vy4l6_34",IN="_profilePhotoWrapper_vy4l6_74",$N="_profilePhoto_vy4l6_74",PN="_addPhotoButton_vy4l6_371",RN="_profileInfo_vy4l6_422",MN="_profileHeader_vy4l6_448",LN="_profileTitle_vy4l6_462",ON="_infoSection_vy4l6_474",FN="_sectionTitle_vy4l6_501",DN="_infoGrid_vy4l6_531",BN="_formGroup_vy4l6_537",UN="_formLabel_vy4l6_541",qN="_formControl_vy4l6_549",zN="_borderDanger_vy4l6_593",HN="_textArea_vy4l6_597",VN="_errorMessage_vy4l6_602",WN="_textMuted_vy4l6_611",GN="_textRight_vy4l6_615",YN="_mt1_vy4l6_623",KN="_mt2_vy4l6_627",JN="_mt4_vy4l6_635",QN="_mb2_vy4l6_639",XN="_fstItalic_vy4l6_648",ZN="_interestsTags_vy4l6_653",e3="_interestTag_vy4l6_659",t3="_selected_vy4l6_676",s3="_btnPrimary_vy4l6_775",n3="_btnOutline_vy4l6_787",r3="_spinner_vy4l6_808",o3="_spinnerLarge_vy4l6_824",i3="_spinnerDark_vy4l6_830",a3="_flexDisplay_vy4l6_929",c3="_flexWrap_vy4l6_930",l3="_gap2_vy4l6_933",be={btn:EN,profilePage:TN,dashboardContent:AN,photoSection:jN,profilePhotoWrapper:IN,profilePhoto:$N,addPhotoButton:PN,profileInfo:RN,profileHeader:MN,profileTitle:LN,infoSection:ON,sectionTitle:FN,infoGrid:DN,formGroup:BN,formLabel:UN,formControl:qN,borderDanger:zN,textArea:HN,errorMessage:VN,textMuted:WN,textRight:GN,mt1:YN,mt2:KN,mt4:JN,mb2:QN,fstItalic:XN,interestsTags:ZN,interestTag:e3,selected:t3,"identity-woman":"_identity-woman_vy4l6_682","identity-man":"_identity-man_vy4l6_695","identity-couple":"_identity-couple_vy4l6_708",btnPrimary:s3,btnOutline:n3,spinner:r3,spinnerLarge:o3,spinnerDark:i3,flexDisplay:a3,flexWrap:c3,gap2:l3},Ms=Ze.create("Profile"),d3=()=>{var we;const e=p.useRef(null),{user:t}=Xt(),{updateProfile:s,refreshUserData:n}=Bn(),{t:o}=Ht(),{isRTL:i}=ss(),c=En(),{isTouch:l,isIOS:u,isAndroid:h,isPWA:a}=Nr(),d=p.useMemo(()=>({profilePhoto:o("profilePhoto")||"Profile Photo",profileUpdated:o("profileUpdated")||"Profile updated successfully",updateFailed:o("updateFailed")||"Update failed",photoUploadSuccess:o("photoUploadSuccess")||"Photo uploaded successfully",updatingPhotoPrivacy:o("updatingPhotoPrivacy")||"Updating photo privacy...",photoPrivacySuccess:o("photoPrivacySuccess")||"Photo privacy updated",updatingProfilePhoto:o("updatingProfilePhoto")||"Updating profile photo...",profilePhotoUpdated:o("profilePhotoUpdated")||"Profile photo updated",confirmDeletePhoto:o("confirmDeletePhoto")||"Are you sure you want to delete this photo?",photoDeleteSuccess:o("photoDeleteSuccess")||"Photo deleted successfully",loadingProfile:o("loading")||"Loading...",uploading:o("uploading")||"Uploading...",addPhoto:o("addPhoto")||"Add Photo",myProfile:o("myProfile")||"My Profile",edit:o("edit")||"Edit",cancel:o("cancel")||"Cancel",save:o("save")||"Save",saving:o("saving")||"Saving...",basicInformation:o("basicInfo")||"Basic Information",nickname:o("nickname")||"Nickname",age:o("age")||"Age",location:o("location")||"Location",iAmA:o("iAm")||"I am",notSpecified:o("notSpecified")||"Not specified",maritalStatus:o("maritalStatus")||"Marital Status",maritalStatusMarried:o("maritalStatusMarried")||"Married",aboutMe:o("aboutMe")||"About Me",tellAboutYourself:o("tellAboutYourself")||"Tell others about yourself...",noBioProvided:o("noBioProvided")||"No bio provided",interests:o("interests")||"Interests",interestsLimit:o("interestsLimit")||"Select up to 10 interests",noInterestsSelected:o("noInterestsSelected")||"No interests selected",lookingFor:o("lookingFor")||"Looking For",lookingForLimit:o("lookingForLimit")||"Select up to 3 options",imInto:o("intoTags")||"I'm Into",intoTagsLimit:o("intoTagsLimit")||"Select up to 20 tags",noTagsSelected:o("noTagsSelected")||"No tags selected",turnOns:o("turnOns")||"Turn Ons",turnOnsLimit:o("turnOnsLimit")||"Select up to 20 turn ons",private:o("private")||"Private",public:o("public")||"Public",friendsOnly:o("friendsOnly")||"Friends Only",profileUpdateFailed:o("profileUpdateFailed")||"Failed to update profile",photoUploadFailed:o("photoUploadFailed")||"Failed to upload photo",photoPrivacyUpdateFailed:o("photoPrivacyUpdateFailed")||"Failed to update photo privacy",profilePhotoUpdateFailed:o("profilePhotoUpdateFailed")||"Failed to update profile photo",photoDeleteFailed:o("photoDeleteFailed")||"Failed to delete photo",required:o("required")||"This field is required",invalidFormat:o("invalidFormat")||"Invalid format",tooShort:o("tooShort")||"Too short",tooLong:o("tooLong")||"Too long",man:o("man")||"Man",woman:o("woman")||"Woman",couple:o("couple")||"Couple",men:o("men")||"Men",women:o("women")||"Women",couples:o("couples")||"Couples"}),[o]),{uploadPhoto:f,setPhotoPrivacy:v,setProfilePhoto:g,deletePhoto:b,isUploading:$,uploadProgress:T,isProcessingPhoto:F,processPhotos:M,clearCache:E,refreshAllAvatars:U}=nr(),[A,D]=p.useState(!1),[w,N]=p.useState({nickname:"",details:{age:"",gender:"",location:"",bio:"",interests:[],iAm:"",lookingFor:[],intoTags:[],turnOns:[],maritalStatus:""}}),[P]=p.useState(["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art","Reading","Gaming","Photography","Dancing","Cooking"]),[x]=p.useState(["woman","man","couple"]),[k]=p.useState(["women","men","couples"]),[R]=p.useState(["Meetups","Power play","Threesomes","Online fun","Hot chat","Photo sharing","Camera chat","Cuckold","Golden showers","Strap-on","Forced bi","Erotic domination","Humiliation","Crossdressing","Worship","Foot fetish","Oral","From behind","Role-play","Toys","Massages","Foreplay","Casual meetups","Fantasy fulfillment","Bizarre","Education","Experiences","Tantra"]),[j]=p.useState(["Sexy ass","Dirty talk","Aggressive","Slow and gentle","In a public place","Pampering","Sexy clothing","Leather/latex clothing","Watching porn","Fit body","Bathing together","Erotic writing","Eye contact","Being pampered","Sexy legs","Teasing","Pushing boundaries"]),[I]=p.useState(["Single","Married","Divorced","Separated","Widowed","In a relationship","It's complicated","Open relationship","Polyamorous"]),[S,C]=p.useState({}),[G,V]=p.useState(!1),L=p.useRef(null);ps();const[X,q]=p.useState(!0),[z,K]=p.useState(Date.now());p.useEffect(()=>{var ee,de,ye,oe,fe,ie,te,Y,_,m,y;q(!0),t&&(N({nickname:t.nickname||"",details:{age:((ee=t.details)==null?void 0:ee.age)||"",gender:((de=t.details)==null?void 0:de.gender)||"",location:((ye=t.details)==null?void 0:ye.location)||"",bio:((oe=t.details)==null?void 0:oe.bio)||"",interests:((fe=t.details)==null?void 0:fe.interests)||[],iAm:((ie=t.details)==null?void 0:ie.iAm)||"",lookingFor:((te=t.details)==null?void 0:te.lookingFor)||[],intoTags:((Y=t.details)==null?void 0:Y.intoTags)||[],turnOns:((_=t.details)==null?void 0:_.turnOns)||[],maritalStatus:((m=t.details)==null?void 0:m.maritalStatus)||""}}),Ms.debug(`User has ${((y=t.photos)==null?void 0:y.length)||0} photos`)),q(!1)},[t]);const W=p.useRef(!0);p.useEffect(()=>()=>{W.current=!1},[]),p.useEffect(()=>()=>{L.current&&(L.current.value="")},[]),p.useEffect(()=>{let ee=null;return l&&e.current&&(ee=no(e.current),Ms.debug("Mobile scroll enhancements applied to Profile")),()=>{ee&&ee()}},[l]);const H=ee=>{const{name:de,value:ye,type:oe,checked:fe}=ee.target;if(oe==="checkbox")N({...w,[de]:fe});else if(oe==="number"){if(ye===""||!isNaN(Number.parseInt(ye)))if(de.includes("details.")){const ie=de.split(".")[1];N({...w,details:{...w.details,[ie]:ye}})}else N({...w,[de]:ye})}else if(de.includes("details.")){const ie=de.split(".")[1];N({...w,details:{...w.details,[ie]:ye}})}else N({...w,[de]:ye});S[de.split(".").pop()]&&C(ie=>{const te={...ie};return delete te[de.split(".").pop()],te})},ne=ee=>{const de=w.details.interests;if(!de.includes(ee)&&de.length>=10){Z.warning("You can select up to 10 interests");return}const ye=de.includes(ee)?de.filter(oe=>oe!==ee):[...de,ee];N(oe=>({...oe,details:{...oe.details,interests:ye}}))},Q=ee=>{N(de=>({...de,details:{...de.details,iAm:de.details.iAm===ee?"":ee}}))},he=ee=>{const de=w.details.lookingFor;let ye;if(de.includes(ee))ye=de.filter(oe=>oe!==ee);else{if(de.length>=3){Z.warning("You can select up to 3 options");return}ye=[...de,ee]}N(oe=>({...oe,details:{...oe.details,lookingFor:ye}}))},re=ee=>{const de=w.details.intoTags;if(!de.includes(ee)&&de.length>=20){Z.warning("You can select up to 20 'I'm into' tags");return}const ye=de.includes(ee)?de.filter(oe=>oe!==ee):[...de,ee];N(oe=>({...oe,details:{...oe.details,intoTags:ye}}))},_e=ee=>{const de=w.details.turnOns;if(!de.includes(ee)&&de.length>=20){Z.warning("You can select up to 20 'Turn ons' tags");return}const ye=de.includes(ee)?de.filter(oe=>oe!==ee):[...de,ee];N(oe=>({...oe,details:{...oe.details,turnOns:ye}}))},ke=ee=>{N(de=>({...de,details:{...de.details,maritalStatus:de.details.maritalStatus===ee?"":ee}}))},Be=()=>{const ee={};return w.nickname.trim()?w.nickname.length<3?ee.nickname="nicknameTooShort":w.nickname.length>50&&(ee.nickname="nicknameTooLong"):ee.nickname="nicknameRequired",!w.details.age&&w.details.age!==0?ee.age="ageRequired":isNaN(w.details.age)?ee.age="ageInvalid":w.details.age<18?ee.age="ageMinimum":w.details.age>120&&(ee.age="ageMaximum"),w.details.location.trim()?w.details.location.length<2&&(ee.location="locationTooShort"):ee.location="locationRequired",w.details.bio&&w.details.bio.length>500&&(ee.bio="bioTooLong"),ee},Oe=async ee=>{ee==null||ee.preventDefault();const de=Be();if(Object.keys(de).length>0){C(de);const ye=document.querySelector(`.${be.errorMessage}`);ye&&ye.scrollIntoView({behavior:"smooth",block:"center"});return}C({}),V(!0);try{const ye={nickname:w.nickname.trim(),details:{...w.details,age:Number(w.details.age),location:w.details.location.trim(),bio:w.details.bio?w.details.bio.trim():"",interests:Array.isArray(w.details.interests)?w.details.interests:[],iAm:w.details.iAm||"",lookingFor:Array.isArray(w.details.lookingFor)?w.details.lookingFor:[],intoTags:Array.isArray(w.details.intoTags)?w.details.intoTags:[],turnOns:Array.isArray(w.details.turnOns)?w.details.turnOns:[],maritalStatus:w.details.maritalStatus||""}},oe=await s(ye);if(oe)await n(oe._id)||Ms.warn("User data refresh may not have been complete, but continuing"),Z.success(d.profileUpdated),D(!1);else throw new Error(d.updateFailed)}catch(ye){console.error("Failed to update profile:",ye),Z.error(ye.message||d.profileUpdateFailed)}finally{V(!1)}},Se=async ee=>{var ye,oe;const de=ee.target.files[0];if(de){l&&Yt("sendFile"),L.current&&(L.current.value="");try{const fe=await f(de,"private");fe&&fe._id&&(E(),K(Date.now()),await n(t==null?void 0:t._id,!0),Z.success(d.photoUploadSuccess),Ms.debug("Photo uploaded successfully:",{photoId:fe._id,url:fe.url}))}catch(fe){Ms.error("Failed to upload photo:",fe),((oe=(ye=fe.response)==null?void 0:ye.data)==null?void 0:oe.success)===!0?(Ms.warn("Upload succeeded but threw error - handling as success"),E(),K(Date.now()),await n(t==null?void 0:t._id,!0),Z.success(d.photoUploadSuccess)):fe.message&&!fe.message.includes("success")&&!fe.message.includes("uploaded successfully")&&Z.error(fe.message||d.photoUploadFailed)}}},Le=()=>{var ee;(ee=L.current)==null||ee.click()},Me=async(ee,de,ye)=>{ye==null||ye.stopPropagation();try{Z.info(d.updatingPhotoPrivacy,{autoClose:1e3}),await v(ee,de,t==null?void 0:t._id),U(!0),E(),K(Date.now()),await n(t==null?void 0:t._id,!0);const oe=de==="private"?d.private:de==="friends_only"?d.friendsOnly:d.public;Z.success(o("photoPrivacySuccess")||`Photo privacy set to ${oe}`)}catch(oe){Ms.error("Failed to update photo privacy:",oe),Z.error(oe.message||d.photoPrivacyUpdateFailed)}},He=async ee=>{try{l&&Yt("selectConversation"),Z.info(d.updatingProfilePhoto,{autoClose:1e3}),await g(ee,t==null?void 0:t._id),U(!0),window.__photo_refresh_timestamp=Date.now(),K(window.__photo_refresh_timestamp),await new Promise(de=>setTimeout(de,300)),await n(t==null?void 0:t._id,!0),K(Date.now()),Z.success(d.profilePhotoUpdated)}catch(de){Ms.error("Failed to set profile photo:",de),Z.error(de.message||d.profilePhotoUpdateFailed)}},ut=async(ee,de)=>{if(de==null||de.stopPropagation(),!!window.confirm(d.confirmDeletePhoto)){Ms.debug("Starting photo deletion for:",ee);try{const ye=await b(ee,t==null?void 0:t._id);if(Ms.debug("Delete operation result:",ye),ye){E(),K(Date.now()),Z.success(d.photoDeleteSuccess);try{await n(t==null?void 0:t._id,!0)}catch(oe){Ms.warn("Failed to refresh user data after delete, but delete was successful:",oe)}}else Ms.error("Unexpected: deletePhoto returned falsy result:",ye),Z.error(d.photoDeleteFailed)}catch(ye){Ms.error("Delete photo error details:",{message:ye.message,stack:ye.stack,photoId:ee,userId:t==null?void 0:t._id}),Z.error(ye.message||d.photoDeleteFailed)}}},tt=()=>{var ee,de,ye,oe,fe,ie,te,Y,_,m;t&&N({nickname:t.nickname||"",details:{age:((ee=t.details)==null?void 0:ee.age)||"",gender:((de=t.details)==null?void 0:de.gender)||"",location:((ye=t.details)==null?void 0:ye.location)||"",bio:((oe=t.details)==null?void 0:oe.bio)||"",interests:((fe=t.details)==null?void 0:fe.interests)||[],iAm:((ie=t.details)==null?void 0:ie.iAm)||"",lookingFor:((te=t.details)==null?void 0:te.lookingFor)||[],intoTags:((Y=t.details)==null?void 0:Y.intoTags)||[],turnOns:((_=t.details)==null?void 0:_.turnOns)||[],maritalStatus:((m=t.details)==null?void 0:m.maritalStatus)||""}}),C({}),D(!1)};return r.jsxs("div",{ref:e,className:`${be.profilePage} min-vh-100 w-100 overflow-hidden bg-light-subtle transition-all ${i?"rtl-layout":""} ${c?"mobile-optimized":""}`,children:[r.jsx(ro,{}),r.jsx("main",{className:`${be.dashboardContent} py-5`,children:r.jsx("div",{className:"container max-w-xl mx-auto px-4 d-flex flex-column gap-5",children:X?r.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5 text-center",children:[r.jsx("div",{className:`${be.spinner} ${be.spinnerLarge} text-primary mb-4`}),r.jsx("p",{className:"text-opacity-70 font-weight-medium",children:d.loadingProfile})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`${be.photoSection} text-center bg-white shadow-lg rounded-lg border py-4 transform-gpu hover-shadow-xl transition-all`,children:[t!=null&&t.photos&&t.photos.some(ee=>ee.isProfile&&!ee.isDeleted)?r.jsx("div",{className:`${be.profilePhotoWrapper} position-relative d-inline-block`,children:(()=>{const ee=t.photos.find(ye=>ye.isProfile&&!ye.isDeleted)||t.photos[0],de=ee.privacy||(ee.isPrivate?"private":"public");return r.jsxs(r.Fragment,{children:[r.jsx("img",{src:`${Ns(ee.url,!0)}${window.__photo_refresh_timestamp?`&_t=${window.__photo_refresh_timestamp}`:""}&_updateTime=${z}`,alt:d.profilePhoto,className:`${be.profilePhoto} w-300px h-300px object-cover rounded-circle shadow-lg border-4 border-white transform-gpu transition-transform hover-scale`},`profile-photo-${z}`),de!=="public"&&r.jsx("div",{className:"position-absolute top-0 left-0 w-100 h-100 rounded-circle d-flex align-items-center justify-content-center bg-overlay-dark",children:de==="private"?r.jsx(vs,{className:"text-3xl text-white"}):r.jsx(Go,{className:"text-3xl text-white"})}),r.jsx("div",{className:"position-absolute bottom-0 left-0 w-100 py-1 bg-overlay-dark text-white text-xs rounded-bottom-circle",children:d.profilePhoto})]})})()}):r.jsx("div",{className:"w-300px h-300px rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto border-4 border-white",children:r.jsx(Aa,{className:"text-7xl text-gray-400"})}),r.jsx("div",{className:"mt-4",children:$?r.jsxs("div",{className:"mx-auto w-200px",children:[r.jsx("div",{className:"h-8px bg-gray-800 rounded-pill overflow-hidden mb-2",children:r.jsx("div",{className:"h-100 bg-primary transition-width",role:"progressbar",style:{width:`${T}%`},"aria-valuenow":T,"aria-valuemin":"0","aria-valuemax":"100"})}),r.jsxs("div",{className:"text-center text-opacity-70",children:[d.uploading," ",T,"%"]})]}):r.jsxs("button",{className:"btn btn-outline-primary rounded-pill d-inline-flex align-items-center gap-2 hover-scale shadow-sm transition-all px-4 py-2",onClick:Le,disabled:F,"aria-label":d.addPhoto,children:[r.jsx(Cn,{})," ",r.jsx("span",{children:d.addPhoto}),r.jsx("input",{type:"file",ref:L,onChange:Se,accept:"image/*",style:{display:"none"},"aria-hidden":"true"})]})})]}),(t==null?void 0:t.photos)&&t.photos.length>0&&r.jsxs(r.Fragment,{children:[r.jsx($0,{photos:M(t.photos),onSetProfilePhoto:He,onSetPrivacy:Me,onDeletePhoto:ut,isProcessing:F,isUploading:$,uploadProgress:T,canEdit:!0,canTogglePrivacy:!0,userId:t==null?void 0:t._id,isOwner:!0,canViewPrivate:!0,gridView:!0},`photo-gallery-${((we=t.photos)==null?void 0:we.length)||0}-${z}`),r.jsx("div",{className:"text-center mt-4",children:r.jsxs("button",{type:"button",className:be.addPhotoButton,onClick:Le,disabled:$||F,"aria-label":d.addPhoto,children:[r.jsx(Cn,{style:{fontSize:"18px",marginRight:"8px"}}),d.addPhoto]})})]}),r.jsxs("div",{className:be.profileInfo,children:[r.jsxs("div",{className:be.profileHeader,children:[r.jsx("h2",{className:be.profileTitle,children:d.myProfile}),A?r.jsxs("div",{className:`${be.flexDisplay} ${be.gap2}`,children:[r.jsxs("button",{className:`${be.btn} ${be.btnOutline}`,onClick:tt,disabled:G,"aria-label":d.cancel,children:[r.jsx(Ts,{})," ",r.jsx("span",{children:d.cancel})]}),r.jsx("button",{className:`${be.btn} ${be.btnPrimary}`,onClick:Oe,disabled:G,"aria-label":d.save,children:G?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:`${be.spinner} ${be.spinnerDark}`}),r.jsx("span",{children:d.saving})]}):r.jsxs(r.Fragment,{children:[r.jsx(jt,{})," ",r.jsx("span",{children:d.save})]})})]}):r.jsxs("button",{className:`${be.btn} ${be.btnPrimary}`,onClick:()=>D(!0),"aria-label":d.edit,children:[r.jsx(Zd,{})," ",r.jsx("span",{children:d.edit})]})]}),r.jsxs("form",{className:"mt-4",onSubmit:Oe,children:[r.jsxs("div",{className:`${be.infoSection} animate-fade-in`,children:[r.jsx("h3",{className:be.sectionTitle,children:d.basicInformation}),r.jsxs("div",{className:be.infoGrid,children:[r.jsxs("div",{className:be.formGroup,children:[r.jsx("label",{className:be.formLabel,htmlFor:"nickname",children:d.nickname}),r.jsx("input",{type:"text",id:"nickname",name:"nickname",className:`${be.formControl} ${S.nickname?be.borderDanger:""}`,value:w.nickname,onChange:H,disabled:!A,maxLength:50,"aria-invalid":S.nickname?"true":"false","aria-describedby":S.nickname?"nickname-error":void 0}),S.nickname&&r.jsxs("p",{id:"nickname-error",className:be.errorMessage,children:[r.jsx(Bt,{className:"mr-1"}),o(`errors.${S.nickname}`)]})]}),r.jsxs("div",{className:be.formGroup,children:[r.jsx("label",{className:be.formLabel,htmlFor:"details.age",children:d.age}),r.jsx("input",{type:"number",id:"details.age",name:"details.age",className:`${be.formControl} ${S.age?be.borderDanger:""}`,value:w.details.age,onChange:H,disabled:!A,min:"18",max:"120","aria-invalid":S.age?"true":"false","aria-describedby":S.age?"age-error":void 0}),S.age&&r.jsxs("p",{id:"age-error",className:be.errorMessage,children:[r.jsx(Bt,{className:"mr-1"}),o(`errors.${S.age}`)]})]}),r.jsxs("div",{className:be.formGroup,children:[r.jsx("label",{className:be.formLabel,htmlFor:"details.location",children:d.location}),r.jsx("input",{type:"text",id:"details.location",name:"details.location",className:`${be.formControl} ${S.location?be.borderDanger:""}`,value:w.details.location,onChange:H,disabled:!A,maxLength:100,"aria-invalid":S.location?"true":"false","aria-describedby":S.location?"location-error":void 0}),S.location&&r.jsxs("p",{id:"location-error",className:be.errorMessage,children:[r.jsx(Bt,{className:"mr-1"}),o(`errors.${S.location}`)]})]})]}),r.jsxs("div",{className:be.mt4,children:[r.jsx("label",{className:be.formLabel,children:d.iAmA}),r.jsx("div",{className:`${be.flexDisplay} ${be.flexWrap} ${be.gap2}`,children:x.map(ee=>{const de=ee==="woman"?be["identity-woman"]:ee==="man"?be["identity-man"]:ee==="couple"?be["identity-couple"]:"";return r.jsxs("button",{type:"button",className:`${be.interestTag} ${w.details.iAm===ee?`${be.selected} ${de}`:de}`,onClick:()=>A&&Q(ee),disabled:!A,"aria-pressed":w.details.iAm===ee,children:[o(ee)||ee,w.details.iAm===ee&&r.jsx(jt,{style:{marginLeft:"4px"}})]},ee)})}),!w.details.iAm&&!A&&r.jsx("p",{className:`${be.textMuted} ${be.fstItalic} ${be.mt2}`,children:d.notSpecified})]}),r.jsxs("div",{className:be.mt4,children:[r.jsx("label",{className:be.formLabel,children:d.maritalStatus}),r.jsx("div",{className:`${be.flexDisplay} ${be.flexWrap} ${be.gap2}`,children:I.map(ee=>r.jsxs("button",{type:"button",className:`${be.interestTag} ${w.details.maritalStatus===ee?be.selected:""}`,onClick:()=>A&&ke(ee),disabled:!A,"aria-pressed":w.details.maritalStatus===ee,children:[o(ee)||(ee.toLowerCase()==="married"?d.maritalStatusMarried:ee),w.details.maritalStatus===ee&&r.jsx(jt,{style:{marginLeft:"4px"}})]},ee))}),!w.details.maritalStatus&&!A&&r.jsx("p",{className:`${be.textMuted} ${be.fstItalic} ${be.mt2}`,children:d.notSpecified})]})]}),r.jsxs("div",{className:be.infoSection,children:[r.jsx("h3",{className:be.sectionTitle,children:d.aboutMe}),r.jsx("textarea",{name:"details.bio",rows:"5",className:`${be.formControl} ${be.textArea} ${S.bio?be.borderDanger:""}`,value:w.details.bio||"",onChange:H,disabled:!A,maxLength:500,placeholder:A?d.tellAboutYourself:d.noBioProvided,"aria-invalid":S.bio?"true":"false","aria-describedby":S.bio?"bio-error":void 0}),S.bio&&r.jsxs("p",{id:"bio-error",className:be.errorMessage,children:[r.jsx(Bt,{style:{marginRight:"4px"}}),o(`errors.${S.bio}`)]}),A&&r.jsxs("div",{className:`${be.textMuted} ${be.textRight} ${be.mt1}`,children:[w.details.bio?w.details.bio.length:0,"/500"]})]}),r.jsxs("div",{className:be.infoSection,children:[r.jsx("h3",{className:be.sectionTitle,children:d.interests}),A&&r.jsx("div",{className:`${be.textMuted} ${be.mb2}`,children:d.interestsLimit}),r.jsx("div",{className:be.interestsTags,children:P.map(ee=>{const de=w.details.interests.includes(ee);return r.jsxs("button",{type:"button",className:`${be.interestTag} ${de?be.selected:""}`,onClick:()=>A&&ne(ee),disabled:!A||!de&&w.details.interests.length>=10,"aria-pressed":de,"aria-label":`${d.interests}: ${ee}`,children:[o(ee)||ee,de&&r.jsx(jt,{style:{marginLeft:"4px"}})]},ee)})}),w.details.interests.length===0&&!A&&r.jsx("p",{className:`${be.textMuted} ${be.fstItalic} ${be.mt2}`,children:d.noInterestsSelected})]}),r.jsxs("div",{className:be.infoSection,children:[r.jsx("h3",{className:be.sectionTitle,children:d.lookingFor||"Looking For"}),A&&r.jsx("div",{className:`${be.textMuted} ${be.mb2}`,children:d.lookingForLimit||"Select up to 3 options"}),r.jsx("div",{className:be.interestsTags,children:k.map(ee=>{const de=w.details.lookingFor.includes(ee),ye=ee.toLowerCase().includes("women")||ee.toLowerCase().includes("woman")?be["identity-woman"]:ee.toLowerCase().includes("men")||ee.toLowerCase().includes("man")?be["identity-man"]:ee.toLowerCase().includes("couple")?be["identity-couple"]:"";return r.jsxs("button",{type:"button",className:`${be.interestTag} ${de?`${be.selected} ${ye}`:ye}`,onClick:()=>A&&he(ee),disabled:!A||!de&&w.details.lookingFor.length>=3,"aria-pressed":de,children:[o(ee)||ee,de&&r.jsx(jt,{style:{marginLeft:"4px"}})]},ee)})}),w.details.lookingFor.length===0&&!A&&r.jsx("p",{className:`${be.textMuted} ${be.fstItalic} ${be.mt2}`,children:d.notSpecified})]}),r.jsxs("div",{className:be.infoSection,children:[r.jsx("h3",{className:be.sectionTitle,children:d.imInto}),A&&r.jsx("div",{className:`${be.textMuted} ${be.mb2}`,children:d.intoTagsLimit}),r.jsx("div",{className:be.interestsTags,children:R.map(ee=>{const de=w.details.intoTags.includes(ee);return r.jsxs("button",{type:"button",className:`${be.interestTag} ${de?be.selected:""}`,onClick:()=>A&&re(ee),disabled:!A||!de&&w.details.intoTags.length>=20,"aria-pressed":de,children:[o(ee)||ee,de&&r.jsx(jt,{style:{marginLeft:"4px"}})]},ee)})}),w.details.intoTags.length===0&&!A&&r.jsx("p",{className:`${be.textMuted} ${be.fstItalic} ${be.mt2}`,children:d.noTagsSelected})]}),r.jsxs("div",{className:be.infoSection,children:[r.jsx("h3",{className:be.sectionTitle,children:d.turnOns}),A&&r.jsx("div",{className:`${be.textMuted} ${be.mb2}`,children:d.turnOnsLimit}),r.jsx("div",{className:be.interestsTags,children:j.map(ee=>{const de=w.details.turnOns.includes(ee);return r.jsxs("button",{type:"button",className:`${be.interestTag} ${de?be.selected:""}`,onClick:()=>A&&_e(ee),disabled:!A||!de&&w.details.turnOns.length>=20,"aria-pressed":de,children:[o(ee)||ee,de&&r.jsx(jt,{style:{marginLeft:"4px"}})]},ee)})}),w.details.turnOns.length===0&&!A&&r.jsx("p",{className:`${be.textMuted} ${be.fstItalic} ${be.mt2}`,children:d.noTagsSelected})]})]})]})]})})})]})},us=Ze.create("SettingsService"),u3={notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0},privacy:{showOnlineStatus:!0,showReadReceipts:!0,showLastSeen:!0,allowStoryReplies:"everyone"}},aa={getUserSettings:async()=>{try{us.debug("Fetching user settings from /auth/me endpoint");const e=await qe.get("/auth/me");if(e.success&&e.data){const t=e.data.settings||u3;return us.debug("Successfully fetched user settings"),{success:!0,data:t}}else return us.error("API returned unsuccessful response",e),{success:!1,error:e.error||"Failed to fetch settings",data:null}}catch(e){return us.error("Error fetching user settings",e),{success:!1,error:e.message||"Failed to fetch settings",data:null}}},updateSettings:async e=>{try{us.debug("Updating settings via /users/profile endpoint");const t=await qe.put("/users/profile",{settings:e});return t.success?(us.debug("Settings update successful"),{success:!0,data:e}):(us.warn("Settings update failed",t),{success:!1,error:t.error||"Failed to update settings",data:null})}catch(t){return us.error("Error updating settings",t),{success:!1,error:t.message||"Failed to update settings",data:null}}},updateNotificationSettings:async e=>{try{us.debug("Updating notification settings",{notificationSettings:e});const t=await qe.put("/users/profile",{settings:{notifications:e}});return t.success?(us.debug("Notification settings update successful"),{success:!0,data:{notifications:e}}):(us.warn("Notification settings update failed",t),{success:!1,error:t.error||"Failed to update notification settings",data:null})}catch(t){return us.error("Error updating notification settings",t),{success:!1,error:t.message||"Failed to update notification settings",data:null}}},updatePrivacySettings:async e=>{try{us.debug("Updating privacy settings",{privacySettings:e});const t=await qe.put("/users/profile",{settings:{privacy:e}});return t.success?(us.debug("Privacy settings update successful"),{success:!0,data:{privacy:e}}):(us.warn("Privacy settings update failed",t),{success:!1,error:t.error||"Failed to update privacy settings",data:null})}catch(t){return us.error("Error updating privacy settings",t),{success:!1,error:t.message||"Failed to update privacy settings",data:null}}},deleteAccount:async e=>{try{us.info("Attempting account deletion");const t=await qe.delete("/users/account",{data:{password:e}});return us.info("Account deletion successful"),t.data}catch(t){throw us.error("Error deleting account",t),t}}},Cs=Ze.create("SubscriptionService"),h3={accountTier:"FREE",isPaid:!1,dailyLikesRemaining:3,canSendMessages:!1,canCreateStory:!0},Fa={getSubscriptionStatus:async()=>{var e;try{Cs.debug("Fetching subscription status");const t=await qe.get("/subscription/status");return Cs.debug("Subscription status received",{tier:(e=t==null?void 0:t.data)==null?void 0:e.accountTier}),t}catch(t){return Cs.error("Error fetching subscription status",t),{success:!0,data:h3}}},upgradeSubscription:async e=>{try{if(!e||!["monthly","yearly"].includes(e))throw new Error("Invalid subscription plan. Please choose monthly or yearly.");Cs.info(`Upgrading subscription to ${e} plan`);const t=await qe.post("/subscription/upgrade",{plan:e});if(t.success)return Cs.info("Subscription upgrade successful",{plan:e}),Z.success(`Successfully upgraded to ${e} plan!`),t;throw Cs.warn("Subscription upgrade failed",{error:t.error}),new Error(t.error||"Failed to upgrade subscription")}catch(t){throw Cs.error("Error upgrading subscription",t),Z.error(t.message||"Failed to upgrade subscription"),t}},cancelSubscription:async()=>{try{Cs.info("Canceling subscription");const e=await qe.post("/subscription/cancel");if(e.success)return Cs.info("Subscription cancellation successful"),Z.info(e.message||"Subscription successfully canceled"),e;throw Cs.warn("Subscription cancellation failed",{error:e.error}),new Error(e.error||"Failed to cancel subscription")}catch(e){throw Cs.error("Error canceling subscription",e),Z.error(e.message||"Failed to cancel subscription"),e}},checkActionPermission:async e=>{try{if(!["message","like","story"].includes(e))throw Cs.warn(`Invalid action type requested: ${e}`),new Error("Invalid action type");Cs.debug(`Checking permission for action: ${e}`);const s=await Fa.getSubscriptionStatus();if(!s.success)throw Cs.warn("Could not verify subscription status"),new Error("Could not verify subscription status");const{data:n}=s;let o;switch(e){case"message":o={allowed:n.canSendMessages,reason:n.canSendMessages?null:"Messaging requires a premium account"};break;case"like":o={allowed:n.accountTier!=="FREE"||n.dailyLikesRemaining>0,reason:n.dailyLikesRemaining>0?null:"You have used all your daily likes",remaining:n.dailyLikesRemaining};break;case"story":o={allowed:n.canCreateStory,reason:n.canCreateStory?null:`Story creation available in ${n.storyCooldown} hours`,cooldown:n.storyCooldown};break;default:o={allowed:!1,reason:"Unknown action type"}}return Cs.debug(`Permission check result for ${e}:`,{allowed:o.allowed}),o}catch(t){return Cs.error(`Error checking permission for ${e}`,t),{allowed:!1,reason:t.message||"Could not verify permissions"}}}},f3="_dark_1wrhd_16",g3="_settingsPage_1wrhd_4",p3="_settingsContent_1wrhd_21",m3="_settingsContainer_1wrhd_31",y3="_gradientBar_1wrhd_56",v3="_settingsTitle_1wrhd_66",_3="_settingsNavigation_1wrhd_77",w3="_navItem_1wrhd_89",b3="_active_1wrhd_119",x3="_navIcon_1wrhd_134",S3="_settingsPanel_1wrhd_144",C3="_sectionHeader_1wrhd_150",k3="_sectionIcon_1wrhd_164",N3="_sectionTitle_1wrhd_169",E3="_settingsOption_1wrhd_186",T3="_optionContent_1wrhd_214",A3="_optionTitle_1wrhd_218",j3="_optionDescription_1wrhd_229",I3="_toggleWrapper_1wrhd_240",$3="_toggleInput_1wrhd_247",P3="_toggleSlider_1wrhd_253",R3="_radioGroup_1wrhd_291",M3="_radioOption_1wrhd_297",L3="_radioInput_1wrhd_311",O3="_themeOptions_1wrhd_346",F3="_themeOption_1wrhd_346",D3="_themePreview_1wrhd_387",B3="_light_1wrhd_400",U3="_system_1wrhd_452",q3="_themeName_1wrhd_478",z3="_accountInfo_1wrhd_489",H3="_accountDetail_1wrhd_514",V3="_accountLabel_1wrhd_531",W3="_accountActions_1wrhd_542",G3="_actionButton_1wrhd_548",Y3="_editButton_1wrhd_567",K3="_logoutButton_1wrhd_571",J3="_deleteButton_1wrhd_575",Q3="_actionIcon_1wrhd_579",X3="_saveSection_1wrhd_589",Z3="_saveButton_1wrhd_595",e8="_hasChanges_1wrhd_622",t8="_modalOverlay_1wrhd_639",s8="_modalContainer_1wrhd_653",n8="_modalHeader_1wrhd_670",r8="_modalTitle_1wrhd_682",o8="_closeButton_1wrhd_692",i8="_modalContent_1wrhd_714",a8="_warningBox_1wrhd_718",c8="_warningIcon_1wrhd_732",l8="_warningText_1wrhd_740",d8="_warningList_1wrhd_750",u8="_warningItem_1wrhd_760",h8="_passwordSection_1wrhd_764",f8="_passwordLabel_1wrhd_768",g8="_passwordInput_1wrhd_779",p8="_error_1wrhd_804",m8="_errorMessage_1wrhd_808",y8="_modalActions_1wrhd_817",v8="_buttonCancel_1wrhd_829",_8="_buttonDelete_1wrhd_855",w8="_blockedUsersSection_1wrhd_883",b8="_sectionDescription_1wrhd_899",x8="_blockedUsersList_1wrhd_909",S8="_blockedUserItem_1wrhd_915",C8="_blockedUserInfo_1wrhd_940",k8="_blockedUserAvatar_1wrhd_946",N8="_blockedUserName_1wrhd_958",E8="_unblockButton_1wrhd_967",T8="_emptyState_1wrhd_987",A8="_emptyStateIcon_1wrhd_999",j8="_loadingState_1wrhd_1010",I8="_spinner_1wrhd_1018",$8="_loadingText_1wrhd_1028",P8="_languageWrapper_1wrhd_1043",R8="_optionIcon_1wrhd_1156",ae={dark:f3,settingsPage:g3,settingsContent:p3,settingsContainer:m3,gradientBar:y3,settingsTitle:v3,settingsNavigation:_3,navItem:w3,active:b3,navIcon:x3,settingsPanel:S3,sectionHeader:C3,sectionIcon:k3,sectionTitle:N3,settingsOption:E3,optionContent:T3,optionTitle:A3,optionDescription:j3,toggleWrapper:I3,toggleInput:$3,toggleSlider:P3,radioGroup:R3,radioOption:M3,radioInput:L3,themeOptions:O3,themeOption:F3,themePreview:D3,light:B3,system:U3,themeName:q3,accountInfo:z3,accountDetail:H3,accountLabel:V3,accountActions:W3,actionButton:G3,editButton:Y3,logoutButton:K3,deleteButton:J3,actionIcon:Q3,saveSection:X3,saveButton:Z3,hasChanges:e8,modalOverlay:t8,modalContainer:s8,modalHeader:n8,modalTitle:r8,closeButton:o8,modalContent:i8,warningBox:a8,warningIcon:c8,warningText:l8,warningList:d8,warningItem:u8,passwordSection:h8,passwordLabel:f8,passwordInput:g8,error:p8,errorMessage:m8,modalActions:y8,buttonCancel:v8,buttonDelete:_8,blockedUsersSection:w8,sectionDescription:b8,blockedUsersList:x8,blockedUserItem:S8,blockedUserInfo:C8,blockedUserAvatar:k8,blockedUserName:N8,unblockButton:E8,emptyState:T8,emptyStateIcon:A8,loadingState:j8,spinner:I8,loadingText:$8,languageWrapper:P8,optionIcon:R8},At=Ze.create("Settings"),M8=()=>{const e=ps(),{user:t,logout:s,getCurrentUser:n}=Xt(),{theme:o,setTheme:i}=nc(),{currentUser:c,updateProfile:l,getUser:u,getBlockedUsers:h,unblockUser:a}=Bn(),{t:d}=Ht(),{language:f,changeLanguage:v,supportedLanguages:g,getLanguageDisplayName:b}=ss(),$=p.useRef(null),T=p.useRef(null),F=En(),{isTouch:M,isIOS:E,isAndroid:U}=Nr(),[A,D]=p.useState([]),[w,N]=p.useState(!1),P={notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0},privacy:{showOnlineStatus:!0,showReadReceipts:!0,showLastSeen:!0,allowStoryReplies:"everyone"}},[x,k]=p.useState(P),[R,j]=p.useState("notifications"),[I,S]=p.useState(!1),[C,G]=p.useState(!1),[V,L]=p.useState(""),[X,q]=p.useState(""),[z,K]=p.useState(!1),[W,H]=p.useState(!1),[ne,Q]=p.useState(!0),[he,re]=p.useState(null);p.useEffect(()=>{if(W&&c)return;At.debug("useEffect for settings loading triggered"),c?(async()=>{var de,ye,oe,fe,ie,te,Y,_,m,y,B,J,ce,pe,$e,We,ct,ft,ht,qt,Gt,ns,As,Ne,Ie,et,at,Tt,st,es;try{At.info("Fetching fresh settings from the server");const vt=await aa.getUserSettings();if(vt&&vt.success&&vt.data){At.info("Successfully loaded settings from server:",vt.data),At.debug("Message notifications from server:",(de=vt.data.notifications)==null?void 0:de.messages,"typeof:",typeof((ye=vt.data.notifications)==null?void 0:ye.messages));const Pe={notifications:{messages:((oe=vt.data.notifications)==null?void 0:oe.messages)===!1?!1:!!((fe=vt.data.notifications)!=null&&fe.messages),calls:((ie=vt.data.notifications)==null?void 0:ie.calls)===!1?!1:!!((te=vt.data.notifications)!=null&&te.calls),stories:((Y=vt.data.notifications)==null?void 0:Y.stories)===!1?!1:!!((_=vt.data.notifications)!=null&&_.stories),likes:((m=vt.data.notifications)==null?void 0:m.likes)===!1?!1:!!((y=vt.data.notifications)!=null&&y.likes),comments:((B=vt.data.notifications)==null?void 0:B.comments)===!1?!1:!!((J=vt.data.notifications)!=null&&J.comments)},privacy:{showOnlineStatus:((ce=vt.data.privacy)==null?void 0:ce.showOnlineStatus)??P.privacy.showOnlineStatus,showReadReceipts:((pe=vt.data.privacy)==null?void 0:pe.showReadReceipts)??P.privacy.showReadReceipts,showLastSeen:(($e=vt.data.privacy)==null?void 0:$e.showLastSeen)??P.privacy.showLastSeen,allowStoryReplies:((We=vt.data.privacy)==null?void 0:We.allowStoryReplies)??P.privacy.allowStoryReplies}};At.debug("Normalized settings to apply:",Pe),At.debug("Message notifications in normalized settings:",Pe.notifications.messages,"typeof:",typeof Pe.notifications.messages),k(Pe),H(!0);return}}catch(vt){At.error("Error fetching settings from server:",vt)}if(c&&c.settings){At.info("Falling back to currentUser settings:",c.settings);const vt=c.settings||{},Pe={notifications:{messages:((ct=vt.notifications)==null?void 0:ct.messages)===!1?!1:!!((ft=vt.notifications)!=null&&ft.messages),calls:((ht=vt.notifications)==null?void 0:ht.calls)===!1?!1:!!((qt=vt.notifications)!=null&&qt.calls),stories:((Gt=vt.notifications)==null?void 0:Gt.stories)===!1?!1:!!((ns=vt.notifications)!=null&&ns.stories),likes:((As=vt.notifications)==null?void 0:As.likes)===!1?!1:!!((Ne=vt.notifications)!=null&&Ne.likes),comments:((Ie=vt.notifications)==null?void 0:Ie.comments)===!1?!1:!!((et=vt.notifications)!=null&&et.comments)},privacy:{showOnlineStatus:((at=vt.privacy)==null?void 0:at.showOnlineStatus)??P.privacy.showOnlineStatus,showReadReceipts:((Tt=vt.privacy)==null?void 0:Tt.showReadReceipts)??P.privacy.showReadReceipts,showLastSeen:((st=vt.privacy)==null?void 0:st.showLastSeen)??P.privacy.showLastSeen,allowStoryReplies:((es=vt.privacy)==null?void 0:es.allowStoryReplies)??P.privacy.allowStoryReplies}};At.debug("Normalized settings from user object:",Pe),At.debug("Message notifications in normalized user settings:",Pe.notifications.messages,"typeof:",typeof Pe.notifications.messages),k(Pe),H(!0)}else At.info("No settings available, using defaults"),H(!0)})():At.warn("No currentUser available, skipping settings load")},[c,P,W]);const _e=(ee,de)=>{const ye=!!x[ee][de];At.debug(`Toggling ${ee}.${de}:`,`Current value: ${ye} (${typeof x[ee][de]})`,`New value: ${!ye}`),k(oe=>{const fe={...oe,[ee]:{...oe[ee],[de]:!ye}};return At.debug("New settings after toggle:",fe),fe}),K(!0)},ke=(ee,de,ye)=>{k(oe=>({...oe,[ee]:{...oe[ee],[de]:ye}})),K(!0)},Be=ee=>{i(ee)},Oe=async()=>{try{G(!0),At.info("Saving settings:",x);const ee={notifications:{messages:x.notifications.messages===!1?!1:!!x.notifications.messages,calls:x.notifications.calls===!1?!1:!!x.notifications.calls,stories:x.notifications.stories===!1?!1:!!x.notifications.stories,likes:x.notifications.likes===!1?!1:!!x.notifications.likes,comments:x.notifications.comments===!1?!1:!!x.notifications.comments},privacy:{...x.privacy}};At.debug("Normalized settings before saving:",ee),At.debug("Messages notification specifically:",ee.notifications.messages);const de=await aa.updateSettings(ee);if(!de.success)throw new Error(de.error||"Failed to save settings");c&&(At.info("Updating user profile with normalized settings"),await l({settings:ee})||At.warn("User profile update returned empty response")),At.info("Updating notification service with normalized settings:",ee.notifications),Ls.updateSettings(ee.notifications),At.info("Updating socket service with settings:",ee.privacy),Ae.updatePrivacySettings(ee.privacy),At.info("Services updated with new settings"),Z.success("Settings saved successfully"),K(!1),At.debug("Setting current UI state to match saved settings"),k(ee)}catch(ee){At.error("Error saving settings:",ee),Z.error(ee.message||"Failed to save settings. Please try again.")}finally{G(!1)}},Se=()=>{z?window.confirm(d("unsavedChangesLogout","You have unsaved changes. Are you sure you want to log out?"))&&(s(),e("/login")):(s(),e("/login"))},Le=()=>{S(!0)},Me=async()=>{try{if(q(""),!V){q(d("passwordRequired","Please enter your password to confirm account deletion"));return}const ee=await aa.deleteAccount({password:V});ee.success?(Z.success(d("accountDeletedSuccess","Account deleted successfully")),s(),e("/login")):q(ee.error||d("deleteAccountFailed","Failed to delete account"))}catch(ee){At.error("Error deleting account:",ee),q(ee.error||d("deleteAccountFailedRetry","Failed to delete account. Please try again."))}},He=()=>{S(!1),L(""),q("")};p.useEffect(()=>{if(W){Q(!1);return}At.debug("Combined loading effect running"),At.debug("User available:",!!t,"currentUser available:",!!c),(async()=>{if(t&&!c&&t._id){At.info("User exists but currentUser is not available yet - fetching user profile");try{typeof u=="function"&&(At.debug("Using getUser from UserContext to fetch profile"),await u(t._id)),!c&&typeof n=="function"&&(At.debug("Using getCurrentUser from AuthContext to fetch profile"),await n())}catch(de){At.error("Error fetching user profile:",de)}}c&&Q(!1)})()},[t,c,n,u,W]);const ut=p.useCallback(async()=>{if(!c||!c._id){At.warn("Cannot load blocked users: no current user");return}N(!0);try{At.info("Loading blocked users from Settings component");const ee=await h();At.debug("Blocked users data:",ee),ee&&Array.isArray(ee)?D(ee):(At.warn("Blocked users data is not an array:",ee),D([]))}catch(ee){At.error("Error loading blocked users:",ee),D([])}finally{N(!1)}},[h,c]);p.useEffect(()=>{R==="privacy"&&ut()},[R,ut]),p.useEffect(()=>{let ee=null;return M&&T.current&&(ee=no(T.current),At.debug("Mobile scroll enhancements applied to Settings")),()=>{ee&&ee()}},[M]);const tt=p.useCallback(async(ee,de)=>{if(ee)try{M&&Yt("selectConversation"),await a(ee,de)&&D(oe=>oe.filter(fe=>fe._id!==ee))}catch(ye){At.error("Error unblocking user:",ye),M&&Yt("error"),Z.error("Failed to unblock user")}},[a,M]);p.useEffect(()=>{var fe,ie,te,Y,_,m,y,B,J,ce,pe,$e,We,ct,ft;if(!W||!c||!c.settings)return;const ee=!$.current||$.current._id!==c._id,de=(fe=$.current)==null?void 0:fe.settings,ye=c.settings;if(!ee&&de&&JSON.stringify(de)===JSON.stringify(ye))return;At.debug("Detected meaningful change in currentUser settings, updating UI state");const oe={notifications:{messages:((ie=ye.notifications)==null?void 0:ie.messages)===!1?!1:!!((te=ye.notifications)!=null&&te.messages),calls:((Y=ye.notifications)==null?void 0:Y.calls)===!1?!1:!!((_=ye.notifications)!=null&&_.calls),stories:((m=ye.notifications)==null?void 0:m.stories)===!1?!1:!!((y=ye.notifications)!=null&&y.stories),likes:((B=ye.notifications)==null?void 0:B.likes)===!1?!1:!!((J=ye.notifications)!=null&&J.likes),comments:((ce=ye.notifications)==null?void 0:ce.comments)===!1?!1:!!((pe=ye.notifications)!=null&&pe.comments)},privacy:{showOnlineStatus:(($e=ye.privacy)==null?void 0:$e.showOnlineStatus)??P.privacy.showOnlineStatus,showReadReceipts:((We=ye.privacy)==null?void 0:We.showReadReceipts)??P.privacy.showReadReceipts,showLastSeen:((ct=ye.privacy)==null?void 0:ct.showLastSeen)??P.privacy.showLastSeen,allowStoryReplies:((ft=ye.privacy)==null?void 0:ft.allowStoryReplies)??P.privacy.allowStoryReplies}};$.current=c,k(oe)},[c,P,W]);const we=()=>{var ee;switch(R){case"notifications":return r.jsxs("div",{className:ae.settingsContent,children:[r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("messageNotifications","Message Notifications")}),r.jsx("p",{className:ae.optionDescription,children:d("messageNotificationsDesc","Get notified when you receive new messages")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.notifications.messages,onChange:()=>_e("notifications","messages"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("callNotifications","Call Notifications")}),r.jsx("p",{className:ae.optionDescription,children:d("callNotificationsDesc","Get notified for incoming calls")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.notifications.calls,onChange:()=>_e("notifications","calls"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("storyNotifications","Story Notifications")}),r.jsx("p",{className:ae.optionDescription,children:d("storyNotificationsDesc","Get notified when friends post new stories")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.notifications.stories,onChange:()=>_e("notifications","stories"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("likeNotifications","Like Notifications")}),r.jsx("p",{className:ae.optionDescription,children:d("likeNotificationsDesc","Get notified when someone likes your content")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.notifications.likes,onChange:()=>_e("notifications","likes"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("commentNotifications","Comment Notifications")}),r.jsx("p",{className:ae.optionDescription,children:d("commentNotificationsDesc","Get notified when someone comments on your content")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.notifications.comments,onChange:()=>_e("notifications","comments"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]})]});case"privacy":return r.jsxs("div",{className:ae.settingsContent,children:[r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("onlineStatus","Online Status")}),r.jsx("p",{className:ae.optionDescription,children:d("onlineStatusDesc","Show when you're active on the app")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.privacy.showOnlineStatus,onChange:()=>_e("privacy","showOnlineStatus"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("readReceipts","Read Receipts")}),r.jsx("p",{className:ae.optionDescription,children:d("readReceiptsDesc","Let others know when you've read their messages")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.privacy.showReadReceipts,onChange:()=>_e("privacy","showReadReceipts"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("lastSeen","Last Seen")}),r.jsx("p",{className:ae.optionDescription,children:d("lastSeenDesc","Show when you were last active")})]}),r.jsxs("label",{className:ae.toggleWrapper,children:[r.jsx("input",{type:"checkbox",checked:x.privacy.showLastSeen,onChange:()=>_e("privacy","showLastSeen"),className:ae.toggleInput}),r.jsx("span",{className:ae.toggleSlider})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("storyReplies","Story Replies")}),r.jsx("p",{className:ae.optionDescription,children:d("storyRepliesDesc","Control who can reply to your stories")})]}),r.jsxs("div",{className:ae.radioGroup,children:[r.jsxs("label",{className:ae.radioOption,children:[r.jsx("input",{type:"radio",name:"storyReplies",value:"everyone",checked:x.privacy.allowStoryReplies==="everyone",onChange:()=>ke("privacy","allowStoryReplies","everyone"),className:ae.radioInput}),d("everyone","Everyone")]}),r.jsxs("label",{className:ae.radioOption,children:[r.jsx("input",{type:"radio",name:"storyReplies",value:"friends",checked:x.privacy.allowStoryReplies==="friends",onChange:()=>ke("privacy","allowStoryReplies","friends"),className:ae.radioInput}),d("friendsOnly","Friends only")]}),r.jsxs("label",{className:ae.radioOption,children:[r.jsx("input",{type:"radio",name:"storyReplies",value:"none",checked:x.privacy.allowStoryReplies==="none",onChange:()=>ke("privacy","allowStoryReplies","none"),className:ae.radioInput}),d("noOne","No one")]})]})]}),r.jsxs("div",{className:ae.blockedUsersSection,children:[r.jsxs("div",{className:ae.sectionHeader,children:[r.jsx(Za,{className:ae.sectionIcon}),r.jsx("h3",{className:ae.sectionTitle,children:d("blockedUsers","Blocked Users")})]}),r.jsx("p",{className:ae.sectionDescription,children:d("blockedUsersDesc","Users you've blocked cannot message you or view your profile")}),w?r.jsxs("div",{className:ae.loadingState,children:[r.jsx("div",{className:ae.spinner}),r.jsx("p",{children:d("loadingBlockedUsers","Loading blocked users...")})]}):A&&A.length>0?r.jsx("div",{className:ae.blockedUsersList,children:A.map(de=>!de||typeof de!="object"||!de._id?null:r.jsxs("div",{className:ae.blockedUserItem,children:[r.jsxs("div",{className:ae.blockedUserInfo,children:[r.jsx("img",{src:de.photos&&de.photos[0]?de.photos[0].url:"/default-avatar.png",alt:de.nickname||d("defaultUser","User"),className:ae.blockedUserAvatar,onError:ye=>{ye.target.src="/default-avatar.png"}}),r.jsx("span",{className:ae.blockedUserName,children:de.nickname||d("defaultUser","User")})]}),r.jsxs("button",{className:ae.unblockButton,onClick:()=>tt(de._id,de.nickname),children:[r.jsx(c1,{})," ",d("unblock","Unblock")]})]},de._id))}):r.jsxs("div",{className:ae.emptyState,children:[r.jsx(d1,{className:ae.emptyStateIcon}),r.jsx("p",{children:d("noBlockedUsers","You haven't blocked any users")})]})]})]});case"appearance":return r.jsxs("div",{className:ae.settingsContent,children:[r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("themeMode","Theme Mode")}),r.jsx("p",{className:ae.optionDescription,children:d("themeModeDesc","Choose how the app appears to you")})]}),r.jsxs("div",{className:ae.themeOptions,children:[r.jsxs("button",{className:`${ae.themeOption} ${o==="light"?ae.active:""}`,onClick:()=>Be("light"),children:[r.jsx("div",{className:`${ae.themePreview} ${ae.light}`}),r.jsx("span",{className:ae.themeName,children:d("light","Light")})]}),r.jsxs("button",{className:`${ae.themeOption} ${o==="dark"?ae.active:""}`,onClick:()=>Be("dark"),children:[r.jsx("div",{className:`${ae.themePreview} ${ae.dark}`}),r.jsx("span",{className:ae.themeName,children:d("dark","Dark")})]}),r.jsxs("button",{className:`${ae.themeOption} ${o==="system"?ae.active:""}`,onClick:()=>Be("system"),children:[r.jsx("div",{className:`${ae.themePreview} ${ae.system}`}),r.jsx("span",{className:ae.themeName,children:d("system","System")})]})]})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsx("h3",{className:ae.optionTitle,children:d("quickThemeToggle","Quick Theme Toggle")}),r.jsx("p",{className:ae.optionDescription,children:d("quickThemeToggleDesc","Quickly switch between light and dark mode")})]}),r.jsx(Uu,{})]}),r.jsxs("div",{className:ae.settingsOption,children:[r.jsxs("div",{className:ae.optionContent,children:[r.jsxs("h3",{className:ae.optionTitle,children:[r.jsx(Vm,{className:ae.optionIcon})," ",d("language","Language")]}),r.jsx("p",{className:ae.optionDescription,children:d("languageDesc","Choose your preferred language")})]}),r.jsx("div",{className:ae.languageWrapper,children:r.jsx(Fu,{display:"section"})})]})]});case"account":return r.jsxs("div",{className:ae.settingsContent,children:[r.jsxs("div",{className:ae.accountInfo,children:[r.jsxs("div",{className:ae.accountDetail,children:[r.jsxs("span",{className:ae.accountLabel,children:[d("username","Username"),":"]})," ",(t==null?void 0:t.username)||d("notAvailable","Not available")]}),r.jsxs("div",{className:ae.accountDetail,children:[r.jsxs("span",{className:ae.accountLabel,children:[d("email","Email"),":"]})," ",(t==null?void 0:t.email)||d("notAvailable","Not available")]}),r.jsxs("div",{className:ae.accountDetail,children:[r.jsxs("span",{className:ae.accountLabel,children:[d("memberSince","Member since"),":"]})," ",t!=null&&t.createdAt?new Date(t.createdAt).toLocaleDateString():d("notAvailable","Not available")]}),r.jsxs("div",{className:ae.accountDetail,children:[r.jsxs("span",{className:ae.accountLabel,children:[d("subscription","Subscription"),":"]})," ",(ee=t==null?void 0:t.subscription)!=null&&ee.plan?d(`${t.subscription.plan.toLowerCase()}Plan`,t.subscription.plan):d("freePlan","Free")]})]}),r.jsxs("div",{className:ae.accountActions,children:[r.jsxs("button",{className:`${ae.actionButton} ${ae.editButton}`,onClick:()=>e("/profile"),children:[r.jsx(Qr,{className:ae.actionIcon}),r.jsx("span",{children:d("editProfile","Edit Profile")})]}),r.jsxs("button",{className:`${ae.actionButton} ${ae.logoutButton}`,onClick:Se,children:[r.jsx(e1,{className:ae.actionIcon}),r.jsx("span",{children:d("logout","Log out")})]}),r.jsxs("button",{className:`${ae.actionButton} ${ae.deleteButton}`,onClick:Le,children:[r.jsx(br,{className:ae.actionIcon}),r.jsx("span",{children:d("deleteAccount","Delete Account")})]})]})]});default:return null}};return!c&&ne&&!he?r.jsxs("div",{className:ae.settingsPage,children:[r.jsx(ro,{}),r.jsx("div",{className:ae.settingsContent,children:r.jsxs("div",{className:ae.settingsContainer,children:[r.jsx("div",{className:ae.gradientBar}),r.jsx("h1",{className:ae.settingsTitle,children:d("settings","Settings")}),r.jsxs("div",{className:ae.loadingState,children:[r.jsx("div",{className:ae.spinner}),r.jsx("p",{className:ae.loadingText,children:d("loadingSettings","Loading your settings...")})]})]})})]}):r.jsxs("div",{ref:T,className:`${ae.settingsPage} ${F?"mobile-optimized":""}`,children:[r.jsx(ro,{}),r.jsx("div",{className:ae.settingsContent,children:r.jsxs("div",{className:ae.settingsContainer,children:[r.jsx("div",{className:ae.gradientBar}),r.jsx("h1",{className:ae.settingsTitle,children:d("settings","Settings")}),r.jsxs("div",{className:ae.settingsNavigation,children:[r.jsxs("button",{className:`${ae.navItem} ${R==="notifications"?ae.active:""}`,onClick:()=>j("notifications"),children:[r.jsx(eo,{className:ae.navIcon}),r.jsx("span",{children:d("notifications","Notifications")})]}),r.jsxs("button",{className:`${ae.navItem} ${R==="privacy"?ae.active:""}`,onClick:()=>j("privacy"),children:[r.jsx(vs,{className:ae.navIcon}),r.jsx("span",{children:d("privacy","Privacy")})]}),r.jsxs("button",{className:`${ae.navItem} ${R==="appearance"?ae.active:""}`,onClick:()=>j("appearance"),children:[r.jsx(Ea,{className:ae.navIcon}),r.jsx("span",{children:d("appearance","Appearance")})]}),r.jsxs("button",{className:`${ae.navItem} ${R==="account"?ae.active:""}`,onClick:()=>j("account"),children:[r.jsx(Qr,{className:ae.navIcon}),r.jsx("span",{children:d("account","Account")})]})]}),r.jsxs("div",{className:ae.settingsPanel,children:[r.jsxs("div",{className:ae.sectionHeader,children:[R==="notifications"&&r.jsx(eo,{className:ae.sectionIcon}),R==="privacy"&&r.jsx(vs,{className:ae.sectionIcon}),R==="appearance"&&r.jsx(Ea,{className:ae.sectionIcon}),R==="account"&&r.jsx(Qr,{className:ae.sectionIcon}),r.jsxs("h2",{className:ae.sectionTitle,children:[R==="notifications"&&d("notificationSettings","Notification Settings"),R==="privacy"&&d("privacySettings","Privacy Settings"),R==="appearance"&&d("appearanceSettings","Appearance Settings"),R==="account"&&d("accountSettings","Account Settings")]})]}),we(),(R==="notifications"||R==="privacy")&&r.jsx("div",{className:ae.saveSection,children:r.jsxs("button",{className:`${ae.saveButton} ${z?ae.hasChanges:""}`,onClick:Oe,disabled:C||!z,children:[r.jsx(Xm,{}),C?d("saving","Saving..."):d("saveChanges","Save Changes")]})})]})]})}),I&&r.jsx("div",{className:ae.modalOverlay,children:r.jsxs("div",{className:ae.modalContainer,children:[r.jsxs("div",{className:ae.modalHeader,children:[r.jsxs("h2",{className:ae.modalTitle,children:[r.jsx(br,{})," ",d("deleteAccount","Delete Account")]}),r.jsx("button",{className:ae.closeButton,onClick:He,children:r.jsx(Ts,{})})]}),r.jsxs("div",{className:ae.modalContent,children:[r.jsxs("div",{className:ae.warningBox,children:[r.jsx(sc,{className:ae.warningIcon}),r.jsxs("p",{className:ae.warningText,children:[d("deleteWarning","This action")," ",r.jsx("strong",{children:d("cannotBeUndone","cannot be undone")}),". ",d("deleteDataWarning","All your data will be permanently deleted, including:")]}),r.jsxs("ul",{className:ae.warningList,children:[r.jsx("li",{className:ae.warningItem,children:d("profileInformation","Your profile information")}),r.jsx("li",{className:ae.warningItem,children:d("messagesAndConversations","All messages and conversations")}),r.jsx("li",{className:ae.warningItem,children:d("photosAndMedia","Photos and media you've shared")}),r.jsx("li",{className:ae.warningItem,children:d("storiesAndContent","Stories and other content")})]})]}),r.jsxs("div",{className:ae.passwordSection,children:[r.jsx("label",{className:ae.passwordLabel,htmlFor:"delete-password",children:d("enterPasswordConfirm","Enter your password to confirm:")}),r.jsx("input",{id:"delete-password",type:"password",value:V,onChange:ee=>L(ee.target.value),placeholder:d("yourPassword","Your password"),className:`${ae.passwordInput} ${X?ae.error:""}`}),X&&r.jsxs("div",{className:ae.errorMessage,children:[r.jsx(Bt,{})," ",X]})]})]}),r.jsxs("div",{className:ae.modalActions,children:[r.jsxs("button",{className:ae.buttonCancel,onClick:He,children:[r.jsx(Ts,{})," ",d("cancel","Cancel")]}),r.jsxs("button",{className:ae.buttonDelete,onClick:Me,disabled:!V,children:[r.jsx(br,{})," ",d("deleteMyAccount","Delete My Account")]})]})]})})]})},L8=()=>{const e=ps(),{t}=Ht(),{isRTL:s}=ss();return r.jsxs("div",{className:`d-flex flex-column align-items-center justify-content-center ${s?"rtl-layout":""}`,style:{height:"80vh",textAlign:"center"},children:[r.jsx("h1",{style:{fontSize:"3rem",marginBottom:"16px"},children:"404"}),r.jsx("p",{style:{marginBottom:"24px"},children:t("notFound")}),r.jsx("button",{className:"btn btn-primary",onClick:()=>e("/"),children:t("backToHome")})]})},Rl=Dn("Home"),Ml=()=>[{_id:"mock1",nickname:"Emma",details:{age:28,location:"New York"},photos:[{url:"https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock2",nickname:"Michael",details:{age:32,location:"Los Angeles"},photos:[{url:"https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock3",nickname:"Sophia",details:{age:26,location:"Chicago"},photos:[{url:"https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock4",nickname:"James",details:{age:30,location:"Miami"},photos:[{url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock5",nickname:"Olivia",details:{age:27,location:"Tel Aviv"},photos:[{url:"https://images.unsplash.com/photo-1524502397800-2eeaad7c3fe5?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock6",nickname:"Daniel",details:{age:33,location:"London"},photos:[{url:"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock7",nickname:"Ava",details:{age:24,location:"Paris"},photos:[{url:"https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0},{_id:"mock8",nickname:"Noah",details:{age:29,location:"Berlin"},photos:[{url:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80"}],isOnline:!0}],O8=()=>{const{t:e}=Ht(),{language:t,changeLanguage:s,dir:n}=ss(),o=ps(),i=En(),{isTouch:c,isIOS:l,isAndroid:u}=Nr(),h=p.useRef(null),a=p.useRef(null),d=p.useRef(0),[f,v]=p.useState(""),[g,b]=p.useState([]),[$,T]=p.useState(!0),[F,M]=p.useState(null),[E,U]=p.useState(null);p.useEffect(()=>{let x=!0;return T(!0),qe.get("/users",{params:{online:!0,limit:12}}).then(k=>{if(!x)return;const R=Array.isArray(k.data)?k.data:[];b(R.length?R:Ml()),M(null)}).catch(k=>{Rl.error("Error fetching online users:",k),x&&(b(Ml()),M(null))}).finally(()=>{x&&(T(!1),setTimeout(()=>{document.querySelectorAll(".staggered-item").forEach(R=>R.classList.add("animated"))},300))}),()=>{x=!1}},[e]),p.useEffect(()=>{let x=null;return c&&h.current&&(x=no(h.current),Rl.debug("Mobile scroll enhancements applied to Home")),()=>{x&&x()}},[c]),p.useEffect(()=>{if(!c||!a.current)return;let x=0,k=0;const R=C=>{x=C.changedTouches[0].screenX},j=C=>{k=C.changedTouches[0].screenX,I()},I=()=>{if(k-x>50){U("right"),c&&Yt("selectConversation");const G=Math.min(Math.max(d.current-1,0),g.length-1);d.current=G;const V=a.current.querySelectorAll(".online-user-card");if(V[G]){const L=V[G].querySelector(".like-btn");L&&(L.classList.add("swiped-right"),setTimeout(()=>L.classList.remove("swiped-right"),500))}}else if(x-k>50){U("left"),c&&Yt("selectConversation");const G=Math.min(Math.max(d.current+1,0),g.length-1);d.current=G;const V=a.current.querySelectorAll(".online-user-card");V.length>0&&(V.forEach(L=>L.classList.add("swiped-left")),setTimeout(()=>{V.forEach(L=>L.classList.remove("swiped-left"))},300))}},S=a.current;return S.addEventListener("touchstart",R,{passive:!0}),S.addEventListener("touchend",j,{passive:!0}),()=>{S.removeEventListener("touchstart",R),S.removeEventListener("touchend",j)}},[c,g.length]);const A=x=>{x.preventDefault(),c&&Yt("send"),o("/register",{state:{email:f}})},D=()=>{c&&Yt("selectConversation"),o("/register")},w=n==="rtl"?wr:Jr;t==="en"?e("languageHebrew","עברית"):e("languageEnglish","English");const N=[{icon:vs,title:e("privacyFirst","Privacy First"),desc:e("privacyDescription","Your privacy is our top priority. Control who sees your profile and what information you share.")},{icon:sc,title:e("secureTitle","Secure Communication"),desc:e("secureCommDescription","End‑to‑end encrypted messaging ensures your conversations remain private and secure.")},{icon:Go,title:e("matchTitle","Smart Matching"),desc:e("smartMatchingDescription","Our advanced algorithm connects you with people who match your preferences and interests.")}],P={"@context":"https://schema.org","@type":"WebSite",name:"Flirtss",url:"https://flirtss.com/",potentialAction:{"@type":"SearchAction",target:"https://flirtss.com/search?q={search_term_string}","query-input":"required name=search_term_string"}};return r.jsxs("div",{ref:h,className:`modern-home-page w-100 overflow-hidden ${i?"mobile-optimized":""}`,dir:n,children:[r.jsx(Tr,{title:"Find Your Perfect Connection",description:"Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful relationships.",schema:P}),r.jsxs("section",{className:"hero-section animate-fade-in py-5 position-relative overflow-hidden",children:[r.jsxs("div",{className:"hero-bg-shapes",children:[r.jsx("div",{className:"shape shape-1"}),r.jsx("div",{className:"shape shape-2"}),r.jsx("div",{className:"shape shape-3"})]}),r.jsxs("div",{className:"hero-content mx-auto text-center p-4 max-w-lg position-relative z-2",children:[r.jsx("h1",{className:"animate-slide-up mb-4 text-shadow font-weight-bold gradient-hero-text",children:e("findYourConnection","Find Your Perfect Connection")}),r.jsx("p",{className:"animate-slide-up delay-200 mb-4 text-md opacity-90 line-height-relaxed",children:e("heroSubtitle","Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful encounters.")}),r.jsxs("form",{onSubmit:A,className:"email-signup-form d-flex gap-2 shadow-md rounded-lg overflow-hidden animate-slide-up delay-300 mx-auto max-w-md",children:[r.jsx("input",{type:"email",placeholder:e("emailPlaceholder","Enter your email"),className:"form-control border-0 py-3 flex-grow-1",value:f,onChange:x=>v(x.target.value),required:!0}),r.jsxs("button",{type:"submit",className:"btn btn-primary btn-lg d-flex align-items-center gap-2 transition-transform hover-scale",children:[r.jsx("span",{children:e("getStarted","Get Started")})," ",r.jsx(w,{})]})]})]})]}),r.jsx("section",{className:"online-users-section animate-fade-in py-5 my-4",children:r.jsxs("div",{className:"container",children:[r.jsxs("div",{className:"section-header text-center mb-5",children:[r.jsxs("h2",{className:"gradient-text animate-slide-up mb-3 d-flex align-items-center justify-content-center gap-2",children:[r.jsx(Go,{})," ",e("peopleOnlineNow","People Online Now")]}),r.jsx("p",{className:"section-subtitle animate-slide-up delay-100 text-opacity-80 max-w-md mx-auto",children:e("onlineNowSubtitle","Connect with these amazing people who are currently active on Mandarin")})]}),$?r.jsx("div",{className:"text-center py-5",children:r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):F?r.jsx("div",{className:"alert alert-danger",children:F}):r.jsx("div",{ref:a,className:`online-users-grid ${i?"swipe-enabled":""}`,children:g.map((x,k)=>{var R,j,I,S;return r.jsxs("div",{className:"online-user-card staggered-item shadow-sm rounded-lg overflow-hidden cursor-pointer transform-gpu hover-scale animated",onClick:D,style:{animationDelay:`${k*.1}s`},children:[r.jsxs("div",{className:"user-card-photo position-relative",children:[r.jsx("img",{src:((j=(R=x.photos)==null?void 0:R[0])==null?void 0:j.url)||"/default-avatar.png",alt:x.nickname,className:"w-100 h-100 object-cover",loading:"lazy",onError:C=>{C.target.src="/default-avatar.png"}}),x.isOnline&&r.jsx("div",{className:"user-status online position-absolute rounded-circle pulse-animation"})]}),r.jsxs("div",{className:"user-card-info p-3",children:[r.jsxs("h3",{className:"user-name mb-1 font-weight-medium text-truncate",children:[x.nickname,", ",((I=x.details)==null?void 0:I.age)||"?"]}),r.jsxs("p",{className:"user-location text-sm mb-2 d-flex align-items-center gap-1 text-opacity-70",children:[r.jsx(to,{})," ",((S=x.details)==null?void 0:S.location)||e("notSpecified","Not specified")]}),r.jsxs("div",{className:"user-actions d-flex gap-2 justify-content-end",children:[r.jsx("button",{className:"mini-action-btn like-btn d-flex align-items-center justify-content-center rounded-circle shadow-sm hover-scale",onClick:C=>{C.stopPropagation(),D()},"aria-label":e("like","Like"),children:r.jsx(au,{className:"action-icon"})}),r.jsx("button",{className:"mini-action-btn message-btn d-flex align-items-center justify-content-center rounded-circle shadow-sm hover-scale",onClick:C=>{C.stopPropagation(),D()},"aria-label":e("message","Message"),children:r.jsx(kr,{className:"action-icon"})})]})]})]},x._id)})}),r.jsx("div",{className:"view-more-container animate-slide-up delay-400 text-center mt-5",children:r.jsxs("button",{className:"btn btn-secondary btn-lg d-inline-flex align-items-center gap-2",onClick:D,children:[e("joinToSeeMore","Join to See More")," ",r.jsx(w,{})]})})]})}),r.jsx("section",{className:"features-section animate-fade-in glass-effect py-5 my-4 mx-3",children:r.jsxs("div",{className:"container",children:[r.jsx("h2",{className:"gradient-text animate-slide-up mb-5 text-center",children:e("featuresTitle","Why Choose Mandarin")}),r.jsx("div",{className:"features-grid",children:N.map(({icon:x,title:k,desc:R},j)=>r.jsxs("div",{className:"feature-card animate-slide-up transition-all text-center",style:{animationDelay:`${j*.15}s`},children:[r.jsx("div",{className:"feature-icon-wrapper mb-4",children:r.jsx("div",{className:"feature-icon d-flex justify-content-center align-items-center mx-auto rounded-circle bg-primary-50",children:r.jsx(x,{})})}),r.jsx("h3",{className:"font-weight-medium mb-3",children:k}),r.jsx("p",{className:"text-opacity-70 line-height-relaxed",children:R})]},j))})]})})]})},Pn=Ze.create("MessagesWrapper"),Po=({children:e})=>{const t=(d,f,v,g,b)=>!d||!f||!v||typeof ra!="function"?(Pn.warn("setupGesturesWithRefs: Missing required elements or utilities"),null):ra({container:d,sidebar:f,chatArea:v,conversationList:g,refreshIndicator:b},{onSidebarShow:()=>{f&&f.classList.remove(Ve.hide),typeof Yt=="function"&&Yt("selectConversation")},onSidebarHide:()=>{f&&f.classList.add(Ve.hide),typeof Yt=="function"&&Yt("selectConversation")},onRefresh:async()=>{try{Pn.info("Attempting to refresh conversations via wrapper..."),Z.info("Refreshing conversations..."),await new Promise(T=>setTimeout(T,800)),typeof Yt=="function"&&Yt("send")}catch(T){Pn.error("Error during refresh:",T),typeof Yt=="function"&&Yt("error")}},onRefreshStart:()=>{Pn.info("Pull-to-refresh started")},onRefreshEnd:()=>{Pn.info("Pull-to-refresh ended")}});ps();const[s,n]=p.useState(!1),o=p.useRef(null),i=p.useRef(null),c=p.useRef(null),l=p.useRef(null),u=p.useRef(null),h=p.useRef(null);p.useEffect(()=>{if(typeof window<"u"){n(!El());const d=f=>{f.preventDefault(),window.deferredPrompt=f,El()||n(!0)};return window.addEventListener("beforeinstallprompt",d),()=>{window.removeEventListener("beforeinstallprompt",d)}}},[]),p.useEffect(()=>{const d=o.current,f=i.current,v=c.current,g=l.current,b=u.current;if(!d||typeof ra!="function")return;if(Pn.debug("MessagesWrapper: Setting up gestures with refs:",{sidebarFound:!!f,chatAreaFound:!!v,conversationListFound:!!g,refreshIndicatorFound:!!b}),!f||!v){const F=setTimeout(()=>{Pn.debug("MessagesWrapper: Retrying gesture setup after delay");const M=i.current,E=c.current;M&&E&&(Pn.info("MessagesWrapper: Refs now available, setting up gestures"),t(o.current,M,E,l.current,u.current))},200);return()=>clearTimeout(F)}const $=t(d,f,v,g,b);let T=null;return h.current&&typeof no=="function"&&(T=no(h.current)),()=>{$&&$(),T&&T()}},[i.current,c.current,l.current,u.current,h.current]);const a=pt.useCallback(d=>{d.sidebarRef&&(i.current=d.sidebarRef.current),d.chatAreaRef&&(c.current=d.chatAreaRef.current),d.conversationsListRef&&(l.current=d.conversationsListRef.current),d.messagesAreaRef&&(h.current=d.messagesAreaRef.current),d.refreshIndicatorRef&&(u.current=d.refreshIndicatorRef.current)},[]);return r.jsx("div",{className:Ve.appWrapper,ref:o,children:pt.Children.map(e,d=>pt.isValidElement(d)?typeof d.type=="string"?d:pt.cloneElement(d,{registerRefs:a}):d)})},Qu=({conversation:e,isActive:t=!1,currentUserId:s,onClick:n})=>{if(!e||!e.user)return console.warn("Invalid conversation object passed to ConversationItem"),null;const{user:o,lastMessage:i,unreadCount:c=0}=e;o.username||(console.debug(`Applying username fallback in ConversationItem for user ${o._id}`),o.username=o.nickname||"Unknown User");const l=c>0;return r.jsxs("div",{className:`${Ve.conversationItem} ${t?Ve.active:""}`,onClick:()=>n(e),role:"listitem","aria-selected":t,tabIndex:0,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&n(e)},children:[r.jsx(lo,{user:o,size:"medium",borderActive:t,status:o.online?"online":"offline",showOnlineStatus:!0}),r.jsxs("div",{className:Ve.conversationDetails,children:[r.jsxs("div",{className:Ve.conversationHeader,children:[r.jsx("span",{className:Ve.conversationName,children:o.nickname||o.username}),r.jsx("span",{className:Ve.messageTime,children:i!=null&&i.createdAt?Yg(i.createdAt):""})]}),r.jsxs("div",{className:Ve.messagePreview,children:[r.jsx("span",{className:Ve.previewText,children:i?Wg(i,s):"No messages yet"}),l&&r.jsxs("div",{className:Ve.unreadIndicator,children:[r.jsx(Rm,{className:Ve.unreadDot,"aria-hidden":"true"}),c>1&&r.jsx("span",{className:Ve.unreadCount,"aria-label":`${c} unread messages`,children:c})]})]})]})]})};Qu.propTypes={conversation:O.shape({user:O.shape({_id:O.string.isRequired,username:O.string.isRequired,nickname:O.string,photo:O.string,online:O.bool}).isRequired,lastMessage:O.shape({content:O.string,createdAt:O.string,type:O.string,sender:O.string}),unreadCount:O.number}).isRequired,isActive:O.bool,currentUserId:O.string.isRequired,onClick:O.func.isRequired};const F8=pt.memo(Qu),Xu=({conversations:e=[],activeConversation:t=null,onConversationSelect:s,onNewConversation:n,currentUserId:o,onRefresh:i,conversationsLoading:c=!1,conversationsListRef:l})=>{const u=p.useRef(null),h=a=>{u.current=a,l&&(l.current=a)};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:Ve.conversationsHeader,children:[r.jsx("h2",{children:"Messages"}),r.jsx("button",{onClick:n,className:Ve.newMessageBtn,"aria-label":"New conversation",title:"Start new conversation",type:"button",children:r.jsx(ou,{})})]}),r.jsx("div",{className:Ve.conversationsList,ref:h,role:"list","aria-label":"Conversation list",children:e.length===0&&!c?r.jsxs("div",{className:Ve.noConversations,children:[r.jsx(gn,{size:24,"aria-hidden":"true"}),r.jsx("p",{children:"No conversations yet"}),r.jsx("button",{onClick:n,className:Ve.startConversationBtn,type:"button",children:"Start a Conversation"})]}):e.map(a=>{var d;return!a||!a.user||!a.user._id?(console.warn("Skipping rendering invalid conversation item:",a),null):(a.user.username||(console.debug(`Applying username fallback for user ${typeof a.user._id=="string"?a.user._id:JSON.stringify(a.user._id)}`),a={...a,user:{...a.user,username:a.user.nickname||"Unknown User"}}),r.jsx(F8,{conversation:a,isActive:((d=t==null?void 0:t.user)==null?void 0:d._id)===a.user._id,currentUserId:o,onClick:s},a.user._id))})})]})};Xu.propTypes={conversations:O.arrayOf(O.shape({user:O.shape({_id:O.string.isRequired,username:O.string.isRequired,nickname:O.string,photo:O.string,online:O.bool}).isRequired,lastMessage:O.shape({content:O.string,createdAt:O.string,type:O.string}),unreadCount:O.number})),activeConversation:O.object,onConversationSelect:O.func.isRequired,onNewConversation:O.func.isRequired,currentUserId:O.string.isRequired,onRefresh:O.func,conversationsLoading:O.bool,conversationsListRef:O.oneOfType([O.func,O.shape({current:O.any})])};const D8=pt.memo(Xu),Zu=({isVisible:e,onClose:t,onEmojiClick:s,customEmojis:n=null})=>{const o=p.useRef(null),i=n||zu;return p.useEffect(()=>{const c=l=>{o.current&&!o.current.contains(l.target)&&!l.target.closest(`.${Ve.emojiButton}`)&&t()};return e&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[e,t]),e?r.jsxs("div",{className:Ve.emojiPicker,ref:o,role:"dialog","aria-label":"Emoji picker",children:[r.jsxs("div",{className:Ve.emojiHeader,children:[r.jsx("h4",{children:"Select Emoji"}),r.jsx("button",{onClick:t,"aria-label":"Close emoji picker",type:"button",children:r.jsx(Ts,{})})]}),r.jsx("div",{className:Ve.emojiList,children:i.map(c=>r.jsx("button",{type:"button",onClick:()=>s(c),title:c,"aria-label":`Emoji ${c}`,children:c},c))})]}):null};Zu.propTypes={isVisible:O.bool.isRequired,onClose:O.func.isRequired,onEmojiClick:O.func.isRequired,customEmojis:O.arrayOf(O.string)};const B8=pt.memo(Zu),eh=({onFileSelected:e,isUploading:t=!1,uploadProgress:s=0,showProgress:n=!1,acceptedFileTypes:o="*"})=>{const i=p.useRef(null),c=l=>{const u=l.target.files[0];u&&e(u),l.target.value=""};return r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"file",ref:i,onChange:c,style:{display:"none"},accept:o,"aria-label":"Upload file"}),n&&t&&r.jsxs("div",{className:Ve.uploadProgressContainer,role:"progressbar","aria-valuenow":s,"aria-valuemin":"0","aria-valuemax":"100",children:[r.jsxs("div",{className:Ve.uploadProgressLabel,children:[r.jsx(Ws,{className:"fa-spin"})," Uploading: ",Math.round(s),"%"]}),r.jsx("div",{className:Ve.uploadProgressBar,children:r.jsx("div",{className:Ve.uploadProgressFill,style:{width:`${s}%`}})})]})]})};eh.propTypes={onFileSelected:O.func.isRequired,isUploading:O.bool,uploadProgress:O.number,showProgress:O.bool,acceptedFileTypes:O.string};const U8=pt.memo(eh),th=({userName:e=null})=>r.jsxs("div",{className:Ve.typingIndicatorBubble,children:[r.jsxs("div",{className:Ve.typingIndicator,children:[r.jsx("div",{className:Ve.dot}),r.jsx("div",{className:Ve.dot}),r.jsx("div",{className:Ve.dot})]}),e&&r.jsxs("span",{className:Ve.typingUserName,children:[e," is typing..."]})]});th.propTypes={userName:O.string};const sh=({messages:e,currentUserId:t,messagesLoading:s=!1,isSending:n=!1,typingUser:o=null,isMobile:i=!1,onScroll:c,messagesEndRef:l})=>{const u=p.useRef(null),{t:h}=Ht(),a=p.useMemo(()=>({messageConversation:h("messageConversation")||"Message conversation",loadingMessages:h("loadingMessages")||"Loading messages",typing:h("typing")||"is typing"}),[h]);p.useEffect(()=>{if(l!=null&&l.current&&u.current){const f=u.current;f.scrollHeight-f.scrollTop-f.clientHeight<200&&l.current.scrollIntoView({behavior:"smooth"})}},[e,l]);const d=Array.isArray(e)?Wa(e):{};return r.jsxs("div",{className:Ve.messagesArea,ref:u,onScroll:c,role:"log","aria-live":"polite","aria-label":a.messageConversation||"Message conversation",children:[Object.entries(d).map(([f,v])=>r.jsxs("div",{className:Ve.messageGroup,children:[r.jsx("div",{className:Ve.dateSeparator,"aria-label":Hc(f),children:Hc(f)}),v.map(g=>r.jsx(yi,{message:g,currentUserId:t,isSending:n,customStyles:Ve},g._id||g.tempId))]},f)),o&&r.jsx(th,{userName:o}),r.jsx("div",{ref:l,className:Ve.messagesEnd,"aria-hidden":"true"})]})};sh.propTypes={messages:O.arrayOf(O.shape({_id:O.string,tempId:O.string,sender:O.string.isRequired,recipient:O.string,content:O.string,createdAt:O.string.isRequired,type:O.string.isRequired})).isRequired,currentUserId:O.string.isRequired,messagesLoading:O.bool,isSending:O.bool,typingUser:O.string,isMobile:O.bool,onScroll:O.func,messagesEndRef:O.oneOfType([O.func,O.shape({current:O.any})])};const q8=pt.memo(sh),is=Ze.create("Messages"),Ll=50,as=()=>Ra("system"),Ol=()=>{var jr,Ir,$r,Ce,lt,St,It,Rt,ws,mn,Fs,yn,Pr,ac;const{userId:e}=hh(),t=ps(),{user:s,loading:n,isAuthenticated:o}=p.useContext(Xa),{blockUser:i,reportUser:c,unblockUser:l}=Bn(),{isUserBlocked:u,markBlockedUsers:h,fetchBlockedUsers:a,blockedUsers:d}=gy(),[f,v]=p.useState([]),[g,b]=p.useState(null),[$,T]=p.useState([]),[F,M]=p.useState(""),[E,U]=p.useState(!0),[A,D]=p.useState(!1),[w,N]=p.useState(null),[P,x]=p.useState(null),k=En(),{isTouch:R,isIOS:j,isAndroid:I}=Nr(),[S,C]=p.useState(!0);p.useMemo(()=>s==null?void 0:s._id,[s==null?void 0:s._id]);const[G,V]=p.useState(!1),[L,X]=p.useState(!1),[q,z]=p.useState(null),[K,W]=p.useState(null),[H,ne]=p.useState(!1),[Q,he]=p.useState(0),[re,_e]=p.useState(!1),[ke,Be]=p.useState(!1),[Oe,Se]=p.useState(!1),[Le,Me]=p.useState(0),[He,ut]=p.useState(0),[tt,we]=p.useState(0),[ee,de]=p.useState(null),[ye,oe]=p.useState(!1),[fe,ie]=p.useState(null),[te,Y]=p.useState(!1),_=p.useRef(null),m=p.useRef(null),y=p.useRef(!1),B=p.useRef(null),J=p.useRef(null),ce=p.useRef(null),pe=p.useRef(null),$e=p.useRef(null),We=p.useRef(null),ct=p.useRef([]);p.useMemo(()=>["😊","😂","😍","❤️","👍","🙌","🔥","✨","🎉","🤔","😉","🥰"],[]),p.useEffect(()=>{ct.current=$,$.forEach(se=>{const ge=se._id||se.tempId;ge&&!qt.current.has(ge)&&qt.current.add(ge)}),qt.current.size>1e3&&Array.from(qt.current).slice(0,500).forEach(ge=>qt.current.delete(ge))},[$]);const ft=p.useRef(0),ht=p.useRef({}),qt=p.useRef(new Set),Gt=p.useRef([]),ns=p.useCallback(se=>{if(se.type==="system")return!1;const ge=se._id||se.tempId;if(ge&&qt.current.has(ge))return console.log("Duplicate message detected by exact ID match:",ge),!0;if(se.sender&&se.content){const Ee=new Date(se.createdAt||Date.now()).getTime(),Fe=`${se.sender}:${se.recipient||""}:${se.type}:${se.content}:${Math.floor(Ee/5e3)}`;if(ct.current&&ct.current.filter(rt=>rt.sender===se.sender&&rt.recipient===(se.recipient||"")&&rt.type===se.type&&rt.content===se.content&&Math.abs(new Date(rt.createdAt||Date.now()).getTime()-Ee)<5e3).length>0)return console.log("Duplicate message detected by content+time signature:",Fe),!0;if(se.type==="wink"&&se.content==="😉"){if(Gt.current.filter(rt=>rt.sender===se.sender&&Date.now()-rt.timestamp<6e4).length>0)return console.log("Duplicate wink detected by time window"),!0;Gt.current.push({sender:se.sender,recipient:se.recipient||"",timestamp:Date.now(),id:ge||`generated-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}),Gt.current=Gt.current.filter(rt=>Date.now()-rt.timestamp<3e5)}}return ge&&(qt.current.add(ge),qt.current.size>1e3&&Array.from(qt.current).slice(0,500).forEach(Fe=>qt.current.delete(Fe))),!1},[]);p.useEffect(()=>{if(typeof window>"u")return;const se=ge=>{ge.preventDefault(),window.deferredPrompt=ge,Be(!0)};return window.addEventListener("beforeinstallprompt",se),window.matchMedia("(display-mode: standalone)").matches&&Be(!1),()=>{typeof window<"u"&&window.removeEventListener("beforeinstallprompt",se)}},[]),p.useEffect(()=>{k?g&&C(!1):C(!0),we(0),de(null)},[k,g]),p.useEffect(()=>{if(n||!o||!(s!=null&&s._id)||y.current){!n&&!o&&(U(!1),N("Please log in to view messages."));return}if(typeof window<"u"){if(!window.__fileMessages){console.log("Initializing file URL caches"),window.__fileMessages={};try{const ge=localStorage.getItem("mandarin_file_urls");if(ge){const Ee=JSON.parse(ge);Ee&&typeof Ee=="object"&&(window.__fileMessages=Ee,console.log(`Restored ${Object.keys(Ee).length} file URLs from localStorage`))}}catch(ge){console.warn("Failed to load persisted file URLs by ID",ge)}}if(!window.__fileMessagesByHash){window.__fileMessagesByHash={};try{const ge=localStorage.getItem("mandarin_file_urls_by_hash");if(ge){const Ee=JSON.parse(ge);Ee&&typeof Ee=="object"&&(window.__fileMessagesByHash=Ee,console.log(`Restored ${Object.keys(Ee).length} file URLs by hash from localStorage`))}else if(window.__fileMessages&&Object.keys(window.__fileMessages).length>0){console.log("Building hash-based cache from ID-based cache");const Ee=Fe=>{if(!Fe)return"";const Qe=Fe.fileName||"",rt=Fe.timestamp?new Date(Fe.timestamp).toISOString().substring(0,16):"";return`${Qe}-${rt}`};Object.entries(window.__fileMessages).forEach(([Fe,Qe])=>{if(Qe.url){const rt=Qe.hash||Ee(Qe);rt&&(window.__fileMessagesByHash[rt]={...Qe,id:Fe})}});try{localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash)),console.log(`Created and persisted ${Object.keys(window.__fileMessagesByHash).length} hash-based URL entries`)}catch(Fe){console.warn("Failed to persist hash-based file URLs",Fe)}}}catch(ge){console.warn("Failed to load persisted file URLs by hash",ge)}}window.__fileUrlCleanupTimeout||(window.__fileUrlCleanupTimeout=setTimeout(()=>{try{if(window.__fileMessages&&Object.keys(window.__fileMessages).length>300){const ge=Object.entries(window.__fileMessages);ge.sort((Ee,Fe)=>(Fe[1].timestamp||0)-(Ee[1].timestamp||0)),window.__fileMessages=Object.fromEntries(ge.slice(0,300)),localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log(`Cleaned up file URL cache, kept ${Object.keys(window.__fileMessages).length} entries`)}if(window.__fileMessagesByHash&&Object.keys(window.__fileMessagesByHash).length>300){const ge=Object.entries(window.__fileMessagesByHash);ge.sort((Ee,Fe)=>(Fe[1].timestamp||0)-(Ee[1].timestamp||0)),window.__fileMessagesByHash=Object.fromEntries(ge.slice(0,300)),localStorage.setItem("mandarin_file_urls_by_hash",JSON.stringify(window.__fileMessagesByHash))}window.__fileUrlCleanupTimeout=null}catch(ge){console.warn("Error during file URL cache cleanup",ge)}},3e4))}(async()=>{try{U(!0),N(null),await Et.initialize(s),y.current=!0,await at()}catch(ge){console.error("Chat initialization error:",ge);const Ee=ge.message||"Failed to initialize chat service.";N(Ee+" Please refresh the page."),Z.error(Ee),y.current=!1}finally{U(!1)}})()},[s,o,n]),p.useEffect(()=>{if(!y.current||!(s!=null&&s._id)||typeof window>"u")return;const se=ve=>{var sn,Tn,nn,Rr,cc,lc;if(is.debug("Message received:",ve),ns(ve)){is.debug("Skipping duplicate message in handleMessageReceived");return}if(ve._id&&ct.current){if(ct.current.find(zt=>zt._id===ve._id)){is.debug("Duplicate message detected in messagesRef by ID:",ve._id);return}if(ve.sender&&ve.content&&ct.current.filter(Wt=>Wt.sender===ve.sender&&Wt.content===ve.content&&Wt.type===ve.type&&Math.abs(new Date(Wt.createdAt).getTime()-new Date(ve.createdAt).getTime())<3e3).length>0){is.debug("Likely duplicate message detected using content+time matching:",ve.content);return}}const wt=Ue=>{const zt=Ue.sender||"",Wt=Ue.recipient||"",rn=(Ue.content||"").substring(0,200),vn=Ue.createdAt?new Date(Ue.createdAt).getTime().toString().substring(0,11):"",_n=Ue.type||"",Ys=[];Ue.metadata&&(Ue.metadata.fileName&&Ys.push(`file:${Ue.metadata.fileName}`),Ue.metadata.fileSize&&Ys.push(`size:${Ue.metadata.fileSize}`),Ue.metadata.mimeType&&Ys.push(`mime:${Ue.metadata.mimeType}`),Ue.metadata.width&&Ue.metadata.height&&Ys.push(`dim:${Ue.metadata.width}x${Ue.metadata.height}`));const bo=Ys.length?`:${Ys.join(":")}`:"";return`${zt}:${Wt}:${_n}:${vn}:${rn}${bo}`},kt=Ue=>{const zt=Ue.sender||"",Wt=Ue.recipient||"",rn=(Ue.content||"").substring(0,50),vn=Ue.createdAt?Math.floor(new Date(Ue.createdAt).getTime()/1e4).toString():"",_n=Ue.type||"";return`${zt}:${Wt}:${_n}:${vn}:${rn}`},Jt=(Ue=>{var rn,vn,_n;if(Ue._id&&Ue.sender&&Ue.recipient&&Ue.createdAt&&(Ue.content&&Ue.type==="text"||Ue.type==="file"&&Ue.metadata&&(Ue.metadata.url||Ue.metadata.fileUrl)))return Ue;let zt=null,Wt=null;try{zt=wt(Ue),Wt=kt(Ue)}catch(Ys){console.warn("Couldn't create recovery hashes for message:",Ys)}return Ue.type==="file"&&Ue._id&&typeof window<"u"&&window.__fileMessages&&((rn=window.__fileMessages[Ue._id])!=null&&rn.url?(console.log(`Recovered file URL for message ${Ue._id} from cache`),Ue.metadata||(Ue.metadata={}),Ue.metadata.url=window.__fileMessages[Ue._id].url,Ue.metadata.fileUrl=window.__fileMessages[Ue._id].url):zt&&((vn=window.__fileMessages[`hash:${zt}`])!=null&&vn.url)?(console.log(`Recovered file URL for message using precise hash ${zt}`),Ue.metadata||(Ue.metadata={}),Ue.metadata.url=window.__fileMessages[`hash:${zt}`].url,Ue.metadata.fileUrl=window.__fileMessages[`hash:${zt}`].url):Wt&&((_n=window.__fileMessages[`fuzzy:${Wt}`])!=null&&_n.url)&&(console.log(`Recovered file URL for message using fuzzy hash ${Wt}`),Ue.metadata||(Ue.metadata={}),Ue.metadata.url=window.__fileMessages[`fuzzy:${Wt}`].url,Ue.metadata.fileUrl=window.__fileMessages[`fuzzy:${Wt}`].url)),Ue.createdAt||(Ue.createdAt=new Date().toISOString()),Ue.status||(Ue.status="sent"),Ue})(ve);if(((sn=Jt.metadata)!=null&&sn.url&&!((Tn=ve.metadata)!=null&&Tn.url)||(nn=Jt.metadata)!=null&&nn.fileUrl&&!((Rr=ve.metadata)!=null&&Rr.fileUrl))&&(console.log("Using recovered version of message with repaired file URLs"),ve=Jt),ve.type==="file"&&window.__lastUploadedFile){const Ue=window.__lastUploadedFile,zt=((cc=ve.metadata)==null?void 0:cc.url)||((lc=ve.metadata)==null?void 0:lc.fileUrl);zt&&zt===Ue.url&&(console.log("Identified message for the file we just uploaded",Ue.id),window.__lastUploadedFile=null)}if(ve.sender!==s._id){const Ue=new Audio("/sounds/call-connect.mp3");Ue.volume=.5,Ue.play().catch(zt=>{console.log("Couldn't play primary notification sound, trying fallback:",zt);const Wt=new Audio("/notification.mp3");Wt.volume=.5,Wt.play().catch(rn=>console.log("Couldn't play fallback notification sound:",rn))})}const hs=ve.sender===s._id?ve.recipient:ve.sender;g&&g.user._id===hs?(T(Ue=>{var vn,_n,Ys,bo;const zt=wt(ve),Wt=kt(ve);if(ve.sender===s._id){console.log("Checking own sent message for duplicates",ve);const Dt=Ue.filter(Ot=>{var Ut,Ds;return Ot.tempId&&Ot.sender===s._id&&Ot.type===ve.type&&(Ot.type==="text"&&Ot.content===ve.content||Ot.type==="wink"&&Ot.content===ve.content||Ot.type==="file"&&((Ut=Ot.metadata)==null?void 0:Ut.fileName)===((Ds=ve.metadata)==null?void 0:Ds.fileName))&&Math.abs(new Date(Ot.createdAt)-new Date(ve.createdAt))<3e4});if(Dt.length>0){console.log("Found optimistic message matches:",Dt.length);const Ot=Ue.findIndex(Ut=>Ut.tempId===Dt[0].tempId);if(Ot!==-1){console.log("Replacing optimistic message with server message");const Ut=[...Ue];if(Ut[Ot]=ve,Dt.length>1){const Ds=Dt.slice(1).map(Bs=>Bs.tempId);return Ut.filter(Bs=>!Bs.tempId||!Ds.includes(Bs.tempId)).sort((Bs,An)=>new Date(Bs.createdAt)-new Date(An.createdAt))}return Ut}}}let rn=Ue.some(Dt=>Dt._id===ve._id||ve.tempId&&Dt.tempId===ve.tempId?(console.log("Exact ID match found, skipping duplicate"),!0):wt(Dt)===zt?(console.log("Precise hash match detected, treating as duplicate",{existing:Dt._id,new:ve._id,hash:zt}),!0):Dt.sender===ve.sender&&Dt.content===ve.content&&Dt.type===ve.type&&Math.abs(new Date(Dt.createdAt)-new Date(ve.createdAt))<3e4?(console.log("Content+time match detected, treating as duplicate",{existing:Dt._id,new:ve._id}),!0):Dt.type==="wink"&&ve.type==="wink"&&Dt.sender===ve.sender&&Dt.content===ve.content&&Math.abs(new Date(Dt.createdAt)-new Date(ve.createdAt))<6e4?(console.log("Wink duplicate detected (within 60s window)"),!0):!1);if(ve.type==="file"&&((vn=ve.metadata)!=null&&vn.url||(_n=ve.metadata)!=null&&_n.fileUrl)){if(console.log("Processing file message:",ve._id),Ue.some(Ot=>Ot._id===ve._id||wt(Ot)===zt||kt(Ot)===Wt))return console.log("Match found (ID or hash), skipping duplicate file message"),Ue;if(ve.sender===s._id){const Ot=Ue.findIndex(Ut=>{var Ds,Bs,An;return Ut.tempId&&Ut.tempId===ve.tempId||Ut.type==="file"&&((Ds=Ut.metadata)==null?void 0:Ds.__localPlaceholder)===!0&&Ut.sender===s._id&&Math.abs(new Date(Ut.createdAt)-new Date(ve.createdAt))<6e4&&(((Bs=Ut.metadata)==null?void 0:Bs.fileName)===((An=ve.metadata)==null?void 0:An.fileName)||Ut.content===ve.content)});if(Ot>=0){console.log("Replacing placeholder with real file message:",ve._id);const Ut=ve.metadata.url||ve.metadata.fileUrl,Ds=[...Ue];Ds[Ot]={...ve,_id:ve._id,tempId:null,metadata:{...ve.metadata,fileUrl:Ut,url:Ut,serverUrl:Ut,__localPlaceholder:!1,__messageHash:zt,__fuzzyHash:Wt}};const Bs=Ue[Ot];if((bo=(Ys=Bs.metadata)==null?void 0:Ys.fileUrl)!=null&&bo.startsWith("blob:"))try{URL.revokeObjectURL(Bs.metadata.fileUrl),console.log("Revoked blob URL for replaced message")}catch(An){console.warn("Error revoking URL:",An)}if(typeof window<"u"&&Ut){window.__fileMessages||(window.__fileMessages={}),ve._id&&(window.__fileMessages[ve._id]={url:Ut,timestamp:Date.now(),messageHash:zt,fuzzyHash:Wt}),window.__fileMessages[`hash:${zt}`]={url:Ut,timestamp:Date.now(),messageId:ve._id},window.__fileMessages[`fuzzy:${Wt}`]={url:Ut,timestamp:Date.now(),messageId:ve._id};try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log(`Cached file URL for ${ve._id} in localStorage with hash backup`)}catch(An){console.warn("Failed to persist file URL to localStorage",An)}}return console.log("Updated file message with actual server data"),Ds}}console.log("New file message received, adding to messages");const Dt={...ve,metadata:{...ve.metadata,fileUrl:ve.metadata.url||ve.metadata.fileUrl,url:ve.metadata.url||ve.metadata.fileUrl,serverUrl:ve.metadata.url||ve.metadata.fileUrl,__processed:!0,__messageHash:zt,__fuzzyHash:Wt}};if(typeof window<"u"){if(window.__fileMessages||(window.__fileMessages={}),Dt._id&&(window.__fileMessages[Dt._id]={url:Dt.metadata.fileUrl,timestamp:Date.now(),messageHash:zt,fuzzyHash:Wt}),window.__fileMessages[`hash:${zt}`]={url:Dt.metadata.fileUrl,timestamp:Date.now(),messageId:Dt._id},window.__fileMessages[`fuzzy:${Wt}`]={url:Dt.metadata.fileUrl,timestamp:Date.now(),messageId:Dt._id},Object.keys(window.__fileMessages).length>150){const Ot=Object.entries(window.__fileMessages);Ot.sort((Ut,Ds)=>Ds[1].timestamp-Ut[1].timestamp),window.__fileMessages=Object.fromEntries(Ot.slice(0,75))}try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log(`Persisted ${Object.keys(window.__fileMessages).length} file URLs to localStorage (with hash redundancy)`)}catch(Ot){console.warn("Failed to persist file URLs to localStorage",Ot)}}return[...Ue,Dt].sort((Ot,Ut)=>new Date(Ot.createdAt)-new Date(Ut.createdAt))}return rn?(console.log("Skipping duplicate message:",ve._id),Ue):(k&&"vibrate"in navigator&&navigator.vibrate(50),[...Ue,ve].sort((Dt,Ot)=>new Date(Dt.createdAt)-new Date(Ot.createdAt)))}),Et.markConversationRead(g.user._id)):k&&"Notification"in window&&Notification.permission==="granted"?new Notification("New message",{body:`New message from ${ve.senderName||"a user"}`,icon:"/icon-192x192.png"}):"Notification"in window&&Notification.permission!=="denied"&&Z.info(`New message from ${ve.senderName||"a user"}`),Gs(ve)},ge=ve=>{g&&ve.userId===g.user._id&&(x(ve.userId),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>x(null),3e3))},Ee=ve=>{ve.connected?Z.success("Reconnected to chat server",{autoClose:2e3}):Z.warning("Disconnected from chat server. Trying to reconnect...")},Fe=ve=>{if(!g||ve.userId!==g.user._id)return;console.debug(`Received incoming call from ${ve.userId}`),z({callId:ve.callId,callerName:g.user.nickname,callerId:ve.userId,timestamp:ve.timestamp}),k&&"vibrate"in navigator&&navigator.vibrate([300,100,300]);const wt={_id:as(),sender:"system",content:`${g.user.nickname} is calling you.`,createdAt:new Date().toISOString(),type:"system"};T(kt=>[...kt,wt])},Qe=ve=>{if(!g||ve.userId!==g.user._id)return;console.debug(`Call accepted by ${g.user.nickname}`);const wt={_id:as(),sender:"system",content:`${g.user.nickname} accepted your call.`,createdAt:new Date().toISOString(),type:"system"};T(kt=>[...kt,wt]),Z.success(`${g.user.nickname} accepted your call`)},rt=ve=>{if(!g||ve.userId!==g.user._id)return;console.debug(`Call declined by ${g.user.nickname}`);const wt={_id:as(),sender:"system",content:`${g.user.nickname} declined your call.`,createdAt:new Date().toISOString(),type:"system"};T(kt=>[...kt,wt]),X(!1),Z.info(`${g.user.nickname} declined your call`)},_t=ve=>{!g||ve.userId!==g.user._id||(console.debug(`Call hung up by ${g.user.nickname}`),L&&rr())},$t=Et.on("messageReceived",se),Ct=Et.on("userTyping",ge),ze=Et.on("connectionChanged",Ee),nt=Ae.on("incomingCall",Fe),gt=Ae.on("callAccepted",Qe),Te=Ae.on("callDeclined",rt),je=Ae.on("videoHangup",_t),Xe=Ae.on("messageRead",ve=>{is.info("Received messageRead event:",ve),T(wt=>wt.map(kt=>kt._id===ve.messageId||ve.messageIds&&ve.messageIds.includes(kt._id)?(is.debug(`Updating read status for message ${kt._id}`),{...kt,read:!0,readAt:ve.readAt||new Date().toISOString()}):kt))}),Kt=Ae.on("photoAccessRevoked",ve=>{if(is.info("Received photoAccessRevoked event:",ve),g&&ve.ownerId===g.user._id){b(kt=>kt&&{...kt,user:{...kt.user||{},photoAccess:!1}}),v(kt=>Array.isArray(kt)?kt.map(js=>!js||!js.user||js.user._id!==ve.ownerId?js:{...js,user:{...js.user,photoAccess:!1}}):[]);const wt={_id:as(),content:`${ve.ownerNickname||"User"} has revoked your access to their private photos`,type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"photoAccessRevoked"};T(kt=>[...kt,wt]),Z.info(`${ve.ownerNickname||"User"} has revoked your access to their private photos`,{icon:"🔒"})}}),bs=Ae.on("messagesRead",ve=>{is.info("Received messagesRead event:",ve),T(wt=>wt.map(kt=>kt.sender===(s==null?void 0:s._id)&&kt.recipient===ve.senderId&&!kt.read?(is.debug(`Marking message ${kt._id} as read by recipient`),{...kt,read:!0,readAt:ve.readAt||new Date().toISOString()}):kt))});return Ae.on("photoAccessRevoked",ve=>{var js;const{ownerId:wt,ownerNickname:kt}=ve;b(Jt=>{var hs;return((hs=Jt==null?void 0:Jt.user)==null?void 0:hs._id)===wt?{...Jt,user:{...Jt.user,photoAccess:!1}}:Jt}),v(Jt=>Jt.map(hs=>{var sn;return((sn=hs.user)==null?void 0:sn._id)===wt?{...hs,user:{...hs.user,photoAccess:!1}}:hs}));try{const Jt=localStorage.getItem("photo-permissions-status")||"{}",hs=JSON.parse(Jt);delete hs[wt],localStorage.setItem("photo-permissions-status",JSON.stringify(hs))}catch(Jt){console.error("Failed to clear localStorage permission:",Jt)}if(((js=g==null?void 0:g.user)==null?void 0:js._id)===wt){const Jt={_id:as(),content:`${kt||"This user"} has revoked your access to their private photos`,type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"photoRevoked"};T(hs=>[...hs,Jt])}Z.info(`${kt||"A user"} has revoked your access to their private photos`,{position:"top-center",autoClose:5e3})}),k&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission(),()=>{$t(),Ct(),ze(),nt(),gt(),Te(),je(),Xe(),bs(),Kt(),B.current&&clearTimeout(B.current)}},[g,s==null?void 0:s._id,L,k,ns]),p.useEffect(()=>{if(y.current&&e&&f.length>0){const se=f.find(ge=>ge.user._id===e);se&&(!g||g.user._id!==se.user._id)?Ar(se):!se&&e!==(s==null?void 0:s._id)&&Tt(e)}},[e,f,s==null?void 0:s._id,g,t]),p.useEffect(()=>{var ge;if(!((ge=g==null?void 0:g.user)!=null&&ge._id)||!(s!=null&&s._id)){T([]);return}if($e.current===g.user._id)return;console.log(`Loading messages for user: ${g.user._id} (previous: ${$e.current})`);const se=g.user._id;return $e.current=se,D(!0),(async()=>{var Ee;try{await st(se),e!==se&&t(`/messages/${se}`,{replace:!0}),po(se),(Ee=m.current)==null||Ee.focus(),k&&C(!1)}catch(Fe){console.error("Error in loading messages:",Fe),N(`Failed to load messages: ${Fe.message||"Unknown error"}`)}finally{$e.current===se&&D(!1)}})(),()=>{console.log(`Cleanup for messages loading. Current: ${$e.current}`)}},[(jr=g==null?void 0:g.user)==null?void 0:jr._id,s==null?void 0:s._id]),p.useEffect(()=>{const se=setTimeout(()=>{var ge;(ge=_.current)==null||ge.scrollIntoView({behavior:"smooth"})},100);return()=>clearTimeout(se)},[$]);const As=p.useMemo(()=>{if(!$||$.length===0)return[];const se=new Set,ge=new Map,Ee=new Map;let Fe=$.length,Qe=0,rt=0,_t=0;const $t=[...$].sort((je,Xe)=>{const Kt=new Date(je.createdAt).getTime(),bs=new Date(Xe.createdAt).getTime();return Kt-bs}),Ct=new Map;$t.forEach(je=>{const Xe=je._id||je.tempId;Xe&&Ct.set(Xe,(Ct.get(Xe)||0)+1)});const ze=Array.from(Ct.entries()).filter(([je,Xe])=>Xe>1).map(([je,Xe])=>({id:je,count:Xe}));ze.length>0&&is.warn(`Found ${ze.length} duplicate message IDs in state:`,ze.map(je=>`${je.id} (${je.count}x)`).join(", "));const nt=$t.filter(je=>je.type==="wink"&&je.content==="😉");nt.length>1&&is.debug(`Found ${nt.length} wink messages in state`);const gt=$t.filter(je=>{if(!je||!je.type&&!je.content)return!1;const Xe=je._id||je.tempId;if(Xe){if(se.has(Xe))return Qe++,!1;se.add(Xe)}if(je.type==="wink"&&je.content==="😉"){const sn=je.sender||"",Tn=Math.floor(new Date(je.createdAt).getTime()/3e5),nn=`${sn}:${Tn}`;if(Ee.has(nn)){const Rr=Ee.get(nn);return Rr.id&&!Xe?(rt++,!1):!Rr.id&&Xe?(Ee.set(nn,{id:Xe,index:$.indexOf(je)}),!0):(rt++,!1)}return Ee.set(nn,{id:Xe,index:$.indexOf(je)}),!0}const Kt=je.sender||"",bs=je.recipient||"",ve=je.content||"",wt=je.type||"",kt=new Date(je.createdAt).getTime(),js=wt==="text"?1e3:5e3,Jt=`${Kt}:${bs}:${wt}:${ve.substring(0,30)}:${Math.floor(kt/js)}`,hs=ge.get(Jt);return hs?!hs.id&&Xe?(ge.set(Jt,{id:Xe,index:$.indexOf(je)}),!0):(_t++,!1):(ge.set(Jt,{id:Xe,index:$.indexOf(je)}),!0)});return Qe+rt+_t>0&&is.info(`Message deduplication: ${gt.length} unique messages from ${Fe} total (removed ${Qe} duplicate IDs, ${rt} duplicate winks, ${_t} duplicate content)`),gt},[$]);p.useEffect(()=>{var se;if((se=g==null?void 0:g.user)!=null&&se._id){const ge=u(g.user._id);ge!==g.user.isBlocked&&b(Ee=>Ee&&{...Ee,user:{...Ee.user,isBlocked:ge}})}},[d,u,(Ir=g==null?void 0:g.user)==null?void 0:Ir._id]);const Ne=p.useCallback(se=>{if(!ce.current)return;const ge=se.touches[0].clientY,Ee=se.touches[0].clientX;Me(ge),ut(Ee),ce.current.scrollTop<=0?Se(!0):Se(!1)},[]),Ie=p.useCallback(se=>{var rt;if(!pe.current)return;const ge=se.touches[0].clientY,Ee=se.touches[0].clientX,Fe=ge-Le,Qe=Ee-He;if(Oe&&Fe>0&&((rt=ce.current)==null?void 0:rt.scrollTop)<=0){const _t=Math.min(Fe*.5,80);we(_t),We.current&&(We.current.style.transform=`translateY(${_t}px)`,We.current.style.opacity=`${Math.min(_t/50,1)}`),se.preventDefault()}else Oe&&Fe<=0&&(Se(!1),we(0),We.current&&(We.current.style.transform="translateY(0)",We.current.style.opacity="0"));Math.abs(Qe)>Math.abs(Fe)&&Math.abs(Qe)>10&&!Oe&&(Qe>Ll&&!S?de("right"):Qe<-50&&S&&de("left"))},[Oe,Le,He,S,Ll]),et=async se=>{if(Oe&&tt>50){We.current&&(We.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",We.current.style.transform="translateY(40px)",We.current.style.opacity="1");try{await at(),We.current&&We.current.classList.add(Ve.refreshSuccess)}catch(ge){console.error("Error refreshing conversations:",ge),We.current&&We.current.classList.add(Ve.refreshError)}finally{setTimeout(()=>{We.current&&(We.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",We.current.style.transform="translateY(0)",We.current.style.opacity="0",We.current.classList.remove(Ve.refreshSuccess,Ve.refreshError)),Se(!1),we(0)},600)}}else Oe&&(We.current&&(We.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",We.current.style.transform="translateY(0)",We.current.style.opacity="0"),Se(!1),we(0));ee==="right"?C(!0):ee==="left"&&C(!1),de(null)},at=p.useCallback(async()=>{if(s!=null&&s._id)try{await a();const se=await Et.getConversations();console.log("Fetched conversations with photo requests:",se);const ge=se.filter(Fe=>{var Qe;return((Qe=Fe==null?void 0:Fe.user)==null?void 0:Qe._id)&&Fe.user._id!==s._id}),Ee=h(ge);if(v(Ee),g&&g.user&&g.user._id){const Fe=Ee.find(Qe=>Qe.user._id===g.user._id);Fe&&b(Fe)}e&&!ge.find(Fe=>Fe.user._id===e)&&e!==s._id&&Tt(e)}catch(se){console.error("Error fetching conversations:",se),Z.error("Failed to load conversations")}},[s==null?void 0:s._id,e]),Tt=p.useCallback(async se=>{var ge,Ee,Fe,Qe;if(!se||se===(s==null?void 0:s._id)){console.warn("Attempted to load own user details or null ID"),se===(s==null?void 0:s._id)&&t("/messages",{replace:!0});return}try{if(D(!0),!/^[0-9a-fA-F]{24}$/.test(se)){console.error("Invalid user ID format:",se),Z.error("Invalid User ID provided."),t("/messages",{replace:!0});return}const _t=((ge=Et.getAuthToken)==null?void 0:ge.call(Et))||(typeof window<"u"?localStorage.getItem("token"):null)||(typeof window<"u"?sessionStorage.getItem("token"):null)||(typeof window<"u"?localStorage.getItem("authToken"):null)||(typeof window<"u"?sessionStorage.getItem("authToken"):null);_t||console.warn("No authentication token found for loading user details");const $t={"Content-Type":"application/json"};_t&&($t.Authorization=`Bearer ${_t}`);const Ct=await qe.get(`/users/${se}`);if(!Ct.success){is.warn(`API error fetching user ${se}.`);let nt="Could not find or load user details.";Ct.status===404&&(nt=`User not found (${se}).`),Z.error(nt),t("/messages",{replace:!0}),N(nt);return}const ze=((Ee=Ct.data)==null?void 0:Ee.user)||Ct.user||Ct.data||Ct;if(ze!=null&&ze._id){const nt={user:{_id:ze._id,nickname:ze.nickname||ze.name||"Unknown User",photo:((Qe=(Fe=ze.photos)==null?void 0:Fe[0])==null?void 0:Qe.url)||ze.photo||null,isOnline:ze.isOnline||!1,accountTier:ze.accountTier||"FREE"},lastMessage:null,unreadCount:0};v(gt=>{const Te=gt.findIndex(je=>je.user._id===se);if(Te>-1){const je=[...gt];return je[Te]={...je[Te],user:nt.user},je}else return[nt,...gt]}),b(nt),T([]),N(null)}else throw new Error("User data not found in API response")}catch(rt){console.error(`Error loading user details for ${se}:`,rt);let _t="Could not load user details.";rt.message.includes("API request failed")?_t=`Could not retrieve user information. ${rt.message}`:rt.message==="User data not found in API response"&&(_t=`User details format error for ${se}.`),N(_t),Z.error(_t)}finally{D(!1)}},[s==null?void 0:s._id,t]),st=p.useCallback(async se=>{if(!(s!=null&&s._id)||!se||se===s._id){console.warn("Attempted to load messages with self or invalid partner ID"),T([]);return}if(!/^[0-9a-fA-F]{24}$/.test(se)){console.error(`Invalid partner user ID format: ${se}`),Z.error("Cannot load messages: Invalid user ID format"),T([]),N("Cannot load messages for this user (Invalid ID).");return}const Ee=se;try{console.log(`Fetching messages for ${se}`);const Fe=await Et.getMessages(se),Qe=Fe.messages||[],rt=Fe.partner,_t=Qe.filter(Te=>Te.type==="wink"&&Te.content==="😉").length;if(console.log(`Loaded ${Qe.length} messages for ${se}, including ${_t} winks`),rt&&rt.photoAccess!==void 0&&(b(Te=>!Te||!Te.user||Te.user._id!==se?Te:{...Te,user:{...Te.user||{},photoAccess:rt.photoAccess}}),v(Te=>Array.isArray(Te)?Te.map(je=>!je||!je.user||je.user._id!==se?je:{...je,user:{...je.user,photoAccess:rt.photoAccess}}):[])),$e.current!==Ee){console.log(`User changed during message fetch. Abandoning results for ${Ee}`);return}console.log(`Loaded ${Qe.length} messages for ${se}`);const Ct=Qe.map(Te=>{if(Te.type==="file"&&Te.metadata){let je=null;typeof window<"u"&&window.__fileMessages&&Te._id&&window.__fileMessages[Te._id]&&(je=window.__fileMessages[Te._id].url,console.log(`Found cached URL for file message ${Te._id}`));const Xe=je||Te.metadata.serverUrl||Te.metadata.url||Te.metadata.fileUrl;if(Xe&&!je&&typeof window<"u"&&Te._id){window.__fileMessages||(window.__fileMessages={}),window.__fileMessages[Te._id]={url:Xe,timestamp:Date.now()},console.log(`Added URL for file message ${Te._id} to cache`);try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages))}catch(Kt){console.warn("Failed to persist file URLs to localStorage",Kt)}}return{...Te,metadata:{...Te.metadata,fileUrl:Xe,url:Xe,serverUrl:Xe,__processed:!0}}}return Te}).sort((Te,je)=>new Date(Te.createdAt)-new Date(je.createdAt)),ze=[],nt=new Map,gt=new Map;for(let Te=0;Te<Ct.length;Te++){const je=Ct[Te];if(!(!je.sender||!je.createdAt)){if(je.type==="wink"&&je.content==="😉"){const Xe=je.sender,Kt=Math.floor(new Date(je.createdAt).getTime()/3e5),bs=`${Xe}:${Kt}`;if(nt.has(bs)){is.debug(`Skipping duplicate wink from ${Xe} during initial load (5min window ${Kt})`);continue}const ve=new Date(je.createdAt).getTime();let wt=!1;for(const[kt,js]of nt.entries()){const[Jt,hs]=kt.split(":");if(Jt===Xe){const sn=Ct.find(Tn=>Tn._id===js);if(sn){const Tn=new Date(sn.createdAt).getTime(),nn=Math.abs(ve-Tn);if(nn<6e4){is.debug(`Found winks from ${Xe} separated by only ${nn}ms - treating as duplicate`),wt=!0;break}}}}if(wt)continue;nt.set(bs,je._id)}else if(je.type&&je.content){const Xe=je.sender,Kt=je.content,bs=je.type,ve=Math.floor(new Date(je.createdAt).getTime()/6e4),wt=`${Xe}:${bs}:${ve}:${Kt.substring(0,20)}`;if(gt.has(wt)){is.debug(`Skipping duplicate ${bs} message from ${Xe}`);continue}gt.set(wt,je._id)}ze.push(je)}}ze.forEach(Te=>{Te._id&&(qt.current.add(Te._id),Te.type==="wink"&&Te.content==="😉"&&Gt.current.push({sender:Te.sender,recipient:Te.recipient||"",timestamp:new Date(Te.createdAt).getTime(),id:Te._id}))}),Gt.current=Gt.current.filter(Te=>Date.now()-Te.timestamp<36e5),is.info(`Loaded ${Ct.length} messages, deduplicated to ${ze.length} (removed ${Ct.length-ze.length} duplicates)`),T(ze),N(null)}catch(Fe){if($e.current!==Ee)return;console.error("Error fetching messages:",Fe);const Qe=`Failed to load messages. ${Fe.message||"Server error"}`;Z.error(Qe),N(Qe),T([])}},[s==null?void 0:s._id]),es=async()=>{var Ct,ze;const se=F.trim();if(!se||!g||!(s!=null&&s._id))return;if(g.user._id===s._id){Z.error("Cannot send messages to yourself");return}if(g.user.isBlocked||u(g.user._id)){Z.error("Cannot send messages to a blocked user");return}const ge=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(ge)){Z.error("Cannot send message: Invalid recipient ID format."),console.error("Attempted to send message to invalid ID format:",ge);return}if((s==null?void 0:s.accountTier)==="FREE"&&se!=="😉"){Z.error("Free accounts can only send winks. Upgrade to send messages.");return}const Ee=Date.now(),Fe=`text:${ge}:${se}`,Qe=ht.current[Fe];if(Qe&&Ee-Qe.timestamp<5e3){Z.info("Please wait a moment before sending the same message again");return}ht.current[Fe]={type:"text",content:se,recipient:ge,timestamp:Ee},Object.keys(ht.current).filter(nt=>Ee-ht.current[nt].timestamp>6e4).forEach(nt=>delete ht.current[nt]);const _t=`temp-${Date.now()}`,$t={_id:_t,tempId:_t,sender:s._id,recipient:ge,content:se,createdAt:new Date().toISOString(),type:"text",read:!1,senderName:s.nickname,senderPhoto:((ze=(Ct=s.photos)==null?void 0:Ct[0])==null?void 0:ze.url)||s.photo};T(nt=>[...nt,$t].sort((gt,Te)=>new Date(gt.createdAt)-new Date(Te.createdAt))),Gs($t),M(""),_e(!0),m.current&&(m.current.style.height="auto"),k&&"vibrate"in navigator&&navigator.vibrate(20);try{const nt=await Et.sendMessage(ge,se);ct.current.find(Te=>Te._id&&!Te.tempId&&Te.type==="text"&&Te.sender===s._id&&Te.recipient===ge&&Te.content===se&&Math.abs(new Date(Te.createdAt)-new Date($t.createdAt))<5e3)?(console.log("Server text message already exists, removing optimistic message"),T(Te=>Te.filter(je=>je.tempId!==_t))):T(Te=>[...Te.filter(Xe=>Xe.tempId!==_t),nt].sort((Xe,Kt)=>new Date(Xe.createdAt)-new Date(Kt.createdAt))),Gs(nt)}catch(nt){console.error("Error sending message:",nt),Z.error(`Failed to send message: ${nt.message||"Please try again."}`),T(gt=>gt.filter(Te=>Te.tempId!==_t)),T(gt=>[...gt,{...$t,error:!0,content:`${se} (Failed)`}].sort((Te,je)=>new Date(Te.createdAt)-new Date(je.createdAt))),Gs({...$t,error:!0})}finally{_e(!1)}},vt=async()=>{var $t,Ct;if(!g||!(s!=null&&s._id)||re)return;if(g.user._id===s._id){Z.error("Cannot send winks to yourself");return}if(g.user.isBlocked||u(g.user._id)){Z.error("Cannot send winks to a blocked user");return}const se=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(se)){Z.error("Cannot send wink: Invalid recipient ID format."),console.error("Attempted to send wink to invalid ID format:",se);return}const ge=Date.now();if(ge-ft.current<5e3){Z.info("Please wait a moment before sending another wink");return}ft.current=ge;const Fe=`wink:${se}:${ge}`;ht.current[Fe]={type:"wink",content:"😉",recipient:se,timestamp:ge},Object.keys(ht.current).filter(ze=>ge-ht.current[ze].timestamp>6e4).forEach(ze=>delete ht.current[ze]),_e(!0);const rt=`temp-wink-${Date.now()}`,_t={_id:rt,tempId:rt,sender:s._id,recipient:se,content:"😉",createdAt:new Date().toISOString(),type:"wink",read:!1,senderName:s.nickname,senderPhoto:((Ct=($t=s.photos)==null?void 0:$t[0])==null?void 0:Ct.url)||s.photo};T(ze=>[...ze,_t].sort((nt,gt)=>new Date(nt.createdAt)-new Date(gt.createdAt))),Gs(_t),k&&"vibrate"in navigator&&navigator.vibrate([20,30,20]);try{const ze=await Et.sendMessage(se,"😉","wink");ct.current.find(gt=>gt._id&&!gt.tempId&&gt.type==="wink"&&gt.sender===s._id&&gt.recipient===se&&Math.abs(new Date(gt.createdAt)-new Date(_t.createdAt))<5e3)?(console.log("Server wink message already exists, removing optimistic message"),T(gt=>gt.filter(Te=>Te.tempId!==rt))):T(gt=>[...gt.filter(je=>je.tempId!==rt),ze].sort((je,Xe)=>new Date(je.createdAt)-new Date(Xe.createdAt))),Gs(ze)}catch(ze){console.error("Error sending wink:",ze),Z.error(`Failed to send wink: ${ze.message||"Please try again."}`),T(nt=>nt.filter(gt=>gt.tempId!==rt)),T(nt=>[...nt,{..._t,error:!0,content:"😉 (Failed)"}].sort((gt,Te)=>new Date(gt.createdAt)-new Date(Te.createdAt))),Gs({..._t,error:!0})}finally{_e(!1)}},Pe=p.useCallback(()=>{if((s==null?void 0:s.accountTier)==="FREE")return Z.error("Free accounts cannot send files. Upgrade to send files.");const se=document.querySelector('input[type="file"]');se&&se.click()},[s==null?void 0:s.accountTier]),uo=p.useCallback(()=>{W(null),he(0),ne(!1),J.current&&(J.current.value="")},[]),ho=async()=>{var Fe,Qe,rt,_t,$t,Ct;if(!K||!((Fe=g==null?void 0:g.user)!=null&&Fe._id)||H)return;if(g.user._id===s._id){Z.error("Cannot send files to yourself");return}if(g.user.isBlocked||u(g.user._id)){Z.error("Cannot send files to a blocked user");return}const se=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(se)){Z.error("Cannot send file: Invalid recipient ID format."),console.error("Attempted to send file to invalid ID format:",se);return}if((s==null?void 0:s.accountTier)==="FREE"){Z.error("Free accounts cannot send files. Upgrade to send files.");return}ne(!0),he(10),k&&"vibrate"in navigator&&navigator.vibrate(40);const ge=`temp-file-${Date.now()}`,Ee={_id:ge,tempId:ge,sender:s._id,recipient:se,content:K.name,createdAt:new Date().toISOString(),type:"file",read:!1,metadata:{fileName:K.name,fileType:K.type,fileSize:K.size,__localPlaceholder:!0,fileUrl:K.type.startsWith("image/")?URL.createObjectURL(K):null,url:K.type.startsWith("image/")?URL.createObjectURL(K):null},senderName:s.nickname,senderPhoto:((rt=(Qe=s.photos)==null?void 0:Qe[0])==null?void 0:rt.url)||s.photo};T(ze=>[...ze,Ee].sort((nt,gt)=>new Date(nt.createdAt)-new Date(gt.createdAt)));try{const ze=new XMLHttpRequest,nt=new FormData;nt.append("file",K),nt.append("recipient",se);const Te=await new Promise((Xe,Kt)=>{var ve;ze.upload.onprogress=wt=>{if(wt.lengthComputable){const kt=Math.round(wt.loaded/wt.total*90)+10;he(kt)}},ze.open("POST","/api/messages/attachments",!0);const bs=((ve=Et.getAuthToken)==null?void 0:ve.call(Et))||(typeof window<"u"?localStorage.getItem("token"):null)||(typeof window<"u"?sessionStorage.getItem("token"):null)||(typeof window<"u"?localStorage.getItem("authToken"):null)||(typeof window<"u"?sessionStorage.getItem("authToken"):null);bs?ze.setRequestHeader("Authorization",`Bearer ${bs}`):console.warn("No auth token found for file upload request."),ze.onload=()=>{if(ze.status>=200&&ze.status<300)try{const wt=JSON.parse(ze.responseText);wt.success&&wt.data?Xe(wt.data):Kt(new Error(wt.error||"Upload processing failed"))}catch(wt){Kt(new Error(`Invalid response format: ${wt.message}`))}else Kt(new Error(`Upload failed: ${ze.status} ${ze.statusText}`))},ze.onerror=()=>Kt(new Error("Network error during upload")),ze.ontimeout=()=>Kt(new Error("Upload timed out")),ze.timeout=6e4,ze.send(nt)});if(he(100),typeof window<"u"){window.__lastUploadedFile={id:ge,url:Te.url,fileName:K.name,timestamp:Date.now()},setTimeout(()=>{window.__lastUploadedFile&&window.__lastUploadedFile.id===ge&&(window.__lastUploadedFile=null)},6e4),window.__fileMessages||(window.__fileMessages={}),window.__fileMessages[ge]={url:Te.url,timestamp:Date.now()};try{localStorage.setItem("mandarin_file_urls",JSON.stringify(window.__fileMessages)),console.log("Persisted uploaded file URL to localStorage")}catch(Xe){console.warn("Failed to persist file URL to localStorage",Xe)}}((_t=ct.current)==null?void 0:_t.find(Xe=>Xe._id&&!Xe.tempId&&Xe.type==="file"&&Xe.sender===s._id&&Xe.recipient===se&&Math.abs(new Date(Xe.createdAt)-new Date(Ee.createdAt))<5e3))?(console.log("Server message already exists, replacing optimistic message"),T(Xe=>Xe.filter(Kt=>Kt.tempId!==ge))):T(Xe=>{const Kt=Xe.filter(ve=>!ve.tempId||ve.tempId!==ge),bs={...Ee,metadata:{...Ee.metadata,fileUrl:Te.url,url:Te.url,__localPlaceholder:!1,serverUrl:Te.url}};return[...Kt,bs].sort((ve,wt)=>new Date(ve.createdAt)-new Date(wt.createdAt))}),Gs({...Ee,metadata:{...Ee.metadata,fileUrl:Te.url,url:Te.url,serverUrl:Te.url,__localPlaceholder:!1}}),Z.success("File uploaded successfully. Sending message..."),W(null),he(0),J.current&&(J.current.value=""),k&&"vibrate"in navigator&&navigator.vibrate([30,50,30])}catch(ze){console.error("Failed to upload or send file:",ze),Z.error(ze.message||"Failed to send file. Please try again."),T(nt=>nt.filter(gt=>gt.tempId!==ge)),(Ct=($t=Ee.metadata)==null?void 0:$t.fileUrl)!=null&&Ct.startsWith("blob:")&&URL.revokeObjectURL(Ee.metadata.fileUrl),T(nt=>[...nt,{...Ee,error:!0,content:`${K.name} (Upload Failed)`}].sort((gt,Te)=>new Date(gt.createdAt)-new Date(Te.createdAt))),k&&"vibrate"in navigator&&navigator.vibrate([100,50,100])}finally{ne(!1)}};p.useCallback(se=>{M(ge=>ge+se),V(!1),m.current&&m.current.focus(),k&&"vibrate"in navigator&&navigator.vibrate(20)},[k]);const fo=async()=>{var ge,Ee,Fe,Qe,rt,_t;if(!((ge=g==null?void 0:g.user)!=null&&ge._id)||!(s!=null&&s._id))return;const se=g.user._id;Ao.getPhotoAccessStatus(g);try{if(Y(!0),(g==null?void 0:g.pendingPhotoRequests)>0){if((await Ao.approvePhotoRequests(se)).success){b(ze=>ze&&{...ze,pendingPhotoRequests:0,user:{...ze.user||{},photoAccess:!0}}),v(ze=>Array.isArray(ze)?ze.map(nt=>!nt||!nt.user||nt.user._id!==se?nt:{...nt,pendingPhotoRequests:0,user:{...nt.user,photoAccess:!0}}):[]);const Ct={_id:as(),content:`You approved photo access for ${g.user.nickname||"this user"}`,type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"photoApproval"};T(ze=>[...ze,Ct])}}else if(((Ee=g==null?void 0:g.user)==null?void 0:Ee.photoAccess)||!1)try{const Ct=await Ao.revokePhotoAccess(se);if(Ct.success){const ze=Ct.revokedCount>0,nt=((Qe=(Fe=Ct.data)==null?void 0:Fe.photoAccess)==null?void 0:Qe.approved)||!1;b(Te=>Te&&{...Te,user:{...Te.user||{},photoAccess:nt}}),v(Te=>Array.isArray(Te)?Te.map(je=>!je||!je.user||je.user._id!==se?je:{...je,user:{...je.user,photoAccess:nt}}):[]);const gt={_id:as(),content:ze?`You revoked photo access from ${g.user.nickname||"this user"}`:`${g.user.nickname||"This user"} does not have access to your private photos`,type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:ze?"photoRevoke":"photoInfo"};T(Te=>[...Te,gt])}}catch(Ct){console.error("Error revoking photo access:",Ct),Z.error("Failed to revoke photo access")}else try{const Ct=`${s.nickname||"User"} has granted you access to their private photos`,ze=await Ao.grantPhotoAccess(se,Ct);if(ze.success){const nt=ze.grantedCount>0,gt=((_t=(rt=ze.data)==null?void 0:rt.photoAccess)==null?void 0:_t.approved)||(ze.userHasAccess!==void 0?ze.userHasAccess:nt||ze.existingAccessCount>0);b(je=>je&&{...je,user:{...je.user||{},photoAccess:gt}}),v(je=>Array.isArray(je)?je.map(Xe=>!Xe||!Xe.user||Xe.user._id!==se?Xe:{...Xe,user:{...Xe.user,photoAccess:gt}}):[]);const Te={_id:as(),content:nt?`You granted ${g.user.nickname||"this user"} access to ${ze.grantedCount} private photos`:`${g.user.nickname||"This user"} already has access to your private photos`,type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:nt?"photoGrant":"photoInfo"};T(je=>[...je,Te])}}catch(Ct){console.error("Error granting photo access:",Ct),Z.error("Failed to grant photo access")}}catch($t){console.error("Error handling photo access:",$t),Z.error($t.message||"Failed to handle photo access")}finally{Y(!1)}},go=async()=>{if(!g||!(s!=null&&s._id))return;if(!Ae.isConnected||!Ae.isConnected()){const ge={_id:as(),sender:"system",content:"Cannot start call: connection issue. Please refresh and try again.",createdAt:new Date().toISOString(),type:"system",error:!0};T(Ee=>[...Ee,ge]),console.error("Cannot initiate call - socket not connected");return}if(!g.user.isOnline){const ge={_id:as(),sender:"system",content:`${g.user.nickname} is currently offline. You can only call users who are online.`,createdAt:new Date().toISOString(),type:"system",error:!0};T(Ee=>[...Ee,ge]);return}if((s==null?void 0:s.accountTier)==="FREE"){const ge={_id:as(),sender:"system",content:"Free accounts cannot make video calls. Upgrade for video calls.",createdAt:new Date().toISOString(),type:"system",error:!0};T(Ee=>[...Ee,ge]);return}const se=g.user._id;if(!/^[0-9a-fA-F]{24}$/.test(se)){const ge={_id:as(),sender:"system",content:"Cannot start call: Invalid recipient ID.",createdAt:new Date().toISOString(),type:"system",error:!0};T(Ee=>[...Ee,ge]),console.error("Cannot initiate call - invalid recipient ID:",se);return}try{const ge={_id:as(),sender:"system",content:`Initiating call to ${g.user.nickname}...`,createdAt:new Date().toISOString(),type:"system"};T(Fe=>[...Fe,ge]),X(!0),k&&"vibrate"in navigator&&navigator.vibrate([50,100,50]),await Ae.initiateVideoCall(se);const Ee={_id:as(),sender:"system",content:`Calling ${g.user.nickname}... Waiting for response.`,createdAt:new Date().toISOString(),type:"system"};T(Fe=>[...Fe,Ee]),console.debug("Call initiation request sent successfully for user:",se)}catch(ge){console.error("Video call initiation error:",ge);const Ee={_id:as(),sender:"system",content:`Call failed to initiate: ${ge.message||"Could not start video call. Please try again."}`,createdAt:new Date().toISOString(),type:"system",error:!0};T(Fe=>[...Fe,Ee]),X(!1)}},rr=p.useCallback(()=>{if(console.log("handleEndCall triggered. isCallActive:",L,"Active Convo:",g),g){const se=g.user._id;L&&/^[0-9a-fA-F]{24}$/.test(se)?(console.log("Emitting videoHangup to:",se),Ae.emit("videoHangup",{recipientId:se})):L&&console.warn("Cannot emit hangup for invalid partner ID:",se);const ge={_id:as(),sender:"system",content:"Video call ended.",createdAt:new Date().toISOString(),type:"system"};T(Ee=>[...Ee,ge])}else console.log("handleEndCall: No active conversation.");X(!1),z(null),k&&"vibrate"in navigator&&navigator.vibrate(100)},[g,L,k]),Gs=p.useCallback(se=>{if(!(s!=null&&s._id)||!se)return;const ge=se.sender===s._id?se.recipient:se.sender;if(!ge||ge===s._id||!/^[0-9a-fA-F]{24}$/.test(ge)){console.warn("Skipping conversation list update due to invalid partner ID:",ge,"Message:",se);return}v(Ee=>{var rt,_t;const Fe=Ee.findIndex($t=>$t.user._id===ge);if(Fe!==-1){const $t=Ee[Fe];if(((rt=$t.lastMessage)==null?void 0:rt._id)===se._id&&((_t=$t.lastMessage)==null?void 0:_t.createdAt)===se.createdAt)return Ee}let Qe;if(Fe!==-1)return Qe={...Ee[Fe],lastMessage:se,unreadCount:se.sender!==s._id&&(!g||g.user._id!==ge)?(Ee[Fe].unreadCount||0)+1:g&&g.user._id===ge?0:Ee[Fe].unreadCount},[Qe,...Ee.filter($t=>$t.user._id!==ge)];{const $t=se.senderName||`User ${ge.substring(0,6)}`,Ct=se.senderPhoto||null;return Qe={user:{_id:ge,nickname:$t,photo:Ct,isOnline:!1,accountTier:"FREE"},lastMessage:se,unreadCount:se.sender!==s._id?1:0},[Qe,...Ee]}})},[s==null?void 0:s._id,g]),po=p.useCallback(se=>{if(!se||se===(s==null?void 0:s._id))return;if(!/^[0-9a-fA-F]{24}$/.test(se)){console.warn("Attempted to mark conversation read for invalid ID format:",se);return}let ge=!1;v(Ee=>Ee.map(Fe=>Fe.user._id===se&&Fe.unreadCount>0?(ge=!0,{...Fe,unreadCount:0}):Fe)),ge&&setTimeout(()=>{Et.markConversationRead(se)},50)},[s==null?void 0:s._id]),mo=p.useCallback(()=>{if(g&&Et.isConnected&&Et.isConnected()&&(s!=null&&s._id)){const se=g.user._id;/^[0-9a-fA-F]{24}$/.test(se)?Et.sendTypingIndicator(se):console.warn("Cannot send typing indicator for invalid partner ID:",se)}},[g,s==null?void 0:s._id]),yo=se=>{var Fe;const ge=se.target.value;M(ge),ge.trim()&&((Fe=g==null?void 0:g.user)!=null&&Fe._id)?/^[0-9a-fA-F]{24}$/.test(g.user._id)&&(B.current&&clearTimeout(B.current),B.current=setTimeout(mo,500)):B.current&&clearTimeout(B.current),se.target.style.height="auto";const Ee=120;se.target.style.height=`${Math.min(se.target.scrollHeight,Ee)}px`},Ar=p.useCallback(se=>{var ge;if(!((ge=se==null?void 0:se.user)!=null&&ge._id)){console.warn("Attempted to select invalid conversation",se);return}if(g&&g.user._id===se.user._id){console.log("Already on this conversation, skipping");return}if(se.user._id===(s==null?void 0:s._id)){Z.warning("You cannot message yourself");return}if(!/^[0-9a-fA-F]{24}$/.test(se.user._id)){Z.error("Cannot select conversation: Invalid user ID."),console.error("Attempted to select conversation with invalid ID:",se.user._id);return}console.log(`Selecting conversation with user: ${se.user.nickname} (${se.user._id})`),M(""),W(null),x(null),N(null),T([]),$e.current=null,b(se),t(`/messages/${se.user._id}`,{replace:!0}),k&&(C(!1),"vibrate"in navigator&&navigator.vibrate(20))},[g,s==null?void 0:s._id,k,t]),vo=()=>{C(!S),k&&"vibrate"in navigator&&navigator.vibrate(15)},_o=p.useCallback(async()=>{try{is.debug("Refreshing conversations list"),U(!0);const se=await Et.getConversations();se&&Array.isArray(se)&&(v(se),is.debug(`Loaded ${se.length} conversations`)),k&&"vibrate"in navigator&&navigator.vibrate([15,30,15])}catch(se){is.error("Error refreshing conversations:",se),Z.error("Failed to refresh conversations"),k&&"vibrate"in navigator&&navigator.vibrate([100,50,100])}finally{U(!1),Se(!1)}},[Et,k]);p.useMemo(()=>Wa($),[$]);const wo=p.useCallback(se=>{const{scrollTop:ge,scrollHeight:Ee,clientHeight:Fe}=se.target},[]);return E||n?r.jsx(Po,{children:r.jsx("div",{className:Ve.messagesLoading,children:r.jsx(Er,{size:"large",text:"Loading chat...",centered:!0})})}):!o&&!n?r.jsx(Po,{children:r.jsx("div",{className:Ve.noActiveChat,children:r.jsxs("div",{className:Ve.noActiveChatContent,children:[r.jsx("h3",{children:"Please Login"}),r.jsx("p",{children:"You need to login to view your messages."}),r.jsx("button",{className:Ve.startChatButton,onClick:()=>t("/login"),children:"Go to Login"})]})})}):w&&!g&&!A&&!E?r.jsx(Po,{children:r.jsx("div",{className:Ve.noActiveChat,children:r.jsxs("div",{className:`${Ve.noActiveChatContent} ${Ve.errorContent}`,children:[r.jsx("h3",{children:"Error"}),r.jsx("p",{children:w}),r.jsx("button",{className:Ve.startChatButton,onClick:()=>window.location.reload(),children:"Retry"})]})})}):r.jsxs(Po,{children:[r.jsxs("div",{className:Ve.messagesContainer,ref:pe,onTouchStart:k?Ne:void 0,onTouchMove:k?Ie:void 0,onTouchEnd:k?et:void 0,children:[r.jsx("div",{className:Os(Ve.sidebar,S?Ve.show:Ve.hide),children:r.jsx(D8,{conversations:f,activeConversation:g,onConversationSelect:Ar,onNewConversation:()=>t("/dashboard"),currentUserId:s==null?void 0:s._id,onRefresh:_o,conversationsLoading:E&&f.length===0,conversationsListRef:ce})}),r.jsx(Vu,{className:!S&&k?Ve.fullWidth:"",isUserBlocked:(($r=g==null?void 0:g.user)==null?void 0:$r.isBlocked)||((Ce=g==null?void 0:g.user)==null?void 0:Ce._id)&&u(g.user._id),children:g?r.jsxs(r.Fragment,{children:[r.jsx(Gu,{conversation:g,isMobile:k,onBackClick:vo,onStartVideoCall:go,onProfileClick:()=>{ie(g.user._id),oe(!0)},pendingPhotoRequests:(g==null?void 0:g.pendingPhotoRequests)||0,isApprovingRequests:te,onApprovePhotoRequests:fo,isConnected:Ae.isConnected(),photoAccess:((lt=g==null?void 0:g.user)==null?void 0:lt.photoAccess)||!1,onBlockUser:se=>{var Ee;if((Ee=g==null?void 0:g.user)==null?void 0:Ee.isBlocked){if(window.confirm("Are you sure you want to unblock this user? They will be able to send you messages again.")){l(se).then(()=>{try{const Qe=localStorage.getItem("blockedUsers");if(Qe){const _t=JSON.parse(Qe).filter($t=>$t!==se);localStorage.setItem("blockedUsers",JSON.stringify(_t))}}catch(Qe){console.warn("Failed to update blocked users in localStorage:",Qe)}a().then(()=>{at()})}),Z.success("User unblocked successfully");const Fe={_id:as(),content:"You have unblocked this user. You will now receive messages from them.",type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"unblock"};T(Qe=>[...Qe,Fe])}}else if(window.confirm("Are you sure you want to block this user? You will no longer receive messages from them.")){i(se).then(()=>{try{const Qe=localStorage.getItem("blockedUsers");let rt=[];Qe&&(rt=JSON.parse(Qe)),rt.includes(se)||(rt.push(se),localStorage.setItem("blockedUsers",JSON.stringify(rt)))}catch(Qe){console.warn("Failed to update blocked users in localStorage:",Qe)}a().then(()=>{at()})}),Z.success("User blocked successfully");const Fe={_id:as(),content:"You have blocked this user. You will no longer receive messages from them.",type:"system",createdAt:new Date().toISOString(),sender:"system",systemType:"block"};T(Qe=>[...Qe,Fe])}},onReportUser:se=>{const ge=window.prompt("Please provide a reason for reporting this user:");ge&&(c(se,ge),Z.success("User reported successfully. Our team will review your report."))},userTier:s==null?void 0:s.accountTier}),(s==null?void 0:s.accountTier)===ys.FREE&&r.jsx(bi,{onUpgradeClick:()=>t("/subscription")}),r.jsx(wi,{incomingCall:q,isCallActive:L,recipientNickname:((St=g==null?void 0:g.user)==null?void 0:St.nickname)||"User",onAcceptCall:()=>{if(q!=null&&q.callerId&&/^[0-9a-fA-F]{24}$/.test(q.callerId)){if((s==null?void 0:s.accountTier)===ys.FREE){Z.error("Free accounts cannot receive video calls. Upgrade to accept."),Ae.answerVideoCall(q.callerId,!1,q.callId),z(null);return}Ae.answerVideoCall(q.callerId,!0,q.callId);const se={_id:as(),sender:"system",content:`You accepted the video call from ${g.user.nickname}.`,createdAt:new Date().toISOString(),type:"system"};T(ge=>[...ge,se]),X(!0),z(null)}else console.error("Cannot accept call: Invalid caller ID format",q==null?void 0:q.callerId),Z.error("Error accepting call (Invalid ID)."),z(null)},onDeclineCall:()=>{if(q!=null&&q.callerId&&/^[0-9a-fA-F]{24}$/.test(q.callerId)){Ae.answerVideoCall(q.callerId,!1,q.callId);const se={_id:as(),sender:"system",content:`You declined the video call from ${g.user.nickname}.`,createdAt:new Date().toISOString(),type:"system"};T(ge=>[...ge,se])}else console.error("Cannot decline call: Invalid caller ID format",q==null?void 0:q.callerId),Z.error("Error declining call (Invalid ID).");z(null)},onEndCall:rr,useSmallButtons:!1}),A?r.jsx(oo,{showTimeoutMessage:!1,handleRetry:()=>st(g.user._id),handleReconnect:()=>{var se;return(se=Et.reconnect)==null?void 0:se.call(Et)}}):w&&$.length===0?r.jsx(xi,{error:w,handleRetry:()=>st(g.user._id),handleForceInit:()=>{y.current=!1,Et.initialize(s)},showInitButton:!0}):$.length===0?r.jsx(Si,{text:"No messages in this conversation yet.",hint:(s==null?void 0:s.accountTier)===ys.FREE?"Send a wink to start!":"Say hello to start the conversation!"}):r.jsx(q8,{messages:As,currentUserId:s==null?void 0:s._id,isSending:re,typingUser:P&&((It=g==null?void 0:g.user)==null?void 0:It._id)===P?g.user.nickname:null,isMobile:k,onScroll:wo,messagesEndRef:_}),r.jsx(_i,{attachment:K,isUploading:H,uploadProgress:Q,onRemoveAttachment:uo,onFileSelected:(se,ge)=>{if(ge){Z.error(ge);return}se&&(W(se),Z.info(`Selected file: ${se.name}`),k&&"vibrate"in navigator&&navigator.vibrate(30))},showFileInput:!1,disabled:!!q||L,userTier:s==null?void 0:s.accountTier}),r.jsx(B8,{isVisible:G,onClose:()=>V(!1),onEmojiClick:se=>{M(ge=>ge+se),V(!1),setTimeout(()=>{var ge;return(ge=m.current)==null?void 0:ge.focus()},0),k&&"vibrate"in navigator&&navigator.vibrate(20)}}),r.jsx(vi,{messageValue:F,onInputChange:yo,onSubmit:K?ho:es,onWinkSend:vt,onFileAttachClick:Pe,disabled:!!q||L||((Rt=g==null?void 0:g.user)==null?void 0:Rt.isBlocked)||((ws=g==null?void 0:g.user)==null?void 0:ws._id)&&u(g.user._id),isUserBlocked:((mn=g==null?void 0:g.user)==null?void 0:mn.isBlocked)||((Fs=g==null?void 0:g.user)==null?void 0:Fs._id)&&u(g.user._id),onEmojiClick:se=>{M(ge=>ge+se),V(!1),setTimeout(()=>{var ge;return(ge=m.current)==null?void 0:ge.focus()},0),k&&"vibrate"in navigator&&navigator.vibrate(20)},userTier:s==null?void 0:s.accountTier,isSending:re,isUploading:H,attachmentSelected:!!K,inputRef:m,placeholderText:(yn=g==null?void 0:g.user)!=null&&yn.isBlocked?"You have blocked this user":(s==null?void 0:s.accountTier)===ys.FREE?"Send a wink instead (Free Account)":`Message ${((Pr=g==null?void 0:g.user)==null?void 0:Pr.nickname)||""}...`}),r.jsx(U8,{onFileSelected:se=>{se&&(W(se),Z.info(`Selected file: ${se.name}`),k&&"vibrate"in navigator&&navigator.vibrate(30))},isUploading:H,uploadProgress:Q,showProgress:!1,acceptedFileTypes:"image/jpeg,image/png,image/gif,image/webp,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,audio/mpeg,audio/wav,audio/ogg,video/mp4,video/quicktime,video/webm"})]}):r.jsx("div",{className:Ve.noActiveChat,children:r.jsxs("div",{className:Ve.noActiveChatContent,children:[r.jsx(gn,{size:48}),r.jsx("h3",{children:"Your Messages"}),r.jsx("p",{children:"Select a conversation from the list to start chatting."}),w&&r.jsx("p",{className:Ve.errorMessage,children:w}),r.jsx("button",{className:Ve.startChatButton,onClick:()=>t("/dashboard"),children:"Find someone to chat with"})]})})})]}),L&&((ac=g==null?void 0:g.user)==null?void 0:ac._id)&&/^[0-9a-fA-F]{24}$/.test(g.user._id)&&r.jsx("div",{className:Ve.videoCallOverlay,children:r.jsx(Ci,{isActive:L,userId:s==null?void 0:s._id,recipientId:g.user._id,onEndCall:rr,isIncoming:!1,callId:null})}),r.jsx(ki,{userId:fe,isOpen:ye,onClose:()=>oe(!1)})]})},z8="_subscriptionContainer_1j9z3_2",H8="_gradientBar_1j9z3_20",V8="_backNav_1j9z3_27",W8="_backButton_1j9z3_33",G8="_pageTitle_1j9z3_61",Y8="_subtitle_1j9z3_81",K8="_lead_1j9z3_93",J8="_pricingCards_1j9z3_105",Q8="_pricingCard_1j9z3_105",X8="_premiumCard_1j9z3_138",Z8="_popularBadge_1j9z3_149",eE="_cardHeader_1j9z3_162",tE="_planName_1j9z3_172",sE="_price_1j9z3_183",nE="_period_1j9z3_190",rE="_cardBody_1j9z3_200",oE="_featureList_1j9z3_207",iE="_featureItem_1j9z3_214",aE="_iconYes_1j9z3_226",cE="_iconNo_1j9z3_233",lE="_featureIcon_1j9z3_240",dE="_toggleContainer_1j9z3_245",uE="_toggleBtn_1j9z3_260",hE="_toggleBtnActive_1j9z3_276",fE="_saveBadge_1j9z3_283",gE="_buttonOutline_1j9z3_296",pE="_buttonPrimary_1j9z3_331",mE="_alreadyPremium_1j9z3_373",yE="_premiumTitle_1j9z3_389",vE="_premiumMessage_1j9z3_400",_E="_spinner_1j9z3_410",Ye={subscriptionContainer:z8,gradientBar:H8,backNav:V8,backButton:W8,pageTitle:G8,subtitle:Y8,lead:K8,pricingCards:J8,pricingCard:Q8,premiumCard:X8,popularBadge:Z8,cardHeader:eE,planName:tE,price:sE,period:nE,cardBody:rE,featureList:oE,featureItem:iE,iconYes:aE,iconNo:cE,featureIcon:lE,toggleContainer:dE,toggleBtn:uE,toggleBtnActive:hE,saveBadge:fE,buttonOutline:gE,buttonPrimary:pE,alreadyPremium:mE,premiumTitle:yE,premiumMessage:vE,spinner:_E},Fl=Dn("Subscription"),wE=()=>{const{user:e,getCurrentUser:t}=Xt(),s=ps(),[n,o]=p.useState("monthly"),[i,c]=p.useState(!1),[l,u]=p.useState(null),{t:h}=Ht(),{isRTL:a}=ss();p.useEffect(()=>{e?d():s("/login")},[e,s]);const d=async()=>{try{const g=await Fa.getSubscriptionStatus();g.success&&u(g.data)}catch(g){Fl.error("Error fetching subscription status:",g),Z.error(h("fetchFailed"))}},f=(e==null?void 0:e.isPaid)||(e==null?void 0:e.accountTier)==="PAID"||(e==null?void 0:e.accountTier)==="FEMALE"||(e==null?void 0:e.accountTier)==="COUPLE"||l&&(l.isPaid||l.accountTier==="PAID"||l.accountTier==="FEMALE"||l.accountTier==="COUPLE"),v=async g=>{c(!0);try{(await Fa.upgradeSubscription(g)).success&&(await t(),Z.success(h("upgradeSuccess")),s("/dashboard"))}catch(b){Fl.error("Subscription error:",b),Z.error(b.message||h("paymentFailed"))}finally{c(!1)}};return r.jsx("div",{className:`modern-dashboard ${a?"rtl-layout":""}`,children:r.jsx("main",{className:"dashboard-content",children:r.jsxs("div",{className:Ye.subscriptionContainer,children:[r.jsx("div",{className:Ye.gradientBar}),r.jsx("div",{className:Ye.backNav,children:r.jsxs("button",{className:Ye.backButton,onClick:()=>s("/dashboard"),children:[r.jsx(wr,{})," ",h("backToDashboard")||"Back to Dashboard"]})}),r.jsxs("h1",{className:Ye.pageTitle,children:[r.jsx(Xd,{})," ",h("premiumMembership")]}),f?r.jsxs("div",{className:Ye.alreadyPremium,children:[r.jsx("h3",{className:Ye.premiumTitle,children:h("alreadyPremium")}),r.jsx("p",{className:Ye.premiumMessage,children:h("enjoyFeatures")}),r.jsxs("button",{className:Ye.buttonPrimary,onClick:()=>s("/dashboard"),children:[h("goBack")," ",h("dashboard")]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"text-center mb-5",children:[r.jsx("h2",{className:Ye.subtitle,children:h("unlockFeatures")}),r.jsx("p",{className:Ye.lead,children:h("upgradeExperience")})]}),r.jsx("div",{className:"d-flex justify-content-center",children:r.jsxs("div",{className:Ye.toggleContainer,children:[r.jsx("button",{className:`${Ye.toggleBtn} ${n==="monthly"?Ye.toggleBtnActive:""}`,onClick:()=>o("monthly"),children:h("monthly")}),r.jsxs("button",{className:`${Ye.toggleBtn} ${n==="yearly"?Ye.toggleBtnActive:""}`,onClick:()=>o("yearly"),children:[h("yearly"),r.jsxs("span",{className:Ye.saveBadge,children:[h("save")," 20%"]})]})]})}),r.jsxs("div",{className:Ye.pricingCards,children:[r.jsxs("div",{className:Ye.pricingCard,children:[r.jsxs("div",{className:Ye.cardHeader,children:[r.jsx("h3",{className:Ye.planName,children:h("freeTier")}),r.jsx("p",{className:Ye.price,children:"$0"}),r.jsx("p",{className:Ye.period,children:h("forever")})]}),r.jsxs("div",{className:Ye.cardBody,children:[r.jsxs("ul",{className:Ye.featureList,children:[r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("viewProfiles")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("sendWinks")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("limitedLikes")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("limitedStories")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(Ts,{className:Ye.iconNo})," ",h("sendMessages")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(Ts,{className:Ye.iconNo})," ",h("unlimitedLikes")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(Ts,{className:Ye.iconNo})," ",h("unlimitedStories")]})]}),r.jsx("button",{className:Ye.buttonOutline,disabled:!0,children:h("currentPlan")})]})]}),r.jsxs("div",{className:`${Ye.pricingCard} ${Ye.premiumCard}`,children:[r.jsx("div",{className:Ye.popularBadge,children:h("mostPopular")}),r.jsxs("div",{className:Ye.cardHeader,children:[r.jsx("h3",{className:Ye.planName,children:h("paidTier")}),r.jsxs("p",{className:Ye.price,children:["$",n==="monthly"?"14.99":"11.99"]}),r.jsx("p",{className:Ye.period,children:h(n==="monthly"?"perMonth":"perMonthYearly")})]}),r.jsxs("div",{className:Ye.cardBody,children:[r.jsxs("ul",{className:Ye.featureList,children:[r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("viewProfiles")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("sendWinks")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",r.jsx("strong",{children:h("unlimitedLikes")})," ",r.jsx(On,{className:Ye.featureIcon})]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",r.jsx("strong",{children:h("unlimitedStories")})," ",r.jsx(gi,{className:Ye.featureIcon})]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",r.jsx("strong",{children:h("sendMessages")})," ",r.jsx(kr,{className:Ye.featureIcon})]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("videoCalls")]}),r.jsxs("li",{className:Ye.featureItem,children:[r.jsx(jt,{className:Ye.iconYes})," ",h("prioritySearch")]})]}),r.jsx("button",{className:Ye.buttonPrimary,onClick:()=>v(n),disabled:i,children:i?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:Ye.spinner}),r.jsx("span",{style:{marginLeft:"8px"},children:h("processing")})]}):`${h("subscribe")} ${n==="monthly"?"$14.99/month":"$143.88/year"}`})]})]})]})]})]})})})},Dl=Dn("VerifyEmail"),bE=()=>{const[e,t]=p.useState("loading"),[s,n]=p.useState(""),o=ps(),i=tr(),{user:c,login:l,resendVerificationEmail:u}=Xt(),{t:h}=Ht(),{isRTL:a}=ss(),d=()=>new URLSearchParams(i.search).get("token");p.useEffect(()=>{(async()=>{var T,F;const $=d();if(!$){t("error"),n(h("tokenMissing"));return}try{const M=await qe.post("/auth/verify-email",{token:$});if(M.success){if(t("success"),n(h("accountVerified")),c)try{await qe.get("/auth/me")}catch(E){Dl.error("Error refreshing user profile:",E)}}else t("error"),n(M.error||h("verificationFailed"))}catch(M){Dl.error("Verification error:",M),t("error"),n(((F=(T=M.response)==null?void 0:T.data)==null?void 0:F.error)||h("verificationFailed"))}})()},[c,h]);const f=async()=>{c?(await u(),n(h("verificationEmailSent"))):n(h("loginToResend"))},v=()=>{o("/dashboard")},g=()=>{o("/login")};return r.jsxs("div",{className:`verify-email-page ${a?"rtl-layout":""}`,children:[r.jsx("div",{className:"verify-email-container",children:r.jsxs("div",{className:"verify-email-card",children:[r.jsx("div",{className:"verify-email-header",children:r.jsx("h1",{children:h("verifyEmail")})}),r.jsxs("div",{className:"verify-email-content",children:[e==="loading"&&r.jsxs("div",{className:"verify-email-loading",children:[r.jsx(Ws,{className:"spinner"}),r.jsx("p",{children:h("verifyingEmail")})]}),e==="success"&&r.jsxs("div",{className:"verify-email-success",children:[r.jsx(jm,{className:"success-icon"}),r.jsx("h2",{children:h("verificationSuccess")}),r.jsx("p",{children:s}),r.jsx("div",{className:"verify-email-actions",children:c?r.jsxs("button",{className:"primary-button",onClick:v,children:[h("goBack")," ",h("dashboard")]}):r.jsx("button",{className:"primary-button",onClick:g,children:h("signIn")})})]}),e==="error"&&r.jsxs("div",{className:"verify-email-error",children:[r.jsx(Bt,{className:"error-icon"}),r.jsx("h2",{children:h("verificationFailed")}),r.jsx("p",{children:s}),r.jsxs("div",{className:"verify-email-actions",children:[r.jsxs("button",{className:"secondary-button",onClick:f,children:[r.jsx(gn,{})," ",h("resendVerificationEmail")]}),r.jsx(yt,{to:"/login",className:"text-link",children:h("backToLogin")})]})]})]})]})}),r.jsx("style",{jsx:!0,children:`
        .verify-email-page {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          background-color: #f5f5f5;
          padding: 20px;
        }
        
        .verify-email-container {
          width: 100%;
          max-width: 500px;
        }
        
        .verify-email-card {
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          overflow: hidden;
        }
        
        .verify-email-header {
          background-color: #ff4b7d;
          color: white;
          padding: 20px;
          text-align: center;
        }
        
        .verify-email-header h1 {
          margin: 0;
          font-size: 24px;
        }
        
        .verify-email-content {
          padding: 30px;
          text-align: center;
        }
        
        .verify-email-loading,
        .verify-email-success,
        .verify-email-error {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 15px;
        }
        
        .spinner {
          animation: spin 1s linear infinite;
          font-size: 40px;
          color: #ff4b7d;
        }
        
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        
        .success-icon {
          font-size: 60px;
          color: #28a745;
        }
        
        .error-icon {
          font-size: 60px;
          color: #dc3545;
        }
        
        .verify-email-actions {
          margin-top: 20px;
          display: flex;
          flex-direction: column;
          gap: 10px;
          width: 100%;
        }
        
        .primary-button {
          background-color: #ff4b7d;
          color: white;
          border: none;
          border-radius: 4px;
          padding: 12px 20px;
          font-size: 16px;
          cursor: pointer;
          width: 100%;
          transition: background-color 0.2s;
        }
        
        .primary-button:hover {
          background-color: #e6305f;
        }
        
        .secondary-button {
          background-color: #f8f9fa;
          color: #333;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 12px 20px;
          font-size: 16px;
          cursor: pointer;
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          transition: background-color 0.2s;
        }
        
        .secondary-button:hover {
          background-color: #e9ecef;
        }
        
        .text-link {
          color: #ff4b7d;
          text-decoration: none;
          margin-top: 10px;
          display: inline-block;
        }
        
        .text-link:hover {
          text-decoration: underline;
        }
      `})]})},xE=()=>{const{t:e}=Ht(),{dir:t}=ss(),s={"@context":"https://schema.org","@type":"Organization",name:"Flirtss",url:"https://flirtss.com",logo:"https://flirtss.com/logo.png",description:"Flirtss is a dating platform that helps adults find meaningful connections in a safe, respectful environment.",foundingDate:"2022",address:{"@type":"PostalAddress",addressLocality:"Tel Aviv",addressCountry:"Israel"}};return r.jsxs("div",{className:"policy-page-container",dir:t,children:[r.jsx(Tr,{title:"About Flirtss",description:"Learn about Flirtss - our story, mission, values, and the team behind our platform for meaningful connections.",schema:s}),r.jsx("header",{className:"modern-header",children:r.jsx("div",{className:"container header-container",children:r.jsx(yt,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),r.jsx("div",{className:"policy-content container py-5",children:r.jsx("div",{className:"row justify-content-center",children:r.jsx("div",{className:"col-12 col-lg-10",children:r.jsxs("div",{className:"policy-card",children:[r.jsx("h1",{className:"policy-title gradient-text",children:e("aboutUs","About Us")}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("ourStory","Our Story")}),r.jsx("p",{children:e("storyContent","Founded in 2022, Mandarin was created with a simple mission: to help adults find meaningful connections in a safe, respectful environment. Our team of dedicated professionals combines expertise in technology, psychology, and relationship dynamics to create a platform that prioritizes authentic interactions.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("ourMission","Our Mission")}),r.jsx("p",{children:e("missionContent","At Mandarin, we believe that everyone deserves to find connections that enrich their lives. Our mission is to provide a platform where adults can explore relationships in an environment that values privacy, consent, and mutual respect.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("ourValues","Our Values")}),r.jsxs("div",{className:"values-grid",children:[r.jsxs("div",{className:"value-item",children:[r.jsx("h3",{children:e("valuePrivacy","Privacy")}),r.jsx("p",{children:e("valuePrivacyDesc","Your personal information and interactions are yours alone. We implement industry-leading security measures to protect your data.")})]}),r.jsxs("div",{className:"value-item",children:[r.jsx("h3",{children:e("valueAuthenticity","Authenticity")}),r.jsx("p",{children:e("valueAuthenticityDesc","We encourage genuine interactions and have systems in place to verify real users and reduce fake profiles.")})]}),r.jsxs("div",{className:"value-item",children:[r.jsx("h3",{children:e("valueInclusion","Inclusion")}),r.jsx("p",{children:e("valueInclusionDesc","We welcome adults of all backgrounds, orientations, and relationship preferences in a judgment-free environment.")})]}),r.jsxs("div",{className:"value-item",children:[r.jsx("h3",{children:e("valueRespect","Respect")}),r.jsx("p",{children:e("valueRespectDesc","Mutual respect is fundamental to positive interactions. We have zero tolerance for harassment or disrespectful behavior.")})]})]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("ourTeam","Our Team")}),r.jsx("p",{children:e("teamContent","Our diverse team brings together expertise in technology, design, security, and relationship psychology. Based in Tel Aviv with team members across the globe, we work together to create an exceptional platform for meaningful connections.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("contactUs","Contact Us")}),r.jsxs("p",{children:[e("aboutContactContent","We value your feedback and are here to assist with any questions or concerns. Please reach out to our support team at support@mandarin.example.com or visit our")," ",r.jsx(yt,{to:"/support",children:e("supportPage","support page")}),"."]})]}),r.jsxs("div",{className:"policy-footer",children:[r.jsx(yt,{to:"/",className:"btn btn-outline-primary",children:e("backToHome","Back to Home")}),r.jsxs("div",{className:"policy-links",children:[r.jsx(yt,{to:"/terms",children:e("termsOfService","Terms of Service")}),r.jsx(yt,{to:"/privacy",children:e("privacyPolicy","Privacy Policy")}),r.jsx(yt,{to:"/support",children:e("contactSupport","Contact Support")})]})]})]})})})})]})},SE=()=>{const{t:e}=Ht(),{dir:t}=ss(),s={"@context":"https://schema.org","@type":"FAQPage",mainEntity:[{"@type":"Question",name:"How does Flirtss protect my privacy?",acceptedAnswer:{"@type":"Answer",text:"Flirtss uses end-to-end encryption for all personal data, gives you control over who sees your photos and profile information, provides precise control over location sharing, and offers customizable privacy settings."}},{"@type":"Question",name:"What should I do if I encounter inappropriate behavior?",acceptedAnswer:{"@type":"Answer",text:"Use the 'Report' button on the user's profile or in your chat conversation, contact our support team which is available 24/7, and in case of immediate danger or threats, contact your local authorities first."}},{"@type":"Question",name:"How does Flirtss verify users?",acceptedAnswer:{"@type":"Answer",text:"Flirtss employs multiple verification methods including photo verification technology, email verification, phone number verification, and a profile review process. Look for the verified badge on profiles to identify users who have completed our verification process."}}]};return r.jsxs("div",{className:"policy-page-container",dir:t,children:[r.jsx(Tr,{title:"Safety & Privacy Guidelines",description:"Learn about Mandarin Dating's comprehensive safety measures, privacy protection features, and guidelines for staying safe while using our platform.",schema:s}),r.jsx("header",{className:"modern-header",children:r.jsx("div",{className:"container header-container",children:r.jsx(yt,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),r.jsx("div",{className:"policy-content container py-5",children:r.jsx("div",{className:"row justify-content-center",children:r.jsx("div",{className:"col-12 col-lg-10",children:r.jsxs("div",{className:"policy-card",children:[r.jsx("h1",{className:"policy-title gradient-text",children:e("safetyTitle","Safety & Privacy")}),r.jsxs("section",{className:"mb-5",children:[r.jsx("div",{className:"safety-icon-container",children:r.jsx(sc,{className:"safety-main-icon"})}),r.jsx("h2",{children:e("safetyIntroduction","Your Safety is Our Priority")}),r.jsx("p",{children:e("safetyIntroContent","At Mandarin, we are committed to creating a safe, secure, and respectful environment for all our users. We have implemented comprehensive safety measures to protect your privacy and ensure positive interactions. This page outlines our commitment to your safety and provides resources to help you stay safe while using our platform.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsxs("h2",{className:"d-flex align-items-center",children:[r.jsx(vs,{className:"section-icon"}),e("privacyProtection","Privacy Protection")]}),r.jsx("p",{children:e("privacyContent","Your personal information is safeguarded by industry-leading security measures:")}),r.jsxs("ul",{className:"safety-checklist",children:[r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("dataEncryption","End-to-end encryption for all personal data")]}),r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("photoPrivacy","Control over who sees your photos and profile information")]}),r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("locationControl","Precise control over your location sharing")]}),r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("privacySettings","Customizable privacy settings for your comfort level")]})]}),r.jsxs("p",{children:[e("reviewPrivacyPolicy","For more details on how we handle your data, please review our")," ",r.jsx(yt,{to:"/privacy",className:"text-link",children:e("privacyPolicyLink","Privacy Policy")}),"."]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsxs("h2",{className:"d-flex align-items-center",children:[r.jsx(l1,{className:"section-icon"}),e("onlineSafety","Online Safety Tips")]}),r.jsx("p",{children:e("tipsIntro","While we work hard to maintain a safe platform, it's important to follow these safety guidelines:")}),r.jsxs("div",{className:"safety-tips-grid",children:[r.jsxs("div",{className:"safety-tip",children:[r.jsx("h3",{children:e("meetingTip","Meeting In Person")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("meetPublic","Always meet in a public place for your first meeting")}),r.jsx("li",{children:e("tellFriend","Tell a friend or family member about your plans")}),r.jsx("li",{children:e("stayingSober","Stay sober and clear-headed during initial meetings")}),r.jsx("li",{children:e("ownTransport","Arrange your own transportation to and from the meeting")})]})]}),r.jsxs("div",{className:"safety-tip",children:[r.jsx("h3",{children:e("personalInfoTip","Protecting Personal Information")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("limitInfo","Limit personal information in your profile and messages")}),r.jsx("li",{children:e("noFinancial","Never share financial information or send money")}),r.jsx("li",{children:e("privateComm","Keep communications on the platform until you build trust")}),r.jsx("li",{children:e("socialMedia","Be cautious about connecting on social media too quickly")})]})]}),r.jsxs("div",{className:"safety-tip",children:[r.jsx("h3",{children:e("recognizeTip","Recognizing Red Flags")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("inconsistencies","Be wary of inconsistencies in someone's story")}),r.jsx("li",{children:e("rushingRelationship","Be cautious of someone rushing the relationship")}),r.jsx("li",{children:e("avoidingQuestions","Watch for avoidance of direct questions")}),r.jsx("li",{children:e("requestingMoney","Be alert if someone requests money for any reason")})]})]}),r.jsxs("div",{className:"safety-tip",children:[r.jsx("h3",{children:e("respectTip","Respectful Communication")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("consentMatters","Always respect boundaries and consent")}),r.jsx("li",{children:e("politeDecline","Politely decline interests that don't match yours")}),r.jsx("li",{children:e("reportHarassment","Report any harassment or inappropriate messages")}),r.jsx("li",{children:e("blockOption","Use the block feature if someone makes you uncomfortable")})]})]})]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsxs("h2",{className:"d-flex align-items-center",children:[r.jsx(Bt,{className:"section-icon"}),e("reportingIssues","Reporting Issues")]}),r.jsx("p",{children:e("reportingContent","Your safety is our priority. If you encounter inappropriate behavior, we encourage you to report it immediately:")}),r.jsxs("ol",{className:"safety-reporting",children:[r.jsxs("li",{children:[r.jsxs("strong",{children:[e("reportingUser","Report a User"),":"]})," ",e("reportingUserDetails","Use the 'Report' button on their profile or in your chat conversation")]}),r.jsxs("li",{children:[r.jsxs("strong",{children:[e("reportingContact","Contact Support"),":"]})," ",e("reportingContactDetails","Our support team is available 24/7 to assist with urgent safety concerns")]}),r.jsxs("li",{children:[r.jsxs("strong",{children:[e("reportingAuthorities","Contact Authorities"),":"]})," ",e("reportingAuthoritiesDetails","In case of immediate danger or threats, please contact local authorities first")]})]}),r.jsx("div",{className:"safety-alert",children:r.jsxs("p",{children:[r.jsxs("strong",{children:[e("emergencySituations","For emergency situations"),": "]}),e("emergencyContact","Contact your local emergency services immediately, then notify our support team so we can take appropriate action on our platform.")]})})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("verification","User Verification")}),r.jsx("p",{children:e("verificationContent","We employ multiple verification methods to ensure the authenticity of our users:")}),r.jsxs("ul",{className:"safety-checklist",children:[r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("photoVerification","Photo verification technology")]}),r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("emailVerification","Email verification")]}),r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("phoneVerification","Phone number verification")]}),r.jsxs("li",{children:[r.jsx(jt,{className:"check-icon"}),e("profileReview","Profile review process")]})]}),r.jsx("p",{children:e("verificationBadge","Look for the verified badge on profiles to identify users who have completed our verification process.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("contactSafetyTeam","Contact Our Safety Team")}),r.jsx("p",{children:e("safetyContactContent","If you have safety concerns or suggestions, our dedicated safety team is here to help:")}),r.jsxs("p",{children:["Email: safety@mandarin.example.com",r.jsx("br",{}),"Support: ",r.jsx(yt,{to:"/support",className:"text-link",children:e("supportCenter","Support Center")})]})]}),r.jsxs("div",{className:"policy-footer",children:[r.jsx(yt,{to:"/",className:"btn btn-outline-primary",children:e("backToHome","Back to Home")}),r.jsxs("div",{className:"policy-links",children:[r.jsx(yt,{to:"/about",children:e("aboutUs","About Us")}),r.jsx(yt,{to:"/privacy",children:e("privacyPolicy","Privacy Policy")}),r.jsx(yt,{to:"/terms",children:e("termsOfService","Terms of Service")}),r.jsx(yt,{to:"/support",children:e("contactSupport","Contact Support")})]})]})]})})})})]})},CE=Dn("Support"),kE=()=>{const{t:e}=Ht(),{dir:t}=ss(),[s,n]=p.useState("contact"),[o,i]=p.useState(null),[c,l]=p.useState({name:"",email:"",subject:"",message:""}),[u,h]=p.useState(!1),a=b=>{const{name:$,value:T}=b.target;l({...c,[$]:T})},d=b=>{b.preventDefault(),CE.info("Form submitted:",c),h(!0),l({name:"",email:"",subject:"",message:""}),setTimeout(()=>{h(!1)},3e3)},f=b=>{i(o===b?null:b)},v=[{question:e("faq1Question","How do I create an account?"),answer:e("faq1Answer","To create an account, click on the 'Register' button on the homepage. Fill out your details, upload a profile photo, and set your preferences. Once you verify your email, your account will be activated.")},{question:e("faq2Question","How can I change my account settings?"),answer:e("faq2Answer","Navigate to the 'Settings' page after logging in. There, you can update your profile information, notification preferences, privacy settings, and account details.")},{question:e("faq3Question","Is my personal information secure?"),answer:e("faq3Answer","Yes, we take security very seriously. We use encryption to protect your data and never share your personal information with third parties without your consent. For more details, please review our Privacy Policy.")},{question:e("faq4Question","How do I cancel my subscription?"),answer:e("faq4Answer","To cancel your subscription, go to 'Settings > Subscription' and click on 'Cancel Subscription'. Your premium benefits will remain active until the end of your current billing period.")},{question:e("faq5Question","How can I report inappropriate behavior?"),answer:e("faq5Answer","If you encounter inappropriate behavior, use the 'Report' button on the user's profile or in the message thread. Our moderation team will review the report and take appropriate action within 24 hours.")},{question:e("faq6Question","What should I do if I forget my password?"),answer:e("faq6Answer","On the login page, click 'Forgot Password'. Enter your email address, and we'll send you instructions to reset your password. For security reasons, the reset link expires after 24 hours.")},{question:e("faq7Question","How do I delete my account?"),answer:e("faq7Answer","Go to 'Settings > Account' and scroll to the bottom where you'll find the 'Delete Account' option. Please note that account deletion is permanent and cannot be undone.")}],g={"@context":"https://schema.org","@type":"CustomerService",name:"Flirtss Support",url:"https://flirtss.com/support",email:"support@flirtss.com",telephone:"+972 12 345 6789",availableLanguage:["English","Hebrew"],hoursAvailable:"Mo-Fr 09:00-18:00",contactType:"customer support"};return r.jsxs("div",{className:"policy-page-container",dir:t,children:[r.jsx(Tr,{title:"Support Center",description:"Get help with your Mandarin Dating account. Contact our support team, find answers to frequently asked questions, and troubleshoot common issues.",schema:g}),r.jsx("header",{className:"modern-header",children:r.jsx("div",{className:"container header-container",children:r.jsx(yt,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),r.jsx("div",{className:"policy-content container py-5",children:r.jsx("div",{className:"row justify-content-center",children:r.jsx("div",{className:"col-12 col-lg-10",children:r.jsxs("div",{className:"policy-card",children:[r.jsx("h1",{className:"policy-title gradient-text",children:e("supportTitle","Support Center")}),r.jsxs("div",{className:"support-tabs mb-4",children:[r.jsxs("button",{className:`support-tab ${s==="contact"?"active":""}`,onClick:()=>n("contact"),children:[r.jsx(gn,{className:"tab-icon"}),e("contactUs","Contact Us")]}),r.jsxs("button",{className:`support-tab ${s==="faq"?"active":""}`,onClick:()=>n("faq"),children:[r.jsx(Qm,{className:"tab-icon"}),e("faq","FAQ")]})]}),s==="contact"&&r.jsxs("div",{className:"support-content",children:[r.jsx("div",{className:"contact-info mb-4",children:r.jsxs("div",{className:"contact-methods",children:[r.jsxs("div",{className:"contact-method",children:[r.jsx(gn,{className:"contact-icon"}),r.jsxs("div",{children:[r.jsx("h3",{children:e("email","Email")}),r.jsx("p",{children:"support@mandarin.example.com"})]})]}),r.jsxs("div",{className:"contact-method",children:[r.jsx(ru,{className:"contact-icon"}),r.jsxs("div",{children:[r.jsx("h3",{children:e("phone","Phone")}),r.jsx("p",{children:"+972 12 345 6789"})]})]}),r.jsxs("div",{className:"contact-method",children:[r.jsx(Mm,{className:"contact-icon"}),r.jsxs("div",{children:[r.jsx("h3",{children:e("liveChat","Live Chat")}),r.jsx("p",{children:e("liveChatHours","Available 9AM-6PM IST")})]})]})]})}),r.jsx("h2",{className:"mb-4",children:e("contactForm","Send Us a Message")}),u?r.jsx("div",{className:"alert alert-success",children:e("formSuccess","Thank you! Your message has been sent. We'll get back to you soon.")}):r.jsxs("form",{onSubmit:d,className:"support-form",children:[r.jsxs("div",{className:"form-group mb-3",children:[r.jsx("label",{htmlFor:"name",children:e("formName","Your Name")}),r.jsx("input",{type:"text",id:"name",name:"name",className:"form-control",value:c.name,onChange:a,required:!0})]}),r.jsxs("div",{className:"form-group mb-3",children:[r.jsx("label",{htmlFor:"email",children:e("formEmail","Email Address")}),r.jsx("input",{type:"email",id:"email",name:"email",className:"form-control",value:c.email,onChange:a,required:!0})]}),r.jsxs("div",{className:"form-group mb-3",children:[r.jsx("label",{htmlFor:"subject",children:e("formSubject","Subject")}),r.jsx("input",{type:"text",id:"subject",name:"subject",className:"form-control",value:c.subject,onChange:a,required:!0})]}),r.jsxs("div",{className:"form-group mb-3",children:[r.jsx("label",{htmlFor:"message",children:e("formMessage","Message")}),r.jsx("textarea",{id:"message",name:"message",className:"form-control",rows:"5",value:c.message,onChange:a,required:!0})]}),r.jsx("button",{type:"submit",className:"btn btn-primary",children:e("formSubmit","Send Message")})]})]}),s==="faq"&&r.jsxs("div",{className:"support-content",children:[r.jsx("h2",{className:"mb-4",children:e("frequentlyAskedQuestions","Frequently Asked Questions")}),r.jsx("div",{className:"faq-list",children:v.map((b,$)=>r.jsxs("div",{className:`faq-item ${o===$?"expanded":""}`,children:[r.jsxs("div",{className:"faq-question",onClick:()=>f($),children:[r.jsx("h3",{children:b.question}),o===$?r.jsx(Am,{}):r.jsx(Tm,{})]}),o===$&&r.jsx("div",{className:"faq-answer",children:r.jsx("p",{children:b.answer})})]},$))})]}),r.jsxs("div",{className:"policy-footer",children:[r.jsx(yt,{to:"/",className:"btn btn-outline-primary",children:e("backToHome","Back to Home")}),r.jsxs("div",{className:"policy-links",children:[r.jsx(yt,{to:"/about",children:e("aboutUs","About Us")}),r.jsx(yt,{to:"/privacy",children:e("privacyPolicy","Privacy Policy")}),r.jsx(yt,{to:"/terms",children:e("termsOfService","Terms of Service")})]})]})]})})})})]})},NE=()=>{const{t:e}=Ht(),{dir:t}=ss(),s={"@context":"https://schema.org","@type":"WebPage",name:"Terms of Service - Flirtss",description:"Terms and conditions for using the Flirtss platform.",url:"https://flirtss.com/terms",mainEntity:{"@type":"Article",name:"Flirtss Terms of Service",datePublished:"2024-04-15",dateModified:"2024-04-15",author:{"@type":"Organization",name:"Flirtss"}}};return r.jsxs("div",{className:"policy-page-container",dir:t,children:[r.jsx(Tr,{title:"Terms of Service",description:"Read the Mandarin Dating terms of service, including user eligibility, account rules, acceptable conduct, and subscription terms.",schema:s}),r.jsx("header",{className:"modern-header",children:r.jsx("div",{className:"container header-container",children:r.jsx(yt,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),r.jsx("div",{className:"policy-content container py-5",children:r.jsx("div",{className:"row justify-content-center",children:r.jsx("div",{className:"col-12 col-lg-10",children:r.jsxs("div",{className:"policy-card",children:[r.jsx("h1",{className:"policy-title gradient-text",children:e("termsTitle","Terms of Service")}),r.jsxs("p",{className:"policy-last-updated",children:[e("lastUpdated","Last Updated"),": ",e("updateDate","April 15, 2024")]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("introduction","Introduction")}),r.jsx("p",{children:e("termsIntroContent",'Welcome to Mandarin. These Terms of Service ("Terms") govern your access to and use of the Mandarin application and website (the "Service"). Please read these Terms carefully before using our Service.')}),r.jsx("p",{children:e("introAgreement","By accessing or using the Service, you agree to be bound by these Terms. If you do not agree to all the terms and conditions, you may not access or use the Service.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("eligibility","Eligibility")}),r.jsx("p",{children:e("eligibilityContent","You must be at least 18 years old to use the Service. By using the Service, you represent and warrant that you meet all eligibility requirements. The Service is not available to previously removed users or those who have had their account suspended.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("accountCreation","Account Creation and Security")}),r.jsx("p",{children:e("accountContent","To use certain features of the Service, you must register for an account. You agree to provide accurate and complete information and to keep this information up to date. You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account.")}),r.jsx("p",{children:e("accountSecurity","You are solely responsible for safeguarding your password and agree to notify us immediately of any unauthorized use of your account. We reserve the right to close your account at any time for any or no reason.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("userConduct","User Conduct")}),r.jsx("p",{children:e("conductIntro","You agree not to engage in any of the following prohibited activities:")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("conductViolate","Violating any laws, regulations, or third party rights")}),r.jsx("li",{children:e("conductHarassment","Engaging in harassment, intimidation, or abusive behavior toward other users")}),r.jsx("li",{children:e("conductFalse","Providing false or misleading information or creating a false identity")}),r.jsx("li",{children:e("conductSecurity","Attempting to circumvent security features or access parts of the Service for which you do not have permission")}),r.jsx("li",{children:e("conductSolicitation","Using the Service for commercial solicitation without our prior written consent")}),r.jsx("li",{children:e("conductHarmful","Posting or transmitting malicious code or content that could harm our systems or other users")})]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("contentRights","Content and Intellectual Property Rights")}),r.jsx("p",{children:e("contentOwnership","The Service and its original content, features, and functionality are owned by Mandarin and are protected by international copyright, trademark, and other intellectual property laws.")}),r.jsx("p",{children:e("userContent","By submitting content to the Service, you grant us a worldwide, non-exclusive, royalty-free license to use, reproduce, modify, adapt, publish, translate, and distribute your content in connection with providing the Service.")}),r.jsx("p",{children:e("contentResponsibility","You are solely responsible for the content you post and warrant that you have all necessary rights to post such content.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("subscriptions","Subscriptions and Payments")}),r.jsx("p",{children:e("subscriptionContent","Some features of the Service may require a subscription. By subscribing, you agree to pay the fees in accordance with our payment terms. You authorize us to charge the payment method you provide for the subscription fees.")}),r.jsx("p",{children:e("subscriptionRenewal","Subscriptions automatically renew unless you cancel before the renewal date. You can cancel your subscription at any time through your account settings.")}),r.jsx("p",{children:e("subscriptionRefund","Payments are non-refundable except where required by law or as expressly stated in our refund policy.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("termination","Termination")}),r.jsx("p",{children:e("terminationContent","We may terminate or suspend your account and access to the Service immediately, without prior notice or liability, for any reason, including if you breach these Terms.")}),r.jsx("p",{children:e("terminationEffect","Upon termination, your right to use the Service will immediately cease. All provisions of these Terms which by their nature should survive termination shall survive termination.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("disclaimer","Disclaimer")}),r.jsx("p",{children:e("disclaimerContent",'THE SERVICE IS PROVIDED "AS IS" AND "AS AVAILABLE" WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED. TO THE FULLEST EXTENT PERMITTED BY LAW, WE DISCLAIM ALL WARRANTIES, INCLUDING BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.')})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("limitation","Limitation of Liability")}),r.jsx("p",{children:e("limitationContent","TO THE MAXIMUM EXTENT PERMITTED BY LAW, IN NO EVENT SHALL MANDARIN BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES, INCLUDING WITHOUT LIMITATION, LOSS OF PROFITS, DATA, USE, GOODWILL, OR OTHER INTANGIBLE LOSSES, RESULTING FROM YOUR ACCESS TO OR USE OF OR INABILITY TO ACCESS OR USE THE SERVICE.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("changesToTerms","Changes to Terms")}),r.jsx("p",{children:e("changesContent","We reserve the right to modify or replace these Terms at any time. If a revision is material, we will provide at least 30 days' notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("contactUs","Contact Us")}),r.jsx("p",{children:e("contactContent","If you have any questions about these Terms, please contact us at:")}),r.jsxs("p",{children:["Email: legal@mandarin.example.com",r.jsx("br",{}),"Address: 123 Legal Street, Tel Aviv, Israel"]})]}),r.jsxs("div",{className:"policy-footer",children:[r.jsx(yt,{to:"/",className:"btn btn-outline-primary",children:e("backToHome","Back to Home")}),r.jsxs("div",{className:"policy-links",children:[r.jsx(yt,{to:"/about",children:e("aboutUs","About Us")}),r.jsx(yt,{to:"/privacy",children:e("privacyPolicy","Privacy Policy")}),r.jsx(yt,{to:"/support",children:e("contactSupport","Contact Support")})]})]})]})})})})]})},EE=()=>{const{t:e}=Ht(),{dir:t}=ss(),s={"@context":"https://schema.org","@type":"WebPage",name:"Privacy Policy - Flirtss",description:"Learn about how Flirtss protects your privacy and manages your personal information.",url:"https://flirtss.com/privacy",mainEntity:{"@type":"Article",name:"Flirtss Privacy Policy",datePublished:"2024-04-15",dateModified:"2024-04-15",author:{"@type":"Organization",name:"Flirtss"}}};return r.jsxs("div",{className:"policy-page-container",dir:t,children:[r.jsx(Tr,{title:"Privacy Policy",description:"Learn how Mandarin Dating protects your personal information, what data we collect, and your privacy rights when using our service.",schema:s}),r.jsx("header",{className:"modern-header",children:r.jsx("div",{className:"container header-container",children:r.jsx(yt,{to:"/",className:"logo gradient-text font-weight-bold",children:"Flirtss"})})}),r.jsx("div",{className:"policy-content container py-5",children:r.jsx("div",{className:"row justify-content-center",children:r.jsx("div",{className:"col-12 col-lg-10",children:r.jsxs("div",{className:"policy-card",children:[r.jsx("h1",{className:"policy-title gradient-text",children:e("privacyTitle","Privacy Policy")}),r.jsxs("p",{className:"policy-last-updated",children:[e("lastUpdated","Last Updated"),": ",e("privacyUpdateDate","April 15, 2024")]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("introduction","Introduction")}),r.jsx("p",{children:e("privacyIntroContent","At Mandarin, we take your privacy seriously. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our service. Please read this policy carefully to understand our practices regarding your personal data.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("informationWeCollect","Information We Collect")}),r.jsx("p",{children:e("collectIntro","We collect several types of information to provide and improve our service to you:")}),r.jsxs("ul",{children:[r.jsxs("li",{children:[r.jsx("strong",{children:e("personalInformation","Personal Information")}),":",e("personalInfoDetails"," Name, email address, date of birth, gender, relationship status, and preferences.")]}),r.jsxs("li",{children:[r.jsx("strong",{children:e("profileInformation","Profile Information")}),":",e("profileInfoDetails"," Photos, bio, interests, and other details you choose to share on your profile.")]}),r.jsxs("li",{children:[r.jsx("strong",{children:e("usageInformation","Usage Information")}),":",e("usageInfoDetails"," How you interact with our service, including login times, features used, and messages sent.")]}),r.jsxs("li",{children:[r.jsx("strong",{children:e("deviceInformation","Device Information")}),":",e("deviceInfoDetails"," IP address, browser type, device type, and operating system.")]}),r.jsxs("li",{children:[r.jsx("strong",{children:e("locationInformation","Location Information")}),":",e("locationInfoDetails"," General location data based on IP address or user-provided information.")]})]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("howWeUseInformation","How We Use Your Information")}),r.jsx("p",{children:e("useIntro","We use the information we collect for various purposes, including to:")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("useProvideService","Provide, maintain, and improve our services")}),r.jsx("li",{children:e("usePersonalize","Personalize your experience and provide relevant matches")}),r.jsx("li",{children:e("useCommunicate","Communicate with you about service updates and offers")}),r.jsx("li",{children:e("useSecurity","Monitor and analyze usage patterns for security and service improvement")}),r.jsx("li",{children:e("useLegal","Comply with legal obligations and enforce our terms")})]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("informationSharing","Information Sharing and Disclosure")}),r.jsx("p",{children:e("sharingIntro","We do not sell your personal information. We may share information in the following situations:")}),r.jsxs("ul",{children:[r.jsxs("li",{children:[r.jsx("strong",{children:e("sharingConsent","With Your Consent")}),":",e("sharingConsentDetails"," When you explicitly agree to share information with other users or third parties.")]}),r.jsxs("li",{children:[r.jsx("strong",{children:e("sharingServiceProviders","Service Providers")}),":",e("sharingProvidersDetails"," With trusted third parties who assist us in operating our service, such as payment processors, cloud storage providers, and analytics services.")]}),r.jsxs("li",{children:[r.jsx("strong",{children:e("sharingLegal","Legal Requirements")}),":",e("sharingLegalDetails"," When we believe disclosure is necessary to comply with a legal obligation, protect our rights, or ensure the safety of our users.")]})]})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("dataSecurity","Data Security")}),r.jsx("p",{children:e("securityContent","We implement appropriate technical and organizational measures to protect your personal information from unauthorized access, loss, or alteration. However, no method of transmission over the Internet or electronic storage is 100% secure, and we cannot guarantee absolute security.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("yourRights","Your Rights and Choices")}),r.jsx("p",{children:e("rightsContent","Depending on your location, you may have certain rights regarding your personal information, including:")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("rightsAccess","Access and review your personal information")}),r.jsx("li",{children:e("rightsCorrect","Correct inaccurate or incomplete information")}),r.jsx("li",{children:e("rightsDelete","Request deletion of your personal information")}),r.jsx("li",{children:e("rightsRestrict","Restrict or object to certain processing of your data")}),r.jsx("li",{children:e("rightsPortability","Request a copy of your data in a portable format")})]}),r.jsx("p",{children:e("rightsExercise",'To exercise these rights, please contact us using the information provided in the "Contact Us" section.')})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("cookies","Cookies and Tracking Technologies")}),r.jsx("p",{children:e("cookiesContent","We use cookies and similar tracking technologies to collect information about your browsing activities and to personalize your experience. You can control cookies through your browser settings, but disabling certain cookies may limit your ability to use some features of our service.")})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("privacyChanges","Changes to This Privacy Policy")}),r.jsx("p",{children:e("privacyChangesContent",'We may update this Privacy Policy from time to time. We will notify you of any significant changes by posting the new Privacy Policy on this page and updating the "Last Updated" date at the top.')})]}),r.jsxs("section",{className:"mb-5",children:[r.jsx("h2",{children:e("contactUs","Contact Us")}),r.jsx("p",{children:e("privacyContactContent","If you have any questions or concerns about this Privacy Policy, please contact us at:")}),r.jsxs("p",{children:["Email: privacy@mandarin.example.com",r.jsx("br",{}),"Address: 123 Privacy Street, Tel Aviv, Israel"]})]}),r.jsxs("div",{className:"policy-footer",children:[r.jsx(yt,{to:"/",className:"btn btn-outline-primary",children:e("backToHome","Back to Home")}),r.jsxs("div",{className:"policy-links",children:[r.jsx(yt,{to:"/about",children:e("aboutUs","About Us")}),r.jsx(yt,{to:"/terms",children:e("termsOfService","Terms of Service")}),r.jsx(yt,{to:"/support",children:e("contactSupport","Contact Support")})]})]})]})})})})]})},TE=Ze.create("Analytics"),Bl=Gn.ANALYTICS.GA4_ID;Xl.initialize(Bl),TE.info("GA4 Initialized with ID:",Bl);function AE(){const e=tr();return p.useEffect(()=>{Xl.send({hitType:"pageview",page:e.pathname+e.search})},[e]),null}function jE(){um();const t=tr().pathname.includes("/messages");return p.useEffect(()=>{Sh(async()=>{const{initializeMobileOptimizations:n}=await import("./mobileInit-C7fZ3VLv.js");return{initializeMobileOptimizations:n}},[]).then(({initializeMobileOptimizations:n})=>{n()});const s=()=>{if(typeof window<"u"){const n=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${n}px`)}};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),p.useEffect(()=>{const s=n=>{document.body.classList.add("direction-changing"),document.body.offsetHeight,setTimeout(()=>document.body.classList.remove("direction-changing"),Gn.ANIMATIONS.DIRECTION_CHANGE_MS);const o=document.querySelector(".Toastify");o&&(n.detail.isRTL?o.classList.add("Toastify__toast--rtl"):o.classList.remove("Toastify__toast--rtl"))};return window.addEventListener("languageDirectionChanged",s),()=>{window.removeEventListener("languageDirectionChanged",s)}},[]),r.jsx(bu,{children:r.jsx(Ba,{children:r.jsx(v1,{children:r.jsx(J1,{children:r.jsx(hm,{children:r.jsx(hk,{children:r.jsx(y1,{children:r.jsx($1,{children:r.jsx(Em,{children:r.jsx(_1,{children:r.jsx(x1,{children:r.jsxs("div",{className:"app-container",style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[r.jsx(ro,{}),r.jsx(AE,{}),r.jsx(Z6,{}),r.jsx("main",{className:"main-content",style:{flexGrow:1},children:r.jsxs(fh,{children:[r.jsx(xs,{path:"/",element:r.jsx(O8,{})}),r.jsx(xs,{path:"/login",element:r.jsx(Dk,{})}),r.jsx(xs,{path:"/register",element:r.jsx(z5,{})}),r.jsx(xs,{path:"/verify-email",element:r.jsx(bE,{})}),r.jsx(xs,{path:"/about",element:r.jsx(xE,{})}),r.jsx(xs,{path:"/safety",element:r.jsx(SE,{})}),r.jsx(xs,{path:"/support",element:r.jsx(kE,{})}),r.jsx(xs,{path:"/terms",element:r.jsx(NE,{})}),r.jsx(xs,{path:"/privacy",element:r.jsx(EE,{})}),r.jsx(xs,{path:"/dashboard",element:r.jsx(lr,{useNavigateHook:!1,children:r.jsx(NN,{})})}),r.jsx(xs,{path:"/profile",element:r.jsx(lr,{useNavigateHook:!1,children:r.jsx(d3,{})})}),r.jsx(xs,{path:"/messages",element:r.jsx(lr,{useNavigateHook:!1,children:r.jsx(Ol,{})})}),r.jsx(xs,{path:"/messages/:userId",element:r.jsx(lr,{useNavigateHook:!1,children:r.jsx(Ol,{})})}),r.jsx(xs,{path:"/settings",element:r.jsx(lr,{useNavigateHook:!1,children:r.jsx(M8,{})})}),r.jsx(xs,{path:"/subscription",element:r.jsx(lr,{useNavigateHook:!1,children:r.jsx(wE,{})})}),r.jsx(xs,{path:"*",element:r.jsx(L8,{})})]})}),r.jsx(uk,{}),!t&&r.jsx(ck,{}),r.jsx(ph,{position:Gn.TOAST.POSITION,autoClose:Gn.TOAST.AUTO_CLOSE_MS,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:document.documentElement.dir==="rtl",pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,limit:Gn.TOAST.MAX_TOASTS,theme:"colored",className:document.documentElement.dir==="rtl"?"rtl-layout Toastify__toast--rtl":""})]})})})})})})})})})})})})}const{slice:IE,forEach:$E}=[];function PE(e){return $E.call(IE.call(arguments,1),t=>{if(t)for(const s in t)e[s]===void 0&&(e[s]=t[s])}),e}function RE(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(s=>s.test(e))}const Ul=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,ME=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},o=encodeURIComponent(t);let i=`${e}=${o}`;if(n.maxAge>0){const c=n.maxAge-0;if(Number.isNaN(c))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(c)}`}if(n.domain){if(!Ul.test(n.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${n.domain}`}if(n.path){if(!Ul.test(n.path))throw new TypeError("option path is invalid");i+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");i+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(i+="; HttpOnly"),n.secure&&(i+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(i+="; Partitioned"),i},ql={create(e,t,s,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};s&&(o.expires=new Date,o.expires.setTime(o.expires.getTime()+s*60*1e3)),n&&(o.domain=n),document.cookie=ME(e,encodeURIComponent(t),o)},read(e){const t=`${e}=`,s=document.cookie.split(";");for(let n=0;n<s.length;n++){let o=s[n];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(t)===0)return o.substring(t.length,o.length)}return null},remove(e){this.create(e,"",-1)}};var LE={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return ql.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:s,cookieMinutes:n,cookieDomain:o,cookieOptions:i}=t;s&&typeof document<"u"&&ql.create(s,e,n,o,i)}},OE={name:"querystring",lookup(e){var n;let{lookupQuerystring:t}=e,s;if(typeof window<"u"){let{search:o}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(o=window.location.hash.substring(window.location.hash.indexOf("?")));const c=o.substring(1).split("&");for(let l=0;l<c.length;l++){const u=c[l].indexOf("=");u>0&&c[l].substring(0,u)===t&&(s=c[l].substring(u+1))}}return s}};let dr=null;const zl=()=>{if(dr!==null)return dr;try{if(dr=typeof window<"u"&&window.localStorage!==null,!dr)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{dr=!1}return dr};var FE={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&zl())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:s}=t;s&&zl()&&window.localStorage.setItem(s,e)}};let ur=null;const Hl=()=>{if(ur!==null)return ur;try{if(ur=typeof window<"u"&&window.sessionStorage!==null,!ur)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{ur=!1}return ur};var DE={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&Hl())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:s}=t;s&&Hl()&&window.sessionStorage.setItem(s,e)}},BE={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:s,userLanguage:n,language:o}=navigator;if(s)for(let i=0;i<s.length;i++)t.push(s[i]);n&&t.push(n),o&&t.push(o)}return t.length>0?t:void 0}},UE={name:"htmlTag",lookup(e){let{htmlTag:t}=e,s;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(s=n.getAttribute("lang")),s}},qE={name:"path",lookup(e){var o;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(s)?(o=s[typeof t=="number"?t:0])==null?void 0:o.replace("/",""):void 0}},zE={name:"subdomain",lookup(e){var o,i;let{lookupFromSubdomainIndex:t}=e;const s=typeof t=="number"?t+1:1,n=typeof window<"u"&&((i=(o=window.location)==null?void 0:o.hostname)==null?void 0:i.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[s]}};let nh=!1;try{document.cookie,nh=!0}catch{}const rh=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];nh||rh.splice(1,1);const HE=()=>({order:rh,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class oh{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,s)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=PE(s,this.options||{},HE()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=o=>o.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(LE),this.addDetector(OE),this.addDetector(FE),this.addDetector(DE),this.addDetector(BE),this.addDetector(UE),this.addDetector(qE),this.addDetector(zE)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,s=[];return t.forEach(n=>{if(this.detectors[n]){let o=this.detectors[n].lookup(this.options);o&&typeof o=="string"&&(o=[o]),o&&(s=s.concat(o))}}),s=s.filter(n=>n!=null&&!RE(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?s:s.length>0?s[0]:null}cacheUserLanguage(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;s&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||s.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}oh.type="languageDetector";const VE="Your email is not verified. Please verify your email address to unlock all features.",WE="Resend Verification Email",GE="Resend Email ({{cooldown}}m)",YE="Resend Email",KE="Sending...",JE="Update failed",QE="Profile photo updated successfully",XE="Marital Status",ZE="Cancel",eT="Edit",tT="Loading...",sT="Error",nT="Success",rT="Online",oT="Offline",iT="Send",aT="View",cT="This photo is private",lT="Request Access",dT="Request Pending",uT="Approve",hT="Reject",fT="My Profile",gT="Edit Profile",pT="Dashboard",mT="Home",yT="About",vT="Privacy",_T="Terms",wT="Help",bT="Back",xT="More",ST="Less",CT="Show Less",kT="Photos",NT="Add Photo",ET="Uploading...",TT="Nickname",AT="Age",jT="Location",IT="Bio",$T="About Me",PT="Identity",RT="I am",MT="Looking For",LT="Interests",OT="I'm Into",FT="Turn Ons",DT="Last active",BT="Updating photo privacy...",UT="Updating profile photo...",qT="Profile updated successfully",zT="Man",HT="Woman",VT="Couple",WT="Men",GT="Women",YT="Couples",KT="New Message",JT="Type a message...",QT="No messages yet",XT="Start a conversation",ZT="Search contacts",eA="Account",tA="Notifications",sA="Language",nA="Theme",rA="Email",oA="Password",iA="Forgot Password?",aA="Don't have an account?",cA="Already have an account?",lA="Failed to update profile",dA="Failed to upload photo",uA="Failed to update photo privacy",hA="Failed to update profile photo",fA="Failed to delete photo",gA="This field is required",pA="Please enter a valid email",mA="Discover",yA="Explore",vA="Near You",_A="Popular",wA="Online Now",bA="New Users",xA="Basic Information",SA="Approve photo requests",CA="You have blocked this user. They will not receive any messages from you.",kA="Disconnected",NA="Connection lost",EA="Start video call",TA="View Profile",AA="Unblock User",jA="Blocked",IA="More options",$A="Unblock",PA="Browse Users",RA="Your Matches",MA="Find Matches",LA="Loading users...",OA="Loading more users...",FA="No matches found",DA="Try adjusting your filters to see more results",BA="My Stories",UA="Create Story",qA="Filter",zA="Filters",HA="Reset",VA="Apply",WA="Show Only",GA="Range",YA="Distance",KA="Verified",JA="With Photos",QA="Dismiss",XA="Never active",ZA="Preferences",ej="Error",tj="Small",sj="Medium",nj="Large",rj="Load more",oj="Close",ij="Confirm",aj="Cancel",cj="An error occurred",lj="Try again",dj="Select language",uj="Switch to Hebrew",hj="Switch to English",fj="English",gj="Hebrew",pj="Currently using:",mj="Browse and connect with new people",yj="Create a new story",vj="Grid view",_j="List view",wj="No results found",bj="Search for users",xj="Age range",Sj="Use current location",Cj="km away",kj="Show more tags",Nj="Show less tags",Ej="Nickname is required",Tj="Nickname must be at least 3 characters",Aj="Nickname must be less than 50 characters",jj="Nickname can only contain letters in any language, numbers, and underscores",Ij="Age is required",$j="Please enter a valid age",Pj="You must be at least 18 years old",Rj="Age must be less than 120 years",Mj="Location is required",Lj="Location must be at least 2 characters",Oj="Bio must be less than 500 characters",Fj="Photo privacy updated to {{status}}",Dj="Photo uploaded successfully",Bj="Photo deleted successfully",Uj="Tell others about yourself...",qj="No bio provided",zj="No interests selected",Hj="No tags selected",Vj="Select up to 10 interests",Wj="Select up to 20 tags",Gj="Select up to 20 turn ons",Yj="Select up to 3 options",Kj="Married",Jj="Saving...",Qj="Message conversation",Xj="Loading messages",Zj="is typing",eI="Today at",tI="Yesterday at",sI="Toggle filters",nI="Messages from {{user}}",rI="This message has been deleted",oI="Attachment",iI="Send message",aI="Type a message...",cI="Search users",lI="Conversations",dI="Your inbox is empty",uI="Start a conversation now",hI="Write your first message",fI="Read",gI="Sending...",pI="Send a wink instead (Free Account)",mI="Upgrade to send text messages",yI="Upgrade to send files",vI="Message Input",_I="Select Emoji",wI="Close emoji picker",bI="Add Emoji",xI="Send Wink",SI="Attach File",CI="Send File",kI="Search",NI="Messages",EI="Profile",TI="Settings",AI="Logout",jI="Login",II="Register",$I="Subscription",PI="Email is required",RI="Password must be at least 8 characters",MI="Password must include at least one lowercase letter",LI="Password must include at least one uppercase letter",OI="Password must include at least one number",FI="Password must include at least one special character (@$!%*?&)",DI="Passwords do not match",BI="Password must be at least 6 characters",UI="is required",qI="An unexpected error occurred",zI="Date of birth is required",HI="You must be at least 18 years old",VI="Please enter a valid date of birth",WI="Please select who you are",GI="Location cannot exceed 100 characters",YI="Please upload a profile photo",KI="Please select your marital status",JI="Please select what you're looking for",QI="Please select no more than 3 options",XI="Please select no more than 20 'I'm into' tags",ZI="Please select no more than 20 'Turn ons' tags",e$="Please select at least one interest",t$="Please select no more than 10 interests",s$="You must agree to the Terms of Service",n$="You must agree to the Privacy Policy",r$="Please upload a valid image file (JPEG, JPG or PNG)",o$="Image size should be less than 5MB",i$="Create Your Account",a$="Enter your basic information",c$="Nickname",l$="Choose a nickname",d$="Your public display name (can contain letters, numbers, and underscores)",u$="Enter your email",h$="We'll never share your email with anyone else",f$="Create a password",g$="Confirm password",p$="Must be at least 8 characters with uppercase, lowercase, number, and special character",m$="Continue",y$="Account",v$="Profile",_$="Photo",w$="Preferences",b$="Tell Us About Yourself",x$="Add some basic profile details",S$="Date of Birth",C$="You must be at least 18 years old to use this service",k$="I am a",N$="Location",E$="City, Country",T$="Your general location (e.g., Tel Aviv, Israel)",A$="Back",j$="Upload Your Photo",I$="Add a profile photo to improve your visibility",$$="Click to upload a profile photo",P$="Photos should be clear, recent and show your face",R$="Maximum size: 5MB. Formats: JPG, JPEG, PNG",M$="Change Photo",L$="Remove",O$="Your Preferences",F$="Tell us about yourself and what you're looking for",D$="Marital Status",B$="Select your status",U$="Looking For",q$="Select up to 3 options",z$="Interests",H$="Select up to 10 interests",V$="I'm into",W$="Select up to 20 tags",G$="It turns me on",Y$="Select up to 20 tags",K$="I agree to the",J$="I agree to the",Q$="I want to receive news and special offers (optional)",X$="Create Account",Z$="Creating account...",eP="OR SIGN UP WITH",tP="Sign up with Google",sP="Sign up with Facebook",nP="You have unsaved changes. Are you sure you want to log out?",rP="Account deleted successfully",oP="Failed to delete account",iP="Failed to delete account. Please try again.",aP="Message Notifications",cP="Get notified when you receive new messages",lP="Call Notifications",dP="Get notified for incoming calls",uP="Story Notifications",hP="Get notified when friends post new stories",fP="Like Notifications",gP="Get notified when someone likes your content",pP="Comment Notifications",mP="Get notified when someone comments on your content",yP="Online Status",vP="Show when you're active on the app",_P="Read Receipts",wP="Let others know when you've read their messages",bP="Last Seen",xP="Show when you were last active",SP="Story Replies",CP="Control who can reply to your stories",kP="Everyone",NP="No one",EP="Blocked Users",TP="Users you've blocked cannot message you or view your profile",AP="Loading blocked users...",jP="User",IP="You haven't blocked any users",$P="Theme Mode",PP="Choose how the app appears to you",RP="Light",MP="Dark",LP="System",OP="Quick Theme Toggle",FP="Quickly switch between light and dark mode",DP="Choose your preferred language",BP="Username",UP="Not available",qP="Member since",zP="Free",HP="Notification Settings",VP="Privacy Settings",WP="Appearance Settings",GP="Account Settings",YP="Save Changes",KP="This action",JP="cannot be undone",QP="All your data will be permanently deleted, including:",XP="Your profile information",ZP="All messages and conversations",eR="Photos and media you've shared",tR="Stories and other content",sR="Enter your password to confirm:",nR="Your password",rR="Delete My Account",oR="Please enter your password to confirm account deletion",iR="Loading your settings...",aR="Hide password",cR="Show password",lR="Confirm Password",dR="OR",uR="Email Address",hR="Welcome to Mandarin! Your account has been created successfully.",fR="Sign In",gR="Sign Up",pR="Sign in with",mR="Don't have an account?",yR="Remember me",vR="Compatibility",_R="Loading profile...",wR="Unknown error",bR="Close",xR="Not found",SR="User not found",CR="Allow private photos",kR="Previous",NR="Next",ER="Pending",TR="No photos available",AR="Liked",jR="Like",IR="Message",$R="More actions",PR="Report user",RR="Block user",MR="Premium",LR="Unknown location",OR="Show more",FR="Verification token is missing",DR="Your account has been successfully verified",BR="Email verification failed",UR="Verification email has been sent",qR="Please login to resend verification email",zR="Verify Email",HR="Verifying your email address...",VR="Verification Successful",WR="Go to",GR="Back to Login",YR="עברית",KR="English",JR="Privacy First",QR="Your privacy is our top priority. Control who sees your profile and what information you share.",XR="Secure Communication",ZR="End‑to‑end encrypted messaging ensures your conversations remain private and secure.",e7="Smart Matching",t7="Our advanced algorithm connects you with people who match your preferences and interests.",s7="Find Your Perfect Connection",n7="Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful encounters.",r7="Enter your email",o7="Get Started",i7="People Online Now",a7="Connect with these amazing people who are currently active on Mandarin",c7="Not specified",l7="Join to See More",d7="Why Choose Mandarin",u7="Are you sure you want to delete this photo?",h7="You cannot delete your profile photo. Please set another photo as your profile photo first.",f7="No photos available",g7="Photo",p7="Photo",m7="Previous photo",y7="Next photo",v7="Make public",_7="Make private",w7="Friends Only",b7="Profile",x7="Set as profile photo",S7="Set as profile photo",C7="Delete photo",k7="Notifications",N7="Mark all read",E7="Refresh",T7="Refreshing...",A7="No unread notifications",j7="No notifications yet",I7="No {{filter}} notifications",$7="Real-time updates paused",P7="Reconnect",R7="Failed to fetch subscription data",M7="Successfully upgraded your subscription",L7="Payment processing failed",O7="Back to Dashboard",F7="Premium Membership",D7="You Already Have Premium Access",B7="Enjoy all premium features with your current account!",U7="Unlock Premium Features",q7="Upgrade your experience with Premium access",z7="Monthly",H7="Yearly",V7="Save",W7="Free",G7="Forever",Y7="Current Plan",K7="Most Popular",J7="Premium",Q7="per month",X7="per month, billed yearly",Z7="View Profiles",e9="Send Winks",t9="Limited Likes",s9="Limited Stories",n9="Unlimited Likes",r9="Unlimited Stories",o9="Video Calls",i9="Priority in Search Results",a9="Processing...",c9="Subscribe Now",l9="Support Center",d9="Contact Us",u9="FAQ",h9="Live Chat",f9="Available 9AM-6PM IST",g9="Send Us a Message",p9="Thank you! Your message has been sent. We'll get back to you soon.",m9="Your Name",y9="Email Address",v9="Subject",_9="Message",w9="Send Message",b9="Frequently Asked Questions",x9="Back to Home",S9="About Us",C9="Privacy Policy",k9="Terms of Service",N9="How do I create an account?",E9="To create an account, click on the 'Register' button on the homepage. Fill out your details, upload a profile photo, and set your preferences. Once you verify your email, your account will be activated.",T9="How can I change my account settings?",A9="Navigate to the 'Settings' page after logging in. There, you can update your profile information, notification preferences, privacy settings, and account details.",j9="Is my personal information secure?",I9="Yes, we take security very seriously. We use encryption to protect your data and never share your personal information with third parties without your consent. For more details, please review our Privacy Policy.",$9="How do I cancel my subscription?",P9="To cancel your subscription, go to 'Settings > Subscription' and click on 'Cancel Subscription'. Your premium benefits will remain active until the end of your current billing period.",R9="How can I report inappropriate behavior?",M9="If you encounter inappropriate behavior, use the 'Report' button on the user's profile or in the message thread. Our moderation team will review the report and take appropriate action within 24 hours.",L9="What should I do if I forget my password?",O9="On the login page, click 'Forgot Password'. Enter your email address, and we'll send you instructions to reset your password. For security reasons, the reset link expires after 24 hours.",F9="How do I delete my account?",D9="Go to 'Settings > Account' and scroll to the bottom where you'll find the 'Delete Account' option. Please note that account deletion is permanent and cannot be undone.",B9="Online Fun",U9="Camera Chat",q9="In a Public Place",z9="Leather/Latex Clothing",H9="Power Play",V9="Sensual Massage",W9="Risk Taking",G9="Dirty Talk",Y9="Music",K9="Single",J9="Married",Q9="Divorced",X9="Separated",Z9="In a Relationship",eM="Consensual Non-Monogamy",tM="Role Play",sM="BDSM",nM="Gentle Touch",rM="Intense Passion",oM="Outdoor Adventure",iM="Intellectual Discussion",aM="Foodie",cM="Art Lover",lM="Fitness Enthusiast",dM="Movie Buff",uM="Travel Addict",hM="Tech Geek",fM="Nature Lover",gM="Social Butterfly",pM="Homebody",mM="Spontaneous",yM="Planner",vM="Night Owl",_M="Early Bird",wM="Casual",bM="Serious Relationship",xM="Friendship",SM="Networking",CM="Dominant",kM="Submissive",NM="Switch",EM="Vanilla",TM="Kinky",AM="Experimental",jM="Voyeurism",IM="Exhibitionism",$M="Toys",PM="Blindfolds",RM="Restraints",MM="Toys",LM="Costumes",OM="Meetups",FM="Threesomes",DM="Cuckold",BM="Humiliation",UM="Crossdressing",qM="Worship",zM="Oral",HM="Massages",VM="Foreplay",WM="Bizarre",GM="Education",YM="Experiences",KM="Tantra",JM="Aggressive",QM="Pampering",XM="Teasing",ZM="Kink",eL="Comedy",tL="Spirituality",sL="Community",nL="Watching",rL="Parties",oL="Lingerie",iL="Voice",aL="Kindness",cL="Dancing",lL="Creativity",dL="Success",uL="Pets",hL="Casual",fL="Dating",gL="Friendship",pL="Travel",mL="Outdoors",yL="Movies",vL="Music",_L="Fitness",wL="Food",bL="Art",xL="Reading",SL="Gaming",CL="Photography",kL="Cooking",NL="Create Your Account",EL="Account",TL="Profile",AL="Photo",jL="Preferences",IL="Enter your basic information",$L="Choose a nickname",PL="Your public display name (can contain letters in any language, numbers, and underscores)",RL="Enter your email",ML="We'll never share your email with anyone else",LL="Create a password",OL="Must be at least 8 characters with uppercase, lowercase, number, and special character",FL="OR SIGN UP WITH",DL="Sign up with Google",BL="Sign up with Facebook",UL="Safety",qL="Support",zL="All rights reserved.",HL="Add some basic profile details",VL="I am a",WL="City, Country",GL="Your general location (e.g., Tel Aviv, Israel)",YL="Date of Birth",KL="You must be at least 18 years old to use this service",JL="Upload Your Photo",QL="Add a profile photo to improve your visibility",XL="Click to upload a profile photo",ZL="Photos should be clear, recent and show your face",eO="Maximum size: 5MB. Formats: JPG, JPEG, PNG",tO="Change Photo",sO="Remove",nO="Your Preferences",rO="Tell us about yourself and what you're looking for",oO="Select your status",iO="Select up to 3 options",aO="Select up to 10 interests",cO="Sports",lO="I'm into",dO="Select up to 20 tags",uO="It turns me on",hO="Select up to 20 tags",fO="I agree to the",gO="I agree to the",pO="I want to receive news and special offers (optional)",mO="Create Account",yO="Single",vO="Married",_O="Divorced",wO="Separated",bO="Widowed",xO="Polyamorous",SO={verificationNeeded:VE,resendVerificationEmail:WE,resendEmailCooldown:GE,resendEmail:YE,sending:KE,updateFailed:JE,profilePhotoUpdated:QE,maritalStatus:XE,cancel:ZE,delete:"Delete",edit:eT,loading:tT,error:sT,success:nT,online:rT,offline:oT,send:iT,view:aT,privatePhoto:cT,requestAccess:lT,requestPending:dT,approve:uT,reject:hT,myProfile:fT,editProfile:gT,dashboard:pT,home:mT,about:yT,privacy:vT,terms:_T,help:wT,back:bT,more:xT,less:ST,showLess:CT,photos:kT,addPhoto:NT,uploading:ET,nickname:TT,age:AT,location:jT,bio:IT,aboutMe:$T,identity:PT,iAm:RT,lookingFor:MT,interests:LT,intoTags:OT,turnOns:FT,lastActive:DT,updatingPhotoPrivacy:BT,updatingProfilePhoto:UT,profileUpdated:qT,man:zT,woman:HT,couple:VT,men:WT,women:GT,couples:YT,newMessage:KT,typeMessage:JT,noMessages:QT,startConversation:XT,searchContacts:ZT,account:eA,notifications:tA,language:sA,theme:nA,email:rA,password:oA,forgotPassword:iA,noAccount:aA,haveAccount:cA,profileUpdateFailed:lA,photoUploadFailed:dA,photoPrivacyUpdateFailed:uA,profilePhotoUpdateFailed:hA,photoDeleteFailed:fA,required:gA,invalidEmail:pA,discover:mA,explore:yA,nearYou:vA,popular:_A,onlineNow:wA,newUsers:bA,basicInfo:xA,approvePhotoRequests:SA,blockedUserMessage:CA,disconnected:kA,connectionLost:NA,startVideoCall:EA,viewProfile:TA,unblockUser:AA,blocked:jA,moreOptions:IA,unblock:$A,browseUsers:PA,yourMatches:RA,findMatches:MA,loadingUsers:LA,loadingMoreUsers:OA,noMatches:FA,tryAdjustingFilters:DA,myStories:BA,createStory:UA,filter:qA,filters:zA,reset:HA,apply:VA,showOnly:WA,range:GA,distance:YA,verified:KA,withPhotos:JA,dismiss:QA,inactive:XA,preferences:ZA,errorTitle:ej,smallSize:tj,mediumSize:sj,largeSize:nj,loadMoreButton:rj,closeButton:oj,confirmButton:ij,cancelButton:aj,errorOccurred:cj,tryAgain:lj,languageSelect:dj,switchToHebrew:uj,switchToEnglish:hj,english:fj,hebrew:gj,currentlyUsing:pj,browseAndConnect:mj,createNewStory:yj,gridView:vj,listView:_j,noResultsFound:wj,searchForUsers:bj,ageRange:xj,useCurrentLocation:Sj,kmAway:Cj,showMoreTags:kj,showLessTags:Nj,nicknameRequired:Ej,nicknameTooShort:Tj,nicknameTooLong:Aj,nicknameInvalid:jj,ageRequired:Ij,ageInvalid:$j,ageMinimum:Pj,ageMaximum:Rj,locationRequired:Mj,locationTooShort:Lj,bioTooLong:Oj,photoPrivacySuccess:Fj,photoUploadSuccess:Dj,photoDeleteSuccess:Bj,tellAboutYourself:Uj,noBioProvided:qj,noInterestsSelected:zj,noTagsSelected:Hj,interestsLimit:Vj,intoTagsLimit:Wj,turnOnsLimit:Gj,lookingForLimit:Yj,maritalStatusMarried:Kj,saving:Jj,messageConversation:Qj,loadingMessages:Xj,typing:Zj,todayAt:eI,yesterdayAt:tI,toggleFilters:sI,messagesFrom:nI,messageDeleted:rI,messageAttachment:oI,sendMessage:iI,messagePlaceholder:aI,searchUsers:cI,conversations:lI,emptyInbox:dI,startConversationNow:uI,writeFirstMessage:hI,readReceipt:fI,sendingMessage:gI,freeAccountWink:pI,upgradeToSendText:mI,upgradeToSendFiles:yI,messageInput:vI,selectEmoji:_I,closeEmojiPicker:wI,addEmoji:bI,sendWink:xI,attachFile:SI,sendFile:CI,search:kI,messages:NI,profile:EI,settings:TI,logout:AI,login:jI,register:II,subscription:$I,emailRequired:PI,passwordLengthError:RI,passwordLowercaseError:MI,passwordUppercaseError:LI,passwordNumberError:OI,passwordSpecialError:FI,passwordMatchError:DI,passwordRequirements:BI,validationError:UI,generalError:qI,dateOfBirthRequired:zI,ageRestriction:HI,invalidDateOfBirth:VI,selectIdentity:WI,locationTooLong:GI,profilePhotoRequired:YI,maritalStatusRequired:KI,selectLookingFor:JI,tooManyLookingFor:QI,tooManyIntoTags:XI,tooManyTurnOns:ZI,interestsRequired:e$,tooManyInterests:t$,termsRequired:s$,privacyRequired:n$,uploadTypeMismatch:r$,uploadSizeLimitExceeded:o$,registerCreateAccount:i$,registerEnterBasicInfo:a$,registerNickname:c$,registerChooseNickname:l$,registerNicknameHelp:d$,registerEnterEmail:u$,registerEmailHelp:h$,registerCreatePassword:f$,registerConfirmPassword:g$,registerPasswordHelp:p$,registerContinue:m$,registerAccountStep:y$,registerProfileStep:v$,registerPhotoStep:_$,registerPreferencesStep:w$,registerTellAboutYourself:b$,registerAddBasicProfileDetails:x$,registerDateOfBirth:S$,registerDateOfBirthHelp:C$,registerIAmA:k$,registerLocation:N$,registerLocationPlaceholder:E$,registerLocationHelp:T$,registerBack:A$,registerUploadYourPhoto:j$,registerImproveVisibility:I$,registerClickToUpload:$$,registerProfileImageHelp:P$,registerProfileImageSize:R$,registerChangePhoto:M$,registerRemovePhoto:L$,registerYourPreferences:O$,registerTellWhatLooking:F$,registerMaritalStatus:D$,registerSelectStatus:B$,registerLookingFor:U$,registerLookingForHelp:q$,registerInterests:z$,registerInterestsHelp:H$,registerImInto:V$,registerImIntoHelp:W$,registerTurnsMeOn:G$,registerTurnsMeOnHelp:Y$,registerTermsAgreement:K$,registerPrivacyAgreement:J$,registerNewsletterAgreement:Q$,registerCreateBtn:X$,registerCreatingAccount:Z$,registerSignUpWith:eP,registerSignUpGoogle:tP,registerSignUpFacebook:sP,unsavedChangesLogout:nP,accountDeletedSuccess:rP,deleteAccountFailed:oP,deleteAccountFailedRetry:iP,messageNotifications:aP,messageNotificationsDesc:cP,callNotifications:lP,callNotificationsDesc:dP,storyNotifications:uP,storyNotificationsDesc:hP,likeNotifications:fP,likeNotificationsDesc:gP,commentNotifications:pP,commentNotificationsDesc:mP,onlineStatus:yP,onlineStatusDesc:vP,readReceipts:_P,readReceiptsDesc:wP,lastSeen:bP,lastSeenDesc:xP,storyReplies:SP,storyRepliesDesc:CP,everyone:kP,noOne:NP,blockedUsers:EP,blockedUsersDesc:TP,loadingBlockedUsers:AP,defaultUser:jP,noBlockedUsers:IP,themeMode:$P,themeModeDesc:PP,light:RP,dark:MP,system:LP,quickThemeToggle:OP,quickThemeToggleDesc:FP,languageDesc:DP,username:BP,notAvailable:UP,memberSince:qP,freePlan:zP,notificationSettings:HP,privacySettings:VP,appearanceSettings:WP,accountSettings:GP,saveChanges:YP,deleteWarning:KP,cannotBeUndone:JP,deleteDataWarning:QP,profileInformation:XP,messagesAndConversations:ZP,photosAndMedia:eR,storiesAndContent:tR,enterPasswordConfirm:sR,yourPassword:nR,deleteMyAccount:rR,passwordRequired:oR,loadingSettings:iR,hidePassword:aR,showPassword:cR,confirmPassword:lR,or:dR,emailAddress:uR,registerSuccess:hR,signIn:fR,signUp:gR,signInWith:pR,dontHaveAccount:mR,rememberMe:yR,compatibility:vR,loadingProfile:_R,errorUnknown:wR,close:bR,notFound:xR,userNotFound:SR,allowPrivatePhotos:CR,previous:kR,next:NR,requestAccessPending:ER,noPhotosAvailable:TR,liked:AR,like:jR,message:IR,moreActions:$R,reportUser:PR,blockUser:RR,premium:MR,unknownLocation:LR,showMore:OR,tokenMissing:FR,accountVerified:DR,verificationFailed:BR,verificationEmailSent:UR,loginToResend:qR,verifyEmail:zR,verifyingEmail:HR,verificationSuccess:VR,goBack:WR,backToLogin:GR,languageHebrew:YR,languageEnglish:KR,privacyFirst:JR,privacyDescription:QR,secureTitle:XR,secureCommDescription:ZR,matchTitle:e7,smartMatchingDescription:t7,findYourConnection:s7,heroSubtitle:n7,emailPlaceholder:r7,getStarted:o7,peopleOnlineNow:i7,onlineNowSubtitle:a7,notSpecified:c7,joinToSeeMore:l7,featuresTitle:d7,confirmDeletePhoto:u7,cannotDeleteProfilePhoto:h7,noPhotos:f7,photo:g7,photoThumbnail:p7,previousPhoto:m7,nextPhoto:y7,makePublic:v7,makePrivate:_7,private:"Private",friendsOnly:w7,profilePhoto:b7,setAsProfilePhoto:x7,setAsProfile:S7,deletePhoto:C7,notificationsTitle:k7,markAllRead:N7,refresh:E7,refreshing:T7,noUnreadNotifications:A7,noNotifications:j7,noFilteredNotifications:I7,updatesPaused:$7,reconnect:P7,fetchFailed:R7,upgradeSuccess:M7,paymentFailed:L7,backToDashboard:O7,premiumMembership:F7,alreadyPremium:D7,enjoyFeatures:B7,unlockFeatures:U7,upgradeExperience:q7,monthly:z7,yearly:H7,save:V7,freeTier:W7,forever:G7,currentPlan:Y7,mostPopular:K7,paidTier:J7,perMonth:Q7,perMonthYearly:X7,viewProfiles:Z7,sendWinks:e9,limitedLikes:t9,limitedStories:s9,unlimitedLikes:n9,unlimitedStories:r9,videoCalls:o9,prioritySearch:i9,processing:a9,subscribe:c9,supportTitle:l9,contactUs:d9,faq:u9,liveChat:h9,liveChatHours:f9,contactForm:g9,formSuccess:p9,formName:m9,formEmail:y9,formSubject:v9,formMessage:_9,formSubmit:w9,frequentlyAskedQuestions:b9,backToHome:x9,aboutUs:S9,privacyPolicy:C9,termsOfService:k9,faq1Question:N9,faq1Answer:E9,faq2Question:T9,faq2Answer:A9,faq3Question:j9,faq3Answer:I9,faq4Question:$9,faq4Answer:P9,faq5Question:R9,faq5Answer:M9,faq6Question:L9,faq6Answer:O9,faq7Question:F9,faq7Answer:D9,tag_online_fun:B9,tag_camera_chat:U9,tag_in_a_public_place:q9,tag_leather_latex_clothing:z9,tag_power_play:H9,tag_sensual_massage:V9,tag_risktaking:W9,tag_dirty_talk:G9,tag_music:Y9,tag_single:K9,tag_married:J9,tag_divorced:Q9,tag_separated:X9,tag_relationship:Z9,tag_consensual_non_monogamy:eM,tag_role_play:tM,tag_bdsm:sM,tag_gentle_touch:nM,tag_intense_passion:rM,tag_outdoor_adventure:oM,tag_intellectual_discussion:iM,tag_foodie:aM,tag_art_lover:cM,tag_fitness_enthusiast:lM,tag_movie_buff:dM,tag_travel_addict:uM,tag_tech_geek:hM,tag_nature_lover:fM,tag_social_butterfly:gM,tag_homebody:pM,tag_spontaneous:mM,tag_planner:yM,tag_night_owl:vM,tag_early_bird:_M,tag_casual:wM,tag_serious_relationship:bM,tag_friendship:xM,tag_networking:SM,tag_dominant:CM,tag_submissive:kM,tag_switch:NM,tag_vanilla:EM,tag_kinky:TM,tag_experimental:AM,tag_voyeurism:jM,tag_exhibitionism:IM,tag_toys:$M,tag_blindfolds:PM,tag_restraints:RM,"Fantasy fulfillment":"Fantasy fulfillment","Fantasy sharing":"Fantasy sharing",Toys:MM,"Weekend getaways":"Weekend getaways",Costumes:LM,Meetups:OM,"Power play":"Power play",Threesomes:FM,"Online fun":"Online fun","Hot chat":"Hot chat","Photo sharing":"Photo sharing","Camera chat":"Camera chat",Cuckold:DM,"Golden showers":"Golden showers","Strap-on":"Strap-on","Forced bi":"Forced bi","Erotic domination":"Erotic domination",Humiliation:BM,Crossdressing:UM,Worship:qM,"Foot fetish":"Foot fetish",Oral:zM,"From behind":"From behind","Role-play":"Role-play",Massages:HM,Foreplay:VM,"Casual meetups":"Casual meetups",Bizarre:WM,Education:GM,Experiences:YM,Tantra:KM,"Sexy ass":"Sexy ass","Dirty talk":"Dirty talk",Aggressive:JM,"Slow and gentle":"Slow and gentle","In a public place":"In a public place",Pampering:QM,"Sexy clothing":"Sexy clothing","Leather/latex clothing":"Leather/latex clothing","Watching porn":"Watching porn","Fit body":"Fit body","Bathing together":"Bathing together","Erotic writing":"Erotic writing","Eye contact":"Eye contact","Being pampered":"Being pampered","Sexy legs":"Sexy legs",Teasing:XM,"Pushing boundaries":"Pushing boundaries",Kink:ZM,Comedy:eL,Spirituality:tL,Community:sL,Watching:nL,Parties:rL,"Outdoor adventures":"Outdoor adventures","Hotel fun":"Hotel fun",Lingerie:oL,Voice:iL,Kindness:aL,Dancing:cL,Creativity:lL,Success:dL,Pets:uL,Casual:hL,"Long-term":"Long-term",Dating:fL,Friendship:gL,Travel:pL,Outdoors:mL,Movies:yL,Music:vL,Fitness:_L,Food:wL,Art:bL,Reading:xL,Gaming:SL,Photography:CL,Cooking:kL,createAccount:NL,accountStep:EL,profileStep:TL,photoStep:AL,preferencesStep:jL,enterBasicInfo:IL,chooseNickname:$L,nicknameHelp:PL,enterEmail:RL,emailHelp:ML,createPassword:LL,passwordHelp:OL,continue:"Continue",signUpWith:FL,signUpGoogle:DL,signUpFacebook:BL,safety:UL,contactSupport:qL,allRightsReserved:zL,addBasicProfileDetails:HL,iAmA:VL,locationPlaceholder:WL,locationHelp:GL,dateOfBirth:YL,dateOfBirthHelp:KL,uploadYourPhoto:JL,improveVisibility:QL,clickToUpload:XL,profileImageHelp:ZL,profileImageSize:eO,changePhoto:tO,removePhoto:sO,yourPreferences:nO,tellWhatLooking:rO,selectStatus:oO,lookingForHelp:iO,interestsHelp:aO,Sports:cO,imInto:lO,imIntoHelp:dO,turnsMeOn:uO,turnsMeOnHelp:hO,termsAgreement:fO,privacyAgreement:gO,newsletterAgreement:pO,createBtn:mO,Single:yO,Married:vO,Divorced:_O,Separated:wO,Widowed:bO,"In a relationship":"In a relationship","It's complicated":"It's complicated","Open relationship":"Open relationship",Polyamorous:xO},CO="המייל שלך לא מאומת. בבקשה לאמת את כתובת המייל כדי לפתוח את כל הפיצ'רים.",kO="שלח/י מחדש מייל אימות",NO="שליחה חוזרת של מייל ({{cooldown}} דקות)",EO="שליחה חוזרת של מייל",TO="שולח...",AO="העדכון נכשל",jO="תמונת הפרופיל עודכנה בהצלחה",IO="סטטוס זוגי",$O="ביטול",PO="עריכה",RO="טוען...",MO="שגיאה",LO="הצלחה",OO="מחובר",FO="לא מחובר",DO="שלח",BO="צפה",UO="הפרופיל שלי",qO="עריכת פרופיל",zO="דאשבורד",HO="בית",VO="אודות",WO="פרטיות",GO="תנאים",YO="עזרה",KO="אחורה",JO="עוד",QO="פחות",XO="הצג פחות",ZO="תמונות",eF="הוסף תמונה",tF="מעלה...",sF="כינוי",nF="גיל",rF="מיקום",oF="ביו",iF="עליי",aF="זהות",cF="אני",lF="מחפש/ת",dF="תחומי עניין",uF="אני בקטע של",hF="מה שמדליק אותי",fF="פעילות אחרונה",gF="מעדכן פרטיות תמונה...",pF="מעדכן תמונת פרופיל...",mF="הפרופיל עודכן בהצלחה",yF="גבר",vF="אישה",_F="זוג",wF="גברים",bF="נשים",xF="זוגות",SF="הודעה חדשה",CF="הקלד/י הודעה...",kF="אין הודעות עדיין",NF="התחל/י שיחה",EF="חפש/י אנשי קשר",TF="חשבון",AF="התראות",jF="שפה",IF="ערכת נושא",$F="מייל",PF="סיסמה",RF="שכחת סיסמה?",MF="אין לך חשבון?",LF="יש לך כבר חשבון?",OF="עדכון הפרופיל נכשל",FF="העלאת התמונה נכשלה",DF="עדכון פרטיות התמונה נכשל",BF="עדכון תמונת הפרופיל נכשל",UF="מחיקת התמונה נכשלה",qF="שדה חובה",zF="נא להזין כתובת מייל תקינה",HF="גילוי",VF="חקור/י",WF="קרוב אלייך",GF="פופולרי",YF="מחוברים עכשיו",KF="משתמשים חדשים",JF="מידע בסיסי",QF="אשר/י בקשות לתמונות",XF="חסמת את המשתמש/ת הזה. הוא/היא לא יקבלו ממך הודעות.",ZF="מנותק",eD="החיבור אבד",tD="התחל/י שיחת וידאו",sD="צפה בפרופיל",nD="בטל/י חסימת משתמש",rD="חסום",oD="אפשרויות נוספות",iD="בטל חסימה",aD="דפדוף במשתמשים",cD="ההתאמות שלך",lD="מצא/י התאמות",dD="טוען משתמשים...",uD="טוען עוד משתמשים...",hD="לא נמצאו התאמות",fD="נסה/י לשנות את הפילטרים כדי לראות עוד תוצאות",gD="הסטוריז שלי",pD="צור/י סטורי",mD="סנן",yD="פילטרים",vD="איפוס",_D="החל",wD="הצג רק",bD="טווח",xD="מרחק",SD="מאומת",CD="עם תמונות",kD="התעלם/י",ND="לא פעיל/ה אף פעם",ED="העדפות",TD="שגיאה",AD="קטן",jD="בינוני",ID="גדול",$D="טען עוד",PD="סגור",RD="אישור",MD="ביטול",LD="אירעה שגיאה",OD="נסה/י שוב",FD="בחר/י שפה",DD="החלף לעברית",BD="החלף לאנגלית",UD="אנגלית",qD="עברית",zD="כרגע בשימוש:",HD="דפדף/י והתחבר/י עם אנשים חדשים",VD="צור/י סטורי חדש",WD="תצוגת רשת",GD="תצוגת רשימה",YD="לא נמצאו תוצאות",KD="חפש/י משתמשים",JD="טווח גילאים",QD="השתמש/י במיקום הנוכחי",XD='ק"מ ממך',ZD="הצג עוד תגיות",eB="הצג פחות תגיות",tB="כינוי הוא שדה חובה",sB="הכינוי חייב להיות לפחות 3 תווים",nB="הכינוי חייב להיות פחות מ-50 תווים",rB="הכינוי יכול להכיל רק אותיות בכל שפה, מספרים וקווים תחתונים",oB="גיל הוא שדה חובה",iB="נא להזין גיל תקין",aB="חייב/ת להיות לפחות בן/בת 18",cB="הגיל חייב להיות פחות מ-120",lB="מיקום הוא שדה חובה",dB="המיקום חייב להיות לפחות 2 תווים",uB="הביו חייב להיות פחות מ-500 תווים",hB="פרטיות התמונה עודכנה ל{{status}}",fB="התמונה הועלתה בהצלחה",gB="התמונה נמחקה בהצלחה",pB="ספר/י לאחרים על עצמך...",mB="לא סופק ביו",yB="לא נבחרו תחומי עניין",vB="לא נבחרו תגיות",_B="בחר/י עד 10 תחומי עניין",wB="בחר/י עד 20 תגיות",bB="בחר/י עד 20 דברים שמדליקים אותך",xB="בחר/י עד 3 אפשרויות",SB="נשוי/אה",CB="שומר...",kB="שיחת הודעות",NB="טוען הודעות...",EB="מקליד/ה...",TB="היום ב",AB="אתמול ב",jB="החלף פילטרים",IB="הודעות מ{{user}}",$B="ההודעה הזו נמחקה",PB="קובץ מצורף",RB="שלח/י הודעה",MB="הקלד/י הודעה...",LB="חפש/י משתמשים",OB="שיחות",FB="תיבת הדואר הנכנס שלך ריקה",DB="התחל/י שיחה עכשיו",BB="כתוב/י את ההודעה הראשונה שלך",UB="נקרא",qB="שולח הודעה...",zB="שלח/י קריצה במקום (חשבון חינמי)",HB="שדרג/י כדי לשלוח הודעות טקסט",VB="שדרג/י כדי לשלוח קבצים",WB="קלט הודעה",GB="בחר/י אימוג'י",YB="סגור/י בורר אימוג'י",KB="הוסף/י אימוג'י",JB="שלח/י קריצה",QB="צרף/י קובץ",XB="שלח/י קובץ",ZB="חיפוש",eU="הודעות",tU="פרופיל",sU="הגדרות",nU="התנתק/י",rU="התחבר/י",oU="הרשמה",iU="מנוי",aU="מייל הוא שדה חובה",cU="הסיסמה חייבת להיות לפחות 8 תווים",lU="הסיסמה חייבת לכלול לפחות אות קטנה אחת",dU="הסיסמה חייבת לכלול לפחות אות גדולה אחת",uU="הסיסמה חייבת לכלול לפחות מספר אחד",hU="הסיסמה חייבת לכלול לפחות תו מיוחד אחד (@$!%*?&)",fU="הסיסמאות לא תואמות",gU="הסיסמה חייבת להיות לפחות 6 תווים",pU="הוא שדה חובה",mU="אירעה שגיאה לא צפויה",yU="תאריך לידה הוא שדה חובה",vU="חייב/ת להיות לפחות בן/בת 18",_U="נא להזין תאריך לידה תקין",wU="נא לבחור מי את/ה",bU="המיקום לא יכול להיות ארוך מ-100 תווים",xU="נא להעלות תמונת פרופיל",SU="נא לבחור סטטוס זוגי",CU="נא לבחור מה את/ה מחפש/ת",kU="נא לבחור לא יותר מ-3 אפשרויות",NU="נא לבחור לא יותר מ-20 תגיות 'אני בקטע של'",EU="נא לבחור לא יותר מ-20 תגיות 'מה שמדליק אותי'",TU="נא לבחור לפחות תחום עניין אחד",AU="נא לבחור לא יותר מ-10 תחומי עניין",jU="חובה להסכים לתנאי השירות",IU="חובה להסכים למדיניות הפרטיות",$U="נא להעלות קובץ תמונה תקין (JPEG, JPG או PNG)",PU="גודל התמונה צריך להיות פחות מ-5MB",RU="צור/י את החשבון שלך",MU="הזן/י את המידע הבסיסי שלך",LU="כינוי",OU="בחר/י כינוי",FU="שם התצוגה הציבורי שלך (יכול להכיל אותיות, מספרים וקווים תחתונים)",DU="הזן/י את המייל שלך",BU="לעולם לא נשתף את המייל שלך עם אף אחד אחר",UU="צור/י סיסמה",qU="אשר/י סיסמה",zU="חייב להיות לפחות 8 תווים עם אות גדולה, אות קטנה, מספר ותו מיוחד",HU="המשך/י",VU="חשבון",WU="פרופיל",GU="תמונה",YU="העדפות",KU="ספר/י לנו על עצמך",JU="הוסף/י כמה פרטי פרופיל בסיסיים",QU="תאריך לידה",XU="חייב/ת להיות לפחות בן/בת 18 כדי להשתמש בשירות זה",ZU="אני",eq="מיקום",tq="עיר, מדינה",sq="המיקום הכללי שלך (למשל, תל אביב, ישראל)",nq="אחורה",rq="העלה/י את התמונה שלך",oq="הוסף/י תמונת פרופיל כדי לשפר את הנראות שלך",iq="לחץ/י להעלאת תמונת פרופיל",aq="התמונות צריכות להיות ברורות, עדכניות ולהציג את הפנים שלך",cq="גודל מקסימלי: 5MB. פורמטים: JPG, JPEG, PNG",lq="שנה/י תמונה",dq="הסר/י",uq="ההעדפות שלך",hq="ספר/י לנו על עצמך ומה את/ה מחפש/ת",fq="סטטוס זוגי",gq="בחר/י את הסטטוס שלך",pq="מחפש/ת",mq="בחר/י עד 3 אפשרויות",yq="תחומי עניין",vq="בחר/י עד 10 תחומי עניין",_q="אני בקטע של",wq="בחר/י עד 20 תגיות",bq="זה מדליק אותי",xq="בחר/י עד 20 תגיות",Sq="אני מסכים/ה ל",Cq="אני מסכים/ה ל",kq="אני רוצה לקבל חדשות והצעות מיוחדות (אופציונלי)",Nq="צור/י חשבון",Eq="יוצר חשבון...",Tq="או הירשם/י עם",Aq="הירשם/י עם גוגל",jq="הירשם/י עם פייסבוק",Iq="יש לך שינויים שלא נשמרו. בטוח שאת/ה רוצה להתנתק?",$q="החשבון נמחק בהצלחה",Pq="מחיקת החשבון נכשלה",Rq="מחיקת החשבון נכשלה. נסה/י שוב.",Mq="התראות על הודעות",Lq="קבל/י התראה כשאת/ה מקבל/ת הודעות חדשות",Oq="התראות על שיחות",Fq="קבל/י התראה על שיחות נכנסות",Dq="התראות על סטוריז",Bq="קבל/י התראה כשחברים מפרסמים סטוריז חדשים",Uq="התראות על לייקים",qq="קבל/י התראה כשמישהו עושה לייק לתוכן שלך",zq="התראות על תגובות",Hq="קבל/י התראה כשמישהו מגיב לתוכן שלך",Vq="סטטוס מחובר/ת",Wq="הצג/י מתי את/ה פעיל/ה באפליקציה",Gq="אישורי קריאה",Yq="תן/י לאחרים לדעת מתי קראת את ההודעות שלהם",Kq="נראה/תה לאחרונה",Jq="הצג/י מתי היית פעיל/ה לאחרונה",Qq="תגובות לסטורי",Xq="שלוט/י מי יכול להגיב לסטוריז שלך",Zq="כולם",ez="אף אחד",tz="משתמשים חסומים",sz="משתמשים שחסמת לא יכולים לשלוח לך הודעות או לראות את הפרופיל שלך",nz="טוען משתמשים חסומים...",rz="משתמש/ת",oz="עדיין לא חסמת אף משתמש/ת",iz="מצב ערכת נושא",az="בחר/י איך האפליקציה תיראה לך",cz="בהיר",lz="כהה",dz="מערכת",uz="החלפה מהירה של ערכת נושא",hz="החלף/י במהירות בין מצב בהיר לכהה",fz="בחר/י את השפה המועדפת עליך",gz="שם משתמש",pz="לא זמין",mz="חבר/ה מאז",yz="חינם",vz="הגדרות התראות",_z="הגדרות פרטיות",wz="הגדרות מראה",bz="הגדרות חשבון",xz="שמור/י שינויים",Sz="פעולה זו",Cz="לא ניתנת לביטול",kz="כל הנתונים שלך יימחקו לצמיתות, כולל:",Nz="פרטי הפרופיל שלך",Ez="כל ההודעות והשיחות",Tz="תמונות ומדיה ששיתפת",Az="סטוריז ותכנים אחרים",jz="הזן/י את הסיסמה שלך לאישור:",Iz="הסיסמה שלך",$z="מחק/י את החשבון שלי",Pz="נא להזין את הסיסמה שלך לאישור מחיקת החשבון",Rz="טוען את ההגדרות שלך...",Mz="הסתר/י סיסמה",Lz="הצג/י סיסמה",Oz="אשר/י סיסמה",Fz="או",Dz="כתובת מייל",Bz="ברוך/ה הבא/ה למנדרין! החשבון שלך נוצר בהצלחה.",Uz="התחבר/י",qz="הירשם/י",zz="התחבר/י עם",Hz="אין לך חשבון?",Vz="זכור/י אותי",Wz="התאמה",Gz="טוען פרופיל...",Yz="שגיאה לא ידועה",Kz="סגור",Jz="לא נמצא",Qz="המשתמש/ת לא נמצא/ה",Xz="אפשר/י תמונות פרטיות",Zz="הקודם",eH="הבא",tH="ממתין/ה",sH="אשר/י",nH="דחה/י",rH="אין תמונות זמינות",oH="אהבתי",iH="לייק",aH="הודעה",cH="פעולות נוספות",lH="דווח/י על משתמש/ת",dH="חסום/י משתמש/ת",uH="פרימיום",hH="מיקום לא ידוע",fH="הצג/י עוד",gH="אסימון האימות חסר",pH="החשבון שלך אומת בהצלחה",mH="אימות המייל נכשל",yH="מייל אימות נשלח",vH="נא להתחבר כדי לשלוח מחדש מייל אימות",_H="אמת/י מייל",wH="מאמת את כתובת המייל שלך...",bH="האימות הושלם בהצלחה",xH="חזור/י אל",SH="חזרה להתחברות",CH="עברית",kH="English",NH="פרטיות קודמת לכל",EH="הפרטיות שלך היא בראש סדר העדיפויות שלנו. שלוט/י מי רואה את הפרופיל שלך ואיזה מידע את/ה משתפ/ת.",TH="תקשורת מאובטחת",AH="הודעות מוצפנות מקצה לקצה מבטיחות שהשיחות שלך יישארו פרטיות ומאובטחות.",jH="התאמה חכמה",IH="האלגוריתם המתקדם שלנו מחבר אותך עם אנשים שתואמים להעדפות ולתחומי העניין שלך.",$H="מצא/י את החיבור המושלם שלך",PH="גלה/י חיבורים אמיתיים בסביבה בטוחה ודיסקרטית המיועדת למבוגרים המחפשים מפגשים משמעותיים.",RH="הזן/י את המייל שלך",MH="להתחיל",LH="אנשים מחוברים עכשיו",OH="התחבר/י עם האנשים המדהימים האלה שפעילים כרגע במנדרין",FH="לא צוין",DH="הצטרף/י כדי לראות עוד",BH="למה לבחור במנדרין",UH="בטוח שאת/ה רוצה למחוק את התמונה הזו?",qH="אי אפשר למחוק את תמונת הפרופיל שלך. בבקשה הגדר/י תמונה אחרת כתמונת פרופיל קודם.",zH="אין תמונות",HH="תמונה",VH="התמונה הזו פרטית",WH="תמונה ממוזערת",GH="התמונה הקודמת",YH="התמונה הבאה",KH="הפוך/י לציבורי",JH="הפוך/י לפרטי",QH="לחברים בלבד",XH="פרופיל",ZH="הגדר/י כתמונת פרופיל",eV="הגדר/י כתמונת פרופיל",tV="מחק/י תמונה",sV="התראות",nV="סמן/י הכל כנקרא",rV="רענן/י",oV="מרענן...",iV="אין התראות שלא נקראו",aV="אין התראות עדיין",cV="אין התראות {{filter}}",lV="עדכונים בזמן אמת מושהים",dV="התחבר/י מחדש",uV="טעינת נתוני המנוי נכשלה",hV="המנוי שלך שודרג בהצלחה",fV="עיבוד התשלום נכשל",gV="חזרה לדאשבורד",pV="חברות פרימיום",mV="יש לך כבר גישת פרימיום",yV="תהנה/י מכל פיצ'רי הפרימיום עם החשבון הנוכחי שלך!",vV="פתח/י פיצ'רי פרימיום",_V="שדרג/י את החוויה שלך עם גישת פרימיום",wV="חודשי",bV="שנתי",xV="חסוך/י",SV="חינם",CV="לתמיד",kV="התוכנית הנוכחית",NV="הכי פופולרי",EV="פרימיום",TV="לחודש",AV="לחודש, בחיוב שנתי",jV="צפייה בפרופילים",IV="שליחת קריצות",$V="לייקים מוגבלים",PV="סטוריז מוגבלים",RV="לייקים ללא הגבלה",MV="סטוריז ללא הגבלה",LV="שיחות וידאו",OV="עדיפות בתוצאות חיפוש",FV="מעבד...",DV="הירשם/י עכשיו",BV="מרכז תמיכה",UV="צור/י קשר",qV="שאלות נפוצות",zV="צ'אט חי",HV="זמין 9:00-18:00 (שעון ישראל)",VV="שלח/י לנו הודעה",WV="תודה! ההודעה שלך נשלחה. נחזור אליך בקרוב.",GV="השם שלך",YV="כתובת מייל",KV="נושא",JV="הודעה",QV="שלח/י הודעה",XV="שאלות נפוצות",ZV="חזרה לעמוד הבית",eW="אודותינו",tW="מדיניות פרטיות",sW="תנאי שירות",nW="איך אני יוצר/ת חשבון?",rW="כדי ליצור חשבון, לחץ/י על כפתור 'הרשמה' בעמוד הבית. מלא/י את הפרטים שלך, העלה/י תמונת פרופיל והגדר/י את ההעדפות שלך. לאחר שתאמת/י את המייל שלך, החשבון שלך יופעל.",oW="איך אני יכול/ה לשנות את הגדרות החשבון שלי?",iW="עבור/י לעמוד 'הגדרות' לאחר ההתחברות. שם, תוכל/י לעדכן את פרטי הפרופיל שלך, העדפות התראות, הגדרות פרטיות ופרטי חשבון.",aW="האם המידע האישי שלי מאובטח?",cW="כן, אנחנו לוקחים את האבטחה ברצינות רבה. אנחנו משתמשים בהצפנה כדי להגן על הנתונים שלך ולעולם לא משתפים את המידע האישי שלך עם צדדים שלישיים ללא הסכמתך. לפרטים נוספים, אנא עיין/י במדיניות הפרטיות שלנו.",lW="איך אני מבטל/ת את המנוי שלי?",dW="כדי לבטל את המנוי שלך, עבור/י ל'הגדרות > מנוי' ולחץ/י על 'ביטול מנוי'. הטבות הפרימיום שלך יישארו פעילות עד סוף תקופת החיוב הנוכחית שלך.",uW="איך אני יכול/ה לדווח על התנהגות לא הולמת?",hW="אם נתקלת בהתנהגות לא הולמת, השתמש/י בכפתור 'דווח' בפרופיל המשתמש/ת או בשרשור ההודעה. צוות הפיקוח שלנו יבדוק את הדיווח וינקוט בפעולה המתאימה תוך 24 שעות.",fW="מה עלי לעשות אם שכחתי את הסיסמה שלי?",gW="בעמוד ההתחברות, לחץ/י על 'שכחתי סיסמה'. הזן/י את כתובת המייל שלך, ואנחנו נשלח לך הוראות לאיפוס הסיסמה שלך. מטעמי אבטחה, קישור האיפוס יפוג לאחר 24 שעות.",pW="איך אני מוחק/ת את החשבון שלי?",mW="עבור/י ל'הגדרות > חשבון' וגלול/י לתחתית שם תמצא/י את האפשרות 'מחק חשבון'. שים/י לב שמחיקת חשבון היא לצמיתות ולא ניתנת לביטול.",yW="פאן אונליין",vW="צ'אט מצלמה",_W="במקום ציבורי",wW="בגדי עור/לטקס",bW="משחקי כוח",xW="מסאז' חושני",SW="לקיחת סיכונים",CW="דיבורים מלוכלכים",kW="מוזיקה",NW="רווק/ה",EW="נשוי/אה",TW="גרוש/ה",AW="פרוד/ה",jW="במערכת יחסים",IW="אי-מונוגמיה בהסכמה",$W="משחקי תפקידים",PW="BDSM",RW="מגע עדין",MW="תשוקה עזה",LW="הרפתקאות בחוץ",OW="דיון אינטלקטואלי",FW="פודי",DW="חובב/ת אמנות",BW="חובב/ת כושר",UW="חובב/ת סרטים",qW="מכור/ה לטיולים",zW="גיק טכנולוגי",HW="חובב/ת טבע",VW="פרפר חברתי",WW="אוהב/ת בית",GW="ספונטני/ת",YW="מתכנן/ת",KW="ינשוף לילה",JW="ציפור בוקר",QW="קז'ואל",XW="קשר רציני",ZW="חברות",eG="נטוורקינג",tG="דומיננטי/ת",sG="כנוע/ה",nG="ונילה",rG="קינקי",oG="ניסיוני/ת",iG="מציצנות",aG="אקסהיביציוניזם",cG="צעצועים",lG="כיסויי עיניים",dG="ריתמות",uG="רווק/ה",hG="נשוי/אה",fG="גרוש/ה",gG="פרוד/ה",pG="אלמן/ה",mG="פוליאמורי/ת",yG="קינק",vG="חיזורים",_G="צעצועים",wG="תחפושות",bG="מפגשים",xG="שלישיות",SG="קוקולד",CG="השפלה",kG="קרוסדרסינג",NG="סגידה",EG="אוראלי",TG="עיסויים",AG="משחק מקדים",jG="ביזארי",IG="חינוך",$G="התנסויות",PG="טנטרה",RG="אגרסיבי/ת",MG="פינוק",LG="קומדיה",OG="רוחניות",FG="קהילה",DG="צפייה",BG="מסיבות",UG="הלבשה תחתונה",qG="קול",zG="טוב לב",HG="ריקוד",VG="יצירתיות",WG="הצלחה",GG="חיות מחמד",YG="קזואלי",KG="דייטים",JG="חברות",QG="טיולים",XG="חוץ",ZG="סרטים",eY="מוזיקה",tY="כושר",sY="אוכל",nY="אמנות",rY="קריאה",oY="משחקים",iY="צילום",aY="בישול",cY="צור חשבון חדש",lY="חשבון",dY="פרופיל",uY="תמונה",hY="העדפות",fY="הזן מידע בסיסי",gY="בחר כינוי",pY="שם התצוגה הציבורי שלך (יכול להכיל אותיות בכל שפה, מספרים וקווים תחתונים)",mY="הזן את האימייל שלך",yY="לעולם לא נשתף את האימייל שלך עם אף אחד אחר",vY="צור סיסמה",_Y="חייבת להיות לפחות 8 תווים עם אות גדולה, אות קטנה, מספר ותו מיוחד",wY="או הירשם עם",bY="הירשם עם גוגל",xY="הירשם עם פייסבוק",SY="בטיחות",CY="תמיכה",kY="כל הזכויות שמורות.",NY="הוסף פרטי פרופיל בסיסיים",EY="תאריך לידה",TY="חובה להיות בן/בת 18 לפחות כדי להשתמש בשירות זה",AY="אני",jY="עיר, מדינה",IY="המיקום הכללי שלך (לדוגמה, תל אביב, ישראל)",$Y="העלה/י את התמונה שלך",PY="הוסף/י תמונת פרופיל כדי לשפר את הנראות שלך",RY="לחץ/י להעלאת תמונת פרופיל",MY="התמונות צריכות להיות ברורות, עדכניות ולהציג את הפנים שלך",LY="גודל מקסימלי: 5MB. פורמטים: JPG, JPEG, PNG",OY="שנה/י תמונה",FY="הסר/י",DY="ההעדפות שלך",BY="ספר/י לנו על עצמך ומה את/ה מחפש/ת",UY="בחר/י את הסטטוס שלך",qY="בחר/י עד 3 אפשרויות",zY="בחר/י עד 10 תחומי עניין",HY="ספורט",VY="אני בקטע של",WY="בחר/י עד 20 תגיות",GY="זה מדליק אותי",YY="בחר/י עד 20 תגיות",KY="אני מסכים/ה ל",JY="אני מסכים/ה ל",QY="אני רוצה לקבל חדשות והצעות מיוחדות (אופציונלי)",XY="צור/י חשבון",ZY={verificationNeeded:CO,resendVerificationEmail:kO,resendEmailCooldown:NO,resendEmail:EO,sending:TO,updateFailed:AO,profilePhotoUpdated:jO,maritalStatus:IO,cancel:$O,delete:"מחיקה",edit:PO,loading:RO,error:MO,success:LO,online:OO,offline:FO,send:DO,view:BO,myProfile:UO,editProfile:qO,dashboard:zO,home:HO,about:VO,privacy:WO,terms:GO,help:YO,back:KO,more:JO,less:QO,showLess:XO,photos:ZO,addPhoto:eF,uploading:tF,nickname:sF,age:nF,location:rF,bio:oF,aboutMe:iF,identity:aF,iAm:cF,lookingFor:lF,interests:dF,intoTags:uF,turnOns:hF,lastActive:fF,updatingPhotoPrivacy:gF,updatingProfilePhoto:pF,profileUpdated:mF,man:yF,woman:vF,couple:_F,men:wF,women:bF,couples:xF,newMessage:SF,typeMessage:CF,noMessages:kF,startConversation:NF,searchContacts:EF,account:TF,notifications:AF,language:jF,theme:IF,email:$F,password:PF,forgotPassword:RF,noAccount:MF,haveAccount:LF,profileUpdateFailed:OF,photoUploadFailed:FF,photoPrivacyUpdateFailed:DF,profilePhotoUpdateFailed:BF,photoDeleteFailed:UF,required:qF,invalidEmail:zF,discover:HF,explore:VF,nearYou:WF,popular:GF,onlineNow:YF,newUsers:KF,basicInfo:JF,approvePhotoRequests:QF,blockedUserMessage:XF,disconnected:ZF,connectionLost:eD,startVideoCall:tD,viewProfile:sD,unblockUser:nD,blocked:rD,moreOptions:oD,unblock:iD,browseUsers:aD,yourMatches:cD,findMatches:lD,loadingUsers:dD,loadingMoreUsers:uD,noMatches:hD,tryAdjustingFilters:fD,myStories:gD,createStory:pD,filter:mD,filters:yD,reset:vD,apply:_D,showOnly:wD,range:bD,distance:xD,verified:SD,withPhotos:CD,dismiss:kD,inactive:ND,preferences:ED,errorTitle:TD,smallSize:AD,mediumSize:jD,largeSize:ID,loadMoreButton:$D,closeButton:PD,confirmButton:RD,cancelButton:MD,errorOccurred:LD,tryAgain:OD,languageSelect:FD,switchToHebrew:DD,switchToEnglish:BD,english:UD,hebrew:qD,currentlyUsing:zD,browseAndConnect:HD,createNewStory:VD,gridView:WD,listView:GD,noResultsFound:YD,searchForUsers:KD,ageRange:JD,useCurrentLocation:QD,kmAway:XD,showMoreTags:ZD,showLessTags:eB,nicknameRequired:tB,nicknameTooShort:sB,nicknameTooLong:nB,nicknameInvalid:rB,ageRequired:oB,ageInvalid:iB,ageMinimum:aB,ageMaximum:cB,locationRequired:lB,locationTooShort:dB,bioTooLong:uB,photoPrivacySuccess:hB,photoUploadSuccess:fB,photoDeleteSuccess:gB,tellAboutYourself:pB,noBioProvided:mB,noInterestsSelected:yB,noTagsSelected:vB,interestsLimit:_B,intoTagsLimit:wB,turnOnsLimit:bB,lookingForLimit:xB,maritalStatusMarried:SB,saving:CB,messageConversation:kB,loadingMessages:NB,typing:EB,todayAt:TB,yesterdayAt:AB,toggleFilters:jB,messagesFrom:IB,messageDeleted:$B,messageAttachment:PB,sendMessage:RB,messagePlaceholder:MB,searchUsers:LB,conversations:OB,emptyInbox:FB,startConversationNow:DB,writeFirstMessage:BB,readReceipt:UB,sendingMessage:qB,freeAccountWink:zB,upgradeToSendText:HB,upgradeToSendFiles:VB,messageInput:WB,selectEmoji:GB,closeEmojiPicker:YB,addEmoji:KB,sendWink:JB,attachFile:QB,sendFile:XB,search:ZB,messages:eU,profile:tU,settings:sU,logout:nU,login:rU,register:oU,subscription:iU,emailRequired:aU,passwordLengthError:cU,passwordLowercaseError:lU,passwordUppercaseError:dU,passwordNumberError:uU,passwordSpecialError:hU,passwordMatchError:fU,passwordRequirements:gU,validationError:pU,generalError:mU,dateOfBirthRequired:yU,ageRestriction:vU,invalidDateOfBirth:_U,selectIdentity:wU,locationTooLong:bU,profilePhotoRequired:xU,maritalStatusRequired:SU,selectLookingFor:CU,tooManyLookingFor:kU,tooManyIntoTags:NU,tooManyTurnOns:EU,interestsRequired:TU,tooManyInterests:AU,termsRequired:jU,privacyRequired:IU,uploadTypeMismatch:$U,uploadSizeLimitExceeded:PU,registerCreateAccount:RU,registerEnterBasicInfo:MU,registerNickname:LU,registerChooseNickname:OU,registerNicknameHelp:FU,registerEnterEmail:DU,registerEmailHelp:BU,registerCreatePassword:UU,registerConfirmPassword:qU,registerPasswordHelp:zU,registerContinue:HU,registerAccountStep:VU,registerProfileStep:WU,registerPhotoStep:GU,registerPreferencesStep:YU,registerTellAboutYourself:KU,registerAddBasicProfileDetails:JU,registerDateOfBirth:QU,registerDateOfBirthHelp:XU,registerIAmA:ZU,registerLocation:eq,registerLocationPlaceholder:tq,registerLocationHelp:sq,registerBack:nq,registerUploadYourPhoto:rq,registerImproveVisibility:oq,registerClickToUpload:iq,registerProfileImageHelp:aq,registerProfileImageSize:cq,registerChangePhoto:lq,registerRemovePhoto:dq,registerYourPreferences:uq,registerTellWhatLooking:hq,registerMaritalStatus:fq,registerSelectStatus:gq,registerLookingFor:pq,registerLookingForHelp:mq,registerInterests:yq,registerInterestsHelp:vq,registerImInto:_q,registerImIntoHelp:wq,registerTurnsMeOn:bq,registerTurnsMeOnHelp:xq,registerTermsAgreement:Sq,registerPrivacyAgreement:Cq,registerNewsletterAgreement:kq,registerCreateBtn:Nq,registerCreatingAccount:Eq,registerSignUpWith:Tq,registerSignUpGoogle:Aq,registerSignUpFacebook:jq,unsavedChangesLogout:Iq,accountDeletedSuccess:$q,deleteAccountFailed:Pq,deleteAccountFailedRetry:Rq,messageNotifications:Mq,messageNotificationsDesc:Lq,callNotifications:Oq,callNotificationsDesc:Fq,storyNotifications:Dq,storyNotificationsDesc:Bq,likeNotifications:Uq,likeNotificationsDesc:qq,commentNotifications:zq,commentNotificationsDesc:Hq,onlineStatus:Vq,onlineStatusDesc:Wq,readReceipts:Gq,readReceiptsDesc:Yq,lastSeen:Kq,lastSeenDesc:Jq,storyReplies:Qq,storyRepliesDesc:Xq,everyone:Zq,noOne:ez,blockedUsers:tz,blockedUsersDesc:sz,loadingBlockedUsers:nz,defaultUser:rz,noBlockedUsers:oz,themeMode:iz,themeModeDesc:az,light:cz,dark:lz,system:dz,quickThemeToggle:uz,quickThemeToggleDesc:hz,languageDesc:fz,username:gz,notAvailable:pz,memberSince:mz,freePlan:yz,notificationSettings:vz,privacySettings:_z,appearanceSettings:wz,accountSettings:bz,saveChanges:xz,deleteWarning:Sz,cannotBeUndone:Cz,deleteDataWarning:kz,profileInformation:Nz,messagesAndConversations:Ez,photosAndMedia:Tz,storiesAndContent:Az,enterPasswordConfirm:jz,yourPassword:Iz,deleteMyAccount:$z,passwordRequired:Pz,loadingSettings:Rz,hidePassword:Mz,showPassword:Lz,confirmPassword:Oz,or:Fz,emailAddress:Dz,registerSuccess:Bz,signIn:Uz,signUp:qz,signInWith:zz,dontHaveAccount:Hz,rememberMe:Vz,compatibility:Wz,loadingProfile:Gz,errorUnknown:Yz,close:Kz,notFound:Jz,userNotFound:Qz,allowPrivatePhotos:Xz,previous:Zz,next:eH,requestAccessPending:tH,approve:sH,reject:nH,noPhotosAvailable:rH,liked:oH,like:iH,message:aH,moreActions:cH,reportUser:lH,blockUser:dH,premium:uH,unknownLocation:hH,showMore:fH,tokenMissing:gH,accountVerified:pH,verificationFailed:mH,verificationEmailSent:yH,loginToResend:vH,verifyEmail:_H,verifyingEmail:wH,verificationSuccess:bH,goBack:xH,backToLogin:SH,languageHebrew:CH,languageEnglish:kH,privacyFirst:NH,privacyDescription:EH,secureTitle:TH,secureCommDescription:AH,matchTitle:jH,smartMatchingDescription:IH,findYourConnection:$H,heroSubtitle:PH,emailPlaceholder:RH,getStarted:MH,peopleOnlineNow:LH,onlineNowSubtitle:OH,notSpecified:FH,joinToSeeMore:DH,featuresTitle:BH,confirmDeletePhoto:UH,cannotDeleteProfilePhoto:qH,noPhotos:zH,photo:HH,privatePhoto:VH,photoThumbnail:WH,previousPhoto:GH,nextPhoto:YH,makePublic:KH,makePrivate:JH,private:"פרטי",friendsOnly:QH,profilePhoto:XH,setAsProfilePhoto:ZH,setAsProfile:eV,deletePhoto:tV,notificationsTitle:sV,markAllRead:nV,refresh:rV,refreshing:oV,noUnreadNotifications:iV,noNotifications:aV,noFilteredNotifications:cV,updatesPaused:lV,reconnect:dV,fetchFailed:uV,upgradeSuccess:hV,paymentFailed:fV,backToDashboard:gV,premiumMembership:pV,alreadyPremium:mV,enjoyFeatures:yV,unlockFeatures:vV,upgradeExperience:_V,monthly:wV,yearly:bV,save:xV,freeTier:SV,forever:CV,currentPlan:kV,mostPopular:NV,paidTier:EV,perMonth:TV,perMonthYearly:AV,viewProfiles:jV,sendWinks:IV,limitedLikes:$V,limitedStories:PV,unlimitedLikes:RV,unlimitedStories:MV,videoCalls:LV,prioritySearch:OV,processing:FV,subscribe:DV,supportTitle:BV,contactUs:UV,faq:qV,liveChat:zV,liveChatHours:HV,contactForm:VV,formSuccess:WV,formName:GV,formEmail:YV,formSubject:KV,formMessage:JV,formSubmit:QV,frequentlyAskedQuestions:XV,backToHome:ZV,aboutUs:eW,privacyPolicy:tW,termsOfService:sW,faq1Question:nW,faq1Answer:rW,faq2Question:oW,faq2Answer:iW,faq3Question:aW,faq3Answer:cW,faq4Question:lW,faq4Answer:dW,faq5Question:uW,faq5Answer:hW,faq6Question:fW,faq6Answer:gW,faq7Question:pW,faq7Answer:mW,online_fun:yW,camera_chat:vW,in_a_public_place:_W,leather_latex_clothing:wW,power_play:bW,sensual_massage:xW,risktaking:SW,dirty_talk:CW,music:kW,single:NW,married:EW,divorced:TW,separated:AW,relationship:jW,consensual_non_monogamy:IW,role_play:$W,bdsm:PW,gentle_touch:RW,intense_passion:MW,outdoor_adventure:LW,intellectual_discussion:OW,foodie:FW,art_lover:DW,fitness_enthusiast:BW,movie_buff:UW,travel_addict:qW,tech_geek:zW,nature_lover:HW,social_butterfly:VW,homebody:WW,spontaneous:GW,planner:YW,night_owl:KW,early_bird:JW,casual:QW,serious_relationship:XW,friendship:ZW,networking:eG,dominant:tG,submissive:sG,switch:"סוויץ'",vanilla:nG,kinky:rG,experimental:oG,voyeurism:iG,exhibitionism:aG,toys:cG,blindfolds:lG,restraints:dG,Single:uG,Married:hG,Divorced:fG,Separated:gG,Widowed:pG,"In a relationship":"במערכת יחסים","It's complicated":"זה מסובך","Open relationship":"מערכת יחסים פתוחה",Polyamorous:mG,Kink:yG,Teasing:vG,"Fantasy sharing":"שיתוף פנטזיות",Toys:_G,"Weekend getaways":"בריחות סוף שבוע",Costumes:wG,"Fantasy fulfillment":"הגשמת פנטזיות",Meetups:bG,"Power play":"משחקי כוח",Threesomes:xG,"Online fun":"פאן אונליין","Hot chat":"צ'אט חם","Photo sharing":"שיתוף תמונות","Camera chat":"צ'אט מצלמה",Cuckold:SG,"Golden showers":"שירותים זהובים","Strap-on":"סטראפ-און","Forced bi":"בי בכפייה","Erotic domination":"שליטה ארוטית",Humiliation:CG,Crossdressing:kG,Worship:NG,"Foot fetish":"פטיש כפות רגליים",Oral:EG,"From behind":"מאחורה","Role-play":"משחקי תפקידים",Massages:TG,Foreplay:AG,"Casual meetups":"מפגשים קז'ואליים",Bizarre:jG,Education:IG,Experiences:$G,Tantra:PG,"Sexy ass":"ישבן סקסי","Dirty talk":"דיבורים מלוכלכים",Aggressive:RG,"Slow and gentle":"איטי ועדין","In a public place":"במקום ציבורי",Pampering:MG,"Sexy clothing":"בגדים סקסיים","Leather/latex clothing":"בגדי עור/לטקס","Watching porn":"צפייה בפורנו","Fit body":"גוף מחוטב","Bathing together":"רחצה משותפת","Erotic writing":"כתיבה ארוטית","Eye contact":"קשר עין","Being pampered":"להיות מפונק/ת","Sexy legs":"רגליים סקסיות","Pushing boundaries":"דחיקת גבולות",Comedy:LG,Spirituality:OG,Community:FG,Watching:DG,Parties:BG,"Outdoor adventures":"הרפתקאות בחוץ","Hotel fun":"כיף במלון",Lingerie:UG,Voice:qG,Kindness:zG,Dancing:HG,Creativity:VG,Success:WG,Pets:GG,Casual:YG,"Long-term":"לטווח ארוך",Dating:KG,Friendship:JG,Travel:QG,Outdoors:XG,Movies:ZG,Music:eY,Fitness:tY,Food:sY,Art:nY,Reading:rY,Gaming:oY,Photography:iY,Cooking:aY,createAccount:cY,accountStep:lY,profileStep:dY,photoStep:uY,preferencesStep:hY,enterBasicInfo:fY,chooseNickname:gY,nicknameHelp:pY,enterEmail:mY,emailHelp:yY,createPassword:vY,passwordHelp:_Y,continue:"המשך",signUpWith:wY,signUpGoogle:bY,signUpFacebook:xY,safety:SY,contactSupport:CY,allRightsReserved:kY,addBasicProfileDetails:NY,dateOfBirth:EY,dateOfBirthHelp:TY,iAmA:AY,locationPlaceholder:jY,locationHelp:IY,uploadYourPhoto:$Y,improveVisibility:PY,clickToUpload:RY,profileImageHelp:MY,profileImageSize:LY,changePhoto:OY,removePhoto:FY,yourPreferences:DY,tellWhatLooking:BY,selectStatus:UY,lookingForHelp:qY,interestsHelp:zY,Sports:HY,imInto:VY,imIntoHelp:WY,turnsMeOn:GY,turnsMeOnHelp:YY,termsAgreement:KY,privacyAgreement:JY,newsletterAgreement:QY,createBtn:XY};_s.use(oh).use(V1);const eK=Ze.create("i18n");_s.init({resources:{en:{translation:SO},he:{translation:ZY}},partialBundledLanguages:!0,supportedLngs:["en","he"],fallbackLng:["he","en"],lng:localStorage.getItem("language")||void 0,ns:["translation"],defaultNS:"translation",keySeparator:!1,nsSeparator:":",detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"]},react:{useSuspense:!0,bindI18n:"languageChanged loaded"},returnEmptyString:!1,returnNull:!1,returnObjects:!0,joinArrays:!0,parseMissingKeyHandler:e=>(eK.warn(`Missing translation key: ${e}`),e.replace(/_/g," ")),saveMissing:!1,missingKeyHandler:(e,t,s,n)=>{},interpolation:{escapeValue:!1},debug:!1});typeof globalThis>"u"&&(window.global=window);wh.createRoot(document.getElementById("root")).render(r.jsx(pt.StrictMode,{children:r.jsx(Ba,{children:r.jsx(gh,{children:r.jsx(bu,{children:r.jsx(jE,{})})})})}));
//# sourceMappingURL=index-yKXDvzwM.js.map
