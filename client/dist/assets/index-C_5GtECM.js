var Kv=Object.defineProperty;var Zv=s=>{throw TypeError(s)};var Jv=(s,t,r)=>t in s?Kv(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var Ad=(s,t,r)=>Jv(s,typeof t!="symbol"?t+"":t,r);var Ga=(s,t,r)=>t.has(s)?Zv("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,r);import{a as Wv,b as eb,p as io,g as jf,r as y,u as mn,c as _f,N as tb,L as nn,R as Gr,d as nb,e as MA,f as sb,h as as,B as rb}from"./vendor-C1jkx_oC.js";import{y as X,G as Oe,L as ib}from"./ui-CrHIGQ-2.js";function ab(s,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const c in i)if(c!=="default"&&!(c in s)){const u=Object.getOwnPropertyDescriptor(i,c);u&&Object.defineProperty(s,c,u.get?u:{enumerable:!0,get:()=>i[c]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(c){if(c.ep)return;c.ep=!0;const u=r(c);fetch(c.href,u)}})();var yd={exports:{}},Xa={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _g;function ob(){if(_g)return Xa;_g=1;var s=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(i,c,u){var f=null;if(u!==void 0&&(f=""+u),c.key!==void 0&&(f=""+c.key),"key"in c){u={};for(var m in c)m!=="key"&&(u[m]=c[m])}else u=c;return c=u.ref,{$$typeof:s,type:i,key:f,ref:c!==void 0?c:null,props:u}}return Xa.Fragment=t,Xa.jsx=r,Xa.jsxs=r,Xa}var Eg;function lb(){return Eg||(Eg=1,yd.exports=ob()),yd.exports}var o=lb(),vd={exports:{}},Qa={},bd={exports:{}},xd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ng;function cb(){return Ng||(Ng=1,function(s){function t(R,Q){var Y=R.length;R.push(Q);e:for(;0<Y;){var P=Y-1>>>1,ie=R[P];if(0<c(ie,Q))R[P]=Q,R[Y]=ie,Y=P;else break e}}function r(R){return R.length===0?null:R[0]}function i(R){if(R.length===0)return null;var Q=R[0],Y=R.pop();if(Y!==Q){R[0]=Y;e:for(var P=0,ie=R.length,J=ie>>>1;P<J;){var ze=2*(P+1)-1,de=R[ze],Z=ze+1,Te=R[Z];if(0>c(de,Y))Z<ie&&0>c(Te,de)?(R[P]=Te,R[Z]=Y,P=Z):(R[P]=de,R[ze]=Y,P=ze);else if(Z<ie&&0>c(Te,Y))R[P]=Te,R[Z]=Y,P=Z;else break e}}return Q}function c(R,Q){var Y=R.sortIndex-Q.sortIndex;return Y!==0?Y:R.id-Q.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;s.unstable_now=function(){return u.now()}}else{var f=Date,m=f.now();s.unstable_now=function(){return f.now()-m}}var v=[],x=[],A=1,S=null,j=3,C=!1,M=!1,U=!1,D=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;function te(R){for(var Q=r(x);Q!==null;){if(Q.callback===null)i(x);else if(Q.startTime<=R)i(x),Q.sortIndex=Q.expirationTime,t(v,Q);else break;Q=r(x)}}function B(R){if(U=!1,te(R),!M)if(r(v)!==null)M=!0,pe();else{var Q=r(x);Q!==null&&ce(B,Q.startTime-R)}}var L=!1,I=-1,E=5,T=-1;function z(){return!(s.unstable_now()-T<E)}function W(){if(L){var R=s.unstable_now();T=R;var Q=!0;try{e:{M=!1,U&&(U=!1,ne(I),I=-1),C=!0;var Y=j;try{t:{for(te(R),S=r(v);S!==null&&!(S.expirationTime>R&&z());){var P=S.callback;if(typeof P=="function"){S.callback=null,j=S.priorityLevel;var ie=P(S.expirationTime<=R);if(R=s.unstable_now(),typeof ie=="function"){S.callback=ie,te(R),Q=!0;break t}S===r(v)&&i(v),te(R)}else i(v);S=r(v)}if(S!==null)Q=!0;else{var J=r(x);J!==null&&ce(B,J.startTime-R),Q=!1}}break e}finally{S=null,j=Y,C=!1}Q=void 0}}finally{Q?H():L=!1}}}var H;if(typeof K=="function")H=function(){K(W)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,re=q.port2;q.port1.onmessage=W,H=function(){re.postMessage(null)}}else H=function(){D(W,0)};function pe(){L||(L=!0,H())}function ce(R,Q){I=D(function(){R(s.unstable_now())},Q)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(R){R.callback=null},s.unstable_continueExecution=function(){M||C||(M=!0,pe())},s.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<R?Math.floor(1e3/R):5},s.unstable_getCurrentPriorityLevel=function(){return j},s.unstable_getFirstCallbackNode=function(){return r(v)},s.unstable_next=function(R){switch(j){case 1:case 2:case 3:var Q=3;break;default:Q=j}var Y=j;j=Q;try{return R()}finally{j=Y}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(R,Q){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var Y=j;j=R;try{return Q()}finally{j=Y}},s.unstable_scheduleCallback=function(R,Q,Y){var P=s.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?P+Y:P):Y=P,R){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=Y+ie,R={id:A++,callback:Q,priorityLevel:R,startTime:Y,expirationTime:ie,sortIndex:-1},Y>P?(R.sortIndex=Y,t(x,R),r(v)===null&&R===r(x)&&(U?(ne(I),I=-1):U=!0,ce(B,Y-P))):(R.sortIndex=ie,t(v,R),M||C||(M=!0,pe())),R},s.unstable_shouldYield=z,s.unstable_wrapCallback=function(R){var Q=j;return function(){var Y=j;j=Q;try{return R.apply(this,arguments)}finally{j=Y}}}}(xd)),xd}var Tg;function ub(){return Tg||(Tg=1,bd.exports=cb()),bd.exports}var Rg;function db(){if(Rg)return Qa;Rg=1;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=ub(),t=Wv(),r=eb();function i(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}var u=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),j=Symbol.for("react.consumer"),C=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),ne=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),B=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function I(e){return e===null||typeof e!="object"?null:(e=L&&e[L]||e["@@iterator"],typeof e=="function"?e:null)}var E=Symbol.for("react.client.reference");function T(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===E?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case v:return"Fragment";case m:return"Portal";case A:return"Profiler";case x:return"StrictMode";case U:return"Suspense";case D:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case C:return(e.displayName||"Context")+".Provider";case j:return(e._context.displayName||"Context")+".Consumer";case M:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ne:return n=e.displayName||null,n!==null?n:T(e.type)||"Memo";case K:n=e._payload,e=e._init;try{return T(e(n))}catch{}}return null}var z=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=Object.assign,H,q;function re(e){if(H===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);H=n&&n[1]||"",q=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+H+e+q}var pe=!1;function ce(e,n){if(!e||pe)return"";pe=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(n){var ke=function(){throw Error()};if(Object.defineProperty(ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ke,[])}catch(ge){var fe=ge}Reflect.construct(e,[],ke)}else{try{ke.call()}catch(ge){fe=ge}e.call(ke.prototype)}}else{try{throw Error()}catch(ge){fe=ge}(ke=e())&&typeof ke.catch=="function"&&ke.catch(function(){})}}catch(ge){if(ge&&fe&&typeof ge.stack=="string")return[ge.stack,fe.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=l.DetermineComponentFrameRoot(),w=h[0],_=h[1];if(w&&_){var O=w.split(`
`),V=_.split(`
`);for(d=l=0;l<O.length&&!O[l].includes("DetermineComponentFrameRoot");)l++;for(;d<V.length&&!V[d].includes("DetermineComponentFrameRoot");)d++;if(l===O.length||d===V.length)for(l=O.length-1,d=V.length-1;1<=l&&0<=d&&O[l]!==V[d];)d--;for(;1<=l&&0<=d;l--,d--)if(O[l]!==V[d]){if(l!==1||d!==1)do if(l--,d--,0>d||O[l]!==V[d]){var ve=`
`+O[l].replace(" at new "," at ");return e.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",e.displayName)),ve}while(1<=l&&0<=d);break}}}finally{pe=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?re(a):""}function R(e){switch(e.tag){case 26:case 27:case 5:return re(e.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 15:return e=ce(e.type,!1),e;case 11:return e=ce(e.type.render,!1),e;case 1:return e=ce(e.type,!0),e;default:return""}}function Q(e){try{var n="";do n+=R(e),e=e.return;while(e);return n}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function Y(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function P(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function ie(e){if(Y(e)!==e)throw Error(i(188))}function J(e){var n=e.alternate;if(!n){if(n=Y(e),n===null)throw Error(i(188));return n!==e?null:e}for(var a=e,l=n;;){var d=a.return;if(d===null)break;var h=d.alternate;if(h===null){if(l=d.return,l!==null){a=l;continue}break}if(d.child===h.child){for(h=d.child;h;){if(h===a)return ie(d),e;if(h===l)return ie(d),n;h=h.sibling}throw Error(i(188))}if(a.return!==l.return)a=d,l=h;else{for(var w=!1,_=d.child;_;){if(_===a){w=!0,a=d,l=h;break}if(_===l){w=!0,l=d,a=h;break}_=_.sibling}if(!w){for(_=h.child;_;){if(_===a){w=!0,a=h,l=d;break}if(_===l){w=!0,l=h,a=d;break}_=_.sibling}if(!w)throw Error(i(189))}}if(a.alternate!==l)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?e:n}function ze(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=ze(e),n!==null)return n;e=e.sibling}return null}var de=Array.isArray,Z=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Te={pending:!1,data:null,method:null,action:null},je=[],Fe=-1;function Me(e){return{current:e}}function Ue(e){0>Fe||(e.current=je[Fe],je[Fe]=null,Fe--)}function Le(e,n){Fe++,je[Fe]=e.current,e.current=n}var he=Me(null),ye=Me(null),G=Me(null),oe=Me(null);function be(e,n){switch(Le(G,n),Le(ye,e),Le(he,null),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)&&(n=n.namespaceURI)?ng(n):0;break;default:if(e=e===8?n.parentNode:n,n=e.tagName,e=e.namespaceURI)e=ng(e),n=sg(e,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}Ue(he),Le(he,n)}function Ne(){Ue(he),Ue(ye),Ue(G)}function _e(e){e.memoizedState!==null&&Le(oe,e);var n=he.current,a=sg(n,e.type);n!==a&&(Le(ye,e),Le(he,a))}function Ge(e){ye.current===e&&(Ue(he),Ue(ye)),oe.current===e&&(Ue(oe),Ia._currentValue=Te)}var bt=Object.prototype.hasOwnProperty,ut=s.unstable_scheduleCallback,St=s.unstable_cancelCallback,Nt=s.unstable_shouldYield,Mt=s.unstable_requestPaint,ue=s.unstable_now,Re=s.unstable_getCurrentPriorityLevel,De=s.unstable_ImmediatePriority,se=s.unstable_UserBlockingPriority,Ee=s.unstable_NormalPriority,Ke=s.unstable_LowPriority,b=s.unstable_IdlePriority,p=s.log,g=s.unstable_setDisableYieldValue,k=null,N=null;function $(e){if(N&&typeof N.onCommitFiberRoot=="function")try{N.onCommitFiberRoot(k,e,void 0,(e.current.flags&128)===128)}catch{}}function ae(e){if(typeof p=="function"&&g(e),N&&typeof N.setStrictMode=="function")try{N.setStrictMode(k,e)}catch{}}var Be=Math.clz32?Math.clz32:dt,at=Math.log,tt=Math.LN2;function dt(e){return e>>>=0,e===0?32:31-(at(e)/tt|0)|0}var nt=128,Cs=4194304;function zn(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function js(e,n){var a=e.pendingLanes;if(a===0)return 0;var l=0,d=e.suspendedLanes,h=e.pingedLanes,w=e.warmLanes;e=e.finishedLanes!==0;var _=a&134217727;return _!==0?(a=_&~d,a!==0?l=zn(a):(h&=_,h!==0?l=zn(h):e||(w=_&~w,w!==0&&(l=zn(w))))):(_=a&~d,_!==0?l=zn(_):h!==0?l=zn(h):e||(w=a&~w,w!==0&&(l=zn(w)))),l===0?0:n!==0&&n!==l&&(n&d)===0&&(d=l&-l,w=n&-n,d>=w||d===32&&(w&4194176)!==0)?n:l}function Wn(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Sr(e,n){switch(e){case 1:case 2:case 4:case 8:return n+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qs(){var e=nt;return nt<<=1,(nt&4194176)===0&&(nt=128),e}function Ks(){var e=Cs;return Cs<<=1,(Cs&62914560)===0&&(Cs=4194304),e}function _s(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function es(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function wr(e,n,a,l,d,h){var w=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var _=e.entanglements,O=e.expirationTimes,V=e.hiddenUpdates;for(a=w&~a;0<a;){var ve=31-Be(a),ke=1<<ve;_[ve]=0,O[ve]=-1;var fe=V[ve];if(fe!==null)for(V[ve]=null,ve=0;ve<fe.length;ve++){var ge=fe[ve];ge!==null&&(ge.lane&=-536870913)}a&=~ke}l!==0&&Zs(e,l,0),h!==0&&d===0&&e.tag!==0&&(e.suspendedLanes|=h&~(w&~n))}function Zs(e,n,a){e.pendingLanes|=n,e.suspendedLanes&=~n;var l=31-Be(n);e.entangledLanes|=n,e.entanglements[l]=e.entanglements[l]|1073741824|a&4194218}function we(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var l=31-Be(a),d=1<<l;d&n|e[l]&n&&(e[l]|=n),a&=~d}}function Ve(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ze(){var e=Z.p;return e!==0?e:(e=window.event,e===void 0?32:xg(e.type))}function st(e,n){var a=Z.p;try{return Z.p=e,n()}finally{Z.p=a}}var At=Math.random().toString(36).slice(2),ot="__reactFiber$"+At,Zt="__reactProps$"+At,ts="__reactContainer$"+At,Es="__reactEvents$"+At,Ce="__reactListeners$"+At,Ie="__reactHandles$"+At,Qe="__reactResources$"+At,Tt="__reactMarker$"+At;function Bt(e){delete e[ot],delete e[Zt],delete e[Es],delete e[Ce],delete e[Ie]}function un(e){var n=e[ot];if(n)return n;for(var a=e.parentNode;a;){if(n=a[ts]||a[ot]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=ag(e);e!==null;){if(a=e[ot])return a;e=ag(e)}return n}e=a,a=e.parentNode}return null}function Js(e){if(e=e[ot]||e[ts]){var n=e.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return e}return null}function ta(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(i(33))}function ii(e){var n=e[Qe];return n||(n=e[Qe]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function sn(e){e[Tt]=!0}var th=new Set,nh={};function kr(e,n){ai(e,n),ai(e+"Capture",n)}function ai(e,n){for(nh[e]=n,e=0;e<n.length;e++)th.add(n[e])}var Ns=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),F1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sh={},rh={};function H1(e){return bt.call(rh,e)?!0:bt.call(sh,e)?!1:F1.test(e)?rh[e]=!0:(sh[e]=!0,!1)}function bo(e,n,a){if(H1(n))if(a===null)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var l=n.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+a)}}function xo(e,n,a){if(a===null)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+a)}}function Ts(e,n,a,l){if(l===null)e.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(n,a,""+l)}}function Un(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ih(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function V1(e){var n=ih(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),l=""+e[n];if(!e.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var d=a.get,h=a.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return d.call(this)},set:function(w){l=""+w,h.call(this,w)}}),Object.defineProperty(e,n,{enumerable:a.enumerable}),{getValue:function(){return l},setValue:function(w){l=""+w},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function So(e){e._valueTracker||(e._valueTracker=V1(e))}function ah(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),l="";return e&&(l=ih(e)?e.checked?"true":"false":e.value),e=l,e!==a?(n.setValue(e),!0):!1}function wo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Y1=/[\n"\\]/g;function Bn(e){return e.replace(Y1,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function pc(e,n,a,l,d,h,w,_){e.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?e.type=w:e.removeAttribute("type"),n!=null?w==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+Un(n)):e.value!==""+Un(n)&&(e.value=""+Un(n)):w!=="submit"&&w!=="reset"||e.removeAttribute("value"),n!=null?gc(e,w,Un(n)):a!=null?gc(e,w,Un(a)):l!=null&&e.removeAttribute("value"),d==null&&h!=null&&(e.defaultChecked=!!h),d!=null&&(e.checked=d&&typeof d!="function"&&typeof d!="symbol"),_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?e.name=""+Un(_):e.removeAttribute("name")}function oh(e,n,a,l,d,h,w,_){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),n!=null||a!=null){if(!(h!=="submit"&&h!=="reset"||n!=null))return;a=a!=null?""+Un(a):"",n=n!=null?""+Un(n):a,_||n===e.value||(e.value=n),e.defaultValue=n}l=l??d,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=_?e.checked:!!l,e.defaultChecked=!!l,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(e.name=w)}function gc(e,n,a){n==="number"&&wo(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function oi(e,n,a,l){if(e=e.options,n){n={};for(var d=0;d<a.length;d++)n["$"+a[d]]=!0;for(a=0;a<e.length;a++)d=n.hasOwnProperty("$"+e[a].value),e[a].selected!==d&&(e[a].selected=d),d&&l&&(e[a].defaultSelected=!0)}else{for(a=""+Un(a),n=null,d=0;d<e.length;d++){if(e[d].value===a){e[d].selected=!0,l&&(e[d].defaultSelected=!0);return}n!==null||e[d].disabled||(n=e[d])}n!==null&&(n.selected=!0)}}function lh(e,n,a){if(n!=null&&(n=""+Un(n),n!==e.value&&(e.value=n),a==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=a!=null?""+Un(a):""}function ch(e,n,a,l){if(n==null){if(l!=null){if(a!=null)throw Error(i(92));if(de(l)){if(1<l.length)throw Error(i(93));l=l[0]}a=l}a==null&&(a=""),n=a}a=Un(n),e.defaultValue=a,l=e.textContent,l===a&&l!==""&&l!==null&&(e.value=l)}function li(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var G1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function uh(e,n,a){var l=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?l?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":l?e.setProperty(n,a):typeof a!="number"||a===0||G1.has(n)?n==="float"?e.cssFloat=a:e[n]=(""+a).trim():e[n]=a+"px"}function dh(e,n,a){if(n!=null&&typeof n!="object")throw Error(i(62));if(e=e.style,a!=null){for(var l in a)!a.hasOwnProperty(l)||n!=null&&n.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var d in n)l=n[d],n.hasOwnProperty(d)&&a[d]!==l&&uh(e,d,l)}else for(var h in n)n.hasOwnProperty(h)&&uh(e,h,n[h])}function Ac(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var X1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Q1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ko(e){return Q1.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var yc=null;function vc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ci=null,ui=null;function fh(e){var n=Js(e);if(n&&(e=n.stateNode)){var a=e[Zt]||null;e:switch(e=n.stateNode,n.type){case"input":if(pc(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Bn(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var l=a[n];if(l!==e&&l.form===e.form){var d=l[Zt]||null;if(!d)throw Error(i(90));pc(l,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(n=0;n<a.length;n++)l=a[n],l.form===e.form&&ah(l)}break e;case"textarea":lh(e,a.value,a.defaultValue);break e;case"select":n=a.value,n!=null&&oi(e,!!a.multiple,n,!1)}}}var bc=!1;function hh(e,n,a){if(bc)return e(n,a);bc=!0;try{var l=e(n);return l}finally{if(bc=!1,(ci!==null||ui!==null)&&(ol(),ci&&(n=ci,e=ui,ui=ci=null,fh(n),e)))for(n=0;n<e.length;n++)fh(e[n])}}function na(e,n){var a=e.stateNode;if(a===null)return null;var l=a[Zt]||null;if(l===null)return null;a=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(i(231,n,typeof a));return a}var xc=!1;if(Ns)try{var sa={};Object.defineProperty(sa,"passive",{get:function(){xc=!0}}),window.addEventListener("test",sa,sa),window.removeEventListener("test",sa,sa)}catch{xc=!1}var Ws=null,Sc=null,Co=null;function mh(){if(Co)return Co;var e,n=Sc,a=n.length,l,d="value"in Ws?Ws.value:Ws.textContent,h=d.length;for(e=0;e<a&&n[e]===d[e];e++);var w=a-e;for(l=1;l<=w&&n[a-l]===d[h-l];l++);return Co=d.slice(e,1<l?1-l:void 0)}function jo(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function _o(){return!0}function ph(){return!1}function wn(e){function n(a,l,d,h,w){this._reactName=a,this._targetInst=d,this.type=l,this.nativeEvent=h,this.target=w,this.currentTarget=null;for(var _ in e)e.hasOwnProperty(_)&&(a=e[_],this[_]=a?a(h):h[_]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?_o:ph,this.isPropagationStopped=ph,this}return W(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=_o)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=_o)},persist:function(){},isPersistent:_o}),n}var Cr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Eo=wn(Cr),ra=W({},Cr,{view:0,detail:0}),K1=wn(ra),wc,kc,ia,No=W({},ra,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ia&&(ia&&e.type==="mousemove"?(wc=e.screenX-ia.screenX,kc=e.screenY-ia.screenY):kc=wc=0,ia=e),wc)},movementY:function(e){return"movementY"in e?e.movementY:kc}}),gh=wn(No),Z1=W({},No,{dataTransfer:0}),J1=wn(Z1),W1=W({},ra,{relatedTarget:0}),Cc=wn(W1),ey=W({},Cr,{animationName:0,elapsedTime:0,pseudoElement:0}),ty=wn(ey),ny=W({},Cr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),sy=wn(ny),ry=W({},Cr,{data:0}),Ah=wn(ry),iy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ay={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ly(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=oy[e])?!!n[e]:!1}function jc(){return ly}var cy=W({},ra,{key:function(e){if(e.key){var n=iy[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=jo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ay[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jc,charCode:function(e){return e.type==="keypress"?jo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?jo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),uy=wn(cy),dy=W({},No,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yh=wn(dy),fy=W({},ra,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jc}),hy=wn(fy),my=W({},Cr,{propertyName:0,elapsedTime:0,pseudoElement:0}),py=wn(my),gy=W({},No,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ay=wn(gy),yy=W({},Cr,{newState:0,oldState:0}),vy=wn(yy),by=[9,13,27,32],_c=Ns&&"CompositionEvent"in window,aa=null;Ns&&"documentMode"in document&&(aa=document.documentMode);var xy=Ns&&"TextEvent"in window&&!aa,vh=Ns&&(!_c||aa&&8<aa&&11>=aa),bh=" ",xh=!1;function Sh(e,n){switch(e){case"keyup":return by.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wh(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var di=!1;function Sy(e,n){switch(e){case"compositionend":return wh(n);case"keypress":return n.which!==32?null:(xh=!0,bh);case"textInput":return e=n.data,e===bh&&xh?null:e;default:return null}}function wy(e,n){if(di)return e==="compositionend"||!_c&&Sh(e,n)?(e=mh(),Co=Sc=Ws=null,di=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return vh&&n.locale!=="ko"?null:n.data;default:return null}}var ky={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kh(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!ky[e.type]:n==="textarea"}function Ch(e,n,a,l){ci?ui?ui.push(l):ui=[l]:ci=l,n=fl(n,"onChange"),0<n.length&&(a=new Eo("onChange","change",null,a,l),e.push({event:a,listeners:n}))}var oa=null,la=null;function Cy(e){Zp(e,0)}function To(e){var n=ta(e);if(ah(n))return e}function jh(e,n){if(e==="change")return n}var _h=!1;if(Ns){var Ec;if(Ns){var Nc="oninput"in document;if(!Nc){var Eh=document.createElement("div");Eh.setAttribute("oninput","return;"),Nc=typeof Eh.oninput=="function"}Ec=Nc}else Ec=!1;_h=Ec&&(!document.documentMode||9<document.documentMode)}function Nh(){oa&&(oa.detachEvent("onpropertychange",Th),la=oa=null)}function Th(e){if(e.propertyName==="value"&&To(la)){var n=[];Ch(n,la,e,vc(e)),hh(Cy,n)}}function jy(e,n,a){e==="focusin"?(Nh(),oa=n,la=a,oa.attachEvent("onpropertychange",Th)):e==="focusout"&&Nh()}function _y(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return To(la)}function Ey(e,n){if(e==="click")return To(n)}function Ny(e,n){if(e==="input"||e==="change")return To(n)}function Ty(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var En=typeof Object.is=="function"?Object.is:Ty;function ca(e,n){if(En(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),l=Object.keys(n);if(a.length!==l.length)return!1;for(l=0;l<a.length;l++){var d=a[l];if(!bt.call(n,d)||!En(e[d],n[d]))return!1}return!0}function Rh(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Mh(e,n){var a=Rh(e);e=0;for(var l;a;){if(a.nodeType===3){if(l=e+a.textContent.length,e<=n&&l>=n)return{node:a,offset:n-e};e=l}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Rh(a)}}function Oh(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Oh(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Dh(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=wo(e.document);n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=wo(e.document)}return n}function Tc(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function Ry(e,n){var a=Dh(n);n=e.focusedElem;var l=e.selectionRange;if(a!==n&&n&&n.ownerDocument&&Oh(n.ownerDocument.documentElement,n)){if(l!==null&&Tc(n)){if(e=l.start,a=l.end,a===void 0&&(a=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(a,n.value.length);else if(a=(e=n.ownerDocument||document)&&e.defaultView||window,a.getSelection){a=a.getSelection();var d=n.textContent.length,h=Math.min(l.start,d);l=l.end===void 0?h:Math.min(l.end,d),!a.extend&&h>l&&(d=l,l=h,h=d),d=Mh(n,h);var w=Mh(n,l);d&&w&&(a.rangeCount!==1||a.anchorNode!==d.node||a.anchorOffset!==d.offset||a.focusNode!==w.node||a.focusOffset!==w.offset)&&(e=e.createRange(),e.setStart(d.node,d.offset),a.removeAllRanges(),h>l?(a.addRange(e),a.extend(w.node,w.offset)):(e.setEnd(w.node,w.offset),a.addRange(e)))}}for(e=[],a=n;a=a.parentNode;)a.nodeType===1&&e.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)a=e[n],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var My=Ns&&"documentMode"in document&&11>=document.documentMode,fi=null,Rc=null,ua=null,Mc=!1;function Lh(e,n,a){var l=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Mc||fi==null||fi!==wo(l)||(l=fi,"selectionStart"in l&&Tc(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),ua&&ca(ua,l)||(ua=l,l=fl(Rc,"onSelect"),0<l.length&&(n=new Eo("onSelect","select",null,n,a),e.push({event:n,listeners:l}),n.target=fi)))}function jr(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var hi={animationend:jr("Animation","AnimationEnd"),animationiteration:jr("Animation","AnimationIteration"),animationstart:jr("Animation","AnimationStart"),transitionrun:jr("Transition","TransitionRun"),transitionstart:jr("Transition","TransitionStart"),transitioncancel:jr("Transition","TransitionCancel"),transitionend:jr("Transition","TransitionEnd")},Oc={},zh={};Ns&&(zh=document.createElement("div").style,"AnimationEvent"in window||(delete hi.animationend.animation,delete hi.animationiteration.animation,delete hi.animationstart.animation),"TransitionEvent"in window||delete hi.transitionend.transition);function _r(e){if(Oc[e])return Oc[e];if(!hi[e])return e;var n=hi[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in zh)return Oc[e]=n[a];return e}var Uh=_r("animationend"),Bh=_r("animationiteration"),Ph=_r("animationstart"),Oy=_r("transitionrun"),Dy=_r("transitionstart"),Ly=_r("transitioncancel"),$h=_r("transitionend"),qh=new Map,Ih="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function ns(e,n){qh.set(e,n),kr(n,[e])}var Pn=[],mi=0,Dc=0;function Ro(){for(var e=mi,n=Dc=mi=0;n<e;){var a=Pn[n];Pn[n++]=null;var l=Pn[n];Pn[n++]=null;var d=Pn[n];Pn[n++]=null;var h=Pn[n];if(Pn[n++]=null,l!==null&&d!==null){var w=l.pending;w===null?d.next=d:(d.next=w.next,w.next=d),l.pending=d}h!==0&&Fh(a,d,h)}}function Mo(e,n,a,l){Pn[mi++]=e,Pn[mi++]=n,Pn[mi++]=a,Pn[mi++]=l,Dc|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function Lc(e,n,a,l){return Mo(e,n,a,l),Oo(e)}function er(e,n){return Mo(e,null,null,n),Oo(e)}function Fh(e,n,a){e.lanes|=a;var l=e.alternate;l!==null&&(l.lanes|=a);for(var d=!1,h=e.return;h!==null;)h.childLanes|=a,l=h.alternate,l!==null&&(l.childLanes|=a),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(d=!0)),e=h,h=h.return;d&&n!==null&&e.tag===3&&(h=e.stateNode,d=31-Be(a),h=h.hiddenUpdates,e=h[d],e===null?h[d]=[n]:e.push(n),n.lane=a|536870912)}function Oo(e){if(50<La)throw La=0,qu=null,Error(i(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var pi={},Hh=new WeakMap;function $n(e,n){if(typeof e=="object"&&e!==null){var a=Hh.get(e);return a!==void 0?a:(n={value:e,source:n,stack:Q(n)},Hh.set(e,n),n)}return{value:e,source:n,stack:Q(n)}}var gi=[],Ai=0,Do=null,Lo=0,qn=[],In=0,Er=null,Rs=1,Ms="";function Nr(e,n){gi[Ai++]=Lo,gi[Ai++]=Do,Do=e,Lo=n}function Vh(e,n,a){qn[In++]=Rs,qn[In++]=Ms,qn[In++]=Er,Er=e;var l=Rs;e=Ms;var d=32-Be(l)-1;l&=~(1<<d),a+=1;var h=32-Be(n)+d;if(30<h){var w=d-d%5;h=(l&(1<<w)-1).toString(32),l>>=w,d-=w,Rs=1<<32-Be(n)+d|a<<d|l,Ms=h+e}else Rs=1<<h|a<<d|l,Ms=e}function zc(e){e.return!==null&&(Nr(e,1),Vh(e,1,0))}function Uc(e){for(;e===Do;)Do=gi[--Ai],gi[Ai]=null,Lo=gi[--Ai],gi[Ai]=null;for(;e===Er;)Er=qn[--In],qn[In]=null,Ms=qn[--In],qn[In]=null,Rs=qn[--In],qn[In]=null}var vn=null,dn=null,yt=!1,ss=null,ds=!1,Bc=Error(i(519));function Tr(e){var n=Error(i(418,""));throw ha($n(n,e)),Bc}function Yh(e){var n=e.stateNode,a=e.type,l=e.memoizedProps;switch(n[ot]=e,n[Zt]=l,a){case"dialog":ft("cancel",n),ft("close",n);break;case"iframe":case"object":case"embed":ft("load",n);break;case"video":case"audio":for(a=0;a<Ua.length;a++)ft(Ua[a],n);break;case"source":ft("error",n);break;case"img":case"image":case"link":ft("error",n),ft("load",n);break;case"details":ft("toggle",n);break;case"input":ft("invalid",n),oh(n,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),So(n);break;case"select":ft("invalid",n);break;case"textarea":ft("invalid",n),ch(n,l.value,l.defaultValue,l.children),So(n)}a=l.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||l.suppressHydrationWarning===!0||tg(n.textContent,a)?(l.popover!=null&&(ft("beforetoggle",n),ft("toggle",n)),l.onScroll!=null&&ft("scroll",n),l.onScrollEnd!=null&&ft("scrollend",n),l.onClick!=null&&(n.onclick=hl),n=!0):n=!1,n||Tr(e)}function Gh(e){for(vn=e.return;vn;)switch(vn.tag){case 3:case 27:ds=!0;return;case 5:case 13:ds=!1;return;default:vn=vn.return}}function da(e){if(e!==vn)return!1;if(!yt)return Gh(e),yt=!0,!1;var n=!1,a;if((a=e.tag!==3&&e.tag!==27)&&((a=e.tag===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||rd(e.type,e.memoizedProps)),a=!a),a&&(n=!0),n&&dn&&Tr(e),Gh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(n===0){dn=is(e.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++;e=e.nextSibling}dn=null}}else dn=vn?is(e.stateNode.nextSibling):null;return!0}function fa(){dn=vn=null,yt=!1}function ha(e){ss===null?ss=[e]:ss.push(e)}var ma=Error(i(460)),Xh=Error(i(474)),Pc={then:function(){}};function Qh(e){return e=e.status,e==="fulfilled"||e==="rejected"}function zo(){}function Kh(e,n,a){switch(a=e[a],a===void 0?e.push(n):a!==n&&(n.then(zo,zo),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,e===ma?Error(i(483)):e;default:if(typeof n.status=="string")n.then(zo,zo);else{if(e=_t,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=n,e.status="pending",e.then(function(l){if(n.status==="pending"){var d=n;d.status="fulfilled",d.value=l}},function(l){if(n.status==="pending"){var d=n;d.status="rejected",d.reason=l}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,e===ma?Error(i(483)):e}throw pa=n,ma}}var pa=null;function Zh(){if(pa===null)throw Error(i(459));var e=pa;return pa=null,e}var yi=null,ga=0;function Uo(e){var n=ga;return ga+=1,yi===null&&(yi=[]),Kh(yi,e,n)}function Aa(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Bo(e,n){throw n.$$typeof===u?Error(i(525)):(e=Object.prototype.toString.call(n),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Jh(e){var n=e._init;return n(e._payload)}function Wh(e){function n(ee,F){if(e){var le=ee.deletions;le===null?(ee.deletions=[F],ee.flags|=16):le.push(F)}}function a(ee,F){if(!e)return null;for(;F!==null;)n(ee,F),F=F.sibling;return null}function l(ee){for(var F=new Map;ee!==null;)ee.key!==null?F.set(ee.key,ee):F.set(ee.index,ee),ee=ee.sibling;return F}function d(ee,F){return ee=fr(ee,F),ee.index=0,ee.sibling=null,ee}function h(ee,F,le){return ee.index=le,e?(le=ee.alternate,le!==null?(le=le.index,le<F?(ee.flags|=33554434,F):le):(ee.flags|=33554434,F)):(ee.flags|=1048576,F)}function w(ee){return e&&ee.alternate===null&&(ee.flags|=33554434),ee}function _(ee,F,le,xe){return F===null||F.tag!==6?(F=Ou(le,ee.mode,xe),F.return=ee,F):(F=d(F,le),F.return=ee,F)}function O(ee,F,le,xe){var $e=le.type;return $e===v?ve(ee,F,le.props.children,xe,le.key):F!==null&&(F.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===K&&Jh($e)===F.type)?(F=d(F,le.props),Aa(F,le),F.return=ee,F):(F=nl(le.type,le.key,le.props,null,ee.mode,xe),Aa(F,le),F.return=ee,F)}function V(ee,F,le,xe){return F===null||F.tag!==4||F.stateNode.containerInfo!==le.containerInfo||F.stateNode.implementation!==le.implementation?(F=Du(le,ee.mode,xe),F.return=ee,F):(F=d(F,le.children||[]),F.return=ee,F)}function ve(ee,F,le,xe,$e){return F===null||F.tag!==7?(F=$r(le,ee.mode,xe,$e),F.return=ee,F):(F=d(F,le),F.return=ee,F)}function ke(ee,F,le){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=Ou(""+F,ee.mode,le),F.return=ee,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case f:return le=nl(F.type,F.key,F.props,null,ee.mode,le),Aa(le,F),le.return=ee,le;case m:return F=Du(F,ee.mode,le),F.return=ee,F;case K:var xe=F._init;return F=xe(F._payload),ke(ee,F,le)}if(de(F)||I(F))return F=$r(F,ee.mode,le,null),F.return=ee,F;if(typeof F.then=="function")return ke(ee,Uo(F),le);if(F.$$typeof===C)return ke(ee,Wo(ee,F),le);Bo(ee,F)}return null}function fe(ee,F,le,xe){var $e=F!==null?F.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return $e!==null?null:_(ee,F,""+le,xe);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case f:return le.key===$e?O(ee,F,le,xe):null;case m:return le.key===$e?V(ee,F,le,xe):null;case K:return $e=le._init,le=$e(le._payload),fe(ee,F,le,xe)}if(de(le)||I(le))return $e!==null?null:ve(ee,F,le,xe,null);if(typeof le.then=="function")return fe(ee,F,Uo(le),xe);if(le.$$typeof===C)return fe(ee,F,Wo(ee,le),xe);Bo(ee,le)}return null}function ge(ee,F,le,xe,$e){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return ee=ee.get(le)||null,_(F,ee,""+xe,$e);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case f:return ee=ee.get(xe.key===null?le:xe.key)||null,O(F,ee,xe,$e);case m:return ee=ee.get(xe.key===null?le:xe.key)||null,V(F,ee,xe,$e);case K:var lt=xe._init;return xe=lt(xe._payload),ge(ee,F,le,xe,$e)}if(de(xe)||I(xe))return ee=ee.get(le)||null,ve(F,ee,xe,$e,null);if(typeof xe.then=="function")return ge(ee,F,le,Uo(xe),$e);if(xe.$$typeof===C)return ge(ee,F,le,Wo(F,xe),$e);Bo(F,xe)}return null}function He(ee,F,le,xe){for(var $e=null,lt=null,Ye=F,Xe=F=0,on=null;Ye!==null&&Xe<le.length;Xe++){Ye.index>Xe?(on=Ye,Ye=null):on=Ye.sibling;var vt=fe(ee,Ye,le[Xe],xe);if(vt===null){Ye===null&&(Ye=on);break}e&&Ye&&vt.alternate===null&&n(ee,Ye),F=h(vt,F,Xe),lt===null?$e=vt:lt.sibling=vt,lt=vt,Ye=on}if(Xe===le.length)return a(ee,Ye),yt&&Nr(ee,Xe),$e;if(Ye===null){for(;Xe<le.length;Xe++)Ye=ke(ee,le[Xe],xe),Ye!==null&&(F=h(Ye,F,Xe),lt===null?$e=Ye:lt.sibling=Ye,lt=Ye);return yt&&Nr(ee,Xe),$e}for(Ye=l(Ye);Xe<le.length;Xe++)on=ge(Ye,ee,Xe,le[Xe],xe),on!==null&&(e&&on.alternate!==null&&Ye.delete(on.key===null?Xe:on.key),F=h(on,F,Xe),lt===null?$e=on:lt.sibling=on,lt=on);return e&&Ye.forEach(function(vr){return n(ee,vr)}),yt&&Nr(ee,Xe),$e}function Je(ee,F,le,xe){if(le==null)throw Error(i(151));for(var $e=null,lt=null,Ye=F,Xe=F=0,on=null,vt=le.next();Ye!==null&&!vt.done;Xe++,vt=le.next()){Ye.index>Xe?(on=Ye,Ye=null):on=Ye.sibling;var vr=fe(ee,Ye,vt.value,xe);if(vr===null){Ye===null&&(Ye=on);break}e&&Ye&&vr.alternate===null&&n(ee,Ye),F=h(vr,F,Xe),lt===null?$e=vr:lt.sibling=vr,lt=vr,Ye=on}if(vt.done)return a(ee,Ye),yt&&Nr(ee,Xe),$e;if(Ye===null){for(;!vt.done;Xe++,vt=le.next())vt=ke(ee,vt.value,xe),vt!==null&&(F=h(vt,F,Xe),lt===null?$e=vt:lt.sibling=vt,lt=vt);return yt&&Nr(ee,Xe),$e}for(Ye=l(Ye);!vt.done;Xe++,vt=le.next())vt=ge(Ye,ee,Xe,vt.value,xe),vt!==null&&(e&&vt.alternate!==null&&Ye.delete(vt.key===null?Xe:vt.key),F=h(vt,F,Xe),lt===null?$e=vt:lt.sibling=vt,lt=vt);return e&&Ye.forEach(function(Qv){return n(ee,Qv)}),yt&&Nr(ee,Xe),$e}function qt(ee,F,le,xe){if(typeof le=="object"&&le!==null&&le.type===v&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case f:e:{for(var $e=le.key;F!==null;){if(F.key===$e){if($e=le.type,$e===v){if(F.tag===7){a(ee,F.sibling),xe=d(F,le.props.children),xe.return=ee,ee=xe;break e}}else if(F.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===K&&Jh($e)===F.type){a(ee,F.sibling),xe=d(F,le.props),Aa(xe,le),xe.return=ee,ee=xe;break e}a(ee,F);break}else n(ee,F);F=F.sibling}le.type===v?(xe=$r(le.props.children,ee.mode,xe,le.key),xe.return=ee,ee=xe):(xe=nl(le.type,le.key,le.props,null,ee.mode,xe),Aa(xe,le),xe.return=ee,ee=xe)}return w(ee);case m:e:{for($e=le.key;F!==null;){if(F.key===$e)if(F.tag===4&&F.stateNode.containerInfo===le.containerInfo&&F.stateNode.implementation===le.implementation){a(ee,F.sibling),xe=d(F,le.children||[]),xe.return=ee,ee=xe;break e}else{a(ee,F);break}else n(ee,F);F=F.sibling}xe=Du(le,ee.mode,xe),xe.return=ee,ee=xe}return w(ee);case K:return $e=le._init,le=$e(le._payload),qt(ee,F,le,xe)}if(de(le))return He(ee,F,le,xe);if(I(le)){if($e=I(le),typeof $e!="function")throw Error(i(150));return le=$e.call(le),Je(ee,F,le,xe)}if(typeof le.then=="function")return qt(ee,F,Uo(le),xe);if(le.$$typeof===C)return qt(ee,F,Wo(ee,le),xe);Bo(ee,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,F!==null&&F.tag===6?(a(ee,F.sibling),xe=d(F,le),xe.return=ee,ee=xe):(a(ee,F),xe=Ou(le,ee.mode,xe),xe.return=ee,ee=xe),w(ee)):a(ee,F)}return function(ee,F,le,xe){try{ga=0;var $e=qt(ee,F,le,xe);return yi=null,$e}catch(Ye){if(Ye===ma)throw Ye;var lt=Yn(29,Ye,null,ee.mode);return lt.lanes=xe,lt.return=ee,lt}finally{}}}var Rr=Wh(!0),em=Wh(!1),vi=Me(null),Po=Me(0);function tm(e,n){e=Fs,Le(Po,e),Le(vi,n),Fs=e|n.baseLanes}function $c(){Le(Po,Fs),Le(vi,vi.current)}function qc(){Fs=Po.current,Ue(vi),Ue(Po)}var Fn=Me(null),fs=null;function tr(e){var n=e.alternate;Le(Jt,Jt.current&1),Le(Fn,e),fs===null&&(n===null||vi.current!==null||n.memoizedState!==null)&&(fs=e)}function nm(e){if(e.tag===22){if(Le(Jt,Jt.current),Le(Fn,e),fs===null){var n=e.alternate;n!==null&&n.memoizedState!==null&&(fs=e)}}else nr()}function nr(){Le(Jt,Jt.current),Le(Fn,Fn.current)}function Os(e){Ue(Fn),fs===e&&(fs=null),Ue(Jt)}var Jt=Me(0);function $o(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var zy=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(a,l){e.push(l)}};this.abort=function(){n.aborted=!0,e.forEach(function(a){return a()})}},Uy=s.unstable_scheduleCallback,By=s.unstable_NormalPriority,Wt={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ic(){return{controller:new zy,data:new Map,refCount:0}}function ya(e){e.refCount--,e.refCount===0&&Uy(By,function(){e.controller.abort()})}var va=null,Fc=0,bi=0,xi=null;function Py(e,n){if(va===null){var a=va=[];Fc=0,bi=Qu(),xi={status:"pending",value:void 0,then:function(l){a.push(l)}}}return Fc++,n.then(sm,sm),n}function sm(){if(--Fc===0&&va!==null){xi!==null&&(xi.status="fulfilled");var e=va;va=null,bi=0,xi=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function $y(e,n){var a=[],l={status:"pending",value:null,reason:null,then:function(d){a.push(d)}};return e.then(function(){l.status="fulfilled",l.value=n;for(var d=0;d<a.length;d++)(0,a[d])(n)},function(d){for(l.status="rejected",l.reason=d,d=0;d<a.length;d++)(0,a[d])(void 0)}),l}var rm=z.S;z.S=function(e,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&Py(e,n),rm!==null&&rm(e,n)};var Mr=Me(null);function Hc(){var e=Mr.current;return e!==null?e:_t.pooledCache}function qo(e,n){n===null?Le(Mr,Mr.current):Le(Mr,n.pool)}function im(){var e=Hc();return e===null?null:{parent:Wt._currentValue,pool:e}}var sr=0,it=null,kt=null,Gt=null,Io=!1,Si=!1,Or=!1,Fo=0,ba=0,wi=null,qy=0;function Ht(){throw Error(i(321))}function Vc(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!En(e[a],n[a]))return!1;return!0}function Yc(e,n,a,l,d,h){return sr=h,it=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,z.H=e===null||e.memoizedState===null?Dr:rr,Or=!1,h=a(l,d),Or=!1,Si&&(h=om(n,a,l,d)),am(e),h}function am(e){z.H=hs;var n=kt!==null&&kt.next!==null;if(sr=0,Gt=kt=it=null,Io=!1,ba=0,wi=null,n)throw Error(i(300));e===null||rn||(e=e.dependencies,e!==null&&Jo(e)&&(rn=!0))}function om(e,n,a,l){it=e;var d=0;do{if(Si&&(wi=null),ba=0,Si=!1,25<=d)throw Error(i(301));if(d+=1,Gt=kt=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}z.H=Lr,h=n(a,l)}while(Si);return h}function Iy(){var e=z.H,n=e.useState()[0];return n=typeof n.then=="function"?xa(n):n,e=e.useState()[0],(kt!==null?kt.memoizedState:null)!==e&&(it.flags|=1024),n}function Gc(){var e=Fo!==0;return Fo=0,e}function Xc(e,n,a){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~a}function Qc(e){if(Io){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}Io=!1}sr=0,Gt=kt=it=null,Si=!1,ba=Fo=0,wi=null}function kn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gt===null?it.memoizedState=Gt=e:Gt=Gt.next=e,Gt}function Xt(){if(kt===null){var e=it.alternate;e=e!==null?e.memoizedState:null}else e=kt.next;var n=Gt===null?it.memoizedState:Gt.next;if(n!==null)Gt=n,kt=e;else{if(e===null)throw it.alternate===null?Error(i(467)):Error(i(310));kt=e,e={memoizedState:kt.memoizedState,baseState:kt.baseState,baseQueue:kt.baseQueue,queue:kt.queue,next:null},Gt===null?it.memoizedState=Gt=e:Gt=Gt.next=e}return Gt}var Ho;Ho=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function xa(e){var n=ba;return ba+=1,wi===null&&(wi=[]),e=Kh(wi,e,n),n=it,(Gt===null?n.memoizedState:Gt.next)===null&&(n=n.alternate,z.H=n===null||n.memoizedState===null?Dr:rr),e}function Vo(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return xa(e);if(e.$$typeof===C)return pn(e)}throw Error(i(438,String(e)))}function Kc(e){var n=null,a=it.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var l=it.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(n={data:l.data.map(function(d){return d.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=Ho(),it.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(e),l=0;l<e;l++)a[l]=B;return n.index++,a}function Ds(e,n){return typeof n=="function"?n(e):n}function Yo(e){var n=Xt();return Zc(n,kt,e)}function Zc(e,n,a){var l=e.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=a;var d=e.baseQueue,h=l.pending;if(h!==null){if(d!==null){var w=d.next;d.next=h.next,h.next=w}n.baseQueue=d=h,l.pending=null}if(h=e.baseState,d===null)e.memoizedState=h;else{n=d.next;var _=w=null,O=null,V=n,ve=!1;do{var ke=V.lane&-536870913;if(ke!==V.lane?(gt&ke)===ke:(sr&ke)===ke){var fe=V.revertLane;if(fe===0)O!==null&&(O=O.next={lane:0,revertLane:0,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),ke===bi&&(ve=!0);else if((sr&fe)===fe){V=V.next,fe===bi&&(ve=!0);continue}else ke={lane:0,revertLane:V.revertLane,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},O===null?(_=O=ke,w=h):O=O.next=ke,it.lanes|=fe,hr|=fe;ke=V.action,Or&&a(h,ke),h=V.hasEagerState?V.eagerState:a(h,ke)}else fe={lane:ke,revertLane:V.revertLane,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},O===null?(_=O=fe,w=h):O=O.next=fe,it.lanes|=ke,hr|=ke;V=V.next}while(V!==null&&V!==n);if(O===null?w=h:O.next=_,!En(h,e.memoizedState)&&(rn=!0,ve&&(a=xi,a!==null)))throw a;e.memoizedState=h,e.baseState=w,e.baseQueue=O,l.lastRenderedState=h}return d===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function Jc(e){var n=Xt(),a=n.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=e;var l=a.dispatch,d=a.pending,h=n.memoizedState;if(d!==null){a.pending=null;var w=d=d.next;do h=e(h,w.action),w=w.next;while(w!==d);En(h,n.memoizedState)||(rn=!0),n.memoizedState=h,n.baseQueue===null&&(n.baseState=h),a.lastRenderedState=h}return[h,l]}function lm(e,n,a){var l=it,d=Xt(),h=yt;if(h){if(a===void 0)throw Error(i(407));a=a()}else a=n();var w=!En((kt||d).memoizedState,a);if(w&&(d.memoizedState=a,rn=!0),d=d.queue,tu(dm.bind(null,l,d,e),[e]),d.getSnapshot!==n||w||Gt!==null&&Gt.memoizedState.tag&1){if(l.flags|=2048,ki(9,um.bind(null,l,d,a,n),{destroy:void 0},null),_t===null)throw Error(i(349));h||(sr&60)!==0||cm(l,n,a)}return a}function cm(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=it.updateQueue,n===null?(n=Ho(),it.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function um(e,n,a,l){n.value=a,n.getSnapshot=l,fm(n)&&hm(e)}function dm(e,n,a){return a(function(){fm(n)&&hm(e)})}function fm(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!En(e,a)}catch{return!0}}function hm(e){var n=er(e,2);n!==null&&bn(n,e,2)}function Wc(e){var n=kn();if(typeof e=="function"){var a=e;if(e=a(),Or){ae(!0);try{a()}finally{ae(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:e},n}function mm(e,n,a,l){return e.baseState=a,Zc(e,kt,typeof l=="function"?l:Ds)}function Fy(e,n,a,l,d){if(Qo(e))throw Error(i(485));if(e=n.action,e!==null){var h={payload:d,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){h.listeners.push(w)}};z.T!==null?a(!0):h.isTransition=!1,l(h),a=n.pending,a===null?(h.next=n.pending=h,pm(n,h)):(h.next=a.next,n.pending=a.next=h)}}function pm(e,n){var a=n.action,l=n.payload,d=e.state;if(n.isTransition){var h=z.T,w={};z.T=w;try{var _=a(d,l),O=z.S;O!==null&&O(w,_),gm(e,n,_)}catch(V){eu(e,n,V)}finally{z.T=h}}else try{h=a(d,l),gm(e,n,h)}catch(V){eu(e,n,V)}}function gm(e,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(l){Am(e,n,l)},function(l){return eu(e,n,l)}):Am(e,n,a)}function Am(e,n,a){n.status="fulfilled",n.value=a,ym(n),e.state=a,n=e.pending,n!==null&&(a=n.next,a===n?e.pending=null:(a=a.next,n.next=a,pm(e,a)))}function eu(e,n,a){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do n.status="rejected",n.reason=a,ym(n),n=n.next;while(n!==l)}e.action=null}function ym(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function vm(e,n){return n}function bm(e,n){if(yt){var a=_t.formState;if(a!==null){e:{var l=it;if(yt){if(dn){t:{for(var d=dn,h=ds;d.nodeType!==8;){if(!h){d=null;break t}if(d=is(d.nextSibling),d===null){d=null;break t}}h=d.data,d=h==="F!"||h==="F"?d:null}if(d){dn=is(d.nextSibling),l=d.data==="F!";break e}}Tr(l)}l=!1}l&&(n=a[0])}}return a=kn(),a.memoizedState=a.baseState=n,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vm,lastRenderedState:n},a.queue=l,a=Bm.bind(null,it,l),l.dispatch=a,l=Wc(!1),h=au.bind(null,it,!1,l.queue),l=kn(),d={state:n,dispatch:null,action:e,pending:null},l.queue=d,a=Fy.bind(null,it,d,h,a),d.dispatch=a,l.memoizedState=e,[n,a,!1]}function xm(e){var n=Xt();return Sm(n,kt,e)}function Sm(e,n,a){n=Zc(e,n,vm)[0],e=Yo(Ds)[0],n=typeof n=="object"&&n!==null&&typeof n.then=="function"?xa(n):n;var l=Xt(),d=l.queue,h=d.dispatch;return a!==l.memoizedState&&(it.flags|=2048,ki(9,Hy.bind(null,d,a),{destroy:void 0},null)),[n,h,e]}function Hy(e,n){e.action=n}function wm(e){var n=Xt(),a=kt;if(a!==null)return Sm(n,a,e);Xt(),n=n.memoizedState,a=Xt();var l=a.queue.dispatch;return a.memoizedState=e,[n,l,!1]}function ki(e,n,a,l){return e={tag:e,create:n,inst:a,deps:l,next:null},n=it.updateQueue,n===null&&(n=Ho(),it.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=e.next=e:(l=a.next,a.next=e,e.next=l,n.lastEffect=e),e}function km(){return Xt().memoizedState}function Go(e,n,a,l){var d=kn();it.flags|=e,d.memoizedState=ki(1|n,a,{destroy:void 0},l===void 0?null:l)}function Xo(e,n,a,l){var d=Xt();l=l===void 0?null:l;var h=d.memoizedState.inst;kt!==null&&l!==null&&Vc(l,kt.memoizedState.deps)?d.memoizedState=ki(n,a,h,l):(it.flags|=e,d.memoizedState=ki(1|n,a,h,l))}function Cm(e,n){Go(8390656,8,e,n)}function tu(e,n){Xo(2048,8,e,n)}function jm(e,n){return Xo(4,2,e,n)}function _m(e,n){return Xo(4,4,e,n)}function Em(e,n){if(typeof n=="function"){e=e();var a=n(e);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function Nm(e,n,a){a=a!=null?a.concat([e]):null,Xo(4,4,Em.bind(null,n,e),a)}function nu(){}function Tm(e,n){var a=Xt();n=n===void 0?null:n;var l=a.memoizedState;return n!==null&&Vc(n,l[1])?l[0]:(a.memoizedState=[e,n],e)}function Rm(e,n){var a=Xt();n=n===void 0?null:n;var l=a.memoizedState;if(n!==null&&Vc(n,l[1]))return l[0];if(l=e(),Or){ae(!0);try{e()}finally{ae(!1)}}return a.memoizedState=[l,n],l}function su(e,n,a){return a===void 0||(sr&1073741824)!==0?e.memoizedState=n:(e.memoizedState=a,e=Op(),it.lanes|=e,hr|=e,a)}function Mm(e,n,a,l){return En(a,n)?a:vi.current!==null?(e=su(e,a,l),En(e,n)||(rn=!0),e):(sr&42)===0?(rn=!0,e.memoizedState=a):(e=Op(),it.lanes|=e,hr|=e,n)}function Om(e,n,a,l,d){var h=Z.p;Z.p=h!==0&&8>h?h:8;var w=z.T,_={};z.T=_,au(e,!1,n,a);try{var O=d(),V=z.S;if(V!==null&&V(_,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var ve=$y(O,l);Sa(e,n,ve,Mn(e))}else Sa(e,n,l,Mn(e))}catch(ke){Sa(e,n,{then:function(){},status:"rejected",reason:ke},Mn())}finally{Z.p=h,z.T=w}}function Vy(){}function ru(e,n,a,l){if(e.tag!==5)throw Error(i(476));var d=Dm(e).queue;Om(e,d,n,Te,a===null?Vy:function(){return Lm(e),a(l)})}function Dm(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:Te,baseState:Te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:Te},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:a},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Lm(e){var n=Dm(e).next.queue;Sa(e,n,{},Mn())}function iu(){return pn(Ia)}function zm(){return Xt().memoizedState}function Um(){return Xt().memoizedState}function Yy(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var a=Mn();e=or(a);var l=lr(n,e,a);l!==null&&(bn(l,n,a),Ca(l,n,a)),n={cache:Ic()},e.payload=n;return}n=n.return}}function Gy(e,n,a){var l=Mn();a={lane:l,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Qo(e)?Pm(n,a):(a=Lc(e,n,a,l),a!==null&&(bn(a,e,l),$m(a,n,l)))}function Bm(e,n,a){var l=Mn();Sa(e,n,a,l)}function Sa(e,n,a,l){var d={lane:l,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Qo(e))Pm(n,d);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=n.lastRenderedReducer,h!==null))try{var w=n.lastRenderedState,_=h(w,a);if(d.hasEagerState=!0,d.eagerState=_,En(_,w))return Mo(e,n,d,0),_t===null&&Ro(),!1}catch{}finally{}if(a=Lc(e,n,d,l),a!==null)return bn(a,e,l),$m(a,n,l),!0}return!1}function au(e,n,a,l){if(l={lane:2,revertLane:Qu(),action:l,hasEagerState:!1,eagerState:null,next:null},Qo(e)){if(n)throw Error(i(479))}else n=Lc(e,a,l,2),n!==null&&bn(n,e,2)}function Qo(e){var n=e.alternate;return e===it||n!==null&&n===it}function Pm(e,n){Si=Io=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function $m(e,n,a){if((a&4194176)!==0){var l=n.lanes;l&=e.pendingLanes,a|=l,n.lanes=a,we(e,a)}}var hs={readContext:pn,use:Vo,useCallback:Ht,useContext:Ht,useEffect:Ht,useImperativeHandle:Ht,useLayoutEffect:Ht,useInsertionEffect:Ht,useMemo:Ht,useReducer:Ht,useRef:Ht,useState:Ht,useDebugValue:Ht,useDeferredValue:Ht,useTransition:Ht,useSyncExternalStore:Ht,useId:Ht};hs.useCacheRefresh=Ht,hs.useMemoCache=Ht,hs.useHostTransitionStatus=Ht,hs.useFormState=Ht,hs.useActionState=Ht,hs.useOptimistic=Ht;var Dr={readContext:pn,use:Vo,useCallback:function(e,n){return kn().memoizedState=[e,n===void 0?null:n],e},useContext:pn,useEffect:Cm,useImperativeHandle:function(e,n,a){a=a!=null?a.concat([e]):null,Go(4194308,4,Em.bind(null,n,e),a)},useLayoutEffect:function(e,n){return Go(4194308,4,e,n)},useInsertionEffect:function(e,n){Go(4,2,e,n)},useMemo:function(e,n){var a=kn();n=n===void 0?null:n;var l=e();if(Or){ae(!0);try{e()}finally{ae(!1)}}return a.memoizedState=[l,n],l},useReducer:function(e,n,a){var l=kn();if(a!==void 0){var d=a(n);if(Or){ae(!0);try{a(n)}finally{ae(!1)}}}else d=n;return l.memoizedState=l.baseState=d,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:d},l.queue=e,e=e.dispatch=Gy.bind(null,it,e),[l.memoizedState,e]},useRef:function(e){var n=kn();return e={current:e},n.memoizedState=e},useState:function(e){e=Wc(e);var n=e.queue,a=Bm.bind(null,it,n);return n.dispatch=a,[e.memoizedState,a]},useDebugValue:nu,useDeferredValue:function(e,n){var a=kn();return su(a,e,n)},useTransition:function(){var e=Wc(!1);return e=Om.bind(null,it,e.queue,!0,!1),kn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,a){var l=it,d=kn();if(yt){if(a===void 0)throw Error(i(407));a=a()}else{if(a=n(),_t===null)throw Error(i(349));(gt&60)!==0||cm(l,n,a)}d.memoizedState=a;var h={value:a,getSnapshot:n};return d.queue=h,Cm(dm.bind(null,l,h,e),[e]),l.flags|=2048,ki(9,um.bind(null,l,h,a,n),{destroy:void 0},null),a},useId:function(){var e=kn(),n=_t.identifierPrefix;if(yt){var a=Ms,l=Rs;a=(l&~(1<<32-Be(l)-1)).toString(32)+a,n=":"+n+"R"+a,a=Fo++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=qy++,n=":"+n+"r"+a.toString(32)+":";return e.memoizedState=n},useCacheRefresh:function(){return kn().memoizedState=Yy.bind(null,it)}};Dr.useMemoCache=Kc,Dr.useHostTransitionStatus=iu,Dr.useFormState=bm,Dr.useActionState=bm,Dr.useOptimistic=function(e){var n=kn();n.memoizedState=n.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=au.bind(null,it,!0,a),a.dispatch=n,[e,n]};var rr={readContext:pn,use:Vo,useCallback:Tm,useContext:pn,useEffect:tu,useImperativeHandle:Nm,useInsertionEffect:jm,useLayoutEffect:_m,useMemo:Rm,useReducer:Yo,useRef:km,useState:function(){return Yo(Ds)},useDebugValue:nu,useDeferredValue:function(e,n){var a=Xt();return Mm(a,kt.memoizedState,e,n)},useTransition:function(){var e=Yo(Ds)[0],n=Xt().memoizedState;return[typeof e=="boolean"?e:xa(e),n]},useSyncExternalStore:lm,useId:zm};rr.useCacheRefresh=Um,rr.useMemoCache=Kc,rr.useHostTransitionStatus=iu,rr.useFormState=xm,rr.useActionState=xm,rr.useOptimistic=function(e,n){var a=Xt();return mm(a,kt,e,n)};var Lr={readContext:pn,use:Vo,useCallback:Tm,useContext:pn,useEffect:tu,useImperativeHandle:Nm,useInsertionEffect:jm,useLayoutEffect:_m,useMemo:Rm,useReducer:Jc,useRef:km,useState:function(){return Jc(Ds)},useDebugValue:nu,useDeferredValue:function(e,n){var a=Xt();return kt===null?su(a,e,n):Mm(a,kt.memoizedState,e,n)},useTransition:function(){var e=Jc(Ds)[0],n=Xt().memoizedState;return[typeof e=="boolean"?e:xa(e),n]},useSyncExternalStore:lm,useId:zm};Lr.useCacheRefresh=Um,Lr.useMemoCache=Kc,Lr.useHostTransitionStatus=iu,Lr.useFormState=wm,Lr.useActionState=wm,Lr.useOptimistic=function(e,n){var a=Xt();return kt!==null?mm(a,kt,e,n):(a.baseState=e,[e,a.queue.dispatch])};function ou(e,n,a,l){n=e.memoizedState,a=a(l,n),a=a==null?n:W({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var lu={isMounted:function(e){return(e=e._reactInternals)?Y(e)===e:!1},enqueueSetState:function(e,n,a){e=e._reactInternals;var l=Mn(),d=or(l);d.payload=n,a!=null&&(d.callback=a),n=lr(e,d,l),n!==null&&(bn(n,e,l),Ca(n,e,l))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var l=Mn(),d=or(l);d.tag=1,d.payload=n,a!=null&&(d.callback=a),n=lr(e,d,l),n!==null&&(bn(n,e,l),Ca(n,e,l))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=Mn(),l=or(a);l.tag=2,n!=null&&(l.callback=n),n=lr(e,l,a),n!==null&&(bn(n,e,a),Ca(n,e,a))}};function qm(e,n,a,l,d,h,w){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,h,w):n.prototype&&n.prototype.isPureReactComponent?!ca(a,l)||!ca(d,h):!0}function Im(e,n,a,l){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,l),n.state!==e&&lu.enqueueReplaceState(n,n.state,null)}function zr(e,n){var a=n;if("ref"in n){a={};for(var l in n)l!=="ref"&&(a[l]=n[l])}if(e=e.defaultProps){a===n&&(a=W({},a));for(var d in e)a[d]===void 0&&(a[d]=e[d])}return a}var Ko=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof io=="object"&&typeof io.emit=="function"){io.emit("uncaughtException",e);return}console.error(e)};function Fm(e){Ko(e)}function Hm(e){console.error(e)}function Vm(e){Ko(e)}function Zo(e,n){try{var a=e.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(l){setTimeout(function(){throw l})}}function Ym(e,n,a){try{var l=e.onCaughtError;l(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function cu(e,n,a){return a=or(a),a.tag=3,a.payload={element:null},a.callback=function(){Zo(e,n)},a}function Gm(e){return e=or(e),e.tag=3,e}function Xm(e,n,a,l){var d=a.type.getDerivedStateFromError;if(typeof d=="function"){var h=l.value;e.payload=function(){return d(h)},e.callback=function(){Ym(n,a,l)}}var w=a.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(e.callback=function(){Ym(n,a,l),typeof d!="function"&&(mr===null?mr=new Set([this]):mr.add(this));var _=l.stack;this.componentDidCatch(l.value,{componentStack:_!==null?_:""})})}function Xy(e,n,a,l,d){if(a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(n=a.alternate,n!==null&&ka(n,a,d,!0),a=Fn.current,a!==null){switch(a.tag){case 13:return fs===null?Hu():a.alternate===null&&$t===0&&($t=3),a.flags&=-257,a.flags|=65536,a.lanes=d,l===Pc?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([l]):n.add(l),Yu(e,l,d)),!1;case 22:return a.flags|=65536,l===Pc?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([l])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([l]):a.add(l)),Yu(e,l,d)),!1}throw Error(i(435,a.tag))}return Yu(e,l,d),Hu(),!1}if(yt)return n=Fn.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=d,l!==Bc&&(e=Error(i(422),{cause:l}),ha($n(e,a)))):(l!==Bc&&(n=Error(i(423),{cause:l}),ha($n(n,a))),e=e.current.alternate,e.flags|=65536,d&=-d,e.lanes|=d,l=$n(l,a),d=cu(e.stateNode,l,d),ku(e,d),$t!==4&&($t=2)),!1;var h=Error(i(520),{cause:l});if(h=$n(h,a),Oa===null?Oa=[h]:Oa.push(h),$t!==4&&($t=2),n===null)return!0;l=$n(l,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,e=d&-d,a.lanes|=e,e=cu(a.stateNode,l,e),ku(a,e),!1;case 1:if(n=a.type,h=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(mr===null||!mr.has(h))))return a.flags|=65536,d&=-d,a.lanes|=d,d=Gm(d),Xm(d,e,a,l),ku(a,d),!1}a=a.return}while(a!==null);return!1}var Qm=Error(i(461)),rn=!1;function fn(e,n,a,l){n.child=e===null?em(n,null,a,l):Rr(n,e.child,a,l)}function Km(e,n,a,l,d){a=a.render;var h=n.ref;if("ref"in l){var w={};for(var _ in l)_!=="ref"&&(w[_]=l[_])}else w=l;return Br(n),l=Yc(e,n,a,w,h,d),_=Gc(),e!==null&&!rn?(Xc(e,n,d),Ls(e,n,d)):(yt&&_&&zc(n),n.flags|=1,fn(e,n,l,d),n.child)}function Zm(e,n,a,l,d){if(e===null){var h=a.type;return typeof h=="function"&&!Mu(h)&&h.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=h,Jm(e,n,h,l,d)):(e=nl(a.type,null,l,n,n.mode,d),e.ref=n.ref,e.return=n,n.child=e)}if(h=e.child,!yu(e,d)){var w=h.memoizedProps;if(a=a.compare,a=a!==null?a:ca,a(w,l)&&e.ref===n.ref)return Ls(e,n,d)}return n.flags|=1,e=fr(h,l),e.ref=n.ref,e.return=n,n.child=e}function Jm(e,n,a,l,d){if(e!==null){var h=e.memoizedProps;if(ca(h,l)&&e.ref===n.ref)if(rn=!1,n.pendingProps=l=h,yu(e,d))(e.flags&131072)!==0&&(rn=!0);else return n.lanes=e.lanes,Ls(e,n,d)}return uu(e,n,a,l,d)}function Wm(e,n,a){var l=n.pendingProps,d=l.children,h=(n.stateNode._pendingVisibility&2)!==0,w=e!==null?e.memoizedState:null;if(wa(e,n),l.mode==="hidden"||h){if((n.flags&128)!==0){if(l=w!==null?w.baseLanes|a:a,e!==null){for(d=n.child=e.child,h=0;d!==null;)h=h|d.lanes|d.childLanes,d=d.sibling;n.childLanes=h&~l}else n.childLanes=0,n.child=null;return ep(e,n,l,a)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&qo(n,w!==null?w.cachePool:null),w!==null?tm(n,w):$c(),nm(n);else return n.lanes=n.childLanes=536870912,ep(e,n,w!==null?w.baseLanes|a:a,a)}else w!==null?(qo(n,w.cachePool),tm(n,w),nr(),n.memoizedState=null):(e!==null&&qo(n,null),$c(),nr());return fn(e,n,d,a),n.child}function ep(e,n,a,l){var d=Hc();return d=d===null?null:{parent:Wt._currentValue,pool:d},n.memoizedState={baseLanes:a,cachePool:d},e!==null&&qo(n,null),$c(),nm(n),e!==null&&ka(e,n,l,!0),null}function wa(e,n){var a=n.ref;if(a===null)e!==null&&e.ref!==null&&(n.flags|=2097664);else{if(typeof a!="function"&&typeof a!="object")throw Error(i(284));(e===null||e.ref!==a)&&(n.flags|=2097664)}}function uu(e,n,a,l,d){return Br(n),a=Yc(e,n,a,l,void 0,d),l=Gc(),e!==null&&!rn?(Xc(e,n,d),Ls(e,n,d)):(yt&&l&&zc(n),n.flags|=1,fn(e,n,a,d),n.child)}function tp(e,n,a,l,d,h){return Br(n),n.updateQueue=null,a=om(n,l,a,d),am(e),l=Gc(),e!==null&&!rn?(Xc(e,n,h),Ls(e,n,h)):(yt&&l&&zc(n),n.flags|=1,fn(e,n,a,h),n.child)}function np(e,n,a,l,d){if(Br(n),n.stateNode===null){var h=pi,w=a.contextType;typeof w=="object"&&w!==null&&(h=pn(w)),h=new a(l,h),n.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=lu,n.stateNode=h,h._reactInternals=n,h=n.stateNode,h.props=l,h.state=n.memoizedState,h.refs={},Su(n),w=a.contextType,h.context=typeof w=="object"&&w!==null?pn(w):pi,h.state=n.memoizedState,w=a.getDerivedStateFromProps,typeof w=="function"&&(ou(n,a,w,l),h.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(w=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),w!==h.state&&lu.enqueueReplaceState(h,h.state,null),_a(n,l,h,d),ja(),h.state=n.memoizedState),typeof h.componentDidMount=="function"&&(n.flags|=4194308),l=!0}else if(e===null){h=n.stateNode;var _=n.memoizedProps,O=zr(a,_);h.props=O;var V=h.context,ve=a.contextType;w=pi,typeof ve=="object"&&ve!==null&&(w=pn(ve));var ke=a.getDerivedStateFromProps;ve=typeof ke=="function"||typeof h.getSnapshotBeforeUpdate=="function",_=n.pendingProps!==_,ve||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(_||V!==w)&&Im(n,h,l,w),ar=!1;var fe=n.memoizedState;h.state=fe,_a(n,l,h,d),ja(),V=n.memoizedState,_||fe!==V||ar?(typeof ke=="function"&&(ou(n,a,ke,l),V=n.memoizedState),(O=ar||qm(n,a,O,l,fe,V,w))?(ve||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(n.flags|=4194308)):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=V),h.props=l,h.state=V,h.context=w,l=O):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{h=n.stateNode,wu(e,n),w=n.memoizedProps,ve=zr(a,w),h.props=ve,ke=n.pendingProps,fe=h.context,V=a.contextType,O=pi,typeof V=="object"&&V!==null&&(O=pn(V)),_=a.getDerivedStateFromProps,(V=typeof _=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(w!==ke||fe!==O)&&Im(n,h,l,O),ar=!1,fe=n.memoizedState,h.state=fe,_a(n,l,h,d),ja();var ge=n.memoizedState;w!==ke||fe!==ge||ar||e!==null&&e.dependencies!==null&&Jo(e.dependencies)?(typeof _=="function"&&(ou(n,a,_,l),ge=n.memoizedState),(ve=ar||qm(n,a,ve,l,fe,ge,O)||e!==null&&e.dependencies!==null&&Jo(e.dependencies))?(V||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(l,ge,O),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(l,ge,O)),typeof h.componentDidUpdate=="function"&&(n.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof h.componentDidUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=ge),h.props=l,h.state=ge,h.context=O,l=ve):(typeof h.componentDidUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(n.flags|=1024),l=!1)}return h=l,wa(e,n),l=(n.flags&128)!==0,h||l?(h=n.stateNode,a=l&&typeof a.getDerivedStateFromError!="function"?null:h.render(),n.flags|=1,e!==null&&l?(n.child=Rr(n,e.child,null,d),n.child=Rr(n,null,a,d)):fn(e,n,a,d),n.memoizedState=h.state,e=n.child):e=Ls(e,n,d),e}function sp(e,n,a,l){return fa(),n.flags|=256,fn(e,n,a,l),n.child}var du={dehydrated:null,treeContext:null,retryLane:0};function fu(e){return{baseLanes:e,cachePool:im()}}function hu(e,n,a){return e=e!==null?e.childLanes&~a:0,n&&(e|=Gn),e}function rp(e,n,a){var l=n.pendingProps,d=!1,h=(n.flags&128)!==0,w;if((w=h)||(w=e!==null&&e.memoizedState===null?!1:(Jt.current&2)!==0),w&&(d=!0,n.flags&=-129),w=(n.flags&32)!==0,n.flags&=-33,e===null){if(yt){if(d?tr(n):nr(),yt){var _=dn,O;if(O=_){e:{for(O=_,_=ds;O.nodeType!==8;){if(!_){_=null;break e}if(O=is(O.nextSibling),O===null){_=null;break e}}_=O}_!==null?(n.memoizedState={dehydrated:_,treeContext:Er!==null?{id:Rs,overflow:Ms}:null,retryLane:536870912},O=Yn(18,null,null,0),O.stateNode=_,O.return=n,n.child=O,vn=n,dn=null,O=!0):O=!1}O||Tr(n)}if(_=n.memoizedState,_!==null&&(_=_.dehydrated,_!==null))return _.data==="$!"?n.lanes=16:n.lanes=536870912,null;Os(n)}return _=l.children,l=l.fallback,d?(nr(),d=n.mode,_=pu({mode:"hidden",children:_},d),l=$r(l,d,a,null),_.return=n,l.return=n,_.sibling=l,n.child=_,d=n.child,d.memoizedState=fu(a),d.childLanes=hu(e,w,a),n.memoizedState=du,l):(tr(n),mu(n,_))}if(O=e.memoizedState,O!==null&&(_=O.dehydrated,_!==null)){if(h)n.flags&256?(tr(n),n.flags&=-257,n=gu(e,n,a)):n.memoizedState!==null?(nr(),n.child=e.child,n.flags|=128,n=null):(nr(),d=l.fallback,_=n.mode,l=pu({mode:"visible",children:l.children},_),d=$r(d,_,a,null),d.flags|=2,l.return=n,d.return=n,l.sibling=d,n.child=l,Rr(n,e.child,null,a),l=n.child,l.memoizedState=fu(a),l.childLanes=hu(e,w,a),n.memoizedState=du,n=d);else if(tr(n),_.data==="$!"){if(w=_.nextSibling&&_.nextSibling.dataset,w)var V=w.dgst;w=V,l=Error(i(419)),l.stack="",l.digest=w,ha({value:l,source:null,stack:null}),n=gu(e,n,a)}else if(rn||ka(e,n,a,!1),w=(a&e.childLanes)!==0,rn||w){if(w=_t,w!==null){if(l=a&-a,(l&42)!==0)l=1;else switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=64;break;case 268435456:l=134217728;break;default:l=0}if(l=(l&(w.suspendedLanes|a))!==0?0:l,l!==0&&l!==O.retryLane)throw O.retryLane=l,er(e,l),bn(w,e,l),Qm}_.data==="$?"||Hu(),n=gu(e,n,a)}else _.data==="$?"?(n.flags|=128,n.child=e.child,n=cv.bind(null,e),_._reactRetry=n,n=null):(e=O.treeContext,dn=is(_.nextSibling),vn=n,yt=!0,ss=null,ds=!1,e!==null&&(qn[In++]=Rs,qn[In++]=Ms,qn[In++]=Er,Rs=e.id,Ms=e.overflow,Er=n),n=mu(n,l.children),n.flags|=4096);return n}return d?(nr(),d=l.fallback,_=n.mode,O=e.child,V=O.sibling,l=fr(O,{mode:"hidden",children:l.children}),l.subtreeFlags=O.subtreeFlags&31457280,V!==null?d=fr(V,d):(d=$r(d,_,a,null),d.flags|=2),d.return=n,l.return=n,l.sibling=d,n.child=l,l=d,d=n.child,_=e.child.memoizedState,_===null?_=fu(a):(O=_.cachePool,O!==null?(V=Wt._currentValue,O=O.parent!==V?{parent:V,pool:V}:O):O=im(),_={baseLanes:_.baseLanes|a,cachePool:O}),d.memoizedState=_,d.childLanes=hu(e,w,a),n.memoizedState=du,l):(tr(n),a=e.child,e=a.sibling,a=fr(a,{mode:"visible",children:l.children}),a.return=n,a.sibling=null,e!==null&&(w=n.deletions,w===null?(n.deletions=[e],n.flags|=16):w.push(e)),n.child=a,n.memoizedState=null,a)}function mu(e,n){return n=pu({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function pu(e,n){return Tp(e,n,0,null)}function gu(e,n,a){return Rr(n,e.child,null,a),e=mu(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function ip(e,n,a){e.lanes|=n;var l=e.alternate;l!==null&&(l.lanes|=n),bu(e.return,n,a)}function Au(e,n,a,l,d){var h=e.memoizedState;h===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:a,tailMode:d}:(h.isBackwards=n,h.rendering=null,h.renderingStartTime=0,h.last=l,h.tail=a,h.tailMode=d)}function ap(e,n,a){var l=n.pendingProps,d=l.revealOrder,h=l.tail;if(fn(e,n,l.children,a),l=Jt.current,(l&2)!==0)l=l&1|2,n.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ip(e,a,n);else if(e.tag===19)ip(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}switch(Le(Jt,l),d){case"forwards":for(a=n.child,d=null;a!==null;)e=a.alternate,e!==null&&$o(e)===null&&(d=a),a=a.sibling;a=d,a===null?(d=n.child,n.child=null):(d=a.sibling,a.sibling=null),Au(n,!1,d,a,h);break;case"backwards":for(a=null,d=n.child,n.child=null;d!==null;){if(e=d.alternate,e!==null&&$o(e)===null){n.child=d;break}e=d.sibling,d.sibling=a,a=d,d=e}Au(n,!0,a,null,h);break;case"together":Au(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Ls(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),hr|=n.lanes,(a&n.childLanes)===0)if(e!==null){if(ka(e,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(i(153));if(n.child!==null){for(e=n.child,a=fr(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=fr(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function yu(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&Jo(e)))}function Qy(e,n,a){switch(n.tag){case 3:be(n,n.stateNode.containerInfo),ir(n,Wt,e.memoizedState.cache),fa();break;case 27:case 5:_e(n);break;case 4:be(n,n.stateNode.containerInfo);break;case 10:ir(n,n.type,n.memoizedProps.value);break;case 13:var l=n.memoizedState;if(l!==null)return l.dehydrated!==null?(tr(n),n.flags|=128,null):(a&n.child.childLanes)!==0?rp(e,n,a):(tr(n),e=Ls(e,n,a),e!==null?e.sibling:null);tr(n);break;case 19:var d=(e.flags&128)!==0;if(l=(a&n.childLanes)!==0,l||(ka(e,n,a,!1),l=(a&n.childLanes)!==0),d){if(l)return ap(e,n,a);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Le(Jt,Jt.current),l)break;return null;case 22:case 23:return n.lanes=0,Wm(e,n,a);case 24:ir(n,Wt,e.memoizedState.cache)}return Ls(e,n,a)}function op(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps)rn=!0;else{if(!yu(e,a)&&(n.flags&128)===0)return rn=!1,Qy(e,n,a);rn=(e.flags&131072)!==0}else rn=!1,yt&&(n.flags&1048576)!==0&&Vh(n,Lo,n.index);switch(n.lanes=0,n.tag){case 16:e:{e=n.pendingProps;var l=n.elementType,d=l._init;if(l=d(l._payload),n.type=l,typeof l=="function")Mu(l)?(e=zr(l,e),n.tag=1,n=np(null,n,l,e,a)):(n.tag=0,n=uu(null,n,l,e,a));else{if(l!=null){if(d=l.$$typeof,d===M){n.tag=11,n=Km(null,n,l,e,a);break e}else if(d===ne){n.tag=14,n=Zm(null,n,l,e,a);break e}}throw n=T(l)||l,Error(i(306,n,""))}}return n;case 0:return uu(e,n,n.type,n.pendingProps,a);case 1:return l=n.type,d=zr(l,n.pendingProps),np(e,n,l,d,a);case 3:e:{if(be(n,n.stateNode.containerInfo),e===null)throw Error(i(387));var h=n.pendingProps;d=n.memoizedState,l=d.element,wu(e,n),_a(n,h,null,a);var w=n.memoizedState;if(h=w.cache,ir(n,Wt,h),h!==d.cache&&xu(n,[Wt],a,!0),ja(),h=w.element,d.isDehydrated)if(d={element:h,isDehydrated:!1,cache:w.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=sp(e,n,h,a);break e}else if(h!==l){l=$n(Error(i(424)),n),ha(l),n=sp(e,n,h,a);break e}else for(dn=is(n.stateNode.containerInfo.firstChild),vn=n,yt=!0,ss=null,ds=!0,a=em(n,null,h,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(fa(),h===l){n=Ls(e,n,a);break e}fn(e,n,h,a)}n=n.child}return n;case 26:return wa(e,n),e===null?(a=ug(n.type,null,n.pendingProps,null))?n.memoizedState=a:yt||(a=n.type,e=n.pendingProps,l=ml(G.current).createElement(a),l[ot]=n,l[Zt]=e,hn(l,a,e),sn(l),n.stateNode=l):n.memoizedState=ug(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return _e(n),e===null&&yt&&(l=n.stateNode=og(n.type,n.pendingProps,G.current),vn=n,ds=!0,dn=is(l.firstChild)),l=n.pendingProps.children,e!==null||yt?fn(e,n,l,a):n.child=Rr(n,null,l,a),wa(e,n),n.child;case 5:return e===null&&yt&&((d=l=dn)&&(l=Cv(l,n.type,n.pendingProps,ds),l!==null?(n.stateNode=l,vn=n,dn=is(l.firstChild),ds=!1,d=!0):d=!1),d||Tr(n)),_e(n),d=n.type,h=n.pendingProps,w=e!==null?e.memoizedProps:null,l=h.children,rd(d,h)?l=null:w!==null&&rd(d,w)&&(n.flags|=32),n.memoizedState!==null&&(d=Yc(e,n,Iy,null,null,a),Ia._currentValue=d),wa(e,n),fn(e,n,l,a),n.child;case 6:return e===null&&yt&&((e=a=dn)&&(a=jv(a,n.pendingProps,ds),a!==null?(n.stateNode=a,vn=n,dn=null,e=!0):e=!1),e||Tr(n)),null;case 13:return rp(e,n,a);case 4:return be(n,n.stateNode.containerInfo),l=n.pendingProps,e===null?n.child=Rr(n,null,l,a):fn(e,n,l,a),n.child;case 11:return Km(e,n,n.type,n.pendingProps,a);case 7:return fn(e,n,n.pendingProps,a),n.child;case 8:return fn(e,n,n.pendingProps.children,a),n.child;case 12:return fn(e,n,n.pendingProps.children,a),n.child;case 10:return l=n.pendingProps,ir(n,n.type,l.value),fn(e,n,l.children,a),n.child;case 9:return d=n.type._context,l=n.pendingProps.children,Br(n),d=pn(d),l=l(d),n.flags|=1,fn(e,n,l,a),n.child;case 14:return Zm(e,n,n.type,n.pendingProps,a);case 15:return Jm(e,n,n.type,n.pendingProps,a);case 19:return ap(e,n,a);case 22:return Wm(e,n,a);case 24:return Br(n),l=pn(Wt),e===null?(d=Hc(),d===null&&(d=_t,h=Ic(),d.pooledCache=h,h.refCount++,h!==null&&(d.pooledCacheLanes|=a),d=h),n.memoizedState={parent:l,cache:d},Su(n),ir(n,Wt,d)):((e.lanes&a)!==0&&(wu(e,n),_a(n,null,null,a),ja()),d=e.memoizedState,h=n.memoizedState,d.parent!==l?(d={parent:l,cache:l},n.memoizedState=d,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=d),ir(n,Wt,l)):(l=h.cache,ir(n,Wt,l),l!==d.cache&&xu(n,[Wt],a,!0))),fn(e,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(i(156,n.tag))}var vu=Me(null),Ur=null,zs=null;function ir(e,n,a){Le(vu,n._currentValue),n._currentValue=a}function Us(e){e._currentValue=vu.current,Ue(vu)}function bu(e,n,a){for(;e!==null;){var l=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),e===a)break;e=e.return}}function xu(e,n,a,l){var d=e.child;for(d!==null&&(d.return=e);d!==null;){var h=d.dependencies;if(h!==null){var w=d.child;h=h.firstContext;e:for(;h!==null;){var _=h;h=d;for(var O=0;O<n.length;O++)if(_.context===n[O]){h.lanes|=a,_=h.alternate,_!==null&&(_.lanes|=a),bu(h.return,a,e),l||(w=null);break e}h=_.next}}else if(d.tag===18){if(w=d.return,w===null)throw Error(i(341));w.lanes|=a,h=w.alternate,h!==null&&(h.lanes|=a),bu(w,a,e),w=null}else w=d.child;if(w!==null)w.return=d;else for(w=d;w!==null;){if(w===e){w=null;break}if(d=w.sibling,d!==null){d.return=w.return,w=d;break}w=w.return}d=w}}function ka(e,n,a,l){e=null;for(var d=n,h=!1;d!==null;){if(!h){if((d.flags&524288)!==0)h=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var w=d.alternate;if(w===null)throw Error(i(387));if(w=w.memoizedProps,w!==null){var _=d.type;En(d.pendingProps.value,w.value)||(e!==null?e.push(_):e=[_])}}else if(d===oe.current){if(w=d.alternate,w===null)throw Error(i(387));w.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(e!==null?e.push(Ia):e=[Ia])}d=d.return}e!==null&&xu(n,e,a,l),n.flags|=262144}function Jo(e){for(e=e.firstContext;e!==null;){if(!En(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Br(e){Ur=e,zs=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function pn(e){return lp(Ur,e)}function Wo(e,n){return Ur===null&&Br(e),lp(e,n)}function lp(e,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},zs===null){if(e===null)throw Error(i(308));zs=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else zs=zs.next=n;return a}var ar=!1;function Su(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wu(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function or(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function lr(e,n,a){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(Lt&2)!==0){var d=l.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),l.pending=n,n=Oo(e),Fh(e,null,a),n}return Mo(e,l,n,a),Oo(e)}function Ca(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194176)!==0)){var l=n.lanes;l&=e.pendingLanes,a|=l,n.lanes=a,we(e,a)}}function ku(e,n){var a=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,a===l)){var d=null,h=null;if(a=a.firstBaseUpdate,a!==null){do{var w={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};h===null?d=h=w:h=h.next=w,a=a.next}while(a!==null);h===null?d=h=n:h=h.next=n}else d=h=n;a={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:h,shared:l.shared,callbacks:l.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}var Cu=!1;function ja(){if(Cu){var e=xi;if(e!==null)throw e}}function _a(e,n,a,l){Cu=!1;var d=e.updateQueue;ar=!1;var h=d.firstBaseUpdate,w=d.lastBaseUpdate,_=d.shared.pending;if(_!==null){d.shared.pending=null;var O=_,V=O.next;O.next=null,w===null?h=V:w.next=V,w=O;var ve=e.alternate;ve!==null&&(ve=ve.updateQueue,_=ve.lastBaseUpdate,_!==w&&(_===null?ve.firstBaseUpdate=V:_.next=V,ve.lastBaseUpdate=O))}if(h!==null){var ke=d.baseState;w=0,ve=V=O=null,_=h;do{var fe=_.lane&-536870913,ge=fe!==_.lane;if(ge?(gt&fe)===fe:(l&fe)===fe){fe!==0&&fe===bi&&(Cu=!0),ve!==null&&(ve=ve.next={lane:0,tag:_.tag,payload:_.payload,callback:null,next:null});e:{var He=e,Je=_;fe=n;var qt=a;switch(Je.tag){case 1:if(He=Je.payload,typeof He=="function"){ke=He.call(qt,ke,fe);break e}ke=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Je.payload,fe=typeof He=="function"?He.call(qt,ke,fe):He,fe==null)break e;ke=W({},ke,fe);break e;case 2:ar=!0}}fe=_.callback,fe!==null&&(e.flags|=64,ge&&(e.flags|=8192),ge=d.callbacks,ge===null?d.callbacks=[fe]:ge.push(fe))}else ge={lane:fe,tag:_.tag,payload:_.payload,callback:_.callback,next:null},ve===null?(V=ve=ge,O=ke):ve=ve.next=ge,w|=fe;if(_=_.next,_===null){if(_=d.shared.pending,_===null)break;ge=_,_=ge.next,ge.next=null,d.lastBaseUpdate=ge,d.shared.pending=null}}while(!0);ve===null&&(O=ke),d.baseState=O,d.firstBaseUpdate=V,d.lastBaseUpdate=ve,h===null&&(d.shared.lanes=0),hr|=w,e.lanes=w,e.memoizedState=ke}}function cp(e,n){if(typeof e!="function")throw Error(i(191,e));e.call(n)}function up(e,n){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)cp(a[e],n)}function Ea(e,n){try{var a=n.updateQueue,l=a!==null?a.lastEffect:null;if(l!==null){var d=l.next;a=d;do{if((a.tag&e)===e){l=void 0;var h=a.create,w=a.inst;l=h(),w.destroy=l}a=a.next}while(a!==d)}}catch(_){jt(n,n.return,_)}}function cr(e,n,a){try{var l=n.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var h=d.next;l=h;do{if((l.tag&e)===e){var w=l.inst,_=w.destroy;if(_!==void 0){w.destroy=void 0,d=n;var O=a;try{_()}catch(V){jt(d,O,V)}}}l=l.next}while(l!==h)}}catch(V){jt(n,n.return,V)}}function dp(e){var n=e.updateQueue;if(n!==null){var a=e.stateNode;try{up(n,a)}catch(l){jt(e,e.return,l)}}}function fp(e,n,a){a.props=zr(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(l){jt(e,n,l)}}function Pr(e,n){try{var a=e.ref;if(a!==null){var l=e.stateNode;switch(e.tag){case 26:case 27:case 5:var d=l;break;default:d=l}typeof a=="function"?e.refCleanup=a(d):a.current=d}}catch(h){jt(e,n,h)}}function Nn(e,n){var a=e.ref,l=e.refCleanup;if(a!==null)if(typeof l=="function")try{l()}catch(d){jt(e,n,d)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(d){jt(e,n,d)}else a.current=null}function hp(e){var n=e.type,a=e.memoizedProps,l=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&l.focus();break e;case"img":a.src?l.src=a.src:a.srcSet&&(l.srcset=a.srcSet)}}catch(d){jt(e,e.return,d)}}function mp(e,n,a){try{var l=e.stateNode;bv(l,e.type,a,n),l[Zt]=n}catch(d){jt(e,e.return,d)}}function pp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27||e.tag===4}function ju(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||pp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==27&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function _u(e,n,a){var l=e.tag;if(l===5||l===6)e=e.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(e,n):a.insertBefore(e,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(e,a)):(n=a,n.appendChild(e)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=hl));else if(l!==4&&l!==27&&(e=e.child,e!==null))for(_u(e,n,a),e=e.sibling;e!==null;)_u(e,n,a),e=e.sibling}function el(e,n,a){var l=e.tag;if(l===5||l===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(l!==4&&l!==27&&(e=e.child,e!==null))for(el(e,n,a),e=e.sibling;e!==null;)el(e,n,a),e=e.sibling}var Bs=!1,Pt=!1,Eu=!1,gp=typeof WeakSet=="function"?WeakSet:Set,an=null,Ap=!1;function Ky(e,n){if(e=e.containerInfo,nd=bl,e=Dh(e),Tc(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var l=a.getSelection&&a.getSelection();if(l&&l.rangeCount!==0){a=l.anchorNode;var d=l.anchorOffset,h=l.focusNode;l=l.focusOffset;try{a.nodeType,h.nodeType}catch{a=null;break e}var w=0,_=-1,O=-1,V=0,ve=0,ke=e,fe=null;t:for(;;){for(var ge;ke!==a||d!==0&&ke.nodeType!==3||(_=w+d),ke!==h||l!==0&&ke.nodeType!==3||(O=w+l),ke.nodeType===3&&(w+=ke.nodeValue.length),(ge=ke.firstChild)!==null;)fe=ke,ke=ge;for(;;){if(ke===e)break t;if(fe===a&&++V===d&&(_=w),fe===h&&++ve===l&&(O=w),(ge=ke.nextSibling)!==null)break;ke=fe,fe=ke.parentNode}ke=ge}a=_===-1||O===-1?null:{start:_,end:O}}else a=null}a=a||{start:0,end:0}}else a=null;for(sd={focusedElem:e,selectionRange:a},bl=!1,an=n;an!==null;)if(n=an,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,an=e;else for(;an!==null;){switch(n=an,h=n.alternate,e=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,a=n,d=h.memoizedProps,h=h.memoizedState,l=a.stateNode;try{var He=zr(a.type,d,a.elementType===a.type);e=l.getSnapshotBeforeUpdate(He,h),l.__reactInternalSnapshotBeforeUpdate=e}catch(Je){jt(a,a.return,Je)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,a=e.nodeType,a===9)od(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":od(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=n.sibling,e!==null){e.return=n.return,an=e;break}an=n.return}return He=Ap,Ap=!1,He}function yp(e,n,a){var l=a.flags;switch(a.tag){case 0:case 11:case 15:$s(e,a),l&4&&Ea(5,a);break;case 1:if($s(e,a),l&4)if(e=a.stateNode,n===null)try{e.componentDidMount()}catch(_){jt(a,a.return,_)}else{var d=zr(a.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(d,n,e.__reactInternalSnapshotBeforeUpdate)}catch(_){jt(a,a.return,_)}}l&64&&dp(a),l&512&&Pr(a,a.return);break;case 3:if($s(e,a),l&64&&(l=a.updateQueue,l!==null)){if(e=null,a.child!==null)switch(a.child.tag){case 27:case 5:e=a.child.stateNode;break;case 1:e=a.child.stateNode}try{up(l,e)}catch(_){jt(a,a.return,_)}}break;case 26:$s(e,a),l&512&&Pr(a,a.return);break;case 27:case 5:$s(e,a),n===null&&l&4&&hp(a),l&512&&Pr(a,a.return);break;case 12:$s(e,a);break;case 13:$s(e,a),l&4&&xp(e,a);break;case 22:if(d=a.memoizedState!==null||Bs,!d){n=n!==null&&n.memoizedState!==null||Pt;var h=Bs,w=Pt;Bs=d,(Pt=n)&&!w?ur(e,a,(a.subtreeFlags&8772)!==0):$s(e,a),Bs=h,Pt=w}l&512&&(a.memoizedProps.mode==="manual"?Pr(a,a.return):Nn(a,a.return));break;default:$s(e,a)}}function vp(e){var n=e.alternate;n!==null&&(e.alternate=null,vp(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&Bt(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Qt=null,Tn=!1;function Ps(e,n,a){for(a=a.child;a!==null;)bp(e,n,a),a=a.sibling}function bp(e,n,a){if(N&&typeof N.onCommitFiberUnmount=="function")try{N.onCommitFiberUnmount(k,a)}catch{}switch(a.tag){case 26:Pt||Nn(a,n),Ps(e,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Pt||Nn(a,n);var l=Qt,d=Tn;for(Qt=a.stateNode,Ps(e,n,a),a=a.stateNode,n=a.attributes;n.length;)a.removeAttributeNode(n[0]);Bt(a),Qt=l,Tn=d;break;case 5:Pt||Nn(a,n);case 6:d=Qt;var h=Tn;if(Qt=null,Ps(e,n,a),Qt=d,Tn=h,Qt!==null)if(Tn)try{e=Qt,l=a.stateNode,e.nodeType===8?e.parentNode.removeChild(l):e.removeChild(l)}catch(w){jt(a,n,w)}else try{Qt.removeChild(a.stateNode)}catch(w){jt(a,n,w)}break;case 18:Qt!==null&&(Tn?(n=Qt,a=a.stateNode,n.nodeType===8?ad(n.parentNode,a):n.nodeType===1&&ad(n,a),Ya(n)):ad(Qt,a.stateNode));break;case 4:l=Qt,d=Tn,Qt=a.stateNode.containerInfo,Tn=!0,Ps(e,n,a),Qt=l,Tn=d;break;case 0:case 11:case 14:case 15:Pt||cr(2,a,n),Pt||cr(4,a,n),Ps(e,n,a);break;case 1:Pt||(Nn(a,n),l=a.stateNode,typeof l.componentWillUnmount=="function"&&fp(a,n,l)),Ps(e,n,a);break;case 21:Ps(e,n,a);break;case 22:Pt||Nn(a,n),Pt=(l=Pt)||a.memoizedState!==null,Ps(e,n,a),Pt=l;break;default:Ps(e,n,a)}}function xp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ya(e)}catch(a){jt(n,n.return,a)}}function Zy(e){switch(e.tag){case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new gp),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new gp),n;default:throw Error(i(435,e.tag))}}function Nu(e,n){var a=Zy(e);n.forEach(function(l){var d=uv.bind(null,e,l);a.has(l)||(a.add(l),l.then(d,d))})}function Hn(e,n){var a=n.deletions;if(a!==null)for(var l=0;l<a.length;l++){var d=a[l],h=e,w=n,_=w;e:for(;_!==null;){switch(_.tag){case 27:case 5:Qt=_.stateNode,Tn=!1;break e;case 3:Qt=_.stateNode.containerInfo,Tn=!0;break e;case 4:Qt=_.stateNode.containerInfo,Tn=!0;break e}_=_.return}if(Qt===null)throw Error(i(160));bp(h,w,d),Qt=null,Tn=!1,h=d.alternate,h!==null&&(h.return=null),d.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)Sp(n,e),n=n.sibling}var rs=null;function Sp(e,n){var a=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Hn(n,e),Vn(e),l&4&&(cr(3,e,e.return),Ea(3,e),cr(5,e,e.return));break;case 1:Hn(n,e),Vn(e),l&512&&(Pt||a===null||Nn(a,a.return)),l&64&&Bs&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?l:a.concat(l))));break;case 26:var d=rs;if(Hn(n,e),Vn(e),l&512&&(Pt||a===null||Nn(a,a.return)),l&4){var h=a!==null?a.memoizedState:null;if(l=e.memoizedState,a===null)if(l===null)if(e.stateNode===null){e:{l=e.type,a=e.memoizedProps,d=d.ownerDocument||d;t:switch(l){case"title":h=d.getElementsByTagName("title")[0],(!h||h[Tt]||h[ot]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=d.createElement(l),d.head.insertBefore(h,d.querySelector("head > title"))),hn(h,l,a),h[ot]=e,sn(h),l=h;break e;case"link":var w=hg("link","href",d).get(l+(a.href||""));if(w){for(var _=0;_<w.length;_++)if(h=w[_],h.getAttribute("href")===(a.href==null?null:a.href)&&h.getAttribute("rel")===(a.rel==null?null:a.rel)&&h.getAttribute("title")===(a.title==null?null:a.title)&&h.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){w.splice(_,1);break t}}h=d.createElement(l),hn(h,l,a),d.head.appendChild(h);break;case"meta":if(w=hg("meta","content",d).get(l+(a.content||""))){for(_=0;_<w.length;_++)if(h=w[_],h.getAttribute("content")===(a.content==null?null:""+a.content)&&h.getAttribute("name")===(a.name==null?null:a.name)&&h.getAttribute("property")===(a.property==null?null:a.property)&&h.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&h.getAttribute("charset")===(a.charSet==null?null:a.charSet)){w.splice(_,1);break t}}h=d.createElement(l),hn(h,l,a),d.head.appendChild(h);break;default:throw Error(i(468,l))}h[ot]=e,sn(h),l=h}e.stateNode=l}else mg(d,e.type,e.stateNode);else e.stateNode=fg(d,l,e.memoizedProps);else h!==l?(h===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):h.count--,l===null?mg(d,e.type,e.stateNode):fg(d,l,e.memoizedProps)):l===null&&e.stateNode!==null&&mp(e,e.memoizedProps,a.memoizedProps)}break;case 27:if(l&4&&e.alternate===null){d=e.stateNode,h=e.memoizedProps;try{for(var O=d.firstChild;O;){var V=O.nextSibling,ve=O.nodeName;O[Tt]||ve==="HEAD"||ve==="BODY"||ve==="SCRIPT"||ve==="STYLE"||ve==="LINK"&&O.rel.toLowerCase()==="stylesheet"||d.removeChild(O),O=V}for(var ke=e.type,fe=d.attributes;fe.length;)d.removeAttributeNode(fe[0]);hn(d,ke,h),d[ot]=e,d[Zt]=h}catch(He){jt(e,e.return,He)}}case 5:if(Hn(n,e),Vn(e),l&512&&(Pt||a===null||Nn(a,a.return)),e.flags&32){d=e.stateNode;try{li(d,"")}catch(He){jt(e,e.return,He)}}l&4&&e.stateNode!=null&&(d=e.memoizedProps,mp(e,d,a!==null?a.memoizedProps:d)),l&1024&&(Eu=!0);break;case 6:if(Hn(n,e),Vn(e),l&4){if(e.stateNode===null)throw Error(i(162));l=e.memoizedProps,a=e.stateNode;try{a.nodeValue=l}catch(He){jt(e,e.return,He)}}break;case 3:if(Al=null,d=rs,rs=pl(n.containerInfo),Hn(n,e),rs=d,Vn(e),l&4&&a!==null&&a.memoizedState.isDehydrated)try{Ya(n.containerInfo)}catch(He){jt(e,e.return,He)}Eu&&(Eu=!1,wp(e));break;case 4:l=rs,rs=pl(e.stateNode.containerInfo),Hn(n,e),Vn(e),rs=l;break;case 12:Hn(n,e),Vn(e);break;case 13:Hn(n,e),Vn(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Bu=ue()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,Nu(e,l)));break;case 22:if(l&512&&(Pt||a===null||Nn(a,a.return)),O=e.memoizedState!==null,V=a!==null&&a.memoizedState!==null,ve=Bs,ke=Pt,Bs=ve||O,Pt=ke||V,Hn(n,e),Pt=ke,Bs=ve,Vn(e),n=e.stateNode,n._current=e,n._visibility&=-3,n._visibility|=n._pendingVisibility&2,l&8192&&(n._visibility=O?n._visibility&-2:n._visibility|1,O&&(n=Bs||Pt,a===null||V||n||Ci(e)),e.memoizedProps===null||e.memoizedProps.mode!=="manual"))e:for(a=null,n=e;;){if(n.tag===5||n.tag===26||n.tag===27){if(a===null){V=a=n;try{if(d=V.stateNode,O)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{w=V.stateNode,_=V.memoizedProps.style;var ge=_!=null&&_.hasOwnProperty("display")?_.display:null;w.style.display=ge==null||typeof ge=="boolean"?"":(""+ge).trim()}}catch(He){jt(V,V.return,He)}}}else if(n.tag===6){if(a===null){V=n;try{V.stateNode.nodeValue=O?"":V.memoizedProps}catch(He){jt(V,V.return,He)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}l&4&&(l=e.updateQueue,l!==null&&(a=l.retryQueue,a!==null&&(l.retryQueue=null,Nu(e,a))));break;case 19:Hn(n,e),Vn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,Nu(e,l)));break;case 21:break;default:Hn(n,e),Vn(e)}}function Vn(e){var n=e.flags;if(n&2){try{if(e.tag!==27){e:{for(var a=e.return;a!==null;){if(pp(a)){var l=a;break e}a=a.return}throw Error(i(160))}switch(l.tag){case 27:var d=l.stateNode,h=ju(e);el(e,h,d);break;case 5:var w=l.stateNode;l.flags&32&&(li(w,""),l.flags&=-33);var _=ju(e);el(e,_,w);break;case 3:case 4:var O=l.stateNode.containerInfo,V=ju(e);_u(e,V,O);break;default:throw Error(i(161))}}}catch(ve){jt(e,e.return,ve)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function wp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;wp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function $s(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)yp(e,n.alternate,n),n=n.sibling}function Ci(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:cr(4,n,n.return),Ci(n);break;case 1:Nn(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&fp(n,n.return,a),Ci(n);break;case 26:case 27:case 5:Nn(n,n.return),Ci(n);break;case 22:Nn(n,n.return),n.memoizedState===null&&Ci(n);break;default:Ci(n)}e=e.sibling}}function ur(e,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var l=n.alternate,d=e,h=n,w=h.flags;switch(h.tag){case 0:case 11:case 15:ur(d,h,a),Ea(4,h);break;case 1:if(ur(d,h,a),l=h,d=l.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(V){jt(l,l.return,V)}if(l=h,d=l.updateQueue,d!==null){var _=l.stateNode;try{var O=d.shared.hiddenCallbacks;if(O!==null)for(d.shared.hiddenCallbacks=null,d=0;d<O.length;d++)cp(O[d],_)}catch(V){jt(l,l.return,V)}}a&&w&64&&dp(h),Pr(h,h.return);break;case 26:case 27:case 5:ur(d,h,a),a&&l===null&&w&4&&hp(h),Pr(h,h.return);break;case 12:ur(d,h,a);break;case 13:ur(d,h,a),a&&w&4&&xp(d,h);break;case 22:h.memoizedState===null&&ur(d,h,a),Pr(h,h.return);break;default:ur(d,h,a)}n=n.sibling}}function Tu(e,n){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&ya(a))}function Ru(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&ya(e))}function dr(e,n,a,l){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)kp(e,n,a,l),n=n.sibling}function kp(e,n,a,l){var d=n.flags;switch(n.tag){case 0:case 11:case 15:dr(e,n,a,l),d&2048&&Ea(9,n);break;case 3:dr(e,n,a,l),d&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&ya(e)));break;case 12:if(d&2048){dr(e,n,a,l),e=n.stateNode;try{var h=n.memoizedProps,w=h.id,_=h.onPostCommit;typeof _=="function"&&_(w,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(O){jt(n,n.return,O)}}else dr(e,n,a,l);break;case 23:break;case 22:h=n.stateNode,n.memoizedState!==null?h._visibility&4?dr(e,n,a,l):Na(e,n):h._visibility&4?dr(e,n,a,l):(h._visibility|=4,ji(e,n,a,l,(n.subtreeFlags&10256)!==0)),d&2048&&Tu(n.alternate,n);break;case 24:dr(e,n,a,l),d&2048&&Ru(n.alternate,n);break;default:dr(e,n,a,l)}}function ji(e,n,a,l,d){for(d=d&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var h=e,w=n,_=a,O=l,V=w.flags;switch(w.tag){case 0:case 11:case 15:ji(h,w,_,O,d),Ea(8,w);break;case 23:break;case 22:var ve=w.stateNode;w.memoizedState!==null?ve._visibility&4?ji(h,w,_,O,d):Na(h,w):(ve._visibility|=4,ji(h,w,_,O,d)),d&&V&2048&&Tu(w.alternate,w);break;case 24:ji(h,w,_,O,d),d&&V&2048&&Ru(w.alternate,w);break;default:ji(h,w,_,O,d)}n=n.sibling}}function Na(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=e,l=n,d=l.flags;switch(l.tag){case 22:Na(a,l),d&2048&&Tu(l.alternate,l);break;case 24:Na(a,l),d&2048&&Ru(l.alternate,l);break;default:Na(a,l)}n=n.sibling}}var Ta=8192;function _i(e){if(e.subtreeFlags&Ta)for(e=e.child;e!==null;)Cp(e),e=e.sibling}function Cp(e){switch(e.tag){case 26:_i(e),e.flags&Ta&&e.memoizedState!==null&&Pv(rs,e.memoizedState,e.memoizedProps);break;case 5:_i(e);break;case 3:case 4:var n=rs;rs=pl(e.stateNode.containerInfo),_i(e),rs=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Ta,Ta=16777216,_i(e),Ta=n):_i(e));break;default:_i(e)}}function jp(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Ra(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var l=n[a];an=l,Ep(l,e)}jp(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)_p(e),e=e.sibling}function _p(e){switch(e.tag){case 0:case 11:case 15:Ra(e),e.flags&2048&&cr(9,e,e.return);break;case 3:Ra(e);break;case 12:Ra(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&4&&(e.return===null||e.return.tag!==13)?(n._visibility&=-5,tl(e)):Ra(e);break;default:Ra(e)}}function tl(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var l=n[a];an=l,Ep(l,e)}jp(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:cr(8,n,n.return),tl(n);break;case 22:a=n.stateNode,a._visibility&4&&(a._visibility&=-5,tl(n));break;default:tl(n)}e=e.sibling}}function Ep(e,n){for(;an!==null;){var a=an;switch(a.tag){case 0:case 11:case 15:cr(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var l=a.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:ya(a.memoizedState.cache)}if(l=a.child,l!==null)l.return=a,an=l;else e:for(a=e;an!==null;){l=an;var d=l.sibling,h=l.return;if(vp(l),l===a){an=null;break e}if(d!==null){d.return=h,an=d;break e}an=h}}}function Jy(e,n,a,l){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yn(e,n,a,l){return new Jy(e,n,a,l)}function Mu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fr(e,n){var a=e.alternate;return a===null?(a=Yn(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&31457280,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Np(e,n){e.flags&=31457282;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,n=a.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function nl(e,n,a,l,d,h){var w=0;if(l=e,typeof e=="function")Mu(e)&&(w=1);else if(typeof e=="string")w=Uv(e,a,he.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case v:return $r(a.children,d,h,n);case x:w=8,d|=24;break;case A:return e=Yn(12,a,n,d|2),e.elementType=A,e.lanes=h,e;case U:return e=Yn(13,a,n,d),e.elementType=U,e.lanes=h,e;case D:return e=Yn(19,a,n,d),e.elementType=D,e.lanes=h,e;case te:return Tp(a,d,h,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case S:case C:w=10;break e;case j:w=9;break e;case M:w=11;break e;case ne:w=14;break e;case K:w=16,l=null;break e}w=29,a=Error(i(130,e===null?"null":typeof e,"")),l=null}return n=Yn(w,a,n,d),n.elementType=e,n.type=l,n.lanes=h,n}function $r(e,n,a,l){return e=Yn(7,e,l,n),e.lanes=a,e}function Tp(e,n,a,l){e=Yn(22,e,l,n),e.elementType=te,e.lanes=a;var d={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var h=d._current;if(h===null)throw Error(i(456));if((d._pendingVisibility&2)===0){var w=er(h,2);w!==null&&(d._pendingVisibility|=2,bn(w,h,2))}},attach:function(){var h=d._current;if(h===null)throw Error(i(456));if((d._pendingVisibility&2)!==0){var w=er(h,2);w!==null&&(d._pendingVisibility&=-3,bn(w,h,2))}}};return e.stateNode=d,e}function Ou(e,n,a){return e=Yn(6,e,null,n),e.lanes=a,e}function Du(e,n,a){return n=Yn(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function qs(e){e.flags|=4}function Rp(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!pg(n)){if(n=Fn.current,n!==null&&((gt&4194176)===gt?fs!==null:(gt&62914560)!==gt&&(gt&536870912)===0||n!==fs))throw pa=Pc,Xh;e.flags|=8192}}function sl(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Ks():536870912,e.lanes|=n,Ni|=n)}function Ma(e,n){if(!yt)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Dt(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,l=0;if(n)for(var d=e.child;d!==null;)a|=d.lanes|d.childLanes,l|=d.subtreeFlags&31457280,l|=d.flags&31457280,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)a|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=l,e.childLanes=a,n}function Wy(e,n,a){var l=n.pendingProps;switch(Uc(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dt(n),null;case 1:return Dt(n),null;case 3:return a=n.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),Us(Wt),Ne(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(da(n)?qs(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,ss!==null&&(Iu(ss),ss=null))),Dt(n),null;case 26:return a=n.memoizedState,e===null?(qs(n),a!==null?(Dt(n),Rp(n,a)):(Dt(n),n.flags&=-16777217)):a?a!==e.memoizedState?(qs(n),Dt(n),Rp(n,a)):(Dt(n),n.flags&=-16777217):(e.memoizedProps!==l&&qs(n),Dt(n),n.flags&=-16777217),null;case 27:Ge(n),a=G.current;var d=n.type;if(e!==null&&n.stateNode!=null)e.memoizedProps!==l&&qs(n);else{if(!l){if(n.stateNode===null)throw Error(i(166));return Dt(n),null}e=he.current,da(n)?Yh(n):(e=og(d,l,a),n.stateNode=e,qs(n))}return Dt(n),null;case 5:if(Ge(n),a=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==l&&qs(n);else{if(!l){if(n.stateNode===null)throw Error(i(166));return Dt(n),null}if(e=he.current,da(n))Yh(n);else{switch(d=ml(G.current),e){case 1:e=d.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=d.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=d.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=d.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof l.is=="string"?d.createElement("select",{is:l.is}):d.createElement("select"),l.multiple?e.multiple=!0:l.size&&(e.size=l.size);break;default:e=typeof l.is=="string"?d.createElement(a,{is:l.is}):d.createElement(a)}}e[ot]=n,e[Zt]=l;e:for(d=n.child;d!==null;){if(d.tag===5||d.tag===6)e.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}n.stateNode=e;e:switch(hn(e,a,l),a){case"button":case"input":case"select":case"textarea":e=!!l.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&qs(n)}}return Dt(n),n.flags&=-16777217,null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==l&&qs(n);else{if(typeof l!="string"&&n.stateNode===null)throw Error(i(166));if(e=G.current,da(n)){if(e=n.stateNode,a=n.memoizedProps,l=null,d=vn,d!==null)switch(d.tag){case 27:case 5:l=d.memoizedProps}e[ot]=n,e=!!(e.nodeValue===a||l!==null&&l.suppressHydrationWarning===!0||tg(e.nodeValue,a)),e||Tr(n)}else e=ml(e).createTextNode(l),e[ot]=n,n.stateNode=e}return Dt(n),null;case 13:if(l=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(d=da(n),l!==null&&l.dehydrated!==null){if(e===null){if(!d)throw Error(i(318));if(d=n.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));d[ot]=n}else fa(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Dt(n),d=!1}else ss!==null&&(Iu(ss),ss=null),d=!0;if(!d)return n.flags&256?(Os(n),n):(Os(n),null)}if(Os(n),(n.flags&128)!==0)return n.lanes=a,n;if(a=l!==null,e=e!==null&&e.memoizedState!==null,a){l=n.child,d=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(d=l.alternate.memoizedState.cachePool.pool);var h=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(h=l.memoizedState.cachePool.pool),h!==d&&(l.flags|=2048)}return a!==e&&a&&(n.child.flags|=8192),sl(n,n.updateQueue),Dt(n),null;case 4:return Ne(),e===null&&Wu(n.stateNode.containerInfo),Dt(n),null;case 10:return Us(n.type),Dt(n),null;case 19:if(Ue(Jt),d=n.memoizedState,d===null)return Dt(n),null;if(l=(n.flags&128)!==0,h=d.rendering,h===null)if(l)Ma(d,!1);else{if($t!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(h=$o(e),h!==null){for(n.flags|=128,Ma(d,!1),e=h.updateQueue,n.updateQueue=e,sl(n,e),n.subtreeFlags=0,e=a,a=n.child;a!==null;)Np(a,e),a=a.sibling;return Le(Jt,Jt.current&1|2),n.child}e=e.sibling}d.tail!==null&&ue()>rl&&(n.flags|=128,l=!0,Ma(d,!1),n.lanes=4194304)}else{if(!l)if(e=$o(h),e!==null){if(n.flags|=128,l=!0,e=e.updateQueue,n.updateQueue=e,sl(n,e),Ma(d,!0),d.tail===null&&d.tailMode==="hidden"&&!h.alternate&&!yt)return Dt(n),null}else 2*ue()-d.renderingStartTime>rl&&a!==536870912&&(n.flags|=128,l=!0,Ma(d,!1),n.lanes=4194304);d.isBackwards?(h.sibling=n.child,n.child=h):(e=d.last,e!==null?e.sibling=h:n.child=h,d.last=h)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=ue(),n.sibling=null,e=Jt.current,Le(Jt,l?e&1|2:e&1),n):(Dt(n),null);case 22:case 23:return Os(n),qc(),l=n.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(n.flags|=8192):l&&(n.flags|=8192),l?(a&536870912)!==0&&(n.flags&128)===0&&(Dt(n),n.subtreeFlags&6&&(n.flags|=8192)):Dt(n),a=n.updateQueue,a!==null&&sl(n,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),l=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),l!==a&&(n.flags|=2048),e!==null&&Ue(Mr),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),Us(Wt),Dt(n),null;case 25:return null}throw Error(i(156,n.tag))}function ev(e,n){switch(Uc(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Us(Wt),Ne(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return Ge(n),null;case 13:if(Os(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(i(340));fa()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Ue(Jt),null;case 4:return Ne(),null;case 10:return Us(n.type),null;case 22:case 23:return Os(n),qc(),e!==null&&Ue(Mr),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Us(Wt),null;case 25:return null;default:return null}}function Mp(e,n){switch(Uc(n),n.tag){case 3:Us(Wt),Ne();break;case 26:case 27:case 5:Ge(n);break;case 4:Ne();break;case 13:Os(n);break;case 19:Ue(Jt);break;case 10:Us(n.type);break;case 22:case 23:Os(n),qc(),e!==null&&Ue(Mr);break;case 24:Us(Wt)}}var tv={getCacheForType:function(e){var n=pn(Wt),a=n.data.get(e);return a===void 0&&(a=e(),n.data.set(e,a)),a}},nv=typeof WeakMap=="function"?WeakMap:Map,Lt=0,_t=null,ct=null,gt=0,Et=0,Rn=null,Is=!1,Ei=!1,Lu=!1,Fs=0,$t=0,hr=0,qr=0,zu=0,Gn=0,Ni=0,Oa=null,ms=null,Uu=!1,Bu=0,rl=1/0,il=null,mr=null,al=!1,Ir=null,Da=0,Pu=0,$u=null,La=0,qu=null;function Mn(){if((Lt&2)!==0&&gt!==0)return gt&-gt;if(z.T!==null){var e=bi;return e!==0?e:Qu()}return Ze()}function Op(){Gn===0&&(Gn=(gt&536870912)===0||yt?Qs():536870912);var e=Fn.current;return e!==null&&(e.flags|=32),Gn}function bn(e,n,a){(e===_t&&Et===2||e.cancelPendingCommit!==null)&&(Ti(e,0),Hs(e,gt,Gn,!1)),es(e,a),((Lt&2)===0||e!==_t)&&(e===_t&&((Lt&2)===0&&(qr|=a),$t===4&&Hs(e,gt,Gn,!1)),ps(e))}function Dp(e,n,a){if((Lt&6)!==0)throw Error(i(327));var l=!a&&(n&60)===0&&(n&e.expiredLanes)===0||Wn(e,n),d=l?iv(e,n):Vu(e,n,!0),h=l;do{if(d===0){Ei&&!l&&Hs(e,n,0,!1);break}else if(d===6)Hs(e,n,0,!Is);else{if(a=e.current.alternate,h&&!sv(a)){d=Vu(e,n,!1),h=!1;continue}if(d===2){if(h=n,e.errorRecoveryDisabledLanes&h)var w=0;else w=e.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){n=w;e:{var _=e;d=Oa;var O=_.current.memoizedState.isDehydrated;if(O&&(Ti(_,w).flags|=256),w=Vu(_,w,!1),w!==2){if(Lu&&!O){_.errorRecoveryDisabledLanes|=h,qr|=h,d=4;break e}h=ms,ms=d,h!==null&&Iu(h)}d=w}if(h=!1,d!==2)continue}}if(d===1){Ti(e,0),Hs(e,n,0,!0);break}e:{switch(l=e,d){case 0:case 1:throw Error(i(345));case 4:if((n&4194176)===n){Hs(l,n,Gn,!Is);break e}break;case 2:ms=null;break;case 3:case 5:break;default:throw Error(i(329))}if(l.finishedWork=a,l.finishedLanes=n,(n&62914560)===n&&(h=Bu+300-ue(),10<h)){if(Hs(l,n,Gn,!Is),js(l,0)!==0)break e;l.timeoutHandle=rg(Lp.bind(null,l,a,ms,il,Uu,n,Gn,qr,Ni,Is,2,-0,0),h);break e}Lp(l,a,ms,il,Uu,n,Gn,qr,Ni,Is,0,-0,0)}}break}while(!0);ps(e)}function Iu(e){ms===null?ms=e:ms.push.apply(ms,e)}function Lp(e,n,a,l,d,h,w,_,O,V,ve,ke,fe){var ge=n.subtreeFlags;if((ge&8192||(ge&16785408)===16785408)&&(qa={stylesheets:null,count:0,unsuspend:Bv},Cp(n),n=$v(),n!==null)){e.cancelPendingCommit=n(Ip.bind(null,e,a,l,d,w,_,O,1,ke,fe)),Hs(e,h,w,!V);return}Ip(e,a,l,d,w,_,O,ve,ke,fe)}function sv(e){for(var n=e;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var l=0;l<a.length;l++){var d=a[l],h=d.getSnapshot;d=d.value;try{if(!En(h(),d))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Hs(e,n,a,l){n&=~zu,n&=~qr,e.suspendedLanes|=n,e.pingedLanes&=~n,l&&(e.warmLanes|=n),l=e.expirationTimes;for(var d=n;0<d;){var h=31-Be(d),w=1<<h;l[h]=-1,d&=~w}a!==0&&Zs(e,a,n)}function ol(){return(Lt&6)===0?(za(0),!1):!0}function Fu(){if(ct!==null){if(Et===0)var e=ct.return;else e=ct,zs=Ur=null,Qc(e),yi=null,ga=0,e=ct;for(;e!==null;)Mp(e.alternate,e),e=e.return;ct=null}}function Ti(e,n){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Sv(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Fu(),_t=e,ct=a=fr(e.current,null),gt=n,Et=0,Rn=null,Is=!1,Ei=Wn(e,n),Lu=!1,Ni=Gn=zu=qr=hr=$t=0,ms=Oa=null,Uu=!1,(n&8)!==0&&(n|=n&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=n;0<l;){var d=31-Be(l),h=1<<d;n|=e[d],l&=~h}return Fs=n,Ro(),a}function zp(e,n){it=null,z.H=hs,n===ma?(n=Zh(),Et=3):n===Xh?(n=Zh(),Et=4):Et=n===Qm?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Rn=n,ct===null&&($t=1,Zo(e,$n(n,e.current)))}function Up(){var e=z.H;return z.H=hs,e===null?hs:e}function Bp(){var e=z.A;return z.A=tv,e}function Hu(){$t=4,Is||(gt&4194176)!==gt&&Fn.current!==null||(Ei=!0),(hr&134217727)===0&&(qr&134217727)===0||_t===null||Hs(_t,gt,Gn,!1)}function Vu(e,n,a){var l=Lt;Lt|=2;var d=Up(),h=Bp();(_t!==e||gt!==n)&&(il=null,Ti(e,n)),n=!1;var w=$t;e:do try{if(Et!==0&&ct!==null){var _=ct,O=Rn;switch(Et){case 8:Fu(),w=6;break e;case 3:case 2:case 6:Fn.current===null&&(n=!0);var V=Et;if(Et=0,Rn=null,Ri(e,_,O,V),a&&Ei){w=0;break e}break;default:V=Et,Et=0,Rn=null,Ri(e,_,O,V)}}rv(),w=$t;break}catch(ve){zp(e,ve)}while(!0);return n&&e.shellSuspendCounter++,zs=Ur=null,Lt=l,z.H=d,z.A=h,ct===null&&(_t=null,gt=0,Ro()),w}function rv(){for(;ct!==null;)Pp(ct)}function iv(e,n){var a=Lt;Lt|=2;var l=Up(),d=Bp();_t!==e||gt!==n?(il=null,rl=ue()+500,Ti(e,n)):Ei=Wn(e,n);e:do try{if(Et!==0&&ct!==null){n=ct;var h=Rn;t:switch(Et){case 1:Et=0,Rn=null,Ri(e,n,h,1);break;case 2:if(Qh(h)){Et=0,Rn=null,$p(n);break}n=function(){Et===2&&_t===e&&(Et=7),ps(e)},h.then(n,n);break e;case 3:Et=7;break e;case 4:Et=5;break e;case 7:Qh(h)?(Et=0,Rn=null,$p(n)):(Et=0,Rn=null,Ri(e,n,h,7));break;case 5:var w=null;switch(ct.tag){case 26:w=ct.memoizedState;case 5:case 27:var _=ct;if(!w||pg(w)){Et=0,Rn=null;var O=_.sibling;if(O!==null)ct=O;else{var V=_.return;V!==null?(ct=V,ll(V)):ct=null}break t}}Et=0,Rn=null,Ri(e,n,h,5);break;case 6:Et=0,Rn=null,Ri(e,n,h,6);break;case 8:Fu(),$t=6;break e;default:throw Error(i(462))}}av();break}catch(ve){zp(e,ve)}while(!0);return zs=Ur=null,z.H=l,z.A=d,Lt=a,ct!==null?0:(_t=null,gt=0,Ro(),$t)}function av(){for(;ct!==null&&!Nt();)Pp(ct)}function Pp(e){var n=op(e.alternate,e,Fs);e.memoizedProps=e.pendingProps,n===null?ll(e):ct=n}function $p(e){var n=e,a=n.alternate;switch(n.tag){case 15:case 0:n=tp(a,n,n.pendingProps,n.type,void 0,gt);break;case 11:n=tp(a,n,n.pendingProps,n.type.render,n.ref,gt);break;case 5:Qc(n);default:Mp(a,n),n=ct=Np(n,Fs),n=op(a,n,Fs)}e.memoizedProps=e.pendingProps,n===null?ll(e):ct=n}function Ri(e,n,a,l){zs=Ur=null,Qc(n),yi=null,ga=0;var d=n.return;try{if(Xy(e,d,n,a,gt)){$t=1,Zo(e,$n(a,e.current)),ct=null;return}}catch(h){if(d!==null)throw ct=d,h;$t=1,Zo(e,$n(a,e.current)),ct=null;return}n.flags&32768?(yt||l===1?e=!0:Ei||(gt&536870912)!==0?e=!1:(Is=e=!0,(l===2||l===3||l===6)&&(l=Fn.current,l!==null&&l.tag===13&&(l.flags|=16384))),qp(n,e)):ll(n)}function ll(e){var n=e;do{if((n.flags&32768)!==0){qp(n,Is);return}e=n.return;var a=Wy(n.alternate,n,Fs);if(a!==null){ct=a;return}if(n=n.sibling,n!==null){ct=n;return}ct=n=e}while(n!==null);$t===0&&($t=5)}function qp(e,n){do{var a=ev(e.alternate,e);if(a!==null){a.flags&=32767,ct=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(e=e.sibling,e!==null)){ct=e;return}ct=e=a}while(e!==null);$t=6,ct=null}function Ip(e,n,a,l,d,h,w,_,O,V){var ve=z.T,ke=Z.p;try{Z.p=2,z.T=null,ov(e,n,a,l,ke,d,h,w,_,O,V)}finally{z.T=ve,Z.p=ke}}function ov(e,n,a,l,d,h,w,_){do Mi();while(Ir!==null);if((Lt&6)!==0)throw Error(i(327));var O=e.finishedWork;if(l=e.finishedLanes,O===null)return null;if(e.finishedWork=null,e.finishedLanes=0,O===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var V=O.lanes|O.childLanes;if(V|=Dc,wr(e,l,V,h,w,_),e===_t&&(ct=_t=null,gt=0),(O.subtreeFlags&10256)===0&&(O.flags&10256)===0||al||(al=!0,Pu=V,$u=a,dv(Ee,function(){return Mi(),null})),a=(O.flags&15990)!==0,(O.subtreeFlags&15990)!==0||a?(a=z.T,z.T=null,h=Z.p,Z.p=2,w=Lt,Lt|=4,Ky(e,O),Sp(O,e),Ry(sd,e.containerInfo),bl=!!nd,sd=nd=null,e.current=O,yp(e,O.alternate,O),Mt(),Lt=w,Z.p=h,z.T=a):e.current=O,al?(al=!1,Ir=e,Da=l):Fp(e,V),V=e.pendingLanes,V===0&&(mr=null),$(O.stateNode),ps(e),n!==null)for(d=e.onRecoverableError,O=0;O<n.length;O++)V=n[O],d(V.value,{componentStack:V.stack});return(Da&3)!==0&&Mi(),V=e.pendingLanes,(l&4194218)!==0&&(V&42)!==0?e===qu?La++:(La=0,qu=e):La=0,za(0),null}function Fp(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,ya(n)))}function Mi(){if(Ir!==null){var e=Ir,n=Pu;Pu=0;var a=Ve(Da),l=z.T,d=Z.p;try{if(Z.p=32>a?32:a,z.T=null,Ir===null)var h=!1;else{a=$u,$u=null;var w=Ir,_=Da;if(Ir=null,Da=0,(Lt&6)!==0)throw Error(i(331));var O=Lt;if(Lt|=4,_p(w.current),kp(w,w.current,_,a),Lt=O,za(0,!1),N&&typeof N.onPostCommitFiberRoot=="function")try{N.onPostCommitFiberRoot(k,w)}catch{}h=!0}return h}finally{Z.p=d,z.T=l,Fp(e,n)}}return!1}function Hp(e,n,a){n=$n(a,n),n=cu(e.stateNode,n,2),e=lr(e,n,2),e!==null&&(es(e,2),ps(e))}function jt(e,n,a){if(e.tag===3)Hp(e,e,a);else for(;n!==null;){if(n.tag===3){Hp(n,e,a);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(mr===null||!mr.has(l))){e=$n(a,e),a=Gm(2),l=lr(n,a,2),l!==null&&(Xm(a,l,n,e),es(l,2),ps(l));break}}n=n.return}}function Yu(e,n,a){var l=e.pingCache;if(l===null){l=e.pingCache=new nv;var d=new Set;l.set(n,d)}else d=l.get(n),d===void 0&&(d=new Set,l.set(n,d));d.has(a)||(Lu=!0,d.add(a),e=lv.bind(null,e,n,a),n.then(e,e))}function lv(e,n,a){var l=e.pingCache;l!==null&&l.delete(n),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,_t===e&&(gt&a)===a&&($t===4||$t===3&&(gt&62914560)===gt&&300>ue()-Bu?(Lt&2)===0&&Ti(e,0):zu|=a,Ni===gt&&(Ni=0)),ps(e)}function Vp(e,n){n===0&&(n=Ks()),e=er(e,n),e!==null&&(es(e,n),ps(e))}function cv(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),Vp(e,a)}function uv(e,n){var a=0;switch(e.tag){case 13:var l=e.stateNode,d=e.memoizedState;d!==null&&(a=d.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(i(314))}l!==null&&l.delete(n),Vp(e,a)}function dv(e,n){return ut(e,n)}var cl=null,Oi=null,Gu=!1,ul=!1,Xu=!1,Fr=0;function ps(e){e!==Oi&&e.next===null&&(Oi===null?cl=Oi=e:Oi=Oi.next=e),ul=!0,Gu||(Gu=!0,hv(fv))}function za(e,n){if(!Xu&&ul){Xu=!0;do for(var a=!1,l=cl;l!==null;){if(e!==0){var d=l.pendingLanes;if(d===0)var h=0;else{var w=l.suspendedLanes,_=l.pingedLanes;h=(1<<31-Be(42|e)+1)-1,h&=d&~(w&~_),h=h&201326677?h&201326677|1:h?h|2:0}h!==0&&(a=!0,Xp(l,h))}else h=gt,h=js(l,l===_t?h:0),(h&3)===0||Wn(l,h)||(a=!0,Xp(l,h));l=l.next}while(a);Xu=!1}}function fv(){ul=Gu=!1;var e=0;Fr!==0&&(xv()&&(e=Fr),Fr=0);for(var n=ue(),a=null,l=cl;l!==null;){var d=l.next,h=Yp(l,n);h===0?(l.next=null,a===null?cl=d:a.next=d,d===null&&(Oi=a)):(a=l,(e!==0||(h&3)!==0)&&(ul=!0)),l=d}za(e)}function Yp(e,n){for(var a=e.suspendedLanes,l=e.pingedLanes,d=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var w=31-Be(h),_=1<<w,O=d[w];O===-1?((_&a)===0||(_&l)!==0)&&(d[w]=Sr(_,n)):O<=n&&(e.expiredLanes|=_),h&=~_}if(n=_t,a=gt,a=js(e,e===n?a:0),l=e.callbackNode,a===0||e===n&&Et===2||e.cancelPendingCommit!==null)return l!==null&&l!==null&&St(l),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Wn(e,a)){if(n=a&-a,n===e.callbackPriority)return n;switch(l!==null&&St(l),Ve(a)){case 2:case 8:a=se;break;case 32:a=Ee;break;case 268435456:a=b;break;default:a=Ee}return l=Gp.bind(null,e),a=ut(a,l),e.callbackPriority=n,e.callbackNode=a,n}return l!==null&&l!==null&&St(l),e.callbackPriority=2,e.callbackNode=null,2}function Gp(e,n){var a=e.callbackNode;if(Mi()&&e.callbackNode!==a)return null;var l=gt;return l=js(e,e===_t?l:0),l===0?null:(Dp(e,l,n),Yp(e,ue()),e.callbackNode!=null&&e.callbackNode===a?Gp.bind(null,e):null)}function Xp(e,n){if(Mi())return null;Dp(e,n,!0)}function hv(e){wv(function(){(Lt&6)!==0?ut(De,e):e()})}function Qu(){return Fr===0&&(Fr=Qs()),Fr}function Qp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ko(""+e)}function Kp(e,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,e.id&&a.setAttribute("form",e.id),n.parentNode.insertBefore(a,n),e=new FormData(e),a.parentNode.removeChild(a),e}function mv(e,n,a,l,d){if(n==="submit"&&a&&a.stateNode===d){var h=Qp((d[Zt]||null).action),w=l.submitter;w&&(n=(n=w[Zt]||null)?Qp(n.formAction):w.getAttribute("formAction"),n!==null&&(h=n,w=null));var _=new Eo("action","action",null,l,d);e.push({event:_,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Fr!==0){var O=w?Kp(d,w):new FormData(d);ru(a,{pending:!0,data:O,method:d.method,action:h},null,O)}}else typeof h=="function"&&(_.preventDefault(),O=w?Kp(d,w):new FormData(d),ru(a,{pending:!0,data:O,method:d.method,action:h},h,O))},currentTarget:d}]})}}for(var Ku=0;Ku<Ih.length;Ku++){var Zu=Ih[Ku],pv=Zu.toLowerCase(),gv=Zu[0].toUpperCase()+Zu.slice(1);ns(pv,"on"+gv)}ns(Uh,"onAnimationEnd"),ns(Bh,"onAnimationIteration"),ns(Ph,"onAnimationStart"),ns("dblclick","onDoubleClick"),ns("focusin","onFocus"),ns("focusout","onBlur"),ns(Oy,"onTransitionRun"),ns(Dy,"onTransitionStart"),ns(Ly,"onTransitionCancel"),ns($h,"onTransitionEnd"),ai("onMouseEnter",["mouseout","mouseover"]),ai("onMouseLeave",["mouseout","mouseover"]),ai("onPointerEnter",["pointerout","pointerover"]),ai("onPointerLeave",["pointerout","pointerover"]),kr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),kr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),kr("onBeforeInput",["compositionend","keypress","textInput","paste"]),kr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),kr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),kr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ua="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Av=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ua));function Zp(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var l=e[a],d=l.event;l=l.listeners;e:{var h=void 0;if(n)for(var w=l.length-1;0<=w;w--){var _=l[w],O=_.instance,V=_.currentTarget;if(_=_.listener,O!==h&&d.isPropagationStopped())break e;h=_,d.currentTarget=V;try{h(d)}catch(ve){Ko(ve)}d.currentTarget=null,h=O}else for(w=0;w<l.length;w++){if(_=l[w],O=_.instance,V=_.currentTarget,_=_.listener,O!==h&&d.isPropagationStopped())break e;h=_,d.currentTarget=V;try{h(d)}catch(ve){Ko(ve)}d.currentTarget=null,h=O}}}}function ft(e,n){var a=n[Es];a===void 0&&(a=n[Es]=new Set);var l=e+"__bubble";a.has(l)||(Jp(n,e,2,!1),a.add(l))}function Ju(e,n,a){var l=0;n&&(l|=4),Jp(a,e,l,n)}var dl="_reactListening"+Math.random().toString(36).slice(2);function Wu(e){if(!e[dl]){e[dl]=!0,th.forEach(function(a){a!=="selectionchange"&&(Av.has(a)||Ju(a,!1,e),Ju(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[dl]||(n[dl]=!0,Ju("selectionchange",!1,n))}}function Jp(e,n,a,l){switch(xg(n)){case 2:var d=Fv;break;case 8:d=Hv;break;default:d=fd}a=d.bind(null,n,a,e),d=void 0,!xc||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),l?d!==void 0?e.addEventListener(n,a,{capture:!0,passive:d}):e.addEventListener(n,a,!0):d!==void 0?e.addEventListener(n,a,{passive:d}):e.addEventListener(n,a,!1)}function ed(e,n,a,l,d){var h=l;if((n&1)===0&&(n&2)===0&&l!==null)e:for(;;){if(l===null)return;var w=l.tag;if(w===3||w===4){var _=l.stateNode.containerInfo;if(_===d||_.nodeType===8&&_.parentNode===d)break;if(w===4)for(w=l.return;w!==null;){var O=w.tag;if((O===3||O===4)&&(O=w.stateNode.containerInfo,O===d||O.nodeType===8&&O.parentNode===d))return;w=w.return}for(;_!==null;){if(w=un(_),w===null)return;if(O=w.tag,O===5||O===6||O===26||O===27){l=h=w;continue e}_=_.parentNode}}l=l.return}hh(function(){var V=h,ve=vc(a),ke=[];e:{var fe=qh.get(e);if(fe!==void 0){var ge=Eo,He=e;switch(e){case"keypress":if(jo(a)===0)break e;case"keydown":case"keyup":ge=uy;break;case"focusin":He="focus",ge=Cc;break;case"focusout":He="blur",ge=Cc;break;case"beforeblur":case"afterblur":ge=Cc;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=gh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=J1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=hy;break;case Uh:case Bh:case Ph:ge=ty;break;case $h:ge=py;break;case"scroll":case"scrollend":ge=K1;break;case"wheel":ge=Ay;break;case"copy":case"cut":case"paste":ge=sy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=yh;break;case"toggle":case"beforetoggle":ge=vy}var Je=(n&4)!==0,qt=!Je&&(e==="scroll"||e==="scrollend"),ee=Je?fe!==null?fe+"Capture":null:fe;Je=[];for(var F=V,le;F!==null;){var xe=F;if(le=xe.stateNode,xe=xe.tag,xe!==5&&xe!==26&&xe!==27||le===null||ee===null||(xe=na(F,ee),xe!=null&&Je.push(Ba(F,xe,le))),qt)break;F=F.return}0<Je.length&&(fe=new ge(fe,He,null,a,ve),ke.push({event:fe,listeners:Je}))}}if((n&7)===0){e:{if(fe=e==="mouseover"||e==="pointerover",ge=e==="mouseout"||e==="pointerout",fe&&a!==yc&&(He=a.relatedTarget||a.fromElement)&&(un(He)||He[ts]))break e;if((ge||fe)&&(fe=ve.window===ve?ve:(fe=ve.ownerDocument)?fe.defaultView||fe.parentWindow:window,ge?(He=a.relatedTarget||a.toElement,ge=V,He=He?un(He):null,He!==null&&(qt=Y(He),Je=He.tag,He!==qt||Je!==5&&Je!==27&&Je!==6)&&(He=null)):(ge=null,He=V),ge!==He)){if(Je=gh,xe="onMouseLeave",ee="onMouseEnter",F="mouse",(e==="pointerout"||e==="pointerover")&&(Je=yh,xe="onPointerLeave",ee="onPointerEnter",F="pointer"),qt=ge==null?fe:ta(ge),le=He==null?fe:ta(He),fe=new Je(xe,F+"leave",ge,a,ve),fe.target=qt,fe.relatedTarget=le,xe=null,un(ve)===V&&(Je=new Je(ee,F+"enter",He,a,ve),Je.target=le,Je.relatedTarget=qt,xe=Je),qt=xe,ge&&He)t:{for(Je=ge,ee=He,F=0,le=Je;le;le=Di(le))F++;for(le=0,xe=ee;xe;xe=Di(xe))le++;for(;0<F-le;)Je=Di(Je),F--;for(;0<le-F;)ee=Di(ee),le--;for(;F--;){if(Je===ee||ee!==null&&Je===ee.alternate)break t;Je=Di(Je),ee=Di(ee)}Je=null}else Je=null;ge!==null&&Wp(ke,fe,ge,Je,!1),He!==null&&qt!==null&&Wp(ke,qt,He,Je,!0)}}e:{if(fe=V?ta(V):window,ge=fe.nodeName&&fe.nodeName.toLowerCase(),ge==="select"||ge==="input"&&fe.type==="file")var $e=jh;else if(kh(fe))if(_h)$e=Ny;else{$e=_y;var lt=jy}else ge=fe.nodeName,!ge||ge.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?V&&Ac(V.elementType)&&($e=jh):$e=Ey;if($e&&($e=$e(e,V))){Ch(ke,$e,a,ve);break e}lt&&lt(e,fe,V),e==="focusout"&&V&&fe.type==="number"&&V.memoizedProps.value!=null&&gc(fe,"number",fe.value)}switch(lt=V?ta(V):window,e){case"focusin":(kh(lt)||lt.contentEditable==="true")&&(fi=lt,Rc=V,ua=null);break;case"focusout":ua=Rc=fi=null;break;case"mousedown":Mc=!0;break;case"contextmenu":case"mouseup":case"dragend":Mc=!1,Lh(ke,a,ve);break;case"selectionchange":if(My)break;case"keydown":case"keyup":Lh(ke,a,ve)}var Ye;if(_c)e:{switch(e){case"compositionstart":var Xe="onCompositionStart";break e;case"compositionend":Xe="onCompositionEnd";break e;case"compositionupdate":Xe="onCompositionUpdate";break e}Xe=void 0}else di?Sh(e,a)&&(Xe="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Xe="onCompositionStart");Xe&&(vh&&a.locale!=="ko"&&(di||Xe!=="onCompositionStart"?Xe==="onCompositionEnd"&&di&&(Ye=mh()):(Ws=ve,Sc="value"in Ws?Ws.value:Ws.textContent,di=!0)),lt=fl(V,Xe),0<lt.length&&(Xe=new Ah(Xe,e,null,a,ve),ke.push({event:Xe,listeners:lt}),Ye?Xe.data=Ye:(Ye=wh(a),Ye!==null&&(Xe.data=Ye)))),(Ye=xy?Sy(e,a):wy(e,a))&&(Xe=fl(V,"onBeforeInput"),0<Xe.length&&(lt=new Ah("onBeforeInput","beforeinput",null,a,ve),ke.push({event:lt,listeners:Xe}),lt.data=Ye)),mv(ke,e,V,a,ve)}Zp(ke,n)})}function Ba(e,n,a){return{instance:e,listener:n,currentTarget:a}}function fl(e,n){for(var a=n+"Capture",l=[];e!==null;){var d=e,h=d.stateNode;d=d.tag,d!==5&&d!==26&&d!==27||h===null||(d=na(e,a),d!=null&&l.unshift(Ba(e,d,h)),d=na(e,n),d!=null&&l.push(Ba(e,d,h))),e=e.return}return l}function Di(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Wp(e,n,a,l,d){for(var h=n._reactName,w=[];a!==null&&a!==l;){var _=a,O=_.alternate,V=_.stateNode;if(_=_.tag,O!==null&&O===l)break;_!==5&&_!==26&&_!==27||V===null||(O=V,d?(V=na(a,h),V!=null&&w.unshift(Ba(a,V,O))):d||(V=na(a,h),V!=null&&w.push(Ba(a,V,O)))),a=a.return}w.length!==0&&e.push({event:n,listeners:w})}var yv=/\r\n?/g,vv=/\u0000|\uFFFD/g;function eg(e){return(typeof e=="string"?e:""+e).replace(yv,`
`).replace(vv,"")}function tg(e,n){return n=eg(n),eg(e)===n}function hl(){}function Ct(e,n,a,l,d,h){switch(a){case"children":typeof l=="string"?n==="body"||n==="textarea"&&l===""||li(e,l):(typeof l=="number"||typeof l=="bigint")&&n!=="body"&&li(e,""+l);break;case"className":xo(e,"class",l);break;case"tabIndex":xo(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":xo(e,a,l);break;case"style":dh(e,l,h);break;case"data":if(n!=="object"){xo(e,"data",l);break}case"src":case"href":if(l===""&&(n!=="a"||a!=="href")){e.removeAttribute(a);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(a);break}l=ko(""+l),e.setAttribute(a,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(a==="formAction"?(n!=="input"&&Ct(e,n,"name",d.name,d,null),Ct(e,n,"formEncType",d.formEncType,d,null),Ct(e,n,"formMethod",d.formMethod,d,null),Ct(e,n,"formTarget",d.formTarget,d,null)):(Ct(e,n,"encType",d.encType,d,null),Ct(e,n,"method",d.method,d,null),Ct(e,n,"target",d.target,d,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(a);break}l=ko(""+l),e.setAttribute(a,l);break;case"onClick":l!=null&&(e.onclick=hl);break;case"onScroll":l!=null&&ft("scroll",e);break;case"onScrollEnd":l!=null&&ft("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(i(61));if(a=l.__html,a!=null){if(d.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}a=ko(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(a,""+l):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":l===!0?e.setAttribute(a,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(a,l):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(a,l):e.removeAttribute(a);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(a):e.setAttribute(a,l);break;case"popover":ft("beforetoggle",e),ft("toggle",e),bo(e,"popover",l);break;case"xlinkActuate":Ts(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":Ts(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":Ts(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":Ts(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":Ts(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":Ts(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":Ts(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":Ts(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":Ts(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":bo(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=X1.get(a)||a,bo(e,a,l))}}function td(e,n,a,l,d,h){switch(a){case"style":dh(e,l,h);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(i(61));if(a=l.__html,a!=null){if(d.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"children":typeof l=="string"?li(e,l):(typeof l=="number"||typeof l=="bigint")&&li(e,""+l);break;case"onScroll":l!=null&&ft("scroll",e);break;case"onScrollEnd":l!=null&&ft("scrollend",e);break;case"onClick":l!=null&&(e.onclick=hl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!nh.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(d=a.endsWith("Capture"),n=a.slice(2,d?a.length-7:void 0),h=e[Zt]||null,h=h!=null?h[a]:null,typeof h=="function"&&e.removeEventListener(n,h,d),typeof l=="function")){typeof h!="function"&&h!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(n,l,d);break e}a in e?e[a]=l:l===!0?e.setAttribute(a,""):bo(e,a,l)}}}function hn(e,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ft("error",e),ft("load",e);var l=!1,d=!1,h;for(h in a)if(a.hasOwnProperty(h)){var w=a[h];if(w!=null)switch(h){case"src":l=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:Ct(e,n,h,w,a,null)}}d&&Ct(e,n,"srcSet",a.srcSet,a,null),l&&Ct(e,n,"src",a.src,a,null);return;case"input":ft("invalid",e);var _=h=w=d=null,O=null,V=null;for(l in a)if(a.hasOwnProperty(l)){var ve=a[l];if(ve!=null)switch(l){case"name":d=ve;break;case"type":w=ve;break;case"checked":O=ve;break;case"defaultChecked":V=ve;break;case"value":h=ve;break;case"defaultValue":_=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(i(137,n));break;default:Ct(e,n,l,ve,a,null)}}oh(e,h,_,O,V,w,d,!1),So(e);return;case"select":ft("invalid",e),l=w=h=null;for(d in a)if(a.hasOwnProperty(d)&&(_=a[d],_!=null))switch(d){case"value":h=_;break;case"defaultValue":w=_;break;case"multiple":l=_;default:Ct(e,n,d,_,a,null)}n=h,a=w,e.multiple=!!l,n!=null?oi(e,!!l,n,!1):a!=null&&oi(e,!!l,a,!0);return;case"textarea":ft("invalid",e),h=d=l=null;for(w in a)if(a.hasOwnProperty(w)&&(_=a[w],_!=null))switch(w){case"value":l=_;break;case"defaultValue":d=_;break;case"children":h=_;break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(i(91));break;default:Ct(e,n,w,_,a,null)}ch(e,l,d,h),So(e);return;case"option":for(O in a)if(a.hasOwnProperty(O)&&(l=a[O],l!=null))switch(O){case"selected":e.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Ct(e,n,O,l,a,null)}return;case"dialog":ft("cancel",e),ft("close",e);break;case"iframe":case"object":ft("load",e);break;case"video":case"audio":for(l=0;l<Ua.length;l++)ft(Ua[l],e);break;case"image":ft("error",e),ft("load",e);break;case"details":ft("toggle",e);break;case"embed":case"source":case"link":ft("error",e),ft("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in a)if(a.hasOwnProperty(V)&&(l=a[V],l!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:Ct(e,n,V,l,a,null)}return;default:if(Ac(n)){for(ve in a)a.hasOwnProperty(ve)&&(l=a[ve],l!==void 0&&td(e,n,ve,l,a,void 0));return}}for(_ in a)a.hasOwnProperty(_)&&(l=a[_],l!=null&&Ct(e,n,_,l,a,null))}function bv(e,n,a,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,h=null,w=null,_=null,O=null,V=null,ve=null;for(ge in a){var ke=a[ge];if(a.hasOwnProperty(ge)&&ke!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":O=ke;default:l.hasOwnProperty(ge)||Ct(e,n,ge,null,l,ke)}}for(var fe in l){var ge=l[fe];if(ke=a[fe],l.hasOwnProperty(fe)&&(ge!=null||ke!=null))switch(fe){case"type":h=ge;break;case"name":d=ge;break;case"checked":V=ge;break;case"defaultChecked":ve=ge;break;case"value":w=ge;break;case"defaultValue":_=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(i(137,n));break;default:ge!==ke&&Ct(e,n,fe,ge,l,ke)}}pc(e,w,_,O,V,ve,h,d);return;case"select":ge=w=_=fe=null;for(h in a)if(O=a[h],a.hasOwnProperty(h)&&O!=null)switch(h){case"value":break;case"multiple":ge=O;default:l.hasOwnProperty(h)||Ct(e,n,h,null,l,O)}for(d in l)if(h=l[d],O=a[d],l.hasOwnProperty(d)&&(h!=null||O!=null))switch(d){case"value":fe=h;break;case"defaultValue":_=h;break;case"multiple":w=h;default:h!==O&&Ct(e,n,d,h,l,O)}n=_,a=w,l=ge,fe!=null?oi(e,!!a,fe,!1):!!l!=!!a&&(n!=null?oi(e,!!a,n,!0):oi(e,!!a,a?[]:"",!1));return;case"textarea":ge=fe=null;for(_ in a)if(d=a[_],a.hasOwnProperty(_)&&d!=null&&!l.hasOwnProperty(_))switch(_){case"value":break;case"children":break;default:Ct(e,n,_,null,l,d)}for(w in l)if(d=l[w],h=a[w],l.hasOwnProperty(w)&&(d!=null||h!=null))switch(w){case"value":fe=d;break;case"defaultValue":ge=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(i(91));break;default:d!==h&&Ct(e,n,w,d,l,h)}lh(e,fe,ge);return;case"option":for(var He in a)if(fe=a[He],a.hasOwnProperty(He)&&fe!=null&&!l.hasOwnProperty(He))switch(He){case"selected":e.selected=!1;break;default:Ct(e,n,He,null,l,fe)}for(O in l)if(fe=l[O],ge=a[O],l.hasOwnProperty(O)&&fe!==ge&&(fe!=null||ge!=null))switch(O){case"selected":e.selected=fe&&typeof fe!="function"&&typeof fe!="symbol";break;default:Ct(e,n,O,fe,l,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Je in a)fe=a[Je],a.hasOwnProperty(Je)&&fe!=null&&!l.hasOwnProperty(Je)&&Ct(e,n,Je,null,l,fe);for(V in l)if(fe=l[V],ge=a[V],l.hasOwnProperty(V)&&fe!==ge&&(fe!=null||ge!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(i(137,n));break;default:Ct(e,n,V,fe,l,ge)}return;default:if(Ac(n)){for(var qt in a)fe=a[qt],a.hasOwnProperty(qt)&&fe!==void 0&&!l.hasOwnProperty(qt)&&td(e,n,qt,void 0,l,fe);for(ve in l)fe=l[ve],ge=a[ve],!l.hasOwnProperty(ve)||fe===ge||fe===void 0&&ge===void 0||td(e,n,ve,fe,l,ge);return}}for(var ee in a)fe=a[ee],a.hasOwnProperty(ee)&&fe!=null&&!l.hasOwnProperty(ee)&&Ct(e,n,ee,null,l,fe);for(ke in l)fe=l[ke],ge=a[ke],!l.hasOwnProperty(ke)||fe===ge||fe==null&&ge==null||Ct(e,n,ke,fe,l,ge)}var nd=null,sd=null;function ml(e){return e.nodeType===9?e:e.ownerDocument}function ng(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sg(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function rd(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var id=null;function xv(){var e=window.event;return e&&e.type==="popstate"?e===id?!1:(id=e,!0):(id=null,!1)}var rg=typeof setTimeout=="function"?setTimeout:void 0,Sv=typeof clearTimeout=="function"?clearTimeout:void 0,ig=typeof Promise=="function"?Promise:void 0,wv=typeof queueMicrotask=="function"?queueMicrotask:typeof ig<"u"?function(e){return ig.resolve(null).then(e).catch(kv)}:rg;function kv(e){setTimeout(function(){throw e})}function ad(e,n){var a=n,l=0;do{var d=a.nextSibling;if(e.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(l===0){e.removeChild(d),Ya(n);return}l--}else a!=="$"&&a!=="$?"&&a!=="$!"||l++;a=d}while(a);Ya(n)}function od(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":od(a),Bt(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Cv(e,n,a,l){for(;e.nodeType===1;){var d=a;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[Tt])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==d.rel||e.getAttribute("href")!==(d.href==null?null:d.href)||e.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||e.getAttribute("title")!==(d.title==null?null:d.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(d.src==null?null:d.src)||e.getAttribute("type")!==(d.type==null?null:d.type)||e.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var h=d.name==null?null:""+d.name;if(d.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=is(e.nextSibling),e===null)break}return null}function jv(e,n,a){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=is(e.nextSibling),e===null))return null;return e}function is(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return e}function ag(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return e;n--}else a==="/$"&&n++}e=e.previousSibling}return null}function og(e,n,a){switch(n=ml(a),e){case"html":if(e=n.documentElement,!e)throw Error(i(452));return e;case"head":if(e=n.head,!e)throw Error(i(453));return e;case"body":if(e=n.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}var Xn=new Map,lg=new Set;function pl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.ownerDocument}var Vs=Z.d;Z.d={f:_v,r:Ev,D:Nv,C:Tv,L:Rv,m:Mv,X:Dv,S:Ov,M:Lv};function _v(){var e=Vs.f(),n=ol();return e||n}function Ev(e){var n=Js(e);n!==null&&n.tag===5&&n.type==="form"?Lm(n):Vs.r(e)}var Li=typeof document>"u"?null:document;function cg(e,n,a){var l=Li;if(l&&typeof n=="string"&&n){var d=Bn(n);d='link[rel="'+e+'"][href="'+d+'"]',typeof a=="string"&&(d+='[crossorigin="'+a+'"]'),lg.has(d)||(lg.add(d),e={rel:e,crossOrigin:a,href:n},l.querySelector(d)===null&&(n=l.createElement("link"),hn(n,"link",e),sn(n),l.head.appendChild(n)))}}function Nv(e){Vs.D(e),cg("dns-prefetch",e,null)}function Tv(e,n){Vs.C(e,n),cg("preconnect",e,n)}function Rv(e,n,a){Vs.L(e,n,a);var l=Li;if(l&&e&&n){var d='link[rel="preload"][as="'+Bn(n)+'"]';n==="image"&&a&&a.imageSrcSet?(d+='[imagesrcset="'+Bn(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(d+='[imagesizes="'+Bn(a.imageSizes)+'"]')):d+='[href="'+Bn(e)+'"]';var h=d;switch(n){case"style":h=zi(e);break;case"script":h=Ui(e)}Xn.has(h)||(e=W({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:e,as:n},a),Xn.set(h,e),l.querySelector(d)!==null||n==="style"&&l.querySelector(Pa(h))||n==="script"&&l.querySelector($a(h))||(n=l.createElement("link"),hn(n,"link",e),sn(n),l.head.appendChild(n)))}}function Mv(e,n){Vs.m(e,n);var a=Li;if(a&&e){var l=n&&typeof n.as=="string"?n.as:"script",d='link[rel="modulepreload"][as="'+Bn(l)+'"][href="'+Bn(e)+'"]',h=d;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=Ui(e)}if(!Xn.has(h)&&(e=W({rel:"modulepreload",href:e},n),Xn.set(h,e),a.querySelector(d)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector($a(h)))return}l=a.createElement("link"),hn(l,"link",e),sn(l),a.head.appendChild(l)}}}function Ov(e,n,a){Vs.S(e,n,a);var l=Li;if(l&&e){var d=ii(l).hoistableStyles,h=zi(e);n=n||"default";var w=d.get(h);if(!w){var _={loading:0,preload:null};if(w=l.querySelector(Pa(h)))_.loading=5;else{e=W({rel:"stylesheet",href:e,"data-precedence":n},a),(a=Xn.get(h))&&ld(e,a);var O=w=l.createElement("link");sn(O),hn(O,"link",e),O._p=new Promise(function(V,ve){O.onload=V,O.onerror=ve}),O.addEventListener("load",function(){_.loading|=1}),O.addEventListener("error",function(){_.loading|=2}),_.loading|=4,gl(w,n,l)}w={type:"stylesheet",instance:w,count:1,state:_},d.set(h,w)}}}function Dv(e,n){Vs.X(e,n);var a=Li;if(a&&e){var l=ii(a).hoistableScripts,d=Ui(e),h=l.get(d);h||(h=a.querySelector($a(d)),h||(e=W({src:e,async:!0},n),(n=Xn.get(d))&&cd(e,n),h=a.createElement("script"),sn(h),hn(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},l.set(d,h))}}function Lv(e,n){Vs.M(e,n);var a=Li;if(a&&e){var l=ii(a).hoistableScripts,d=Ui(e),h=l.get(d);h||(h=a.querySelector($a(d)),h||(e=W({src:e,async:!0,type:"module"},n),(n=Xn.get(d))&&cd(e,n),h=a.createElement("script"),sn(h),hn(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},l.set(d,h))}}function ug(e,n,a,l){var d=(d=G.current)?pl(d):null;if(!d)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=zi(a.href),a=ii(d).hoistableStyles,l=a.get(n),l||(l={type:"style",instance:null,count:0,state:null},a.set(n,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=zi(a.href);var h=ii(d).hoistableStyles,w=h.get(e);if(w||(d=d.ownerDocument||d,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,w),(h=d.querySelector(Pa(e)))&&!h._p&&(w.instance=h,w.state.loading=5),Xn.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Xn.set(e,a),h||zv(d,e,a,w.state))),n&&l===null)throw Error(i(528,""));return w}if(n&&l!==null)throw Error(i(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Ui(a),a=ii(d).hoistableScripts,l=a.get(n),l||(l={type:"script",instance:null,count:0,state:null},a.set(n,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function zi(e){return'href="'+Bn(e)+'"'}function Pa(e){return'link[rel="stylesheet"]['+e+"]"}function dg(e){return W({},e,{"data-precedence":e.precedence,precedence:null})}function zv(e,n,a,l){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?l.loading=1:(n=e.createElement("link"),l.preload=n,n.addEventListener("load",function(){return l.loading|=1}),n.addEventListener("error",function(){return l.loading|=2}),hn(n,"link",a),sn(n),e.head.appendChild(n))}function Ui(e){return'[src="'+Bn(e)+'"]'}function $a(e){return"script[async]"+e}function fg(e,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var l=e.querySelector('style[data-href~="'+Bn(a.href)+'"]');if(l)return n.instance=l,sn(l),l;var d=W({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),sn(l),hn(l,"style",d),gl(l,a.precedence,e),n.instance=l;case"stylesheet":d=zi(a.href);var h=e.querySelector(Pa(d));if(h)return n.state.loading|=4,n.instance=h,sn(h),h;l=dg(a),(d=Xn.get(d))&&ld(l,d),h=(e.ownerDocument||e).createElement("link"),sn(h);var w=h;return w._p=new Promise(function(_,O){w.onload=_,w.onerror=O}),hn(h,"link",l),n.state.loading|=4,gl(h,a.precedence,e),n.instance=h;case"script":return h=Ui(a.src),(d=e.querySelector($a(h)))?(n.instance=d,sn(d),d):(l=a,(d=Xn.get(h))&&(l=W({},a),cd(l,d)),e=e.ownerDocument||e,d=e.createElement("script"),sn(d),hn(d,"link",l),e.head.appendChild(d),n.instance=d);case"void":return null;default:throw Error(i(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(l=n.instance,n.state.loading|=4,gl(l,a.precedence,e));return n.instance}function gl(e,n,a){for(var l=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=l.length?l[l.length-1]:null,h=d,w=0;w<l.length;w++){var _=l[w];if(_.dataset.precedence===n)h=_;else if(h!==d)break}h?h.parentNode.insertBefore(e,h.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(e,n.firstChild))}function ld(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function cd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var Al=null;function hg(e,n,a){if(Al===null){var l=new Map,d=Al=new Map;d.set(a,l)}else d=Al,l=d.get(a),l||(l=new Map,d.set(a,l));if(l.has(e))return l;for(l.set(e,null),a=a.getElementsByTagName(e),d=0;d<a.length;d++){var h=a[d];if(!(h[Tt]||h[ot]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var w=h.getAttribute(n)||"";w=e+w;var _=l.get(w);_?_.push(h):l.set(w,[h])}}return l}function mg(e,n,a){e=e.ownerDocument||e,e.head.insertBefore(a,n==="title"?e.querySelector("head > title"):null)}function Uv(e,n,a){if(a===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function pg(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var qa=null;function Bv(){}function Pv(e,n,a){if(qa===null)throw Error(i(475));var l=qa;if(n.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var d=zi(a.href),h=e.querySelector(Pa(d));if(h){e=h._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(l.count++,l=yl.bind(l),e.then(l,l)),n.state.loading|=4,n.instance=h,sn(h);return}h=e.ownerDocument||e,a=dg(a),(d=Xn.get(d))&&ld(a,d),h=h.createElement("link"),sn(h);var w=h;w._p=new Promise(function(_,O){w.onload=_,w.onerror=O}),hn(h,"link",a),n.instance=h}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(n,e),(e=n.state.preload)&&(n.state.loading&3)===0&&(l.count++,n=yl.bind(l),e.addEventListener("load",n),e.addEventListener("error",n))}}function $v(){if(qa===null)throw Error(i(475));var e=qa;return e.stylesheets&&e.count===0&&ud(e,e.stylesheets),0<e.count?function(n){var a=setTimeout(function(){if(e.stylesheets&&ud(e,e.stylesheets),e.unsuspend){var l=e.unsuspend;e.unsuspend=null,l()}},6e4);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(a)}}:null}function yl(){if(this.count--,this.count===0){if(this.stylesheets)ud(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var vl=null;function ud(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,vl=new Map,n.forEach(qv,e),vl=null,yl.call(e))}function qv(e,n){if(!(n.state.loading&4)){var a=vl.get(e);if(a)var l=a.get(null);else{a=new Map,vl.set(e,a);for(var d=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<d.length;h++){var w=d[h];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(a.set(w.dataset.precedence,w),l=w)}l&&a.set(null,l)}d=n.instance,w=d.getAttribute("data-precedence"),h=a.get(w)||l,h===l&&a.set(null,d),a.set(w,d),this.count++,l=yl.bind(this),d.addEventListener("load",l),d.addEventListener("error",l),h?h.parentNode.insertBefore(d,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(d,e.firstChild)),n.state.loading|=4}}var Ia={$$typeof:C,Provider:null,Consumer:null,_currentValue:Te,_currentValue2:Te,_threadCount:0};function Iv(e,n,a,l,d,h,w,_){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_s(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_s(0),this.hiddenUpdates=_s(null),this.identifierPrefix=l,this.onUncaughtError=d,this.onCaughtError=h,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=_,this.incompleteTransitions=new Map}function gg(e,n,a,l,d,h,w,_,O,V,ve,ke){return e=new Iv(e,n,a,w,_,O,V,ke),n=1,h===!0&&(n|=24),h=Yn(3,null,null,n),e.current=h,h.stateNode=e,n=Ic(),n.refCount++,e.pooledCache=n,n.refCount++,h.memoizedState={element:l,isDehydrated:a,cache:n},Su(h),e}function Ag(e){return e?(e=pi,e):pi}function yg(e,n,a,l,d,h){d=Ag(d),l.context===null?l.context=d:l.pendingContext=d,l=or(n),l.payload={element:a},h=h===void 0?null:h,h!==null&&(l.callback=h),a=lr(e,l,n),a!==null&&(bn(a,e,n),Ca(a,e,n))}function vg(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function dd(e,n){vg(e,n),(e=e.alternate)&&vg(e,n)}function bg(e){if(e.tag===13){var n=er(e,67108864);n!==null&&bn(n,e,67108864),dd(e,67108864)}}var bl=!0;function Fv(e,n,a,l){var d=z.T;z.T=null;var h=Z.p;try{Z.p=2,fd(e,n,a,l)}finally{Z.p=h,z.T=d}}function Hv(e,n,a,l){var d=z.T;z.T=null;var h=Z.p;try{Z.p=8,fd(e,n,a,l)}finally{Z.p=h,z.T=d}}function fd(e,n,a,l){if(bl){var d=hd(l);if(d===null)ed(e,n,l,xl,a),Sg(e,l);else if(Yv(d,e,n,a,l))l.stopPropagation();else if(Sg(e,l),n&4&&-1<Vv.indexOf(e)){for(;d!==null;){var h=Js(d);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var w=zn(h.pendingLanes);if(w!==0){var _=h;for(_.pendingLanes|=2,_.entangledLanes|=2;w;){var O=1<<31-Be(w);_.entanglements[1]|=O,w&=~O}ps(h),(Lt&6)===0&&(rl=ue()+500,za(0))}}break;case 13:_=er(h,2),_!==null&&bn(_,h,2),ol(),dd(h,2)}if(h=hd(l),h===null&&ed(e,n,l,xl,a),h===d)break;d=h}d!==null&&l.stopPropagation()}else ed(e,n,l,null,a)}}function hd(e){return e=vc(e),md(e)}var xl=null;function md(e){if(xl=null,e=un(e),e!==null){var n=Y(e);if(n===null)e=null;else{var a=n.tag;if(a===13){if(e=P(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return xl=e,null}function xg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case De:return 2;case se:return 8;case Ee:case Ke:return 32;case b:return 268435456;default:return 32}default:return 32}}var pd=!1,pr=null,gr=null,Ar=null,Fa=new Map,Ha=new Map,yr=[],Vv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Sg(e,n){switch(e){case"focusin":case"focusout":pr=null;break;case"dragenter":case"dragleave":gr=null;break;case"mouseover":case"mouseout":Ar=null;break;case"pointerover":case"pointerout":Fa.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ha.delete(n.pointerId)}}function Va(e,n,a,l,d,h){return e===null||e.nativeEvent!==h?(e={blockedOn:n,domEventName:a,eventSystemFlags:l,nativeEvent:h,targetContainers:[d]},n!==null&&(n=Js(n),n!==null&&bg(n)),e):(e.eventSystemFlags|=l,n=e.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),e)}function Yv(e,n,a,l,d){switch(n){case"focusin":return pr=Va(pr,e,n,a,l,d),!0;case"dragenter":return gr=Va(gr,e,n,a,l,d),!0;case"mouseover":return Ar=Va(Ar,e,n,a,l,d),!0;case"pointerover":var h=d.pointerId;return Fa.set(h,Va(Fa.get(h)||null,e,n,a,l,d)),!0;case"gotpointercapture":return h=d.pointerId,Ha.set(h,Va(Ha.get(h)||null,e,n,a,l,d)),!0}return!1}function wg(e){var n=un(e.target);if(n!==null){var a=Y(n);if(a!==null){if(n=a.tag,n===13){if(n=P(a),n!==null){e.blockedOn=n,st(e.priority,function(){if(a.tag===13){var l=Mn(),d=er(a,l);d!==null&&bn(d,a,l),dd(a,l)}});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Sl(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=hd(e.nativeEvent);if(a===null){a=e.nativeEvent;var l=new a.constructor(a.type,a);yc=l,a.target.dispatchEvent(l),yc=null}else return n=Js(a),n!==null&&bg(n),e.blockedOn=a,!1;n.shift()}return!0}function kg(e,n,a){Sl(e)&&a.delete(n)}function Gv(){pd=!1,pr!==null&&Sl(pr)&&(pr=null),gr!==null&&Sl(gr)&&(gr=null),Ar!==null&&Sl(Ar)&&(Ar=null),Fa.forEach(kg),Ha.forEach(kg)}function wl(e,n){e.blockedOn===n&&(e.blockedOn=null,pd||(pd=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Gv)))}var kl=null;function Cg(e){kl!==e&&(kl=e,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){kl===e&&(kl=null);for(var n=0;n<e.length;n+=3){var a=e[n],l=e[n+1],d=e[n+2];if(typeof l!="function"){if(md(l||a)===null)continue;break}var h=Js(a);h!==null&&(e.splice(n,3),n-=3,ru(h,{pending:!0,data:d,method:a.method,action:l},l,d))}}))}function Ya(e){function n(O){return wl(O,e)}pr!==null&&wl(pr,e),gr!==null&&wl(gr,e),Ar!==null&&wl(Ar,e),Fa.forEach(n),Ha.forEach(n);for(var a=0;a<yr.length;a++){var l=yr[a];l.blockedOn===e&&(l.blockedOn=null)}for(;0<yr.length&&(a=yr[0],a.blockedOn===null);)wg(a),a.blockedOn===null&&yr.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(l=0;l<a.length;l+=3){var d=a[l],h=a[l+1],w=d[Zt]||null;if(typeof h=="function")w||Cg(a);else if(w){var _=null;if(h&&h.hasAttribute("formAction")){if(d=h,w=h[Zt]||null)_=w.formAction;else if(md(d)!==null)continue}else _=w.action;typeof _=="function"?a[l+1]=_:(a.splice(l,3),l-=3),Cg(a)}}}function gd(e){this._internalRoot=e}Cl.prototype.render=gd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(i(409));var a=n.current,l=Mn();yg(a,l,e,n,null,null)},Cl.prototype.unmount=gd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;e.tag===0&&Mi(),yg(e.current,2,null,e,null,null),ol(),n[ts]=null}};function Cl(e){this._internalRoot=e}Cl.prototype.unstable_scheduleHydration=function(e){if(e){var n=Ze();e={blockedOn:null,target:e,priority:n};for(var a=0;a<yr.length&&n!==0&&n<yr[a].priority;a++);yr.splice(a,0,e),a===0&&wg(e)}};var jg=t.version;if(jg!=="19.0.0")throw Error(i(527,jg,"19.0.0"));Z.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=J(n),e=e!==null?ze(e):null,e=e===null?null:e.stateNode,e};var Xv={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:z,findFiberByHostInstance:un,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jl.isDisabled&&jl.supportsFiber)try{k=jl.inject(Xv),N=jl}catch{}}return Qa.createRoot=function(e,n){if(!c(e))throw Error(i(299));var a=!1,l="",d=Fm,h=Hm,w=Vm,_=null;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onUncaughtError!==void 0&&(d=n.onUncaughtError),n.onCaughtError!==void 0&&(h=n.onCaughtError),n.onRecoverableError!==void 0&&(w=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(_=n.unstable_transitionCallbacks)),n=gg(e,1,!1,null,null,a,l,d,h,w,_,null),e[ts]=n.current,Wu(e.nodeType===8?e.parentNode:e),new gd(n)},Qa.hydrateRoot=function(e,n,a){if(!c(e))throw Error(i(299));var l=!1,d="",h=Fm,w=Hm,_=Vm,O=null,V=null;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(h=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(_=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(O=a.unstable_transitionCallbacks),a.formState!==void 0&&(V=a.formState)),n=gg(e,1,!0,n,a??null,l,d,h,w,_,O,V),n.context=Ag(null),a=n.current,l=Mn(),d=or(l),d.callback=null,lr(a,d,l),n.current.lanes=l,es(n,l),ps(n),e[ts]=n.current,Wu(e),new Cl(n)},Qa.version="19.0.0",Qa}var Mg;function fb(){if(Mg)return vd.exports;Mg=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(t){console.error(t)}}return s(),vd.exports=db(),vd.exports}var hb=fb();const mb=jf(hb),pb="modulepreload",gb=function(s){return"/"+s},Og={},jn=function(t,r,i){let c=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),m=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));c=Promise.allSettled(r.map(v=>{if(v=gb(v),v in Og)return;Og[v]=!0;const x=v.endsWith(".css"),A=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${A}`))return;const S=document.createElement("link");if(S.rel=x?"stylesheet":pb,x||(S.as="script"),S.crossOrigin="",S.href=v,m&&S.setAttribute("nonce",m),document.head.appendChild(S),x)return new Promise((j,C)=>{S.addEventListener("load",j),S.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${v}`)))})}))}function u(f){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=f,window.dispatchEvent(m),!m.defaultPrevented)throw f}return c.then(f=>{for(const m of f||[])m.status==="rejected"&&u(m.reason);return t().catch(u)})};function OA(s,t){return function(){return s.apply(t,arguments)}}const{toString:Ab}=Object.prototype,{getPrototypeOf:Ef}=Object,nc=(s=>t=>{const r=Ab.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),us=s=>(s=s.toLowerCase(),t=>nc(t)===s),sc=s=>t=>typeof t===s,{isArray:Qi}=Array,co=sc("undefined");function yb(s){return s!==null&&!co(s)&&s.constructor!==null&&!co(s.constructor)&&Dn(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const DA=us("ArrayBuffer");function vb(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&DA(s.buffer),t}const bb=sc("string"),Dn=sc("function"),LA=sc("number"),rc=s=>s!==null&&typeof s=="object",xb=s=>s===!0||s===!1,Tl=s=>{if(nc(s)!=="object")return!1;const t=Ef(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Sb=us("Date"),wb=us("File"),kb=us("Blob"),Cb=us("FileList"),jb=s=>rc(s)&&Dn(s.pipe),_b=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||Dn(s.append)&&((t=nc(s))==="formdata"||t==="object"&&Dn(s.toString)&&s.toString()==="[object FormData]"))},Eb=us("URLSearchParams"),[Nb,Tb,Rb,Mb]=["ReadableStream","Request","Response","Headers"].map(us),Ob=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function po(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let i,c;if(typeof s!="object"&&(s=[s]),Qi(s))for(i=0,c=s.length;i<c;i++)t.call(null,s[i],i,s);else{const u=r?Object.getOwnPropertyNames(s):Object.keys(s),f=u.length;let m;for(i=0;i<f;i++)m=u[i],t.call(null,s[m],m,s)}}function zA(s,t){t=t.toLowerCase();const r=Object.keys(s);let i=r.length,c;for(;i-- >0;)if(c=r[i],t===c.toLowerCase())return c;return null}const Qr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,UA=s=>!co(s)&&s!==Qr;function Id(){const{caseless:s}=UA(this)&&this||{},t={},r=(i,c)=>{const u=s&&zA(t,c)||c;Tl(t[u])&&Tl(i)?t[u]=Id(t[u],i):Tl(i)?t[u]=Id({},i):Qi(i)?t[u]=i.slice():t[u]=i};for(let i=0,c=arguments.length;i<c;i++)arguments[i]&&po(arguments[i],r);return t}const Db=(s,t,r,{allOwnKeys:i}={})=>(po(t,(c,u)=>{r&&Dn(c)?s[u]=OA(c,r):s[u]=c},{allOwnKeys:i}),s),Lb=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),zb=(s,t,r,i)=>{s.prototype=Object.create(t.prototype,i),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},Ub=(s,t,r,i)=>{let c,u,f;const m={};if(t=t||{},s==null)return t;do{for(c=Object.getOwnPropertyNames(s),u=c.length;u-- >0;)f=c[u],(!i||i(f,s,t))&&!m[f]&&(t[f]=s[f],m[f]=!0);s=r!==!1&&Ef(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},Bb=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const i=s.indexOf(t,r);return i!==-1&&i===r},Pb=s=>{if(!s)return null;if(Qi(s))return s;let t=s.length;if(!LA(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},$b=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&Ef(Uint8Array)),qb=(s,t)=>{const i=(s&&s[Symbol.iterator]).call(s);let c;for(;(c=i.next())&&!c.done;){const u=c.value;t.call(s,u[0],u[1])}},Ib=(s,t)=>{let r;const i=[];for(;(r=s.exec(t))!==null;)i.push(r);return i},Fb=us("HTMLFormElement"),Hb=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,c){return i.toUpperCase()+c}),Dg=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),Vb=us("RegExp"),BA=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),i={};po(r,(c,u)=>{let f;(f=t(c,u,s))!==!1&&(i[u]=f||c)}),Object.defineProperties(s,i)},Yb=s=>{BA(s,(t,r)=>{if(Dn(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const i=s[r];if(Dn(i)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Gb=(s,t)=>{const r={},i=c=>{c.forEach(u=>{r[u]=!0})};return Qi(s)?i(s):i(String(s).split(t)),r},Xb=()=>{},Qb=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function Kb(s){return!!(s&&Dn(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])}const Zb=s=>{const t=new Array(10),r=(i,c)=>{if(rc(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[c]=i;const u=Qi(i)?[]:{};return po(i,(f,m)=>{const v=r(f,c+1);!co(v)&&(u[m]=v)}),t[c]=void 0,u}}return i};return r(s,0)},Jb=us("AsyncFunction"),Wb=s=>s&&(rc(s)||Dn(s))&&Dn(s.then)&&Dn(s.catch),PA=((s,t)=>s?setImmediate:t?((r,i)=>(Qr.addEventListener("message",({source:c,data:u})=>{c===Qr&&u===r&&i.length&&i.shift()()},!1),c=>{i.push(c),Qr.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Dn(Qr.postMessage)),ex=typeof queueMicrotask<"u"?queueMicrotask.bind(Qr):typeof io<"u"&&io.nextTick||PA,me={isArray:Qi,isArrayBuffer:DA,isBuffer:yb,isFormData:_b,isArrayBufferView:vb,isString:bb,isNumber:LA,isBoolean:xb,isObject:rc,isPlainObject:Tl,isReadableStream:Nb,isRequest:Tb,isResponse:Rb,isHeaders:Mb,isUndefined:co,isDate:Sb,isFile:wb,isBlob:kb,isRegExp:Vb,isFunction:Dn,isStream:jb,isURLSearchParams:Eb,isTypedArray:$b,isFileList:Cb,forEach:po,merge:Id,extend:Db,trim:Ob,stripBOM:Lb,inherits:zb,toFlatObject:Ub,kindOf:nc,kindOfTest:us,endsWith:Bb,toArray:Pb,forEachEntry:qb,matchAll:Ib,isHTMLForm:Fb,hasOwnProperty:Dg,hasOwnProp:Dg,reduceDescriptors:BA,freezeMethods:Yb,toObjectSet:Gb,toCamelCase:Hb,noop:Xb,toFiniteNumber:Qb,findKey:zA,global:Qr,isContextDefined:UA,isSpecCompliantForm:Kb,toJSONObject:Zb,isAsyncFn:Jb,isThenable:Wb,setImmediate:PA,asap:ex};var $A={},ic={};ic.byteLength=sx;ic.toByteArray=ix;ic.fromByteArray=lx;var vs=[],Kn=[],tx=typeof Uint8Array<"u"?Uint8Array:Array,Sd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Bi=0,nx=Sd.length;Bi<nx;++Bi)vs[Bi]=Sd[Bi],Kn[Sd.charCodeAt(Bi)]=Bi;Kn[45]=62;Kn[95]=63;function qA(s){var t=s.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=s.indexOf("=");r===-1&&(r=t);var i=r===t?0:4-r%4;return[r,i]}function sx(s){var t=qA(s),r=t[0],i=t[1];return(r+i)*3/4-i}function rx(s,t,r){return(t+r)*3/4-r}function ix(s){var t,r=qA(s),i=r[0],c=r[1],u=new tx(rx(s,i,c)),f=0,m=c>0?i-4:i,v;for(v=0;v<m;v+=4)t=Kn[s.charCodeAt(v)]<<18|Kn[s.charCodeAt(v+1)]<<12|Kn[s.charCodeAt(v+2)]<<6|Kn[s.charCodeAt(v+3)],u[f++]=t>>16&255,u[f++]=t>>8&255,u[f++]=t&255;return c===2&&(t=Kn[s.charCodeAt(v)]<<2|Kn[s.charCodeAt(v+1)]>>4,u[f++]=t&255),c===1&&(t=Kn[s.charCodeAt(v)]<<10|Kn[s.charCodeAt(v+1)]<<4|Kn[s.charCodeAt(v+2)]>>2,u[f++]=t>>8&255,u[f++]=t&255),u}function ax(s){return vs[s>>18&63]+vs[s>>12&63]+vs[s>>6&63]+vs[s&63]}function ox(s,t,r){for(var i,c=[],u=t;u<r;u+=3)i=(s[u]<<16&16711680)+(s[u+1]<<8&65280)+(s[u+2]&255),c.push(ax(i));return c.join("")}function lx(s){for(var t,r=s.length,i=r%3,c=[],u=16383,f=0,m=r-i;f<m;f+=u)c.push(ox(s,f,f+u>m?m:f+u));return i===1?(t=s[r-1],c.push(vs[t>>2]+vs[t<<4&63]+"==")):i===2&&(t=(s[r-2]<<8)+s[r-1],c.push(vs[t>>10]+vs[t>>4&63]+vs[t<<2&63]+"=")),c.join("")}var Nf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Nf.read=function(s,t,r,i,c){var u,f,m=c*8-i-1,v=(1<<m)-1,x=v>>1,A=-7,S=r?c-1:0,j=r?-1:1,C=s[t+S];for(S+=j,u=C&(1<<-A)-1,C>>=-A,A+=m;A>0;u=u*256+s[t+S],S+=j,A-=8);for(f=u&(1<<-A)-1,u>>=-A,A+=i;A>0;f=f*256+s[t+S],S+=j,A-=8);if(u===0)u=1-x;else{if(u===v)return f?NaN:(C?-1:1)*(1/0);f=f+Math.pow(2,i),u=u-x}return(C?-1:1)*f*Math.pow(2,u-i)};Nf.write=function(s,t,r,i,c,u){var f,m,v,x=u*8-c-1,A=(1<<x)-1,S=A>>1,j=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=i?0:u-1,M=i?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,f=A):(f=Math.floor(Math.log(t)/Math.LN2),t*(v=Math.pow(2,-f))<1&&(f--,v*=2),f+S>=1?t+=j/v:t+=j*Math.pow(2,1-S),t*v>=2&&(f++,v/=2),f+S>=A?(m=0,f=A):f+S>=1?(m=(t*v-1)*Math.pow(2,c),f=f+S):(m=t*Math.pow(2,S-1)*Math.pow(2,c),f=0));c>=8;s[r+C]=m&255,C+=M,m/=256,c-=8);for(f=f<<c|m,x+=c;x>0;s[r+C]=f&255,C+=M,f/=256,x-=8);s[r+C-M]|=U*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(s){const t=ic,r=Nf,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=A,s.SlowBuffer=L,s.INSPECT_MAX_BYTES=50;const c=2147483647;s.kMaxLength=c;const{Uint8Array:u,ArrayBuffer:f,SharedArrayBuffer:m}=globalThis;A.TYPED_ARRAY_SUPPORT=v(),!A.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function v(){try{const b=new u(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,u.prototype),Object.setPrototypeOf(b,p),b.foo()===42}catch{return!1}}Object.defineProperty(A.prototype,"parent",{enumerable:!0,get:function(){if(A.isBuffer(this))return this.buffer}}),Object.defineProperty(A.prototype,"offset",{enumerable:!0,get:function(){if(A.isBuffer(this))return this.byteOffset}});function x(b){if(b>c)throw new RangeError('The value "'+b+'" is invalid for option "size"');const p=new u(b);return Object.setPrototypeOf(p,A.prototype),p}function A(b,p,g){if(typeof b=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return M(b)}return S(b,p,g)}A.poolSize=8192;function S(b,p,g){if(typeof b=="string")return U(b,p);if(f.isView(b))return ne(b);if(b==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b);if(Re(b,f)||b&&Re(b.buffer,f)||typeof m<"u"&&(Re(b,m)||b&&Re(b.buffer,m)))return K(b,p,g);if(typeof b=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const k=b.valueOf&&b.valueOf();if(k!=null&&k!==b)return A.from(k,p,g);const N=te(b);if(N)return N;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof b[Symbol.toPrimitive]=="function")return A.from(b[Symbol.toPrimitive]("string"),p,g);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b)}A.from=function(b,p,g){return S(b,p,g)},Object.setPrototypeOf(A.prototype,u.prototype),Object.setPrototypeOf(A,u);function j(b){if(typeof b!="number")throw new TypeError('"size" argument must be of type number');if(b<0)throw new RangeError('The value "'+b+'" is invalid for option "size"')}function C(b,p,g){return j(b),b<=0?x(b):p!==void 0?typeof g=="string"?x(b).fill(p,g):x(b).fill(p):x(b)}A.alloc=function(b,p,g){return C(b,p,g)};function M(b){return j(b),x(b<0?0:B(b)|0)}A.allocUnsafe=function(b){return M(b)},A.allocUnsafeSlow=function(b){return M(b)};function U(b,p){if((typeof p!="string"||p==="")&&(p="utf8"),!A.isEncoding(p))throw new TypeError("Unknown encoding: "+p);const g=I(b,p)|0;let k=x(g);const N=k.write(b,p);return N!==g&&(k=k.slice(0,N)),k}function D(b){const p=b.length<0?0:B(b.length)|0,g=x(p);for(let k=0;k<p;k+=1)g[k]=b[k]&255;return g}function ne(b){if(Re(b,u)){const p=new u(b);return K(p.buffer,p.byteOffset,p.byteLength)}return D(b)}function K(b,p,g){if(p<0||b.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(b.byteLength<p+(g||0))throw new RangeError('"length" is outside of buffer bounds');let k;return p===void 0&&g===void 0?k=new u(b):g===void 0?k=new u(b,p):k=new u(b,p,g),Object.setPrototypeOf(k,A.prototype),k}function te(b){if(A.isBuffer(b)){const p=B(b.length)|0,g=x(p);return g.length===0||b.copy(g,0,0,p),g}if(b.length!==void 0)return typeof b.length!="number"||De(b.length)?x(0):D(b);if(b.type==="Buffer"&&Array.isArray(b.data))return D(b.data)}function B(b){if(b>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return b|0}function L(b){return+b!=b&&(b=0),A.alloc(+b)}A.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==A.prototype},A.compare=function(p,g){if(Re(p,u)&&(p=A.from(p,p.offset,p.byteLength)),Re(g,u)&&(g=A.from(g,g.offset,g.byteLength)),!A.isBuffer(p)||!A.isBuffer(g))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===g)return 0;let k=p.length,N=g.length;for(let $=0,ae=Math.min(k,N);$<ae;++$)if(p[$]!==g[$]){k=p[$],N=g[$];break}return k<N?-1:N<k?1:0},A.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},A.concat=function(p,g){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return A.alloc(0);let k;if(g===void 0)for(g=0,k=0;k<p.length;++k)g+=p[k].length;const N=A.allocUnsafe(g);let $=0;for(k=0;k<p.length;++k){let ae=p[k];if(Re(ae,u))$+ae.length>N.length?(A.isBuffer(ae)||(ae=A.from(ae)),ae.copy(N,$)):u.prototype.set.call(N,ae,$);else if(A.isBuffer(ae))ae.copy(N,$);else throw new TypeError('"list" argument must be an Array of Buffers');$+=ae.length}return N};function I(b,p){if(A.isBuffer(b))return b.length;if(f.isView(b)||Re(b,f))return b.byteLength;if(typeof b!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof b);const g=b.length,k=arguments.length>2&&arguments[2]===!0;if(!k&&g===0)return 0;let N=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return g;case"utf8":case"utf-8":return ut(b).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g*2;case"hex":return g>>>1;case"base64":return Mt(b).length;default:if(N)return k?-1:ut(b).length;p=(""+p).toLowerCase(),N=!0}}A.byteLength=I;function E(b,p,g){let k=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((g===void 0||g>this.length)&&(g=this.length),g<=0)||(g>>>=0,p>>>=0,g<=p))return"";for(b||(b="utf8");;)switch(b){case"hex":return ze(this,p,g);case"utf8":case"utf-8":return Q(this,p,g);case"ascii":return ie(this,p,g);case"latin1":case"binary":return J(this,p,g);case"base64":return R(this,p,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,p,g);default:if(k)throw new TypeError("Unknown encoding: "+b);b=(b+"").toLowerCase(),k=!0}}A.prototype._isBuffer=!0;function T(b,p,g){const k=b[p];b[p]=b[g],b[g]=k}A.prototype.swap16=function(){const p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let g=0;g<p;g+=2)T(this,g,g+1);return this},A.prototype.swap32=function(){const p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let g=0;g<p;g+=4)T(this,g,g+3),T(this,g+1,g+2);return this},A.prototype.swap64=function(){const p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let g=0;g<p;g+=8)T(this,g,g+7),T(this,g+1,g+6),T(this,g+2,g+5),T(this,g+3,g+4);return this},A.prototype.toString=function(){const p=this.length;return p===0?"":arguments.length===0?Q(this,0,p):E.apply(this,arguments)},A.prototype.toLocaleString=A.prototype.toString,A.prototype.equals=function(p){if(!A.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:A.compare(this,p)===0},A.prototype.inspect=function(){let p="";const g=s.INSPECT_MAX_BYTES;return p=this.toString("hex",0,g).replace(/(.{2})/g,"$1 ").trim(),this.length>g&&(p+=" ... "),"<Buffer "+p+">"},i&&(A.prototype[i]=A.prototype.inspect),A.prototype.compare=function(p,g,k,N,$){if(Re(p,u)&&(p=A.from(p,p.offset,p.byteLength)),!A.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(g===void 0&&(g=0),k===void 0&&(k=p?p.length:0),N===void 0&&(N=0),$===void 0&&($=this.length),g<0||k>p.length||N<0||$>this.length)throw new RangeError("out of range index");if(N>=$&&g>=k)return 0;if(N>=$)return-1;if(g>=k)return 1;if(g>>>=0,k>>>=0,N>>>=0,$>>>=0,this===p)return 0;let ae=$-N,Be=k-g;const at=Math.min(ae,Be),tt=this.slice(N,$),dt=p.slice(g,k);for(let nt=0;nt<at;++nt)if(tt[nt]!==dt[nt]){ae=tt[nt],Be=dt[nt];break}return ae<Be?-1:Be<ae?1:0};function z(b,p,g,k,N){if(b.length===0)return-1;if(typeof g=="string"?(k=g,g=0):g>2147483647?g=2147483647:g<-2147483648&&(g=-2147483648),g=+g,De(g)&&(g=N?0:b.length-1),g<0&&(g=b.length+g),g>=b.length){if(N)return-1;g=b.length-1}else if(g<0)if(N)g=0;else return-1;if(typeof p=="string"&&(p=A.from(p,k)),A.isBuffer(p))return p.length===0?-1:W(b,p,g,k,N);if(typeof p=="number")return p=p&255,typeof u.prototype.indexOf=="function"?N?u.prototype.indexOf.call(b,p,g):u.prototype.lastIndexOf.call(b,p,g):W(b,[p],g,k,N);throw new TypeError("val must be string, number or Buffer")}function W(b,p,g,k,N){let $=1,ae=b.length,Be=p.length;if(k!==void 0&&(k=String(k).toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(b.length<2||p.length<2)return-1;$=2,ae/=2,Be/=2,g/=2}function at(dt,nt){return $===1?dt[nt]:dt.readUInt16BE(nt*$)}let tt;if(N){let dt=-1;for(tt=g;tt<ae;tt++)if(at(b,tt)===at(p,dt===-1?0:tt-dt)){if(dt===-1&&(dt=tt),tt-dt+1===Be)return dt*$}else dt!==-1&&(tt-=tt-dt),dt=-1}else for(g+Be>ae&&(g=ae-Be),tt=g;tt>=0;tt--){let dt=!0;for(let nt=0;nt<Be;nt++)if(at(b,tt+nt)!==at(p,nt)){dt=!1;break}if(dt)return tt}return-1}A.prototype.includes=function(p,g,k){return this.indexOf(p,g,k)!==-1},A.prototype.indexOf=function(p,g,k){return z(this,p,g,k,!0)},A.prototype.lastIndexOf=function(p,g,k){return z(this,p,g,k,!1)};function H(b,p,g,k){g=Number(g)||0;const N=b.length-g;k?(k=Number(k),k>N&&(k=N)):k=N;const $=p.length;k>$/2&&(k=$/2);let ae;for(ae=0;ae<k;++ae){const Be=parseInt(p.substr(ae*2,2),16);if(De(Be))return ae;b[g+ae]=Be}return ae}function q(b,p,g,k){return ue(ut(p,b.length-g),b,g,k)}function re(b,p,g,k){return ue(St(p),b,g,k)}function pe(b,p,g,k){return ue(Mt(p),b,g,k)}function ce(b,p,g,k){return ue(Nt(p,b.length-g),b,g,k)}A.prototype.write=function(p,g,k,N){if(g===void 0)N="utf8",k=this.length,g=0;else if(k===void 0&&typeof g=="string")N=g,k=this.length,g=0;else if(isFinite(g))g=g>>>0,isFinite(k)?(k=k>>>0,N===void 0&&(N="utf8")):(N=k,k=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const $=this.length-g;if((k===void 0||k>$)&&(k=$),p.length>0&&(k<0||g<0)||g>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");let ae=!1;for(;;)switch(N){case"hex":return H(this,p,g,k);case"utf8":case"utf-8":return q(this,p,g,k);case"ascii":case"latin1":case"binary":return re(this,p,g,k);case"base64":return pe(this,p,g,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ce(this,p,g,k);default:if(ae)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),ae=!0}},A.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function R(b,p,g){return p===0&&g===b.length?t.fromByteArray(b):t.fromByteArray(b.slice(p,g))}function Q(b,p,g){g=Math.min(b.length,g);const k=[];let N=p;for(;N<g;){const $=b[N];let ae=null,Be=$>239?4:$>223?3:$>191?2:1;if(N+Be<=g){let at,tt,dt,nt;switch(Be){case 1:$<128&&(ae=$);break;case 2:at=b[N+1],(at&192)===128&&(nt=($&31)<<6|at&63,nt>127&&(ae=nt));break;case 3:at=b[N+1],tt=b[N+2],(at&192)===128&&(tt&192)===128&&(nt=($&15)<<12|(at&63)<<6|tt&63,nt>2047&&(nt<55296||nt>57343)&&(ae=nt));break;case 4:at=b[N+1],tt=b[N+2],dt=b[N+3],(at&192)===128&&(tt&192)===128&&(dt&192)===128&&(nt=($&15)<<18|(at&63)<<12|(tt&63)<<6|dt&63,nt>65535&&nt<1114112&&(ae=nt))}}ae===null?(ae=65533,Be=1):ae>65535&&(ae-=65536,k.push(ae>>>10&1023|55296),ae=56320|ae&1023),k.push(ae),N+=Be}return P(k)}const Y=4096;function P(b){const p=b.length;if(p<=Y)return String.fromCharCode.apply(String,b);let g="",k=0;for(;k<p;)g+=String.fromCharCode.apply(String,b.slice(k,k+=Y));return g}function ie(b,p,g){let k="";g=Math.min(b.length,g);for(let N=p;N<g;++N)k+=String.fromCharCode(b[N]&127);return k}function J(b,p,g){let k="";g=Math.min(b.length,g);for(let N=p;N<g;++N)k+=String.fromCharCode(b[N]);return k}function ze(b,p,g){const k=b.length;(!p||p<0)&&(p=0),(!g||g<0||g>k)&&(g=k);let N="";for(let $=p;$<g;++$)N+=se[b[$]];return N}function de(b,p,g){const k=b.slice(p,g);let N="";for(let $=0;$<k.length-1;$+=2)N+=String.fromCharCode(k[$]+k[$+1]*256);return N}A.prototype.slice=function(p,g){const k=this.length;p=~~p,g=g===void 0?k:~~g,p<0?(p+=k,p<0&&(p=0)):p>k&&(p=k),g<0?(g+=k,g<0&&(g=0)):g>k&&(g=k),g<p&&(g=p);const N=this.subarray(p,g);return Object.setPrototypeOf(N,A.prototype),N};function Z(b,p,g){if(b%1!==0||b<0)throw new RangeError("offset is not uint");if(b+p>g)throw new RangeError("Trying to access beyond buffer length")}A.prototype.readUintLE=A.prototype.readUIntLE=function(p,g,k){p=p>>>0,g=g>>>0,k||Z(p,g,this.length);let N=this[p],$=1,ae=0;for(;++ae<g&&($*=256);)N+=this[p+ae]*$;return N},A.prototype.readUintBE=A.prototype.readUIntBE=function(p,g,k){p=p>>>0,g=g>>>0,k||Z(p,g,this.length);let N=this[p+--g],$=1;for(;g>0&&($*=256);)N+=this[p+--g]*$;return N},A.prototype.readUint8=A.prototype.readUInt8=function(p,g){return p=p>>>0,g||Z(p,1,this.length),this[p]},A.prototype.readUint16LE=A.prototype.readUInt16LE=function(p,g){return p=p>>>0,g||Z(p,2,this.length),this[p]|this[p+1]<<8},A.prototype.readUint16BE=A.prototype.readUInt16BE=function(p,g){return p=p>>>0,g||Z(p,2,this.length),this[p]<<8|this[p+1]},A.prototype.readUint32LE=A.prototype.readUInt32LE=function(p,g){return p=p>>>0,g||Z(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},A.prototype.readUint32BE=A.prototype.readUInt32BE=function(p,g){return p=p>>>0,g||Z(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},A.prototype.readBigUInt64LE=Ee(function(p){p=p>>>0,Ne(p,"offset");const g=this[p],k=this[p+7];(g===void 0||k===void 0)&&_e(p,this.length-8);const N=g+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24,$=this[++p]+this[++p]*2**8+this[++p]*2**16+k*2**24;return BigInt(N)+(BigInt($)<<BigInt(32))}),A.prototype.readBigUInt64BE=Ee(function(p){p=p>>>0,Ne(p,"offset");const g=this[p],k=this[p+7];(g===void 0||k===void 0)&&_e(p,this.length-8);const N=g*2**24+this[++p]*2**16+this[++p]*2**8+this[++p],$=this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+k;return(BigInt(N)<<BigInt(32))+BigInt($)}),A.prototype.readIntLE=function(p,g,k){p=p>>>0,g=g>>>0,k||Z(p,g,this.length);let N=this[p],$=1,ae=0;for(;++ae<g&&($*=256);)N+=this[p+ae]*$;return $*=128,N>=$&&(N-=Math.pow(2,8*g)),N},A.prototype.readIntBE=function(p,g,k){p=p>>>0,g=g>>>0,k||Z(p,g,this.length);let N=g,$=1,ae=this[p+--N];for(;N>0&&($*=256);)ae+=this[p+--N]*$;return $*=128,ae>=$&&(ae-=Math.pow(2,8*g)),ae},A.prototype.readInt8=function(p,g){return p=p>>>0,g||Z(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},A.prototype.readInt16LE=function(p,g){p=p>>>0,g||Z(p,2,this.length);const k=this[p]|this[p+1]<<8;return k&32768?k|4294901760:k},A.prototype.readInt16BE=function(p,g){p=p>>>0,g||Z(p,2,this.length);const k=this[p+1]|this[p]<<8;return k&32768?k|4294901760:k},A.prototype.readInt32LE=function(p,g){return p=p>>>0,g||Z(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},A.prototype.readInt32BE=function(p,g){return p=p>>>0,g||Z(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},A.prototype.readBigInt64LE=Ee(function(p){p=p>>>0,Ne(p,"offset");const g=this[p],k=this[p+7];(g===void 0||k===void 0)&&_e(p,this.length-8);const N=this[p+4]+this[p+5]*2**8+this[p+6]*2**16+(k<<24);return(BigInt(N)<<BigInt(32))+BigInt(g+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24)}),A.prototype.readBigInt64BE=Ee(function(p){p=p>>>0,Ne(p,"offset");const g=this[p],k=this[p+7];(g===void 0||k===void 0)&&_e(p,this.length-8);const N=(g<<24)+this[++p]*2**16+this[++p]*2**8+this[++p];return(BigInt(N)<<BigInt(32))+BigInt(this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+k)}),A.prototype.readFloatLE=function(p,g){return p=p>>>0,g||Z(p,4,this.length),r.read(this,p,!0,23,4)},A.prototype.readFloatBE=function(p,g){return p=p>>>0,g||Z(p,4,this.length),r.read(this,p,!1,23,4)},A.prototype.readDoubleLE=function(p,g){return p=p>>>0,g||Z(p,8,this.length),r.read(this,p,!0,52,8)},A.prototype.readDoubleBE=function(p,g){return p=p>>>0,g||Z(p,8,this.length),r.read(this,p,!1,52,8)};function Te(b,p,g,k,N,$){if(!A.isBuffer(b))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>N||p<$)throw new RangeError('"value" argument is out of bounds');if(g+k>b.length)throw new RangeError("Index out of range")}A.prototype.writeUintLE=A.prototype.writeUIntLE=function(p,g,k,N){if(p=+p,g=g>>>0,k=k>>>0,!N){const Be=Math.pow(2,8*k)-1;Te(this,p,g,k,Be,0)}let $=1,ae=0;for(this[g]=p&255;++ae<k&&($*=256);)this[g+ae]=p/$&255;return g+k},A.prototype.writeUintBE=A.prototype.writeUIntBE=function(p,g,k,N){if(p=+p,g=g>>>0,k=k>>>0,!N){const Be=Math.pow(2,8*k)-1;Te(this,p,g,k,Be,0)}let $=k-1,ae=1;for(this[g+$]=p&255;--$>=0&&(ae*=256);)this[g+$]=p/ae&255;return g+k},A.prototype.writeUint8=A.prototype.writeUInt8=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,1,255,0),this[g]=p&255,g+1},A.prototype.writeUint16LE=A.prototype.writeUInt16LE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,2,65535,0),this[g]=p&255,this[g+1]=p>>>8,g+2},A.prototype.writeUint16BE=A.prototype.writeUInt16BE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,2,65535,0),this[g]=p>>>8,this[g+1]=p&255,g+2},A.prototype.writeUint32LE=A.prototype.writeUInt32LE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,4,4294967295,0),this[g+3]=p>>>24,this[g+2]=p>>>16,this[g+1]=p>>>8,this[g]=p&255,g+4},A.prototype.writeUint32BE=A.prototype.writeUInt32BE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,4,4294967295,0),this[g]=p>>>24,this[g+1]=p>>>16,this[g+2]=p>>>8,this[g+3]=p&255,g+4};function je(b,p,g,k,N){be(p,k,N,b,g,7);let $=Number(p&BigInt(4294967295));b[g++]=$,$=$>>8,b[g++]=$,$=$>>8,b[g++]=$,$=$>>8,b[g++]=$;let ae=Number(p>>BigInt(32)&BigInt(4294967295));return b[g++]=ae,ae=ae>>8,b[g++]=ae,ae=ae>>8,b[g++]=ae,ae=ae>>8,b[g++]=ae,g}function Fe(b,p,g,k,N){be(p,k,N,b,g,7);let $=Number(p&BigInt(4294967295));b[g+7]=$,$=$>>8,b[g+6]=$,$=$>>8,b[g+5]=$,$=$>>8,b[g+4]=$;let ae=Number(p>>BigInt(32)&BigInt(4294967295));return b[g+3]=ae,ae=ae>>8,b[g+2]=ae,ae=ae>>8,b[g+1]=ae,ae=ae>>8,b[g]=ae,g+8}A.prototype.writeBigUInt64LE=Ee(function(p,g=0){return je(this,p,g,BigInt(0),BigInt("0xffffffffffffffff"))}),A.prototype.writeBigUInt64BE=Ee(function(p,g=0){return Fe(this,p,g,BigInt(0),BigInt("0xffffffffffffffff"))}),A.prototype.writeIntLE=function(p,g,k,N){if(p=+p,g=g>>>0,!N){const at=Math.pow(2,8*k-1);Te(this,p,g,k,at-1,-at)}let $=0,ae=1,Be=0;for(this[g]=p&255;++$<k&&(ae*=256);)p<0&&Be===0&&this[g+$-1]!==0&&(Be=1),this[g+$]=(p/ae>>0)-Be&255;return g+k},A.prototype.writeIntBE=function(p,g,k,N){if(p=+p,g=g>>>0,!N){const at=Math.pow(2,8*k-1);Te(this,p,g,k,at-1,-at)}let $=k-1,ae=1,Be=0;for(this[g+$]=p&255;--$>=0&&(ae*=256);)p<0&&Be===0&&this[g+$+1]!==0&&(Be=1),this[g+$]=(p/ae>>0)-Be&255;return g+k},A.prototype.writeInt8=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,1,127,-128),p<0&&(p=255+p+1),this[g]=p&255,g+1},A.prototype.writeInt16LE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,2,32767,-32768),this[g]=p&255,this[g+1]=p>>>8,g+2},A.prototype.writeInt16BE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,2,32767,-32768),this[g]=p>>>8,this[g+1]=p&255,g+2},A.prototype.writeInt32LE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,4,2147483647,-2147483648),this[g]=p&255,this[g+1]=p>>>8,this[g+2]=p>>>16,this[g+3]=p>>>24,g+4},A.prototype.writeInt32BE=function(p,g,k){return p=+p,g=g>>>0,k||Te(this,p,g,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[g]=p>>>24,this[g+1]=p>>>16,this[g+2]=p>>>8,this[g+3]=p&255,g+4},A.prototype.writeBigInt64LE=Ee(function(p,g=0){return je(this,p,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),A.prototype.writeBigInt64BE=Ee(function(p,g=0){return Fe(this,p,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Me(b,p,g,k,N,$){if(g+k>b.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("Index out of range")}function Ue(b,p,g,k,N){return p=+p,g=g>>>0,N||Me(b,p,g,4),r.write(b,p,g,k,23,4),g+4}A.prototype.writeFloatLE=function(p,g,k){return Ue(this,p,g,!0,k)},A.prototype.writeFloatBE=function(p,g,k){return Ue(this,p,g,!1,k)};function Le(b,p,g,k,N){return p=+p,g=g>>>0,N||Me(b,p,g,8),r.write(b,p,g,k,52,8),g+8}A.prototype.writeDoubleLE=function(p,g,k){return Le(this,p,g,!0,k)},A.prototype.writeDoubleBE=function(p,g,k){return Le(this,p,g,!1,k)},A.prototype.copy=function(p,g,k,N){if(!A.isBuffer(p))throw new TypeError("argument should be a Buffer");if(k||(k=0),!N&&N!==0&&(N=this.length),g>=p.length&&(g=p.length),g||(g=0),N>0&&N<k&&(N=k),N===k||p.length===0||this.length===0)return 0;if(g<0)throw new RangeError("targetStart out of bounds");if(k<0||k>=this.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),p.length-g<N-k&&(N=p.length-g+k);const $=N-k;return this===p&&typeof u.prototype.copyWithin=="function"?this.copyWithin(g,k,N):u.prototype.set.call(p,this.subarray(k,N),g),$},A.prototype.fill=function(p,g,k,N){if(typeof p=="string"){if(typeof g=="string"?(N=g,g=0,k=this.length):typeof k=="string"&&(N=k,k=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!A.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(p.length===1){const ae=p.charCodeAt(0);(N==="utf8"&&ae<128||N==="latin1")&&(p=ae)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(g<0||this.length<g||this.length<k)throw new RangeError("Out of range index");if(k<=g)return this;g=g>>>0,k=k===void 0?this.length:k>>>0,p||(p=0);let $;if(typeof p=="number")for($=g;$<k;++$)this[$]=p;else{const ae=A.isBuffer(p)?p:A.from(p,N),Be=ae.length;if(Be===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for($=0;$<k-g;++$)this[$+g]=ae[$%Be]}return this};const he={};function ye(b,p,g){he[b]=class extends g{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${b}]`,this.stack,delete this.name}get code(){return b}set code(N){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:N,writable:!0})}toString(){return`${this.name} [${b}]: ${this.message}`}}}ye("ERR_BUFFER_OUT_OF_BOUNDS",function(b){return b?`${b} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ye("ERR_INVALID_ARG_TYPE",function(b,p){return`The "${b}" argument must be of type number. Received type ${typeof p}`},TypeError),ye("ERR_OUT_OF_RANGE",function(b,p,g){let k=`The value of "${b}" is out of range.`,N=g;return Number.isInteger(g)&&Math.abs(g)>2**32?N=G(String(g)):typeof g=="bigint"&&(N=String(g),(g>BigInt(2)**BigInt(32)||g<-(BigInt(2)**BigInt(32)))&&(N=G(N)),N+="n"),k+=` It must be ${p}. Received ${N}`,k},RangeError);function G(b){let p="",g=b.length;const k=b[0]==="-"?1:0;for(;g>=k+4;g-=3)p=`_${b.slice(g-3,g)}${p}`;return`${b.slice(0,g)}${p}`}function oe(b,p,g){Ne(p,"offset"),(b[p]===void 0||b[p+g]===void 0)&&_e(p,b.length-(g+1))}function be(b,p,g,k,N,$){if(b>g||b<p){const ae=typeof p=="bigint"?"n":"";let Be;throw p===0||p===BigInt(0)?Be=`>= 0${ae} and < 2${ae} ** ${($+1)*8}${ae}`:Be=`>= -(2${ae} ** ${($+1)*8-1}${ae}) and < 2 ** ${($+1)*8-1}${ae}`,new he.ERR_OUT_OF_RANGE("value",Be,b)}oe(k,N,$)}function Ne(b,p){if(typeof b!="number")throw new he.ERR_INVALID_ARG_TYPE(p,"number",b)}function _e(b,p,g){throw Math.floor(b)!==b?(Ne(b,g),new he.ERR_OUT_OF_RANGE("offset","an integer",b)):p<0?new he.ERR_BUFFER_OUT_OF_BOUNDS:new he.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${p}`,b)}const Ge=/[^+/0-9A-Za-z-_]/g;function bt(b){if(b=b.split("=")[0],b=b.trim().replace(Ge,""),b.length<2)return"";for(;b.length%4!==0;)b=b+"=";return b}function ut(b,p){p=p||1/0;let g;const k=b.length;let N=null;const $=[];for(let ae=0;ae<k;++ae){if(g=b.charCodeAt(ae),g>55295&&g<57344){if(!N){if(g>56319){(p-=3)>-1&&$.push(239,191,189);continue}else if(ae+1===k){(p-=3)>-1&&$.push(239,191,189);continue}N=g;continue}if(g<56320){(p-=3)>-1&&$.push(239,191,189),N=g;continue}g=(N-55296<<10|g-56320)+65536}else N&&(p-=3)>-1&&$.push(239,191,189);if(N=null,g<128){if((p-=1)<0)break;$.push(g)}else if(g<2048){if((p-=2)<0)break;$.push(g>>6|192,g&63|128)}else if(g<65536){if((p-=3)<0)break;$.push(g>>12|224,g>>6&63|128,g&63|128)}else if(g<1114112){if((p-=4)<0)break;$.push(g>>18|240,g>>12&63|128,g>>6&63|128,g&63|128)}else throw new Error("Invalid code point")}return $}function St(b){const p=[];for(let g=0;g<b.length;++g)p.push(b.charCodeAt(g)&255);return p}function Nt(b,p){let g,k,N;const $=[];for(let ae=0;ae<b.length&&!((p-=2)<0);++ae)g=b.charCodeAt(ae),k=g>>8,N=g%256,$.push(N),$.push(k);return $}function Mt(b){return t.toByteArray(bt(b))}function ue(b,p,g,k){let N;for(N=0;N<k&&!(N+g>=p.length||N>=b.length);++N)p[N+g]=b[N];return N}function Re(b,p){return b instanceof p||b!=null&&b.constructor!=null&&b.constructor.name!=null&&b.constructor.name===p.name}function De(b){return b!==b}const se=function(){const b="0123456789abcdef",p=new Array(256);for(let g=0;g<16;++g){const k=g*16;for(let N=0;N<16;++N)p[k+N]=b[g]+b[N]}return p}();function Ee(b){return typeof BigInt>"u"?Ke:b}function Ke(){throw new Error("BigInt not supported")}})($A);const cx=$A.Buffer;function et(s,t,r,i,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),c&&(this.response=c,this.status=c.status?c.status:null)}me.inherits(et,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:me.toJSONObject(this.config),code:this.code,status:this.status}}});const IA=et.prototype,FA={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{FA[s]={value:s}});Object.defineProperties(et,FA);Object.defineProperty(IA,"isAxiosError",{value:!0});et.from=(s,t,r,i,c,u)=>{const f=Object.create(IA);return me.toFlatObject(s,f,function(v){return v!==Error.prototype},m=>m!=="isAxiosError"),et.call(f,s.message,t,r,i,c),f.cause=s,f.name=s.name,u&&Object.assign(f,u),f};const ux=null;function Fd(s){return me.isPlainObject(s)||me.isArray(s)}function HA(s){return me.endsWith(s,"[]")?s.slice(0,-2):s}function Lg(s,t,r){return s?s.concat(t).map(function(c,u){return c=HA(c),!r&&u?"["+c+"]":c}).join(r?".":""):t}function dx(s){return me.isArray(s)&&!s.some(Fd)}const fx=me.toFlatObject(me,{},null,function(t){return/^is[A-Z]/.test(t)});function ac(s,t,r){if(!me.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=me.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,D){return!me.isUndefined(D[U])});const i=r.metaTokens,c=r.visitor||A,u=r.dots,f=r.indexes,v=(r.Blob||typeof Blob<"u"&&Blob)&&me.isSpecCompliantForm(t);if(!me.isFunction(c))throw new TypeError("visitor must be a function");function x(M){if(M===null)return"";if(me.isDate(M))return M.toISOString();if(!v&&me.isBlob(M))throw new et("Blob is not supported. Use a Buffer instead.");return me.isArrayBuffer(M)||me.isTypedArray(M)?v&&typeof Blob=="function"?new Blob([M]):cx.from(M):M}function A(M,U,D){let ne=M;if(M&&!D&&typeof M=="object"){if(me.endsWith(U,"{}"))U=i?U:U.slice(0,-2),M=JSON.stringify(M);else if(me.isArray(M)&&dx(M)||(me.isFileList(M)||me.endsWith(U,"[]"))&&(ne=me.toArray(M)))return U=HA(U),ne.forEach(function(te,B){!(me.isUndefined(te)||te===null)&&t.append(f===!0?Lg([U],B,u):f===null?U:U+"[]",x(te))}),!1}return Fd(M)?!0:(t.append(Lg(D,U,u),x(M)),!1)}const S=[],j=Object.assign(fx,{defaultVisitor:A,convertValue:x,isVisitable:Fd});function C(M,U){if(!me.isUndefined(M)){if(S.indexOf(M)!==-1)throw Error("Circular reference detected in "+U.join("."));S.push(M),me.forEach(M,function(ne,K){(!(me.isUndefined(ne)||ne===null)&&c.call(t,ne,me.isString(K)?K.trim():K,U,j))===!0&&C(ne,U?U.concat(K):[K])}),S.pop()}}if(!me.isObject(s))throw new TypeError("data must be an object");return C(s),t}function zg(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function Tf(s,t){this._pairs=[],s&&ac(s,this,t)}const VA=Tf.prototype;VA.append=function(t,r){this._pairs.push([t,r])};VA.toString=function(t){const r=t?function(i){return t.call(this,i,zg)}:zg;return this._pairs.map(function(c){return r(c[0])+"="+r(c[1])},"").join("&")};function hx(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function YA(s,t,r){if(!t)return s;const i=r&&r.encode||hx;me.isFunction(r)&&(r={serialize:r});const c=r&&r.serialize;let u;if(c?u=c(t,r):u=me.isURLSearchParams(t)?t.toString():new Tf(t,r).toString(i),u){const f=s.indexOf("#");f!==-1&&(s=s.slice(0,f)),s+=(s.indexOf("?")===-1?"?":"&")+u}return s}class Ug{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){me.forEach(this.handlers,function(i){i!==null&&t(i)})}}const GA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mx=typeof URLSearchParams<"u"?URLSearchParams:Tf,px=typeof FormData<"u"?FormData:null,gx=typeof Blob<"u"?Blob:null,Ax={isBrowser:!0,classes:{URLSearchParams:mx,FormData:px,Blob:gx},protocols:["http","https","file","blob","url","data"]},Rf=typeof window<"u"&&typeof document<"u",Hd=typeof navigator=="object"&&navigator||void 0,yx=Rf&&(!Hd||["ReactNative","NativeScript","NS"].indexOf(Hd.product)<0),vx=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",bx=Rf&&window.location.href||"http://localhost",xx=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Rf,hasStandardBrowserEnv:yx,hasStandardBrowserWebWorkerEnv:vx,navigator:Hd,origin:bx},Symbol.toStringTag,{value:"Module"})),An={...xx,...Ax};function Sx(s,t){return ac(s,new An.classes.URLSearchParams,Object.assign({visitor:function(r,i,c,u){return An.isNode&&me.isBuffer(r)?(this.append(i,r.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},t))}function wx(s){return me.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function kx(s){const t={},r=Object.keys(s);let i;const c=r.length;let u;for(i=0;i<c;i++)u=r[i],t[u]=s[u];return t}function XA(s){function t(r,i,c,u){let f=r[u++];if(f==="__proto__")return!0;const m=Number.isFinite(+f),v=u>=r.length;return f=!f&&me.isArray(c)?c.length:f,v?(me.hasOwnProp(c,f)?c[f]=[c[f],i]:c[f]=i,!m):((!c[f]||!me.isObject(c[f]))&&(c[f]=[]),t(r,i,c[f],u)&&me.isArray(c[f])&&(c[f]=kx(c[f])),!m)}if(me.isFormData(s)&&me.isFunction(s.entries)){const r={};return me.forEachEntry(s,(i,c)=>{t(wx(i),c,r,0)}),r}return null}function Cx(s,t,r){if(me.isString(s))try{return(t||JSON.parse)(s),me.trim(s)}catch(i){if(i.name!=="SyntaxError")throw i}return(r||JSON.stringify)(s)}const go={transitional:GA,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",c=i.indexOf("application/json")>-1,u=me.isObject(t);if(u&&me.isHTMLForm(t)&&(t=new FormData(t)),me.isFormData(t))return c?JSON.stringify(XA(t)):t;if(me.isArrayBuffer(t)||me.isBuffer(t)||me.isStream(t)||me.isFile(t)||me.isBlob(t)||me.isReadableStream(t))return t;if(me.isArrayBufferView(t))return t.buffer;if(me.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let m;if(u){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Sx(t,this.formSerializer).toString();if((m=me.isFileList(t))||i.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return ac(m?{"files[]":t}:t,v&&new v,this.formSerializer)}}return u||c?(r.setContentType("application/json",!1),Cx(t)):t}],transformResponse:[function(t){const r=this.transitional||go.transitional,i=r&&r.forcedJSONParsing,c=this.responseType==="json";if(me.isResponse(t)||me.isReadableStream(t))return t;if(t&&me.isString(t)&&(i&&!this.responseType||c)){const f=!(r&&r.silentJSONParsing)&&c;try{return JSON.parse(t)}catch(m){if(f)throw m.name==="SyntaxError"?et.from(m,et.ERR_BAD_RESPONSE,this,null,this.response):m}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:An.classes.FormData,Blob:An.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};me.forEach(["delete","get","head","post","put","patch"],s=>{go.headers[s]={}});const jx=me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_x=s=>{const t={};let r,i,c;return s&&s.split(`
`).forEach(function(f){c=f.indexOf(":"),r=f.substring(0,c).trim().toLowerCase(),i=f.substring(c+1).trim(),!(!r||t[r]&&jx[r])&&(r==="set-cookie"?t[r]?t[r].push(i):t[r]=[i]:t[r]=t[r]?t[r]+", "+i:i)}),t},Bg=Symbol("internals");function Ka(s){return s&&String(s).trim().toLowerCase()}function Rl(s){return s===!1||s==null?s:me.isArray(s)?s.map(Rl):String(s)}function Ex(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=r.exec(s);)t[i[1]]=i[2];return t}const Nx=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function wd(s,t,r,i,c){if(me.isFunction(i))return i.call(this,t,r);if(c&&(t=r),!!me.isString(t)){if(me.isString(i))return t.indexOf(i)!==-1;if(me.isRegExp(i))return i.test(t)}}function Tx(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,i)=>r.toUpperCase()+i)}function Rx(s,t){const r=me.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(s,i+r,{value:function(c,u,f){return this[i].call(this,t,c,u,f)},configurable:!0})})}let _n=class{constructor(t){t&&this.set(t)}set(t,r,i){const c=this;function u(m,v,x){const A=Ka(v);if(!A)throw new Error("header name must be a non-empty string");const S=me.findKey(c,A);(!S||c[S]===void 0||x===!0||x===void 0&&c[S]!==!1)&&(c[S||v]=Rl(m))}const f=(m,v)=>me.forEach(m,(x,A)=>u(x,A,v));if(me.isPlainObject(t)||t instanceof this.constructor)f(t,r);else if(me.isString(t)&&(t=t.trim())&&!Nx(t))f(_x(t),r);else if(me.isHeaders(t))for(const[m,v]of t.entries())u(v,m,i);else t!=null&&u(r,t,i);return this}get(t,r){if(t=Ka(t),t){const i=me.findKey(this,t);if(i){const c=this[i];if(!r)return c;if(r===!0)return Ex(c);if(me.isFunction(r))return r.call(this,c,i);if(me.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Ka(t),t){const i=me.findKey(this,t);return!!(i&&this[i]!==void 0&&(!r||wd(this,this[i],i,r)))}return!1}delete(t,r){const i=this;let c=!1;function u(f){if(f=Ka(f),f){const m=me.findKey(i,f);m&&(!r||wd(i,i[m],m,r))&&(delete i[m],c=!0)}}return me.isArray(t)?t.forEach(u):u(t),c}clear(t){const r=Object.keys(this);let i=r.length,c=!1;for(;i--;){const u=r[i];(!t||wd(this,this[u],u,t,!0))&&(delete this[u],c=!0)}return c}normalize(t){const r=this,i={};return me.forEach(this,(c,u)=>{const f=me.findKey(i,u);if(f){r[f]=Rl(c),delete r[u];return}const m=t?Tx(u):String(u).trim();m!==u&&delete r[u],r[m]=Rl(c),i[m]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return me.forEach(this,(i,c)=>{i!=null&&i!==!1&&(r[c]=t&&me.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const i=new this(t);return r.forEach(c=>i.set(c)),i}static accessor(t){const i=(this[Bg]=this[Bg]={accessors:{}}).accessors,c=this.prototype;function u(f){const m=Ka(f);i[m]||(Rx(c,f),i[m]=!0)}return me.isArray(t)?t.forEach(u):u(t),this}};_n.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);me.reduceDescriptors(_n.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(i){this[r]=i}}});me.freezeMethods(_n);function kd(s,t){const r=this||go,i=t||r,c=_n.from(i.headers);let u=i.data;return me.forEach(s,function(m){u=m.call(r,u,c.normalize(),t?t.status:void 0)}),c.normalize(),u}function QA(s){return!!(s&&s.__CANCEL__)}function Ki(s,t,r){et.call(this,s??"canceled",et.ERR_CANCELED,t,r),this.name="CanceledError"}me.inherits(Ki,et,{__CANCEL__:!0});function KA(s,t,r){const i=r.config.validateStatus;!r.status||!i||i(r.status)?s(r):t(new et("Request failed with status code "+r.status,[et.ERR_BAD_REQUEST,et.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Mx(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function Ox(s,t){s=s||10;const r=new Array(s),i=new Array(s);let c=0,u=0,f;return t=t!==void 0?t:1e3,function(v){const x=Date.now(),A=i[u];f||(f=x),r[c]=v,i[c]=x;let S=u,j=0;for(;S!==c;)j+=r[S++],S=S%s;if(c=(c+1)%s,c===u&&(u=(u+1)%s),x-f<t)return;const C=A&&x-A;return C?Math.round(j*1e3/C):void 0}}function Dx(s,t){let r=0,i=1e3/t,c,u;const f=(x,A=Date.now())=>{r=A,c=null,u&&(clearTimeout(u),u=null),s.apply(null,x)};return[(...x)=>{const A=Date.now(),S=A-r;S>=i?f(x,A):(c=x,u||(u=setTimeout(()=>{u=null,f(c)},i-S)))},()=>c&&f(c)]}const Ql=(s,t,r=3)=>{let i=0;const c=Ox(50,250);return Dx(u=>{const f=u.loaded,m=u.lengthComputable?u.total:void 0,v=f-i,x=c(v),A=f<=m;i=f;const S={loaded:f,total:m,progress:m?f/m:void 0,bytes:v,rate:x||void 0,estimated:x&&m&&A?(m-f)/x:void 0,event:u,lengthComputable:m!=null,[t?"download":"upload"]:!0};s(S)},r)},Pg=(s,t)=>{const r=s!=null;return[i=>t[0]({lengthComputable:r,total:s,loaded:i}),t[1]]},$g=s=>(...t)=>me.asap(()=>s(...t)),Lx=An.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,An.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(An.origin),An.navigator&&/(msie|trident)/i.test(An.navigator.userAgent)):()=>!0,zx=An.hasStandardBrowserEnv?{write(s,t,r,i,c,u){const f=[s+"="+encodeURIComponent(t)];me.isNumber(r)&&f.push("expires="+new Date(r).toGMTString()),me.isString(i)&&f.push("path="+i),me.isString(c)&&f.push("domain="+c),u===!0&&f.push("secure"),document.cookie=f.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ux(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Bx(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function ZA(s,t,r){let i=!Ux(t);return s&&(i||r==!1)?Bx(s,t):t}const qg=s=>s instanceof _n?{...s}:s;function Wr(s,t){t=t||{};const r={};function i(x,A,S,j){return me.isPlainObject(x)&&me.isPlainObject(A)?me.merge.call({caseless:j},x,A):me.isPlainObject(A)?me.merge({},A):me.isArray(A)?A.slice():A}function c(x,A,S,j){if(me.isUndefined(A)){if(!me.isUndefined(x))return i(void 0,x,S,j)}else return i(x,A,S,j)}function u(x,A){if(!me.isUndefined(A))return i(void 0,A)}function f(x,A){if(me.isUndefined(A)){if(!me.isUndefined(x))return i(void 0,x)}else return i(void 0,A)}function m(x,A,S){if(S in t)return i(x,A);if(S in s)return i(void 0,x)}const v={url:u,method:u,data:u,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:m,headers:(x,A,S)=>c(qg(x),qg(A),S,!0)};return me.forEach(Object.keys(Object.assign({},s,t)),function(A){const S=v[A]||c,j=S(s[A],t[A],A);me.isUndefined(j)&&S!==m||(r[A]=j)}),r}const JA=s=>{const t=Wr({},s);let{data:r,withXSRFToken:i,xsrfHeaderName:c,xsrfCookieName:u,headers:f,auth:m}=t;t.headers=f=_n.from(f),t.url=YA(ZA(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),m&&f.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):"")));let v;if(me.isFormData(r)){if(An.hasStandardBrowserEnv||An.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((v=f.getContentType())!==!1){const[x,...A]=v?v.split(";").map(S=>S.trim()).filter(Boolean):[];f.setContentType([x||"multipart/form-data",...A].join("; "))}}if(An.hasStandardBrowserEnv&&(i&&me.isFunction(i)&&(i=i(t)),i||i!==!1&&Lx(t.url))){const x=c&&u&&zx.read(u);x&&f.set(c,x)}return t},Px=typeof XMLHttpRequest<"u",$x=Px&&function(s){return new Promise(function(r,i){const c=JA(s);let u=c.data;const f=_n.from(c.headers).normalize();let{responseType:m,onUploadProgress:v,onDownloadProgress:x}=c,A,S,j,C,M;function U(){C&&C(),M&&M(),c.cancelToken&&c.cancelToken.unsubscribe(A),c.signal&&c.signal.removeEventListener("abort",A)}let D=new XMLHttpRequest;D.open(c.method.toUpperCase(),c.url,!0),D.timeout=c.timeout;function ne(){if(!D)return;const te=_n.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders()),L={data:!m||m==="text"||m==="json"?D.responseText:D.response,status:D.status,statusText:D.statusText,headers:te,config:s,request:D};KA(function(E){r(E),U()},function(E){i(E),U()},L),D=null}"onloadend"in D?D.onloadend=ne:D.onreadystatechange=function(){!D||D.readyState!==4||D.status===0&&!(D.responseURL&&D.responseURL.indexOf("file:")===0)||setTimeout(ne)},D.onabort=function(){D&&(i(new et("Request aborted",et.ECONNABORTED,s,D)),D=null)},D.onerror=function(){i(new et("Network Error",et.ERR_NETWORK,s,D)),D=null},D.ontimeout=function(){let B=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const L=c.transitional||GA;c.timeoutErrorMessage&&(B=c.timeoutErrorMessage),i(new et(B,L.clarifyTimeoutError?et.ETIMEDOUT:et.ECONNABORTED,s,D)),D=null},u===void 0&&f.setContentType(null),"setRequestHeader"in D&&me.forEach(f.toJSON(),function(B,L){D.setRequestHeader(L,B)}),me.isUndefined(c.withCredentials)||(D.withCredentials=!!c.withCredentials),m&&m!=="json"&&(D.responseType=c.responseType),x&&([j,M]=Ql(x,!0),D.addEventListener("progress",j)),v&&D.upload&&([S,C]=Ql(v),D.upload.addEventListener("progress",S),D.upload.addEventListener("loadend",C)),(c.cancelToken||c.signal)&&(A=te=>{D&&(i(!te||te.type?new Ki(null,s,D):te),D.abort(),D=null)},c.cancelToken&&c.cancelToken.subscribe(A),c.signal&&(c.signal.aborted?A():c.signal.addEventListener("abort",A)));const K=Mx(c.url);if(K&&An.protocols.indexOf(K)===-1){i(new et("Unsupported protocol "+K+":",et.ERR_BAD_REQUEST,s));return}D.send(u||null)})},qx=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let i=new AbortController,c;const u=function(x){if(!c){c=!0,m();const A=x instanceof Error?x:this.reason;i.abort(A instanceof et?A:new Ki(A instanceof Error?A.message:A))}};let f=t&&setTimeout(()=>{f=null,u(new et(`timeout ${t} of ms exceeded`,et.ETIMEDOUT))},t);const m=()=>{s&&(f&&clearTimeout(f),f=null,s.forEach(x=>{x.unsubscribe?x.unsubscribe(u):x.removeEventListener("abort",u)}),s=null)};s.forEach(x=>x.addEventListener("abort",u));const{signal:v}=i;return v.unsubscribe=()=>me.asap(m),v}},Ix=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let i=0,c;for(;i<r;)c=i+t,yield s.slice(i,c),i=c},Fx=async function*(s,t){for await(const r of Hx(s))yield*Ix(r,t)},Hx=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:i}=await t.read();if(r)break;yield i}}finally{await t.cancel()}},Ig=(s,t,r,i)=>{const c=Fx(s,t);let u=0,f,m=v=>{f||(f=!0,i&&i(v))};return new ReadableStream({async pull(v){try{const{done:x,value:A}=await c.next();if(x){m(),v.close();return}let S=A.byteLength;if(r){let j=u+=S;r(j)}v.enqueue(new Uint8Array(A))}catch(x){throw m(x),x}},cancel(v){return m(v),c.return()}},{highWaterMark:2})},oc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",WA=oc&&typeof ReadableStream=="function",Vx=oc&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),e0=(s,...t)=>{try{return!!s(...t)}catch{return!1}},Yx=WA&&e0(()=>{let s=!1;const t=new Request(An.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),Fg=64*1024,Vd=WA&&e0(()=>me.isReadableStream(new Response("").body)),Kl={stream:Vd&&(s=>s.body)};oc&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Kl[t]&&(Kl[t]=me.isFunction(s[t])?r=>r[t]():(r,i)=>{throw new et(`Response type '${t}' is not supported`,et.ERR_NOT_SUPPORT,i)})})})(new Response);const Gx=async s=>{if(s==null)return 0;if(me.isBlob(s))return s.size;if(me.isSpecCompliantForm(s))return(await new Request(An.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(me.isArrayBufferView(s)||me.isArrayBuffer(s))return s.byteLength;if(me.isURLSearchParams(s)&&(s=s+""),me.isString(s))return(await Vx(s)).byteLength},Xx=async(s,t)=>{const r=me.toFiniteNumber(s.getContentLength());return r??Gx(t)},Qx=oc&&(async s=>{let{url:t,method:r,data:i,signal:c,cancelToken:u,timeout:f,onDownloadProgress:m,onUploadProgress:v,responseType:x,headers:A,withCredentials:S="same-origin",fetchOptions:j}=JA(s);x=x?(x+"").toLowerCase():"text";let C=qx([c,u&&u.toAbortSignal()],f),M;const U=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let D;try{if(v&&Yx&&r!=="get"&&r!=="head"&&(D=await Xx(A,i))!==0){let L=new Request(t,{method:"POST",body:i,duplex:"half"}),I;if(me.isFormData(i)&&(I=L.headers.get("content-type"))&&A.setContentType(I),L.body){const[E,T]=Pg(D,Ql($g(v)));i=Ig(L.body,Fg,E,T)}}me.isString(S)||(S=S?"include":"omit");const ne="credentials"in Request.prototype;M=new Request(t,{...j,signal:C,method:r.toUpperCase(),headers:A.normalize().toJSON(),body:i,duplex:"half",credentials:ne?S:void 0});let K=await fetch(M);const te=Vd&&(x==="stream"||x==="response");if(Vd&&(m||te&&U)){const L={};["status","statusText","headers"].forEach(z=>{L[z]=K[z]});const I=me.toFiniteNumber(K.headers.get("content-length")),[E,T]=m&&Pg(I,Ql($g(m),!0))||[];K=new Response(Ig(K.body,Fg,E,()=>{T&&T(),U&&U()}),L)}x=x||"text";let B=await Kl[me.findKey(Kl,x)||"text"](K,s);return!te&&U&&U(),await new Promise((L,I)=>{KA(L,I,{data:B,headers:_n.from(K.headers),status:K.status,statusText:K.statusText,config:s,request:M})})}catch(ne){throw U&&U(),ne&&ne.name==="TypeError"&&/fetch/i.test(ne.message)?Object.assign(new et("Network Error",et.ERR_NETWORK,s,M),{cause:ne.cause||ne}):et.from(ne,ne&&ne.code,s,M)}}),Yd={http:ux,xhr:$x,fetch:Qx};me.forEach(Yd,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const Hg=s=>`- ${s}`,Kx=s=>me.isFunction(s)||s===null||s===!1,t0={getAdapter:s=>{s=me.isArray(s)?s:[s];const{length:t}=s;let r,i;const c={};for(let u=0;u<t;u++){r=s[u];let f;if(i=r,!Kx(r)&&(i=Yd[(f=String(r)).toLowerCase()],i===void 0))throw new et(`Unknown adapter '${f}'`);if(i)break;c[f||"#"+u]=i}if(!i){const u=Object.entries(c).map(([m,v])=>`adapter ${m} `+(v===!1?"is not supported by the environment":"is not available in the build"));let f=t?u.length>1?`since :
`+u.map(Hg).join(`
`):" "+Hg(u[0]):"as no adapter specified";throw new et("There is no suitable adapter to dispatch the request "+f,"ERR_NOT_SUPPORT")}return i},adapters:Yd};function Cd(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Ki(null,s)}function Vg(s){return Cd(s),s.headers=_n.from(s.headers),s.data=kd.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),t0.getAdapter(s.adapter||go.adapter)(s).then(function(i){return Cd(s),i.data=kd.call(s,s.transformResponse,i),i.headers=_n.from(i.headers),i},function(i){return QA(i)||(Cd(s),i&&i.response&&(i.response.data=kd.call(s,s.transformResponse,i.response),i.response.headers=_n.from(i.response.headers))),Promise.reject(i)})}const n0="1.8.4",lc={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{lc[s]=function(i){return typeof i===s||"a"+(t<1?"n ":" ")+s}});const Yg={};lc.transitional=function(t,r,i){function c(u,f){return"[Axios v"+n0+"] Transitional option '"+u+"'"+f+(i?". "+i:"")}return(u,f,m)=>{if(t===!1)throw new et(c(f," has been removed"+(r?" in "+r:"")),et.ERR_DEPRECATED);return r&&!Yg[f]&&(Yg[f]=!0,console.warn(c(f," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(u,f,m):!0}};lc.spelling=function(t){return(r,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};function Zx(s,t,r){if(typeof s!="object")throw new et("options must be an object",et.ERR_BAD_OPTION_VALUE);const i=Object.keys(s);let c=i.length;for(;c-- >0;){const u=i[c],f=t[u];if(f){const m=s[u],v=m===void 0||f(m,u,s);if(v!==!0)throw new et("option "+u+" must be "+v,et.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new et("Unknown option "+u,et.ERR_BAD_OPTION)}}const Ml={assertOptions:Zx,validators:lc},gs=Ml.validators;let Kr=class{constructor(t){this.defaults=t,this.interceptors={request:new Ug,response:new Ug}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let c={};Error.captureStackTrace?Error.captureStackTrace(c):c=new Error;const u=c.stack?c.stack.replace(/^.+\n/,""):"";try{i.stack?u&&!String(i.stack).endsWith(u.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+u):i.stack=u}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Wr(this.defaults,r);const{transitional:i,paramsSerializer:c,headers:u}=r;i!==void 0&&Ml.assertOptions(i,{silentJSONParsing:gs.transitional(gs.boolean),forcedJSONParsing:gs.transitional(gs.boolean),clarifyTimeoutError:gs.transitional(gs.boolean)},!1),c!=null&&(me.isFunction(c)?r.paramsSerializer={serialize:c}:Ml.assertOptions(c,{encode:gs.function,serialize:gs.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Ml.assertOptions(r,{baseUrl:gs.spelling("baseURL"),withXsrfToken:gs.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let f=u&&me.merge(u.common,u[r.method]);u&&me.forEach(["delete","get","head","post","put","patch","common"],M=>{delete u[M]}),r.headers=_n.concat(f,u);const m=[];let v=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(r)===!1||(v=v&&U.synchronous,m.unshift(U.fulfilled,U.rejected))});const x=[];this.interceptors.response.forEach(function(U){x.push(U.fulfilled,U.rejected)});let A,S=0,j;if(!v){const M=[Vg.bind(this),void 0];for(M.unshift.apply(M,m),M.push.apply(M,x),j=M.length,A=Promise.resolve(r);S<j;)A=A.then(M[S++],M[S++]);return A}j=m.length;let C=r;for(S=0;S<j;){const M=m[S++],U=m[S++];try{C=M(C)}catch(D){U.call(this,D);break}}try{A=Vg.call(this,C)}catch(M){return Promise.reject(M)}for(S=0,j=x.length;S<j;)A=A.then(x[S++],x[S++]);return A}getUri(t){t=Wr(this.defaults,t);const r=ZA(t.baseURL,t.url,t.allowAbsoluteUrls);return YA(r,t.params,t.paramsSerializer)}};me.forEach(["delete","get","head","options"],function(t){Kr.prototype[t]=function(r,i){return this.request(Wr(i||{},{method:t,url:r,data:(i||{}).data}))}});me.forEach(["post","put","patch"],function(t){function r(i){return function(u,f,m){return this.request(Wr(m||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:u,data:f}))}}Kr.prototype[t]=r(),Kr.prototype[t+"Form"]=r(!0)});let Jx=class s0{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(u){r=u});const i=this;this.promise.then(c=>{if(!i._listeners)return;let u=i._listeners.length;for(;u-- >0;)i._listeners[u](c);i._listeners=null}),this.promise.then=c=>{let u;const f=new Promise(m=>{i.subscribe(m),u=m}).then(c);return f.cancel=function(){i.unsubscribe(u)},f},t(function(u,f,m){i.reason||(i.reason=new Ki(u,f,m),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=i=>{t.abort(i)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new s0(function(c){t=c}),cancel:t}}};function Wx(s){return function(r){return s.apply(null,r)}}function e2(s){return me.isObject(s)&&s.isAxiosError===!0}const Gd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Gd).forEach(([s,t])=>{Gd[t]=s});function r0(s){const t=new Kr(s),r=OA(Kr.prototype.request,t);return me.extend(r,Kr.prototype,t,{allOwnKeys:!0}),me.extend(r,t,null,{allOwnKeys:!0}),r.create=function(c){return r0(Wr(s,c))},r}const ht=r0(go);ht.Axios=Kr;ht.CanceledError=Ki;ht.CancelToken=Jx;ht.isCancel=QA;ht.VERSION=n0;ht.toFormData=ac;ht.AxiosError=et;ht.Cancel=ht.CanceledError;ht.all=function(t){return Promise.all(t)};ht.spread=Wx;ht.isAxiosError=e2;ht.mergeConfig=Wr;ht.AxiosHeaders=_n;ht.formToJSON=s=>XA(me.isHTMLForm(s)?new FormData(s):s);ht.getAdapter=t0.getAdapter;ht.HttpStatusCode=Gd;ht.default=ht;const{Axios:mS,AxiosError:pS,CanceledError:gS,isCancel:AS,CancelToken:yS,VERSION:vS,all:bS,Cancel:xS,isAxiosError:SS,spread:wS,toFormData:kS,AxiosHeaders:CS,HttpStatusCode:jS,formToJSON:_S,getAdapter:ES,mergeConfig:NS}=ht,Ft={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",NONE:"none"},ls={level:Ft.ERROR,enabled:!1,includeTimestamp:!0,groupByContext:!0},Gg={[Ft.DEBUG]:0,[Ft.INFO]:1,[Ft.WARN]:2,[Ft.ERROR]:3,[Ft.NONE]:4},t2=(s,t)=>{let r="";if(s&&(r+=`[${s}] `),ls.includeTimestamp){const c=new Date().toLocaleTimeString();r+=`${c} `}return r+=t,r},bs=(s,t,r,...i)=>{if(!ls.enabled||Gg[s]<Gg[ls.level])return;const c=t2(t,r);if(ls.groupByContext&&t&&i.length>0&&typeof i[0]=="object"){console.groupCollapsed(c),i.forEach(f=>{f!==null&&typeof f=="object"?console.dir(f):console.log(f)}),console.groupEnd();return}switch(s){case Ft.DEBUG:console.debug(c,...i);break;case Ft.INFO:console.info(c,...i);break;case Ft.WARN:console.warn(c,...i);break;case Ft.ERROR:console.error(c,...i);break;default:console.log(c,...i)}},i0=s=>({debug:(t,...r)=>bs(Ft.DEBUG,s,t,...r),info:(t,...r)=>bs(Ft.INFO,s,t,...r),warn:(t,...r)=>bs(Ft.WARN,s,t,...r),error:(t,...r)=>bs(Ft.ERROR,s,t,...r),log:(t,...r)=>bs(Ft.INFO,s,t,...r)}),Rt={debug:(s,...t)=>bs(Ft.DEBUG,"",s,...t),info:(s,...t)=>bs(Ft.INFO,"",s,...t),warn:(s,...t)=>bs(Ft.WARN,"",s,...t),error:(s,...t)=>bs(Ft.ERROR,"",s,...t),log:(s,...t)=>bs(Ft.INFO,"",s,...t),create:s=>i0(s),setLevel:s=>{Ft[s]&&(ls.level=s)},getLevel:()=>ls.level,enable:()=>{ls.enabled=!0},disable:()=>{ls.enabled=!1},isEnabled:()=>ls.enabled,includeTimestamp:(s=!0)=>{ls.includeTimestamp=s},groupByContext:(s=!0)=>{ls.groupByContext=s}},Vi=Rt.create("TokenStorage"),no=()=>{const s=sessionStorage.getItem("token")||localStorage.getItem("token");return s&&Vi.debug("Token retrieved from storage"),s},Ol=(s,t=!1)=>{s&&(sessionStorage.setItem("token",s),Vi.debug("Token stored in sessionStorage"),t?(localStorage.setItem("token",s),Vi.debug("Token also stored in localStorage (remember me)")):localStorage.removeItem("token"))},Yr=()=>{sessionStorage.removeItem("token"),localStorage.removeItem("token"),Vi.debug("Token removed from all storage")},Xd=s=>{if(!s)return!0;try{const r=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),c=JSON.parse(atob(r)).exp*1e3,f=Date.now()>=c-3e4;return f&&Vi.debug(`Token expired at ${new Date(c).toISOString()}`),f}catch(t){return Vi.error("Error parsing JWT token:",t),!0}},We=Rt.create("ApiService"),br=Rt.create("ResponseCache"),jd=Rt.create("NetworkMonitor"),As=Rt.create("RequestQueue");class n2{constructor(t=100,r=6e4){this.cache=new Map,this.maxSize=t,this.ttl=r}generateKey(t,r){const i=r?JSON.stringify(Object.entries(r).sort()):"";return`${t}:${i}`}set(t,r,i){if(!i||!i.success)return null;const c=this.generateKey(t,r),u=Date.now()+this.ttl;if(this.cache.size>=this.maxSize){const f=this.cache.keys().next().value;this.cache.delete(f),br.debug(`Cache full, removing oldest entry: ${f}`)}return this.cache.set(c,{data:i,expiresAt:u}),br.debug(`Cached response for: ${c}`),i}get(t,r){const i=this.generateKey(t,r),c=this.cache.get(i);return c?c.expiresAt<Date.now()?(br.debug(`Cache expired for: ${i}`),this.cache.delete(i),null):(br.debug(`Cache hit for: ${i}`),c.data):(br.debug(`Cache miss for: ${i}`),null)}invalidate(t,r){const i=r?this.generateKey(t,r):null;if(i)this.cache.delete(i),br.debug(`Invalidated cache for: ${i}`);else if(t)for(const c of this.cache.keys())c.startsWith(`${t}:`)&&(this.cache.delete(c),br.debug(`Invalidated cache for: ${c}`));else this.cache.clear(),br.debug("Invalidated entire cache")}}class s2{constructor(t){this.isOnline=navigator.onLine,this.onStatusChange=t,window.addEventListener("online",this.handleOnline.bind(this)),window.addEventListener("offline",this.handleOffline.bind(this)),jd.info(`Network monitor initialized. Online: ${this.isOnline}`)}handleOnline(){jd.info("Network connection restored"),this.isOnline=!0,this.onStatusChange&&this.onStatusChange(!0)}handleOffline(){jd.warn("Network connection lost"),this.isOnline=!1,this.onStatusChange&&this.onStatusChange(!1)}cleanup(){window.removeEventListener("online",this.handleOnline.bind(this)),window.removeEventListener("offline",this.handleOffline.bind(this))}}class r2{constructor(t){this.queue=[],this.apiInstance=t,this.isProcessing=!1,this.maxRetries=3,this.loadFromStorage()}add(t){return this.queue.push({...t,timestamp:Date.now(),retries:0}),As.debug(`Added request to queue: ${t.method} ${t.url}`),this.saveToStorage(),this.queue.length}loadFromStorage(){try{const t=localStorage.getItem("api_request_queue");t&&(this.queue=JSON.parse(t),As.info(`Loaded ${this.queue.length} requests from storage`))}catch(t){As.error("Failed to load queue from storage:",t),this.queue=[]}}saveToStorage(){try{localStorage.setItem("api_request_queue",JSON.stringify(this.queue))}catch(t){As.error("Failed to save queue to storage:",t)}}async processQueue(){if(this.isProcessing||this.queue.length===0)return;this.isProcessing=!0,As.info(`Processing queue with ${this.queue.length} requests`);const t=[];for(let r=0;r<this.queue.length;r++){const i=this.queue[r];try{As.debug(`Processing queued request: ${i.method} ${i.url}`),await this.apiInstance.request({url:i.url,method:i.method,data:i.data,params:i.params,headers:i.headers}),t.push(r),As.debug(`Successfully processed queued request: ${i.method} ${i.url}`)}catch{i.retries++,As.warn(`Failed to process queued request (attempt ${i.retries}): ${i.method} ${i.url}`),i.retries>=this.maxRetries&&(t.push(r),As.error(`Giving up on queued request after ${this.maxRetries} attempts: ${i.method} ${i.url}`))}}for(let r=t.length-1;r>=0;r--)this.queue.splice(t[r],1);this.saveToStorage(),this.isProcessing=!1,As.info(`Queue processing complete. ${t.length} requests processed, ${this.queue.length} remaining`)}}class i2{constructor(){Ad(this,"isValidObjectId",t=>{if(!t)return!1;if(typeof t=="string"&&/^[0-9a-fA-F]{24}$/.test(t))return!0;try{const r=String(t);if(r.length===24&&/^[0-9a-fA-F]{24}$/.test(r))return!0;const i=r.match(/([0-9a-fA-F]{24})/);if(i&&i[1])return!0;const c=r.match(/ObjectId\(['"](.*)['"]\)/);if(c&&c[1]&&/^[0-9a-fA-F]{24}$/.test(c[1]))return!0}catch(r){We.debug(`ObjectId validation error: ${r.message}`)}return!1});Ad(this,"sanitizeObjectId",t=>{if(!t)return null;try{if(typeof t=="string"&&/^[0-9a-fA-F]{24}$/.test(t))return t;const r=String(t),i=r.match(/([0-9a-fA-F]{24})/);if(i&&i[1])return i[1];const c=r.match(/ObjectId\(['"](.*)['"]\)/);if(c&&c[1]&&/^[0-9a-fA-F]{24}$/.test(c[1]))return c[1];if(typeof t=="object"&&t!==null){if(t._id)return this.sanitizeObjectId(t._id);if(t.id)return this.sanitizeObjectId(t.id)}return null}catch(r){return We.error(`Failed to sanitize ObjectId: ${r.message}`),null}});this.baseURL=window.location.hostname.includes("localhost")?"http://localhost:5000/api":"/api",We.info(`Initializing with baseURL: ${this.baseURL}`),this.api=ht.create({baseURL:this.baseURL,headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:15e3}),this.refreshTokenPromise=null,this.requestsToRetry=[],this.pendingRequests=new Map,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,retries:0,avgResponseTime:0},this.cache=new n2(Number.parseInt("100"),Number.parseInt("60000")),this.requestQueue=new r2(this.api),this.networkMonitor=new s2(this._handleNetworkStatusChange.bind(this)),this._initializeInterceptors(),this._loadAuthToken()}_handleNetworkStatusChange(t){t?(We.info("Network connection restored. Processing request queue..."),setTimeout(()=>this.requestQueue.processQueue(),1e3)):We.warn("Network offline. Requests will be queued."),typeof window<"u"&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("apiConnectionStatusChange",{detail:{isOnline:t}}))}_initializeInterceptors(){this.api.interceptors.request.use(this._handleRequest.bind(this),this._handleRequestError.bind(this)),this.api.interceptors.response.use(this._handleResponse.bind(this),this._handleResponseError.bind(this))}_handleRequest(t){const r=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;t.requestId=r,t.startTime=Date.now(),this.pendingRequests.set(r,{config:t,timestamp:Date.now()}),this.metrics.totalRequests++,t.method.toLowerCase()==="get"&&t.headers["x-no-cache"]&&(t.params=t.params||{},t.params._=Date.now());const i=this._getStoredToken();if(i&&Xd(i)&&!t.url.includes("/auth/refresh-token")&&!t._isRefreshRequest&&!t._tokenRefreshRetry){t._tokenRefreshRetry=!0,We.debug(`Token expired before request. Queueing request: ${t.method} ${t.url}`),this.requestsToRetry.push(t),this.refreshToken().catch(u=>{We.warn("Token refresh failed in request handler:",u.message)});const c=ht.CancelToken.source();t.cancelToken=c.token,setTimeout(()=>c.cancel("Token expired. Request will be retried."),0)}return We.debug(`Request: ${t.method.toUpperCase()} ${t.url}`,t.params?`Params: ${JSON.stringify(t.params)}`:""),t}_handleRequestError(t){return We.error("Request error:",t.message),this.metrics.failedRequests++,Promise.reject(t)}_handleResponse(t){const r=Date.now()-t.config.startTime;return this.metrics.successfulRequests++,this.metrics.avgResponseTime=(this.metrics.avgResponseTime*(this.metrics.successfulRequests-1)+r)/this.metrics.successfulRequests,t.config.requestId&&this.pendingRequests.delete(t.config.requestId),We.debug(`Response success: ${t.config.method.toUpperCase()} ${t.config.url} (${r}ms)`),t.config.method.toLowerCase()==="get"&&!t.config.headers["x-no-cache"]&&this.cache.set(t.config.url,t.config.params,t.data),t.data}_handleResponseError(t){var r,i;if(ht.isCancel(t))return We.debug(`Request canceled: ${t.message}`),Promise.reject({success:!1,error:"Request canceled",isCanceled:!0});if((r=t.config)!=null&&r.requestId&&this.pendingRequests.delete(t.config.requestId),!t.response){const c=!navigator.onLine,u=c?"You are currently offline. Please check your connection.":"Network error. Please try again.";return(!c||((i=t.config)==null?void 0:i.method)==="get")&&X.error(u),Promise.reject({success:!1,error:u,isOffline:c,originalError:t})}return this._processHttpError(t)}async _processHttpError(t){const r=t.config,i=t.response.status;if(We.error(`Response error: ${r.method.toUpperCase()} ${r.url}`,`Status: ${i}`,t.response.data),i===401&&!r._retry)return this._handleAuthError(t);const c=t.response.data,u=(c==null?void 0:c.error)||(c==null?void 0:c.message)||(c==null?void 0:c.msg)||(t.response.status===400&&r.url.includes("/like")?"You've already liked this user or reached your daily limit":"An error occurred"),f=(c==null?void 0:c.code)||null;return this._showErrorNotification(i,u,f),Promise.reject({success:!1,error:u,code:f,status:i,data:t.response.data})}async _handleAuthError(t){const r=t.config;if(r._retry=!0,r.url.includes("/auth/refresh-token"))return We.warn("Refresh token request failed"),this._handleLogout("Session expired. Please log in again."),Promise.reject({success:!1,error:"Authentication failed",status:401});We.debug("Received 401 error. Attempting token refresh...");try{const i=await this.refreshToken();if(i)return We.debug("Token refreshed successfully. Retrying original request."),r.headers.Authorization=`Bearer ${i}`,r.headers["x-auth-token"]=i,this.api(r);throw We.warn("Token refresh returned null"),this._getStoredToken()&&this._handleLogout("Session expired. Please log in again."),new Error("Failed to refresh token")}catch(i){return We.error("Token refresh failed:",i),this._getStoredToken()&&this._handleLogout("Session expired. Please log in again."),Promise.reject({success:!1,error:"Authentication failed",status:401})}}_showErrorNotification(t,r,i){if(!document.hidden)switch(t){case 400:X.error(`Request error: ${r}`);break;case 403:X.error(`Access denied: ${r}`);break;case 404:X.error(`Not found: ${r}`);break;case 422:X.error(`Validation error: ${r}`);break;case 429:X.error("Too many requests. Please try again later.");break;case 500:case 502:case 503:case 504:X.error(`Server error (${t}). Please try again later.`);break;default:X.error(r)}}_handleLogout(t){this._removeToken(),this.setAuthToken(null),X.error(t),typeof window<"u"&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("authLogout"))}_getStoredToken(){return no()}_storeToken(t,r=!1){t&&Ol(t,r)}_removeToken(){Yr()}_loadAuthToken(){const t=this._getStoredToken();return t?(this.setAuthToken(t),Xd(t)&&(We.info("Token expired, attempting to refresh"),this.refreshToken().catch(r=>{We.warn("Token refresh failed on initialization:",r)})),t):null}setAuthToken(t){t?(this.api.defaults.headers.common.Authorization=`Bearer ${t}`,this.api.defaults.headers.common["x-auth-token"]=t,ht.defaults.headers.common.Authorization=`Bearer ${t}`,ht.defaults.headers.common["x-auth-token"]=t,We.debug("Auth token set in all API instances")):(delete this.api.defaults.headers.common.Authorization,delete this.api.defaults.headers.common["x-auth-token"],delete ht.defaults.headers.common.Authorization,delete ht.defaults.headers.common["x-auth-token"],We.debug("Auth token removed from all API instances"))}async refreshToken(){return this.refreshTokenPromise?this.refreshTokenPromise:(this.refreshTokenPromise=(async()=>{try{We.info("Refreshing authentication token...");const t=this._getStoredToken();if(!t)return We.warn("No token available for refresh"),null;const r=await ht.post(`${this.baseURL}/auth/refresh-token`,{token:t},{headers:{"Content-Type":"application/json","x-no-cache":"true"}});if(r.data&&r.data.success&&r.data.token){const i=r.data.token;this._storeToken(i,localStorage.getItem("token")!==null),this.setAuthToken(i),We.info("Token refreshed successfully"),this._retryQueuedRequests(i);try{const c=JSON.parse(atob(i.split(".")[1]));if(c.exp){const u=c.exp*1e3-Date.now()-6e4;u>0&&(this.tokenRefreshTimer=setTimeout(()=>this.refreshToken(),u),We.debug(`Scheduled next token refresh in ${Math.round(u/1e3)} seconds`))}}catch(c){We.error("Error scheduling token refresh:",c)}return i}else throw We.warn("Invalid refresh token response:",r.data),new Error("Invalid refresh token response")}catch(t){return We.error("Token refresh failed:",t),t.response&&(t.response.status===401||t.response.status===403)&&(this._removeToken(),this.setAuthToken(null),X.error("Your session has expired. Please log in again."),typeof window<"u"&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("authLogout"))),null}finally{setTimeout(()=>{this.refreshTokenPromise=null},1e3)}})(),this.refreshTokenPromise)}_retryQueuedRequests(t){const r=[...this.requestsToRetry];this.requestsToRetry=[],We.info(`Retrying ${r.length} queued requests with new token`),r.forEach(i=>{i.headers.Authorization=`Bearer ${t}`,i.headers["x-auth-token"]=t,this.api(i).catch(c=>{We.error(`Error retrying queued request: ${i.method} ${i.url}`,c)})})}_processResponse(t){return t&&typeof t.success=="boolean"?t:t&&t.error?{success:!1,error:t.error,data:t}:{success:!0,data:t}}async get(t,r={},i={}){var c;try{const u=t.match(/\/([^/]+)$/);if(u&&u[1]&&!t.includes("?")&&!t.endsWith("/")){const v=u[1];if(v.length>=24||v.includes("ObjectId")){const x=this.sanitizeObjectId(v);if(x&&x!==v)We.debug(`Sanitized ObjectId in URL: ${v} -> ${x}`),t=t.replace(v,x);else if(v.length===24&&!this.isValidObjectId(v))return We.error(`Invalid ObjectId in request: ${v}`),{success:!1,error:"Invalid ID format",status:400}}}const f={...r};for(const v in f)if(v.toLowerCase().includes("id")&&f[v]){const x=this.sanitizeObjectId(f[v]);x&&(We.debug(`Sanitized param ${v}: ${f[v]} -> ${x}`),f[v]=x)}const m=await this.api.get(t,{params:f,...i,cancelToken:((c=i.request)==null?void 0:c.cancelToken)||i.cancelToken});return this._processResponse(m)}catch(u){throw We.error(`GET request failed: ${t}`,u),u}}async post(t,r={},i={}){var c;try{i.invalidateCache!==!1&&this.cache.invalidate(t);const u={...r};this._sanitizeObjectInPlace(u);const f=await this.api.post(t,u,{...i,cancelToken:((c=i.request)==null?void 0:c.cancelToken)||i.cancelToken});return this._processResponse(f)}catch(u){throw We.error(`POST request failed: ${t}`,u),u}}_sanitizeObjectInPlace(t){!t||typeof t!="object"||Object.keys(t).forEach(r=>{if((r==="_id"||r==="id"||r.endsWith("Id"))&&t[r]){const i=this.sanitizeObjectId(t[r]);i&&(t[r]=i)}else t[r]&&typeof t[r]=="object"&&(Array.isArray(t[r])?t[r].forEach(i=>{i&&typeof i=="object"&&this._sanitizeObjectInPlace(i)}):this._sanitizeObjectInPlace(t[r]))})}async put(t,r={},i={}){var c;try{i.invalidateCache!==!1&&this.cache.invalidate(t);const u={...r};this._sanitizeObjectInPlace(u);const f=await this.api.put(t,u,{...i,cancelToken:((c=i.request)==null?void 0:c.cancelToken)||i.cancelToken});return this._processResponse(f)}catch(u){throw We.error(`PUT request failed: ${t}`,u),u}}async delete(t,r={}){var i;try{r.invalidateCache!==!1&&this.cache.invalidate(t);const c=t.match(/\/([^/]+)$/);if(c&&c[1]&&!t.includes("?")&&!t.endsWith("/")){const f=c[1];if(f.length>=24||f.includes("ObjectId")){const m=this.sanitizeObjectId(f);m&&m!==f&&(We.debug(`Sanitized ObjectId in DELETE URL: ${f} -> ${m}`),t=t.replace(f,m))}}const u=await this.api.delete(t,{...r,cancelToken:((i=r.request)==null?void 0:i.cancelToken)||r.cancelToken});return this._processResponse(u)}catch(c){throw We.error(`DELETE request failed: ${t}`,c),c}}async upload(t,r,i=null,c={}){var u;try{const f=((u=c.request)==null?void 0:u.cancelToken)||c.cancelToken||ht.CancelToken.source().token;return await this.api.post(t,r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i?v=>{const x=Math.round(v.loaded*100/v.total);i(x)}:void 0,cancelToken:f,...c})}catch(f){throw We.error(`Upload failed: ${t}`,f),f}}async download(t,r={},i=null,c={}){var u;try{const f=((u=c.request)==null?void 0:u.cancelToken)||c.cancelToken||ht.CancelToken.source().token;return await this.api.get(t,{params:r,responseType:"blob",onDownloadProgress:i?v=>{const x=Math.round(v.loaded*100/v.total);i(x)}:void 0,cancelToken:f,...c})}catch(f){throw We.error(`Download failed: ${t}`,f),f}}createCancelToken(){return ht.CancelToken.source()}createCancelableRequest(){const t=ht.CancelToken.source();return{request:{cancelToken:t.token},cancel:()=>t.cancel("Request canceled")}}isCancel(t){return ht.isCancel(t)}cancelAllRequests(t="Request canceled by user"){const r=this.pendingRequests.size;if(r>0){We.info(`Canceling ${r} pending requests: ${t}`);for(const[i,c]of this.pendingRequests.entries())ht.CancelToken.source().cancel(t),this.pendingRequests.delete(i)}}async testConnection(){try{const{request:t,cancel:r}=this.createCancelableRequest(),i=setTimeout(()=>{r("Connection test timeout")},5e3),c=await this.get("/auth/test-connection",{},{request:t});return clearTimeout(i),{success:!0,data:c,ping:c.timestamp?new Date-new Date(c.timestamp):null}}catch(t){return{success:!1,error:t.error||t.message||"Connection test failed",isOffline:!navigator.onLine}}}async getHealthStatus(){try{return{success:!0,data:await this.get("/health",{},{timeout:3e3})}}catch(t){return{success:!1,error:t.error||t.message||"Health check failed"}}}getMetrics(){return{...this.metrics}}clearCache(t=null){this.cache.invalidate(t)}processQueue(){navigator.onLine&&this.requestQueue.processQueue()}cleanup(){this.cancelAllRequests("API service cleanup"),this.networkMonitor&&this.networkMonitor.cleanup()}async login(t,r=!1){try{const i=await this.post("/auth/login",t);if(i.success&&i.token)return this._storeToken(i.token,r),this.setAuthToken(i.token),i;throw new Error(i.error||"Invalid login response")}catch(i){throw i}}async logout(){try{this._getStoredToken()&&await this.post("/auth/logout")}catch(t){We.warn("Logout request failed:",t)}finally{this._removeToken(),this.setAuthToken(null),this.cancelAllRequests("User logout"),this.clearCache()}}}const Pe=new i2;typeof window<"u"&&window.addEventListener("unload",()=>{Pe.pendingRequests.forEach(s=>{var t,r;(r=(t=s.config)==null?void 0:t.cancelToken)!=null&&r.cancel&&s.config.cancelToken.cancel("Navigation canceled request")})});const Qd=(s,t)=>{var i,c,u,f,m,v,x;if(!s)return"No messages yet";const r=s.sender===t?"You: ":"";switch(s.type){case"text":const A=s.content||"";return r+(A.length>25?`${A.substring(0,25)}...`:A);case"wink":return r+"Sent a wink ";case"file":return(c=(i=s.metadata)==null?void 0:i.fileType)!=null&&c.startsWith("image/")?r+"Sent an image":(f=(u=s.metadata)==null?void 0:u.fileType)!=null&&f.startsWith("video/")?r+"Sent a video":(v=(m=s.metadata)==null?void 0:m.fileType)!=null&&v.startsWith("audio/")?r+"Sent an audio file":((x=s.metadata)==null?void 0:x.fileType)==="application/pdf"?r+"Sent a PDF document":r+"Sent a file";case"video":return r+"Video Call";default:return r+"New message"}},Mf=s=>{const t={};return Array.isArray(s)&&s.forEach(r=>{if(r&&r.createdAt){const i=new Date(r.createdAt).toDateString();t[i]=t[i]||[],t[i].push(r)}}),t},a0=s=>s?s.startsWith("image/")?"image":s.startsWith("video/")?"video":s.startsWith("audio/")?"audio":s==="application/pdf"?"pdf":"file":"file",o0=["","","","","","","","","","","",""],Zr=(...s)=>s.filter(Boolean).join(" "),l0=()=>{const s=localStorage.getItem("token")||sessionStorage.getItem("token"),t=!!s;localStorage.removeItem("token"),sessionStorage.removeItem("token"),localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),localStorage.removeItem("user"),sessionStorage.removeItem("user"),localStorage.clear(),sessionStorage.clear(),console.log(" User session reset completely!"),t&&s&&(console.log(" Re-saving token to localStorage only"),localStorage.setItem("token",s)),alert("Session reset completed. You'll be redirected to login page."),window.location.href="/login"},Of=()=>{try{const s=document.createElement("div");s.style.position="fixed",s.style.top="20px",s.style.left="20px",s.style.padding="20px",s.style.backgroundColor="white",s.style.border="1px solid black",s.style.zIndex="10000",s.style.maxWidth="80%",s.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5)",s.innerHTML='<h3> Emergency User ID Fix Tool</h3><div id="status">Analyzing user data...</div>',document.body.appendChild(s);const t=i=>{document.getElementById("status").innerHTML+=`<br>${i}`},r=localStorage.getItem("token")||sessionStorage.getItem("token");if(!r){t(" No token found. Please log in again.");return}t(" Token found"),localStorage.clear(),sessionStorage.clear(),localStorage.setItem("token",r),t(" Session data reset, token preserved"),t(" Reloading page in 2 seconds..."),setTimeout(()=>{window.location.reload()},2e3)}catch(s){console.error("Error in emergency fix:",s),alert("Error fixing user ID. Try logging out and back in.")}};window.fixMyUserId=Of;const Kd=s=>{if(!s)return null;const t=typeof s=="string"?s:String(s);if(/^[0-9a-fA-F]{24}$/.test(t))return t;if(t.length>24){const i=t.match(/([0-9a-fA-F]{24})/);if(i&&i[1])return i[1]}const r=t.match(/ObjectId\(['"](.*)['"]\)/);if(r&&r[1]){const i=r[1];if(/^[0-9a-fA-F]{24}$/.test(i))return i}return typeof s=="object"&&s!==null&&s._id?Kd(s._id):typeof s=="object"&&s!==null&&s.id?Kd(s.id):null},c0=()=>{if(window._objectIdRequestsPatched)return;window._objectIdRequestsPatched=!0,console.log(" Installing API ObjectId request patch");const s=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){this.addEventListener("readystatechange",function(){if(this.readyState===4&&this.status===400)try{const t=JSON.parse(this.responseText);t.error&&(t.error==="Invalid user ID format"||t.error==="Invalid authenticated user ID format"||t.error==="Invalid user ID format in request")&&(console.warn(" Caught ObjectId validation error:",t.error),confirm("Session ID format error detected. Apply emergency fix?")&&Of())}catch{}}),s.apply(this,arguments)},console.log(" API ObjectId request patch installed")};c0();const _d=new Map,u0=new Set,Zi=s=>{if(!s)return`${window.location.origin}/placeholder.svg`;if(_d.has(s))return _d.get(s);if(u0.has(s))return`${window.location.origin}/placeholder.svg`;let t;if(s==="/default-avatar.png"||s==="/placeholder.svg")t=`${window.location.origin}${s}`;else if(s.startsWith("http"))t=s;else if(/^[0-9a-f]{24}$/i.test(s))t=`${window.location.origin}/api/avatars/${s}`;else if(s.startsWith("/uploads/"))t=`${window.location.origin}${s}`;else if(s.includes("/images/")||s.includes("/photos/")){const r=s.startsWith("/uploads")?s:`/uploads${s.startsWith("/")?"":"/"}${s}`;t=`${window.location.origin}${r}`}else s.startsWith("/")?t=`${window.location.origin}${s}`:t=s;return _d.set(s,t),t},Df=s=>(u0.add(s),`${window.location.origin}/placeholder.svg`),Gs=(s,t={})=>{const{showTime:r=!0,showDate:i=!0,showRelative:c=!1,locale:u="en-US"}=t;if(!s)return"";const f=typeof s=="string"?new Date(s):s;if(isNaN(f.getTime()))return"";if(c){const x=new Date-f,A=Math.floor(x/1e3),S=Math.floor(A/60),j=Math.floor(S/60),C=Math.floor(j/24);if(A<60)return"just now";if(S<60)return`${S}m ago`;if(j<24)return`${j}h ago`;if(C<7)return`${C}d ago`}let m="";if(i&&(m=f.toLocaleDateString(u,{year:"numeric",month:"short",day:"numeric"})),r){const v=f.toLocaleTimeString(u,{hour:"2-digit",minute:"2-digit"});m=i?`${m}, ${v}`:v}return m},a2=Object.freeze(Object.defineProperty({__proto__:null,LogLevel:Ft,classNames:Zr,commonEmojis:o0,createLogger:i0,emergencyUserIdFix:Of,ensureValidObjectId:Kd,formatDate:Gs,formatMessagePreview:Qd,getFileIconType:a0,groupMessagesByDate:Mf,logger:Rt,markUrlAsFailed:Df,normalizePhotoUrl:Zi,patchApiObjectIdRequests:c0,resetUserSession:l0},Symbol.toStringTag,{value:"Module"})),Ys=Rt.create("AuthContext"),d0=y.createContext(),Ot=()=>y.useContext(d0),o2=({children:s})=>{const t=W=>{var re;if(!W){Ys.warn("Received null or undefined user data"),i(null);return}const H={...W};if(H._id,H._id&&typeof H._id!="string"){Ys.warn(`Converting non-string ID to string: ${typeof H._id} -> string`);try{H._id=H._id.toString()}catch(pe){Ys.error(`Failed to convert user._id to string: ${pe.message}`)}}if(H._id&&/^[0-9a-fA-F]{24}$/.test(H._id))Ys.debug(`User has valid ID: ${H._id}`),i(H);else{Ys.warn(`User data has invalid ID format: "${H._id}"`),Ys.debug(`ID type: ${typeof H._id}, Length: ${((re=H._id)==null?void 0:re.length)||0}`);{X.error("Authentication error: Your user profile has an invalid format. Please try logging in again."),i(null),x(!1),Yr();return}}},[r,i]=y.useState(null),[c,u]=y.useState(!0),[f,m]=y.useState(null),[v,x]=y.useState(!1),[A,S]=y.useState(!1),j=y.useRef(null),C=y.useRef(null),M=y.useRef(null),U=y.useRef(!1),D=y.useCallback(()=>{m(null)},[]),ne=y.useCallback(async()=>{if(!r||!r._id)return console.error("Cannot fix user ID: No user or user ID available"),!1;const{ensureValidObjectId:W}=await jn(async()=>{const{ensureValidObjectId:q}=await Promise.resolve().then(()=>a2);return{ensureValidObjectId:q}},void 0),H=W(r._id);if(H){if(H===r._id)return Ys.debug("User ID is already in valid format:",H),!0;const q={...r,_id:H};return i(q),Ys.info(`User ID fixed to: ${H} (was: ${r._id})`),!0}return Ys.error(`Cannot fix user ID format: ${r._id}`),!1},[r]),K=y.useCallback(async()=>{u(!0);try{C.current&&(clearTimeout(C.current),C.current=null);try{await Pe.logout()}catch(W){console.warn("Logout API call failed:",W)}Yr(),i(null),x(!1),X.info("You have been logged out")}catch(W){console.error("Logout error:",W),Yr(),i(null),x(!1)}finally{u(!1)}},[]),te=y.useCallback(W=>{C.current&&(clearTimeout(C.current),C.current=null);try{const q=W.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),re=JSON.parse(atob(q));if(re.exp){const pe=re.exp*1e3,ce=Date.now(),R=pe-ce-5*60*1e3;if(R>6e4){console.log(`Scheduling token refresh in ${Math.round(R/6e4)} minutes`);const Q=setTimeout(()=>{B()},R);C.current=Q}else console.log("Token expires soon, refreshing now"),B()}}catch(H){console.error("Error scheduling token refresh:",H)}},[]),B=y.useCallback(()=>!v&&!no()?Promise.resolve(null):(j.current||(j.current=(async()=>{var H;const W=no();if(!W)return null;try{console.log("Refreshing auth token...");const q=await Pe.post("/auth/refresh-token",{token:W},{headers:{"x-no-cache":"true"},_isRefreshRequest:!0});if(q.success&&q.token){const re=q.token,pe=localStorage.getItem("token")!==null;return Ol(re,pe),te(re),console.log("Token refreshed successfully"),re}else throw new Error("Invalid refresh response")}catch(q){if(console.error("Token refresh failed:",q),j.current=null,((H=q==null?void 0:q.response)==null?void 0:H.status)===401||(q==null?void 0:q.status)===401)K();else{const re=no();re&&Xd(re)&&(console.log("Token expired, logging out"),X.error("Your session has expired. Please log in again."),K())}return null}finally{setTimeout(()=>{j.current=null},1e3)}})()),j.current),[v,K,te]),L=y.useCallback(async W=>{u(!0),m(null);try{const H=await Pe.post("/auth/register",W);return H.success?(H.token&&(Ol(H.token,!1),t(H.user),x(!0),te(H.token)),u(!1),!0):(m(H.error||"Registration failed"),u(!1),!1)}catch(H){if(console.error("Registration error:",H),H.response&&H.response.data)if(H.response.data.error){const q=H.response.data.error;throw m(q),new Error(q)}else if(H.response.data.errors&&H.response.data.errors.length>0){const q=H.response.data.errors[0].msg;throw m(q),new Error(q)}else{const q="Registration failed. Please check your information and try again.";throw m(q),new Error(q)}else{const q=H.message||"Network error. Please check your connection and try again.";throw m(q),new Error(q)}}finally{u(!1)}},[te]),I=y.useCallback(async()=>{var W;try{if(!localStorage.getItem("token"))return!1;if((await Pe.get("/auth/verify")).success)return!0;const re=await Pe.post("/auth/refresh");return re.success&&((W=re.data)!=null&&W.token)?(localStorage.setItem("token",re.data.token),!0):(K(),!1)}catch(H){return console.error("Token refresh error:",H),!1}},[K]),E=y.useCallback(async(W,H=!1)=>{u(!0),m(null);try{const q=await Pe.post("/auth/login",W);if(q.success&&q.token){if(Ol(q.token,H),te(q.token),q.user){t(q.user),Promise.all([jn(()=>Promise.resolve().then(()=>Fi),void 0),jn(()=>Promise.resolve().then(()=>qi),void 0)]).then(([pe,ce])=>{var Y,P;const R=pe.default,Q=ce.default;(Y=q.user.settings)!=null&&Y.notifications?R.initialize(q.user.settings):R.initialize(),(P=q.user.settings)!=null&&P.privacy&&Q.updatePrivacySettings(q.user.settings.privacy),console.log("Services initialized with user settings")}).catch(pe=>{console.error("Failed to initialize services:",pe)});const re=q.user.nickname?`Welcome back, ${q.user.nickname}!`:"Welcome back!";X.success(re)}else try{const re=await Pe.get("/auth/me");if(re.success&&re.data){t(re.data),Promise.all([jn(()=>Promise.resolve().then(()=>Fi),void 0),jn(()=>Promise.resolve().then(()=>qi),void 0)]).then(([ce,R])=>{var P,ie;const Q=ce.default,Y=R.default;(P=re.data.settings)!=null&&P.notifications?Q.initialize(re.data.settings):Q.initialize(),(ie=re.data.settings)!=null&&ie.privacy&&Y.updatePrivacySettings(re.data.settings.privacy),console.log("Services initialized with user settings")}).catch(ce=>{console.error("Failed to initialize services:",ce)});const pe=re.data.nickname?`Welcome back, ${re.data.nickname}!`:"Welcome back!";X.success(pe)}else X.success("Welcome back!")}catch(re){console.error("Error fetching user data:",re),X.success("Welcome back!")}return x(!0),q}else throw new Error(q.error||"Login failed")}catch(q){const re=q.error||q.message||"Login failed";throw m(re),X.error(re),q}finally{u(!1)}},[te]),T=y.useCallback(async()=>{u(!0);try{const W=await Pe.get("/auth/me");if(W.success)return t(W.data),x(!0),Promise.all([jn(()=>Promise.resolve().then(()=>Fi),void 0),jn(()=>Promise.resolve().then(()=>qi),void 0)]).then(([H,q])=>{var ce,R;const re=H.default,pe=q.default;(ce=W.data.settings)!=null&&ce.notifications?re.initialize(W.data.settings):re.initialize(),(R=W.data.settings)!=null&&R.privacy&&pe.updatePrivacySettings(W.data.settings.privacy),console.log("Services initialized with user settings")}).catch(H=>{console.error("Failed to initialize services:",H)}),W.data;throw new Error(W.error||"Failed to get user profile")}catch(W){return console.error("Get current user error:",W),i(null),x(!1),null}finally{u(!1),S(!0),U.current=!0}},[]);y.useEffect(()=>{M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{c&&(console.warn("Auth check timeout - forcing loading state to false"),u(!1),S(!0),U.current=!0,localStorage.getItem("token")&&(console.info("Auth recovery: Setting minimal authenticated state based on token"),x(!0)))},8e3);const W=async()=>{try{if(S(!1),!localStorage.getItem("token")){x(!1),i(null),S(!0),u(!1),U.current=!0,clearTimeout(M.current);return}const q=await Pe.get("/auth/me");q.success&&q.data?(t(q.data),x(!0)):await I()||(x(!1),i(null),Yr())}catch(H){console.error("Auth check error:",H),x(!1),i(null),Yr()}finally{S(!0),u(!1),U.current=!0,clearTimeout(M.current)}};return U.current||W(),()=>{M.current&&(clearTimeout(M.current),M.current=null)}},[T,B,I]),y.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]),y.useEffect(()=>{const W=()=>{C.current&&(clearTimeout(C.current),C.current=null),i(null),x(!1),Yr()};return window.addEventListener("authLogout",W),()=>{window.removeEventListener("authLogout",W)}},[]);const z={user:r,loading:c,error:f,isAuthenticated:v,authChecked:A,register:L,login:E,logout:K,refreshToken:B,getCurrentUser:T,clearError:D,fixUserIdFormat:ne,token:no()};return o.jsx(d0.Provider,{value:z,children:s})},ws=Object.create(null);ws.open="0";ws.close="1";ws.ping="2";ws.pong="3";ws.message="4";ws.upgrade="5";ws.noop="6";const Dl=Object.create(null);Object.keys(ws).forEach(s=>{Dl[ws[s]]=s});const Zd={type:"error",data:"parser error"},f0=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",h0=typeof ArrayBuffer=="function",m0=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,Lf=({type:s,data:t},r,i)=>f0&&t instanceof Blob?r?i(t):Xg(t,i):h0&&(t instanceof ArrayBuffer||m0(t))?r?i(t):Xg(new Blob([t]),i):i(ws[s]+(t||"")),Xg=(s,t)=>{const r=new FileReader;return r.onload=function(){const i=r.result.split(",")[1];t("b"+(i||""))},r.readAsDataURL(s)};function Qg(s){return s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):new Uint8Array(s.buffer,s.byteOffset,s.byteLength)}let Ed;function l2(s,t){if(f0&&s.data instanceof Blob)return s.data.arrayBuffer().then(Qg).then(t);if(h0&&(s.data instanceof ArrayBuffer||m0(s.data)))return t(Qg(s.data));Lf(s,!1,r=>{Ed||(Ed=new TextEncoder),t(Ed.encode(r))})}const Kg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",so=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<Kg.length;s++)so[Kg.charCodeAt(s)]=s;const c2=s=>{let t=s.length*.75,r=s.length,i,c=0,u,f,m,v;s[s.length-1]==="="&&(t--,s[s.length-2]==="="&&t--);const x=new ArrayBuffer(t),A=new Uint8Array(x);for(i=0;i<r;i+=4)u=so[s.charCodeAt(i)],f=so[s.charCodeAt(i+1)],m=so[s.charCodeAt(i+2)],v=so[s.charCodeAt(i+3)],A[c++]=u<<2|f>>4,A[c++]=(f&15)<<4|m>>2,A[c++]=(m&3)<<6|v&63;return x},u2=typeof ArrayBuffer=="function",zf=(s,t)=>{if(typeof s!="string")return{type:"message",data:p0(s,t)};const r=s.charAt(0);return r==="b"?{type:"message",data:d2(s.substring(1),t)}:Dl[r]?s.length>1?{type:Dl[r],data:s.substring(1)}:{type:Dl[r]}:Zd},d2=(s,t)=>{if(u2){const r=c2(s);return p0(r,t)}else return{base64:!0,data:s}},p0=(s,t)=>{switch(t){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}},g0="",f2=(s,t)=>{const r=s.length,i=new Array(r);let c=0;s.forEach((u,f)=>{Lf(u,!1,m=>{i[f]=m,++c===r&&t(i.join(g0))})})},h2=(s,t)=>{const r=s.split(g0),i=[];for(let c=0;c<r.length;c++){const u=zf(r[c],t);if(i.push(u),u.type==="error")break}return i};function m2(){return new TransformStream({transform(s,t){l2(s,r=>{const i=r.length;let c;if(i<126)c=new Uint8Array(1),new DataView(c.buffer).setUint8(0,i);else if(i<65536){c=new Uint8Array(3);const u=new DataView(c.buffer);u.setUint8(0,126),u.setUint16(1,i)}else{c=new Uint8Array(9);const u=new DataView(c.buffer);u.setUint8(0,127),u.setBigUint64(1,BigInt(i))}s.data&&typeof s.data!="string"&&(c[0]|=128),t.enqueue(c),t.enqueue(r)})}})}let Nd;function _l(s){return s.reduce((t,r)=>t+r.length,0)}function El(s,t){if(s[0].length===t)return s.shift();const r=new Uint8Array(t);let i=0;for(let c=0;c<t;c++)r[c]=s[0][i++],i===s[0].length&&(s.shift(),i=0);return s.length&&i<s[0].length&&(s[0]=s[0].slice(i)),r}function p2(s,t){Nd||(Nd=new TextDecoder);const r=[];let i=0,c=-1,u=!1;return new TransformStream({transform(f,m){for(r.push(f);;){if(i===0){if(_l(r)<1)break;const v=El(r,1);u=(v[0]&128)===128,c=v[0]&127,c<126?i=3:c===126?i=1:i=2}else if(i===1){if(_l(r)<2)break;const v=El(r,2);c=new DataView(v.buffer,v.byteOffset,v.length).getUint16(0),i=3}else if(i===2){if(_l(r)<8)break;const v=El(r,8),x=new DataView(v.buffer,v.byteOffset,v.length),A=x.getUint32(0);if(A>Math.pow(2,21)-1){m.enqueue(Zd);break}c=A*Math.pow(2,32)+x.getUint32(4),i=3}else{if(_l(r)<c)break;const v=El(r,c);m.enqueue(zf(u?v:Nd.decode(v),t)),i=0}if(c===0||c>s){m.enqueue(Zd);break}}}})}const A0=4;function Kt(s){if(s)return g2(s)}function g2(s){for(var t in Kt.prototype)s[t]=Kt.prototype[t];return s}Kt.prototype.on=Kt.prototype.addEventListener=function(s,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(t),this};Kt.prototype.once=function(s,t){function r(){this.off(s,r),t.apply(this,arguments)}return r.fn=t,this.on(s,r),this};Kt.prototype.off=Kt.prototype.removeListener=Kt.prototype.removeAllListeners=Kt.prototype.removeEventListener=function(s,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+s];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var i,c=0;c<r.length;c++)if(i=r[c],i===t||i.fn===t){r.splice(c,1);break}return r.length===0&&delete this._callbacks["$"+s],this};Kt.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+s],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(r){r=r.slice(0);for(var i=0,c=r.length;i<c;++i)r[i].apply(this,t)}return this};Kt.prototype.emitReserved=Kt.prototype.emit;Kt.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};Kt.prototype.hasListeners=function(s){return!!this.listeners(s).length};const cc=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,r)=>r(t,0),Zn=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),A2="arraybuffer";function y0(s,...t){return t.reduce((r,i)=>(s.hasOwnProperty(i)&&(r[i]=s[i]),r),{})}const y2=Zn.setTimeout,v2=Zn.clearTimeout;function uc(s,t){t.useNativeTimers?(s.setTimeoutFn=y2.bind(Zn),s.clearTimeoutFn=v2.bind(Zn)):(s.setTimeoutFn=Zn.setTimeout.bind(Zn),s.clearTimeoutFn=Zn.clearTimeout.bind(Zn))}const b2=1.33;function x2(s){return typeof s=="string"?S2(s):Math.ceil((s.byteLength||s.size)*b2)}function S2(s){let t=0,r=0;for(let i=0,c=s.length;i<c;i++)t=s.charCodeAt(i),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(i++,r+=4);return r}function v0(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function w2(s){let t="";for(let r in s)s.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(s[r]));return t}function k2(s){let t={},r=s.split("&");for(let i=0,c=r.length;i<c;i++){let u=r[i].split("=");t[decodeURIComponent(u[0])]=decodeURIComponent(u[1])}return t}class C2 extends Error{constructor(t,r,i){super(t),this.description=r,this.context=i,this.type="TransportError"}}class Uf extends Kt{constructor(t){super(),this.writable=!1,uc(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,r,i){return super.emitReserved("error",new C2(t,r,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const r=zf(t,this.socket.binaryType);this.onPacket(r)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,r={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const r=w2(t);return r.length?"?"+r:""}}class j2 extends Uf{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const r=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||r()})),this.writable||(i++,this.once("drain",function(){--i||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const r=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};h2(t,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,f2(t,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=v0()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(t,r)}}let b0=!1;try{b0=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const _2=b0;function E2(){}class N2 extends j2{constructor(t){if(super(t),typeof location<"u"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port}}doWrite(t,r){const i=this.request({method:"POST",data:t});i.on("success",r),i.on("error",(c,u)=>{this.onError("xhr post error",c,u)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(r,i)=>{this.onError("xhr poll error",r,i)}),this.pollXhr=t}}let $i=class Ll extends Kt{constructor(t,r,i){super(),this.createRequest=t,uc(this,i),this._opts=i,this._method=i.method||"GET",this._uri=r,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var t;const r=y0(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(r);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let c in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(c)&&i.setRequestHeader(c,this._opts.extraHeaders[c])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var c;i.readyState===3&&((c=this._opts.cookieJar)===null||c===void 0||c.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(c){this.setTimeoutFn(()=>{this._onError(c)},0);return}typeof document<"u"&&(this._index=Ll.requestsCount++,Ll.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=E2,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ll.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};$i.requestsCount=0;$i.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Zg);else if(typeof addEventListener=="function"){const s="onpagehide"in Zn?"pagehide":"unload";addEventListener(s,Zg,!1)}}function Zg(){for(let s in $i.requests)$i.requests.hasOwnProperty(s)&&$i.requests[s].abort()}const T2=function(){const s=x0({xdomain:!1});return s&&s.responseType!==null}();class R2 extends N2{constructor(t){super(t);const r=t&&t.forceBase64;this.supportsBinary=T2&&!r}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new $i(x0,this.uri(),t)}}function x0(s){const t=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||_2))return new XMLHttpRequest}catch{}if(!t)try{return new Zn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const S0=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class M2 extends Uf{get name(){return"websocket"}doOpen(){const t=this.uri(),r=this.opts.protocols,i=S0?{}:y0(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,r,i)}catch(c){return this.emitReserved("error",c)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const i=t[r],c=r===t.length-1;Lf(i,this.supportsBinary,u=>{try{this.doWrite(i,u)}catch{}c&&cc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=v0()),this.supportsBinary||(r.b64=1),this.createUri(t,r)}}const Td=Zn.WebSocket||Zn.MozWebSocket;class O2 extends M2{createSocket(t,r,i){return S0?new Td(t,r,i):r?new Td(t,r):new Td(t)}doWrite(t,r){this.ws.send(r)}}class D2 extends Uf{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const r=p2(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=t.readable.pipeThrough(r).getReader(),c=m2();c.readable.pipeTo(t.writable),this._writer=c.writable.getWriter();const u=()=>{i.read().then(({done:m,value:v})=>{m||(this.onPacket(v),u())}).catch(m=>{})};u();const f={type:"open"};this.query.sid&&(f.data=`{"sid":"${this.query.sid}"}`),this._writer.write(f).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const i=t[r],c=r===t.length-1;this._writer.write(i).then(()=>{c&&cc(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const L2={websocket:O2,webtransport:D2,polling:R2},z2=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,U2=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Jd(s){if(s.length>8e3)throw"URI too long";const t=s,r=s.indexOf("["),i=s.indexOf("]");r!=-1&&i!=-1&&(s=s.substring(0,r)+s.substring(r,i).replace(/:/g,";")+s.substring(i,s.length));let c=z2.exec(s||""),u={},f=14;for(;f--;)u[U2[f]]=c[f]||"";return r!=-1&&i!=-1&&(u.source=t,u.host=u.host.substring(1,u.host.length-1).replace(/;/g,":"),u.authority=u.authority.replace("[","").replace("]","").replace(/;/g,":"),u.ipv6uri=!0),u.pathNames=B2(u,u.path),u.queryKey=P2(u,u.query),u}function B2(s,t){const r=/\/{2,9}/g,i=t.replace(r,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&i.splice(0,1),t.slice(-1)=="/"&&i.splice(i.length-1,1),i}function P2(s,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,c,u){c&&(r[c]=u)}),r}const Wd=typeof addEventListener=="function"&&typeof removeEventListener=="function",zl=[];Wd&&addEventListener("offline",()=>{zl.forEach(s=>s())},!1);class xr extends Kt{constructor(t,r){if(super(),this.binaryType=A2,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){const i=Jd(t);r.hostname=i.host,r.secure=i.protocol==="https"||i.protocol==="wss",r.port=i.port,i.query&&(r.query=i.query)}else r.host&&(r.hostname=Jd(r.host).host);uc(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(i=>{const c=i.prototype.name;this.transports.push(c),this._transportsByName[c]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=k2(this.opts.query)),Wd&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},zl.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const r=Object.assign({},this.opts.query);r.EIO=A0,r.transport=t,this.id&&(r.sid=this.id);const i=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&xr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",xr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let i=0;i<this.writeBuffer.length;i++){const c=this.writeBuffer[i].data;if(c&&(r+=x2(c)),i>0&&r>this._maxPayload)return this.writeBuffer.slice(0,i);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,cc(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,i){return this._sendPacket("message",t,r,i),this}send(t,r,i){return this._sendPacket("message",t,r,i),this}_sendPacket(t,r,i,c){if(typeof r=="function"&&(c=r,r=void 0),typeof i=="function"&&(c=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const u={type:t,data:r,options:i};this.emitReserved("packetCreate",u),this.writeBuffer.push(u),c&&this.once("flush",c),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},i=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}_onError(t){if(xr.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Wd&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=zl.indexOf(this._offlineEventListener);i!==-1&&zl.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}xr.protocol=A0;class $2 extends xr{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let r=this.createTransport(t),i=!1;xr.priorWebsocketSuccess=!1;const c=()=>{i||(r.send([{type:"ping",data:"probe"}]),r.once("packet",S=>{if(!i)if(S.type==="pong"&&S.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;xr.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(A(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const j=new Error("probe error");j.transport=r.name,this.emitReserved("upgradeError",j)}}))};function u(){i||(i=!0,A(),r.close(),r=null)}const f=S=>{const j=new Error("probe error: "+S);j.transport=r.name,u(),this.emitReserved("upgradeError",j)};function m(){f("transport closed")}function v(){f("socket closed")}function x(S){r&&S.name!==r.name&&u()}const A=()=>{r.removeListener("open",c),r.removeListener("error",f),r.removeListener("close",m),this.off("close",v),this.off("upgrading",x)};r.once("open",c),r.once("error",f),r.once("close",m),this.once("close",v),this.once("upgrading",x),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||r.open()},200):r.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const r=[];for(let i=0;i<t.length;i++)~this.transports.indexOf(t[i])&&r.push(t[i]);return r}}let q2=class extends $2{constructor(t,r={}){const i=typeof t=="object"?t:r;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(c=>L2[c]).filter(c=>!!c)),super(t,i)}};function I2(s,t="",r){let i=s;r=r||typeof location<"u"&&location,s==null&&(s=r.protocol+"//"+r.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=r.protocol+s:s=r.host+s),/^(https?|wss?):\/\//.test(s)||(typeof r<"u"?s=r.protocol+"//"+s:s="https://"+s),i=Jd(s)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const u=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+u+":"+i.port+t,i.href=i.protocol+"://"+u+(r&&r.port===i.port?"":":"+i.port),i}const F2=typeof ArrayBuffer=="function",H2=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,w0=Object.prototype.toString,V2=typeof Blob=="function"||typeof Blob<"u"&&w0.call(Blob)==="[object BlobConstructor]",Y2=typeof File=="function"||typeof File<"u"&&w0.call(File)==="[object FileConstructor]";function Bf(s){return F2&&(s instanceof ArrayBuffer||H2(s))||V2&&s instanceof Blob||Y2&&s instanceof File}function Ul(s,t){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let r=0,i=s.length;r<i;r++)if(Ul(s[r]))return!0;return!1}if(Bf(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return Ul(s.toJSON(),!0);for(const r in s)if(Object.prototype.hasOwnProperty.call(s,r)&&Ul(s[r]))return!0;return!1}function G2(s){const t=[],r=s.data,i=s;return i.data=ef(r,t),i.attachments=t.length,{packet:i,buffers:t}}function ef(s,t){if(!s)return s;if(Bf(s)){const r={_placeholder:!0,num:t.length};return t.push(s),r}else if(Array.isArray(s)){const r=new Array(s.length);for(let i=0;i<s.length;i++)r[i]=ef(s[i],t);return r}else if(typeof s=="object"&&!(s instanceof Date)){const r={};for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=ef(s[i],t));return r}return s}function X2(s,t){return s.data=tf(s.data,t),delete s.attachments,s}function tf(s,t){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<t.length)return t[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let r=0;r<s.length;r++)s[r]=tf(s[r],t);else if(typeof s=="object")for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&(s[r]=tf(s[r],t));return s}const Q2=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],K2=5;var mt;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(mt||(mt={}));class Z2{constructor(t){this.replacer=t}encode(t){return(t.type===mt.EVENT||t.type===mt.ACK)&&Ul(t)?this.encodeAsBinary({type:t.type===mt.EVENT?mt.BINARY_EVENT:mt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let r=""+t.type;return(t.type===mt.BINARY_EVENT||t.type===mt.BINARY_ACK)&&(r+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(r+=t.nsp+","),t.id!=null&&(r+=t.id),t.data!=null&&(r+=JSON.stringify(t.data,this.replacer)),r}encodeAsBinary(t){const r=G2(t),i=this.encodeAsString(r.packet),c=r.buffers;return c.unshift(i),c}}function Jg(s){return Object.prototype.toString.call(s)==="[object Object]"}class Pf extends Kt{constructor(t){super(),this.reviver=t}add(t){let r;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(t);const i=r.type===mt.BINARY_EVENT;i||r.type===mt.BINARY_ACK?(r.type=i?mt.EVENT:mt.ACK,this.reconstructor=new J2(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(Bf(t)||t.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(t),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let r=0;const i={type:Number(t.charAt(0))};if(mt[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===mt.BINARY_EVENT||i.type===mt.BINARY_ACK){const u=r+1;for(;t.charAt(++r)!=="-"&&r!=t.length;);const f=t.substring(u,r);if(f!=Number(f)||t.charAt(r)!=="-")throw new Error("Illegal attachments");i.attachments=Number(f)}if(t.charAt(r+1)==="/"){const u=r+1;for(;++r&&!(t.charAt(r)===","||r===t.length););i.nsp=t.substring(u,r)}else i.nsp="/";const c=t.charAt(r+1);if(c!==""&&Number(c)==c){const u=r+1;for(;++r;){const f=t.charAt(r);if(f==null||Number(f)!=f){--r;break}if(r===t.length)break}i.id=Number(t.substring(u,r+1))}if(t.charAt(++r)){const u=this.tryParse(t.substr(r));if(Pf.isPayloadValid(i.type,u))i.data=u;else throw new Error("invalid payload")}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,r){switch(t){case mt.CONNECT:return Jg(r);case mt.DISCONNECT:return r===void 0;case mt.CONNECT_ERROR:return typeof r=="string"||Jg(r);case mt.EVENT:case mt.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&Q2.indexOf(r[0])===-1);case mt.ACK:case mt.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class J2{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const r=X2(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const W2=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Pf,Encoder:Z2,get PacketType(){return mt},protocol:K2},Symbol.toStringTag,{value:"Module"}));function cs(s,t,r){return s.on(t,r),function(){s.off(t,r)}}const e4=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class k0 extends Kt{constructor(t,r,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=r,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[cs(t,"open",this.onopen.bind(this)),cs(t,"packet",this.onpacket.bind(this)),cs(t,"error",this.onerror.bind(this)),cs(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...r){var i,c,u;if(e4.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(r.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const f={type:mt.EVENT,data:r};if(f.options={},f.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const A=this.ids++,S=r.pop();this._registerAckCallback(A,S),f.id=A}const m=(c=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||c===void 0?void 0:c.writable,v=this.connected&&!(!((u=this.io.engine)===null||u===void 0)&&u._hasPingExpired());return this.flags.volatile&&!m||(v?(this.notifyOutgoingListeners(f),this.packet(f)):this.sendBuffer.push(f)),this.flags={},this}_registerAckCallback(t,r){var i;const c=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(c===void 0){this.acks[t]=r;return}const u=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let m=0;m<this.sendBuffer.length;m++)this.sendBuffer[m].id===t&&this.sendBuffer.splice(m,1);r.call(this,new Error("operation has timed out"))},c),f=(...m)=>{this.io.clearTimeoutFn(u),r.apply(this,m)};f.withError=!0,this.acks[t]=f}emitWithAck(t,...r){return new Promise((i,c)=>{const u=(f,m)=>f?c(f):i(m);u.withError=!0,r.push(u),this.emit(t,...r)})}_addToQueue(t){let r;typeof t[t.length-1]=="function"&&(r=t.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((c,...u)=>i!==this._queue[0]?void 0:(c!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(c)):(this._queue.shift(),r&&r(null,...u)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!t||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:mt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(i=>String(i.id)===t)){const i=this.acks[t];delete this.acks[t],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case mt.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case mt.EVENT:case mt.BINARY_EVENT:this.onevent(t);break;case mt.ACK:case mt.BINARY_ACK:this.onack(t);break;case mt.DISCONNECT:this.ondisconnect();break;case mt.CONNECT_ERROR:this.destroy();const i=new Error(t.data.message);i.data=t.data.data,this.emitReserved("connect_error",i);break}}onevent(t){const r=t.data||[];t.id!=null&&r.push(this.ack(t.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const i of r)i.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const r=this;let i=!1;return function(...c){i||(i=!0,r.packet({type:mt.ACK,id:t,data:c}))}}onack(t){const r=this.acks[t.id];typeof r=="function"&&(delete this.acks[t.id],r.withError&&t.data.unshift(null),r.apply(this,t.data))}onconnect(t,r){this.id=t,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:mt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const r=this._anyListeners;for(let i=0;i<r.length;i++)if(t===r[i])return r.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const r=this._anyOutgoingListeners;for(let i=0;i<r.length;i++)if(t===r[i])return r.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const i of r)i.apply(this,t.data)}}}function Ji(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}Ji.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*s);s=(Math.floor(t*10)&1)==0?s-r:s+r}return Math.min(s,this.max)|0};Ji.prototype.reset=function(){this.attempts=0};Ji.prototype.setMin=function(s){this.ms=s};Ji.prototype.setMax=function(s){this.max=s};Ji.prototype.setJitter=function(s){this.jitter=s};class nf extends Kt{constructor(t,r){var i;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(r=t,t=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,uc(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((i=r.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new Ji({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=t;const c=r.parser||W2;this.encoder=new c.Encoder,this.decoder=new c.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var r;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(r=this.backoff)===null||r===void 0||r.setMin(t),this)}randomizationFactor(t){var r;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(r=this.backoff)===null||r===void 0||r.setJitter(t),this)}reconnectionDelayMax(t){var r;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(r=this.backoff)===null||r===void 0||r.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new q2(this.uri,this.opts);const r=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const c=cs(r,"open",function(){i.onopen(),t&&t()}),u=m=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",m),t?t(m):this.maybeReconnectOnOpen()},f=cs(r,"error",u);if(this._timeout!==!1){const m=this._timeout,v=this.setTimeoutFn(()=>{c(),u(new Error("timeout")),r.close()},m);this.opts.autoUnref&&v.unref(),this.subs.push(()=>{this.clearTimeoutFn(v)})}return this.subs.push(c),this.subs.push(f),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(cs(t,"ping",this.onping.bind(this)),cs(t,"data",this.ondata.bind(this)),cs(t,"error",this.onerror.bind(this)),cs(t,"close",this.onclose.bind(this)),cs(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(r){this.onclose("parse error",r)}}ondecoded(t){cc(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,r){let i=this.nsps[t];return i?this._autoConnect&&!i.active&&i.connect():(i=new k0(this,t,r),this.nsps[t]=i),i}_destroy(t){const r=Object.keys(this.nsps);for(const i of r)if(this.nsps[i].active)return;this._close()}_packet(t){const r=this.encoder.encode(t);for(let i=0;i<r.length;i++)this.engine.write(r[i],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,r){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(c=>{c?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",c)):t.onreconnect()}))},r);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Za={};function Bl(s,t){typeof s=="object"&&(t=s,s=void 0),t=t||{};const r=I2(s,t.path||"/socket.io"),i=r.source,c=r.id,u=r.path,f=Za[c]&&u in Za[c].nsps,m=t.forceNew||t["force new connection"]||t.multiplex===!1||f;let v;return m?v=new nf(i,t):(Za[c]||(Za[c]=new nf(i,t)),v=Za[c]),r.query&&!t.query&&(t.query=r.queryKey),v.socket(r.path,t)}Object.assign(Bl,{Manager:nf,Socket:k0,io:Bl,connect:Bl});var t4={};class n4{constructor(){this.socket=null,this.connected=!1,this.reconnecting=!1,this.userId=null,this.pendingMessages=[],this.eventHandlers={},this.connectionAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=5e3,this.heartbeatInterval=null,this.lastPong=null,this.notificationSyncChannel=null,this.connectionMonitorInterval=null,this.notificationEventTypes=["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall","newStory"]}init(t,r,i={}){if(this.socket&&this.connected)return console.log("Socket already connected"),this.socket;this.userId=t;const c=i.serverUrl||t4.REACT_APP_SOCKET_URL||"http://localhost:5000";console.log(`Connecting to socket server at ${c}`);try{return this.socket=Bl(c,{query:{token:r},auth:{token:r,userId:t},reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,reconnectionDelayMax:3e4,timeout:2e4,transports:["websocket","polling"],autoConnect:!0}),this._setupSocketHandlers(),this.setupNotificationSyncChannel(),this.startConnectionMonitoring(),this.socket}catch(u){throw console.error("Socket initialization error:",u),u}}isConnected(){return this.socket&&this.connected}_setupSocketHandlers(){this.socket&&(this.socket.on("connect",()=>{console.log("Socket connected successfully"),this.connected=!0,this.connectionAttempts=0,this._startHeartbeat(),this._processPendingMessages(),this._notifyEventHandlers("socketConnected",{userId:this.userId,socketId:this.socket.id}),window.dispatchEvent(new CustomEvent("socketConnected",{detail:{userId:this.userId,socketId:this.socket.id}}))}),this.socket.on("connect_error",t=>{console.error("Socket connection error:",t),this.connected=!1,this.connectionAttempts++,this.connectionAttempts>=this.maxReconnectAttempts&&(this._notifyEventHandlers("socketConnectionFailed",{error:t.message,attempts:this.connectionAttempts}),this.connectionAttempts===this.maxReconnectAttempts&&X.error("Failed to connect to the chat server. Please check your internet connection.")),window.dispatchEvent(new CustomEvent("socketConnectionError",{detail:{error:t.message,attempts:this.connectionAttempts}}))}),this.socket.on("disconnect",t=>{console.log(`Socket disconnected: ${t}`),this.connected=!1,this._stopHeartbeat(),this._notifyEventHandlers("socketDisconnected",{reason:t}),window.dispatchEvent(new CustomEvent("socketDisconnected",{detail:{reason:t}})),(t==="io server disconnect"||t==="transport close")&&this.enhancedReconnect()}),this.socket.on("reconnect",t=>{console.log(`Socket reconnected after ${t} attempts`),this.connected=!0,this.reconnecting=!1,this._notifyEventHandlers("socketReconnected",{userId:this.userId,attempts:t}),window.dispatchEvent(new CustomEvent("socketReconnected",{detail:{userId:this.userId,attempts:t}}))}),this.socket.on("reconnect_attempt",t=>{console.log(`Socket reconnect attempt ${t}`),this.reconnecting=!0}),this.socket.on("reconnect_error",t=>{console.error("Socket reconnection error:",t)}),this.socket.on("reconnect_failed",()=>{console.error("Socket reconnection failed"),this.reconnecting=!1,X.error("Failed to reconnect to the chat server. Please reload the page."),this._notifyEventHandlers("socketReconnectFailed",{userId:this.userId}),window.dispatchEvent(new CustomEvent("socketReconnectFailed",{detail:{userId:this.userId}}))}),this.socket.on("welcome",t=>{console.log("Socket welcome message received:",t)}),this.socket.on("pong",()=>{this.lastPong=Date.now()}),this.socket.on("error",t=>{console.error("Socket server error:",t),X.error(`Server error: ${t.message||"Unknown error"}`)}),this.socket.on("auth_error",t=>{console.error("Socket authentication error:",t),X.error("Authentication failed. Please log in again."),window.dispatchEvent(new CustomEvent("authLogout"))}),this._registerEnhancedEventForwarder("messageReceived"),this._registerEnhancedEventForwarder("messageSent"),this._registerEnhancedEventForwarder("messageError"),this._registerEnhancedEventForwarder("userTyping"),this._registerEnhancedEventForwarder("videoSignal"),this._registerEnhancedEventForwarder("videoHangup"),this._registerEnhancedEventForwarder("videoError"),this._registerEnhancedEventForwarder("videoMediaControl"),this._registerEnhancedEventForwarder("incomingCall"),this._registerEnhancedEventForwarder("callAnswered"),this._registerEnhancedEventForwarder("callInitiated"),this._registerEnhancedEventForwarder("callError"),this._registerEnhancedEventForwarder("userOnline"),this._registerEnhancedEventForwarder("userOffline"),this._registerEnhancedEventForwarder("notification"),this._registerEnhancedEventForwarder("newLike"),this._registerEnhancedEventForwarder("photoPermissionRequestReceived"),this._registerEnhancedEventForwarder("photoPermissionResponseReceived"),this._registerEnhancedEventForwarder("newComment"),this._registerEnhancedEventForwarder("newStory"))}_registerEnhancedEventForwarder(t){this.socket.on(t,r=>{if(this._notifyEventHandlers(t,r),this.notificationEventTypes.includes(t)&&(window.dispatchEvent(new CustomEvent(t,{detail:r})),window.dispatchEvent(new CustomEvent("notification",{detail:r})),this.notificationSyncChannel))try{this.notificationSyncChannel.postMessage({type:"NEW_NOTIFICATION",data:r})}catch(i){console.error("Error syncing notification to other tabs:",i)}})}setupNotificationSyncChannel(){if(typeof BroadcastChannel>"u")return console.log("BroadcastChannel not supported, cross-tab sync disabled"),null;try{return this.notificationSyncChannel=new BroadcastChannel("notification_sync"),this.notificationSyncChannel.onmessage=t=>{const{type:r,data:i}=t.data;r==="NEW_NOTIFICATION"?(console.log("Received new notification from another tab"),window.dispatchEvent(new CustomEvent("newNotification",{detail:i}))):r==="MARK_READ"?(console.log("Received mark-read event from another tab"),window.dispatchEvent(new CustomEvent("notificationRead",{detail:i}))):r==="MARK_ALL_READ"&&(console.log("Received mark-all-read event from another tab"),window.dispatchEvent(new CustomEvent("allNotificationsRead")))},console.log("Notification sync channel initialized"),this.notificationSyncChannel}catch(t){return console.error("Error setting up notification sync channel:",t),this.notificationSyncChannel=null,null}}_startHeartbeat(){this._stopHeartbeat(),this.lastPong=Date.now(),this.heartbeatInterval=setInterval(()=>{if(this.socket&&this.connected){this.socket.emit("ping");const t=Date.now();this.lastPong&&t-this.lastPong>6e4&&(console.warn("No heartbeat response in 60 seconds, reconnecting..."),this.enhancedReconnect())}},3e4)}_stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}startConnectionMonitoring(){this.stopConnectionMonitoring(),this.connectionMonitorInterval=setInterval(()=>{this.checkSocketHealthForNotifications()},45e3),console.log("Notification connection monitoring started")}stopConnectionMonitoring(){this.connectionMonitorInterval&&(clearInterval(this.connectionMonitorInterval),this.connectionMonitorInterval=null)}checkSocketHealthForNotifications(){if(!this.userId||!this.socket)return!1;const t=Date.now(),r=this.lastPong||0;return t-r>6e4?(console.warn("No socket response in the last minute, reconnecting for notifications..."),this.enhancedReconnect(),!1):this.connected?!0:(console.warn("Socket appears disconnected, reconnecting for notifications..."),this.enhancedReconnect(),!1)}_processPendingMessages(){if(!this.connected||this.pendingMessages.length===0)return;console.log(`Processing ${this.pendingMessages.length} pending messages`);const t=[...this.pendingMessages];this.pendingMessages=[],t.forEach(r=>{this.emit(r.event,r.data)})}on(t,r){return this.eventHandlers[t]||(this.eventHandlers[t]=[]),this.eventHandlers[t].push(r),this.socket&&this.socket.on(t,r),()=>this.off(t,r)}off(t,r){this.socket&&this.socket.off(t,r),this.eventHandlers[t]&&(this.eventHandlers[t]=this.eventHandlers[t].filter(i=>i!==r),this.eventHandlers[t].length===0&&delete this.eventHandlers[t])}_notifyEventHandlers(t,r){this.eventHandlers[t]&&this.eventHandlers[t].forEach(i=>{try{i(r)}catch(c){console.error(`Error in ${t} handler:`,c)}})}emit(t,r={}){if(!this.socket)return console.warn(`Socket not initialized, cannot emit '${t}'`),!1;if(!this.connected)return console.log(`Socket not connected, queueing '${t}'`),this.pendingMessages.push({event:t,data:r}),!0;try{return this.socket.emit(t,r),!0}catch(i){return console.error(`Error emitting '${t}':`,i),!1}}enhancedReconnect(){if(!this.reconnecting){if(console.log("Forcing socket reconnection with notification support..."),this.reconnecting=!0,this.socket)try{this.socket.close()}catch(t){console.error("Error closing socket:",t)}if(this._stopHeartbeat(),this.userId){const t=localStorage.getItem("token")||sessionStorage.getItem("token");if(t){const r=1e3+Math.random()*2e3;setTimeout(()=>{try{const i=localStorage.getItem("token")||sessionStorage.getItem("token");i!==t&&console.log("Token changed since reconnection attempt started, using fresh token"),this.init(this.userId,i||t),window.dispatchEvent(new CustomEvent("notificationSocketReconnected")),console.log("Socket reconnected with notification support")}catch(i){console.error("Socket reconnection failed:",i),i.message&&i.message.includes("auth")&&(console.log("Authentication error detected, trying emergency session reset"),setTimeout(()=>{try{typeof window.fixMyUserId=="function"?window.fixMyUserId():(localStorage.clear(),sessionStorage.clear(),window.location.reload())}catch(c){console.error("Emergency recovery failed:",c)}},2e3))}this.reconnecting=!1},r)}else console.error("Cannot reconnect: No authentication token found"),this.reconnecting=!1}else console.error("Cannot reconnect: No user ID"),this.reconnecting=!1}}reconnect(){this.enhancedReconnect()}disconnect(){if(console.log("Disconnecting socket"),this._stopHeartbeat(),this.stopConnectionMonitoring(),this.notificationSyncChannel)try{this.notificationSyncChannel.close(),this.notificationSyncChannel=null}catch(t){console.error("Error closing notification sync channel:",t)}if(this.socket){try{this.socket.disconnect()}catch(t){console.error("Error disconnecting socket:",t)}this.socket=null}this.connected=!1,this.reconnecting=!1}}const s4=new n4;class r4{constructor(){this.socket=s4,this.initialized=!1,this.showConnectionToasts=!0,this.debugMode=!1,this.eventListeners=new Map,this.pendingMessages=[],this.userId=null,this.connectionState="disconnected",this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.connectionMonitor=null}init(t,r,i={}){if(this.initialized&&this.socket.isConnected()&&this.userId===t)return this._log("Socket service already initialized and connected"),this.socket;this._clearConnectionMonitor(),this._log(`Initializing socket service for user: ${t}`),this.userId=t,this.reconnectAttempts=0;try{return this.socket.init(t,r,i),this.initialized=!0,this.connectionState="connecting",this.socket.on("connect",()=>{this._log("Socket connection established"),this.connectionState="connected",this.reconnectAttempts=0,this._processPendingMessages(),window.dispatchEvent(new CustomEvent("socketReconnected"))}),this.socket.on("disconnect",c=>{this._log(`Socket disconnected: ${c}`),this.connectionState="disconnected",this._startConnectionMonitor()}),this.socket.on("connect_error",c=>{this._log(`Socket connection error: ${c}`),this.connectionState="error",this._startConnectionMonitor()}),this._startConnectionMonitor(),this.socket}catch(c){throw this._log(`Socket initialization error: ${c.message}`,"error"),this.connectionState="error",c}}_startConnectionMonitor(){this.connectionMonitor||(this._log("Starting socket connection monitor"),this.connectionMonitor=setInterval(()=>{this.initialized&&this.connectionState!=="connected"&&this.reconnectAttempts<this.maxReconnectAttempts&&this.connectionState!=="reconnecting"&&(this._log(`Connection monitor: Socket is ${this.connectionState}, attempting reconnect`),this.reconnect())},15e3))}_clearConnectionMonitor(){this.connectionMonitor&&(clearInterval(this.connectionMonitor),this.connectionMonitor=null,this._log("Cleared socket connection monitor"))}isConnected(){return this.socket&&this.socket.isConnected()}reconnect(){if(this.connectionState==="connected")return this._log("Socket already connected, no need to reconnect"),this.reconnectAttempts=0,!0;if(this.reconnectAttempts>=this.maxReconnectAttempts)return this._log(`Maximum reconnect attempts (${this.maxReconnectAttempts}) reached, stopping reconnection attempts`,"warn"),setTimeout(()=>{this._log("Reconnect cooldown completed, resetting counter"),this.reconnectAttempts=0},3e4),!1;this.reconnectAttempts++,this._log(`Forcing socket reconnection (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connectionState="reconnecting";try{return this.socket&&typeof this.socket.reconnect=="function"?this.socket.reconnect():(this._log("Socket not initialized, cannot reconnect","warn"),!1)}catch(t){return this._log(`Reconnection error: ${t.message}`,"error"),!1}}disconnect(){return this._log("Disconnecting socket"),this._clearConnectionMonitor(),this.initialized=!1,this.connectionState="disconnected",this.pendingMessages=[],this.savedListeners=Array.from(this.eventListeners.entries()),this.eventListeners.clear(),this.socket.disconnect()}on(t,r){if(!r||typeof r!="function")return this._log(`Invalid callback for event: ${t}`,"error"),()=>{};this._log(`Registering listener for event: ${t}`),this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(r);let i;try{i=this.socket.on(t,r)}catch(c){this._log(`Error registering event listener for ${t}: ${c.message}`,"error"),i=()=>{}}return()=>{this.eventListeners.has(t)&&(this.eventListeners.get(t).delete(r),this.eventListeners.get(t).size===0&&this.eventListeners.delete(t));try{i()}catch(c){this._log(`Error unsubscribing from event ${t}: ${c.message}`,"error")}}}off(t,r){this._log(`Removing listener for event: ${t}`);try{this.socket.off(t,r)}catch(i){this._log(`Error removing event listener for ${t}: ${i.message}`,"error")}this.eventListeners.has(t)&&r?(this.eventListeners.get(t).delete(r),this.eventListeners.get(t).size===0&&this.eventListeners.delete(t)):this.eventListeners.has(t)&&!r&&this.eventListeners.delete(t)}emit(t,r={}){if(!this.socket)return this._log(`Socket not initialized, cannot emit '${t}'`,"warn"),!1;if(!this.isConnected())return this._log(`Socket not connected, queueing '${t}'`,"warn"),this.pendingMessages.push({event:t,data:r,timestamp:Date.now()}),!0;try{return this._log(`Emitting event: ${t}`),this.socket.emit(t,r),!0}catch(i){return this._log(`Error emitting '${t}': ${i.message}`,"error"),["sendMessage","messageRead","answerCall"].includes(t)&&(this._log(`Adding failed '${t}' to pending queue for retry`,"warn"),this.pendingMessages.push({event:t,data:r,timestamp:Date.now()})),!1}}async sendMessage(t,r="text",i,c={}){return this._log(`Attempting to send ${r} message to ${t}`),new Promise((u,f)=>{const m=`temp-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,v={current:null};let x=!1;if(!this.isConnected()){this._log(`Socket not connected, returning pending message with id ${m}`);const U={_id:m,sender:this.userId,recipient:t,type:r,content:i,metadata:{...c,clientMessageId:m},createdAt:new Date().toISOString(),read:!1,pending:!0,status:"pending",tempMessageId:m};return this.pendingMessages.push({event:"sendMessage",data:{recipientId:t,type:r,content:i,metadata:{...c,clientMessageId:m},tempMessageId:m},timestamp:Date.now()}),u(U)}const A=()=>{x||(x=!0,this.socket.off("messageSent",S),this.socket.off("messageError",j),v.current&&(clearTimeout(v.current),v.current=null))},S=U=>{U&&U.tempMessageId===m&&(this._log(`Message confirmed sent: ${m}`),A(),u(U))},j=U=>{U&&U.tempMessageId===m&&(this._log(`Message error for ${m}: ${U.error||"Unknown error"}`,"error"),A(),f(new Error(U.error||"Failed to send message")))};this.socket.on("messageSent",S),this.socket.on("messageError",j);const C={...c,clientMessageId:m};if(this._log(`Emitting sendMessage with tempId: ${m}`),!this.socket.emit("sendMessage",{recipientId:t,type:r,content:i,metadata:C,tempMessageId:m})){this._log(`Message emission failed immediately for ${m}`,"error"),A(),u({_id:m,sender:this.userId,recipient:t,content:i,type:r,metadata:C,createdAt:new Date().toISOString(),read:!1,status:"pending",pending:!0,tempMessageId:m});return}v.current=setTimeout(()=>{x||(this._log(`Message timeout reached for ${m}`,"warn"),A(),u({_id:m,sender:this.userId,recipient:t,content:i,type:r,metadata:C,createdAt:new Date().toISOString(),read:!1,status:"pending",pending:!0,tempMessageId:m}))},1e4)})}sendTyping(t){this.isConnected()&&this.socket.emit("typing",{recipientId:t})}_processPendingMessages(){if(this.pendingMessages.length===0)return;this._log(`Processing ${this.pendingMessages.length} pending messages`);const t=[...this.pendingMessages];this.pendingMessages=[],t.forEach((r,i)=>{setTimeout(()=>{if(Date.now()-r.timestamp>3e5){this._log(`Skipping stale pending message of type ${r.event}`,"warn");return}this._log(`Processing queued message: ${r.event}`),this.emit(r.event,r.data)},i*100)})}initiateVideoCall(t){return this._log(`Initiating video call to ${t}`),new Promise((r,i)=>{if(!this.isConnected())return this._log("Socket not connected, cannot initiate call","error"),i(new Error("Socket not connected"));const c={callId:`call-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,recipientId:t,callType:"video",userId:this.userId,caller:{userId:this.userId,name:localStorage.getItem("userNickname")||"User"},timestamp:Date.now()},u=m=>{this._log(`Call initiated successfully: ${m.callId||"unknown"}`),this.socket.off("callInitiated",u),this.socket.off("callError",f),r(m)},f=m=>{this._log(`Call initiation error: ${m.message||"unknown"}`,"error"),this.socket.off("callInitiated",u),this.socket.off("callError",f),i(new Error(m.message||"Failed to initiate call"))};this.socket.on("callInitiated",u),this.socket.on("callError",f),this.socket.emit("initiateCall",c),setTimeout(()=>{this._log("Call initiation timeout reached","warn"),this.socket.off("callInitiated",u),this.socket.off("callError",f),r({success:!0,callId:c.callId})},5e3)})}answerVideoCall(t,r,i){if(this._log(`Answering call from ${t} with accept=${r}`),!this.isConnected())return this._log("Cannot answer call: Socket not connected","error"),!1;let c=0;const u=3,f=()=>{c++;const m=this.socket.emit("answerCall",{callerId:t,accept:r,callId:i,userId:this.userId,timestamp:Date.now()});return!m&&c<u&&(this._log(`Retrying call answer (attempt ${c})`,"warn"),setTimeout(f,1e3)),m};return f()}getStatus(){return{connected:this.isConnected(),initialized:this.initialized,userId:this.userId,state:this.connectionState,reconnectAttempts:this.reconnectAttempts,pendingMessages:this.pendingMessages.length}}setShowConnectionToasts(t){this.showConnectionToasts=t}updatePrivacySettings(t){t&&(this.privacySettings=t,t.showOnlineStatus!==void 0&&(this._log(`Updating online status visibility: ${t.showOnlineStatus}`),this.isConnected()&&this.socket.emit("updatePrivacySettings",{showOnlineStatus:t.showOnlineStatus})),this._log(`Privacy settings updated: ${JSON.stringify(t)}`))}setDebugMode(t){this.debugMode=t}_log(t,r="log"){if(!this.debugMode&&r==="log")return;const i="[SocketService]",c=new Date().toISOString().substring(11,19);switch(r){case"warn":console.warn(`${i} [${c}]`,t);break;case"error":console.error(`${i} [${c}]`,t);break;default:console.log(`${i} [${c}]`,t)}}}const Se=new r4,qi=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),wt=Rt.create("ChatService");class i4{constructor(){this.initialized=!1,this.user=null,this.activeChats=new Map,this.eventListeners=new Map,this.pendingMessages=[],this.messageCache=new Map}initialize(t){var r;if(this.initialized&&((r=this.user)==null?void 0:r._id)===(t==null?void 0:t._id)){wt.debug("Chat service already initialized for this user");return}if(wt.info(`Initializing chat service for user: ${(t==null?void 0:t.nickname)||(t==null?void 0:t._id)}`),this.user=t,this.initialized=!0,!Se.isConnected()&&t){const i=localStorage.getItem("token")||sessionStorage.getItem("token");i&&t._id&&Se.init(t._id,i)}this._setupSocketListeners()}_setupSocketListeners(){this._cleanupSocketListeners(),this.socketListeners=[];const t=Se.on("messageReceived",f=>{var v;wt.debug(`New message received from ${f.sender}`);const m=f.sender===((v=this.user)==null?void 0:v._id)?f.recipient:f.sender;this._updateMessageCache(m,f),this._notifyEventListeners("messageReceived",f)});this.socketListeners.push(t);const r=Se.on("messageSent",f=>{wt.debug(`Message sent confirmation received for ${f._id}`);const m=f.recipient;this._updateMessageCache(m,f),this._notifyEventListeners("messageSent",f)});this.socketListeners.push(r);const i=Se.on("userTyping",f=>{this._notifyEventListeners("userTyping",f)});this.socketListeners.push(i);const c=Se.on("connect",()=>{wt.info("Socket connected, processing pending messages"),this._processPendingMessages(),this._notifyEventListeners("connectionChanged",{connected:!0})});this.socketListeners.push(c);const u=Se.on("disconnect",()=>{this._notifyEventListeners("connectionChanged",{connected:!1})});this.socketListeners.push(u)}_cleanupSocketListeners(){this.socketListeners&&(this.socketListeners.forEach(t=>{typeof t=="function"&&t()}),this.socketListeners=[])}_updateMessageCache(t,r){if(!t||!r)return;const i=this.messageCache.get(t)||[],c=i.findIndex(u=>u._id===r._id);c>=0?i[c]={...i[c],...r}:i.unshift(r),i.sort((u,f)=>new Date(f.createdAt)-new Date(u.createdAt)),this.messageCache.set(t,i)}async getMessages(t,r=1,i=20){var f;if(!this.initialized||!((f=this.user)!=null&&f._id))return wt.warn("Attempted to get messages without initialization"),[];const c=this.messageCache.get(t),u=(m=8e3)=>Promise.race([Pe.get(`/messages/${t}`,{page:r,limit:i}),new Promise((v,x)=>setTimeout(()=>x(new Error("Request timed out")),m))]);try{wt.debug(`Fetching messages with ${t}, page ${r}`);const m=await u();if(!m||!m.success){const x=(m==null?void 0:m.error)||"Failed to load messages";throw wt.error(`API returned error: ${x}`),new Error(x)}const v=Array.isArray(m.data)?m.data:[];return wt.debug(`Loaded ${v.length} messages from server`),v.length===0&&wt.debug("No messages found for this conversation"),this.messageCache.set(t,v),v}catch(m){return wt.error(`Error fetching messages with ${t}:`,m),c&&c.length>0?(wt.debug(`Returning ${c.length} cached messages as fallback`),c):(wt.debug("No cached messages available, returning empty array"),[])}}async sendMessage(t,r,i="text",c=null){var u;if(!this.initialized||!((u=this.user)!=null&&u._id))throw wt.warn("Attempted to send message without initialization"),new Error("Chat service not initialized");if(!t)throw new Error("Recipient ID is required");wt.debug(`Sending ${i} message to ${t}`);try{const f=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,m={_id:f,sender:this.user._id,recipient:t,content:r,type:i,metadata:c||{},createdAt:new Date().toISOString(),read:!1,status:"sending",pending:!0,tempId:f};return this._updateMessageCache(t,m),Se.isConnected()?new Promise((v,x)=>{Se.emit("sendMessage",{recipient:t,content:r,type:i,metadata:c,tempMessageId:f});const A=Se.on("messageSent",j=>{j.tempMessageId===f&&(A(),v(j),this._updateMessageCache(t,{...j,pending:!1,status:"sent"}))}),S=Se.on("messageError",j=>{j.tempMessageId===f&&(S(),A(),this._updateMessageCache(t,{...m,status:"error",error:j.message}),x(new Error(j.message||"Failed to send message")))});setTimeout(()=>{sendViaApi().then(v).catch(x)},5e3)}):(this._queuePendingMessage({recipient:t,content:r,type:i,metadata:c,tempMessageId:f}),this._sendViaApi(t,r,i,c,f))}catch(f){throw wt.error("Error sending message:",f),f}}async _sendViaApi(t,r,i,c,u){try{wt.debug("Sending message via API fallback");const f=await Pe.post("/messages",{recipient:t,content:r,type:i,metadata:c});if(!f.success)throw new Error(f.error||"Failed to send message");const m=f.data;return this._updateMessageCache(t,{...m,tempMessageId:u,pending:!1,status:"sent"}),m}catch(f){throw this._updateMessageCache(t,{_id:u,sender:this.user._id,recipient:t,content:r,type:i,metadata:c||{},createdAt:new Date().toISOString(),status:"error",error:f.message,pending:!1}),f}}_queuePendingMessage(t){this.pendingMessages.push({...t,timestamp:Date.now()}),wt.debug(`Queued message to ${t.recipient} for later sending`)}_processPendingMessages(){if(this.pendingMessages.length===0)return;wt.info(`Processing ${this.pendingMessages.length} pending messages`);const t=[...this.pendingMessages];this.pendingMessages=[],t.forEach(r=>{if(Date.now()-r.timestamp>6e5){wt.debug(`Skipping stale message to ${r.recipient}`);return}Se.emit("sendMessage",r)})}async markConversationRead(t){var r;if(!this.initialized||!((r=this.user)!=null&&r._id)||!t)return null;try{wt.debug(`Marking conversation with ${t} as read`);const i=await Pe.put(`/messages/conversation/${t}/read`),u=(this.messageCache.get(t)||[]).map(f=>f.sender===t&&!f.read?{...f,read:!0,readAt:new Date().toISOString()}:f);return this.messageCache.set(t,u),i}catch(i){return wt.error("Error marking conversation as read:",i),null}}async getConversations(){var r;if(!this.initialized||!((r=this.user)!=null&&r._id))return wt.warn("Attempted to get conversations without initialization"),[];const t=(i=8e3)=>Promise.race([Pe.get("/messages/conversations"),new Promise((c,u)=>setTimeout(()=>u(new Error("Request timed out")),i))]);try{wt.debug("Fetching conversations list");const i=await t();if(!i||!i.success){const u=(i==null?void 0:i.error)||"Failed to load conversations";return wt.error(`API error loading conversations: ${u}`),[]}const c=Array.isArray(i.data)?i.data:[];return wt.debug(`Loaded ${c.length} conversations`),c}catch(i){return wt.error("Error fetching conversations:",i),[]}}sendTypingIndicator(t){return!this.initialized||!Se.isConnected()||!t?!1:(Se.emit("typing",{recipientId:t}),!0)}on(t,r){return this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(r),()=>{const c=this.eventListeners.get(t);c&&c.delete(r)}}_notifyEventListeners(t,r){this.eventListeners.has(t)&&this.eventListeners.get(t).forEach(i=>{try{i(r)}catch(c){wt.error(`Error in ${t} event listener:`,c)}})}isReady(){var t;return this.initialized&&!!((t=this.user)!=null&&t._id)}isConnected(){return Se.isConnected()}cleanup(){this._cleanupSocketListeners(),this.eventListeners.clear(),this.messageCache.clear(),this.pendingMessages=[],this.initialized=!1,this.user=null,wt.debug("Chat service cleaned up")}}const Yt=new i4,ys=Rt.create("useChatConnection"),a4=()=>{const{user:s,isAuthenticated:t,token:r}=Ot(),[i,c]=y.useState(Se.isConnected()),[u,f]=y.useState(!1),[m,v]=y.useState(null),[x,A]=y.useState(0);y.useEffect(()=>{t&&(s!=null&&s._id)&&r?!Se.isConnected()&&!u&&(ys.debug("Initializing socket connection"),S()):Se.isConnected()&&(ys.debug("User not authenticated, disconnecting socket"),j());const M=()=>{ys.info("Socket connected"),c(!0),f(!1),v(null),A(0)},U=te=>{ys.warn(`Socket disconnected: ${te}`),c(!1)},D=te=>{ys.error("Socket connection error:",te),c(!1),f(!1),v(te.message||"Failed to connect"),A(B=>B+1)},ne=te=>{ys.error("Socket authentication error:",te),v("Authentication error: "+(te.message||"Please log out and log in again")),c(!1),f(!1)},K=[Se.on("connect",M),Se.on("disconnect",U),Se.on("connect_error",D),Se.on("auth_error",ne)];return()=>{K.forEach(te=>te())}},[t,s,r,u]);const S=y.useCallback(()=>{if(t&&(s!=null&&s._id)&&r){f(!0),v(null);try{ys.info(`Connecting socket for user ${s._id}`),Se.init(s._id,r)}catch(M){ys.error("Error connecting socket:",M),v(M.message||"Failed to connect"),f(!1)}}else v("Cannot connect: Not authenticated")},[t,s,r]),j=y.useCallback(()=>{Se.disconnect(),c(!1),f(!1),ys.debug("Manually disconnected socket")},[]),C=y.useCallback(()=>{u||(ys.debug("Forcing socket reconnection"),A(M=>M+1),Se.disconnect(),setTimeout(()=>{S()},500))},[u,S]);return{connected:i,connecting:u,error:m,reconnectAttempts:x,connect:S,disconnect:j,reconnect:C}},On=Rt.create("ChatContext"),C0=y.createContext(),$f=()=>y.useContext(C0),o4=({children:s})=>{const{user:t,isAuthenticated:r}=Ot(),{connected:i}=a4(),[c,u]=y.useState([]),[f,m]=y.useState({}),[v,x]=y.useState({}),[A,S]=y.useState(!1),[j,C]=y.useState(!1),[M,U]=y.useState(null),[D,ne]=y.useState(null),[K,te]=y.useState(0);y.useEffect(()=>{if(r&&(t!=null&&t._id)){Yt.initialize(t);const H=Yt.on("userTyping",re=>{re&&re.userId&&x(pe=>{const ce={...pe,[re.userId]:Date.now()};return setTimeout(()=>{x(R=>{const Q=R[re.userId];if(Q&&Date.now()-Q>3e3){const Y={...R};return delete Y[re.userId],Y}return R})},3e3),ce})}),q=Yt.on("messageReceived",re=>{re&&re.sender&&(L(re),re.sender!==t._id&&!re.read&&m(pe=>{const ce=re.sender,R={...pe,[ce]:(pe[ce]||0)+1},Q=Object.values(R).reduce((Y,P)=>Y+P,0);return te(Q),R}))});return()=>{H(),q()}}},[r,t]);const B=y.useCallback(()=>{U(null)},[]),L=y.useCallback(H=>{if(!H||!H.sender||!H.recipient||!t||!t._id){On.error("Invalid data for conversation update:",{message:H,user:t});return}const q=H.sender===t._id?H.recipient:H.sender;u(re=>{const pe=re.findIndex(ce=>ce.user&&ce.user._id===q);if(pe>=0){const ce=[...re];return ce[pe]={...ce[pe],lastMessage:H,updatedAt:H.createdAt},ce.sort((R,Q)=>new Date(Q.updatedAt)-new Date(R.updatedAt))}else return Pe.get(`/users/${q}`).then(ce=>{ce.success&&ce.data&&ce.data.user?u(R=>{if(R.some(Y=>Y.user&&Y.user._id===q))return R;const Q={user:ce.data.user,lastMessage:H,updatedAt:H.createdAt};return[...R,Q].sort((Y,P)=>new Date(P.updatedAt)-new Date(Y.updatedAt))}):On.error("Invalid user response:",ce)}).catch(ce=>On.error("Error fetching user for conversation:",ce)),re})},[t]),I=y.useCallback(async()=>{if(!r||!(t!=null&&t._id))return On.warn("Cannot get conversations: User is not authenticated"),[];S(!0),U(null);try{On.debug("Fetching conversations");const H=await Yt.getConversations();u(H);const q={};let re=0;return H.forEach(pe=>{q[pe.user._id]=pe.unreadCount||0,re+=pe.unreadCount||0}),m(q),te(re),H}catch(H){const q=H.message||"Failed to load conversations";return U(q),On.error("Error fetching conversations:",H),[]}finally{S(!1)}},[r,t]),E=y.useCallback(async(H,q,re=null)=>{if(!r||!(t!=null&&t._id)||!H)return U("Cannot upload file: Not authenticated or file missing"),null;const pe=5*1024*1024;if(H.size>pe){const R="File is too large (max 5MB allowed)";return U(R),X.error(R),null}if(!["image/jpeg","image/jpg","image/png","image/gif","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","audio/mpeg","audio/wav","video/mp4","video/quicktime"].includes(H.type)){const R="Invalid file type. Only images, documents, audio, and videos are allowed.";return U(R),X.error(R),null}C(!0),U(null);try{On.debug(`Uploading file: ${H.name}`);const R=new FormData;R.append("file",H),q&&R.append("recipient",q);const Q=await Pe.upload("/messages/attachments",R,re);if(Q.success)return On.debug("File uploaded successfully"),Q.data;throw new Error(Q.error||"Failed to upload file")}catch(R){const Q=R.message||"Failed to upload file";return U(Q),X.error(Q),On.error("File upload error:",R),null}finally{C(!1)}},[r,t]),T=y.useCallback(async(H,q,re=null)=>{if(!r||!(t!=null&&t._id)||!H||!q)return U("Cannot send file: Missing authentication, recipient, or file"),null;try{On.debug(`Sending file message to ${H}`);const pe=await E(q,H,re);if(!pe)throw new Error("Failed to upload file");const ce={fileUrl:pe.url,fileName:pe.fileName||q.name,fileSize:pe.fileSize||q.size,mimeType:pe.mimeType||q.type,...pe.metadata};return await Yt.sendMessage(H,pe.fileName||q.name,"file",ce)}catch(pe){const ce=pe.message||"Failed to send file message";return U(ce),X.error(ce),On.error("Send file message error:",pe),null}},[r,t,E]),z=y.useCallback(async H=>{if(!r||!(t!=null&&t._id)||!H)return!1;try{return On.debug(`Marking conversation with ${H} as read`),await Yt.markConversationRead(H),m(q=>{const re={...q,[H]:0},pe=Object.values(re).reduce((ce,R)=>ce+R,0);return te(pe),re}),!0}catch(q){return On.error("Error marking conversation as read:",q),!1}},[r,t]),W=y.useMemo(()=>({conversations:c,unreadCounts:f,typingUsers:v,loading:A,uploading:j,error:M,socketConnected:i,activeConversation:D,totalUnreadCount:K,setActiveConversation:ne,getConversations:I,uploadFile:E,sendFileMessage:T,markConversationRead:z,clearError:B,isInitialized:!!Yt.isReady()}),[c,f,v,A,j,M,i,D,K,I,E,T,z,B]);return o.jsx(C0.Provider,{value:W,children:s})},ks="/stories",Ii=new Map,l4=async()=>{try{const s=await Pe.get(ks);return Array.isArray(s)?{success:!0,data:s}:s}catch(s){return console.error("Error fetching stories:",s),{success:!1,message:s.message||"Failed to fetch stories"}}},c4=async s=>{try{const t=await Pe.get(`${ks}/user/${s}`);return Array.isArray(t)?{success:!0,data:t}:t}catch(t){return console.error(`Error fetching stories for user ${s}:`,t),{success:!1,message:t.message||"Failed to fetch user stories"}}},u4=async(s,t)=>{const r=`create-story-${Date.now()}`;if(Ii.has(r.substring(0,r.length-3)))return console.warn("Duplicate story creation request detected"),{success:!1,message:"A similar request is already in progress"};Ii.set(r,!0);try{if(s instanceof FormData)s.append("timestamp",Date.now().toString());else if(typeof s=="object"){if(s.mediaType==="text"||s.type==="text")return j0(s,t);s.timestamp=Date.now()}const i=await Pe.upload(ks,s,t);return{success:!0,data:i.data||i,message:"Story created successfully"}}catch(i){return console.error("Error creating story:",i),{success:!1}}finally{setTimeout(()=>{Ii.delete(r)},5e3)}},j0=async(s,t)=>{const i=`create-text-story-${s.content?s.content.substring(0,10):""}-${Date.now()}`;if(Ii.has(i.substring(0,i.length-3)))return console.warn("Duplicate text story creation request detected"),{success:!1,message:"A similar request is already in progress"};Ii.set(i,!0);try{const c={...s,timestamp:Date.now(),type:"text",mediaType:"text"},u=await Pe.post(`${ks}/text`,c,{onUploadProgress:t});if(u&&typeof u=="object"){if(u.error)throw new Error(u.error);if(u.success===!1)throw new Error(u.message||"Failed to create text story")}return u.success?{success:!0,data:u.data||u.story,message:"Story created successfully"}:u._id?{success:!0,data:u,message:"Story created successfully"}:u}catch(c){return console.error("Error creating text story:",c),{success:!1,message:c.message||"Failed to create text story"}}finally{setTimeout(()=>{Ii.delete(i)},5e3)}},d4=async s=>{try{const t=await Pe.delete(`${ks}/${s}`);return t&&!t.success&&t.msg?{success:!0,message:t.msg}:t}catch(t){return console.error(`Error deleting story ${s}:`,t),{success:!1,message:t.message||"Failed to delete story"}}},f4=async s=>{try{const t=await Pe.post(`${ks}/${s}/view`);return t&&!t.success&&t.msg?{success:!0,message:t.msg}:t}catch(t){return console.error(`Error marking story ${s} as viewed:`,t),{success:!1,message:t.message||"Failed to mark story as viewed"}}},h4=async(s,t)=>{try{const r=await Pe.post(`${ks}/${s}/react`,{reactionType:t});return r&&r.data&&!r.success?{success:!0,data:r.data,message:"Reaction added successfully"}:r}catch(r){return console.error(`Error reacting to story ${s}:`,r),{success:!1,message:r.message||"Failed to react to story"}}},m4=async s=>{try{return await Pe.delete(`${ks}/${s}/react`)}catch(t){return console.error(`Error removing reaction from story ${s}:`,t),{success:!1,message:t.message||"Failed to remove reaction"}}},p4=async s=>{try{return await Pe.get(`${ks}/${s}/reactions`)}catch(t){return console.error(`Error fetching reactions for story ${s}:`,t),{success:!1,message:t.message||"Failed to fetch story reactions"}}},g4=async s=>{try{return await Pe.get(`${ks}/${s}/viewers`)}catch(t){return console.error(`Error fetching viewers for story ${s}:`,t),{success:!1,message:t.message||"Failed to fetch story viewers"}}},Hr={getAllStories:l4,getUserStories:c4,createStory:u4,createTextStory:j0,deleteStory:d4,markStoryAsViewed:f4,reactToStory:h4,removeReaction:m4,getStoryReactions:p4,getStoryViewers:g4},_0=y.createContext(),A4=({children:s})=>{const{user:t,isAuthenticated:r}=Ot(),[i,c]=y.useState([]),[u,f]=y.useState(!1),[m,v]=y.useState(null),[x,A]=y.useState({}),[S,j]=y.useState(0),[C,M]=y.useState(!1),U=y.useRef(null),D=y.useRef(new Map),ne=y.useRef(null),K=y.useRef(!1),te=y.useRef(null),B=y.useRef(!1),L=y.useCallback((R,Q)=>{let Y;return(...P)=>{clearTimeout(Y),Y=setTimeout(()=>R(...P),Q)}},[]),I=y.useCallback(()=>{v(null)},[]),E=y.useCallback(async(R=!1)=>{if(K.current)return ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{ne.current=null,E(!0)},1e3),i;const Q=Date.now(),Y=Q-S,P=i.length>0&&Y<6e4;if(!R&&P)return i;K.current=!0,f(!0),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{K.current=!1,f(!1),v("Request timeout. Please try again."),te.current=null},3e4);try{const ie=await Hr.getAllStories();if(!ie.success)throw new Error(ie.message||"Failed to load stories");if(!Array.isArray(ie.data))throw new Error("Invalid response format: expected array of stories");const J=new Map,ze=[];for(let de=ie.data.length-1;de>=0;de--){const Z=ie.data[de];!Z||!Z._id||J.has(Z._id)||(J.set(Z._id,!0),ze.unshift(Z))}return c(ze),j(Q),v(null),ze}catch(ie){return v(ie.message||"Failed to load stories"),[]}finally{K.current=!1,f(!1),te.current&&(clearTimeout(te.current),te.current=null),ne.current&&(clearTimeout(ne.current),ne.current=null)}},[S,i]),T=y.useMemo(()=>L(R=>{E(R)},300),[E,L]),z=y.useCallback(async R=>{if(!R)return console.error("Cannot load user stories: Missing userId"),[];const Q=`loadUserStories-${R}`;if(D.current.has(Q))return D.current.get(Q);const Y=(async()=>{try{f(!0);const P=await Hr.getUserStories(R);if(!P.success)throw new Error(P.message||"Failed to load user stories");return Array.isArray(P.data)?[...P.data]:[]}catch(P){return console.error(`Error loading stories for user ${R}:`,P),[]}finally{f(!1),setTimeout(()=>{D.current.delete(Q)},300)}})();return D.current.set(Q,Y),Y},[]),W=y.useCallback(async(R,Q)=>{if(!t)return X.error("You must be logged in to create a story"),{success:!1,message:"You must be logged in to create a story"};if(C||B.current)return;if(M(!0),B.current=!0,f(!0),!R||!R.mediaType)return M(!1),B.current=!1,f(!1),X.error("Invalid story data"),{success:!1,message:"Invalid story data"};const Y={...R};if(Y.mediaType==="text"&&(Y.content=Y.content||Y.text,!Y.content))return M(!1),B.current=!1,f(!1),X.error("Text stories require content"),{success:!1,message:"Text stories require content"};try{let P;if(Y.mediaType==="text"?P=await Hr.createTextStory(Y,Q):P=await Hr.createStory(Y,Q),!P.success)throw new Error(P.message||"Failed to create story");const ie=P.data||P.story;if(!ie)throw new Error("Story created but data not returned");return c(J=>J.some(ze=>ze._id===ie._id)?J:[ie,...J]),P}catch(P){return console.error("Error creating story:",P),X.error(P.message||"Failed to create story"),{success:!1,message:P.message||"Failed to create story"}}finally{f(!1),M(!1),setTimeout(()=>{B.current=!1},500)}},[t,C]),H=y.useCallback(async R=>{if(!t)return X.error("You must be logged in to delete a story"),{success:!1,message:"You must be logged in to delete a story"};if(!R)return X.error("Invalid story ID"),{success:!1,message:"Invalid story ID"};const Q=`deleteStory-${R}`;if(D.current.has(Q))return{success:!1,message:"Delete operation in progress"};const Y=(async()=>{try{f(!0);const P=await Hr.deleteStory(R);if(!P.success)throw new Error(P.message||"Failed to delete story");return c(ie=>ie.filter(J=>J._id!==R)),X.success("Story deleted successfully"),P}catch(P){return console.error(`Error deleting story ${R}:`,P),X.error(P.message||"Failed to delete story"),{success:!1,message:P.message||"Failed to delete story"}}finally{f(!1),setTimeout(()=>{D.current.delete(Q)},300)}})();return D.current.set(Q,Y),Y},[t]),q=y.useCallback(async R=>{if(!t||!R)return!1;const Q=`viewStory-${R}`;if(D.current.has(Q))return D.current.get(Q);if(x[R])return!0;const Y=(async()=>{try{const P=await Hr.markStoryAsViewed(R);if(!P.success)throw new Error(P.message||"Failed to mark story as viewed");return A(ie=>({...ie,[R]:Date.now()})),!0}catch(P){return console.error(`Error marking story ${R} as viewed:`,P),!1}finally{setTimeout(()=>{D.current.delete(Q)},300)}})();return D.current.set(Q,Y),Y},[t,x]),re=y.useCallback(R=>{if(!i||!R||!t)return!1;const Q=i.filter(Y=>Y?(Y.user&&(typeof Y.user=="string"?Y.user:Y.user._id))===R:!1);return!Q||Q.length===0?!1:Q.some(Y=>!x[Y._id])},[i,x,t]),pe=y.useCallback(async(R,Q)=>{if(!t)return X.error("You must be logged in to react to a story"),{success:!1};if(!R||!Q)return X.error("Invalid story ID or reaction type"),{success:!1,message:"Invalid story ID or reaction type"};const Y=`reactToStory-${R}-${Q}`;if(D.current.has(Y))return D.current.get(Y);const P=(async()=>{try{const ie=await Hr.reactToStory(R,Q);if(!ie.success)throw new Error(ie.message||"Failed to react to story");return X.success("Reaction added!"),ie}catch(ie){return console.error("Error reacting to story:",ie),X.error(ie.message||"Failed to add reaction"),{success:!1}}finally{setTimeout(()=>{D.current.delete(Y)},300)}})();return D.current.set(Y,P),P},[t]);y.useEffect(()=>{if(t)try{const R=`viewedStories_${t._id}`,Q=localStorage.getItem(R);if(Q){const Y=JSON.parse(Q);Y&&typeof Y=="object"&&A(Y)}}catch(R){console.error("Error parsing viewed stories from localStorage:",R),A({})}},[t]),y.useEffect(()=>{if(!t||Object.keys(x).length===0)return;const R=`viewedStories_${t._id}`;return L(()=>{try{localStorage.setItem(R,JSON.stringify(x))}catch(Y){console.error("Error saving viewed stories to localStorage:",Y)}},1e3)(),()=>{try{localStorage.setItem(R,JSON.stringify(x))}catch(Y){console.error("Error saving viewed stories to localStorage on unmount:",Y)}}},[x,t,L]),y.useEffect(()=>{if(U.current&&(clearInterval(U.current),U.current=null),!r)return;const R=setTimeout(()=>{r&&T(!1)},1e3),Q=setInterval(()=>{document.visibilityState==="visible"&&!K.current&&T(!0)},5*60*1e3);return U.current=Q,()=>{clearTimeout(R),U.current&&(clearInterval(U.current),U.current=null),ne.current&&(clearTimeout(ne.current),ne.current=null),te.current&&(clearTimeout(te.current),te.current=null)}},[r,T]);const ce=y.useMemo(()=>({stories:i,loading:u,error:m,clearError:I,loadStories:E,loadUserStories:z,createStory:W,deleteStory:H,viewStory:q,reactToStory:pe,hasUnviewedStories:re,viewedStories:x}),[i,u,m,I,E,z,W,H,q,pe,re,x]);return o.jsx(_0.Provider,{value:ce,children:s})},Wi=()=>{const s=y.useContext(_0);return s===void 0?(console.warn("useStories must be used within a StoriesProvider"),null):s};function E0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(s)}function N0(s){return Oe({attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(s)}function sf(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(s)}function Zl(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(s)}function rf(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"},child:[]}]})(s)}function y4(s){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-90.62-70.05c.19-1.38.8-2.66.8-4.06.05-7.55-2.61-15.27-8.61-21.71-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84c-40.33 8.38-74.66 31.07-97.59 62.57L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.35 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.42-6.97 4.17-17.02-2.81-22.45zM157.23 251.54c-8.61 67.96-36.41 93.33-52.62 110.75-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h241.92L157.23 251.54zM320 512c35.32 0 63.97-28.65 63.97-64H256.03c0 35.35 28.65 64 63.97 64z"},child:[]}]})(s)}function Yi(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(s)}function qf(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(s)}function Jl(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"},child:[]}]})(s)}function T0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 174.8l-39.6-39.6c-9.4-9.4-24.6-9.4-33.9 0L192 374.7 80.6 263.2c-9.4-9.4-24.6-9.4-33.9 0L7 302.9c-9.4 9.4-9.4 24.6 0 34L175 505c9.4 9.4 24.6 9.4 33.9 0l296-296.2c9.4-9.5 9.4-24.7.1-34zm-324.3 106c6.2 6.3 16.4 6.3 22.6 0l208-208.2c6.2-6.3 6.2-16.4 0-22.6L366.1 4.7c-6.2-6.3-16.4-6.3-22.6 0L192 156.2l-55.4-55.5c-6.2-6.3-16.4-6.3-22.6 0L68.7 146c-6.2 6.3-6.2 16.4 0 22.6l112 112.2z"},child:[]}]})(s)}function pt(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(s)}function dc(s){return Oe({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(s)}function R0(s){return Oe({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(s)}function Wg(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(s)}function ea(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"},child:[]}]})(s)}function v4(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(s)}function M0(s){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"},child:[]}]})(s)}function b4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(s)}function x4(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(s)}function O0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"},child:[]}]})(s)}function S4(s){return Oe({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"},child:[]}]})(s)}function w4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 464c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V200.724a48 48 0 0 1 18.387-37.776c24.913-19.529 45.501-35.365 164.2-121.511C199.412 29.17 232.797-.347 256 .003c23.198-.354 56.596 29.172 73.413 41.433 118.687 86.137 139.303 101.995 164.2 121.512A48 48 0 0 1 512 200.724V464zm-65.666-196.605c-2.563-3.728-7.7-4.595-11.339-1.907-22.845 16.873-55.462 40.705-105.582 77.079-16.825 12.266-50.21 41.781-73.413 41.43-23.211.344-56.559-29.143-73.413-41.43-50.114-36.37-82.734-60.204-105.582-77.079-3.639-2.688-8.776-1.821-11.339 1.907l-9.072 13.196a7.998 7.998 0 0 0 1.839 10.967c22.887 16.899 55.454 40.69 105.303 76.868 20.274 14.781 56.524 47.813 92.264 47.573 35.724.242 71.961-32.771 92.263-47.573 49.85-36.179 82.418-59.97 105.303-76.868a7.998 7.998 0 0 0 1.839-10.967l-9.071-13.196z"},child:[]}]})(s)}function If(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(s)}function Ut(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(s)}function k4(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"},child:[]}]})(s)}function D0(s){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(s)}function fc(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(s)}function af(s){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(s)}function of(s){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm-64 268c0 10.7-12.9 16-20.5 8.5L104 376H76c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h28l35.5-36.5c7.6-7.6 20.5-2.2 20.5 8.5v136zm33.2-47.6c9.1-9.3 9.1-24.1 0-33.4-22.1-22.8 12.2-56.2 34.4-33.5 27.2 27.9 27.2 72.4 0 100.4-21.8 22.3-56.9-10.4-34.4-33.5zm86-117.1c54.4 55.9 54.4 144.8 0 200.8-21.8 22.4-57-10.3-34.4-33.5 36.2-37.2 36.3-96.5 0-133.8-22.1-22.8 12.3-56.3 34.4-33.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(s)}function lf(s){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z"},child:[]}]})(s)}function cf(s){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M384 121.941V128H256V0h6.059c6.365 0 12.47 2.529 16.971 7.029l97.941 97.941A24.005 24.005 0 0 1 384 121.941zM224 136V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248c-13.2 0-24-10.8-24-24zm96 144.016v111.963c0 21.445-25.943 31.998-40.971 16.971L224 353.941V392c0 13.255-10.745 24-24 24H88c-13.255 0-24-10.745-24-24V280c0-13.255 10.745-24 24-24h112c13.255 0 24 10.745 24 24v38.059l55.029-55.013c15.011-15.01 40.971-4.491 40.971 16.97z"},child:[]}]})(s)}function uf(s){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(s)}function L0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(s)}function z0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048 34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122 53.588 0 97.844 34.783 165.217 34.783 48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016-34.338 15.948-76.454 31.854-116.95 31.854z"},child:[]}]})(s)}function eA(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"},child:[]}]})(s)}function Xs(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(s)}function Ao(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"},child:[]}]})(s)}function C4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(s)}function j4(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"},child:[]}]})(s)}function Jn(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(s)}function uo(s){return Oe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(s)}function tA(s){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"},child:[]}]})(s)}function _4(s){return Oe({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"},child:[]}]})(s)}function E4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"},child:[]}]})(s)}function df(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(s)}function U0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(s)}function B0(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"},child:[]}]})(s)}function N4(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(s)}function P0(s){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z"},child:[]}]})(s)}function $0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(s)}function Ja(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(s)}function T4(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(s)}function R4(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"},child:[]}]})(s)}function Ff(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(s)}function M4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"},child:[]}]})(s)}function O4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"},child:[]}]})(s)}function D4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(s)}function q0(s){return Oe({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"},child:[]}]})(s)}function Ln(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(s)}function L4(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(s)}function z4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"},child:[]}]})(s)}function nA(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"},child:[]}]})(s)}function Wl(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(s)}function U4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z"},child:[]}]})(s)}function B4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"},child:[]}]})(s)}function xn(s){return Oe({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(s)}function ao(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(s)}function I0(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M552 64H448V24c0-13.3-10.7-24-24-24H152c-13.3 0-24 10.7-24 24v40H24C10.7 64 0 74.7 0 88v56c0 35.7 22.5 72.4 61.9 100.7 31.5 22.7 69.8 37.1 110 41.7C203.3 338.5 240 360 240 360v72h-48c-35.3 0-64 20.7-64 56v12c0 6.6 5.4 12 12 12h296c6.6 0 12-5.4 12-12v-12c0-35.3-28.7-56-64-56h-48v-72s36.7-21.5 68.1-73.6c40.3-4.6 78.6-19 110-41.7 39.3-28.3 61.9-65 61.9-100.7V88c0-13.3-10.7-24-24-24zM99.3 192.8C74.9 175.2 64 155.6 64 144v-16h64.2c1 32.6 5.8 61.2 12.8 86.2-15.1-5.2-29.2-12.4-41.7-21.4zM512 144c0 16.1-17.7 36.1-35.3 48.8-12.5 9-26.7 16.2-41.8 21.4 7-25 11.8-53.6 12.8-86.2H512v16z"},child:[]}]})(s)}function Rd(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"},child:[]}]})(s)}function Gi(s){return Oe({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(s)}function Pl(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(s)}function sA(s){return Oe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.8 458.1l-55-42.5c15.4-1.4 29.2-13.7 29.2-31.1v-257c0-25.5-29.1-40.4-50.4-25.8L448 177.3v137.2l-32-24.7v-178c0-26.4-21.4-47.8-47.8-47.8H123.9L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4L42.7 82 416 370.6l178.5 138c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.5-6.9 4.2-17-2.8-22.4zM32 400.2c0 26.4 21.4 47.8 47.8 47.8h288.4c11.2 0 21.4-4 29.6-10.5L32 154.7v245.5z"},child:[]}]})(s)}function Jr(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z"},child:[]}]})(s)}function P4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"},child:[]}]})(s)}function $4(s){return Oe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"},child:[]}]})(s)}function F0(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"},child:[]}]})(s)}function q4(s){return Oe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(s)}function I4(s){return Oe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"},child:[]}]})(s)}const H0=y.createContext(),F4=(s,t)=>{switch(t.type){case"SET_LOADING":return{...s,loading:t.payload};case"GET_USERS":return{...s,users:t.payload,loading:!1};case"APPEND_USERS":return{...s,users:[...s.users,...t.payload],loading:!1};case"GET_USER":return{...s,currentUser:t.payload.user,messages:t.payload.messages,loading:!1};case"USER_ONLINE":return{...s,users:s.users.map(i=>i._id===t.payload.userId?{...i,isOnline:!0,lastActive:Date.now()}:i),currentUser:s.currentUser&&s.currentUser._id===t.payload.userId?{...s.currentUser,isOnline:!0,lastActive:Date.now()}:s.currentUser};case"USER_OFFLINE":return{...s,users:s.users.map(i=>i._id===t.payload.userId?{...i,isOnline:!1,lastActive:Date.now()}:i),currentUser:s.currentUser&&s.currentUser._id===t.payload.userId?{...s.currentUser,isOnline:!1,lastActive:Date.now()}:s.currentUser};case"UPLOAD_PHOTO":return{...s,currentUser:s.currentUser?{...s.currentUser,photos:[...s.currentUser.photos||[],t.payload]}:s.currentUser,uploadingPhoto:!1};case"UPLOADING_PHOTO":return{...s,uploadingPhoto:!0};case"PHOTO_PERMISSION_REQUESTED":return{...s,photoPermissions:[...s.photoPermissions,t.payload]};case"PHOTO_PERMISSION_UPDATED":return{...s,photoPermissions:s.photoPermissions.map(i=>i._id===t.payload._id?t.payload:i)};case"UPDATE_PROFILE":const r={...s.currentUser};if(Object.keys(t.payload).forEach(i=>{i!=="settings"&&(r[i]=t.payload[i])}),t.payload.settings){if(r.settings||(r.settings={}),t.payload.settings.notifications){const i={},c=t.payload.settings.notifications;"messages"in c&&(i.messages=c.messages===!1?!1:!!c.messages),"calls"in c&&(i.calls=c.calls===!1?!1:!!c.calls),"stories"in c&&(i.stories=c.stories===!1?!1:!!c.stories),"likes"in c&&(i.likes=c.likes===!1?!1:!!c.likes),"comments"in c&&(i.comments=c.comments===!1?!1:!!c.comments),"photoRequests"in c&&(i.photoRequests=c.photoRequests===!1?!1:!!c.photoRequests),console.log("Normalized notification settings for user update:",i),r.settings.notifications={...r.settings.notifications||{},...i}}t.payload.settings.privacy&&(r.settings.privacy={...r.settings.privacy||{},...t.payload.settings.privacy}),console.log("Merged settings in user reducer:",r.settings)}return{...s,currentUser:r,updatingProfile:!1};case"UPDATING_PROFILE":return{...s,updatingProfile:!0};case"SET_LIKED_USERS":return{...s,likedUsers:t.payload};case"ADD_LIKED_USER":return s.likedUsers.some(i=>i.recipient&&i.recipient._id&&i.recipient._id===t.payload.recipient||i.recipient===t.payload.recipient)?s:{...s,likedUsers:[...s.likedUsers,t.payload]};case"REMOVE_LIKED_USER":return{...s,likedUsers:s.likedUsers.filter(i=>typeof i.recipient=="object"&&i.recipient!==null?i.recipient._id!==t.payload:i.recipient!==t.payload)};case"SET_LIKES_LOADING":return{...s,likesLoading:t.payload};case"USER_ERROR":return X.error(t.payload),{...s,error:t.payload,loading:!1,uploadingPhoto:!1,updatingProfile:!1,likesLoading:!1};case"CLEAR_ERROR":return{...s,error:null};default:return s}},H4={users:[],currentUser:null,messages:[],photoPermissions:[],loading:!1,uploadingPhoto:!1,updatingProfile:!1,likedUsers:[],likesLoading:!0,error:null},V4=({children:s})=>{const[t,r]=y.useReducer(F4,H4),{user:i,isAuthenticated:c}=Ot(),u=y.useRef(null),f=y.useRef(!1),m=y.useCallback(async(E=1,T=20)=>{var z,W;r({type:"SET_LOADING",payload:E===1});try{const H=await Pe.get(`/users?page=${E}&limit=${T}`);if(H.success)return r({type:E===1?"GET_USERS":"APPEND_USERS",payload:H.data}),{users:H.data,hasMore:H.hasMore||((z=H.pagination)==null?void 0:z.hasNext)||H.data.length===T,totalPages:((W=H.pagination)==null?void 0:W.totalPages)||Math.ceil(H.totalCount/T)||1};throw new Error(H.error||"Failed to fetch users")}catch(H){const q=H.error||H.message||"Failed to fetch users";return r({type:"USER_ERROR",payload:q}),{users:[],hasMore:!1,totalPages:1}}},[]),v=y.useCallback(async(E=!1)=>{!t.likesLoading&&E&&r({type:"SET_LIKES_LOADING",payload:!0});try{if(!i||!i._id||typeof i._id!="string"){console.warn("Current user ID is missing or invalid",i),r({type:"SET_LIKES_LOADING",payload:!1});return}if(!/^[0-9a-fA-F]{24}$/.test(i._id)){console.warn(`Invalid user ID format: ${i._id}`),r({type:"SET_LIKES_LOADING",payload:!1});return}console.log("Fetching liked users from server with forceRefresh:",E);const z=await Pe.get("/users/likes",{},{headers:E?{"x-no-cache":"true"}:{},useCache:!E});z.success?(console.log("Liked users response:",z.data),r({type:"SET_LIKED_USERS",payload:z.data||[]}),f.current=!0):(console.error("Error in getLikedUsers:",z.error),r({type:"SET_LIKED_USERS",payload:[]}))}catch(T){console.error("Error fetching liked users:",T),r({type:"SET_LIKED_USERS",payload:[]})}finally{r({type:"SET_LIKES_LOADING",payload:!1})}},[i]);y.useEffect(()=>{if(c&&i&&i._id){v(!0);const E=setInterval(()=>{document.visibilityState==="visible"&&v(!0)},5*60*1e3);return()=>clearInterval(E)}else r({type:"SET_LIKED_USERS",payload:[]}),f.current=!1},[c,i,v]);const x=y.useCallback(()=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{c&&i&&m()},500)},[c,i,m]);y.useEffect(()=>(c&&i&&x(),()=>{u.current&&clearTimeout(u.current)}),[c,i,x]);const A=y.useCallback(async E=>{if(!E)return null;if(!/^[0-9a-fA-F]{24}$/.test(E))return r({type:"USER_ERROR",payload:"Invalid user ID format"}),null;r({type:"SET_LOADING",payload:!0});try{const z=await Pe.get(`/users/${E}`);if(z.success){if(r({type:"GET_USER",payload:z.data}),i&&E===i._id&&z.data.user&&z.data.user.settings)try{Promise.all([jn(()=>Promise.resolve().then(()=>Fi),void 0),jn(()=>Promise.resolve().then(()=>qi),void 0)]).then(([W,H])=>{const q=W.default,re=H.default;console.log("Initializing services with user settings:",z.data.user.settings),q.initialize(z.data.user.settings),z.data.user.settings.privacy&&re.updatePrivacySettings(z.data.user.settings.privacy),console.log("Services initialized with user settings")}).catch(W=>{console.error("Error initializing services with settings:",W)})}catch(W){console.error("Error in dynamic import for services:",W)}return z.data}else throw new Error(z.error||"Failed to fetch user")}catch(z){const W=z.error||z.message||"Failed to fetch user";return r({type:"USER_ERROR",payload:W}),null}},[i]),S=y.useCallback(async E=>{r({type:"UPDATING_PROFILE",payload:!0});try{console.log("Updating profile with data:",E);const T=await Pe.put("/users/profile",E);if(T.success){if(E.settings&&(T.data.settings||(T.data.settings={}),E.settings.notifications&&!T.data.settings.notifications&&(T.data.settings.notifications=E.settings.notifications),E.settings.privacy&&!T.data.settings.privacy&&(T.data.settings.privacy=E.settings.privacy),console.log("Using settings in UPDATE_PROFILE:",T.data.settings)),r({type:"UPDATE_PROFILE",payload:T.data}),E.settings)try{Promise.all([jn(()=>Promise.resolve().then(()=>Fi),void 0),jn(()=>Promise.resolve().then(()=>qi),void 0)]).then(([z,W])=>{const H=z.default,q=W.default;E.settings.notifications&&(console.log("Updating notification service after profile update:",E.settings.notifications),H.updateSettings(E.settings.notifications)),E.settings.privacy&&(console.log("Updating socket service after profile update:",E.settings.privacy),q.updatePrivacySettings(E.settings.privacy)),console.log("Services updated after profile update with new settings")}).catch(z=>{console.error("Error updating services after profile update:",z)})}catch(z){console.error("Error importing services for settings update:",z)}return X.success("Profile updated successfully"),T.data}else throw new Error(T.error||"Failed to update profile")}catch(T){const z=T.error||T.message||"Failed to update profile";return r({type:"USER_ERROR",payload:z}),null}},[]),j=y.useCallback(async(E,T)=>{r({type:"UPLOADING_PHOTO",payload:!0});try{const z=new FormData;z.append("photo",E),z.append("isPrivate",T);const W=await Pe.upload("/users/photos",z,H=>{console.log(`Upload progress: ${H}%`)});if(W.success)return r({type:"UPLOAD_PHOTO",payload:W.data}),X.success(`${T?"Private":"Public"} photo uploaded successfully`),W.data;throw new Error(W.error||"Failed to upload photo")}catch(z){const W=z.error||z.message||"Failed to upload photo";return r({type:"USER_ERROR",payload:W}),null}},[]),C=y.useCallback(async(E,T)=>{try{const z=await Pe.post(`/photos/${E}/request`,{userId:T});if(z.success)return r({type:"PHOTO_PERMISSION_REQUESTED",payload:z.data}),X.success("Photo access request sent"),z.data;throw new Error(z.error||"Failed to request photo access")}catch(z){const W=z.error||z.message||"Failed to request photo access";return r({type:"USER_ERROR",payload:W}),null}},[]),M=y.useCallback(async(E,T)=>{try{const z=await Pe.put(`/photos/permissions/${E}`,{status:T});if(z.success)return r({type:"PHOTO_PERMISSION_UPDATED",payload:z.data}),X.success(`Photo access ${T}`),z.data;throw new Error(z.error||`Failed to ${T} photo access`)}catch(z){const W=z.error||z.message||`Failed to ${T} photo access`;return r({type:"USER_ERROR",payload:W}),null}},[]),U=y.useCallback(async(E=null)=>{E?await A(E):t.currentUser&&await A(t.currentUser._id),await m()},[t.currentUser,A,m]),D=y.useCallback(()=>{r({type:"CLEAR_ERROR"})},[]),ne=y.useCallback(E=>{if(!t.likedUsers||!Array.isArray(t.likedUsers)||!E)return!1;const T=typeof E=="object"&&E!==null?E.toString():E;return t.likedUsers.some(z=>z?typeof z.recipient=="object"&&z.recipient!==null?z.recipient._id?z.recipient._id.toString()===T:z.recipient.toString()===T:z.recipient===T:!1)},[t.likedUsers]),K=y.useCallback(async(E,T)=>{if(!i||!i._id)return!1;try{if(!E||!/^[0-9a-fA-F]{24}$/.test(E))return X.error("Invalid user ID format"),!1;if(ne(E))return console.log(`User ${E} is already liked, skipping API call`),!0;r({type:"ADD_LIKED_USER",payload:{recipient:E,createdAt:new Date().toISOString()}}),console.log(`Sending like request for user ${E}`);const z=await Pe.post(`/users/${E}/like`,{},{headers:{"x-no-cache":"true"}});return z.success?(v(!0),X.success(o.jsxs("div",{className:"like-toast",children:[o.jsx(Xs,{className:"like-icon pulse"}),o.jsxs("span",{children:["You liked ",T||"this user"]})]})),z.likesRemaining!==void 0&&X.info(`You have ${z.likesRemaining} likes remaining today`),!0):z.error==="Already liked"?(console.log("User already liked according to server"),!0):(r({type:"REMOVE_LIKED_USER",payload:E}),X.error(z.error||"Failed to like user"),!1)}catch(z){r({type:"REMOVE_LIKED_USER",payload:E});const W=z.error||z.message||"Failed to like user";return X.error(W),console.error("Like error:",z),!1}},[i,ne,v,r]),te=y.useCallback(async(E,T)=>{if(!i||!i._id)return!1;try{if(!E||!/^[0-9a-fA-F]{24}$/.test(E))return X.error("Invalid user ID format"),!1;if(!ne(E))return console.log(`User ${E} is not liked, skipping API call`),!0;r({type:"REMOVE_LIKED_USER",payload:E}),console.log(`Sending unlike request for user ${E}`);const z=await Pe.delete(`/users/${E}/like`,{},{headers:{"x-no-cache":"true"}});if(z.success)return v(!0),X.info(`You unliked ${T||"this user"}`),!0;throw r({type:"ADD_LIKED_USER",payload:{recipient:E,createdAt:new Date().toISOString()}}),new Error(z.error||"Failed to unlike user")}catch(z){v(!0);const W=z.error||z.message||"Failed to unlike user";return X.error(W),console.error("Unlike error:",z),!1}},[i,v,ne,r]),B=y.useCallback(async E=>{try{const T=await Pe.post("/messages/start",{recipient:E});if(T.success)return T.data;throw new Error(T.error||"Failed to send message")}catch(T){const z=T.error||T.message||"Failed to send message";return r({type:"USER_ERROR",payload:z}),null}},[]),L=y.useCallback(async E=>{try{const T=await Pe.post(`/users/${E}/block`);if(T.success)return X.success("User blocked successfully"),!0;throw new Error(T.error||"Failed to block user")}catch(T){const z=T.error||T.message||"Failed to block user";return r({type:"USER_ERROR",payload:z}),!1}},[]),I=y.useCallback(async E=>{try{const T=await Pe.post(`/users/${E}/report`);if(T.success)return X.success("User reported successfully"),!0;throw new Error(T.error||"Failed to report user")}catch(T){const z=T.error||T.message||"Failed to report user";return r({type:"USER_ERROR",payload:z}),!1}},[]);return o.jsx(H0.Provider,{value:{users:t.users,currentUser:t.currentUser,messages:t.messages,photoPermissions:t.photoPermissions,loading:t.loading,uploadingPhoto:t.uploadingPhoto,updatingProfile:t.updatingProfile,error:t.error,likedUsers:t.likedUsers,likesLoading:t.likesLoading,getUsers:m,getUser:A,updateProfile:S,uploadPhoto:j,requestPhotoPermission:C,updatePhotoPermission:M,refreshUserData:U,clearError:D,isUserLiked:ne,likeUser:K,unlikeUser:te,getLikedUsers:v,sendMessage:B,blockUser:L,reportUser:I},children:s})},ti=()=>{const s=y.useContext(H0);if(s===void 0)throw new Error("useUser must be used within a UserProvider");return s},V0=y.createContext(),Y4=({children:s})=>{const[t,r]=y.useState(()=>{const u=localStorage.getItem("theme");return u||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});y.useEffect(()=>{const u=window.document.documentElement;u.classList.remove("light","dark"),u.classList.add(t),localStorage.setItem("theme",t)},[t]);const i=()=>{r(u=>u==="light"?"dark":"light")},c=u=>{["light","dark","system"].includes(u)&&r(u)};return o.jsx(V0.Provider,{value:{theme:t,toggleTheme:i,setTheme:c},children:s})},Y0=()=>{const s=y.useContext(V0);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},gn=Rt.create("NotificationService");class G4{constructor(){this.notifications=[],this.unreadCount=0,this.initialized=!1,this.userSettings=null,this.listeners=[],this.navigate=null,this.socketListeners=[],this.socketReconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectTimer=null,this.isLoading=!1,this.lastFetch=0,this.fetchQueue=Promise.resolve(),this.bundleTimeframe=60*60*1e3,this.notificationEventTypes=["notification","newMessage","newLike","photoPermissionRequestReceived","photoPermissionResponseReceived","newComment","incomingCall","newStory"],this.setupNotificationSyncChannel()}setupNotificationSyncChannel(){try{typeof BroadcastChannel<"u"?(this.notificationSyncChannel=new BroadcastChannel("notification_sync"),this.notificationSyncChannel.onmessage=t=>{const{type:r,data:i}=t.data||{};if(r)switch(r){case"NEW_NOTIFICATION":gn.debug("Received new notification from another tab"),this.addBundledNotification(i),window.dispatchEvent(new CustomEvent("newNotification",{detail:i}));break;case"MARK_READ":i&&i.notificationId&&this.markAsRead(i.notificationId,!1);break;case"MARK_ALL_READ":this.markAllAsRead(!1);break;default:break}},gn.info("Notification sync channel initialized")):gn.warn("BroadcastChannel not supported, cross-tab sync disabled")}catch(t){gn.error("Error setting up notification sync channel:",t),this.notificationSyncChannel=null}}setNavigate(t){typeof t=="function"?(this.navigate=t,gn.debug("Navigate function set successfully in NotificationService")):gn.warn("Attempted to set invalid navigate function in NotificationService")}initialize(t){var r,i;if(this.initialized){gn.debug("NotificationService already initialized"),t&&t.notifications&&(gn.debug("Updating settings of already initialized service:",t),this.userSettings=t);return}gn.info("Initializing NotificationService with settings:",t),gn.debug("Messages notification setting specifically:",(r=t==null?void 0:t.notifications)==null?void 0:r.messages,"typeof:",typeof((i=t==null?void 0:t.notifications)==null?void 0:i.messages)),this.userSettings=t||{notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0,photoRequests:!0}},this.userSettings.notifications||(this.userSettings.notifications={messages:!0,calls:!0,stories:!0,likes:!0,comments:!0,photoRequests:!0}),this.checkSocketConnection(),this._setupSocketConnectionRetry(),this.initialized=!0,this.getNotifications().catch(c=>{gn.error("Failed to fetch initial notifications:",c)}),gn.info("NotificationService initialized successfully with settings:",this.userSettings),gn.debug("Final messages notification setting:",this.userSettings.notifications.messages),document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this))}_setupSocketConnectionRetry(){this.reconnectTimer&&clearInterval(this.reconnectTimer),this.reconnectTimer=setInterval(()=>{!Se.isConnected()&&this.initialized?this.socketReconnectAttempts<this.maxReconnectAttempts?(gn.info(`Attempting to reconnect socket for notifications (attempt ${this.socketReconnectAttempts+1}/${this.maxReconnectAttempts})`),this.socketReconnectAttempts++,this.checkSocketConnection()):this.socketReconnectAttempts===this.maxReconnectAttempts&&(gn.warn("Max socket reconnection attempts reached for notifications"),this.socketReconnectAttempts++,clearInterval(this.reconnectTimer),this.reconnectTimer=setInterval(()=>{gn.info("Periodic socket reconnection attempt for notifications"),this.checkSocketConnection()},12e4)):Se.isConnected()&&(this.socketReconnectAttempts=0)},3e4)}_handleVisibilityChange(){document.visibilityState==="visible"&&Date.now()-this.lastFetch>6e4&&(console.log("Tab became visible, refreshing notifications"),this.refreshNotifications())}cleanup(){this.socketListeners.forEach(t=>{typeof t=="function"&&t()}),this.socketListeners=[],this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null),this.notificationSyncChannel&&(this.notificationSyncChannel.close(),this.notificationSyncChannel=null),document.removeEventListener("visibilitychange",this._handleVisibilityChange),console.log("NotificationService resources cleaned up")}checkSocketConnection(){return Se.isConnected()?(console.log("Socket is connected, registering notification listeners"),this.registerSocketListeners(),!0):(console.log("Socket is not connected, notification listeners not registered"),!1)}registerSocketListeners(){if(this.cleanup(),!Se.isConnected()){console.warn("NotificationService: Socket not connected. Cannot register listeners.");return}const t=[{event:"newMessage",type:"message",settingName:"messages",handler:this._handleMessageNotification.bind(this)},{event:"incomingCall",type:"call",handler:this._handleCallNotification.bind(this)},{event:"newStory",type:"story",handler:this._handleStoryNotification.bind(this)},{event:"newLike",type:"like",handler:this._handleLikeNotification.bind(this)},{event:"newComment",type:"comment",handler:this._handleCommentNotification.bind(this)},{event:"photoPermissionRequestReceived",type:"photoRequest",handler:this._handlePhotoRequestNotification.bind(this)},{event:"photoPermissionResponseReceived",type:"photoResponse",handler:this._handlePhotoResponseNotification.bind(this)},{event:"notification",type:"generic",handler:this._handleGenericNotification.bind(this)}];t.forEach(({event:c,handler:u})=>{const f=Se.on(c,u);this.socketListeners.push(f)});const r=()=>{console.log("Socket reconnected, refreshing notifications"),this.refreshNotifications()},i=Se.on("connect",r);this.socketListeners.push(i),console.log(`Registered ${t.length} socket notification listeners`)}_handleMessageNotification(t){var r;if(console.log("Checking if message notification should be shown"),this.shouldShowNotification("message")&&t){console.log("Message notification will be shown");const i={_id:t._id||`msg-${Date.now()}`,type:"message",title:`New message from ${((r=t.sender)==null?void 0:r.nickname)||"Someone"}`,message:t.content,time:"Just now",read:!1,sender:t.sender,data:t,createdAt:t.createdAt||new Date().toISOString()};this.addBundledNotification(i)}else console.log("Message notification suppressed by settings")}_handleCallNotification(t){var r,i,c;if(this.shouldShowNotification("calls")&&t){const u={_id:t.callId||`call-${Date.now()}`,type:"call",title:`Incoming call from ${((r=t.caller)==null?void 0:r.name)||"Someone"}`,message:"Click to answer",time:"Just now",read:!1,sender:{_id:(i=t.caller)==null?void 0:i.userId,nickname:((c=t.caller)==null?void 0:c.name)||"Caller"},data:t,createdAt:new Date().toISOString()};this.addBundledNotification(u)}}_handleStoryNotification(t){var r;if(this.shouldShowNotification("stories")&&t){const i={_id:t._id||`story-${Date.now()}`,type:"story",title:`${((r=t.user)==null?void 0:r.nickname)||"Someone"} shared a new story`,message:"Click to view",time:"Just now",read:!1,sender:t.user,data:t,createdAt:t.createdAt||new Date().toISOString()};this.addBundledNotification(i)}}_handleLikeNotification(t){var r;if(this.shouldShowNotification("likes")&&t){const i={_id:t.likeId||`like-${Date.now()}`,type:"like",title:`${((r=t.sender)==null?void 0:r.nickname)||"Someone"} liked you`,message:t.isMatch?"You have a new match!":"Click to view profile",time:"Just now",read:!1,sender:t.sender,data:t,isMatch:t.isMatch,createdAt:t.timestamp?new Date(t.timestamp).toISOString():new Date().toISOString()};this.addBundledNotification(i)}}_handleCommentNotification(t){var r;if(this.shouldShowNotification("comments")&&t){const i={_id:t._id||`comment-${Date.now()}`,type:"comment",title:`${((r=t.user)==null?void 0:r.nickname)||"Someone"} commented on your post`,message:t.content||"Click to view",time:"Just now",read:!1,sender:t.user,data:t,createdAt:t.createdAt||new Date().toISOString()};this.addBundledNotification(i)}}_handlePhotoRequestNotification(t){var r;if(this.shouldShowNotification("photoRequests")&&t){const i=((r=t.sender)==null?void 0:r.nickname)||"Someone",c={_id:t.permissionId||`permReq-${Date.now()}`,type:"photoRequest",title:`${i} requested photo access`,message:"Click to review",time:"Just now",read:!1,sender:t.sender,data:t,createdAt:t.timestamp?new Date(t.timestamp).toISOString():new Date().toISOString()};this.addBundledNotification(c)}}_handlePhotoResponseNotification(t){var r;if(this.shouldShowNotification("photoRequests")&&t){const i=((r=t.sender)==null?void 0:r.nickname)||"Someone",c=t.status==="approved"?"approved":"rejected",u={_id:t.permissionId||`permRes-${Date.now()}`,type:"photoResponse",title:`${i} ${c} your request`,message:t.status==="approved"?"You can now view their photo.":"Request declined.",time:"Just now",read:!1,sender:t.sender,data:t,createdAt:t.timestamp?new Date(t.timestamp).toISOString():new Date().toISOString()};this.addBundledNotification(u),window.dispatchEvent(new CustomEvent("permissionStatusUpdated",{detail:{photoId:t.photoId,status:t.status}}))}}_handleGenericNotification(t){t!=null&&t.type&&this.shouldShowNotification(t.type)&&this.addBundledNotification(t)}shouldShowNotification(t){var i,c,u,f,m,v;if(!this.initialized||!this.userSettings)return console.log(`Notification check - not initialized yet, defaulting to show ${t}`),!0;if(t==="photoRequest"||t==="photoResponse"){const x=((i=this.userSettings.notifications)==null?void 0:i.photoRequests)!==!1;return console.log(`Notification ${t} check - photoRequests setting:`,(c=this.userSettings.notifications)==null?void 0:c.photoRequests,"shouldShow:",x),x}if(t==="message"){if(((u=this.userSettings.notifications)==null?void 0:u.message)!==void 0){const x=this.userSettings.notifications.message,A=x!==!1;return console.log('Message notification check - direct "message" setting:',x,"typeof:",typeof x,"shouldShow:",A),A}if(((f=this.userSettings.notifications)==null?void 0:f.messages)!==void 0){const x=this.userSettings.notifications.messages,A=x!==!1;return console.log('Message notification check - "messages" setting:',x,"typeof:",typeof x,"shouldShow:",A),A}return console.log("Message notification check - no setting found, defaulting to true"),!0}const r=((m=this.userSettings.notifications)==null?void 0:m[t])!==!1;return console.log(`Notification ${t} check - setting:`,(v=this.userSettings.notifications)==null?void 0:v[t],"shouldShow:",r),r}isValidNotification(t){if(!t)return!1;const r=t._id||t.id,i=t.message||t.title||t.content,c=t.type;return!!(r&&i&&c)}sanitizeNotification(t){if(!t)return null;const r={...t};return!r._id&&!r.id&&(r._id=`gen-${Date.now()}-${Math.random().toString(16).substring(2,8)}`),!r.message&&r.title?r.message=r.title:!r.message&&!r.title&&(r.message="New notification"),r.type||(r.type="system"),r.createdAt||(r.createdAt=new Date().toISOString()),r.read===void 0&&(r.read=!1),r.time||(r.time="Just now"),r}addBundledNotification(t){var u,f,m,v,x;const r=this.sanitizeNotification(t);if(!r||!this.isValidNotification(r)){console.warn("Skipping invalid notification:",t);return}const i=new Date;new Date(r.createdAt);const c=((u=r.sender)==null?void 0:u._id)||((f=r.sender)==null?void 0:f.id)||((v=(m=r.data)==null?void 0:m.sender)==null?void 0:v._id);if(c){const A=this.notifications.findIndex(S=>{var M,U,D,ne;if((((M=S.sender)==null?void 0:M._id)||((U=S.sender)==null?void 0:U.id)||((ne=(D=S.data)==null?void 0:D.sender)==null?void 0:ne._id))!==c||S.type!==r.type)return!1;const C=new Date(S.createdAt);return i-C<this.bundleTimeframe});if(A!==-1){const S=this.notifications[A],j=S.count||1;return this.notifications[A]={...S,count:j+1,message:this._getBundledMessage(r.type,j+1,(x=S.sender)==null?void 0:x.nickname),updatedAt:i.toISOString(),read:!1},S.read&&this.unreadCount++,this.notifyListeners(),this._syncToOtherTabs("NEW_NOTIFICATION",this.notifications[A]),this.notifications[A]}}return r.count=1,this.notifications.unshift(r),r.read||this.unreadCount++,this.notifyListeners(),this._syncToOtherTabs("NEW_NOTIFICATION",r),window.dispatchEvent(new CustomEvent("newNotification",{detail:r})),console.log(`Added notification: ${r.type} - ${r.title||r.message}`),r}_syncToOtherTabs(t,r){if(this.notificationSyncChannel)try{this.notificationSyncChannel.postMessage({type:t,data:r})}catch(i){console.error("Error syncing to other tabs:",i)}}_getBundledMessage(t,r,i){switch(t){case"message":return`${r} new messages from ${i||"this user"}`;case"like":return`${i||"Someone"} and ${r-1} others liked you`;case"comment":return`${r} new comments on your post`;case"photoRequest":return`${r} photo access requests`;case"photoResponse":return`${r} responses to your photo requests`;case"story":return`${i||"Someone"} shared ${r} new stories`;default:return`${r} new notifications`}}showToast(t){console.log("Toast notifications have been disabled")}addNotification(t){return this.addBundledNotification(t)}handleNotificationClick(t){var r,i,c,u,f,m,v,x;if(t){if(console.log("Handling click for notification:",t),t.read||this.markAsRead(t._id||t.id),!this.navigate){console.warn("Cannot navigate - navigate function not set in NotificationService"),window.dispatchEvent(new CustomEvent("notificationClicked",{detail:t}));return}try{switch(t.type){case"message":const A=((r=t.sender)==null?void 0:r._id)||((c=(i=t.data)==null?void 0:i.sender)==null?void 0:c._id);A?this.navigate(`/messages/${A}`):this.navigate("/messages");break;case"like":case"match":const S=(u=t.sender)==null?void 0:u._id;S?this.navigate(`/user/${S}`):this.navigate("/matches");break;case"photoRequest":this.navigate("/settings?tab=privacy");break;case"photoResponse":const j=(f=t.sender)==null?void 0:f._id;j?this.navigate(`/user/${j}`):this.navigate("/dashboard");break;case"story":const C=((m=t.data)==null?void 0:m.storyId)||t._id;C?window.dispatchEvent(new CustomEvent("viewStory",{detail:{storyId:C}})):this.navigate("/dashboard");break;case"call":window.dispatchEvent(new CustomEvent("callNotificationClicked",{detail:t}));break;case"comment":const M=((v=t.data)==null?void 0:v.referenceId)||((x=t.data)==null?void 0:x.postId);M?this.navigate(`/post/${M}`):this.navigate("/dashboard");break;default:this.navigate("/dashboard")}document.querySelectorAll(".notification-dropdown").forEach(A=>{A instanceof HTMLElement&&(A.style.display="none")})}catch(A){console.error("Error during notification navigation:",A),this.navigate("/dashboard")}}}markAsRead(t,r=!0){if(!t)return;const i=this.notifications.findIndex(u=>u._id&&u._id===t||u.id&&u.id===t);if(i===-1||this.notifications[i].read)return;const c=[...this.notifications];c[i]={...c[i],read:!0},this.notifications=c,this.unreadCount=Math.max(0,this.unreadCount-1),this.notifyListeners(),r&&this._syncToOtherTabs("MARK_READ",{notificationId:t}),t&&/^[0-9a-fA-F]{24}$/.test(t)&&Pe.put("/notifications/read",{ids:[t]}).catch(u=>{console.warn(`Failed to mark notification ${t} as read on server:`,u),Pe.put(`/notifications/${t}/read`).catch(f=>console.warn(`Failed backend markAsRead for ${t}:`,f))})}markAllAsRead(t=!0){if(this.unreadCount===0)return;this.notifications=this.notifications.map(i=>({...i,read:!0})),this.unreadCount=0,this.notifyListeners(),t&&this._syncToOtherTabs("MARK_ALL_READ");const r=this.notifications.map(i=>i._id||i.id).filter(i=>i&&/^[0-9a-fA-F]{24}$/.test(i));r.length>0&&Pe.put("/notifications/read-all").catch(i=>{console.warn("Failed to mark all notifications as read on server:",i),Pe.put("/notifications/read",{ids:r}).catch(c=>console.warn("Failed backend markAllAsRead:",c))})}async getNotifications(t={}){return this.fetchQueue=this.fetchQueue.then(async()=>{if(this.isLoading)return console.log("Notifications already loading, request queued"),this.notifications;this.isLoading=!0;let r=!1;try{this.initialized||console.warn("Trying to fetch notifications before initialization"),console.log("Fetching notifications from server...");const i=await Pe.get("/notifications",t);if(this.lastFetch=Date.now(),i.success&&Array.isArray(i.data)){const c=i.data.map(f=>this.sanitizeNotification(f)).filter(f=>this.isValidNotification(f)),u=this._bundleServerNotifications(c);return this.notifications=u,this.unreadCount=u.filter(f=>!f.read).length,this.notifyListeners(),console.log(`Loaded ${u.length} notifications from server`),r=!0,this.notifications}return console.log("No notifications found or invalid response format"),this.notifications=[],this.unreadCount=0,this.notifyListeners(),[]}catch(i){return console.error("Error fetching notifications from API:",i),!r&&this.notifications.length===0&&(this.notifications=[],this.unreadCount=0,this.notifyListeners()),this.notifications}finally{this.isLoading=!1}}).catch(r=>(console.error("Unexpected error in notification fetch queue:",r),this.isLoading=!1,this.notifications)),this.fetchQueue}_bundleServerNotifications(t){const r={};t.forEach(c=>{var A,S,j,C;const u=((A=c.sender)==null?void 0:A._id)||((S=c.sender)==null?void 0:S.id)||((C=(j=c.data)==null?void 0:j.sender)==null?void 0:C._id);if(!u||!c.type)return;const f=`${u}:${c.type}`,m=new Date,v=new Date(c.createdAt);m-v<=this.bundleTimeframe&&(r[f]?r[f].push(c):r[f]=[c])});const i=[];return t.forEach(c=>{var f,m,v,x;(!(((f=c.sender)==null?void 0:f._id)||((m=c.sender)==null?void 0:m.id)||((x=(v=c.data)==null?void 0:v.sender)==null?void 0:x._id))||!c.type)&&i.push(c)}),Object.values(r).forEach(c=>{var u;if(c.length===1)i.push(c[0]);else{const f=c.sort((m,v)=>new Date(v.createdAt)-new Date(m.createdAt))[0];i.push({...f,count:c.length,message:this._getBundledMessage(f.type,c.length,(u=f.sender)==null?void 0:u.nickname)})}}),i.sort((c,u)=>new Date(u.createdAt)-new Date(c.createdAt))}updateSettings(t){console.log("Updating NotificationService settings:",t),console.log("Messages notification setting specifically:",t==null?void 0:t.messages,"typeof:",typeof(t==null?void 0:t.messages));const r={};t&&(r.messages=t.messages===!1?!1:!!t.messages,r.calls=t.calls===!1?!1:!!t.calls,r.stories=t.stories===!1?!1:!!t.stories,r.likes=t.likes===!1?!1:!!t.likes,r.comments=t.comments===!1?!1:!!t.comments,r.photoRequests=t.photoRequests===!1?!1:!!t.photoRequests),console.log("Normalized notification settings:",r),this.userSettings={...this.userSettings,notifications:r},jn(()=>Promise.resolve().then(()=>z3),void 0).then(i=>i.default.updateNotificationSettings(r)).then(()=>console.log("Notification settings saved to server")).catch(i=>console.error("Failed to save notification settings to server:",i)),this.notifyListeners(),console.log("Final state of notification settings:",this.userSettings.notifications)}addListener(t){return typeof t!="function"?()=>{}:(this.listeners.push(t),t({notifications:[...this.notifications],unreadCount:this.unreadCount}),()=>{this.listeners=this.listeners.filter(r=>r!==t)})}notifyListeners(){const t={notifications:[...this.notifications],unreadCount:this.unreadCount};this.listeners.forEach(r=>{try{r(t)}catch(i){console.error("Notify listener error:",i)}})}refreshNotifications(){return this.getNotifications({_t:Date.now()})}addTestNotification(){const t=[{type:"message",title:"Test Message",message:"Hello!"},{type:"like",title:"Test Like",message:"Someone liked you."},{type:"photoRequest",title:"Test Request",message:"Wants photo access."},{type:"photoResponse",title:"Test Response",message:"Request approved.",data:{status:"approved"}},{type:"comment",title:"Test Comment",message:"Someone commented on your post."}],r=t[Math.floor(Math.random()*t.length)],i={_id:`test-${Date.now()}`,...r,sender:{nickname:"Tester",_id:`testUser-${Date.now()}`},read:!1,createdAt:new Date().toISOString()};return this.addBundledNotification(i),this.createTestNotificationOnServer(i.type),i}async createTestNotificationOnServer(t="system"){try{const r=await Pe.post("/notifications/create-test",{type:t});r!=null&&r.success&&console.log("Created test notification on server:",r.data)}catch(r){console.warn("Failed to create test notification on server:",r)}}}const tn=new G4;function G0(){const s=mn();y.useEffect(()=>{tn.setNavigate(s),console.log("NotificationService navigation initialized via hook"),tn.initialized&&tn.checkSocketConnection();const t=()=>{console.log("Socket reconnected - reinitializing notification listeners"),tn.initialized&&tn.checkSocketConnection()};return window.addEventListener("socketReconnected",t),()=>{window.removeEventListener("socketReconnected",t)}},[s])}tn.globalCleanup=()=>{tn.cleanup()};const Fi=Object.freeze(Object.defineProperty({__proto__:null,default:tn,useInitializeNotificationServiceNavigation:G0},Symbol.toStringTag,{value:"Module"})),X0=y.createContext(),X4=({children:s})=>{const{isAuthenticated:t,user:r}=Ot(),[i,c]=y.useState([]),[u,f]=y.useState(0),[m,v]=y.useState(!1),[x,A]=y.useState(!1),S=mn(),j=y.useCallback(async()=>{try{v(!0),console.log("Fetching notifications from server");const B=await tn.getNotifications();return console.log(`Fetched ${B.length} notifications`),c(B),f(B.filter(L=>!L.read).length),B}catch(B){return console.error("Error fetching notifications:",B),[]}finally{v(!1)}},[]);y.useEffect(()=>{S&&(tn.setNavigate(S),console.log("NotificationService navigation initialized"))},[S]),y.useEffect(()=>{if(!t||!r)return;const B=E=>{if(console.log("New notification received via socket:",E),c(z=>{if(z.some(q=>q._id&&E._id&&q._id===E._id||q.id&&E.id&&q.id===E.id))return z;const H=[E,...z];return console.log("Updated notifications state with new notification"),H}),E.read||f(z=>z+1),E.createdAt&&new Date().getTime()-new Date(E.createdAt).getTime()<6e4){const z=E.message||E.content||E.title||"New notification";X.info(z,{onClick:()=>tn.handleNotificationClick(E)})}},L=()=>{console.log("Socket connected - enabling real-time notifications"),A(!0),j()},I=()=>{console.log("Socket disconnected - real-time notifications paused"),A(!1)};return Se.socket&&(console.log("Setting up direct socket listeners for notifications"),Se.socket.on("notification",B),Se.socket.on("newMessage",B),Se.socket.on("newLike",B),Se.socket.on("photoPermissionRequestReceived",B),Se.socket.on("photoPermissionResponseReceived",B),Se.socket.on("newComment",B),Se.socket.on("incomingCall",B),Se.socket.on("connect",L),Se.socket.on("disconnect",I),A(Se.isConnected())),()=>{Se.socket&&(Se.socket.off("notification",B),Se.socket.off("newMessage",B),Se.socket.off("newLike",B),Se.socket.off("photoPermissionRequestReceived",B),Se.socket.off("photoPermissionResponseReceived",B),Se.socket.off("newComment",B),Se.socket.off("incomingCall",B),Se.socket.off("connect",L),Se.socket.off("disconnect",I))}},[t,r,j]),y.useEffect(()=>{let B=null;return(async()=>{if(t&&r){v(!0),console.log("Initializing notification service");const I=r.settings||{notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0,photoRequests:!0}};tn.initialize(I),B=tn.addListener(E=>{E&&E.notifications&&(c(E.notifications),f(E.unreadCount),console.log("Notifications updated through service listener"))}),await j(),tn.initialized&&tn.registerSocketListeners()}else c([]),f(0)})(),()=>{B&&B()}},[t,r,j]),y.useEffect(()=>{if(!t||!r)return;const B=3e4;if(!x){console.log("Socket disconnected, setting up polling for notifications");const L=setInterval(async()=>{console.log("Polling for new notifications"),await j()},B);return()=>clearInterval(L)}},[t,r,x,j]);const C=()=>{const B=tn.addTestNotification();c(L=>[B,...L]),f(L=>L+1),X.info(`Added test ${B.type} notification`)},M=B=>{tn.markAsRead(B),c(L=>L.map(I=>I._id&&I._id===B||I.id&&I.id===B?{...I,read:!0}:I)),f(L=>Math.max(0,L-1))},U=()=>{tn.markAllAsRead(),c(B=>B.map(L=>({...L,read:!0}))),f(0)},D=B=>{if(B&&!B.read){const L=B._id||B.id;L&&M(L)}tn.handleNotificationClick(B)},ne=async()=>{await j()},K=B=>{c(L=>[B,...L]),f(L=>L+1)},te=y.useCallback(B=>{var I,E;if(!B)return;console.log("Received like notification:",B);const L={_id:B._id||`like-${Date.now()}`,type:B.isMatch?"match":"like",title:B.isMatch?`You have a match with ${((I=B.sender)==null?void 0:I.nickname)||"Someone"}!`:`${((E=B.sender)==null?void 0:E.nickname)||"Someone"} liked you`,message:B.isMatch?"You both liked each other. Start a conversation now!":"Someone has shown interest in your profile",sender:B.sender,createdAt:B.timestamp||new Date().toISOString(),read:!1};K(L),X.success(o.jsxs("div",{className:"notification-toast",children:[o.jsx("div",{className:"notification-icon",children:o.jsx(Xs,{className:B.isMatch?"match-icon pulse":"like-icon pulse"})}),o.jsxs("div",{className:"notification-content",children:[o.jsx("div",{className:"notification-title",children:L.title}),o.jsx("div",{className:"notification-message",children:L.message})]})]}),{autoClose:5e3})},[K]);return y.useEffect(()=>{if(!(!Se.socket||!t))return Se.socket.on("newLike",te),()=>{Se.socket&&Se.socket.off("newLike",te)}},[Se.socket,t,te]),o.jsx(X0.Provider,{value:{notifications:i,unreadCount:u,isLoading:m,socketConnected:x,addTestNotification:C,markAsRead:M,markAllAsRead:U,handleNotificationClick:D,refreshNotifications:ne},children:s})},Q0=()=>{const s=y.useContext(X0);if(s===void 0)throw new Error("useNotifications must be used within a NotificationProvider");return s},ln=Rt.create("ChatConnectionContext"),Q4=y.createContext(),K4=({children:s})=>{const{user:t,isAuthenticated:r,token:i}=Ot(),[c,u]=y.useState(Se.isConnected()),[f,m]=y.useState(!1),[v,x]=y.useState(0),[A,S]=y.useState(null);y.useEffect(()=>{let M=!0;return(async()=>{r&&(t!=null&&t._id)&&i?(await new Promise(D=>setTimeout(D,500)),M&&(ln.debug("User authenticated, initializing socket"),j())):r||(u(!1),m(!1),S(null))})(),()=>{M=!1;try{Se.isConnected()&&(ln.debug("Disconnecting socket on cleanup"),Se.disconnect())}catch(D){console.error("Error during socket cleanup:",D)}}},[r,t,i]);const j=()=>{if(!r){ln.warn("Cannot initialize socket: Not authenticated");return}if(!t){ln.warn("Cannot initialize socket: No user object available");{S("User data is missing. Please refresh the page or log in again.");return}}const M=t==null?void 0:t._id;if(!M){ln.warn("Cannot initialize socket: No user ID available");{S("User ID is missing. Please refresh the page or log in again.");return}}const U=M&&/^[0-9a-fA-F]{24}$/.test(M)?M:null;if(!U){ln.error(`Cannot initialize socket: Invalid user ID format: ${M}`),S("Invalid user ID format. Please try logging out and in again.");return}if(Se.isConnected()){ln.debug("Socket already connected"),u(!0),m(!1);return}const D=i||localStorage.getItem("token")||sessionStorage.getItem("token");if(!D){ln.error("Cannot initialize socket: No auth token available"),S("Authentication token missing. Please log in again.");return}ln.debug(`Initializing socket for user ${U}`),m(!0);try{Se.init(U,D);const ne=()=>{ln.info("Socket connected successfully"),u(!0),m(!1),S(null),x(0)},K=E=>{ln.warn(`Socket disconnected: ${E}`),u(!1),E==="io server disconnect"?(m(!1),S("The server disconnected your session. Please refresh the page.")):E==="transport close"||E==="transport error"?ln.info("Network disconnect - will attempt reconnection"):m(!1)},te=E=>{const T=(E==null?void 0:E.message)||"Unknown error";ln.error(`Socket error: ${T}`),S(`Connection error: ${T}`),m(!1)},B=E=>{var W,H;const T=(E==null?void 0:E.message)||"Unknown error";ln.error(`Socket connection error: ${T}`),m(!1);const z=v+1;x(z),((W=E==null?void 0:E.message)!=null&&W.includes("auth")||(H=E==null?void 0:E.message)!=null&&H.includes("token"))&&z>2?S("Authentication failed. Please try refreshing the page or log out and log in again."):z>3?S(`Connection error: ${T}`):ln.info(`Connection attempt ${z} failed, will retry`)},L=[Se.on("connect",ne),Se.on("disconnect",K),Se.on("error",te),Se.on("connect_error",B)],I=setInterval(()=>{!Se.isConnected()&&r&&(t!=null&&t._id)&&v<5&&(ln.debug(`Auto reconnect attempt ${v+1}`),x(T=>T+1),Se.reconnect())},3e4);return()=>{L.forEach(E=>E()),clearInterval(I)}}catch(ne){ln.error(`Error initializing socket: ${ne.message}`),m(!1),S(`Failed to connect: ${ne.message}`)}};y.useEffect(()=>{const M=()=>{!document.hidden&&r&&(t!=null&&t._id)&&!Se.isConnected()&&!f&&(ln.debug("Page became visible, reconnecting socket"),Se.reconnect())};return document.addEventListener("visibilitychange",M),()=>{document.removeEventListener("visibilitychange",M)}},[r,t,f]);const C={connected:c,connecting:f,error:A,reconnectAttempts:v,initializeSocket:j};return o.jsx(Q4.Provider,{value:C,children:s})};class Hf extends y.Component{constructor(t){super(t),this.state={hasError:!1,errorMessage:"",errorStack:""}}static getDerivedStateFromError(t){return{hasError:!0,errorMessage:t.message||"An unknown error occurred"}}componentDidCatch(t,r){const i=t.message||"An unknown error occurred",c=t.stack||r.componentStack||"";console.error("ErrorBoundary caught an error",i,c),this.setState({errorMessage:i,errorStack:c})}render(){return this.state.hasError?o.jsxs("div",{className:"error-boundary",children:[o.jsx("h1",{children:"Something went wrong"}),o.jsx("p",{children:"We're sorry, but an error occurred. Please try refreshing the page."}),o.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Refresh Page"}),!1]}):this.props.children}}const Vr=({children:s})=>{const{user:t,isAuthenticated:r,loading:i,error:c}=Ot(),u=_f(),[f,m]=y.useState(!1);return y.useEffect(()=>{if(c){m(!0);const v=setTimeout(()=>{m(!1)},3e3);return()=>clearTimeout(v)}},[c]),i?o.jsxs("div",{className:"loading-container",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{className:"loading-text",children:"Loading..."})]}):f?o.jsx("div",{className:"auth-error",children:o.jsxs("div",{className:"auth-error-content",children:[o.jsx(Ut,{className:"auth-error-icon"}),o.jsx("h3",{children:"Authentication Error"}),o.jsx("p",{children:c||"Authentication failed"})]})}):!r||!t?o.jsx(tb,{to:"/login",state:{from:u.pathname},replace:!0}):s},Z4=()=>{var L;const[s,t]=y.useState({email:"",password:""}),[r,i]=y.useState(!1),[c,u]=y.useState(!1),[f,m]=y.useState({}),[v,x]=y.useState(!1),{login:A,error:S,clearError:j,isAuthenticated:C}=Ot(),M=mn(),U=_f(),D=((L=U.state)==null?void 0:L.from)||"/dashboard";y.useEffect(()=>{C&&M(D)},[C,M,D]),y.useEffect(()=>{var I;(I=U.state)!=null&&I.email&&t(E=>({...E,email:U.state.email})),j()},[]),y.useEffect(()=>{S&&(m({general:S}),x(!1))},[S]);const ne=()=>{const I={},E=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return s.email?E.test(s.email)||(I.email="Invalid email format"):I.email="Email is required",s.password?s.password.length<6&&(I.password="Password must be at least 6 characters"):I.password="Password is required",I},K=I=>{const{name:E,value:T}=I.target;t({...s,[E]:T}),f[E]&&m({...f,[E]:""})},te=async I=>{I.preventDefault();const E=ne();if(Object.keys(E).length>0){m(E);return}m({}),x(!0);try{await A({email:s.email,password:s.password})}catch(T){console.error("Login error",T)}},B=()=>{i(!r)};return o.jsx("div",{className:"auth-page login-page d-flex",children:o.jsx("div",{className:"auth-container d-flex flex-column justify-content-center w-100",children:o.jsx("div",{className:"container",style:{maxWidth:"500px"},children:o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"card-header text-center",children:[o.jsx(nn,{to:"/",className:"logo",children:"Mandarin"}),o.jsx("h2",{className:"mb-1",children:"Welcome Back"}),o.jsx("p",{className:"text-light",children:"Sign in to continue your journey"})]}),o.jsxs("div",{className:"card-body",children:[f.general&&o.jsx("div",{className:"alert alert-danger",children:o.jsx("p",{children:f.general})}),o.jsxs("form",{onSubmit:te,children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(If,{className:"field-icon"}),o.jsx("input",{type:"email",id:"email",name:"email",className:"form-control",placeholder:"Enter your email",value:s.email,onChange:K,disabled:v,autoComplete:"email"})]}),f.email&&o.jsx("p",{className:"error-message",children:f.email})]}),o.jsxs("div",{className:"form-group",children:[o.jsxs("div",{className:"d-flex justify-content-between",children:[o.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),o.jsx(nn,{to:"/forgot-password",className:"text-primary",style:{fontSize:"0.875rem"},children:"Forgot Password?"})]}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(Jn,{className:"field-icon"}),o.jsx("input",{type:r?"text":"password",id:"password",name:"password",className:"form-control",placeholder:"Enter your password",value:s.password,onChange:K,disabled:v,autoComplete:"current-password"}),o.jsx("button",{type:"button",className:"toggle-password",onClick:B,tabIndex:-1,children:r?o.jsx(D0,{}):o.jsx(fc,{})})]}),f.password&&o.jsx("p",{className:"error-message",children:f.password})]}),o.jsx("div",{className:"form-group d-flex align-items-center",children:o.jsxs("label",{className:"checkbox-label d-flex align-items-center",children:[o.jsx("input",{type:"checkbox",checked:c,onChange:()=>u(!c),disabled:v}),o.jsx("span",{style:{marginLeft:"8px"},children:"Remember me"})]})}),o.jsx("button",{type:"submit",className:`btn btn-primary w-100 ${v?"loading":""}`,disabled:v,children:v?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"spinner spinner-dark"}),o.jsx("span",{style:{marginLeft:"8px"},children:"Signing in..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Sign In"}),o.jsx(Zl,{})]})})]}),o.jsx("div",{className:"auth-separator text-center mt-4 mb-2",children:o.jsx("span",{children:"OR"})}),o.jsxs("div",{className:"d-flex flex-column gap-2",children:[o.jsxs("button",{className:"btn btn-outline d-flex align-items-center justify-content-center",children:[o.jsx(N0,{style:{marginRight:"8px"}}),"Sign in with Google"]}),o.jsxs("button",{className:"btn btn-outline d-flex align-items-center justify-content-center",children:[o.jsx(E0,{style:{marginRight:"8px"}}),"Sign in with Facebook"]})]}),o.jsx("div",{className:"auth-footer text-center mt-4",children:o.jsxs("p",{className:"mb-0",children:["Don't have an account?"," ",o.jsx(nn,{to:"/register",className:"text-primary",children:"Sign Up"})]})})]})]})})})})},J4=()=>{var ye;const[s,t]=y.useState(1),[r,i]=y.useState({nickname:"",email:"",password:"",confirmPassword:"",dateOfBirth:"",location:"",interests:[],lookingFor:[],agreeTerms:!1,agreePrivacy:!1,newsletter:!1,iAm:"",intoTags:[],turnOns:[],maritalStatus:""}),[c,u]=y.useState(!1),[f,m]=y.useState({}),[v,x]=y.useState(!1),[A,S]=y.useState(!1),[j,C]=y.useState({}),[M,U]=y.useState([]),{register:D,error:ne,isAuthenticated:K}=Ot(),te=mn(),B=_f(),L=["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art","Reading","Gaming","Photography","Dancing","Cooking","Sports"],I=["woman","man","couple"],E=["women","men","couples"],T=["Meetups","Power play","Threesomes","Online fun","Hot chat","Photo sharing","Camera chat","Cuckold","Golden showers","Strap-on","Forced bi","Erotic domination","Humiliation","Crossdressing","Worship","Foot fetish","Oral","From behind","Role-play","Toys","Massages","Foreplay","Casual meetups","Fantasy fulfillment","Bizarre","Education","Experiences","Tantra"],z=["Sexy ass","Dirty talk","Aggressive","Slow and gentle","In a public place","Pampering","Sexy clothing","Leather/latex clothing","Watching porn","Fit body","Bathing together","Erotic writing","Eye contact","Being pampered","Sexy legs","Teasing","Pushing boundaries"],W=["Single","Married","Divorced","Separated","Widowed","In a relationship","It's complicated","Open relationship","Polyamorous"],H=["Tel Aviv, Israel","Jerusalem, Israel","Haifa, Israel","Eilat, Israel","Beer Sheva, Israel","Netanya, Israel","Herzliya, Israel","Ashdod, Israel","Ashkelon, Israel","Tiberias, Israel","Ramat Gan, Israel","Rishon LeZion, Israel","Petah Tikva, Israel","Holon, Israel","Bat Yam, Israel","Rehovot, Israel","Kfar Saba, Israel","Raanana, Israel","Nahariya, Israel","Acre, Israel"],q=G=>{if(!G)return 0;const oe=new Date(G),be=new Date;let Ne=be.getFullYear()-oe.getFullYear();const _e=be.getMonth()-oe.getMonth();return(_e<0||_e===0&&be.getDate()<oe.getDate())&&Ne--,Ne};y.useEffect(()=>{var G;return K&&te("/dashboard"),(G=B.state)!=null&&G.email&&i(oe=>({...oe,email:B.state.email})),()=>{i({nickname:"",email:"",password:"",confirmPassword:"",dateOfBirth:"",location:"",interests:[],lookingFor:[],agreeTerms:!1,agreePrivacy:!1,newsletter:!1,iAm:"",intoTags:[],turnOns:[],maritalStatus:""})}},[K,te,(ye=B.state)==null?void 0:ye.email]),y.useEffect(()=>{if(ne){m(oe=>({...oe,general:ne})),x(!1);const G=document.querySelector(".alert-danger");G&&G.scrollIntoView({behavior:"smooth",block:"start"})}},[ne]);const re=y.useCallback(G=>{const oe={};if(G===1){const be=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;r.nickname.trim()?r.nickname.length<3?oe.nickname="Nickname must be at least 3 characters":r.nickname.length>50?oe.nickname="Nickname cannot exceed 50 characters":/^[a-zA-Z0-9_]+$/.test(r.nickname)||(oe.nickname="Nickname can only contain letters, numbers, and underscores"):oe.nickname="Nickname is required",r.email?be.test(r.email.toLowerCase())||(oe.email="Please enter a valid email address"):oe.email="Email is required",r.password?r.password.length<8?oe.password="Password must be at least 8 characters":/(?=.*[a-z])/.test(r.password)?/(?=.*[A-Z])/.test(r.password)?/(?=.*\d)/.test(r.password)?/(?=.*[@$!%*?&])/.test(r.password)||(oe.password="Password must include at least one special character (@$!%*?&)"):oe.password="Password must include at least one number":oe.password="Password must include at least one uppercase letter":oe.password="Password must include at least one lowercase letter":oe.password="Password is required",r.password!==r.confirmPassword&&(oe.confirmPassword="Passwords do not match")}if(G===2){if(!r.dateOfBirth)oe.dateOfBirth="Date of birth is required";else{const be=q(r.dateOfBirth);be<18?oe.dateOfBirth="You must be at least 18 years old":be>120&&(oe.dateOfBirth="Please enter a valid date of birth")}r.iAm||(oe.iAm="Please select who you are"),r.location.trim()?r.location.length<2?oe.location="Location must be at least 2 characters":r.location.length>100&&(oe.location="Location cannot exceed 100 characters"):oe.location="Location is required"}return G===3&&(r.maritalStatus||(oe.maritalStatus="Please select your marital status"),r.lookingFor.length===0?oe.lookingFor="Please select what you're looking for":r.lookingFor.length>3&&(oe.lookingFor="Please select no more than 3 options"),r.intoTags.length>20&&(oe.intoTags="Please select no more than 20 'I'm into' tags"),r.turnOns.length>20&&(oe.turnOns="Please select no more than 20 'Turn ons' tags"),r.interests.length===0?oe.interests="Please select at least one interest":r.interests.length>10&&(oe.interests="Please select no more than 10 interests"),r.agreeTerms||(oe.agreeTerms="You must agree to the Terms of Service"),r.agreePrivacy||(oe.agreePrivacy="You must agree to the Privacy Policy")),oe},[r]),pe=G=>{const{name:oe,value:be,type:Ne,checked:_e}=G.target;Ne==="checkbox"?i({...r,[oe]:_e}):Ne==="number"?(be===""||!isNaN(Number.parseInt(be)))&&i({...r,[oe]:be}):i({...r,[oe]:be}),f[oe]&&m({...f,[oe]:""})},ce=G=>{const oe=G.target.value;if(i({...r,location:oe}),f.location&&m({...f,location:""}),oe.length>1){const be=H.filter(Ne=>Ne.toLowerCase().includes(oe.toLowerCase()));U(be)}else U([])},R=()=>{S(!0);const G=re(s);if(Object.keys(G).length>0){m(G);const oe=document.querySelector(".error-message");oe&&oe.scrollIntoView({behavior:"smooth",block:"start"});return}m({}),t(s+1),S(!1),window.scrollTo({top:0,behavior:"smooth"})},Q=()=>{t(s-1),m({}),S(!1),window.scrollTo({top:0,behavior:"smooth"})},Y=G=>{let oe;r.interests.includes(G)?oe=r.interests.filter(be=>be!==G):oe=[...r.interests,G],i({...r,interests:oe}),f.interests&&oe.length>0&&m({...f,interests:""})},P=G=>{let oe;r.lookingFor.includes(G)?oe=r.lookingFor.filter(be=>be!==G):oe=[...r.lookingFor,G],i({...r,lookingFor:oe}),f.lookingFor&&oe.length>0&&m({...f,lookingFor:""})},ie=G=>{i({...r,iAm:r.iAm===G?"":G}),f.iAm&&G&&m({...f,iAm:""})},J=G=>{let oe;if(r.intoTags.includes(G))oe=r.intoTags.filter(be=>be!==G);else{if(r.intoTags.length>=20){X.warning("You can select up to 20 'I'm into' tags");return}oe=[...r.intoTags,G]}i({...r,intoTags:oe}),f.intoTags&&oe.length>0&&m({...f,intoTags:""})},ze=G=>{let oe;if(r.turnOns.includes(G))oe=r.turnOns.filter(be=>be!==G);else{if(r.turnOns.length>=20){X.warning("You can select up to 20 'Turn ons' tags");return}oe=[...r.turnOns,G]}i({...r,turnOns:oe}),f.turnOns&&oe.length>0&&m({...f,turnOns:""})},de=G=>{i({...r,maritalStatus:G.target.value}),f.maritalStatus&&m({...f,maritalStatus:""})},Z=y.useCallback(()=>({}),[r]),Te=async G=>{G==null||G.preventDefault();const oe=Z();if(Object.keys(oe).length>0){C(oe);const be=document.querySelector(".error-message");be&&be.scrollIntoView({behavior:"smooth",block:"center"});return}C({}),x(!0);try{let be="";r.iAm.toLowerCase()==="woman"?be="female":r.iAm.toLowerCase()==="man"?be="male":r.iAm.toLowerCase()==="couple"&&(be="other");let Ne="FREE";const _e=r.iAm.toLowerCase()==="couple";r.iAm.toLowerCase()==="woman"?Ne="FEMALE":_e&&(Ne="COUPLE");const Ge={nickname:r.nickname.trim(),email:r.email.trim().toLowerCase(),password:r.password,accountTier:Ne,isCouple:_e,details:{age:q(r.dateOfBirth),gender:be,location:r.location.trim(),bio:"",interests:r.interests,iAm:r.iAm,lookingFor:r.lookingFor,intoTags:r.intoTags,turnOns:r.turnOns,maritalStatus:r.maritalStatus,dateOfBirth:r.dateOfBirth}};try{await D(Ge)&&(X.success("Welcome to Mandarin! Your account has been created successfully."),te("/dashboard"))}catch(bt){if(bt.message==="User already exists"){m({email:"This email is already registered. Please log in or use a different email.",general:"An account with this email already exists. Would you like to log in instead?"});const ut=document.querySelector(".error-message");ut&&ut.scrollIntoView({behavior:"smooth",block:"start"})}else m(ut=>({...ut,general:bt.message||"An unexpected error occurred. Please try again."}))}}catch(be){console.error("Registration error",be),x(!1),f.general||m(Ne=>({...Ne,general:"An unexpected error occurred. Please try again."}))}finally{x(!1)}},je=()=>{u(!c)},Fe=()=>o.jsx("div",{className:"registration-progress",children:o.jsxs("div",{className:"progress-steps d-flex justify-content-center align-items-center",children:[o.jsxs("div",{className:`progress-step ${s>=1?"active":""}`,children:[o.jsx("div",{className:"step-circle",children:s>1?o.jsx(pt,{}):1}),o.jsx("span",{className:"step-label",children:"Account"})]}),o.jsx("div",{className:"progress-line"}),o.jsxs("div",{className:`progress-step ${s>=2?"active":""}`,children:[o.jsx("div",{className:"step-circle",children:s>2?o.jsx(pt,{}):2}),o.jsx("span",{className:"step-label",children:"Profile"})]}),o.jsx("div",{className:"progress-line"}),o.jsxs("div",{className:`progress-step ${s>=3?"active":""}`,children:[o.jsx("div",{className:"step-circle",children:s>3?o.jsx(pt,{}):3}),o.jsx("span",{className:"step-label",children:"Preferences"})]})]})}),Me=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"step-header text-center",children:[o.jsx("h3",{children:"Create Your Account"}),o.jsx("p",{className:"text-light",children:"Enter your basic information"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"nickname",children:"Nickname"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(Pl,{className:"field-icon"}),o.jsx("input",{type:"text",id:"nickname",name:"nickname",placeholder:"Choose a nickname",className:`form-control ${f.nickname?"border-danger":""}`,value:r.nickname,onChange:pe,maxLength:50,"aria-describedby":"nickname-help"})]}),f.nickname?o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.nickname]}):o.jsx("small",{id:"nickname-help",className:"form-text text-muted",children:"Your public display name (can contain letters, numbers, and underscores)"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"email",children:"Email Address"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(If,{className:"field-icon"}),o.jsx("input",{type:"email",id:"email",name:"email",placeholder:"Enter your email",className:`form-control ${f.email?"border-danger":""}`,value:r.email,onChange:pe,"aria-describedby":"email-help"})]}),f.email?o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.email]}):o.jsx("small",{id:"email-help",className:"form-text text-muted",children:"We'll never share your email with anyone else"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(Jn,{className:"field-icon"}),o.jsx("input",{type:c?"text":"password",id:"password",name:"password",placeholder:"Create a password",className:`form-control ${f.password?"border-danger":""}`,value:r.password,onChange:pe,"aria-describedby":"password-help"}),o.jsx("button",{type:"button",className:"toggle-password",onClick:je,tabIndex:-1,"aria-label":c?"Hide password":"Show password",children:c?o.jsx(D0,{}):o.jsx(fc,{})})]}),f.password?o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.password]}):o.jsx("small",{id:"password-help",className:"form-text text-muted",children:"Must be at least 8 characters with uppercase, lowercase, number, and special character"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"confirmPassword",children:"Confirm Password"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(Jn,{className:"field-icon"}),o.jsx("input",{type:c?"text":"password",id:"confirmPassword",name:"confirmPassword",placeholder:"Confirm password",className:`form-control ${f.confirmPassword?"border-danger":""}`,value:r.confirmPassword,onChange:pe})]}),f.confirmPassword&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.confirmPassword]})]}),o.jsx("div",{className:"form-actions d-flex justify-content-end mt-3",children:o.jsxs("button",{type:"button",className:"btn btn-primary",onClick:R,disabled:v,children:["Continue ",o.jsx(Zl,{})]})})]}),Ue=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"step-header text-center",children:[o.jsx("h3",{children:"Tell Us About Yourself"}),o.jsx("p",{className:"text-light",children:"Add some basic profile details"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"dateOfBirth",children:"Date of Birth"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(qf,{className:"field-icon"}),o.jsx("input",{type:"date",id:"dateOfBirth",name:"dateOfBirth",className:`form-control ${f.dateOfBirth?"border-danger":""}`,value:r.dateOfBirth,onChange:pe,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],"aria-describedby":"dob-help"})]}),f.dateOfBirth?o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.dateOfBirth]}):o.jsx("small",{id:"dob-help",className:"form-text text-muted",children:"You must be at least 18 years old to use this service"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"I am a"}),o.jsx("div",{className:"d-flex gap-2 flex-wrap",children:I.map(G=>o.jsxs("button",{type:"button",className:`interest-tag ${r.iAm===G?"selected":""} ${f.iAm&&A?"error-border":""}`,onClick:()=>ie(G),children:[G.charAt(0).toUpperCase()+G.slice(1),r.iAm===G&&o.jsx(pt,{className:"tag-check"})]},G))}),f.iAm&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.iAm]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"location",children:"Location"}),o.jsxs("div",{className:"input-with-icon",children:[o.jsx(uo,{className:"field-icon"}),o.jsx("input",{type:"text",id:"location",name:"location",placeholder:"City, Country",className:`form-control ${f.location?"border-danger":""}`,value:r.location,onChange:ce,maxLength:100,"aria-describedby":"location-help",list:"location-suggestions"}),o.jsx("datalist",{id:"location-suggestions",children:H.map((G,oe)=>o.jsx("option",{value:G},oe))})]}),f.location?o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.location]}):o.jsx("small",{id:"location-help",className:"form-text text-muted",children:"Your general location (e.g., Tel Aviv, Israel)"})]}),o.jsxs("div",{className:"form-actions d-flex justify-content-between mt-3",children:[o.jsxs("button",{type:"button",className:"btn btn-outline",onClick:Q,children:[o.jsx(sf,{})," Back"]}),o.jsxs("button",{type:"button",className:"btn btn-primary",onClick:R,disabled:v,children:["Continue ",o.jsx(Zl,{})]})]})]}),Le=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"step-header text-center",children:[o.jsx("h3",{children:"Your Preferences"}),o.jsx("p",{className:"text-light",children:"Tell us about yourself and what you're looking for"})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Marital Status"}),o.jsxs("select",{className:`form-control ${f.maritalStatus?"border-danger":""}`,name:"maritalStatus",value:r.maritalStatus,onChange:de,children:[o.jsx("option",{value:"",children:"Select your status"}),W.map(G=>o.jsx("option",{value:G,children:G},G))]}),f.maritalStatus&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.maritalStatus]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Looking For"}),o.jsx("small",{className:"d-block text-muted mb-2",children:"Select up to 3 options"}),o.jsx("div",{className:"d-flex gap-2 flex-wrap",children:E.map(G=>o.jsxs("button",{type:"button",className:`interest-tag ${r.lookingFor.includes(G)?"selected":""} ${f.lookingFor&&A?"error-border":""}`,onClick:()=>P(G),disabled:!r.lookingFor.includes(G)&&r.lookingFor.length>=3,children:[G.charAt(0).toUpperCase()+G.slice(1),r.lookingFor.includes(G)&&o.jsx(pt,{className:"tag-check"})]},G))}),f.lookingFor&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.lookingFor]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"Interests"}),o.jsx("small",{className:"d-block text-muted mb-2",children:"Select up to 10 interests"}),o.jsx("div",{className:"interests-grid",children:L.map(G=>o.jsxs("button",{type:"button",className:`interest-tag ${r.interests.includes(G)?"selected":""} ${f.interests&&A?"error-border":""}`,onClick:()=>Y(G),disabled:!r.interests.includes(G)&&r.interests.length>=10,children:[G,r.interests.includes(G)&&o.jsx(pt,{className:"tag-check"})]},G))}),f.interests&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.interests]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"I'm into"}),o.jsx("small",{className:"d-block text-muted mb-2",children:"Select up to 20 tags"}),o.jsx("div",{className:"interests-grid",children:T.map(G=>o.jsxs("button",{type:"button",className:`interest-tag ${r.intoTags.includes(G)?"selected":""} ${f.intoTags&&A?"error-border":""}`,onClick:()=>J(G),disabled:!r.intoTags.includes(G)&&r.intoTags.length>=20,children:[G,r.intoTags.includes(G)&&o.jsx(pt,{className:"tag-check"})]},G))}),f.intoTags&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.intoTags]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"It turns me on"}),o.jsx("small",{className:"d-block text-muted mb-2",children:"Select up to 20 tags"}),o.jsx("div",{className:"interests-grid",children:z.map(G=>o.jsxs("button",{type:"button",className:`interest-tag ${r.turnOns.includes(G)?"selected":""} ${f.turnOns&&A?"error-border":""}`,onClick:()=>ze(G),disabled:!r.turnOns.includes(G)&&r.turnOns.length>=20,children:[G,r.turnOns.includes(G)&&o.jsx(pt,{className:"tag-check"})]},G))}),f.turnOns&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.turnOns]})]}),o.jsxs("div",{className:"form-group checkbox-group mt-3",children:[o.jsxs("label",{className:`checkbox-label ${f.agreeTerms?"error":""}`,children:[o.jsx("input",{type:"checkbox",name:"agreeTerms",checked:r.agreeTerms,onChange:pe}),o.jsxs("span",{style:{marginLeft:"8px"},children:["I agree to the"," ",o.jsx(nn,{to:"/terms",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})]})]}),f.agreeTerms&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.agreeTerms]})]}),o.jsxs("div",{className:"form-group checkbox-group",children:[o.jsxs("label",{className:`checkbox-label ${f.agreePrivacy?"error":""}`,children:[o.jsx("input",{type:"checkbox",name:"agreePrivacy",checked:r.agreePrivacy,onChange:pe}),o.jsxs("span",{style:{marginLeft:"8px"},children:["I agree to the"," ",o.jsx(nn,{to:"/privacy",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]}),f.agreePrivacy&&o.jsxs("p",{className:"error-message text-danger",children:[o.jsx(Ut,{className:"me-1"}),f.agreePrivacy]})]}),o.jsx("div",{className:"form-group checkbox-group",children:o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",name:"newsletter",checked:r.newsletter,onChange:pe}),o.jsx("span",{style:{marginLeft:"8px"},children:"I want to receive news and special offers (optional)"})]})}),o.jsxs("div",{className:"form-actions d-flex justify-content-between mt-3",children:[o.jsxs("button",{type:"button",className:"btn btn-outline",onClick:Q,disabled:v,children:[o.jsx(sf,{})," Back"]}),o.jsx("button",{type:"submit",className:`btn btn-primary ${v?"loading":""}`,disabled:v,children:v?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"spinner spinner-dark"}),o.jsx("span",{style:{marginLeft:"8px"},children:"Creating account..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"Create Account"})," ",o.jsx(pt,{})]})})]})]}),he=()=>{switch(s){case 1:return Me();case 2:return Ue();case 3:return Le();default:return null}};return o.jsx("div",{className:"auth-page register-page d-flex",children:o.jsx("div",{className:"auth-container d-flex flex-column justify-content-center w-100",children:o.jsx("div",{className:"container",style:{maxWidth:"600px"},children:o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"card-header text-center",children:[o.jsx(nn,{to:"/",className:"logo",children:"Mandarin"}),o.jsx("h2",{className:"mb-1",children:"Join Mandarin"}),o.jsx("p",{className:"text-light",children:"Create your account in a few steps"})]}),o.jsxs("div",{className:"card-body",children:[f.general&&o.jsxs("div",{className:"alert alert-danger",role:"alert",children:[o.jsx(Ut,{className:"me-2"}),o.jsx("p",{className:"mb-0",children:f.general})]}),Fe(),o.jsx("form",{className:"mt-4",onSubmit:Te,noValidate:!0,children:he()}),s===1&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"auth-separator text-center mt-4 mb-2",children:o.jsx("span",{children:"OR SIGN UP WITH"})}),o.jsxs("div",{className:"d-flex flex-column gap-2",children:[o.jsxs("button",{className:"btn btn-outline d-flex align-items-center justify-content-center",children:[o.jsx(N0,{style:{marginRight:"8px"}}),"Sign up with Google"]}),o.jsxs("button",{className:"btn btn-outline d-flex align-items-center justify-content-center",children:[o.jsx(E0,{style:{marginRight:"8px"}}),"Sign up with Facebook"]})]})]}),o.jsx("div",{className:"auth-footer text-center mt-4",children:o.jsxs("p",{className:"mb-0",children:["Already have an account?"," ",o.jsx(nn,{to:"/login",className:"text-primary",children:"Sign In"})]})})]})]})})})})};class W4{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(t){this.flush(),this._parts.push(t)}append(t){this._pieces.push(t)}flush(){if(this._pieces.length>0){const t=new Uint8Array(this._pieces);this._parts.push(t),this._pieces=[]}}toArrayBuffer(){const t=[];for(const r of this._parts)t.push(r);return e3(t).buffer}}function e3(s){let t=0;for(const c of s)t+=c.byteLength;const r=new Uint8Array(t);let i=0;for(const c of s){const u=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);r.set(u,i),i+=c.byteLength}return r}function K0(s){return new t3(s).unpack()}function Z0(s){const t=new n3,r=t.pack(s);return r instanceof Promise?r.then(()=>t.getBuffer()):t.getBuffer()}class t3{constructor(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const t=this.unpack_uint8();if(t<128)return t;if((t^224)<32)return(t^224)-32;let r;if((r=t^160)<=15)return this.unpack_raw(r);if((r=t^176)<=15)return this.unpack_string(r);if((r=t^144)<=15)return this.unpack_array(r);if((r=t^128)<=15)return this.unpack_map(r);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return r=this.unpack_uint16(),this.unpack_string(r);case 217:return r=this.unpack_uint32(),this.unpack_string(r);case 218:return r=this.unpack_uint16(),this.unpack_raw(r);case 219:return r=this.unpack_uint32(),this.unpack_raw(r);case 220:return r=this.unpack_uint16(),this.unpack_array(r);case 221:return r=this.unpack_uint32(),this.unpack_array(r);case 222:return r=this.unpack_uint16(),this.unpack_map(r);case 223:return r=this.unpack_uint32(),this.unpack_map(r)}}unpack_uint8(){const t=this.dataView[this.index]&255;return this.index++,t}unpack_uint16(){const t=this.read(2),r=(t[0]&255)*256+(t[1]&255);return this.index+=2,r}unpack_uint32(){const t=this.read(4),r=((t[0]*256+t[1])*256+t[2])*256+t[3];return this.index+=4,r}unpack_uint64(){const t=this.read(8),r=((((((t[0]*256+t[1])*256+t[2])*256+t[3])*256+t[4])*256+t[5])*256+t[6])*256+t[7];return this.index+=8,r}unpack_int8(){const t=this.unpack_uint8();return t<128?t:t-256}unpack_int16(){const t=this.unpack_uint16();return t<32768?t:t-65536}unpack_int32(){const t=this.unpack_uint32();return t<2**31?t:t-2**32}unpack_int64(){const t=this.unpack_uint64();return t<2**63?t:t-2**64}unpack_raw(t){if(this.length<this.index+t)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${t} ${this.length}`);const r=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,r}unpack_string(t){const r=this.read(t);let i=0,c="",u,f;for(;i<t;)u=r[i],u<160?(f=u,i++):(u^192)<32?(f=(u&31)<<6|r[i+1]&63,i+=2):(u^224)<16?(f=(u&15)<<12|(r[i+1]&63)<<6|r[i+2]&63,i+=3):(f=(u&7)<<18|(r[i+1]&63)<<12|(r[i+2]&63)<<6|r[i+3]&63,i+=4),c+=String.fromCodePoint(f);return this.index+=t,c}unpack_array(t){const r=new Array(t);for(let i=0;i<t;i++)r[i]=this.unpack();return r}unpack_map(t){const r={};for(let i=0;i<t;i++){const c=this.unpack();r[c]=this.unpack()}return r}unpack_float(){const t=this.unpack_uint32(),r=t>>31,i=(t>>23&255)-127,c=t&8388607|8388608;return(r===0?1:-1)*c*2**(i-23)}unpack_double(){const t=this.unpack_uint32(),r=this.unpack_uint32(),i=t>>31,c=(t>>20&2047)-1023,f=(t&1048575|1048576)*2**(c-20)+r*2**(c-52);return(i===0?1:-1)*f}read(t){const r=this.index;if(r+t<=this.length)return this.dataView.subarray(r,r+t);throw new Error("BinaryPackFailure: read index out of range")}}class n3{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(t){if(typeof t=="string")this.pack_string(t);else if(typeof t=="number")Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if(typeof t=="boolean")t===!0?this._bufferBuilder.append(195):t===!1&&this._bufferBuilder.append(194);else if(t===void 0)this._bufferBuilder.append(192);else if(typeof t=="object")if(t===null)this._bufferBuilder.append(192);else{const r=t.constructor;if(t instanceof Array){const i=this.pack_array(t);if(i instanceof Promise)return i.then(()=>this._bufferBuilder.flush())}else if(t instanceof ArrayBuffer)this.pack_bin(new Uint8Array(t));else if("BYTES_PER_ELEMENT"in t){const i=t;this.pack_bin(new Uint8Array(i.buffer,i.byteOffset,i.byteLength))}else if(t instanceof Date)this.pack_string(t.toString());else{if(t instanceof Blob)return t.arrayBuffer().then(i=>{this.pack_bin(new Uint8Array(i)),this._bufferBuilder.flush()});if(r==Object||r.toString().startsWith("class")){const i=this.pack_object(t);if(i instanceof Promise)return i.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${r.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof t}" not yet supported`);this._bufferBuilder.flush()}pack_bin(t){const r=t.length;if(r<=15)this.pack_uint8(160+r);else if(r<=65535)this._bufferBuilder.append(218),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_string(t){const r=this._textEncoder.encode(t),i=r.length;if(i<=15)this.pack_uint8(176+i);else if(i<=65535)this._bufferBuilder.append(216),this.pack_uint16(i);else if(i<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(i);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(r)}pack_array(t){const r=t.length;if(r<=15)this.pack_uint8(144+r);else if(r<=65535)this._bufferBuilder.append(220),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(r);else throw new Error("Invalid length");const i=c=>{if(c<r){const u=this.pack(t[c]);return u instanceof Promise?u.then(()=>i(c+1)):i(c+1)}};return i(0)}pack_integer(t){if(t>=-32&&t<=127)this._bufferBuilder.append(t&255);else if(t>=0&&t<=255)this._bufferBuilder.append(204),this.pack_uint8(t);else if(t>=-128&&t<=127)this._bufferBuilder.append(208),this.pack_int8(t);else if(t>=0&&t<=65535)this._bufferBuilder.append(205),this.pack_uint16(t);else if(t>=-32768&&t<=32767)this._bufferBuilder.append(209),this.pack_int16(t);else if(t>=0&&t<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(t);else if(t>=-2147483648&&t<=2147483647)this._bufferBuilder.append(210),this.pack_int32(t);else if(t>=-9223372036854776e3&&t<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(t);else if(t>=0&&t<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(t);else throw new Error("Invalid integer")}pack_double(t){let r=0;t<0&&(r=1,t=-t);const i=Math.floor(Math.log(t)/Math.LN2),c=t/2**i-1,u=Math.floor(c*2**52),f=2**32,m=r<<31|i+1023<<20|u/f&1048575,v=u%f;this._bufferBuilder.append(203),this.pack_int32(m),this.pack_int32(v)}pack_object(t){const r=Object.keys(t),i=r.length;if(i<=15)this.pack_uint8(128+i);else if(i<=65535)this._bufferBuilder.append(222),this.pack_uint16(i);else if(i<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(i);else throw new Error("Invalid length");const c=u=>{if(u<r.length){const f=r[u];if(t.hasOwnProperty(f)){this.pack(f);const m=this.pack(t[f]);if(m instanceof Promise)return m.then(()=>c(u+1))}return c(u+1)}};return c(0)}pack_uint8(t){this._bufferBuilder.append(t)}pack_uint16(t){this._bufferBuilder.append(t>>8),this._bufferBuilder.append(t&255)}pack_uint32(t){const r=t&4294967295;this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_uint64(t){const r=t/4294967296,i=t%2**32;this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255),this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255)}pack_int8(t){this._bufferBuilder.append(t&255)}pack_int16(t){this._bufferBuilder.append((t&65280)>>8),this._bufferBuilder.append(t&255)}pack_int32(t){this._bufferBuilder.append(t>>>24&255),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_int64(t){const r=Math.floor(t/4294967296),i=t%2**32;this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255),this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255)}constructor(){this._bufferBuilder=new W4,this._textEncoder=new TextEncoder}}let J0=!0,W0=!0;function $l(s,t,r){const i=s.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function ni(s,t,r){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,c=i.addEventListener;i.addEventListener=function(f,m){if(f!==t)return c.apply(this,arguments);const v=x=>{const A=r(x);A&&(m.handleEvent?m.handleEvent(A):m(A))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,v),c.apply(this,[f,v])};const u=i.removeEventListener;i.removeEventListener=function(f,m){if(f!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(m))return u.apply(this,arguments);const v=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[f,v])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(f){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),f&&this.addEventListener(t,this["_on"+t]=f)},enumerable:!0,configurable:!0})}function s3(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(J0=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function r3(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(W0=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function e1(){if(typeof window=="object"){if(J0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Vf(s,t){W0&&console.warn(s+" is deprecated, please use "+t+" instead.")}function i3(s){const t={browser:null,version:null};if(typeof s>"u"||!s.navigator||!s.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:r}=s;if(r.userAgentData&&r.userAgentData.brands){const i=r.userAgentData.brands.find(c=>c.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(r.mozGetUserMedia)t.browser="firefox",t.version=$l(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)t.browser="chrome",t.version=$l(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(s.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=$l(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function rA(s){return Object.prototype.toString.call(s)==="[object Object]"}function t1(s){return rA(s)?Object.keys(s).reduce(function(t,r){const i=rA(s[r]),c=i?t1(s[r]):s[r],u=i&&!Object.keys(c).length;return c===void 0||u?t:Object.assign(t,{[r]:c})},{}):s}function ff(s,t,r){!t||r.has(t.id)||(r.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?ff(s,s.get(t[i]),r):i.endsWith("Ids")&&t[i].forEach(c=>{ff(s,s.get(c),r)})}))}function iA(s,t,r){const i=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;const u=[];return s.forEach(f=>{f.type==="track"&&f.trackIdentifier===t.id&&u.push(f)}),u.forEach(f=>{s.forEach(m=>{m.type===i&&m.trackId===f.id&&ff(s,m,c)})}),c}const aA=e1;function n1(s,t){const r=s&&s.navigator;if(!r.mediaDevices)return;const i=function(m){if(typeof m!="object"||m.mandatory||m.optional)return m;const v={};return Object.keys(m).forEach(x=>{if(x==="require"||x==="advanced"||x==="mediaSource")return;const A=typeof m[x]=="object"?m[x]:{ideal:m[x]};A.exact!==void 0&&typeof A.exact=="number"&&(A.min=A.max=A.exact);const S=function(j,C){return j?j+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(A.ideal!==void 0){v.optional=v.optional||[];let j={};typeof A.ideal=="number"?(j[S("min",x)]=A.ideal,v.optional.push(j),j={},j[S("max",x)]=A.ideal,v.optional.push(j)):(j[S("",x)]=A.ideal,v.optional.push(j))}A.exact!==void 0&&typeof A.exact!="number"?(v.mandatory=v.mandatory||{},v.mandatory[S("",x)]=A.exact):["min","max"].forEach(j=>{A[j]!==void 0&&(v.mandatory=v.mandatory||{},v.mandatory[S(j,x)]=A[j])})}),m.advanced&&(v.optional=(v.optional||[]).concat(m.advanced)),v},c=function(m,v){if(t.version>=61)return v(m);if(m=JSON.parse(JSON.stringify(m)),m&&typeof m.audio=="object"){const x=function(A,S,j){S in A&&!(j in A)&&(A[j]=A[S],delete A[S])};m=JSON.parse(JSON.stringify(m)),x(m.audio,"autoGainControl","googAutoGainControl"),x(m.audio,"noiseSuppression","googNoiseSuppression"),m.audio=i(m.audio)}if(m&&typeof m.video=="object"){let x=m.video.facingMode;x=x&&(typeof x=="object"?x:{ideal:x});const A=t.version<66;if(x&&(x.exact==="user"||x.exact==="environment"||x.ideal==="user"||x.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!A)){delete m.video.facingMode;let S;if(x.exact==="environment"||x.ideal==="environment"?S=["back","rear"]:(x.exact==="user"||x.ideal==="user")&&(S=["front"]),S)return r.mediaDevices.enumerateDevices().then(j=>{j=j.filter(M=>M.kind==="videoinput");let C=j.find(M=>S.some(U=>M.label.toLowerCase().includes(U)));return!C&&j.length&&S.includes("back")&&(C=j[j.length-1]),C&&(m.video.deviceId=x.exact?{exact:C.deviceId}:{ideal:C.deviceId}),m.video=i(m.video),aA("chrome: "+JSON.stringify(m)),v(m)})}m.video=i(m.video)}return aA("chrome: "+JSON.stringify(m)),v(m)},u=function(m){return t.version>=64?m:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[m.name]||m.name,message:m.message,constraint:m.constraint||m.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},f=function(m,v,x){c(m,A=>{r.webkitGetUserMedia(A,v,S=>{x&&x(u(S))})})};if(r.getUserMedia=f.bind(r),r.mediaDevices.getUserMedia){const m=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(v){return c(v,x=>m(x).then(A=>{if(x.audio&&!A.getAudioTracks().length||x.video&&!A.getVideoTracks().length)throw A.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return A},A=>Promise.reject(u(A))))}}}function s1(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function r1(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",c=>{let u;s.RTCPeerConnection.prototype.getReceivers?u=this.getReceivers().find(m=>m.track&&m.track.id===c.track.id):u={track:c.track};const f=new Event("track");f.track=c.track,f.receiver=u,f.transceiver={receiver:u},f.streams=[i.stream],this.dispatchEvent(f)}),i.stream.getTracks().forEach(c=>{let u;s.RTCPeerConnection.prototype.getReceivers?u=this.getReceivers().find(m=>m.track&&m.track.id===c.id):u={track:c};const f=new Event("track");f.track=c,f.receiver=u,f.transceiver={receiver:u},f.streams=[i.stream],this.dispatchEvent(f)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ni(s,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function i1(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const t=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(m,v){let x=c.apply(this,arguments);return x||(x=t(this,m),this._senders.push(x)),x};const u=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(m){u.apply(this,arguments);const v=this._senders.indexOf(m);v!==-1&&this._senders.splice(v,1)}}const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(u){this._senders=this._senders||[],r.apply(this,[u]),u.getTracks().forEach(f=>{this._senders.push(t(this,f))})};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(u){this._senders=this._senders||[],i.apply(this,[u]),u.getTracks().forEach(f=>{const m=this._senders.find(v=>v.track===f);m&&this._senders.splice(this._senders.indexOf(m),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(c=>c._pc=this),i},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function a1(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const u=r.apply(this,[]);return u.forEach(f=>f._pc=this),u});const i=s.RTCPeerConnection.prototype.addTrack;i&&(s.RTCPeerConnection.prototype.addTrack=function(){const u=i.apply(this,arguments);return u._pc=this,u}),s.RTCRtpSender.prototype.getStats=function(){const u=this;return this._pc.getStats().then(f=>iA(f,u.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const c=r.apply(this,[]);return c.forEach(u=>u._pc=this),c}),ni(s,"track",i=>(i.receiver._pc=i.srcElement,i)),s.RTCRtpReceiver.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>iA(u,c.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const t=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const i=arguments[0];let c,u,f;return this.getSenders().forEach(m=>{m.track===i&&(c?f=!0:c=m)}),this.getReceivers().forEach(m=>(m.track===i&&(u?f=!0:u=m),m.track===i)),f||c&&u?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():u?u.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function o1(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(f=>this._shimmedLocalStreams[f][0])};const t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(f,m){if(!m)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const v=t.apply(this,arguments);return this._shimmedLocalStreams[m.id]?this._shimmedLocalStreams[m.id].indexOf(v)===-1&&this._shimmedLocalStreams[m.id].push(v):this._shimmedLocalStreams[m.id]=[m,v],v};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(f){this._shimmedLocalStreams=this._shimmedLocalStreams||{},f.getTracks().forEach(x=>{if(this.getSenders().find(S=>S.track===x))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();r.apply(this,arguments);const v=this.getSenders().filter(x=>m.indexOf(x)===-1);this._shimmedLocalStreams[f.id]=[f].concat(v)};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(f){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[f.id],i.apply(this,arguments)};const c=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(f){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},f&&Object.keys(this._shimmedLocalStreams).forEach(m=>{const v=this._shimmedLocalStreams[m].indexOf(f);v!==-1&&this._shimmedLocalStreams[m].splice(v,1),this._shimmedLocalStreams[m].length===1&&delete this._shimmedLocalStreams[m]}),c.apply(this,arguments)}}function l1(s,t){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&t.version>=65)return o1(s);const r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const A=r.apply(this);return this._reverseStreams=this._reverseStreams||{},A.map(S=>this._reverseStreams[S.id])};const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(A){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},A.getTracks().forEach(S=>{if(this.getSenders().find(C=>C.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[A.id]){const S=new s.MediaStream(A.getTracks());this._streams[A.id]=S,this._reverseStreams[S.id]=A,A=S}i.apply(this,[A])};const c=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(A){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[A.id]||A]),delete this._reverseStreams[this._streams[A.id]?this._streams[A.id].id:A.id],delete this._streams[A.id]},s.RTCPeerConnection.prototype.addTrack=function(A,S){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const j=[].slice.call(arguments,1);if(j.length!==1||!j[0].getTracks().find(U=>U===A))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(U=>U.track===A))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const M=this._streams[S.id];if(M)M.addTrack(A),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const U=new s.MediaStream([A]);this._streams[S.id]=U,this._reverseStreams[U.id]=S,this.addStream(U)}return this.getSenders().find(U=>U.track===A)};function u(x,A){let S=A.sdp;return Object.keys(x._reverseStreams||[]).forEach(j=>{const C=x._reverseStreams[j],M=x._streams[C.id];S=S.replace(new RegExp(M.id,"g"),C.id)}),new RTCSessionDescription({type:A.type,sdp:S})}function f(x,A){let S=A.sdp;return Object.keys(x._reverseStreams||[]).forEach(j=>{const C=x._reverseStreams[j],M=x._streams[C.id];S=S.replace(new RegExp(C.id,"g"),M.id)}),new RTCSessionDescription({type:A.type,sdp:S})}["createOffer","createAnswer"].forEach(function(x){const A=s.RTCPeerConnection.prototype[x],S={[x](){const j=arguments;return arguments.length&&typeof arguments[0]=="function"?A.apply(this,[M=>{const U=u(this,M);j[0].apply(null,[U])},M=>{j[1]&&j[1].apply(null,M)},arguments[2]]):A.apply(this,arguments).then(M=>u(this,M))}};s.RTCPeerConnection.prototype[x]=S[x]});const m=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?m.apply(this,arguments):(arguments[0]=f(this,arguments[0]),m.apply(this,arguments))};const v=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const x=v.get.apply(this);return x.type===""?x:u(this,x)}}),s.RTCPeerConnection.prototype.removeTrack=function(A){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!A._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(A._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let j;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(U=>A.track===U)&&(j=this._streams[C])}),j&&(j.getTracks().length===1?this.removeStream(this._reverseStreams[j.id]):j.removeTrack(A.track),this.dispatchEvent(new Event("negotiationneeded")))}}function hf(s,t){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const i=s.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=c[r]})}function c1(s,t){ni(s,"negotiationneeded",r=>{const i=r.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return r})}const oA=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:c1,shimAddTrackRemoveTrack:l1,shimAddTrackRemoveTrackWithNative:o1,shimGetSendersWithDtmf:i1,shimGetUserMedia:n1,shimMediaStream:s1,shimOnTrack:r1,shimPeerConnection:hf,shimSenderReceiverGetStats:a1},Symbol.toStringTag,{value:"Module"}));function u1(s,t){const r=s&&s.navigator,i=s&&s.MediaStreamTrack;if(r.getUserMedia=function(c,u,f){Vf("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(u,f)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(f,m,v){m in f&&!(v in f)&&(f[v]=f[m],delete f[m])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f.audio,"autoGainControl","mozAutoGainControl"),c(f.audio,"noiseSuppression","mozNoiseSuppression")),u(f)},i&&i.prototype.getSettings){const f=i.prototype.getSettings;i.prototype.getSettings=function(){const m=f.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(i&&i.prototype.applyConstraints){const f=i.prototype.applyConstraints;i.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[m])}}}}function a3(s,t){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,Promise.reject(c)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,s.navigator.mediaDevices.getUserMedia(i)})}function d1(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mf(s,t){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=s.RTCPeerConnection.prototype[c],f={[c](){return arguments[0]=new(c==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};s.RTCPeerConnection.prototype[c]=f[c]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[u,f,m]=arguments;return i.apply(this,[u||null]).then(v=>{if(t.version<53&&!f)try{v.forEach(x=>{x.type=r[x.type]||x.type})}catch(x){if(x.name!=="TypeError")throw x;v.forEach((A,S)=>{v.set(S,Object.assign({},A,{type:r[A.type]||A.type}))})}return v}).then(f,m)}}function f1(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const c=t.apply(this,[]);return c.forEach(u=>u._pc=this),c});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const c=r.apply(this,arguments);return c._pc=this,c}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function h1(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(c=>c._pc=this),i}),ni(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function m1(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(r){Vf("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&r.getTracks().includes(i.track)&&this.removeTrack(i)})})}function p1(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function g1(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.addTransceiver;t&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const c=i.length>0;c&&i.forEach(f=>{if("rid"in f&&!/^[a-z0-9]{0,16}$/i.test(f.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in f&&!(parseFloat(f.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in f&&!(parseFloat(f.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const u=t.apply(this,arguments);if(c){const{sender:f}=u,m=f.getParameters();(!("encodings"in m)||m.encodings.length===1&&Object.keys(m.encodings[0]).length===0)&&(m.encodings=i,f.sendEncodings=i,this.setParametersPromises.push(f.setParameters(m).then(()=>{delete f.sendEncodings}).catch(()=>{delete f.sendEncodings})))}return u})}function A1(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const t=s.RTCRtpSender.prototype.getParameters;t&&(s.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function y1(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function v1(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const t=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const lA=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:g1,shimCreateAnswer:v1,shimCreateOffer:y1,shimGetDisplayMedia:a3,shimGetParameters:A1,shimGetUserMedia:u1,shimOnTrack:d1,shimPeerConnection:mf,shimRTCDataChannel:p1,shimReceiverGetStats:h1,shimRemoveStream:m1,shimSenderGetStats:f1},Symbol.toStringTag,{value:"Module"}));function b1(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const t=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>t.call(this,c,i)),i.getVideoTracks().forEach(c=>t.call(this,c,i))},s.RTCPeerConnection.prototype.addTrack=function(i,...c){return c&&c.forEach(u=>{this._localStreams?this._localStreams.includes(u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const c=r.getTracks();this.getSenders().forEach(u=>{c.includes(u.track)&&this.removeTrack(u)})})}}function x1(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(c=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(c))return;this._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,this.dispatchEvent(u)})})}});const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(u=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(u)>=0)return;i._remoteStreams.push(u);const f=new Event("addstream");f.stream=u,i.dispatchEvent(f)})}),t.apply(i,arguments)}}}function S1(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const t=s.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,c=t.setLocalDescription,u=t.setRemoteDescription,f=t.addIceCandidate;t.createOffer=function(x,A){const S=arguments.length>=2?arguments[2]:arguments[0],j=r.apply(this,[S]);return A?(j.then(x,A),Promise.resolve()):j},t.createAnswer=function(x,A){const S=arguments.length>=2?arguments[2]:arguments[0],j=i.apply(this,[S]);return A?(j.then(x,A),Promise.resolve()):j};let m=function(v,x,A){const S=c.apply(this,[v]);return A?(S.then(x,A),Promise.resolve()):S};t.setLocalDescription=m,m=function(v,x,A){const S=u.apply(this,[v]);return A?(S.then(x,A),Promise.resolve()):S},t.setRemoteDescription=m,m=function(v,x,A){const S=f.apply(this,[v]);return A?(S.then(x,A),Promise.resolve()):S},t.addIceCandidate=m}function w1(s){const t=s&&s.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,i=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>i(k1(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,c,u){t.mediaDevices.getUserMedia(i).then(c,u)}).bind(t))}function k1(s){return s&&s.video!==void 0?Object.assign({},s,{video:t1(s.video)}):s}function C1(s){if(!s.RTCPeerConnection)return;const t=s.RTCPeerConnection;s.RTCPeerConnection=function(i,c){if(i&&i.iceServers){const u=[];for(let f=0;f<i.iceServers.length;f++){let m=i.iceServers[f];m.urls===void 0&&m.url?(Vf("RTCIceServer.url","RTCIceServer.urls"),m=JSON.parse(JSON.stringify(m)),m.urls=m.url,delete m.url,u.push(m)):u.push(i.iceServers[f])}i.iceServers=u}return new t(i,c)},s.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function j1(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _1(s){const t=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const c=this.getTransceivers().find(f=>f.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveAudio===!0&&!c&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const u=this.getTransceivers().find(f=>f.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&u?u.direction==="sendrecv"?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":u.direction==="recvonly"&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):i.offerToReceiveVideo===!0&&!u&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function E1(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const cA=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:E1,shimCallbacksAPI:S1,shimConstraints:k1,shimCreateOfferLegacy:_1,shimGetUserMedia:w1,shimLocalStreamsAPI:b1,shimRTCIceServerUrls:C1,shimRemoteStreamsAPI:x1,shimTrackEventTransceiver:j1},Symbol.toStringTag,{value:"Module"}));var Md={exports:{}},uA;function o3(){return uA||(uA=1,function(s){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(r){return r.split(`
m=`).map((c,u)=>(u>0?"m="+c:c).trim()+`\r
`)},t.getDescription=function(r){const i=t.splitSections(r);return i&&i[0]},t.getMediaSections=function(r){const i=t.splitSections(r);return i.shift(),i},t.matchPrefix=function(r,i){return t.splitLines(r).filter(c=>c.indexOf(i)===0)},t.parseCandidate=function(r){let i;r.indexOf("a=candidate:")===0?i=r.substring(12).split(" "):i=r.substring(10).split(" ");const c={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let u=8;u<i.length;u+=2)switch(i[u]){case"raddr":c.relatedAddress=i[u+1];break;case"rport":c.relatedPort=parseInt(i[u+1],10);break;case"tcptype":c.tcpType=i[u+1];break;case"ufrag":c.ufrag=i[u+1],c.usernameFragment=i[u+1];break;default:c[i[u]]===void 0&&(c[i[u]]=i[u+1]);break}return c},t.writeCandidate=function(r){const i=[];i.push(r.foundation);const c=r.component;c==="rtp"?i.push(1):c==="rtcp"?i.push(2):i.push(c),i.push(r.protocol.toUpperCase()),i.push(r.priority),i.push(r.address||r.ip),i.push(r.port);const u=r.type;return i.push("typ"),i.push(u),u!=="host"&&r.relatedAddress&&r.relatedPort&&(i.push("raddr"),i.push(r.relatedAddress),i.push("rport"),i.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(i.push("ufrag"),i.push(r.usernameFragment||r.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let i=r.substring(9).split(" ");const c={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),c.name=i[0],c.clockRate=parseInt(i[1],10),c.channels=i.length===3?parseInt(i[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let i=r.payloadType;r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+i+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){const i=r.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const i={};let c;const u=r.substring(r.indexOf(" ")+1).split(";");for(let f=0;f<u.length;f++)c=u[f].trim().split("="),i[c[0].trim()]=c[1];return i},t.writeFmtp=function(r){let i="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const u=[];Object.keys(r.parameters).forEach(f=>{r.parameters[f]!==void 0?u.push(f+"="+r.parameters[f]):u.push(f)}),i+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return i},t.parseRtcpFb=function(r){const i=r.substring(r.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(r){let i="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(u=>{i+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(r){const i=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,i),10)},u=r.indexOf(":",i);return u>-1?(c.attribute=r.substring(i+1,u),c.value=r.substring(u+1)):c.attribute=r.substring(i+1),c},t.parseSsrcGroup=function(r){const i=r.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(c=>parseInt(c,10))}},t.getMid=function(r){const i=t.matchPrefix(r,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(r){const i=r.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(r,i){return{role:"auto",fingerprints:t.matchPrefix(r+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,i){let c="a=setup:"+i+`\r
`;return r.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},t.parseCryptoLine=function(r){const i=r.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const i=r.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,i){return t.matchPrefix(r+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,i){const c=t.matchPrefix(r+i,"a=ice-ufrag:")[0],u=t.matchPrefix(r+i,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(r){let i="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(r){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=t.splitLines(r)[0].split(" ");i.profile=u[2];for(let m=3;m<u.length;m++){const v=u[m],x=t.matchPrefix(r,"a=rtpmap:"+v+" ")[0];if(x){const A=t.parseRtpMap(x),S=t.matchPrefix(r,"a=fmtp:"+v+" ");switch(A.parameters=S.length?t.parseFmtp(S[0]):{},A.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+v+" ").map(t.parseRtcpFb),i.codecs.push(A),A.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(A.name.toUpperCase());break}}}t.matchPrefix(r,"a=extmap:").forEach(m=>{i.headerExtensions.push(t.parseExtmap(m))});const f=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(m=>{f.forEach(v=>{m.rtcpFeedback.find(A=>A.type===v.type&&A.parameter===v.parameter)||m.rtcpFeedback.push(v)})}),i},t.writeRtpDescription=function(r,i){let c="";c+="m="+r+" ",c+=i.codecs.length>0?"9":"0",c+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=i.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(f=>{c+=t.writeRtpMap(f),c+=t.writeFmtp(f),c+=t.writeRtcpFb(f)});let u=0;return i.codecs.forEach(f=>{f.maxptime>u&&(u=f.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(f=>{c+=t.writeExtmap(f)}),c},t.parseRtpEncodingParameters=function(r){const i=[],c=t.parseRtpParameters(r),u=c.fecMechanisms.indexOf("RED")!==-1,f=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(r,"a=ssrc:").map(j=>t.parseSsrcMedia(j)).filter(j=>j.attribute==="cname"),v=m.length>0&&m[0].ssrc;let x;const A=t.matchPrefix(r,"a=ssrc-group:FID").map(j=>j.substring(17).split(" ").map(M=>parseInt(M,10)));A.length>0&&A[0].length>1&&A[0][0]===v&&(x=A[0][1]),c.codecs.forEach(j=>{if(j.name.toUpperCase()==="RTX"&&j.parameters.apt){let C={ssrc:v,codecPayloadType:parseInt(j.parameters.apt,10)};v&&x&&(C.rtx={ssrc:x}),i.push(C),u&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:v,mechanism:f?"red+ulpfec":"red"},i.push(C))}}),i.length===0&&v&&i.push({ssrc:v});let S=t.matchPrefix(r,"b=");return S.length&&(S[0].indexOf("b=TIAS:")===0?S=parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?S=parseInt(S[0].substring(5),10)*1e3*.95-50*40*8:S=void 0,i.forEach(j=>{j.maxBitrate=S})),i},t.parseRtcpParameters=function(r){const i={},c=t.matchPrefix(r,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(i.cname=c.value,i.ssrc=c.ssrc);const u=t.matchPrefix(r,"a=rtcp-rsize");i.reducedSize=u.length>0,i.compound=u.length===0;const f=t.matchPrefix(r,"a=rtcp-mux");return i.mux=f.length>0,i},t.writeRtcpParameters=function(r){let i="";return r.reducedSize&&(i+=`a=rtcp-rsize\r
`),r.mux&&(i+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(i+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),i},t.parseMsid=function(r){let i;const c=t.matchPrefix(r,"a=msid:");if(c.length===1)return i=c[0].substring(7).split(" "),{stream:i[0],track:i[1]};const u=t.matchPrefix(r,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");if(u.length>0)return i=u[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(r){const i=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const f=t.matchPrefix(r,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:i.fmt,maxMessageSize:u};const m=t.matchPrefix(r,"a=sctpmap:");if(m.length>0){const v=m[0].substring(10).split(" ");return{port:parseInt(v[0],10),protocol:v[1],maxMessageSize:u}}},t.writeSctpDescription=function(r,i){let c=[];return r.protocol!=="DTLS/SCTP"?c=["m="+r.kind+" 9 "+r.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:c=["m="+r.kind+" 9 "+r.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&c.push("a=max-message-size:"+i.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,i,c){let u;const f=i!==void 0?i:2;return r?u=r:u=t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,i){const c=t.splitLines(r);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const c=t.splitLines(r)[0].substring(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},t.parseOLine=function(r){const c=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const i=t.splitLines(r);for(let c=0;c<i.length;c++)if(i[c].length<2||i[c].charAt(1)!=="=")return!1;return!0},s.exports=t}(Md)),Md.exports}var N1=o3();const Hi=jf(N1),l3=ab({__proto__:null,default:Hi},[N1]);function ql(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const t=s.RTCIceCandidate;s.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const c=new t(i),u=Hi.parseCandidate(i.candidate);for(const f in u)f in c||Object.defineProperty(c,f,{value:u[f]});return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(i)},s.RTCIceCandidate.prototype=t.prototype,ni(s,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new s.RTCIceCandidate(r.candidate),writable:"false"}),r))}function pf(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||ni(s,"icecandidate",t=>{if(t.candidate){const r=Hi.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function Il(s,t){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(m){if(!m||!m.sdp)return!1;const v=Hi.splitSections(m.sdp);return v.shift(),v.some(x=>{const A=Hi.parseMLine(x);return A&&A.kind==="application"&&A.protocol.indexOf("SCTP")!==-1})},i=function(m){const v=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(v===null||v.length<2)return-1;const x=parseInt(v[1],10);return x!==x?-1:x},c=function(m){let v=65536;return t.browser==="firefox"&&(t.version<57?m===-1?v=16384:v=2147483637:t.version<60?v=t.version===57?65535:65536:v=2147483637),v},u=function(m,v){let x=65536;t.browser==="firefox"&&t.version===57&&(x=65535);const A=Hi.matchPrefix(m.sdp,"a=max-message-size:");return A.length>0?x=parseInt(A[0].substring(19),10):t.browser==="firefox"&&v!==-1&&(x=2147483637),x},f=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:v}=this.getConfiguration();v==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const v=i(arguments[0]),x=c(v),A=u(arguments[0],v);let S;x===0&&A===0?S=Number.POSITIVE_INFINITY:x===0||A===0?S=Math.max(x,A):S=Math.min(x,A);const j={};Object.defineProperty(j,"maxMessageSize",{get(){return S}}),this._sctp=j}return f.apply(this,arguments)}}function Fl(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function t(i,c){const u=i.send;i.send=function(){const m=arguments[0],v=m.length||m.size||m.byteLength;if(i.readyState==="open"&&c.sctp&&v>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(i,arguments)}}const r=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const c=r.apply(this,arguments);return t(c,this),c},ni(s,"datachannel",i=>(t(i.channel,i.target),i))}function gf(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const t=s.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const i=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const f=new Event("connectionstatechange",c);u.dispatchEvent(f)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Af(s,t){if(!s.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(c){if(c&&c.sdp&&c.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const u=c.sdp.split(`
`).filter(f=>f.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&c instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:c.type,sdp:u}):c.sdp=u}return r.apply(this,arguments)}}function Hl(s,t){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const r=s.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Vl(s,t){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const r=s.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(s.RTCPeerConnection.prototype.setLocalDescription=function(){let c=arguments[0]||{};if(typeof c!="object"||c.type&&c.sdp)return r.apply(this,arguments);if(c={type:c.type,sdp:c.sdp},!c.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":c.type="offer";break;default:c.type="answer";break}return c.sdp||c.type!=="offer"&&c.type!=="answer"?r.apply(this,[c]):(c.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(f=>r.apply(this,[f]))})}const c3=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Af,shimAddIceCandidateNullOrEmpty:Hl,shimConnectionState:gf,shimMaxMessageSize:Il,shimParameterlessSetLocalDescription:Vl,shimRTCIceCandidate:ql,shimRTCIceCandidateRelayProtocol:pf,shimSendThrowTypeError:Fl},Symbol.toStringTag,{value:"Module"}));function u3({window:s}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=e1,i=i3(s),c={browserDetails:i,commonShim:c3,extractVersion:$l,disableLog:s3,disableWarnings:r3,sdp:l3};switch(i.browser){case"chrome":if(!oA||!hf||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(i.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=oA,Hl(s,i),Vl(s),n1(s,i),s1(s),hf(s,i),r1(s),l1(s,i),i1(s),a1(s),c1(s,i),ql(s),pf(s),gf(s),Il(s,i),Fl(s),Af(s,i);break;case"firefox":if(!lA||!mf||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=lA,Hl(s,i),Vl(s),u1(s,i),mf(s,i),d1(s),m1(s),f1(s),h1(s),p1(s),g1(s),A1(s),y1(s),v1(s),ql(s),gf(s),Il(s,i),Fl(s);break;case"safari":if(!cA||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=cA,Hl(s,i),Vl(s),C1(s),_1(s),S1(s),b1(s),x1(s),j1(s),w1(s),E1(s),ql(s),pf(s),Il(s,i),Fl(s),Af(s,i);break;default:r("Unsupported browser!");break}return c}const dA=u3({window:typeof window>"u"?void 0:window});function si(s,t,r,i){Object.defineProperty(s,t,{get:r,set:i,enumerable:!0,configurable:!0})}class T1{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=t=>{const r=[],i=t.byteLength,c=Math.ceil(i/this.chunkedMTU);let u=0,f=0;for(;f<i;){const m=Math.min(i,f+this.chunkedMTU),v=t.slice(f,m),x={__peerData:this._dataCount,n:u,data:v,total:c};r.push(x),f=m,u++}return this._dataCount++,r}}}function d3(s){let t=0;for(const c of s)t+=c.byteLength;const r=new Uint8Array(t);let i=0;for(const c of s)r.set(c,i),i+=c.byteLength;return r}const Od=dA.default||dA,Wa=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const s=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(s)?s==="chrome"?t>=this.minChromeVersion:s==="firefox"?t>=this.minFirefoxVersion:s==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return Od.browserDetails.browser}getVersion(){return Od.browserDetails.version||0}isUnifiedPlanSupported(){const s=this.getBrowser(),t=Od.browserDetails.version||0;if(s==="chrome"&&t<this.minChromeVersion)return!1;if(s==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let r,i=!1;try{r=new RTCPeerConnection,r.addTransceiver("audio"),i=!0}catch{}finally{r&&r.close()}return i}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},f3=s=>!s||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(s),R1=()=>Math.random().toString(36).slice(2),fA={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class h3 extends T1{noop(){}blobToArrayBuffer(t,r){const i=new FileReader;return i.onload=function(c){c.target&&r(c.target.result)},i.readAsArrayBuffer(t),i}binaryStringToArrayBuffer(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i)&255;return r.buffer}isSecure(){return location.protocol==="https:"}constructor(...t){super(...t),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=fA,this.browser=Wa.getBrowser(),this.browserVersion=Wa.getVersion(),this.pack=Z0,this.unpack=K0,this.supports=function(){const r={browser:Wa.isBrowserSupported(),webRTC:Wa.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!r.webRTC)return r;let i;try{i=new RTCPeerConnection(fA),r.audioVideo=!0;let c;try{c=i.createDataChannel("_PEERJSTEST",{ordered:!0}),r.data=!0,r.reliable=!!c.ordered;try{c.binaryType="blob",r.binaryBlob=!Wa.isIOS}catch{}}catch{}finally{c&&c.close()}}catch{}finally{i&&i.close()}return r}(),this.validateId=f3,this.randomToken=R1}}const Cn=new h3,m3="PeerJS: ";var hA;(function(s){s[s.Disabled=0]="Disabled",s[s.Errors=1]="Errors",s[s.Warnings=2]="Warnings",s[s.All=3]="All"})(hA||(hA={}));class p3{get logLevel(){return this._logLevel}set logLevel(t){this._logLevel=t}log(...t){this._logLevel>=3&&this._print(3,...t)}warn(...t){this._logLevel>=2&&this._print(2,...t)}error(...t){this._logLevel>=1&&this._print(1,...t)}setLogFunction(t){this._print=t}_print(t,...r){const i=[m3,...r];for(const c in i)i[c]instanceof Error&&(i[c]="("+i[c].name+") "+i[c].message);t>=3?console.log(...i):t>=2?console.warn("WARNING",...i):t>=1&&console.error("ERROR",...i)}constructor(){this._logLevel=0}}var qe=new p3,Yf={},g3=Object.prototype.hasOwnProperty,Sn="~";function fo(){}Object.create&&(fo.prototype=Object.create(null),new fo().__proto__||(Sn=!1));function A3(s,t,r){this.fn=s,this.context=t,this.once=r||!1}function M1(s,t,r,i,c){if(typeof r!="function")throw new TypeError("The listener must be a function");var u=new A3(r,i||s,c),f=Sn?Sn+t:t;return s._events[f]?s._events[f].fn?s._events[f]=[s._events[f],u]:s._events[f].push(u):(s._events[f]=u,s._eventsCount++),s}function Yl(s,t){--s._eventsCount===0?s._events=new fo:delete s._events[t]}function yn(){this._events=new fo,this._eventsCount=0}yn.prototype.eventNames=function(){var t=[],r,i;if(this._eventsCount===0)return t;for(i in r=this._events)g3.call(r,i)&&t.push(Sn?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t};yn.prototype.listeners=function(t){var r=Sn?Sn+t:t,i=this._events[r];if(!i)return[];if(i.fn)return[i.fn];for(var c=0,u=i.length,f=new Array(u);c<u;c++)f[c]=i[c].fn;return f};yn.prototype.listenerCount=function(t){var r=Sn?Sn+t:t,i=this._events[r];return i?i.fn?1:i.length:0};yn.prototype.emit=function(t,r,i,c,u,f){var m=Sn?Sn+t:t;if(!this._events[m])return!1;var v=this._events[m],x=arguments.length,A,S;if(v.fn){switch(v.once&&this.removeListener(t,v.fn,void 0,!0),x){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,r),!0;case 3:return v.fn.call(v.context,r,i),!0;case 4:return v.fn.call(v.context,r,i,c),!0;case 5:return v.fn.call(v.context,r,i,c,u),!0;case 6:return v.fn.call(v.context,r,i,c,u,f),!0}for(S=1,A=new Array(x-1);S<x;S++)A[S-1]=arguments[S];v.fn.apply(v.context,A)}else{var j=v.length,C;for(S=0;S<j;S++)switch(v[S].once&&this.removeListener(t,v[S].fn,void 0,!0),x){case 1:v[S].fn.call(v[S].context);break;case 2:v[S].fn.call(v[S].context,r);break;case 3:v[S].fn.call(v[S].context,r,i);break;case 4:v[S].fn.call(v[S].context,r,i,c);break;default:if(!A)for(C=1,A=new Array(x-1);C<x;C++)A[C-1]=arguments[C];v[S].fn.apply(v[S].context,A)}}return!0};yn.prototype.on=function(t,r,i){return M1(this,t,r,i,!1)};yn.prototype.once=function(t,r,i){return M1(this,t,r,i,!0)};yn.prototype.removeListener=function(t,r,i,c){var u=Sn?Sn+t:t;if(!this._events[u])return this;if(!r)return Yl(this,u),this;var f=this._events[u];if(f.fn)f.fn===r&&(!c||f.once)&&(!i||f.context===i)&&Yl(this,u);else{for(var m=0,v=[],x=f.length;m<x;m++)(f[m].fn!==r||c&&!f[m].once||i&&f[m].context!==i)&&v.push(f[m]);v.length?this._events[u]=v.length===1?v[0]:v:Yl(this,u)}return this};yn.prototype.removeAllListeners=function(t){var r;return t?(r=Sn?Sn+t:t,this._events[r]&&Yl(this,r)):(this._events=new fo,this._eventsCount=0),this};yn.prototype.off=yn.prototype.removeListener;yn.prototype.addListener=yn.prototype.on;yn.prefixed=Sn;yn.EventEmitter=yn;Yf=yn;var ri={};si(ri,"ConnectionType",()=>Ss);si(ri,"PeerErrorType",()=>It);si(ri,"BaseConnectionErrorType",()=>ho);si(ri,"DataConnectionErrorType",()=>mo);si(ri,"SerializationType",()=>Xi);si(ri,"SocketEventType",()=>xs);si(ri,"ServerMessageType",()=>cn);var Ss;(function(s){s.Data="data",s.Media="media"})(Ss||(Ss={}));var It;(function(s){s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc"})(It||(It={}));var ho;(function(s){s.NegotiationFailed="negotiation-failed",s.ConnectionClosed="connection-closed"})(ho||(ho={}));var mo;(function(s){s.NotOpenYet="not-open-yet",s.MessageToBig="message-too-big"})(mo||(mo={}));var Xi;(function(s){s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json",s.None="raw"})(Xi||(Xi={}));var xs;(function(s){s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close"})(xs||(xs={}));var cn;(function(s){s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE"})(cn||(cn={}));var Gf={};Gf=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class y3 extends Yf.EventEmitter{constructor(t,r,i,c,u,f=5e3){super(),this.pingInterval=f,this._disconnected=!0,this._messagesQueue=[];const m=t?"wss://":"ws://";this._baseUrl=m+r+":"+i+c+"peerjs?key="+u}start(t,r){this._id=t;const i=`${this._baseUrl}&id=${t}&token=${r}`;this._socket||!this._disconnected||(this._socket=new WebSocket(i+"&version="+Gf.version),this._disconnected=!1,this._socket.onmessage=c=>{let u;try{u=JSON.parse(c.data),qe.log("Server message received:",u)}catch{qe.log("Invalid server message",c.data);return}this.emit(xs.Message,u)},this._socket.onclose=c=>{this._disconnected||(qe.log("Socket closed.",c),this._cleanup(),this._disconnected=!0,this.emit(xs.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),qe.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){qe.log("Cannot send heartbeat, because socket closed");return}const t=JSON.stringify({type:cn.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const t=[...this._messagesQueue];this._messagesQueue=[];for(const r of t)this.send(r)}send(t){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(xs.Error,"Invalid message");return}if(!this._wsOpen())return;const r=JSON.stringify(t);this._socket.send(r)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class O1{constructor(t){this.connection=t}startConnection(t){const r=this._startPeerConnection();if(this.connection.peerConnection=r,this.connection.type===Ss.Media&&t._stream&&this._addTracksToConnection(t._stream,r),t.originator){const i=this.connection,c={ordered:!!t.reliable},u=r.createDataChannel(i.label,c);i._initializeDataChannel(u),this._makeOffer()}else this.handleSDP("OFFER",t.sdp)}_startPeerConnection(){qe.log("Creating RTCPeerConnection.");const t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t}_setupListeners(t){const r=this.connection.peer,i=this.connection.connectionId,c=this.connection.type,u=this.connection.provider;qe.log("Listening for ICE candidates."),t.onicecandidate=f=>{!f.candidate||!f.candidate.candidate||(qe.log(`Received ICE candidates for ${r}:`,f.candidate),u.socket.send({type:cn.Candidate,payload:{candidate:f.candidate,type:c,connectionId:i},dst:r}))},t.oniceconnectionstatechange=()=>{switch(t.iceConnectionState){case"failed":qe.log("iceConnectionState is failed, closing connections to "+r),this.connection.emitError(ho.NegotiationFailed,"Negotiation of connection to "+r+" failed."),this.connection.close();break;case"closed":qe.log("iceConnectionState is closed, closing connections to "+r),this.connection.emitError(ho.ConnectionClosed,"Connection to "+r+" closed."),this.connection.close();break;case"disconnected":qe.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":t.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",t.iceConnectionState)},qe.log("Listening for data channel"),t.ondatachannel=f=>{qe.log("Received data channel");const m=f.channel;u.getConnection(r,i)._initializeDataChannel(m)},qe.log("Listening for remote stream"),t.ontrack=f=>{qe.log("Received remote stream");const m=f.streams[0],v=u.getConnection(r,i);if(v.type===Ss.Media){const x=v;this._addStreamToMediaConnection(m,x)}}}cleanup(){qe.log("Cleaning up PeerConnection to "+this.connection.peer);const t=this.connection.peerConnection;if(!t)return;this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=()=>{};const r=t.signalingState!=="closed";let i=!1;const c=this.connection.dataChannel;c&&(i=!!c.readyState&&c.readyState!=="closed"),(r||i)&&t.close()}async _makeOffer(){const t=this.connection.peerConnection,r=this.connection.provider;try{const i=await t.createOffer(this.connection.options.constraints);qe.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp);try{await t.setLocalDescription(i),qe.log("Set localDescription:",i,`for:${this.connection.peer}`);let c={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ss.Data){const u=this.connection;c={...c,label:u.label,reliable:u.reliable,serialization:u.serialization}}r.socket.send({type:cn.Offer,payload:c,dst:this.connection.peer})}catch(c){c!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(r.emitError(It.WebRTC,c),qe.log("Failed to setLocalDescription, ",c))}}catch(i){r.emitError(It.WebRTC,i),qe.log("Failed to createOffer, ",i)}}async _makeAnswer(){const t=this.connection.peerConnection,r=this.connection.provider;try{const i=await t.createAnswer();qe.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp);try{await t.setLocalDescription(i),qe.log("Set localDescription:",i,`for:${this.connection.peer}`),r.socket.send({type:cn.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(c){r.emitError(It.WebRTC,c),qe.log("Failed to setLocalDescription, ",c)}}catch(i){r.emitError(It.WebRTC,i),qe.log("Failed to create answer, ",i)}}async handleSDP(t,r){r=new RTCSessionDescription(r);const i=this.connection.peerConnection,c=this.connection.provider;qe.log("Setting remote description",r);const u=this;try{await i.setRemoteDescription(r),qe.log(`Set remoteDescription:${t} for:${this.connection.peer}`),t==="OFFER"&&await u._makeAnswer()}catch(f){c.emitError(It.WebRTC,f),qe.log("Failed to setRemoteDescription, ",f)}}async handleCandidate(t){qe.log("handleCandidate:",t);try{await this.connection.peerConnection.addIceCandidate(t),qe.log(`Added ICE candidate for:${this.connection.peer}`)}catch(r){this.connection.provider.emitError(It.WebRTC,r),qe.log("Failed to handleCandidate, ",r)}}_addTracksToConnection(t,r){if(qe.log(`add tracks from stream ${t.id} to peer connection`),!r.addTrack)return qe.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(i=>{r.addTrack(i,t)})}_addStreamToMediaConnection(t,r){qe.log(`add stream ${t.id} to media connection ${r.connectionId}`),r.addStream(t)}}class D1 extends Yf.EventEmitter{emitError(t,r){qe.error("Error:",r),this.emit("error",new v3(`${t}`,r))}}class v3 extends Error{constructor(t,r){typeof r=="string"?super(r):(super(),Object.assign(this,r)),this.type=t}}class L1 extends D1{get open(){return this._open}constructor(t,r,i){super(),this.peer=t,this.provider=r,this.options=i,this._open=!1,this.metadata=i.metadata}}var Sf;const oo=class oo extends L1{get type(){return Ss.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,r,i){super(t,r,i),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||oo.ID_PREFIX+Cn.randomToken(),this._negotiator=new O1(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{qe.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{qe.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(t){qe.log("Receiving stream",t),this._remoteStream=t,super.emit("stream",t)}handleMessage(t){const r=t.type,i=t.payload;switch(t.type){case cn.Answer:this._negotiator.handleSDP(r,i.sdp),this._open=!0;break;case cn.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:qe.warn(`Unrecognized message type:${r} from peer:${this.peer}`);break}}answer(t,r={}){if(this._localStream){qe.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,r&&r.sdpTransform&&(this.options.sdpTransform=r.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:t});const i=this.provider._getMessages(this.connectionId);for(const c of i)this.handleMessage(c);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Sf=new WeakMap,Ga(oo,Sf,oo.ID_PREFIX="mc_");let ec=oo;class b3{constructor(t){this._options=t}_buildRequest(t){const r=this._options.secure?"https":"http",{host:i,port:c,path:u,key:f}=this._options,m=new URL(`${r}://${i}:${c}${u}${f}/${t}`);return m.searchParams.set("ts",`${Date.now()}${Math.random()}`),m.searchParams.set("version",Gf.version),fetch(m.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const t=await this._buildRequest("id");if(t.status!==200)throw new Error(`Error. Status:${t.status}`);return t.text()}catch(t){qe.error("Error retrieving ID",t);let r="";throw this._options.path==="/"&&this._options.host!==Cn.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r)}}async listAllPeers(){try{const t=await this._buildRequest("peers");if(t.status!==200){if(t.status===401){let r="";throw this._options.host===Cn.CLOUD_HOST?r="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":r="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+r)}throw new Error(`Error. Status:${t.status}`)}return t.json()}catch(t){throw qe.error("Error retrieving list peers",t),new Error("Could not get list peers from the server."+t)}}}var wf,kf;const Xr=class Xr extends L1{get type(){return Ss.Data}constructor(t,r,i){super(t,r,i),this.connectionId=this.options.connectionId||Xr.ID_PREFIX+R1(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new O1(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{qe.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=r=>{qe.log(`DC#${this.connectionId} dc onmessage:`,r.data)},this.dataChannel.onclose=()=>{qe.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(t,r=!1){if(!this.open){this.emitError(mo.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(t,r)}async handleMessage(t){const r=t.payload;switch(t.type){case cn.Answer:await this._negotiator.handleSDP(t.type,r.sdp);break;case cn.Candidate:await this._negotiator.handleCandidate(r.candidate);break;default:qe.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}}};wf=new WeakMap,kf=new WeakMap,Ga(Xr,wf,Xr.ID_PREFIX="dc_"),Ga(Xr,kf,Xr.MAX_BUFFERED_AMOUNT=8388608);let tc=Xr;class Xf extends tc{get bufferSize(){return this._bufferSize}_initializeDataChannel(t){super._initializeDataChannel(t),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",r=>this._handleDataMessage(r))}_bufferedSend(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)}_trySend(t){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>tc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(r){return qe.error(`DC#:${this.connectionId} Error when sending:`,r),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...t){super(...t),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Dd extends Xf{close(t){super.close(t),this._chunkedData={}}constructor(t,r,i){super(t,r,i),this.chunker=new T1,this.serialization=Xi.Binary,this._chunkedData={}}_handleDataMessage({data:t}){const r=K0(t),i=r.__peerData;if(i){if(i.type==="close"){this.close();return}this._handleChunk(r);return}this.emit("data",r)}_handleChunk(t){const r=t.__peerData,i=this._chunkedData[r]||{data:[],count:0,total:t.total};if(i.data[t.n]=new Uint8Array(t.data),i.count++,this._chunkedData[r]=i,i.total===i.count){delete this._chunkedData[r];const c=d3(i.data);this._handleDataMessage({data:c})}}_send(t,r){const i=Z0(t);if(i instanceof Promise)return this._send_blob(i);if(!r&&i.byteLength>this.chunker.chunkedMTU){this._sendChunks(i);return}this._bufferedSend(i)}async _send_blob(t){const r=await t;if(r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}_sendChunks(t){const r=this.chunker.chunk(t);qe.log(`DC#${this.connectionId} Try to send ${r.length} chunks...`);for(const i of r)this.send(i,!0)}}class x3 extends Xf{_handleDataMessage({data:t}){super.emit("data",t)}_send(t,r){this._bufferedSend(t)}constructor(...t){super(...t),this.serialization=Xi.None}}class S3 extends Xf{_handleDataMessage({data:t}){const r=this.parse(this.decoder.decode(t)),i=r.__peerData;if(i&&i.type==="close"){this.close();return}this.emit("data",r)}_send(t,r){const i=this.encoder.encode(this.stringify(t));if(i.byteLength>=Cn.chunkedMTU){this.emitError(mo.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(i)}constructor(...t){super(...t),this.serialization=Xi.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Cf;const lo=class lo extends D1{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const t=Object.create(null);for(const[r,i]of this._connections)t[r]=i;return t}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(t,r){super(),this._serializers={raw:x3,json:S3,binary:Dd,"binary-utf8":Dd,default:Dd},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let i;if(t&&t.constructor==Object?r=t:t&&(i=t.toString()),r={debug:0,host:Cn.CLOUD_HOST,port:Cn.CLOUD_PORT,path:"/",key:lo.DEFAULT_KEY,token:Cn.randomToken(),config:Cn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...r},this._options=r,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Cn.CLOUD_HOST?this._options.secure=Cn.isSecure():this._options.host==Cn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&qe.setLogFunction(this._options.logFunction),qe.logLevel=this._options.debug||0,this._api=new b3(r),this._socket=this._createServerConnection(),!Cn.supports.audioVideo&&!Cn.supports.data){this._delayedAbort(It.BrowserIncompatible,"The current browser does not support WebRTC");return}if(i&&!Cn.validateId(i)){this._delayedAbort(It.InvalidID,`ID "${i}" is invalid`);return}i?this._initialize(i):this._api.retrieveId().then(c=>this._initialize(c)).catch(c=>this._abort(It.ServerError,c))}_createServerConnection(){const t=new y3(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(xs.Message,r=>{this._handleMessage(r)}),t.on(xs.Error,r=>{this._abort(It.SocketError,r)}),t.on(xs.Disconnected,()=>{this.disconnected||(this.emitError(It.Network,"Lost connection to server."),this.disconnect())}),t.on(xs.Close,()=>{this.disconnected||this._abort(It.SocketClosed,"Underlying socket is already closed.")}),t}_initialize(t){this._id=t,this.socket.start(t,this._options.token)}_handleMessage(t){const r=t.type,i=t.payload,c=t.src;switch(r){case cn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case cn.Error:this._abort(It.ServerError,i.msg);break;case cn.IdTaken:this._abort(It.UnavailableID,`ID "${this.id}" is taken`);break;case cn.InvalidKey:this._abort(It.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case cn.Leave:qe.log(`Received leave message from ${c}`),this._cleanupPeer(c),this._connections.delete(c);break;case cn.Expire:this.emitError(It.PeerUnavailable,`Could not connect to peer ${c}`);break;case cn.Offer:{const u=i.connectionId;let f=this.getConnection(c,u);if(f&&(f.close(),qe.warn(`Offer received for existing Connection ID:${u}`)),i.type===Ss.Media){const v=new ec(c,this,{connectionId:u,_payload:i,metadata:i.metadata});f=v,this._addConnection(c,f),this.emit("call",v)}else if(i.type===Ss.Data){const v=new this._serializers[i.serialization](c,this,{connectionId:u,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable});f=v,this._addConnection(c,f),this.emit("connection",v)}else{qe.warn(`Received malformed connection type:${i.type}`);return}const m=this._getMessages(u);for(const v of m)f.handleMessage(v);break}default:{if(!i){qe.warn(`You received a malformed message from ${c} of type ${r}`);return}const u=i.connectionId,f=this.getConnection(c,u);f&&f.peerConnection?f.handleMessage(t):u?this._storeMessage(u,t):qe.warn("You received an unrecognized message:",t);break}}}_storeMessage(t,r){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(r)}_getMessages(t){const r=this._lostMessages.get(t);return r?(this._lostMessages.delete(t),r):[]}connect(t,r={}){if(r={serialization:"default",...r},this.disconnected){qe.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(It.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const i=new this._serializers[r.serialization](t,this,r);return this._addConnection(t,i),i}call(t,r,i={}){if(this.disconnected){qe.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(It.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!r){qe.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const c=new ec(t,this,{...i,_stream:r});return this._addConnection(t,c),c}_addConnection(t,r){qe.log(`add connection ${r.type}:${r.connectionId} to peerId:${t}`),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(r)}_removeConnection(t){const r=this._connections.get(t.peer);if(r){const i=r.indexOf(t);i!==-1&&r.splice(i,1)}this._lostMessages.delete(t.connectionId)}getConnection(t,r){const i=this._connections.get(t);if(!i)return null;for(const c of i)if(c.connectionId===r)return c;return null}_delayedAbort(t,r){setTimeout(()=>{this._abort(t,r)},0)}_abort(t,r){qe.error("Aborting!"),this.emitError(t,r),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(qe.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const t of this._connections.keys())this._cleanupPeer(t),this._connections.delete(t);this.socket.removeAllListeners()}_cleanupPeer(t){const r=this._connections.get(t);if(r)for(const i of r)i.close()}disconnect(){if(this.disconnected)return;const t=this.id;qe.log(`Disconnect peer with ID:${t}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}reconnect(){if(this.disconnected&&!this.destroyed)qe.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)qe.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(t=r=>{}){this._api.listAllPeers().then(r=>t(r)).catch(r=>this._abort(It.ServerError,r))}};Cf=new WeakMap,Ga(lo,Cf,lo.DEFAULT_KEY="peerjs");let yf=lo;var mA=yf,Ld={exports:{}},zd,pA;function w3(){if(pA)return zd;pA=1;var s="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return zd=s,zd}var Ud,gA;function k3(){if(gA)return Ud;gA=1;var s=w3();function t(){}function r(){}return r.resetWarningCache=t,Ud=function(){function i(f,m,v,x,A,S){if(S!==s){var j=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw j.name="Invariant Violation",j}}i.isRequired=i;function c(){return i}var u={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:c,element:i,elementType:i,instanceOf:c,node:i,objectOf:c,oneOf:c,oneOfType:c,shape:c,exact:c,checkPropTypes:r,resetWarningCache:t};return u.PropTypes=u,u},Ud}var AA;function C3(){return AA||(AA=1,Ld.exports=k3()()),Ld.exports}var j3=C3();const Ae=jf(j3),z1={ringtone:"/sounds/ringtone.mp3",callEnd:"/sounds/call-end.mp3",callConnect:"/sounds/call-connect.mp3"},_3=.15,vf=s=>{s&&s.state==="suspended"&&s.resume().catch(t=>console.warn("AudioContext resume failed:",t))},E3=(s,t,r,i)=>{if(!s)return console.warn("Cannot play synthetic sound: No AudioContext."),null;vf(s);let c,u,f=null,m=!1;const v=()=>{m=!0,f&&clearTimeout(f);try{c&&c.stop()}catch{}},x=(A=s.currentTime)=>{if(!m)try{c=s.createOscillator(),u=s.createGain(),c.connect(u),u.connect(s.destination),u.gain.setValueAtTime(_3*r,A);let S=440,j=.2;t==="ringtone"?(S=440,j=.2):t==="callEnd"?(S=220,j=.5):t==="callConnect"&&(S=660,j=.3),c.type="sine",c.frequency.setValueAtTime(S,A),c.start(A),c.stop(A+j),c.onended=()=>{t==="ringtone"&&i&&!m&&(f=setTimeout(()=>x(),1e3-j*1e3))}}catch(S){console.warn(`Web Audio API fallback failed for ${t}:`,S)}};return x(),i&&t==="ringtone"?v:null},Gl=({isPlaying:s=!1,sound:t="ringtone",loop:r=!0,volume:i=.7})=>{const c=y.useRef(null),u=y.useRef(null),f=y.useRef(null),m=y.useRef(null),[v,x]=y.useState(!1),A=z1[t]||null;return y.useEffect(()=>{const S=()=>{x(!0),u.current&&vf(u.current);try{const j=new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABIgD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==");j.volume=0,j.play().catch(()=>{})}catch{}document.removeEventListener("click",S),document.removeEventListener("touchstart",S)};return document.addEventListener("click",S),document.addEventListener("touchstart",S),()=>{document.removeEventListener("click",S),document.removeEventListener("touchstart",S)}},[]),y.useEffect(()=>{if(c.current||(c.current=new Audio,c.current.addEventListener("error",S=>{var C;const j=(C=S.target)==null?void 0:C.error;console.error("Audio Element Error:",(j==null?void 0:j.message)||"Unknown error","Code:",j==null?void 0:j.code,S)})),!u.current)try{u.current=new(window.AudioContext||window.webkitAudioContext)}catch(S){console.error("Failed to create AudioContext:",S)}return()=>{if(c.current)try{c.current.pause(),c.current.removeAttribute("src"),c.current.load()}catch(S){console.warn("Error cleaning up audio element:",S)}}},[]),y.useEffect(()=>{const S=c.current,j=u.current;if(!S)return;if(s&&!A){console.warn(`Attempted to play sound "${t}" but no valid URL found.`);return}m.current&&(m.current(),m.current=null),S.loop=r,S.volume=Math.max(0,Math.min(1,i));const C=S.currentSrc||S.src,M=A?new URL(A,window.location.origin).href:"";if(A&&C!==M?(console.log(`[CallSounds] Setting source to: ${A}`),S.src=A,S.load()):!A&&C&&(S.removeAttribute("src"),S.load()),s&&A)v?(()=>{!c.current||!s||(vf(j),f.current=S.play(),f.current&&f.current.then(()=>{console.log(`[CallSounds] Playback started for ${t}`)}).catch(D=>{console.warn(`[CallSounds] HTML Audio play failed for ${t}:`,D.name,D.message),D.name!=="AbortError"&&(console.log(`[CallSounds] Falling back to synthetic sound for ${t}`),m.current=E3(j,t,i,r)),D.name==="NotAllowedError"&&!v&&console.warn("[CallSounds] Playback prevented by browser policy. Requires user interaction.")}))})():console.log("[CallSounds] Waiting for user interaction to play sound.");else{const U=()=>{S&&!S.paused&&(S.pause(),console.log(`[CallSounds] Paused audio for ${t}`)),m.current&&(m.current(),m.current=null)};f.current?(f.current.then(U).catch(U),f.current=null):U()}return()=>{console.log(`[CallSounds] Cleaning up effect for sound: ${t}, isPlaying: ${s}`),m.current&&(m.current(),m.current=null)}},[s,t,r,i,A,v]),null};Gl.propTypes={isPlaying:Ae.bool,sound:Ae.oneOf(Object.keys(z1)),loop:Ae.bool,volume:Ae.number};const N3=1e3,yA=2e4,T3=5e3,vA=2e3,R3=3e3,M3=45045,bA={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:["turn:openrelay.metered.ca:80","turn:openrelay.metered.ca:443","turn:openrelay.metered.ca:80?transport=tcp","turn:openrelay.metered.ca:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"}]},xA=(s,t,r)=>{if(!s)return;(t==="audio"?s.getAudioTracks():s.getVideoTracks()).forEach(c=>{c.enabled=r})},O3=s=>{s&&s.getTracks().forEach(t=>{try{t.stop()}catch{}})},D3=s=>{const t=Math.floor(s/60),r=s%60;return`${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},U1=({isInitiator:s=!1,remoteUserId:t,remoteUserName:r,onClose:i,socket:c,onError:u})=>{const[f,m]=y.useState(null),[v,x]=y.useState(r||"User"),[A,S]=y.useState("initializing"),[j,C]=y.useState(0),[M,U]=y.useState(!1),[D,ne]=y.useState(!1),[K,te]=y.useState(!1),[B,L]=y.useState(!1),[I,E]=y.useState(!1),[T,z]=y.useState(null),[W,H]=y.useState(0),[q,re]=y.useState({ringtone:s,callConnect:!1,callEnd:!1}),[pe,ce]=y.useState(!1),{user:R}=Ot(),Q=y.useRef(null),Y=y.useRef(null),P=y.useRef(null),ie=y.useRef(null),J=y.useRef(null),ze=y.useRef(null),de=y.useRef(null),Z=y.useRef(!1),Te=y.useRef(!1),je=y.useRef(null),Fe=y.useRef(null),Me=y.useRef(null),Ue=y.useRef(!1),Le=y.useRef(null),he=y.useRef(null),ye=y.useRef(!1);y.useEffect(()=>{try{he.current||(he.current=new(window.AudioContext||window.webkitAudioContext));const ue=()=>{he.current&&he.current.state==="suspended"&&he.current.resume()};return document.addEventListener("click",ue),document.addEventListener("touchstart",ue),()=>{document.removeEventListener("click",ue),document.removeEventListener("touchstart",ue)}}catch(ue){console.warn("Web Audio API initialization failed:",ue)}},[]),y.useEffect(()=>{if(q.callEnd)return Le.current&&clearTimeout(Le.current),Le.current=setTimeout(()=>{re(ue=>({...ue,callEnd:!1}))},3e3),()=>{Le.current&&clearTimeout(Le.current)}},[q.callEnd]),y.useEffect(()=>{if(Ue.current)return;if(!R||!R._id||!t){S("error"),u&&u(new Error("Missing required user information for video call"));return}if(!c){S("error"),u&&u(new Error("Socket connection required for video calls"));return}Me.current=setTimeout(()=>{if(A!=="connected"&&(S("error"),u&&u(new Error("Call setup timed out. Please try again later.")),J.current)){try{J.current.close()}catch{}J.current=null}},M3),Ne(),ye.current=!1,Ue.current=!0,ze.current=setInterval(()=>{C(Re=>Re+1)},1e3);const ue=()=>{};return document.addEventListener("click",ue),document.addEventListener("touchstart",ue),()=>{Ge(),ze.current&&clearInterval(ze.current),je.current&&clearTimeout(je.current),Fe.current&&clearTimeout(Fe.current),Me.current&&clearTimeout(Me.current),Le.current&&clearTimeout(Le.current),document.removeEventListener("click",ue),document.removeEventListener("touchstart",ue)}},[]);const G=y.useCallback(ue=>{ue.userId===t&&(ue.type==="audio"?L(ue.muted):ue.type==="video"&&E(ue.muted))},[t]),oe=y.useCallback(ue=>{Te.current||ue.userId===t&&(Te.current=!0,re({ringtone:!1,callConnect:!1,callEnd:!0}),X.info(`${v} ended the call`),setTimeout(()=>{i&&i()},vA))},[t,v,i]),be=y.useCallback(ue=>{var se;if(je.current&&(clearTimeout(je.current),je.current=null),T||(((se=ue.from)==null?void 0:se.userId)||ue.userId)!==t)return;const De=ue.peerId;De&&(z(De),Te.current=!1,s?(re({ringtone:!0,callConnect:!1,callEnd:!1}),setTimeout(()=>{if(P.current&&P.current.disconnected&&P.current.reconnect(),!J.current&&P.current){if(!ie.current){u&&u(new Error("Local stream not available"));return}try{const Ee=P.current.call(De,ie.current);if(!Ee){u&&u(new Error("Failed to create peer connection"));return}J.current=Ee,_e(Ee),je.current&&clearTimeout(je.current),je.current=setTimeout(()=>{A!=="connected"&&(J.current&&(J.current.close(),J.current=null),W<3?(H(Ke=>Ke+1),setTimeout(()=>{be(ue)},1e3)):(S("error"),u&&u(new Error("Failed to establish connection after multiple attempts"))))},yA)}catch(Ee){u&&u(Ee)}}},N3)):(re({ringtone:!0,callConnect:!1,callEnd:!1}),je.current&&clearTimeout(je.current),je.current=setTimeout(()=>{A!=="connected"&&(S("error"),u&&u(new Error("Timed out waiting for incoming call")))},yA)))},[s,u,t,T,A,W]);y.useEffect(()=>{if(c)return c.off("videoMediaControl"),c.off("videoHangup"),c.off("peerIdExchange"),c.on("videoMediaControl",G),c.on("videoHangup",oe),c.on("peerIdExchange",be),()=>{c.off("videoMediaControl",G),c.off("videoHangup",oe),c.off("peerIdExchange",be)}},[c,G,oe,be]);const Ne=async()=>{try{if(!c){S("error"),u&&u(new Error("Socket connection required for video calls"));return}if(Z.current=!0,P.current)return;try{const De=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:24}},audio:!0});ie.current=De,m(De),Q.current&&(Q.current.srcObject=De)}catch{try{const se=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});ie.current=se,m(se),ne(!0),Q.current&&(Q.current.srcObject=se)}catch(se){throw se}}ye.current=!1;const ue=`${R._id}-${Date.now()}-${Math.floor(Math.random()*1e6)}`,Re=new mA(ue,{debug:2,config:{iceServers:bA.iceServers,sdpSemantics:"unified-plan"},host:window.location.hostname,port:9e3,path:"/peerjs",secure:window.location.protocol==="https:"});P.current=Re,Re.on("open",De=>{S("connecting"),c?c.emit("peerIdExchange",{recipientId:t,peerId:De,from:{userId:R._id,name:R.nickname||"User"}}):(S("error"),u&&u(new Error("Socket connection not available for signaling")))}),Re.on("connect_error",De=>{Z.current=!1,S("error"),u&&u(new Error(`Connection error: ${De.message}`))}),Re.on("error",De=>{X.error(`Connection error: ${De.type}`),S("error"),u&&u(De)}),Re.on("disconnected",()=>{A==="connected"&&!Te.current&&P.current&&setTimeout(()=>{try{P.current.reconnect()}catch{S("error")}},1e3)}),Re.on("reconnect",De=>{if(!(J.current&&J.current.open)){if(T&&s)try{const se=P.current.call(T,ie.current);se&&(J.current=se,_e(se))}catch{}}}),Re.on("close",()=>{Te.current||S("disconnected")}),Re.on("call",De=>{J.current||(je.current&&(clearTimeout(je.current),je.current=null),J.current=De,Te.current=!1,De.answer(ie.current),_e(De),re({ringtone:!1,callConnect:!0,callEnd:!1}))})}catch(ue){X.error(ue.message||"Couldn't access camera or microphone"),S("error"),u&&u(ue)}finally{setTimeout(()=>{Z.current=!1},T3)}},_e=ue=>{ue&&(ue.on("stream",Re=>{if(Z.current=!1,je.current&&(clearTimeout(je.current),je.current=null),Me.current&&(clearTimeout(Me.current),Me.current=null),Y.current){Y.current.srcObject=Re;const De=Y.current.play();De!==void 0&&De.catch(()=>{const se=()=>{Y.current.play().catch(()=>{}),document.removeEventListener("click",se)};document.addEventListener("click",se,{once:!0})}),setTimeout(()=>{Re.active&&re(se=>({...se,ringtone:!1,callConnect:!0}))},500)}S("connected"),X.success(`Connected to ${v}`)}),ue.on("close",()=>{S("disconnected"),Z.current=!1,Te.current||re({ringtone:!1,callConnect:!1,callEnd:!0})}),ue.on("error",Re=>{S("error"),Z.current=!1,u&&u(Re)}))},Ge=()=>{if(Z.current=!1,re({ringtone:!1,callConnect:!1,callEnd:!1}),je.current&&(clearTimeout(je.current),je.current=null),Fe.current&&(clearTimeout(Fe.current),Fe.current=null),Me.current&&(clearTimeout(Me.current),Me.current=null),J.current){try{J.current.close()}catch{}J.current=null}if(ie.current&&(O3(ie.current),ie.current=null),P.current){try{P.current.destroy()}catch{}P.current=null}S("disconnected"),ze.current&&(clearInterval(ze.current),ze.current=null)},bt=()=>{if(!pe){if(ce(!0),re({ringtone:!1,callConnect:!1,callEnd:!0}),c&&t)try{c.emit("videoHangup",{recipientId:t,userId:R._id,timestamp:Date.now()})}catch{}setTimeout(()=>{Ge(),i&&i()},vA)}},ut=()=>{if(ie.current)try{xA(ie.current,"audio",M),U(!M),c&&c.emit("videoMediaControl",{recipientId:t,type:"audio",muted:!M,userId:R._id})}catch{X.error("Failed to change audio state")}},St=()=>{if(ie.current)try{xA(ie.current,"video",D),ne(!D),c&&c.emit("videoMediaControl",{recipientId:t,type:"video",muted:!D,userId:R._id})}catch{X.error("Failed to change video state")}},Nt=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen().then(()=>{te(!1)}).catch(()=>{X.error("Failed to exit fullscreen mode")}):de.current&&de.current.requestFullscreen?de.current.requestFullscreen().then(()=>{te(!0)}).catch(()=>{X.error("Failed to enter fullscreen mode")}):X.warning("Fullscreen not supported in your browser")},Mt=()=>{if(H(ue=>ue+1),J.current&&(J.current.close(),J.current=null),P.current&&P.current.disconnected&&P.current.reconnect(),W>=2){if(P.current){try{P.current.destroy()}catch{}P.current=null}const ue=`${R._id}-fallback-${Date.now()}`,Re=new mA(ue,{debug:3,config:{iceServers:bA.iceServers,iceTransportPolicy:"relay",iceCandidatePoolSize:15},secure:window.location.protocol==="https:",host:window.location.hostname,port:9e3,path:"/peerjs"});P.current=Re,Re.on("open",De=>{S("connecting"),c.emit("peerIdExchange",{recipientId:t,peerId:De,from:{userId:R._id,name:R.nickname||"User"},isFallback:!0})}),Re.on("error",De=>{S("error"),u&&u(De)}),Re.on("call",De=>{J.current=De,De.answer(ie.current),_e(De)});return}s&&T&&ie.current&&P.current&&(S("connecting"),setTimeout(()=>{try{const ue=P.current.call(T,ie.current);if(!ue)return;J.current=ue,_e(ue)}catch{}},1e3))};return y.useEffect(()=>{const ue=()=>{te(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",ue),()=>{document.removeEventListener("fullscreenchange",ue)}},[]),y.useEffect(()=>{A==="error"&&T&&P.current&&(Fe.current&&clearTimeout(Fe.current),Fe.current=setTimeout(()=>{try{if(P.current&&P.current.disconnected&&P.current.reconnect(),s&&ie.current&&T&&W<3){H(Re=>Re+1),S("connecting");const ue=P.current.call(T,ie.current);ue&&(J.current=ue,_e(ue))}}catch{}},R3))},[A,T,s,W]),o.jsxs("div",{className:"video-call-container",ref:de,children:[q.ringtone&&o.jsx(Gl,{isPlaying:!0,sound:"ringtone",loop:!0,volume:1}),q.callConnect&&o.jsx(Gl,{isPlaying:!0,sound:"callConnect",loop:!1,volume:1}),q.callEnd&&o.jsx(Gl,{isPlaying:!0,sound:"callEnd",loop:!1,volume:1}),o.jsxs("div",{className:"video-call-header",children:[o.jsxs("div",{className:"call-status",children:[A==="initializing"&&"Initializing...",A==="connecting"&&"Connecting...",A==="connected"&&"Connected",A==="error"&&"Connection Error",A==="disconnected"&&"Disconnected"]}),o.jsx("div",{className:"call-timer",children:D3(j)})]}),o.jsxs("div",{className:"videos-container",children:[o.jsxs("div",{className:"remote-video-container",children:[I&&o.jsxs("div",{className:"video-off-indicator",children:[o.jsx(sA,{}),o.jsx("span",{children:"Video Off"})]}),B&&o.jsx("div",{className:"audio-muted-indicator",children:o.jsx(tA,{})}),o.jsx("video",{ref:Y,className:"remote-video",autoPlay:!0,playsInline:!0}),o.jsx("div",{className:"remote-user-name",children:v})]}),o.jsxs("div",{className:"local-video-container",children:[o.jsx("video",{ref:Q,className:"local-video",autoPlay:!0,playsInline:!0,muted:!0}),o.jsx("div",{className:"local-user-name",children:(R==null?void 0:R.nickname)||"You"})]})]}),o.jsxs("div",{className:"call-controls",children:[o.jsx("button",{className:`control-btn ${M?"muted":""}`,onClick:ut,title:M?"Unmute Microphone":"Mute Microphone",children:M?o.jsx(tA,{}):o.jsx(_4,{})}),o.jsx("button",{className:`control-btn ${D?"muted":""}`,onClick:St,title:D?"Turn On Camera":"Turn Off Camera",children:D?o.jsx(sA,{}):o.jsx(Jr,{})}),o.jsx("button",{className:"control-btn hangup-btn",onClick:bt,title:"End Call",children:o.jsx(P0,{})}),o.jsx("button",{className:`control-btn ${K?"active":""}`,onClick:Nt,title:K?"Exit Fullscreen":"Enter Fullscreen",children:K?o.jsx(v4,{}):o.jsx(k4,{})})]}),o.jsxs("div",{className:"connection-status",children:[A==="initializing"&&o.jsxs("div",{className:"connecting-spinner",children:[o.jsx("div",{className:"spinner"}),o.jsx("span",{children:"Initializing your camera and microphone..."})]}),A==="connecting"&&o.jsxs("div",{className:"connecting-spinner",children:[o.jsx("div",{className:"spinner"}),o.jsxs("span",{children:["Connecting to ",v,"..."]})]}),A==="error"&&o.jsxs("div",{className:"connection-error",children:[o.jsx("span",{children:"Connection failed. Please try again."}),o.jsxs("button",{onClick:Mt,className:"retry-btn",children:[o.jsx(Wl,{})," Retry"]})]})]})]})},Nl=Rt.create("Avatar"),ei=({src:s,alt:t,size:r="medium",status:i=null,className:c="",onClick:u,online:f=!1,placeholder:m="/default-avatar1.png",statusPosition:v="bottom-right",showFallback:x=!0})=>{const[A,S]=Gr.useState(s),[j,C]=Gr.useState(!1),[M,U]=Gr.useState(""),D=Gr.useRef(new Map),ne=`${window.location.origin}/default-avatar1.png`;Gr.useEffect(()=>{if(s!==A||!s&&!j){if(s&&D.current.has(s)){const I=D.current.get(s);if(I.error){S(I.fallback),C(!0);return}}if(s&&typeof s=="string"&&s.includes("unsplash.com")){S(ne),C(!0);return}S(s||ne),C(!1),s&&typeof s=="string"&&/^[0-9a-f]{24}$/i.test(s)&&Nl.debug(`Avatar for user ID: ${s}`)}},[s,ne,A,j]);const K=I=>{const E=I.target.src;if(U(`Failed to load image: ${E}`),E.includes("unsplash.com")||Nl.error(`Image failed to load: ${E}`,{originalSrc:s}),!j&&x){const T=ne;s&&(D.current.set(s,{error:!0,fallback:T}),E&&Df(E)),S(T),C(!0)}};let te;try{A&&typeof A=="string"&&/^[0-9a-f]{24}$/i.test(A)?(te=`${window.location.origin}/api/avatars/${A}`,Nl.debug(`Using direct avatar API path: ${te}`)):te=Zi(A)}catch(I){Nl.error(`Error normalizing URL: ${I.message}`,{src:A}),te=ne}const B={tiny:"avatar-xs",small:"avatar-sm",medium:"avatar-md",large:"avatar-lg",xlarge:"avatar-xl"},L={backgroundImage:`url(${te})`,backgroundSize:"cover",backgroundPosition:"center"};return o.jsxs("div",{className:`avatar ${B[r]||""} ${f?"avatar-online":""} ${c}`,onClick:u,style:L,role:u?"button":void 0,tabIndex:u?0:void 0,"data-debug":M,children:[o.jsx("img",{src:te,alt:t,onError:K,style:{display:"none"},crossOrigin:"anonymous"}),i&&o.jsx("span",{className:`avatar-status status-${i} status-${v}`})]})};ei.propTypes={src:Ae.string,alt:Ae.string,size:Ae.oneOf(["tiny","small","medium","large","xlarge"]),status:Ae.oneOf([null,"online","offline","busy","away"]),className:Ae.string,onClick:Ae.func,online:Ae.bool,placeholder:Ae.string,statusPosition:Ae.oneOf(["top-right","top-left","bottom-right","bottom-left"]),showFallback:Ae.bool};const xt=({children:s,onClick:t,type:r="button",variant:i="primary",size:c="medium",className:u="",disabled:f=!1,fullWidth:m=!1,icon:v,iconPosition:x="left",isLoading:A=!1,loadingText:S="Loading...",...j})=>{const C=`btn btn-${i} btn-${c} ${m?"btn-full-width":""}`,M=v?`btn-with-icon icon-${x}`:"",U=A?"btn-loading":"";return o.jsx("button",{type:r,className:`${C} ${M} ${U} ${u}`,onClick:t,disabled:f||A,...j,children:A?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"loading-spinner"}),S]}):o.jsxs(o.Fragment,{children:[v&&x==="left"&&o.jsx("span",{className:"btn-icon",children:v}),o.jsx("span",{className:"btn-text",children:s}),v&&x==="right"&&o.jsx("span",{className:"btn-icon",children:v})]})})};xt.propTypes={children:Ae.node.isRequired,onClick:Ae.func,type:Ae.oneOf(["button","submit","reset"]),variant:Ae.oneOf(["primary","secondary","success","danger","warning","info","light","dark","link"]),size:Ae.oneOf(["small","medium","large"]),className:Ae.string,disabled:Ae.bool,fullWidth:Ae.bool,icon:Ae.node,iconPosition:Ae.oneOf(["left","right"]),isLoading:Ae.bool,loadingText:Ae.string};const B1=({children:s,title:t,subtitle:r,className:i="",headerClassName:c="",bodyClassName:u="",footerClassName:f="",footer:m,noPadding:v=!1,onClick:x,hover:A=!1})=>o.jsxs("div",{className:`card ${A?"hover-effect":""} ${i}`,onClick:x,role:x?"button":void 0,tabIndex:x?0:void 0,children:[(t||r)&&o.jsxs("div",{className:`card-header ${c}`,children:[t&&o.jsx("h3",{className:"card-title",children:t}),r&&o.jsx("p",{className:"card-subtitle",children:r})]}),o.jsx("div",{className:`card-body ${v?"no-padding":""} ${u}`,children:s}),m&&o.jsx("div",{className:`card-footer ${f}`,children:m})]});B1.propTypes={children:Ae.node.isRequired,title:Ae.node,subtitle:Ae.node,className:Ae.string,headerClassName:Ae.string,bodyClassName:Ae.string,footerClassName:Ae.string,footer:Ae.node,noPadding:Ae.bool,onClick:Ae.func,hover:Ae.bool};const hc=({message:s,title:t="Error",type:r="error",onDismiss:i,showIcon:c=!0,className:u="",style:f={}})=>{if(!s)return null;const m=s instanceof Error?s.message:s,v={error:"error-message--error",warning:"error-message--warning",info:"error-message--info"},x={error:o.jsx(B4,{}),warning:o.jsx(Ut,{}),info:o.jsx(Ut,{})};return o.jsxs("div",{className:`error-message ${v[r]||""} ${u}`,style:f,children:[o.jsxs("div",{className:"error-message__content",children:[c&&o.jsx("div",{className:"error-message__icon",children:x[r]}),o.jsxs("div",{className:"error-message__text",children:[t&&o.jsx("h4",{className:"error-message__title",children:t}),o.jsx("p",{className:"error-message__description",children:m})]})]}),i&&o.jsx("button",{className:"error-message__close",onClick:i,"aria-label":"Dismiss error",children:""})]})};hc.propTypes={message:Ae.oneOfType([Ae.string,Ae.object]).isRequired,title:Ae.string,type:Ae.oneOf(["error","warning","info"]),onDismiss:Ae.func,showIcon:Ae.bool,className:Ae.string,style:Ae.object};Ae.string,Ae.node,Ae.node,Ae.node.isRequired,Ae.bool,Ae.node,Ae.string,Ae.string,Ae.string,Ae.bool,Ae.oneOf(["top","left","right"]);const mc=({size:s="medium",color:t="primary",centered:r=!1,fullPage:i=!1,text:c="",className:u="",overlay:f=!1})=>{const m=s==="small"?"spinner-sm":s==="large"?"spinner-lg":"",v=`spinner-${t}`,x=`spinner-container 
    ${r?"centered":""} 
    ${i?"full-page":""} 
    ${f?"with-overlay":""} 
    ${u}`;return o.jsxs("div",{className:x,children:[f&&o.jsx("div",{className:"spinner-overlay"}),o.jsxs("div",{className:`spinner ${m} ${v}`,children:[o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"}),o.jsx("div",{className:"spinner-blade"})]}),c&&o.jsx("p",{className:"spinner-text",children:c})]})};mc.propTypes={size:Ae.oneOf(["small","medium","large"]),color:Ae.oneOf(["primary","secondary","light","dark"]),centered:Ae.bool,fullPage:Ae.bool,text:Ae.string,className:Ae.string,overlay:Ae.bool};const P1=({isLoading:s=!0,error:t=null,children:r=null,loadingText:i="Loading...",errorText:c="An error occurred",size:u="medium",spinnerProps:f={},onRetry:m=null,showSpinnerWhenLoading:v=!0,showChildrenAfterLoad:x=!0,className:A="",renderError:S=null})=>t?S?S(t,m):o.jsxs("div",{className:`loading-state loading-state--error ${A}`,children:[o.jsx("p",{className:"loading-state__error",children:c||t.message||t}),m&&o.jsx("button",{className:"loading-state__retry-button",onClick:m,children:"Try Again"})]}):s&&v?o.jsx("div",{className:`loading-state loading-state--loading ${A}`,children:o.jsx(mc,{text:i,size:u,...f})}):!s||x?r:null;P1.propTypes={isLoading:Ae.bool,error:Ae.oneOfType([Ae.string,Ae.object]),children:Ae.node,loadingText:Ae.string,errorText:Ae.string,size:Ae.oneOf(["small","medium","large"]),spinnerProps:Ae.object,onRetry:Ae.func,showSpinnerWhenLoading:Ae.bool,showChildrenAfterLoad:Ae.bool,className:Ae.string,renderError:Ae.func};const yo=(s={})=>{const[t,r]=y.useState(!1),[i,c]=y.useState(null),[u,f]=y.useState(null),m=y.useRef({}),v=y.useCallback(()=>{Object.values(m.current).forEach(K=>{typeof K=="function"&&K()}),m.current={}},[]),x=y.useCallback(async(K,te={})=>{const{onSuccess:B,onError:L,key:I="default"}=te;r(!0),c(null);try{const E=await K();if(!E)return s.logErrors!==!1&&console.warn("API response is null or undefined"),delete m.current[I],null;if(!E.success)throw new Error(E.error||"API request failed");return E.data!==void 0&&f(E.data),delete m.current[I],B&&B(E.data),E.data}catch(E){const T=E.error||E.message||"An error occurred";return c(T),delete m.current[I],L&&L(T),s.logErrors!==!1&&console.error(`API error: ${T}`),null}finally{r(!1)}},[s.logErrors]),A=(K={})=>{const te={...K};if(!te.Authorization&&!te["x-auth-token"]){const B=localStorage.getItem("token")||sessionStorage.getItem("token")||localStorage.getItem("authToken")||sessionStorage.getItem("authToken");B&&(te.Authorization=`Bearer ${B}`,te["x-auth-token"]=B)}return te},S=y.useCallback((K,te,B={})=>{const L=B.key||K;m.current[L]&&s.cancelDuplicates&&m.current[L]();const{request:I,cancel:E}=Pe.createCancelableRequest();return m.current[L]=E,x(()=>{const T=A();return Pe.get(K,te,{request:I,headers:T})},{...B,key:L})},[x,s.cancelDuplicates]),j=y.useCallback((K,te,B={})=>{const L=B.key||K;m.current[L]&&s.cancelDuplicates&&m.current[L]();const{request:I,cancel:E}=Pe.createCancelableRequest();return m.current[L]=E,x(()=>{const T=A();return Pe.post(K,te,{request:I,headers:T})},{...B,key:L})},[x,s.cancelDuplicates]),C=y.useCallback((K,te,B={})=>{const L=B.key||K;m.current[L]&&s.cancelDuplicates&&m.current[L]();const{request:I,cancel:E}=Pe.createCancelableRequest();return m.current[L]=E,x(()=>{const T=A();return Pe.put(K,te,{request:I,headers:T})},{...B,key:L})},[x,s.cancelDuplicates]),M=y.useCallback((K,te,B={})=>{const L=B.key||K;m.current[L]&&s.cancelDuplicates&&m.current[L]();const{request:I,cancel:E}=Pe.createCancelableRequest();return m.current[L]=E,x(()=>{const T=A();return Pe.delete(K,te,{request:I,headers:T})},{...B,key:L})},[x,s.cancelDuplicates]),U=y.useCallback((K,te,B,L={})=>{const I=L.key||K;m.current[I]&&s.cancelDuplicates&&m.current[I]();const{request:E,cancel:T}=Pe.createCancelableRequest();return m.current[I]=T,x(()=>Pe.upload(K,te,B,{request:E}),{...L,key:I})},[x,s.cancelDuplicates]),D=y.useCallback(()=>{c(null)},[]),ne=y.useCallback(()=>{r(!1),c(null),f(null)},[]);return{loading:t,error:i,data:u,get:S,post:j,put:C,delete:M,upload:U,clearError:D,reset:ne,cancelAllRequests:v}},L3=(s={})=>{const[t,r]=y.useState(Se.isConnected()),[i,c]=y.useState(null),[u,f]=y.useState(!1),m=y.useRef(new Map);y.useEffect(()=>{const{userId:C,token:M,autoConnect:U=!0}=s,D=U&&C&&M,ne=Se.isConnected();ne!==t&&r(ne),D&&!ne&&v(C,M);const K=()=>{r(!0),c(null),f(!1),console.log("Socket connected successfully")},te=z=>{r(!1),f(!1),console.log(`Socket disconnected: ${z}`),z==="io server disconnect"?c("Server disconnected the socket"):(z==="transport close"||z==="transport error")&&console.log("Network disconnect - will auto-reconnect")},B=z=>{const W=(z==null?void 0:z.message)||"Connection error";console.error(`Socket error: ${W}`),c(W),f(!1)},L=Se.on("connect",K),I=Se.on("disconnect",te),E=Se.on("error",B),T=Se.on("connect_error",z=>{var W,H;console.error(`Socket connect error: ${z==null?void 0:z.message}`),f(!1),(W=z==null?void 0:z.message)!=null&&W.includes("auth")||(H=z==null?void 0:z.message)!=null&&H.includes("token")?console.log("Auth error in socket - will retry"):c(`Connect error: ${z==null?void 0:z.message}`)});return()=>{L(),I(),E(),T(),m.current.forEach(z=>{typeof z=="function"&&z()}),m.current.clear()}},[s.userId,s.token,s.autoConnect]);const v=y.useCallback(async(C,M)=>{if(Se.isConnected())return!0;if(u)return!1;f(!0),c(null);try{return await Se.init(C,M),r(!0),f(!1),!0}catch(U){return c(U.message||"Failed to connect to socket server"),f(!1),r(!1),!1}},[u]),x=y.useCallback((C,M)=>{const U=Se.on(C,M);return m.current.set(`${C}:${M.toString().slice(0,20)}`,U),U},[]),A=y.useCallback((C,M)=>{const U=`${C}:${M.toString().slice(0,20)}`;m.current.has(U)&&(m.current.get(U)(),m.current.delete(U))},[]),S=y.useCallback((C,M,U)=>{if(!Se.isConnected()){if(s.autoReconnect){const{userId:D,token:ne}=s;D&&ne&&v(D,ne)}return!1}return Se.emit(C,M,U)},[s.autoReconnect,s.userId,s.token,v]),j=(C,M,U=[])=>{y.useEffect(()=>x(C,M),[C,...U])};return{connected:t,connectionError:i,isConnecting:u,connect:v,reconnect:Se.reconnect,disconnect:Se.disconnect,on:x,off:A,emit:S,useSocketEvent:j,getStatus:Se.getStatus}},Xl={getUserSettings:async()=>{try{console.log("Fetching user settings from /auth/me endpoint");const s=await Pe.get("/auth/me");if(s.success&&s.data){const t=s.data.settings||{notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0},privacy:{showOnlineStatus:!0,showReadReceipts:!0,showLastSeen:!0,allowStoryReplies:"everyone"}};return console.log("Successfully fetched user settings from /auth/me:",t),{success:!0,data:t}}else return console.error("API returned unsuccessful response:",s),{success:!1,error:s.error||"Failed to fetch settings",data:null}}catch(s){return console.error("Error fetching user settings:",s),{success:!1,error:s.message||"Failed to fetch settings",data:null}}},updateSettings:async s=>{try{console.log("Updating settings via /users/profile endpoint",s);const t=await Pe.put("/users/profile",{settings:s});return console.log("Settings update API response:",t),t.success?{success:!0,data:s}:(console.error("API returned unsuccessful settings update response:",t),{success:!1,error:t.error||"Failed to update settings",data:null})}catch(t){return console.error("Error updating settings:",t),{success:!1,error:t.message||"Failed to update settings",data:null}}},updateNotificationSettings:async s=>{try{console.log("Updating notification settings via /users/profile endpoint",s);const t=await Pe.put("/users/profile",{settings:{notifications:s}});return console.log("Notification settings update API response:",t),t.success?{success:!0,data:{notifications:s}}:(console.error("API returned unsuccessful notification settings update response:",t),{success:!1,error:t.error||"Failed to update notification settings",data:null})}catch(t){return console.error("Error updating notification settings:",t),{success:!1,error:t.message||"Failed to update notification settings",data:null}}},updatePrivacySettings:async s=>{try{console.log("Updating privacy settings via /users/profile endpoint",s);const t=await Pe.put("/users/profile",{settings:{privacy:s}});return console.log("Privacy settings update API response:",t),t.success?{success:!0,data:{privacy:s}}:(console.error("API returned unsuccessful privacy settings update response:",t),{success:!1,error:t.error||"Failed to update privacy settings",data:null})}catch(t){return console.error("Error updating privacy settings:",t),{success:!1,error:t.message||"Failed to update privacy settings",data:null}}},deleteAccount:async s=>{try{return(await Pe.delete("/users/account",{data:{password:s}})).data}catch(t){throw console.error("Error deleting account:",t),t}}},z3=Object.freeze(Object.defineProperty({__proto__:null,default:Xl},Symbol.toStringTag,{value:"Module"})),Vt=Rt.create("useChatMessages"),U3=s=>{const{user:t,isAuthenticated:r}=Ot(),i=yo(),c=L3(),[u,f]=y.useState([]),[m,v]=y.useState(!0),[x,A]=y.useState(null),[S,j]=y.useState(!0),[C,M]=y.useState(1),[U,D]=y.useState(!1),[ne,K]=y.useState(!1),te=y.useRef(u),B=y.useRef(C),L=y.useRef(S),I=y.useRef(!0),E=y.useRef([]),T=y.useRef(null),z=y.useRef(0),W=3;y.useEffect(()=>{te.current=u},[u]),y.useEffect(()=>{B.current=C},[C]),y.useEffect(()=>{L.current=S},[S]),y.useEffect(()=>()=>{I.current=!1,T.current&&clearTimeout(T.current),E.current.forEach(pe=>{pe&&typeof pe=="function"&&pe()})},[]);const H=y.useCallback(async(pe=!1)=>{if(!s||!r){Vt.debug("Missing recipientId or not authenticated, skipping message load"),v(!1);return}if(m&&!pe){Vt.debug("Already loading messages, skipping duplicate fetch");return}if(!(t!=null&&t._id)){Vt.error("User ID is undefined or invalid"),A("User authentication issue. Please try logging out and back in."),v(!1);return}v(!0),A(null);try{Vt.info(`Loading messages with ${s}, page ${B.current}`);const ce=await i.get(`/messages/${s}`,{page:1,limit:20});if(!ce||!ce.success)throw new Error((ce==null?void 0:ce.error)||"Failed to load messages");const R=ce.data||[];return Vt.info(`Loaded ${R.length} messages`),I.current?(f(R),j(R.length===20),M(1),v(!1),z.current=0,R):void 0}catch(ce){if(Vt.error("Error loading messages:",ce),!I.current)return;if(A(ce.message||"Failed to load messages"),v(!1),z.current<W){const R=Math.min(2e3*Math.pow(2,z.current),1e4);Vt.debug(`Will retry in ${R/1e3} seconds (attempt ${z.current+1})`),T.current=setTimeout(()=>{I.current&&(z.current+=1,H(!0))},R)}return[]}},[s,r,t,i,m]),q=y.useCallback(async()=>{if(!(!s||!r||ne||!L.current)){K(!0);try{const pe=B.current+1;Vt.debug(`Loading more messages, page ${pe}`);const ce=await i.get(`/messages/${s}`,{page:pe,limit:20});if(!ce||!ce.success)throw new Error((ce==null?void 0:ce.error)||"Failed to load more messages");const R=ce.data||[];if(!I.current)return;R.length>0&&(f(Q=>[...Q,...R]),M(pe)),j(R.length===20),K(!1)}catch(pe){if(Vt.error("Error loading more messages:",pe),!I.current)return;A(pe.message||"Failed to load more messages"),K(!1)}}},[s,r,i,ne]),re=y.useCallback(async(pe,ce="text",R=null)=>{if(!s||!r)throw Vt.error("Cannot send message: Missing recipientId or not authenticated"),new Error("Cannot send message: Authentication required");if(!(t!=null&&t._id))throw Vt.error("Cannot send message: User ID is undefined or invalid"),new Error("User authentication issue. Please try logging out and back in.");D(!0);try{Vt.debug(`Sending ${ce} message to ${s}`);const Q={recipient:s,content:pe,type:ce};if(R&&(Q.metadata=R),c.connected)return new Promise((P,ie)=>{c.emit("message:send",Q,J=>{if(I.current)if(J&&J.success){Vt.debug("Message sent via socket successfully");const ze=J.data;f(de=>[ze,...de]),D(!1),P(ze)}else Vt.warn("Socket message send failed, falling back to API"),Y().then(P).catch(ie)}),setTimeout(()=>{Vt.warn("Socket message send timeout, falling back to API"),Y().then(P).catch(ie)},5e3)});return Vt.debug("Socket not connected, sending via API"),Y();async function Y(){const P=await i.post("/messages",Q);if(!P||!P.success)throw new Error((P==null?void 0:P.error)||"Failed to send message");if(!I.current)return;const ie=P.data;return Vt.debug("Message sent via API successfully"),f(J=>[ie,...J]),D(!1),ie}}catch(Q){if(Vt.error("Error sending message:",Q),!I.current)return;throw D(!1),Q}},[s,r,t,i,c]);return y.useEffect(()=>{if(!s||!r||!c.connected)return;Vt.debug(`Setting up socket listeners for messages with ${s}`);const pe=c.on("message:new",R=>{I.current&&R&&(R.sender===s&&R.recipient===(t==null?void 0:t._id)||R.sender===(t==null?void 0:t._id)&&R.recipient===s)&&(Vt.debug("Received new message via socket"),f(Q=>Q.some(P=>P._id===R._id)?Q:[R,...Q]))}),ce=c.on("message:status",R=>{I.current&&R&&R.messageId&&(Vt.debug(`Received message status update for ${R.messageId}`),f(Q=>Q.map(Y=>Y._id===R.messageId?{...Y,status:R.status,updatedAt:R.timestamp||new Date}:Y)))});return E.current=[pe,ce],()=>{E.current.forEach(R=>{R&&typeof R=="function"&&R()}),E.current=[]}},[s,r,t,c]),y.useEffect(()=>{s&&r?H():v(!1)},[s,r,H]),{messages:u,loading:m,error:x,hasMore:S,loadMoreMessages:q,sendMessage:re,sending:U,loadingMore:ne,refresh:()=>H(!0)}},Qn=Rt.create("useChat"),B3=s=>{const{user:t,isAuthenticated:r}=Ot(),[i,c]=y.useState([]),[u,f]=y.useState(!0),[m,v]=y.useState(!1),[x,A]=y.useState(null),[S,j]=y.useState(!0),[C,M]=y.useState(1),[U,D]=y.useState(!1),[ne,K]=y.useState(!1),[te,B]=y.useState(Yt.isConnected()),L=y.useRef(i),I=y.useRef(null),E=y.useRef(null),T=y.useRef(!0);y.useEffect(()=>{L.current=i},[i]),y.useEffect(()=>(r&&(t!=null&&t._id)&&Yt.initialize(t),()=>{T.current=!1,I.current&&clearTimeout(I.current),E.current&&(E.current.forEach(ce=>ce()),E.current=null)}),[r,t]),y.useEffect(()=>{if(!s||!r||!(t!=null&&t._id))return;E.current&&E.current.forEach(ie=>ie());const ce=[],R=Yt.on("messageReceived",ie=>{T.current&&(ie.sender===s&&ie.recipient===t._id||ie.sender===t._id&&ie.recipient===s)&&(Qn.debug(`Received new message in conversation with ${s}`),c(J=>J.some(de=>de._id===ie._id)?J.map(de=>de._id===ie._id?{...de,...ie}:de):[ie,...J].sort((de,Z)=>new Date(Z.createdAt)-new Date(de.createdAt))),ie.sender===s&&!ie.read&&Yt.markConversationRead(s))});ce.push(R);const Q=Yt.on("messageSent",ie=>{T.current&&ie.recipient===s&&(Qn.debug(`Message sent confirmation for conversation with ${s}`),c(J=>{const ze=J.findIndex(de=>de._id===ie._id||de.tempId===ie.tempMessageId);if(ze>=0){const de=[...J];return de[ze]={...de[ze],...ie,status:"sent",pending:!1},de}return[{...ie,status:"sent",pending:!1},...J].sort((de,Z)=>new Date(Z.createdAt)-new Date(de.createdAt))}))});ce.push(Q);const Y=Yt.on("userTyping",ie=>{T.current&&ie.userId===s&&(Qn.debug(`${s} is typing...`),K(!0),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{T.current&&K(!1)},3e3))});ce.push(Y);const P=Yt.on("connectionChanged",({connected:ie})=>{T.current&&(B(ie),ie&&z(!0))});return ce.push(P),E.current=ce,z(),Yt.markConversationRead(s),()=>{ce.forEach(ie=>ie()),I.current&&clearTimeout(I.current)}},[s,r,t]);const z=y.useCallback(async(ce=!1)=>{if(!s||!r||!(t!=null&&t._id))return f(!1),[];if(u&&!ce)return[];const R=setTimeout(()=>{T.current&&(Qn.warn("Message loading timeout reached. Resetting loading state."),f(!1),A("Loading timed out. Please try again."))},1e4);f(!0),A(null);try{Qn.debug(`Loading messages with ${s}`),Yt.isConnected()||Qn.warn("Socket not connected. Attempting to use API directly.");const Q=await Yt.getMessages(s,1,20);return clearTimeout(R),T.current?(c(Q||[]),j((Q||[]).length>=20),M(1),f(!1),Q||[]):[]}catch(Q){return Qn.error("Error loading messages:",Q),clearTimeout(R),T.current?(A(Q.message||"Failed to load messages"),f(!1),[]):[]}},[s,r,t,u]),W=y.useCallback(async()=>{if(!s||!r||U||!S)return[];D(!0);try{const ce=C+1;Qn.debug(`Loading more messages, page ${ce}`);const R=await Yt.getMessages(s,ce,20);return T.current?(R.length>0&&(c(Q=>{const Y=[...Q];return R.forEach(P=>{Y.some(J=>J._id===P._id)||Y.push(P)}),Y.sort((P,ie)=>new Date(ie.createdAt)-new Date(P.createdAt))}),M(ce)),j(R.length>=20),D(!1),R):[]}catch(ce){return Qn.error("Error loading more messages:",ce),T.current?(A(ce.message||"Failed to load more messages"),D(!1),[]):[]}},[s,r,U,S,C]),H=y.useCallback(async(ce,R="text",Q=null)=>{if(!s||!r||!(t!=null&&t._id))throw Qn.error("Cannot send message: Missing recipient or not authenticated"),new Error("Cannot send message: Authentication required");v(!0);try{Qn.debug(`Sending ${R} message to ${s}`);const Y=await Yt.sendMessage(s,ce,R,Q);return T.current&&(c(P=>{const ie=P.findIndex(J=>J.tempId===Y.tempMessageId);if(ie>=0){const J=[...P];return J[ie]={...J[ie],...Y,status:"sent",pending:!1},J}return[Y,...P].sort((J,ze)=>new Date(ze.createdAt)-new Date(J.createdAt))}),v(!1)),Y}catch(Y){throw Qn.error("Error sending message:",Y),T.current&&v(!1),Y}},[s,r,t]),q=y.useCallback(()=>{s&&r&&Yt.isConnected()&&Yt.sendTypingIndicator(s)},[s,r]),re=y.useCallback(()=>z(!0),[z]),pe=y.useCallback(()=>{A(null)},[]);return{messages:i,loading:u,sending:m,error:x,hasMore:S,loadMoreMessages:W,sendMessage:H,sendTyping:q,typingStatus:ne,refresh:re,resetError:pe,isConnected:te}},Qf=()=>{const s=y.useRef(!1);return y.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[]),{isMounted:()=>s.current}},P3=s=>{const t=y.useRef(null);return y.useEffect(()=>{const r=i=>{t.current&&!t.current.contains(i.target)&&s()};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[s]),t},ro=({isOpen:s,onClose:t,title:r,children:i,footer:c,size:u="medium",closeOnClickOutside:f=!0,closeOnEsc:m=!0,showCloseButton:v=!0,className:x="",contentClassName:A="",headerClassName:S="",bodyClassName:j="",footerClassName:C="",modalRoot:M=document.body})=>{const U=y.useRef(null),D=y.useRef(null),ne=P3(()=>{f&&s&&t()});y.useEffect(()=>{if(!s)return;D.current=document.activeElement;const B=L=>{var I;if(m&&L.key==="Escape"&&t(),L.key==="Tab"){const E=((I=U.current)==null?void 0:I.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))||[];if(E.length===0)return;const T=E[0],z=E[E.length-1];L.shiftKey?document.activeElement===T&&(z.focus(),L.preventDefault()):document.activeElement===z&&(T.focus(),L.preventDefault())}};return document.addEventListener("keydown",B),document.body.style.overflow="hidden",setTimeout(()=>{var I;const L=(I=U.current)==null?void 0:I.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');L!=null&&L[0]&&L[0].focus()},0),()=>{document.removeEventListener("keydown",B),document.body.style.overflow="",D.current&&D.current.focus()}},[s,m,t,f]);const K={small:"modal-sm",medium:"modal-md",large:"modal-lg",xlarge:"modal-xl",fullscreen:"modal-fullscreen"};if(!s)return null;const te=o.jsx("div",{className:`modal-overlay ${s?"open":""}`,onClick:f?t:void 0,children:o.jsxs("div",{className:`modal ${K[u]||""} ${x}`,ref:B=>{U.current=B,ne&&(ne.current=B)},onClick:B=>B.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":r?"modal-title":void 0,children:[r&&o.jsxs("div",{className:`modal-header ${S}`,children:[o.jsx("h2",{className:"modal-title",id:"modal-title",children:r}),v&&o.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close modal",children:o.jsx(xn,{})})]}),o.jsx("div",{className:`modal-body ${j}`,children:i}),c&&o.jsx("div",{className:`modal-footer ${C}`,children:c})]})});return nb.createPortal(te,M)};ro.propTypes={isOpen:Ae.bool.isRequired,onClose:Ae.func.isRequired,title:Ae.node,children:Ae.node.isRequired,footer:Ae.node,size:Ae.oneOf(["small","medium","large","xlarge","fullscreen"]),closeOnClickOutside:Ae.bool,closeOnEsc:Ae.bool,showCloseButton:Ae.bool,className:Ae.string,contentClassName:Ae.string,headerClassName:Ae.string,bodyClassName:Ae.string,footerClassName:Ae.string,modalRoot:Ae.object};const $3=({error:s,resetErrorBoundary:t})=>o.jsxs("div",{className:"error-boundary-fallback",children:[o.jsx(hc,{title:"Something went wrong",message:(s==null?void 0:s.message)||"An unexpected error occurred"}),t&&o.jsx("button",{onClick:t,className:"btn btn-primary mt-3",children:"Try Again"})]}),$1=(s,t={})=>{const{FallbackComponent:r=$3,onError:i,resetKeys:c=[],onReset:u,...f}=t,m=(A,S)=>{Rt.error("Error caught by boundary:",A),Rt.error("Component stack:",S==null?void 0:S.componentStack),i&&i(A,S)},v=A=>o.jsx(Hf,{FallbackComponent:r,onError:m,resetKeys:c,onReset:u,...f,children:o.jsx(s,{...A})}),x=s.displayName||s.name||"Component";return v.displayName=`withErrorBoundary(${x})`,v},q3=(s,t,r={})=>{const{debug:i=!1}=r,c=i?(m,v)=>{const x=t?t(m,v):!0;if(!x){const A=Object.keys(v).filter(j=>m[j]!==v[j]),S=s.displayName||s.name||"Component";Rt.debug(`[withMemo] ${S} re-rendering due to props changes:`,A)}return x}:t,u=y.memo(s,c),f=s.displayName||s.name||"Component";return u.displayName=`withMemo(${f})`,u},rt=Rt.create("EmbeddedChat"),q1=document.createElement("style");q1.textContent=`
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  .pulse {
    animation: pulse 1s infinite;
  }
`;document.head.appendChild(q1);const I3=({recipient:s,isOpen:t,onClose:r,embedded:i=!0})=>{var p;const{user:c}=Ot(),u=mn(),{isMounted:f}=Qf(),m=yo(),v=y.useMemo(()=>s==null?void 0:s._id,[s==null?void 0:s._id]),{messages:x,loading:A,error:S,isTyping:j,sendMessage:C,sendTypingIndicator:M,loadMessages:U,clearError:D,sendFileMessage:ne}=U3(v),[K,te]=y.useState(""),[B,L]=y.useState(!1),[I,E]=y.useState(null),[T,z]=y.useState(!1),[W,H]=y.useState(0),[q,re]=y.useState(0),[pe,ce]=y.useState(!1),[R,Q]=y.useState([]),[Y,P]=y.useState(!1),[ie,J]=y.useState(!1),[ze,de]=y.useState(!1),[Z,Te]=y.useState(null),[je,Fe]=y.useState(null),Me=y.useRef(null),Ue=y.useRef(null),Le=y.useRef(null),he=y.useRef(null),ye=y.useRef(null);y.useEffect(()=>{if(Se.socket){rt.debug("Socket reference obtained"),ye.current=Se.socket;const g=k=>{rt.debug("Call answer received:",k),k.accept?rt.debug("Call was accepted"):(rt.debug("Call was rejected"),ie&&(J(!1),X.info("Call was declined")))};return ye.current.on("callAnswered",g),()=>{ye.current&&ye.current.off("callAnswered",g)}}else rt.warn("Socket connection not available",Se)},[ie]);const G=y.useCallback(()=>{t&&(s!=null&&s._id)&&(rt.debug("Manual message refresh requested"),U())},[t,s,U]),oe=y.useCallback(g=>{try{if(!g){rt.error("Received empty call data");return}if(rt.debug("Incoming call received:",g),!(g.caller&&(g.caller.userId||g.caller._id)||g.userId||g.from&&g.from.userId)){rt.error("Caller ID not found in incoming call data",g);return}Te(g),rt.debug("Incoming call state set",g)}catch(k){rt.error("Error handling incoming call:",k)}},[s]);y.useEffect(()=>{if(!ye.current){rt.warn("No socket available for incoming call handling");return}const g=k=>{rt.debug("Incoming call event received:",k),oe(k)};return ye.current.on("incomingCall",g),()=>{ye.current&&ye.current.off("incomingCall",g)}},[s,oe]),y.useEffect(()=>{if(!Me.current)return;const g=x.length>0?"smooth":"auto";requestAnimationFrame(()=>{var k;(k=Me.current)==null||k.scrollIntoView({behavior:g})})},[x]),y.useEffect(()=>{t&&s&&Ue.current&&requestAnimationFrame(()=>{setTimeout(()=>{var g;(g=Ue.current)==null||g.focus()},300)})},[t,s]),y.useEffect(()=>()=>{he.current&&clearTimeout(he.current),T&&(z(!1),E(null),H(0))},[T]);const be=()=>{if((c==null?void 0:c.accountTier)==="FREE"){rt.error("Free accounts cannot make video calls. Upgrade for video calls."),X.error("Upgrade to make video calls");return}if(!ye.current){rt.error("Cannot start call: No connection available"),X.error("Cannot connect to video service");return}if(ie){rt.debug("Call already in progress");return}s!=null&&s._id?(rt.debug(`Starting video call with ${s.nickname}...`),de(!0),J(!0),ye.current.emit("initiateCall",{recipientId:s._id,callType:"video",userId:c._id,callId:`call-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,caller:{userId:c._id,name:c.nickname||"User"}}),C("Video Call","video").catch(g=>{rt.error("Failed to send video call message:",g)})):(rt.error("Cannot start call: recipient information is missing"),X.error("Cannot start call: missing recipient information"))},Ne=()=>{var k,N;if(rt.debug("Accepting incoming call",Z),!Z){rt.error("No incoming call to accept");return}if(!ye.current){rt.error("Cannot accept call: No socket connection available"),X.error("Cannot connect to video service");return}const g=((k=Z.caller)==null?void 0:k.userId)||Z.userId;if(!g){rt.error("Cannot accept call: No caller ID found"),X.error("Cannot accept call: Invalid call data");return}ye.current.emit("answerCall",{callerId:g,accept:!0,callId:Z.callId,timestamp:Date.now()}),rt.debug(`Accepting call from ${((N=Z.caller)==null?void 0:N.name)||"caller"} with ID ${g}`),J(!0),de(!1),Te(null)},_e=()=>{var k,N;if(rt.debug("Rejecting incoming call",Z),!Z){rt.error("No incoming call to reject");return}if(!ye.current){rt.error("Cannot reject call: No socket connection available");return}const g=((k=Z.caller)==null?void 0:k.userId)||Z.userId;if(!g){rt.error("Cannot reject call: No caller ID found");return}ye.current.emit("answerCall",{callerId:g,accept:!1,callId:Z.callId,timestamp:Date.now()}),rt.debug(`Rejecting call from ${((N=Z.caller)==null?void 0:N.name)||"caller"} with ID ${g}`),Te(null)},Ge=y.useCallback(()=>{J(!1)},[]),bt=y.useCallback(g=>{Fe(g.message||"Call failed"),rt.error("Call error:",g),J(!1)},[]),ut=y.useCallback(g=>{if(!g)return o.jsx(uf,{});const k=g.type||"";switch(a0(k)){case"image":return o.jsx(Ao,{});case"video":return o.jsx(cf,{});case"audio":return o.jsx(of,{});case"pdf":return o.jsx(lf,{});default:return o.jsx(af,{})}},[]),St=y.useCallback(()=>Mf(x),[x]),Nt=g=>{var k;te(N=>N+g),L(!1),(k=Ue.current)==null||k.focus()},Mt=g=>{te(g.target.value),he.current&&clearTimeout(he.current),he.current=setTimeout(()=>{g.target.value.trim()&&(s!=null&&s._id)&&M()},300)},ue=async g=>{if(g.preventDefault(),I)return Re();if(K.trim()&&!Y&&(s!=null&&s._id)){if((c==null?void 0:c.accountTier)==="FREE"&&K.trim()!==""){X.error("Free accounts can only send winks. Upgrade to send messages.");return}try{P(!0),await C(K.trim(),"text"),te("")}catch(k){rt.error("Failed to send message:",k),X.error(k.message||"Failed to send message")}finally{P(!1)}}},Re=async()=>{if(!(!I||!(s!=null&&s._id)||T)){z(!0);try{if(!await ne(I,N=>{f()&&H(N)}))throw X.error(S||"Failed to send file. Please try again."),new Error("File upload failed");rt.debug("File sent successfully"),E(null),H(0),Le.current&&(Le.current.value="")}catch(g){rt.error("Failed to send file:",g),S||X.error(g.message||"Failed to send file. Please try again.")}finally{f()&&z(!1)}}},De=async()=>{if(!Y&&(s!=null&&s._id))try{P(!0),await C("","wink")}catch(g){rt.error("Failed to send wink:",g),X.error(g.message||"Failed to send wink")}finally{P(!1)}},se=()=>{var g;if((c==null?void 0:c.accountTier)==="FREE"){X.error("Free accounts cannot send files. Upgrade to send files.");return}(g=Le.current)==null||g.click()},Ee=g=>{var N;const k=(N=g.target.files)==null?void 0:N[0];k&&(E(k),rt.debug(`Selected file: ${k.name}`),g.target.value=null)},Ke=()=>{E(null),H(0),Le.current&&(Le.current.value="")},b=async()=>{ce(!0);try{if(R.length>0){const k=(await Promise.allSettled(R.map(N=>m.put(`/users/photos/permissions/${N._id}`,{status:"approved"})))).filter(N=>N.status==="fulfilled"&&N.value).length;if(k>0){rt.debug(`Approved ${k} photo request${k!==1?"s":""}`);const N={_id:Date.now().toString(),sender:"system",content:`Photo access approved for ${k} photo${k!==1?"s":""}.`,createdAt:new Date().toISOString(),type:"system"};await C("I've approved your request to view my private photos.","text"),re(0),Q([])}else X.error("Failed to approve photo requests")}else{const g=await m.post("/users/photos/approve-all",{requesterId:s._id});if(g){const k=g.approvedCount||1;rt.debug(`Approved ${k} photo request${k!==1?"s":""}`),await C("I've approved your request to view my private photos.","text"),re(0)}else throw new Error("Approval failed")}}catch(g){rt.error("Error approving photo requests:",g),X.error("Error approving photo requests. Please try again.")}finally{f()&&ce(!1)}};return t?o.jsxs("div",{className:Zr("embedded-chat",i?"embedded":"standalone"),children:[ie&&ye.current?o.jsx(U1,{isInitiator:ze,remoteUserId:s._id,remoteUserName:s.nickname,onClose:Ge,socket:ye.current,onError:bt}):ie?o.jsxs("div",{className:"video-call-error",children:[o.jsx("h3",{children:"Cannot start video call"}),o.jsx("p",{children:"Connection not available. Please try again later."}),o.jsx(xt,{onClick:Ge,variant:"danger",children:"Close"})]}):null,o.jsxs("div",{className:"chat-header",children:[o.jsxs("div",{className:"chat-user",children:[o.jsx(ei,{src:(p=s==null?void 0:s.photos)!=null&&p.length?s.photos[0].url:null,alt:s==null?void 0:s.nickname,size:"small",className:"chat-avatar",status:s!=null&&s.isOnline?"online":null}),o.jsxs("div",{className:"chat-user-info",children:[o.jsx("h3",{children:s==null?void 0:s.nickname}),o.jsx("p",{className:s!=null&&s.isOnline?"status-online":"status-offline",children:s!=null&&s.isOnline?"Online":"Offline"})]})]}),o.jsxs("div",{className:"chat-header-actions",children:[o.jsx(xt,{className:"photo-request-btn",onClick:b,icon:pe?o.jsx(Ln,{className:"fa-spin"}):o.jsx(Jn,{}),"aria-label":"Approve photo requests",variant:"light",size:"small",disabled:pe,children:o.jsx("span",{className:"request-badge",children:"!"})}),(c==null?void 0:c.accountTier)!=="FREE"&&!ie&&o.jsx(xt,{className:"video-call-btn",onClick:be,icon:o.jsx(Jr,{}),"aria-label":"Start video call",variant:"light",size:"small",disabled:T||Y||ie}),o.jsx(xt,{className:"close-chat-btn",onClick:r,icon:o.jsx(xn,{}),"aria-label":"Close chat",variant:"light",size:"small"})]})]}),Z&&o.jsxs("div",{className:"incoming-call-banner",children:[o.jsxs("div",{className:"incoming-call-info",children:[o.jsx(Jr,{className:"call-icon pulse"}),o.jsxs("span",{children:[(s==null?void 0:s.nickname)||"Someone"," is calling you"]})]}),o.jsxs("div",{className:"incoming-call-actions",children:[o.jsx(xt,{className:"decline-call-btn",onClick:_e,icon:o.jsx(P0,{}),variant:"danger",size:"small","aria-label":"Decline call"}),o.jsx(xt,{className:"accept-call-btn",onClick:Ne,icon:o.jsx($0,{}),variant:"success",size:"small","aria-label":"Accept call"})]})]}),(c==null?void 0:c.accountTier)==="FREE"&&o.jsxs("div",{className:"premium-banner",children:[o.jsx(M0,{className:"premium-icon"}),o.jsx("span",{children:"Upgrade to send messages and make video calls (you can still send heart)"}),o.jsx(xt,{className:"upgrade-btn",onClick:()=>u("/subscription"),variant:"primary",size:"small",children:"Upgrade"})]}),o.jsxs("div",{className:"messages-container",children:[o.jsx("div",{className:"messages-header",children:o.jsx(xt,{className:"refresh-messages-btn",onClick:G,disabled:A,icon:A?o.jsx(Ln,{className:"fa-spin"}):o.jsx(Wl,{}),title:"Refresh messages","aria-label":"Refresh messages",variant:"light",size:"small"})}),o.jsxs(P1,{isLoading:A,error:S,loadingText:"Loading messages...",size:"medium",spinnerProps:{centered:!0},showChildrenAfterLoad:!0,onRetry:G,renderError:(g,k)=>o.jsxs("div",{className:"message-error",children:[o.jsx(hc,{message:g,title:"Error Loading Messages",type:"error",onDismiss:D,showIcon:!0}),o.jsx(xt,{onClick:k,variant:"primary",size:"small",className:"mt-2",children:"Try Again"})]}),children:[!x||x.length===0?o.jsx("div",{className:"no-messages",children:o.jsx("p",{children:"No messages yet. Say hello!"})}):Object.entries(St()).map(([g,k])=>o.jsxs(Gr.Fragment,{children:[o.jsx("div",{className:"message-date",children:g}),k.map(N=>{var ae,Be,at,tt;if(!N||!N._id)return null;const $=c&&N.sender&&(N.sender===c._id||typeof N.sender=="object"&&N.sender._id===c._id);return o.jsxs("div",{className:Zr("message",$?"sent":"received",N.type==="system"?"system-message":"",N.pending?"pending":"",N.error?"error":""),children:[N.type==="text"&&o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"message-content",children:N.content}),o.jsxs("span",{className:"message-time",children:[Gs(N.createdAt,{showTime:!0,showDate:!1}),$&&(N.pending?o.jsx("span",{className:"pending-indicator",title:"Sending...",children:""}):N.error?o.jsx("span",{className:"error-indicator",title:"Failed to send",children:"!"}):N.read?o.jsx(T0,{className:"read-indicator",title:"Read"}):o.jsx(pt,{className:"read-indicator",title:"Sent"}))]})]}),N.type==="wink"&&o.jsxs("div",{className:"wink-message",children:[o.jsx("p",{className:"message-content",children:""}),o.jsx("span",{className:"message-label",children:"Wink"})]}),N.type==="video"&&o.jsxs("div",{className:"video-call-message",children:[o.jsx(Jr,{className:"video-icon"}),o.jsx("p",{className:"message-content",children:"Video Call"}),o.jsx("span",{className:"message-time",children:Gs(N.createdAt,{showTime:!0,showDate:!1})})]}),N.type==="file"&&o.jsx("div",{className:"file-message",children:(ae=N.metadata)!=null&&ae.fileUrl?(Be=N.metadata.fileType)!=null&&Be.startsWith("image/")?o.jsx("img",{src:Zi(N.metadata.fileUrl)||"/placeholder.svg",alt:N.metadata.fileName||"Image",className:"image-attachment"}):o.jsxs("div",{className:"file-attachment",children:[(at=N.metadata.fileType)!=null&&at.startsWith("video/")?o.jsx(cf,{className:"file-icon"}):(tt=N.metadata.fileType)!=null&&tt.startsWith("audio/")?o.jsx(of,{className:"file-icon"}):N.metadata.fileType==="application/pdf"?o.jsx(lf,{className:"file-icon"}):o.jsx(af,{className:"file-icon"}),o.jsx("span",{className:"file-name",children:N.metadata.fileName||"File"}),o.jsx("span",{className:"file-size",children:N.metadata.fileSize?`(${Math.round(N.metadata.fileSize/1024)} KB)`:""}),o.jsx(xt,{href:N.metadata.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"download-link",onClick:dt=>dt.stopPropagation(),variant:"link",size:"small",children:"Download"})]}):o.jsx("p",{className:"message-content",children:"Attachment unavailable"})}),N.type==="system"&&o.jsxs("div",{className:"system-message-content",children:[o.jsx("p",{children:N.content}),o.jsx("span",{className:"message-time",children:Gs(N.createdAt,{showTime:!0,showDate:!1})})]})]},N._id)})]},g)),s&&j&&o.jsxs("div",{className:"typing-indicator",children:[o.jsx("span",{}),o.jsx("span",{}),o.jsx("span",{})]}),o.jsx("div",{ref:Me})]})]}),I&&o.jsxs("div",{className:"attachment-preview",children:[o.jsxs("div",{className:"attachment-info",children:[ut(I),o.jsx("span",{className:"attachment-name",children:I.name}),o.jsxs("span",{className:"attachment-size",children:["(",Math.round(I.size/1024)," KB)"]})]}),T?o.jsxs("div",{className:"upload-progress-container",children:[o.jsx("div",{className:"upload-progress-bar",style:{width:`${W}%`}}),o.jsxs("span",{className:"upload-progress-text",children:[W,"%"]})]}):o.jsx(xt,{className:"remove-attachment",onClick:Ke,disabled:T,icon:o.jsx(xn,{}),variant:"light",size:"small","aria-label":"Remove attachment"})]}),o.jsxs("form",{className:"message-input",onSubmit:ue,children:[o.jsx(xt,{type:"button",className:"input-emoji",onClick:()=>L(!B),icon:o.jsx(q0,{}),"aria-label":"Add emoji",variant:"light",size:"small",disabled:T||Y}),B&&o.jsxs("div",{className:"emoji-picker",children:[o.jsxs("div",{className:"emoji-header",children:[o.jsx("h4",{children:"Emojis"}),o.jsx(xt,{onClick:()=>L(!1),icon:o.jsx(xn,{}),"aria-label":"Close emoji picker",variant:"light",size:"small"})]}),o.jsx("div",{className:"emoji-list",children:o0.map(g=>o.jsx("button",{type:"button",onClick:()=>Nt(g),"aria-label":`Emoji ${g}`,children:g},g))})]}),o.jsx("input",{type:"text",placeholder:(c==null?void 0:c.accountTier)==="FREE"?"Free users can only send winks":"Type a message...",value:K,onChange:Mt,ref:Ue,disabled:Y||T||(c==null?void 0:c.accountTier)==="FREE","aria-label":"Message input",title:(c==null?void 0:c.accountTier)==="FREE"?"Upgrade to send text messages":"Type a message"}),o.jsx(xt,{type:"button",className:"input-attachment",onClick:se,disabled:Y||T||(c==null?void 0:c.accountTier)==="FREE",icon:o.jsx(B0,{}),title:(c==null?void 0:c.accountTier)==="FREE"?"Upgrade to send files":"Attach File","aria-label":"Attach file",variant:"light",size:"small"}),o.jsx("input",{type:"file",ref:Le,style:{display:"none"},onChange:Ee,"aria-hidden":"true",accept:"image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,audio/mpeg,audio/wav,video/mp4,video/quicktime"}),o.jsx(xt,{type:"button",className:"input-wink",onClick:De,disabled:Y||T,icon:o.jsx(Xs,{}),title:"Send Wink","aria-label":"Send wink",variant:"light",size:"small"}),o.jsx(xt,{type:"submit",className:"input-send",disabled:!K.trim()&&!I||Y||T,icon:Y||T?o.jsx(Ln,{className:"fa-spin"}):o.jsx(U0,{}),title:Y?"Sending...":"Send Message","aria-label":Y?"Sending message":"Send message",variant:"primary",size:"small"})]})]}):null},Kf=$1(I3,{FallbackComponent:({error:s,resetErrorBoundary:t})=>o.jsxs("div",{className:"embedded-chat-error",children:[o.jsx(hc,{title:"Chat Error",message:(s==null?void 0:s.message)||"An error occurred in the chat component"}),o.jsx(xt,{onClick:t,variant:"primary",className:"mt-3",children:"Try Again"})]}),onError:(s,t)=>{rt.error("EmbeddedChat error boundary caught error:",s),rt.error("Component stack:",t==null?void 0:t.componentStack),X.error("Something went wrong with the chat. Trying to recover...")}}),Pi=Rt.create("NotificationsComponent");let os;try{os=new BroadcastChannel("notifications_sync")}catch{Pi.warn("BroadcastChannel not supported in this browser")}const F3=({showHeader:s=!0,showFilters:t=!0,isDropdown:r=!1,isMobile:i=!1,onClose:c,maxHeight:u=400,className:f="",style:m={},customFilters:v=null})=>{const{notifications:x,unreadCount:A,isLoading:S,socketConnected:j,markAllAsRead:C,addTestNotification:M,handleNotificationClick:U,refreshNotifications:D}=Q0(),[ne,K]=y.useState("all"),[te,B]=y.useState([]),[L,I]=y.useState(!1),[E,T]=y.useState(document.visibilityState),z=yo(),{isMounted:W}=Qf(),H=y.useRef(null),q=y.useRef(Date.now()),re=y.useRef(null);y.useEffect(()=>{const de=()=>{const Z=document.visibilityState;T(Z),Z==="visible"&&Date.now()-q.current>3e4&&(D(),q.current=Date.now())};return document.addEventListener("visibilitychange",de),()=>{document.removeEventListener("visibilitychange",de)}},[D]),y.useEffect(()=>{const de=Z=>{const{type:Te,data:je}=Z.data||{};(Te==="NOTIFICATION_READ"||Te==="NOTIFICATION_RECEIVED")&&D()};return os&&os.addEventListener("message",de),()=>{os&&os.removeEventListener("message",de)}},[D]),y.useEffect(()=>{const de=Z=>{Pi.debug(" DIRECT NOTIFICATION RECEIVED IN COMPONENT:",Z),D(),q.current=Date.now(),os&&os.postMessage({type:"NOTIFICATION_RECEIVED",data:Z})};return Se.socket&&(Pi.debug(" Setting up direct socket handlers in NotificationsComponent"),Se.socket.on("notification",de),Se.socket.on("newMessage",de),Se.socket.on("newLike",de),Se.socket.on("photoPermissionRequestReceived",de),Se.socket.on("photoPermissionResponseReceived",de),Se.socket.on("newComment",de),Se.socket.on("incomingCall",de),Pi.debug("Socket connected:",Se.isConnected()),Pi.debug("Socket ID:",Se.socket.id)),()=>{Se.socket&&(Se.socket.off("notification",de),Se.socket.off("newMessage",de),Se.socket.off("newLike",de),Se.socket.off("photoPermissionRequestReceived",de),Se.socket.off("photoPermissionResponseReceived",de),Se.socket.off("newComment",de),Se.socket.off("incomingCall",de)),re.current&&clearTimeout(re.current)}},[D]),y.useEffect(()=>{let de=j;if(j&&!de&&(D(),q.current=Date.now()),!j&&de){const Te=()=>{D(),q.current=Date.now(),re.current=setTimeout(Te,6e4)};re.current=setTimeout(Te,5e3)}return de=j,()=>{re.current&&clearTimeout(re.current)}},[j,D]);const pe=y.useRef((x==null?void 0:x.length)||0);y.useEffect(()=>{(x==null?void 0:x.length)>pe.current&&H.current&&(H.current.scrollTop=0),pe.current=(x==null?void 0:x.length)||0},[x]);const ce=async de=>{if(de&&(de.preventDefault(),de.stopPropagation()),!L){I(!0);try{await D(),q.current=Date.now(),X.success("Notifications refreshed")}catch{X.error("Failed to refresh notifications")}finally{setTimeout(()=>{W()&&I(!1)},500)}}};y.useEffect(()=>{if(!x){B([]);return}let de=[...x];ne!=="all"&&(ne==="unread"?de=de.filter(je=>!je.read):de=de.filter(je=>je.type===ne));const Z=[],Te={};de.forEach(je=>{var Ue,Le,he,ye,G;const Me=`${((Ue=je.sender)==null?void 0:Ue._id)||((he=(Le=je.data)==null?void 0:Le.sender)==null?void 0:he._id)||((G=(ye=je.data)==null?void 0:ye.requester)==null?void 0:G._id)||"unknown"}_${je.type}`;Te[Me]?(Te[Me].count+=1,Te[Me].originalItems.push(je),new Date(je.createdAt)>new Date(Te[Me].createdAt)&&(Te[Me].createdAt=je.createdAt)):Te[Me]={...je,count:1,originalItems:[je]}}),Object.values(Te).forEach(je=>{Z.push(je)}),Z.sort((je,Fe)=>new Date(Fe.createdAt)-new Date(je.createdAt)),B(Z)},[x,ne]);const R=de=>{K(de)},Q=async()=>{try{const de=await z.delete("/notifications/clear-all");X.success(`Cleared ${(de==null?void 0:de.count)||0} notifications`),D(),q.current=Date.now()}catch(de){Pi.error("Error clearing notifications:",de),X.error("Error clearing notifications")}},Y=de=>{de&&(de.preventDefault(),de.stopPropagation()),C(),os&&os.postMessage({type:"NOTIFICATION_READ",data:{all:!0}}),X.success("All notifications marked as read")},P=de=>{U(de),!de.read&&os&&os.postMessage({type:"NOTIFICATION_READ",data:{id:de._id}}),r&&c&&c()},ie=de=>{de&&(de.preventDefault(),de.stopPropagation()),M()},J=()=>{const de=[{id:"all",label:"All"},{id:"unread",label:"Unread"},{id:"message",label:"Messages"},{id:"like",label:"Likes"},{id:"photoRequest",label:"Photos"},{id:"story",label:"Stories"}];return v&&Array.isArray(v)&&v.length>0?de.filter(Z=>v.includes(Z.id)):de},ze=()=>{const de=J();return o.jsx("div",{className:"notification-filters",children:de.map(Z=>o.jsx(xt,{className:`filter-btn ${ne===Z.id?"active":""}`,onClick:()=>R(Z.id),variant:ne===Z.id?"primary":"light",size:"small",children:Z.label},Z.id))})};return S?o.jsx("div",{className:`notification-loading ${f}`,style:m,children:o.jsx(mc,{size:"medium",text:"Loading notifications...",centered:!0})}):!te||te.length===0?o.jsxs("div",{className:`notification-empty ${f}`,style:m,children:[o.jsx(Yi,{size:32}),o.jsxs("p",{children:["No ",ne!=="all"?`${ne} `:"","notifications yet"]}),o.jsxs("div",{className:"notification-empty-actions",children:[o.jsx(xt,{onClick:ce,disabled:L,isLoading:L,variant:"secondary",size:"small",icon:o.jsx(nA,{}),children:L?"Refreshing...":"Refresh"}),r&&o.jsx(xt,{onClick:ie,variant:"primary",size:"small",className:"mt-3 ml-2",children:"Add Test Notification"})]}),!j&&o.jsxs("div",{className:"notification-connection-status",children:[o.jsx("span",{className:"dot disconnected"}),o.jsx("small",{children:"Real-time updates disconnected"})]})]}):o.jsxs("div",{className:`notification-container ${f}`,style:m,children:[s&&o.jsxs("div",{className:"notification-header",children:[o.jsxs("div",{className:"notification-header-title",children:[o.jsx("span",{children:"Notifications"}),ne!=="all"&&o.jsxs("span",{className:"notification-filter-indicator",children:["(",ne,")"]}),o.jsx("div",{className:"notification-connection-indicator",children:o.jsx("span",{className:`connection-dot ${j?"connected":"disconnected"}`})})]}),o.jsxs("div",{className:"notification-header-actions",children:[o.jsx(xt,{className:"notification-header-action",onClick:ce,title:"Refresh notifications",variant:"link",size:"small",icon:o.jsx(nA,{className:L?"spin":""})}),A>0&&o.jsx(xt,{className:"notification-header-action",onClick:Y,variant:"link",size:"small",children:"Mark all read"}),!r&&o.jsxs(o.Fragment,{children:[o.jsx(xt,{className:"notification-header-action",onClick:()=>R(ne==="all"?"unread":"all"),variant:"link",size:"small",icon:o.jsx(L0,{}),children:ne==="all"?"Show unread":"Show all"}),o.jsx(xt,{className:"notification-header-action",onClick:Q,variant:"link",size:"small",icon:o.jsx(ao,{}),children:"Clear all"})]}),r&&c&&o.jsx(xt,{className:"notification-close-btn",onClick:c,variant:"light",size:"small",icon:o.jsx(xn,{}),"aria-label":"Close notifications"})]})]}),t&&!i&&ze(),o.jsx("div",{ref:H,className:"notification-list",style:{maxHeight:`${u}px`},children:te.map(de=>o.jsx(H3,{notification:de,onClick:P},de._id||de.id||`notification-${Math.random()}`))}),t&&i&&o.jsx("div",{className:"notification-footer",children:ze()})]})},H3=({notification:s,onClick:t})=>{if(!s)return null;const r=V3(s.type),i=Gs(s.createdAt,{showRelative:!0,showTime:!1,showDate:!1}),c=s.count>1?s.count:null,u=Y3(s),f=v=>{v.preventDefault(),v.stopPropagation(),t&&t(s)},m=G3(s);return o.jsxs("div",{className:`notification-item ${s.read?"":"unread"}`,onClick:f,children:[o.jsx("div",{className:"notification-icon",children:o.jsx(r,{})}),o.jsxs("div",{className:"notification-content",children:[o.jsxs("div",{className:"notification-title",children:[o.jsx("span",{className:"notification-sender",children:u})," ",m,c&&o.jsxs("span",{className:"notification-count",children:[" (",c,")"]})]}),o.jsx("div",{className:"notification-message",children:s.message||s.content||s.title}),o.jsxs("div",{className:"notification-time",children:[i,!s.read&&o.jsx("span",{className:"notification-status",children:"New"})]})]})]})};function V3(s){switch(s){case"message":return If;case"like":case"match":return Xs;case"photoRequest":case"photoResponse":return Jl;case"story":return Ao;case"comment":return ea;case"call":return $0;default:return Yi}}function Y3(s){var t,r,i,c,u,f,m,v,x;return((t=s.sender)==null?void 0:t.nickname)||((i=(r=s.data)==null?void 0:r.sender)==null?void 0:i.nickname)||((u=(c=s.data)==null?void 0:c.requester)==null?void 0:u.nickname)||((m=(f=s.data)==null?void 0:f.owner)==null?void 0:m.nickname)||((x=(v=s.data)==null?void 0:v.user)==null?void 0:x.nickname)||"Someone"}function G3(s){var t;switch(s.type){case"message":return s.count>1?`sent you ${s.count} messages`:"sent you a message";case"like":return"liked your profile";case"match":return"matched with you";case"photoRequest":return"requested access to your photo";case"photoResponse":return(((t=s.data)==null?void 0:t.status)||"")==="approved"?"approved your photo request":"declined your photo request";case"story":return s.count>1?`shared ${s.count} new stories`:"shared a new story";case"comment":return s.count>1?`left ${s.count} comments on your post`:"commented on your post";case"call":return"called you";default:return"sent a notification"}}function vo(){const{theme:s,toggleTheme:t}=Y0(),[r,i]=y.useState(!1);return y.useEffect(()=>{i(!0)},[]),r?o.jsx("button",{onClick:t,className:"theme-toggle-btn","aria-label":s==="dark"?"Switch to light mode":"Switch to dark mode",children:s==="dark"?o.jsx(z4,{}):o.jsx(E4,{})}):null}const Zf=()=>{var B;const[s,t]=y.useState(!1),[r,i]=y.useState(!1),[c,u]=y.useState(!1),f=y.useRef(null),m=y.useRef(null),v=y.useRef(null),{unreadCount:x,addTestNotification:A}=Q0(),{isAuthenticated:S,logout:j,user:C}=Ot(),M=mn(),U=async L=>{L.preventDefault(),await j()},D=()=>{M("/profile")},ne=L=>{L&&(L.preventDefault(),L.stopPropagation()),console.log("Toggle notification dropdown"),t(I=>!I),i(!1)},K=L=>{L.preventDefault(),L.stopPropagation(),i(!r),t(!1)};y.useEffect(()=>{const L=I=>{const E=I.target.closest(".notification-button");f.current&&!f.current.contains(I.target)&&!E&&t(!1),m.current&&!m.current.contains(I.target)&&!I.target.closest(".user-menu")&&i(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const te=()=>{t(!1)};return o.jsx("header",{className:"app-header",children:o.jsxs("div",{className:"header-inner",children:[o.jsx("div",{className:"header-logo",onClick:()=>M("/"),children:o.jsx("span",{children:"Mandarin"})}),S&&o.jsx("nav",{className:"header-nav",children:o.jsxs("ul",{className:"nav-tabs",children:[o.jsx("li",{children:o.jsxs("button",{className:`nav-tab ${window.location.pathname==="/dashboard"?"active":""}`,onClick:()=>M("/dashboard"),children:[o.jsx(Ff,{}),o.jsx("span",{className:"nav-text",children:"Discover"})]})}),o.jsx("li",{children:o.jsxs("button",{className:`nav-tab ${window.location.pathname==="/messages"?"active":""}`,onClick:()=>M("/messages"),children:[o.jsx(w4,{}),o.jsx("span",{className:"nav-text",children:"Messages"})]})})]})}),o.jsxs("div",{className:"header-actions",children:[o.jsx(vo,{}),S?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"notification-wrapper",children:[o.jsxs("button",{ref:v,"aria-label":"Notifications",className:`notification-button ${c?"notification-pulse":""}`,onClick:L=>{L.stopPropagation(),L.preventDefault(),console.log("Notification button clicked"),ne(L)},style:{position:"relative",zIndex:102,cursor:"pointer"},children:[o.jsx(Yi,{}),x>0&&o.jsx("span",{className:"notification-badge",children:x>9?"9+":x})]}),s&&o.jsx("div",{ref:f,className:"notification-dropdown",children:o.jsx(F3,{isDropdown:!0,maxHeight:400,onClose:te,className:"notification-dropdown-content",customFilters:["all","unread"]})})]}),o.jsx("div",{className:"user-menu",children:o.jsxs("div",{className:"user-avatar-container",children:[((B=C==null?void 0:C.photos)==null?void 0:B.length)>0?o.jsx("img",{src:C.photos[0].url||"/placeholder.svg?height=32&width=32",alt:C.nickname,className:"user-avatar",onClick:K}):o.jsx(Gi,{className:"user-avatar-icon",onClick:K}),r&&o.jsxs("div",{ref:m,className:"user-dropdown",children:[o.jsxs("div",{className:"user-dropdown-item",onClick:D,children:[o.jsx(Gi,{}),"Profile"]}),o.jsxs("div",{className:"user-dropdown-item",onClick:()=>M("/settings"),children:[o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Settings"]}),o.jsxs("div",{className:"user-dropdown-item",onClick:()=>M("/subscription"),children:[o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("circle",{cx:"12",cy:"8",r:"7"}),o.jsx("polyline",{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"})]}),"Subscription"]}),o.jsx("div",{className:"user-dropdown-divider"}),o.jsxs("div",{className:"user-dropdown-item danger",onClick:U,children:[o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),o.jsx("polyline",{points:"16 17 21 12 16 7"}),o.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),"Logout"]})]})]})})]}):o.jsxs("div",{className:"auth-buttons",children:[o.jsx(nn,{to:"/login",className:"btn btn-outline me-2",children:"Login"}),o.jsx(nn,{to:"/register",className:"btn btn-primary",children:"Register"})]})]})]})})},Jf=({story:s,onClick:t,hasUnviewedStories:r,user:i})=>{const{user:c}=ti(),[u,f]=y.useState(!1),m=y.useRef(new Set),v=y.useMemo(()=>i||(s?typeof s.user=="object"?s.user:s.userData&&typeof s.userData=="object"?s.userData:typeof s.user=="string"?{_id:s.user}:{}:{}),[s,i]),x=v._id,A=v.nickname||v.username||v.name||"User",S=v.profilePicture||v.avatar||null,j=y.useMemo(()=>{const D=window.location.origin,ne=S||(x?`${D}/api/avatars/${x}`:`${D}/placeholder.svg`);return m.current.has(ne)?`${D}/placeholder.svg`:ne},[S,x]);y.useEffect(()=>{m.current.has(j)||f(!1)},[j]);const C=y.useMemo(()=>typeof r<"u"?!r:!c||!c._id||!(s!=null&&s.viewers)||!Array.isArray(s.viewers)?!1:s.viewers.includes(c._id),[r,c,s]),M=()=>{const D=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6"],ne=x?x.split("").reduce((L,I)=>L+I.charCodeAt(0),0)%D.length:0,K=D[ne],te=A.charAt(0).toUpperCase(),B=64;return o.jsx("div",{className:"story-thumbnail-placeholder flex items-center justify-center rounded-full text-white font-bold",style:{width:`${B}px`,height:`${B}px`,backgroundColor:K,fontSize:`${B/2}px`},children:te})},U=D=>{D.preventDefault(),D.stopPropagation(),typeof t=="function"&&t()};return!s&&!i?null:o.jsxs("div",{className:"story-thumbnail",onClick:U,children:[o.jsx("div",{className:`story-avatar-border ${C?"viewed":""}`,children:o.jsxs("div",{className:"story-image-container rounded-full overflow-hidden",children:[" ",u?M():o.jsx("img",{className:"story-thumbnail-image",src:j,alt:`${A}'s avatar`,onError:D=>{m.current.add(j),f(!0)},crossOrigin:"anonymous",loading:"lazy"})]})}),o.jsx("div",{className:"story-username",children:A})]})},X3=(s,t)=>{let r;return function(){const i=arguments;r||(s.apply(this,i),r=!0,setTimeout(()=>r=!1,t))}},Q3=({onStoryClick:s})=>{const t=Wi()||{},{stories:r=[],loadStories:i,loading:c,hasUnviewedStories:u}=t,[f,m]=y.useState(!0),[v,x]=y.useState(null),[A,S]=y.useState([]),[j,C]=y.useState(!1),M=y.useRef(!1),U=y.useRef(null);y.useEffect(()=>{if(r&&r.length>0){const K=[],te=new Set,B=new Set;r.forEach(E=>{E&&E._id&&!te.has(E._id)&&(te.add(E._id),K.push(E))});const L=[];[...K].sort((E,T)=>new Date(T.createdAt||0)-new Date(E.createdAt||0)).forEach(E=>{const T=E.user?typeof E.user=="string"?E.user:E.user._id:E.userData?E.userData._id:null;T&&!B.has(T)&&(B.add(T),L.push(E))}),S(L)}else S([])},[r]),y.useEffect(()=>{const K=async()=>{if(!M.current){M.current=!0,m(!0),x(null);try{typeof i=="function"?await i(!1):console.warn("Stories functionality is not available - loadStories function not found")}catch(te){console.error("Error loading stories:",te),x("Failed to load stories")}finally{m(!1),M.current=!1,C(!0)}}};!j&&!M.current&&typeof i=="function"&&K()},[i,j]);const D=y.useCallback(X3(K=>{typeof s=="function"?s(K):console.warn("Story click handler not provided")},300),[s]),ne=y.useCallback(K=>{if(!U.current)return;const te=300,B=U.current.scrollLeft;U.current.scrollTo({left:K==="right"?B+te:B-te,behavior:"smooth"})},[]);return(f||c)&&!j?o.jsx("div",{className:"stories-carousel-container",children:o.jsxs("div",{className:"stories-carousel-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading stories..."})]})}):v?o.jsx("div",{className:"stories-carousel-container",children:o.jsx("div",{className:"stories-carousel-error",children:o.jsx("p",{children:v})})}):!A||A.length===0?o.jsx("div",{className:"stories-carousel-container",children:o.jsx("div",{className:"stories-carousel-empty",children:o.jsx("p",{children:"No stories available"})})}):o.jsxs("div",{className:"stories-carousel-container",children:[A.length>4&&o.jsx("button",{className:"carousel-nav-button left",onClick:()=>ne("left"),"aria-label":"Scroll left",children:""}),o.jsx("div",{className:"stories-carousel",ref:U,children:A.map(K=>o.jsx(Jf,{story:K,onClick:()=>D(K._id),hasUnviewedStories:typeof u=="function"&&K.user?u(typeof K.user=="string"?K.user:K.user._id):!1},K._id||`story-${Math.random()}`))}),A.length>4&&o.jsx("button",{className:"carousel-nav-button right",onClick:()=>ne("right"),"aria-label":"Scroll right",children:""})]})},Wf=({storyId:s,userId:t,onClose:r})=>{const{stories:i=[],viewStory:c,loadUserStories:u,loadStories:f,reactToStory:m}=Wi()||{},{user:v}=ti()||{},{user:x,isAuthenticated:A}=Ot()||{},S=x||v,[j,C]=y.useState(0),[M,U]=y.useState(0),[D,ne]=y.useState(!1),[K,te]=y.useState(!1),[B,L]=y.useState(null),[I,E]=y.useState([]),[T,z]=y.useState(!0),[W,H]=y.useState(!1),[q,re]=y.useState(!1),[pe,ce]=y.useState(!1),R=y.useRef(null),Y=100/(5e3/100),P=y.useRef(null),ie=y.useRef(null),J=t?I:i;y.useEffect(()=>{(!i||!i.length)&&f&&f(!0).catch(se=>console.error("Error loading stories:",se))},[i,f]),y.useEffect(()=>{(async()=>{if(!(!t||!u)){te(!0);try{const Ee=await u(t),Ke=[],b=new Set;(Array.isArray(Ee)?Ee:i.filter(g=>{var N;return(typeof g.user=="string"?g.user:(N=g.user)==null?void 0:N._id)===t})).forEach(g=>{g._id&&!b.has(g._id)&&(b.add(g._id),Ke.push(g))}),Ke.length||L("No stories available for this user"),E(Ke)}catch(Ee){console.error("Error loading user stories:",Ee),L("Failed to load stories")}finally{te(!1)}}})()},[t,u,i]),y.useEffect(()=>{if(J.length>0&&j>=0&&j<J.length){const se=J[j];if(console.log("Checking reactions for story:",se==null?void 0:se._id,"User:",S==null?void 0:S._id),se&&se.reactions&&Array.isArray(se.reactions)&&S){const Ee=se.reactions.some(Ke=>Ke.user===S._id||Ke.user&&Ke.user._id===S._id);console.log("Has user reacted:",Ee,"Reactions:",se.reactions),H(Ee)}else H(!1)}},[j,J,S]),y.useEffect(()=>{if(s&&(t?I:i).length){const Ee=(t?I:i).findIndex(Ke=>Ke._id===s);Ee!==-1&&C(Ee)}},[s,t,I,i]),y.useEffect(()=>{if(!c||!J.length)return;const se=J[j];se&&S&&se._id&&c(se._id).catch(Ee=>{console.error("Error marking story as viewed:",Ee)})},[j,J,S,c]),y.useEffect(()=>{if(P.current)if(D)P.current.pause();else{const se=P.current.play();se!==void 0&&se.catch(Ee=>{console.error("Error playing video:",Ee),Ee.name==="NotAllowedError"&&!T&&(z(!0),P.current.muted=!0,P.current.play().catch(Ke=>console.error("Still couldn't play even with mute:",Ke)))})}},[D,j,T]),y.useEffect(()=>{if(D||K||B||!J.length){R.current&&(clearInterval(R.current),R.current=null);return}U(0),R.current&&(clearInterval(R.current),R.current=null);const se=J[j];if(!(se&&(se.mediaType==="video"||se.type==="video")&&P.current))return R.current=setInterval(()=>{U(Ee=>Ee>=100?(clearInterval(R.current),R.current=null,j<J.length-1?C(Ke=>Ke+1):r==null||r(),0):Ee+Y)},100),()=>{R.current&&(clearInterval(R.current),R.current=null)}},[j,J,D,r,K,B,Y]);const ze=y.useCallback(()=>{if(P.current){const se=P.current.duration,Ee=P.current.currentTime;if(se>0){const Ke=Ee/se*100;U(Ke),Ke>=99.5&&(j<J.length-1?C(b=>b+1):r==null||r())}}},[j,J.length,r]),de=y.useCallback(se=>{if(se==null||se.stopPropagation(),se==null||se.preventDefault(),pe){ce(!1);return}q||j>0&&(re(!0),C(Ee=>Ee-1),U(0),setTimeout(()=>re(!1),300))},[j,q,pe]),Z=y.useCallback(se=>{if(se==null||se.stopPropagation(),se==null||se.preventDefault(),pe){ce(!1);return}q||(re(!0),j<J.length-1?(C(Ee=>Ee+1),U(0)):r==null||r(),setTimeout(()=>re(!1),300))},[j,J,r,q,pe]),Te=y.useCallback(se=>{se.stopPropagation(),se.preventDefault(),ce(!0),z(Ee=>{const Ke=!Ee;return P.current&&(P.current.muted=Ke),Ke}),setTimeout(()=>ce(!1),300)},[]),je=y.useCallback(se=>{if(console.log("React button clicked"),se.stopPropagation(),se.preventDefault(),ce(!0),W){console.log("Already reacted to this story"),setTimeout(()=>ce(!1),300);return}if(!A||!S){console.log("User authentication status:",A,"User:",S),X.error("You must be logged in to react to stories"),setTimeout(()=>ce(!1),300);return}if(!J||j>=J.length){setTimeout(()=>ce(!1),300);return}const Ee=J[j];if(!Ee||!Ee._id){setTimeout(()=>ce(!1),300);return}const Ke=Ee._id;Ke&&m?(H(!0),m(Ke,"like").then(b=>{if(!b||!b.success)throw new Error((b==null?void 0:b.message)||"Failed to react to story");if(console.log("Successfully reacted to story"),b.data&&Array.isArray(b.data)){const p=[...J];p[j]&&(p[j].reactions=b.data,t&&E(p))}}).catch(b=>{console.error("Error reacting to story:",b),H(!1),X.error("Failed to react to story")}).finally(()=>{setTimeout(()=>ce(!1),300)})):setTimeout(()=>ce(!1),300)},[S,A,J,j,m,W,t]),Fe=y.useCallback(se=>{ie.current&&ie.current.contains(se.target)||(se.stopPropagation(),se.preventDefault(),ne(Ee=>!Ee))},[]);y.useEffect(()=>{const se=Ee=>{q||(Ee.key==="ArrowLeft"?de():Ee.key==="ArrowRight"||Ee.key===" "||Ee.key==="Spacebar"?Z():Ee.key==="Escape"&&(r==null||r()))};return document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)},[de,Z,r,q]);const Me=y.useCallback(()=>r==null?void 0:r(),[r]),Ue=y.useMemo(()=>({position:"absolute",bottom:"80px",right:"20px",display:"flex",flexDirection:"column",gap:"16px",zIndex:9999,pointerEvents:"auto"}),[]),Le=y.useMemo(()=>({width:"46px",height:"46px",borderRadius:"50%",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",pointerEvents:"auto",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.3)"}),[]),he=y.useMemo(()=>({...Le,color:"var(--primary, #ff3366)",backgroundColor:"rgba(255, 51, 102, 0.2)",transform:"scale(1.1)"}),[Le]),ye=y.useMemo(()=>({pointerEvents:"auto",zIndex:900}),[]),G=y.useMemo(()=>({zIndex:950}),[]),oe=y.useMemo(()=>J&&J.length>0&&j<J.length?J[j]:null,[J,j]),be=y.useMemo(()=>({marginTop:"20px",padding:"10px 20px",background:"#ff3366",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"}),[]),Ne=y.useMemo(()=>({justifyContent:"center",alignItems:"center"}),[]),_e=y.useMemo(()=>K?"loading":B?"error":!J.length||j>=J.length?"empty":oe?"normal":"notAvailable",[K,B,J,j,oe]),Ge=y.useCallback(()=>{if(!J||!J.length||j>=J.length)return"Unknown User";const se=J[j];if(!se)return"Unknown User";const Ee=se.user||se.userData||{};return!Ee||typeof Ee=="string"?"Unknown User":Ee.nickname||Ee.username||Ee.name||"User"},[J,j]),bt=y.useCallback(()=>{if(!J||!J.length||j>=J.length)return"/api/avatars/default";const se=J[j];if(!se)return"/api/avatars/default";const Ee=se.user||se.userData||{};return!Ee||typeof Ee=="string"?"/api/avatars/default":Ee.profilePicture||Ee.avatar||`/api/avatars/${Ee._id||"default"}`},[J,j]),ut=y.useCallback(()=>{if(!J||!J.length||j>=J.length)return"Recently";const se=J[j];if(!se||!se.createdAt)return"Recently";try{return new Date(se.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return"Recently"}},[J,j]),St=y.useCallback(()=>{var Ee,Ke;if(!J||!J.length||j>=J.length)return o.jsx("div",{className:"stories-text-content",children:o.jsx("p",{children:"No story available"})});const se=J[j];if(!se)return o.jsx("div",{className:"stories-text-content",children:o.jsx("p",{children:"Story not found"})});if(se.mediaType==="text"||se.type==="text"){const b={};return se.backgroundStyle?b.background=se.backgroundStyle:se.backgroundColor&&(b.background=se.backgroundColor),se.fontStyle&&(b.fontFamily=se.fontStyle),o.jsxs("div",{className:"stories-text-content",style:b,children:[o.jsx("div",{className:"story-user-overlay",children:o.jsx("span",{className:"story-nickname",children:Ge()})}),se.text||se.content||"",D&&o.jsx("div",{className:"pause-indicator",children:o.jsx(Ja,{size:24})})]})}if(((Ee=se.mediaType)!=null&&Ee.startsWith("image")||se.type==="image")&&(se.mediaUrl||se.media)){const b=se.mediaUrl||se.media;return o.jsxs("div",{className:"stories-image-container",children:[o.jsx("div",{className:"story-user-overlay",children:o.jsx("span",{className:"story-nickname",children:Ge()})}),o.jsx("img",{src:b||"/placeholder.svg",alt:"Story",className:"stories-media",crossOrigin:"anonymous",loading:"lazy",decoding:"async",onError:p=>{p.target.onerror=null,p.target.src="/placeholder.svg"}}),D&&o.jsx("div",{className:"pause-indicator",children:o.jsx(Ja,{size:24})}),se.content&&se.content.trim()&&o.jsx("div",{className:"story-caption",children:se.content})]})}if(((Ke=se.mediaType)!=null&&Ke.startsWith("video")||se.type==="video")&&(se.mediaUrl||se.media)){const b=se.mediaUrl||se.media;return o.jsxs("div",{className:"stories-video-container",children:[o.jsx("div",{className:"story-user-overlay",children:o.jsx("span",{className:"story-nickname",children:Ge()})}),o.jsx("video",{ref:P,src:b,className:"stories-media",autoPlay:!0,muted:T,loop:!1,playsInline:!0,crossOrigin:"anonymous",onTimeUpdate:ze,onError:p=>{console.error("Video failed to load:",p)}}),D&&o.jsx("div",{className:"pause-indicator",children:o.jsx(Ja,{size:24})}),o.jsx("button",{className:"video-control mute-button",onClick:Te,"aria-label":T?"Unmute video":"Mute video",children:T?o.jsx(P4,{size:16}):o.jsx($4,{size:16})}),se.content&&se.content.trim()&&o.jsx("div",{className:"story-caption",children:se.content})]})}return o.jsxs("div",{className:"stories-text-content",children:[o.jsx("div",{className:"story-user-overlay",children:o.jsx("span",{className:"story-nickname",children:Ge()})}),o.jsx("p",{children:se.text||se.content||"No content available"}),D&&o.jsx("div",{className:"pause-indicator",children:o.jsx(Ja,{size:24})})]})},[J,j,D,T,Ge,ze,Te]);y.useCallback(()=>St(),[St]);const Nt=y.useMemo(()=>o.jsxs("div",{className:"stories-viewer-container",style:Ne,children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{style:{color:"white"},children:"Loading stories..."})]}),[Ne]),Mt=y.useMemo(()=>o.jsxs("div",{className:"stories-viewer-container",style:Ne,children:[o.jsx("p",{style:{color:"white"},children:B}),o.jsx("button",{onClick:Me,style:be,children:"Close"})]}),[B,Me,Ne,be]),ue=y.useMemo(()=>o.jsxs("div",{className:"stories-viewer-container",style:Ne,children:[o.jsx("p",{style:{color:"white"},children:"No stories available"}),o.jsx("button",{onClick:Me,style:be,children:"Close"})]}),[Me,Ne,be]),Re=y.useMemo(()=>o.jsxs("div",{className:"stories-viewer-container",style:Ne,children:[o.jsx("p",{style:{color:"white"},children:"Story not available"}),o.jsx("button",{onClick:Me,style:be,children:"Close"})]}),[Me,Ne,be]),De=y.useMemo(()=>o.jsxs("div",{className:"stories-viewer-container",children:[o.jsxs("div",{className:"stories-viewer-header",children:[o.jsx("div",{className:"stories-progress-container",children:J.map((se,Ee)=>o.jsx("div",{className:`stories-progress-bar ${Ee<j?"completed":""}`,children:Ee===j&&o.jsx("div",{className:"stories-progress-fill",style:{width:`${M}%`}})},Ee))}),o.jsxs("div",{className:"stories-user-info",children:[o.jsx("img",{src:bt()||"/placeholder.svg",alt:Ge(),className:"stories-user-avatar",loading:"lazy",crossOrigin:"anonymous",onError:se=>{se.target.onerror=null,se.target.src="/placeholder.svg"}}),o.jsxs("div",{className:"stories-user-details",children:[o.jsx("span",{className:"stories-username",children:Ge()}),o.jsx("span",{className:"stories-timestamp",children:ut()})]})]}),o.jsx("button",{className:"stories-close-btn",onClick:Me,"aria-label":"Close stories",children:""})]}),o.jsx("div",{className:"stories-viewer-content",onClick:se=>{se.target===se.currentTarget&&Fe(se)},children:St()}),o.jsxs("div",{className:"stories-viewer-navigation",style:ye,children:[o.jsx("div",{className:"stories-nav-left",onClick:de,"aria-label":"Previous story",style:G}),o.jsx("div",{className:"stories-nav-right",onClick:Z,"aria-label":"Next story",style:G})]}),o.jsxs("div",{ref:ie,className:"stories-actions",style:Ue,onClick:se=>{se.stopPropagation(),se.preventDefault(),ce(!0)},children:[o.jsx("button",{className:`story-action-button ${W?"active":""}`,style:W?he:Le,onClick:je,"aria-label":"Like story",children:W?o.jsx(Xs,{size:20}):o.jsx(q4,{size:20})}),o.jsx("button",{className:"story-action-button",style:Le,onClick:se=>{se.stopPropagation(),se.preventDefault(),ce(!0),X.info("Comments feature coming soon!"),setTimeout(()=>ce(!1),300)},"aria-label":"Comment on story",children:o.jsx(ea,{size:20})}),o.jsx("button",{className:"story-action-button",style:Le,onClick:se=>{se.stopPropagation(),se.preventDefault(),ce(!0),X.info("Share feature coming soon!"),setTimeout(()=>ce(!1),300)},"aria-label":"Share story",children:o.jsx(M4,{size:20})}),o.jsx("button",{className:"story-action-button",style:Le,onClick:se=>{se.stopPropagation(),se.preventDefault(),ce(!0),Fe(se),setTimeout(()=>ce(!1),300)},"aria-label":D?"Play story":"Pause story",children:D?o.jsx(Ja,{size:20}):o.jsx(N4,{size:20})})]})]}),[J,j,M,bt,Ge,ut,Me,Fe,St,ye,de,Z,G,Ue,ce,W,he,Le,je,D]);return o.jsxs("div",{className:"stories-viewer-overlay",children:[_e==="loading"&&Nt,_e==="error"&&Mt,_e==="empty"&&ue,_e==="notAvailable"&&Re,_e==="normal"&&De]})},SA=[{id:"gradient-1",name:"Sunset",style:"linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)"},{id:"gradient-2",name:"Ocean",style:"linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"},{id:"gradient-3",name:"Passion",style:"linear-gradient(135deg, #f6d365 0%, #fda085 100%)"},{id:"gradient-4",name:"Midnight",style:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)"},{id:"gradient-5",name:"Forest",style:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},{id:"gradient-6",name:"Berry",style:"linear-gradient(135deg, #c471f5 0%, #fa71cd 100%)"},{id:"gradient-7",name:"Dusk",style:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{id:"gradient-8",name:"Fire",style:"linear-gradient(135deg, #f83600 0%, #f9d423 100%)"}],wA=[{id:"font-1",name:"Classic",style:"'Helvetica', sans-serif"},{id:"font-2",name:"Elegant",style:"'Georgia', serif"},{id:"font-3",name:"Modern",style:"'Montserrat', sans-serif"},{id:"font-4",name:"Playful",style:"'Comic Sans MS', cursive"},{id:"font-5",name:"Bold",style:"'Impact', sans-serif"}],K3=({onClose:s,onSubmit:t})=>{const{user:r}=Ot(),{createStory:i}=Wi(),[c,u]=y.useState(""),[f,m]=y.useState(SA[0]),[v,x]=y.useState(wA[0]),[A,S]=y.useState(!1),[j,C]=y.useState(0),[M,U]=y.useState(""),[D,ne]=y.useState("text"),[K,te]=y.useState(null),[B,L]=y.useState(null),[I,E]=y.useState("text"),[T,z]=y.useState(!1),W=y.useRef(null),H=y.useRef(null),q=P=>{if(T||A)return;const ie=P.target.files[0];if(!ie)return;if(ie.type.startsWith("image/"))E("image");else if(ie.type.startsWith("video/"))E("video");else{X.error("Unsupported file type. Please upload an image or video.");return}if(ie.size>10*1024*1024){X.error("File is too large. Maximum size is 10MB.");return}te(ie);const J=new FileReader;J.onloadend=()=>{L(J.result)},J.readAsDataURL(ie),ne(ie.type.startsWith("image/")?"image":"video")},re=P=>{H.current&&!T&&!A&&(H.current.accept=P==="image"?"image/*":"video/*",H.current.click())},pe=()=>{T||A||(te(null),L(null),E("text"),ne("text"))},ce=async()=>{if(T||A){X.info("Please wait, your story is being created...");return}if(I==="text"&&!c.trim()){X.error("Please add some text to your story");return}if((I==="image"||I==="video")&&!K){X.error(`Please select a ${I} file`);return}if(!r){X.error("You must be logged in to create a story");return}U(""),S(!0),z(!0),C(0);try{let P,ie;if(I==="text")P={content:c.trim(),text:c.trim(),backgroundStyle:f.style,backgroundColor:f.style,fontStyle:v.style,mediaType:"text",type:"text"},ie=await i(P,R);else{const J=new FormData;J.append("media",K),J.append("type",I),J.append("mediaType",I),c.trim()&&(J.append("content",c.trim()),J.append("text",c.trim())),ie=await i(J,R)}ie&&ie.success?(X.success("Story created successfully!"),t&&ie.data?t(ie.data):t&&t(ie),s==null||s()):U((ie==null?void 0:ie.message)||"Failed to create story")}catch(P){console.error("Error creating story:",P),U(P.message||"An error occurred"),X.error(P.message||"An error occurred")}finally{S(!1),z(!1)}},R=P=>{if(P&&typeof P=="number")C(P);else if(P&&P.total>0){const ie=Math.round(P.loaded*100/P.total);C(ie)}},Q=y.useCallback(P=>({background:P.style}),[]),Y=y.useCallback(P=>({fontFamily:P.style}),[]);return y.useEffect(()=>{const P=ie=>{ie.key==="Escape"&&!A&&!T&&(s==null||s())};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[s,A,T]),o.jsxs("div",{className:"story-creator-container",children:[o.jsx("div",{className:"story-creator-overlay",onClick:A||T?null:s}),o.jsxs("div",{className:"story-creator",children:[o.jsxs("div",{className:"creator-header",children:[o.jsx("h2",{children:"Create Story"}),o.jsx("button",{className:"close-button",onClick:A||T?null:s,disabled:A||T,children:o.jsx(xn,{})})]}),o.jsxs("div",{className:"creator-content",children:[o.jsxs("div",{className:"story-preview",ref:W,style:I==="text"?{...Q(f),...Y(v)}:{},children:[I==="text"?c?o.jsx("div",{className:"story-text-content",children:c}):o.jsx("div",{className:"story-placeholder",children:"Type something amazing..."}):B?I==="image"?o.jsx("img",{src:B||"/placeholder.svg",alt:"Story preview",className:"media-preview"}):o.jsx("video",{src:B,className:"media-preview",autoPlay:!0,muted:!0,loop:!0}):o.jsxs("div",{className:"story-placeholder",children:["Select a ",I," file..."]}),(I==="image"||I==="video")&&c&&o.jsx("div",{className:"story-caption",children:c})]}),o.jsxs("div",{className:"story-creator-tabs",children:[o.jsxs("button",{className:`tab-button ${D==="text"?"active":""}`,onClick:P=>{P.stopPropagation(),!T&&!A&&(ne("text"),E("text"),te(null),L(null))},disabled:T||A,children:[o.jsx(eA,{})," Text"]}),o.jsxs("button",{className:`tab-button ${D==="image"?"active":""}`,onClick:P=>{P.stopPropagation(),!T&&!A&&re("image")},disabled:T||A,children:[o.jsx(Ao,{})," Image"]}),o.jsxs("button",{className:`tab-button ${D==="video"?"active":""}`,onClick:P=>{P.stopPropagation(),!T&&!A&&re("video")},disabled:T||A,children:[o.jsx(Jr,{})," Video"]}),I==="text"&&o.jsxs("button",{className:`tab-button ${D==="background"?"active":""}`,onClick:P=>{P.stopPropagation(),!T&&!A&&ne("background")},disabled:T||A,children:[o.jsx(df,{})," Background"]}),I==="text"&&o.jsxs("button",{className:`tab-button ${D==="font"?"active":""}`,onClick:P=>{P.stopPropagation(),!T&&!A&&ne("font")},disabled:T||A,children:[o.jsx(eA,{})," Font"]})]}),o.jsx("input",{type:"file",ref:H,style:{display:"none"},onChange:q,accept:"image/*,video/*",disabled:T||A}),o.jsxs("div",{className:"tab-content",children:[D==="text"&&o.jsxs("div",{className:"text-tab",children:[o.jsx("textarea",{value:c,onChange:P=>u(P.target.value),placeholder:I==="text"?"What's on your mind?":"Add a caption (optional)",maxLength:I==="text"?150:100,rows:I==="text"?3:2,disabled:T||A}),o.jsxs("small",{className:"character-count",children:[c.length,"/",I==="text"?150:100]})]}),D==="background"&&I==="text"&&o.jsx("div",{className:"background-tab",children:o.jsx("div",{className:"background-options",children:SA.map(P=>o.jsx("div",{className:`background-option ${f.id===P.id?"selected":""}`,style:Q(P),onClick:()=>{!T&&!A&&m(P)},title:P.name},P.id))})}),D==="font"&&I==="text"&&o.jsx("div",{className:"font-tab",children:o.jsx("div",{className:"font-options",children:wA.map(P=>o.jsx("div",{className:`font-option ${v.id===P.id?"selected":""}`,style:Y(P),onClick:()=>{!T&&!A&&x(P)},children:P.name},P.id))})}),(D==="image"||D==="video")&&B&&o.jsx("div",{className:"media-tab",children:o.jsxs("button",{className:"clear-media-btn",onClick:pe,disabled:T||A,children:["Clear ",I]})})]}),M&&o.jsx("div",{className:"error-message",children:M})]}),o.jsxs("div",{className:"creator-footer",children:[A?o.jsxs("div",{className:"upload-progress",children:[o.jsx("div",{className:"progress-bar-container",children:o.jsx("div",{className:"progress-bar",style:{width:`${j}%`}})}),o.jsxs("span",{children:[j,"%"]})]}):o.jsx("button",{className:"btn btn-primary create-button",onClick:ce,disabled:A||T||I==="text"&&!c.trim()||(I==="image"||I==="video")&&!K,children:T?o.jsxs(o.Fragment,{children:[o.jsx(Ln,{className:"spinner-icon"}),o.jsx("span",{children:"Creating..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(pt,{}),o.jsx("span",{children:"Create Story"})]})}),o.jsx("button",{className:"btn btn-outline cancel-button",onClick:s,disabled:A||T,children:"Cancel"})]})]})]})},Bd={LOOKING_FOR:"lookingFor",INTO:"into",INTEREST:"interest"},I1=({user:s,isLiked:t=!1,onLike:r,viewMode:i="grid",onMessage:c,onClick:u,showExtendedDetails:f=!0,unreadMessageCount:m=0,hasUnreadMessages:v=!1})=>{var T,z,W,H;const[x,A]=y.useState(!1),[S,j]=y.useState(!1),C=mn();y.useCallback(q=>{switch(q){case Bd.LOOKING_FOR:return"looking-for-tag";case Bd.INTO:return"into-tag";case Bd.INTEREST:return"interest-tag";default:return"interest-tag"}},[]);const M=y.useCallback(()=>{u?u():C(`/user/${s._id}`)},[u,C,s==null?void 0:s._id]),U=y.useCallback(q=>{q.stopPropagation(),q.preventDefault(),r&&(Rt.debug(`Like button clicked for user ${s._id}, current isLiked: ${t}`),r(s._id,s.nickname))},[r,s==null?void 0:s._id,s==null?void 0:s.nickname,t]),D=y.useCallback(q=>{q.stopPropagation(),c&&c(q,s)},[c,s]),ne=y.useCallback(q=>{q==null||q.stopPropagation(),A(re=>!re)},[]),K=y.useCallback(q=>{q==null||q.stopPropagation(),j(re=>!re)},[]),te=y.useMemo(()=>{var q,re;return(q=s==null?void 0:s.photos)!=null&&q.length?(re=s.photos[0])==null?void 0:re.url:null},[s==null?void 0:s.photos]);y.useMemo(()=>{if(!(s!=null&&s.details))return"";const{age:q,gender:re,location:pe}=s.details,ce=[];return q&&ce.push(q),re&&ce.push(re),pe&&ce.push(pe),ce.join("  ")},[s==null?void 0:s.details]);const B=y.useMemo(()=>{if(!(s!=null&&s.details))return{status:null,identity:null};const q={status:null,identity:null},{maritalStatus:re,iAm:pe}=s.details;return re&&(q.status=re),pe&&(q.identity=pe),q},[s==null?void 0:s.details]),L=y.useMemo(()=>{if(!(s!=null&&s.details))return[];const q={lookingFor:[],into:[],interests:[]},{lookingFor:re=[],intoTags:pe=[],interests:ce=[]}=s.details;return re.forEach(R=>q.lookingFor.push(R)),pe.forEach(R=>q.into.push(R)),ce.forEach(R=>q.interests.push(R)),q},[s==null?void 0:s.details]),I=y.useMemo(()=>s!=null&&s.isOnline?"Active now":s!=null&&s.lastActive?Gs(s.lastActive,{showRelative:!0,showTime:!1,showDate:!1}):"Never active",[s==null?void 0:s.lastActive,s==null?void 0:s.isOnline]);if(!s)return null;const E=()=>o.jsxs(o.Fragment,{children:[o.jsxs("button",{onClick:U,"aria-label":`${t?"Unlike":"Like"} ${s.nickname}`,className:`action-btn like-btn ${t?"active":""}`,children:[o.jsx(Xs,{size:18}),t?"Liked":"Like"]}),o.jsxs("button",{onClick:D,"aria-label":`Message ${s.nickname}`,className:"action-btn message-btn",children:[o.jsx(ea,{size:18}),"Message"]})]});return i==="grid"?o.jsxs(B1,{className:"user-card",onClick:M,hover:!0,headerClassName:"user-card-header",bodyClassName:"user-card-body",children:[o.jsx("div",{className:"user-card-photo",children:o.jsx(ei,{src:te,alt:s.nickname,size:"large",status:s.isOnline?"online":null,showFallback:!0,statusPosition:"top-right"})}),o.jsxs("div",{className:"user-card-info",children:[o.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[o.jsxs("h3",{className:"user-card-name",children:[s.nickname,((T=s.details)==null?void 0:T.age)&&o.jsxs("span",{children:[", ",s.details.age]})]}),v&&o.jsx("span",{className:"unread-badge",children:m})]}),o.jsxs("p",{className:"user-card-last-active",children:[o.jsx(Wg,{style:{marginRight:"4px",fontSize:"0.8em",opacity:.7}}),I]}),o.jsxs("p",{className:"location",children:[o.jsx(uo,{className:"location-icon"}),((z=s.details)==null?void 0:z.location)||"Unknown location"]}),f&&o.jsx("div",{className:"user-tags-container extended-details-container",children:o.jsxs("div",{className:"extended-details-row",children:[B.identity&&o.jsxs("div",{className:"extended-detail-item",children:[o.jsx("span",{className:"detail-label",children:"I am:"}),o.jsx("span",{className:`interest-tag identity-tag ${B.identity.toLowerCase().includes("woman")?"identity-woman":B.identity.toLowerCase().includes("man")?"identity-man":B.identity.toLowerCase().includes("couple")?"identity-couple":""}`,children:B.identity})]}),L.lookingFor.length>0&&o.jsxs("div",{className:"extended-detail-item",children:[o.jsx("span",{className:"detail-label",children:"Into:"}),o.jsx("span",{className:`interest-tag ${L.lookingFor[0].toLowerCase().includes("women")||L.lookingFor[0].toLowerCase().includes("woman")?"identity-woman":L.lookingFor[0].toLowerCase().includes("men")||L.lookingFor[0].toLowerCase().includes("man")?"identity-man":L.lookingFor[0].toLowerCase().includes("couple")?"identity-couple":"looking-for-tag"}`,children:L.lookingFor[0]}),L.lookingFor.length>1&&o.jsxs("span",{className:"more-count",children:["+",L.lookingFor.length-1]})]})]})}),f&&o.jsxs("div",{className:"user-tags-container",children:[(L.lookingFor.length>0||L.into.length>0||L.interests.length>0)&&o.jsx("div",{className:"tags-toggle",children:o.jsx("span",{className:"tags-toggle-btn",onClick:K,children:S?"Show less":"Show more"})}),S&&o.jsxs(o.Fragment,{children:[L.interests.length>0&&o.jsxs("div",{className:"tag-category",children:[o.jsx("h4",{className:"tag-category-title",children:"Interests"}),o.jsxs("div",{className:"user-interests",children:[(x?L.interests:L.interests.slice(0,3)).map((q,re)=>o.jsx("span",{className:`interest-tag ${q.toLowerCase().includes("women")||q.toLowerCase().includes("woman")?"identity-woman":q.toLowerCase().includes("men")||q.toLowerCase().includes("man")?"identity-man":q.toLowerCase().includes("couple")?"identity-couple":""}`,children:q},`interest-${re}`)),L.interests.length>3&&!x&&o.jsxs("span",{className:"interest-more",onClick:ne,children:["+",L.interests.length-3]})]})]}),L.into.length>0&&o.jsxs("div",{className:"tag-category",children:[o.jsx("h4",{className:"tag-category-title",children:"Preferences"}),o.jsxs("div",{className:"user-interests",children:[(x?L.into:L.into.slice(0,3)).map((q,re)=>o.jsx("span",{className:`interest-tag ${q.toLowerCase().includes("women")||q.toLowerCase().includes("woman")?"identity-woman":q.toLowerCase().includes("men")||q.toLowerCase().includes("man")?"identity-man":q.toLowerCase().includes("couple")?"identity-couple":"into-tag"}`,children:q},`into-${re}`)),L.into.length>3&&!x&&o.jsxs("span",{className:"interest-more",onClick:ne,children:["+",L.into.length-3]})]})]}),(L.lookingFor.length>3||L.into.length>3||L.interests.length>3)&&o.jsx("div",{className:"tags-toggle",children:o.jsx("span",{className:"tags-toggle-btn",onClick:ne,children:x?"Show less tags":"Show all tags"})})]})]}),o.jsx("div",{className:"user-actions",children:E()})]})]}):o.jsxs("div",{className:"user-list-item",onClick:M,children:[o.jsx("div",{className:"user-list-photo-container",children:o.jsx(ei,{src:te,alt:s.nickname,size:"medium",status:s.isOnline?"online":null,showFallback:!0,statusPosition:"top-right"})}),o.jsxs("div",{className:"user-list-info",children:[o.jsxs("div",{className:"user-list-header",children:[o.jsxs("h3",{className:"user-list-name",children:[s.nickname,((W=s.details)==null?void 0:W.age)&&o.jsxs("span",{children:[", ",s.details.age]})]}),v&&o.jsx("span",{className:"unread-badge",children:m})]}),o.jsxs("p",{className:"user-list-last-active",children:[o.jsx(Wg,{style:{marginRight:"4px",fontSize:"0.8em",opacity:.7}}),I]}),o.jsxs("p",{className:"location",children:[o.jsx(uo,{className:"location-icon"}),((H=s.details)==null?void 0:H.location)||"Unknown location"]}),f&&o.jsx("div",{className:"user-tags-container extended-details-container list-view",children:o.jsxs("div",{className:"extended-details-row",children:[B.identity&&o.jsxs("div",{className:"extended-detail-item",children:[o.jsx("span",{className:"detail-label",children:"I am:"}),o.jsx("span",{className:`interest-tag identity-tag ${B.identity.toLowerCase().includes("woman")?"identity-woman":B.identity.toLowerCase().includes("man")?"identity-man":B.identity.toLowerCase().includes("couple")?"identity-couple":""}`,children:B.identity})]}),L.lookingFor.length>0&&o.jsxs("div",{className:"extended-detail-item",children:[o.jsx("span",{className:"detail-label",children:"Into:"}),o.jsx("span",{className:`interest-tag ${L.lookingFor[0].toLowerCase().includes("women")||L.lookingFor[0].toLowerCase().includes("woman")?"identity-woman":L.lookingFor[0].toLowerCase().includes("men")||L.lookingFor[0].toLowerCase().includes("man")?"identity-man":L.lookingFor[0].toLowerCase().includes("couple")?"identity-couple":"looking-for-tag"}`,children:L.lookingFor[0]}),L.lookingFor.length>1&&o.jsxs("span",{className:"more-count",children:["+",L.lookingFor.length-1]})]})]})}),f&&o.jsxs("div",{className:"user-tags-container list-view",children:[(L.lookingFor.length>0||L.into.length>0||L.interests.length>0)&&o.jsx("div",{className:"tags-toggle",children:o.jsx("span",{className:"tags-toggle-btn",onClick:K,children:S?"Show less":"Show more"})}),S&&o.jsxs(o.Fragment,{children:[L.interests.length>0&&o.jsxs("div",{className:"tag-category",children:[o.jsx("h4",{className:"tag-category-title",children:"Interests"}),o.jsxs("div",{className:"user-interests",children:[(x?L.interests:L.interests.slice(0,2)).map((q,re)=>o.jsx("span",{className:`interest-tag ${q.toLowerCase().includes("women")||q.toLowerCase().includes("woman")?"identity-woman":q.toLowerCase().includes("men")||q.toLowerCase().includes("man")?"identity-man":q.toLowerCase().includes("couple")?"identity-couple":""}`,children:q},`interest-${re}`)),L.interests.length>2&&!x&&o.jsxs("span",{className:"interest-more",onClick:ne,children:["+",L.interests.length-2]})]})]}),L.into.length>0&&o.jsxs("div",{className:"tag-category",children:[o.jsx("h4",{className:"tag-category-title",children:"Preferences"}),o.jsxs("div",{className:"user-interests",children:[(x?L.into:L.into.slice(0,2)).map((q,re)=>o.jsx("span",{className:`interest-tag ${q.toLowerCase().includes("women")||q.toLowerCase().includes("woman")?"identity-woman":q.toLowerCase().includes("men")||q.toLowerCase().includes("man")?"identity-man":q.toLowerCase().includes("couple")?"identity-couple":"into-tag"}`,children:q},`into-${re}`)),L.into.length>2&&!x&&o.jsxs("span",{className:"interest-more",onClick:ne,children:["+",L.into.length-2]})]})]}),(L.lookingFor.length>2||L.into.length>2||L.interests.length>2)&&o.jsx("div",{className:"tags-toggle",children:o.jsx("span",{className:"tags-toggle-btn",onClick:ne,children:x?"Show less tags":"Show all tags"})})]})]})]}),o.jsx("div",{className:"user-list-actions",children:E()})]})};I1.propTypes={user:Ae.shape({_id:Ae.string.isRequired,nickname:Ae.string.isRequired,isOnline:Ae.bool,lastActive:Ae.string,photos:Ae.arrayOf(Ae.shape({url:Ae.string})),details:Ae.shape({age:Ae.oneOfType([Ae.number,Ae.string]),gender:Ae.string,location:Ae.string,maritalStatus:Ae.string,iAm:Ae.string,lookingFor:Ae.arrayOf(Ae.string),intoTags:Ae.arrayOf(Ae.string),interests:Ae.arrayOf(Ae.string)})}).isRequired,isLiked:Ae.bool,onLike:Ae.func,viewMode:Ae.oneOf(["grid","list"]),onMessage:Ae.func,onClick:Ae.func,showExtendedDetails:Ae.bool,unreadMessageCount:Ae.number,hasUnreadMessages:Ae.bool};const Z3=q3(I1,(s,t)=>s.user._id===t.user._id&&s.isLiked===t.isLiked&&s.viewMode===t.viewMode&&s.hasUnreadMessages===t.hasUnreadMessages&&s.unreadMessageCount===t.unreadMessageCount&&s.user.isOnline===t.user.isOnline,{debug:!1}),J3=({recipient:s,onClose:t,onVideoCall:r,embedded:i=!0})=>{var c,u;return o.jsxs("div",{className:"chat-header",children:[!i&&o.jsx("button",{className:"mobile-back-button",onClick:t,"aria-label":"Back",children:o.jsx(dc,{})}),o.jsxs("div",{className:"recipient-info",children:[o.jsx(ei,{src:(u=(c=s==null?void 0:s.photos)==null?void 0:c[0])!=null&&u.url?Zi(s.photos[0].url):null,name:(s==null?void 0:s.nickname)||"User",size:"medium",showStatus:!0,isOnline:s==null?void 0:s.isOnline}),o.jsxs("div",{className:"recipient-details",children:[o.jsx("div",{className:"recipient-name",children:(s==null?void 0:s.nickname)||"User"}),o.jsx("div",{className:"recipient-status",children:s!=null&&s.isOnline?"Online":"Offline"})]})]}),o.jsxs("div",{className:"header-actions",children:[o.jsx("button",{className:"video-call-button",onClick:r,"aria-label":"Video call",children:o.jsx(Jr,{})}),i&&o.jsx("button",{className:"close-button",onClick:t,"aria-label":"Close chat",children:o.jsx(xn,{})})]}),o.jsx("style",{jsx:!0,children:`
        .chat-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 0.75rem 1rem;
          background-color: var(--primary);
          color: white;
          border-top-left-radius: 10px;
          border-top-right-radius: 10px;
          position: relative;
        }
        
        .recipient-info {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
        
        .recipient-details {
          display: flex;
          flex-direction: column;
        }
        
        .recipient-name {
          font-weight: 600;
          font-size: 1rem;
        }
        
        .recipient-status {
          font-size: 0.75rem;
          opacity: 0.8;
        }
        
        .header-actions {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
        
        .video-call-button,
        .close-button,
        .mobile-back-button {
          background: none;
          border: none;
          color: white;
          font-size: 1.1rem;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: background-color 0.2s;
        }
        
        .video-call-button:hover,
        .close-button:hover,
        .mobile-back-button:hover {
          background-color: rgba(255, 255, 255, 0.2);
        }
        
        .mobile-back-button {
          position: absolute;
          left: 10px;
          display: none;
        }
        
        /* Mobile adjustments */
        @media (max-width: 768px) {
          .chat-header {
            padding-left: 3rem;
          }
          
          .mobile-back-button {
            display: flex;
          }
        }
        
        /* Dark mode adjustments not needed as header is already dark */
      `})]})},kA=({message:s})=>{const t=r=>{if(!r)return"";const i=/(https?:\/\/[^\s]+)/g;return r.split(i).map((u,f)=>u.match(i)?o.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"message-link",children:u},f):u)};return o.jsxs("div",{className:"text-message",children:[t(s.content),o.jsx("style",{jsx:!0,children:`
        .text-message {
          font-size: 0.95rem;
          line-height: 1.4;
          white-space: pre-wrap;
        }
        
        :global(.message-link) {
          color: var(--primary);
          text-decoration: underline;
          word-break: break-all;
        }
        
        :global(.message-link:hover) {
          text-decoration: none;
        }
        
        /* Dark mode */
        .dark :global(.message-link) {
          color: var(--primary-light);
        }
      `})]})},W3=({message:s})=>{const{fileUrl:t,fileName:r="File",fileSize:i,mimeType:c,dimensions:u}=s.metadata||{},f=x=>{if(!x||isNaN(x))return"";const A=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(x)/Math.log(1024));return`${Math.round(x/Math.pow(1024,S))} ${A[S]}`},m=()=>c?c.startsWith("image/")?o.jsx(Ao,{}):c.startsWith("text/")?o.jsx(af,{}):c.includes("pdf")?o.jsx(lf,{}):c.startsWith("audio/")?o.jsx(of,{}):c.startsWith("video/")?o.jsx(cf,{}):o.jsx(uf,{}):o.jsx(uf,{}),v=()=>c&&c.startsWith("image/")&&t?o.jsx("div",{className:"image-preview",children:o.jsx("img",{src:t.startsWith("http")?t:`${window.location.origin}${t}`,alt:r,loading:"lazy"})}):o.jsxs("div",{className:"file-preview",children:[o.jsx("div",{className:"file-icon",children:m()}),o.jsxs("div",{className:"file-info",children:[o.jsx("div",{className:"file-name",children:r}),i&&o.jsx("div",{className:"file-size",children:f(i)})]}),o.jsx("a",{href:t.startsWith("http")?t:`${window.location.origin}${t}`,target:"_blank",rel:"noopener noreferrer",className:"download-icon",title:"Download file",children:o.jsx(b4,{})})]});return o.jsxs("div",{className:"file-message",children:[v(),o.jsx("style",{jsx:!0,children:`
        .file-message {
          width: 100%;
        }
        
        .image-preview {
          max-width: 300px;
          max-height: 300px;
          overflow: hidden;
          border-radius: 8px;
        }
        
        .image-preview img {
          width: 100%;
          height: auto;
          object-fit: contain;
          display: block;
        }
        
        .file-preview {
          display: flex;
          align-items: center;
          padding: 0.5rem;
          background-color: rgba(0, 0, 0, 0.03);
          border-radius: 8px;
          gap: 0.5rem;
        }
        
        .file-icon {
          font-size: 1.5rem;
          color: var(--primary);
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .file-info {
          flex: 1;
          min-width: 0;
        }
        
        .file-name {
          font-weight: 500;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 170px;
        }
        
        .file-size {
          font-size: 0.75rem;
          color: var(--text-light);
        }
        
        .download-icon {
          font-size: 1rem;
          color: var(--text-light);
          padding: 0.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          background-color: transparent;
          transition: background-color 0.2s;
        }
        
        .download-icon:hover {
          background-color: rgba(0, 0, 0, 0.05);
          color: var(--primary);
        }
        
        /* Dark mode */
        .dark .file-preview {
          background-color: rgba(255, 255, 255, 0.05);
        }
        
        .dark .download-icon:hover {
          background-color: rgba(255, 255, 255, 0.1);
        }
      `})]})},e6=({message:s})=>o.jsxs("div",{className:"video-call-message",children:[o.jsx(Jr,{className:"video-icon"}),o.jsx("div",{className:"video-message-text",children:s.content||"Video Call"}),o.jsx("style",{jsx:!0,children:`
        .video-call-message {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: 500;
        }
        
        .video-icon {
          font-size: 1.2rem;
          color: var(--primary);
        }
        
        .video-message-text {
          font-size: 0.95rem;
        }
        
        /* Dark mode */
        .dark .video-icon {
          color: var(--primary-light);
        }
      `})]}),t6=({message:s})=>o.jsxs("div",{className:"wink-message",children:[o.jsx("span",{className:"wink-emoji",role:"img","aria-label":"wink",children:""}),o.jsx("div",{className:"wink-text",children:"Sent a wink"}),o.jsx("style",{jsx:!0,children:`
        .wink-message {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }
        
        .wink-emoji {
          font-size: 1.5rem;
          animation: pulse 1.5s infinite;
        }
        
        .wink-text {
          font-size: 0.9rem;
          color: var(--text-medium);
        }
        
        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.2); }
          100% { transform: scale(1); }
        }
      `})]}),n6=({message:s,isCurrentUser:t,showAvatar:r=!0,recipient:i,isPending:c=!1})=>{var m,v;const u=()=>{switch(s.type){case"text":return o.jsx(kA,{message:s});case"file":return o.jsx(W3,{message:s});case"video":return o.jsx(e6,{message:s});case"wink":return o.jsx(t6,{message:s});default:return o.jsx(kA,{message:s})}},f=()=>c?o.jsx(Ln,{className:"message-status-icon spin"}):s.status==="error"?o.jsx("span",{className:"message-status-icon error",children:"!"}):t?s.read?o.jsx(T0,{className:"message-status-icon read"}):o.jsx(pt,{className:"message-status-icon sent"}):null;return o.jsxs("div",{className:Zr("message-container",t?"sent":"received",c?"pending":"",s.status==="error"?"error":""),children:[!t&&r&&o.jsx("div",{className:"message-avatar",children:o.jsx(ei,{src:(v=(m=i==null?void 0:i.photos)==null?void 0:m[0])!=null&&v.url?Zi(i.photos[0].url):null,name:(i==null?void 0:i.nickname)||"User",size:"small"})}),o.jsx("div",{className:"message-content-wrapper",children:o.jsxs("div",{className:"message-content",children:[u(),o.jsxs("div",{className:"message-meta",children:[o.jsx("time",{className:"message-time",children:Gs(s.createdAt,{showTime:!0,showDate:!1})}),f()]})]})}),o.jsx("style",{jsx:!0,children:`
        .message-container {
          display: flex;
          margin-bottom: 0.5rem;
          max-width: 80%;
          align-self: flex-start;
          animation: fadeIn 0.3s ease-in-out;
        }
        
        .message-container.sent {
          align-self: flex-end;
          flex-direction: row-reverse;
        }
        
        .message-avatar {
          margin-right: 0.5rem;
          align-self: flex-end;
        }
        
        .message-content-wrapper {
          display: flex;
          flex-direction: column;
        }
        
        .message-content {
          position: relative;
          padding: 0.75rem 1rem;
          border-radius: 18px;
          background-color: var(--bg-light);
          box-shadow: 0 1px 2px rgba(0,0,0,0.1);
          overflow: hidden;
          word-break: break-word;
        }
        
        .message-container.sent .message-content {
          background-color: var(--primary-subtle);
          color: var(--text-dark);
          border-bottom-right-radius: 4px;
        }
        
        .message-container.received .message-content {
          border-bottom-left-radius: 4px;
        }
        
        .message-meta {
          display: flex;
          align-items: center;
          justify-content: flex-end;
          gap: 4px;
          margin-top: 4px;
          font-size: 0.7rem;
          color: var(--text-light);
        }
        
        .message-time {
          font-size: 0.7rem;
          color: var(--text-light);
        }
        
        .message-status-icon {
          font-size: 0.8rem;
        }
        
        .message-status-icon.read {
          color: var(--primary);
        }
        
        .message-status-icon.sent {
          color: var(--text-light);
        }
        
        .message-status-icon.error {
          color: var(--danger);
        }
        
        .message-container.pending {
          opacity: 0.7;
        }
        
        .message-container.error .message-content {
          background-color: var(--danger-light);
          border: 1px solid var(--danger);
        }
        
        .spin {
          animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dark mode */
        .dark .message-content {
          background-color: var(--medium);
        }
        
        .dark .message-container.sent .message-content {
          background-color: var(--primary-dark);
        }
      `})]})},s6=y.memo(n6),r6=({messages:s,currentUser:t,isLoading:r,error:i,onRetry:c,typingIndicator:u,recipient:f})=>{const m=y.useRef(null),v=Mf(s);y.useEffect(()=>{if(!m.current)return;const S=s.length>0?"smooth":"auto";requestAnimationFrame(()=>{var j;(j=m.current)==null||j.scrollIntoView({behavior:S})})},[s]);const[x,A]=y.useState(0);return y.useEffect(()=>{let S;return r&&s.length===0?S=setInterval(()=>{A(j=>j+1)},1e3):A(0),()=>{S&&clearInterval(S)}},[r,s.length]),r&&s.length===0?o.jsxs("div",{className:"chat-messages-loading",children:[o.jsx(Ln,{className:"spin-animation"}),o.jsxs("p",{children:["Loading messages",".".repeat(1+x%3)]}),x>5&&o.jsxs("div",{className:"loading-fallback",children:[o.jsx("p",{children:"This is taking longer than expected."}),o.jsx("button",{onClick:c,className:"retry-button",children:"Try Again"})]})]}):i&&s.length===0?o.jsxs("div",{className:"chat-messages-error",children:[o.jsxs("p",{children:["Error: ",i]}),o.jsx("button",{onClick:c,className:"retry-button",children:"Try Again"})]}):!r&&s.length===0&&!i?o.jsx("div",{className:"chat-messages-empty",children:o.jsx("p",{children:"No messages yet. Start the conversation!"})}):o.jsxs("div",{className:"chat-messages",children:[Object.entries(v).map(([S,j])=>o.jsxs("div",{className:"message-group",children:[o.jsx("div",{className:"message-date",children:o.jsx("span",{children:S})}),j.map((C,M)=>{var K;const U=C.sender===(t==null?void 0:t._id),D=!U&&(M===0||((K=j[M-1])==null?void 0:K.sender)!==C.sender),ne=C.status==="pending"||C.pending;return o.jsx(s6,{message:C,isCurrentUser:U,showAvatar:D,recipient:f,isPending:ne},C._id||`temp-${C.tempId||M}`)})]},S)),u&&o.jsxs("div",{className:"typing-indicator",children:[o.jsxs("div",{className:"typing-bubble",children:[o.jsx("div",{className:"typing-dot"}),o.jsx("div",{className:"typing-dot"}),o.jsx("div",{className:"typing-dot"})]}),o.jsxs("span",{children:[(f==null?void 0:f.nickname)||"User"," is typing..."]})]}),o.jsx("div",{ref:m,className:"message-end-anchor"}),o.jsx("style",{children:`
        .chat-messages {
          flex: 1;
          overflow-y: auto;
          padding: 1rem;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }
        
        .chat-messages-loading, .chat-messages-error, .chat-messages-empty {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          padding: 2rem;
          color: var(--text-light);
          text-align: center;
        }
        
        .spin-animation {
          animation: spin 1s linear infinite;
          font-size: 1.5rem;
          margin-bottom: 1rem;
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        .loading-fallback {
          margin-top: 1.5rem;
          padding: 0.75rem;
          background-color: var(--bg-light);
          border-radius: 8px;
          width: 80%;
          max-width: 300px;
          opacity: 0;
          animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
          0% { opacity: 0; }
          100% { opacity: 1; }
        }
        
        .loading-fallback p {
          font-size: 0.9rem;
          margin-bottom: 0.75rem;
        }
        
        .retry-button {
          margin-top: 1rem;
          padding: 0.5rem 1rem;
          background-color: var(--primary);
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 0.9rem;
          transition: background-color 0.2s;
        }
        
        .retry-button:hover {
          background-color: var(--primary-dark);
        }
        
        .chat-messages-empty {
          color: var(--text-medium);
          font-style: italic;
          opacity: 0.8;
        }
        
        .message-group {
          display: flex;
          flex-direction: column;
          margin-bottom: 1rem;
        }
        
        .message-date {
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 1rem 0;
          position: relative;
        }
        
        .message-date::before,
        .message-date::after {
          content: '';
          flex: 1;
          height: 1px;
          background-color: var(--border-color);
          margin: 0 10px;
        }
        
        .message-date span {
          font-size: 0.8rem;
          color: var(--text-light);
          background-color: var(--bg-card);
          padding: 0 10px;
        }
        
        .typing-indicator {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.5rem;
          margin-left: 0.5rem;
          margin-top: 0.25rem;
          max-width: 80%;
        }
        
        .typing-bubble {
          display: flex;
          align-items: center;
          gap: 3px;
          padding: 10px;
          background-color: var(--light);
          border-radius: 18px;
        }
        
        .typing-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background-color: var(--text-light);
          animation: typing-animation 1.4s infinite;
          opacity: 0.6;
        }
        
        .typing-dot:nth-child(2) {
          animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
          animation-delay: 0.4s;
        }
        
        .typing-indicator span {
          font-size: 0.8rem;
          color: var(--text-light);
        }
        
        @keyframes typing-animation {
          0%, 60%, 100% {
            transform: translateY(0);
          }
          30% {
            transform: translateY(-4px);
          }
        }
        
        .message-end-anchor {
          height: 1px;
          width: 100%;
        }
        
        /* Dark mode */
        .dark .typing-bubble {
          background-color: var(--dark);
        }
        
        .dark .typing-dot {
          background-color: var(--light);
        }
        
        .dark .message-date span {
          background-color: var(--dark);
        }
      `})]})},i6=Rt.create("MessageInput"),a6=["","","","","","","","","",""],o6=({value:s,onChange:t,onSend:r,onTyping:i,onFileSelect:c,attachment:u,onClearAttachment:f,isUploading:m,uploadProgress:v})=>{const[x,A]=y.useState(!1),S=y.useRef(null),j=y.useRef(null),C=y.useRef(null);y.useEffect(()=>{const B=L=>{C.current&&!C.current.contains(L.target)&&A(!1)};return document.addEventListener("mousedown",B),()=>{document.removeEventListener("mousedown",B)}},[]),y.useEffect(()=>{S.current&&S.current.focus()},[]);const M=B=>{B.key==="Enter"&&!B.shiftKey&&(B.preventDefault(),(s.trim()||u)&&D())},U=B=>{t(B.target.value),i&&i()},D=()=>{(s.trim()||u)&&!m&&(r(),A(!1))},ne=B=>{t(s+B),S.current.focus()},K=()=>{j.current.click()},te=B=>{const L=B.target.files[0];L&&(i6.debug(`File selected: ${L.name} (${L.type})`),c(L)),B.target.value=""};return o.jsxs("div",{className:"message-input-container",children:[u&&o.jsxs("div",{className:"attachment-preview",children:[o.jsx("div",{className:"attachment-info",children:m?o.jsxs(o.Fragment,{children:[o.jsx(Ln,{className:"spin"}),o.jsxs("span",{children:["Uploading... ",v,"%"]})]}):o.jsx("span",{children:u.name})}),o.jsx("button",{className:"clear-attachment",onClick:f,disabled:m,"aria-label":"Remove attachment",children:o.jsx(xn,{})})]}),o.jsxs("div",{className:"input-row",children:[o.jsx("input",{type:"file",ref:j,onChange:te,style:{display:"none"},accept:"image/*,application/pdf,text/plain,audio/*,video/*"}),o.jsx("button",{className:"input-button file-button",onClick:K,disabled:m,"aria-label":"Attach file",children:o.jsx(B0,{})}),o.jsx("div",{className:"text-input-wrapper",children:o.jsx("textarea",{ref:S,value:s,onChange:U,onKeyPress:M,placeholder:"Type a message...",className:"message-text-input",rows:1,disabled:m})}),o.jsx("button",{className:"input-button emoji-button",onClick:()=>A(!x),"aria-label":"Insert emoji",children:o.jsx(q0,{})}),o.jsx("button",{className:`input-button send-button ${(s.trim()||u)&&!m?"active":"disabled"}`,onClick:D,disabled:!(s.trim()||u)||m,"aria-label":"Send message",children:o.jsx(U0,{})})]}),x&&o.jsx("div",{className:"emoji-picker",ref:C,children:a6.map((B,L)=>o.jsx("button",{className:"emoji-item",onClick:()=>ne(B),"aria-label":`Emoji ${B}`,children:B},L))}),o.jsx("style",{jsx:!0,children:`
        .message-input-container {
          padding: 0.5rem;
          background-color: var(--bg-light);
          border-top: 1px solid var(--border-color);
        }
        
        .attachment-preview {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 0.5rem;
          background-color: var(--bg-card);
          border-radius: 8px;
          margin-bottom: 0.5rem;
        }
        
        .attachment-info {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-size: 0.85rem;
          color: var(--text-medium);
        }
        
        .clear-attachment {
          background: none;
          border: none;
          color: var(--text-light);
          cursor: pointer;
          font-size: 0.85rem;
          padding: 0.25rem;
          border-radius: 50%;
        }
        
        .clear-attachment:hover {
          background-color: var(--bg-hover);
        }
        
        .input-row {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          background-color: var(--white);
          border-radius: 24px;
          padding: 0.25rem;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .input-button {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 38px;
          height: 38px;
          border-radius: 50%;
          border: none;
          background: none;
          color: var(--text-light);
          font-size: 1.1rem;
          cursor: pointer;
          transition: all 0.2s;
        }
        
        .input-button:hover {
          background-color: var(--bg-hover);
          color: var(--text-medium);
        }
        
        .send-button.active {
          background-color: var(--primary);
          color: white;
        }
        
        .send-button.active:hover {
          background-color: var(--primary-dark);
          color: white;
        }
        
        .send-button.disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }
        
        .text-input-wrapper {
          flex: 1;
          min-width: 0;
        }
        
        .message-text-input {
          width: 100%;
          border: none;
          background: none;
          font-size: 0.95rem;
          padding: 0.75rem 0;
          outline: none;
          resize: none;
          max-height: 100px;
          overflow-y: auto;
        }
        
        .emoji-picker {
          display: grid;
          grid-template-columns: repeat(5, 1fr);
          gap: 0.5rem;
          padding: 0.75rem;
          background-color: var(--white);
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          position: absolute;
          bottom: calc(100% + 0.5rem);
          right: 1rem;
          z-index: 10;
        }
        
        .emoji-item {
          font-size: 1.5rem;
          background: none;
          border: none;
          border-radius: 8px;
          padding: 0.25rem;
          cursor: pointer;
          transition: background-color 0.2s;
        }
        
        .emoji-item:hover {
          background-color: var(--bg-hover);
        }
        
        .spin {
          animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        /* Dark mode */
        .dark .input-row {
          background-color: var(--medium);
        }
        
        .dark .emoji-picker {
          background-color: var(--dark);
        }
        
        .dark .emoji-item:hover {
          background-color: var(--medium);
        }
        
        .dark .message-text-input {
          color: var(--text-light);
        }
        
        .dark .attachment-preview {
          background-color: var(--dark);
        }
      `})]})},en=Rt.create("EmbeddedChat"),l6=({recipient:s,isOpen:t=!0,onClose:r,embedded:i=!0})=>{var P,ie;const{user:c}=Ot();mn();const{messages:u,loading:f,error:m,sendMessage:v,sendTyping:x,typingStatus:A,refresh:S}=B3(s==null?void 0:s._id),[j,C]=y.useState(""),[M,U]=y.useState(null),[D,ne]=y.useState(!1),[K,te]=y.useState(0),[B,L]=y.useState(!1),[I,E]=y.useState(!1),[T,z]=y.useState(null),W=y.useRef(null);y.useEffect(()=>{if(Se.socket){en.debug("Socket reference obtained"),W.current=Se.socket;const J=de=>{en.debug("Call answer received:",de),!de.accept&&B&&(L(!1),X.info("Call was declined"))},ze=de=>{try{if(!de){en.error("Received empty call data");return}const Z=de.caller&&(de.caller.userId||de.caller._id)||de.userId||de.from&&de.from.userId;if(!Z){en.error("Caller ID not found in incoming call data",de);return}Z===(s==null?void 0:s._id)&&(z(de),en.debug("Incoming call state set from recipient",de))}catch(Z){en.error("Error handling incoming call:",Z)}};return W.current.on("callAnswered",J),W.current.on("incomingCall",ze),()=>{W.current&&(W.current.off("callAnswered",J),W.current.off("incomingCall",ze))}}else en.warn("Socket connection not available")},[B,s]);const H=async()=>{if(M){await q();return}if(j.trim())try{en.debug(`Sending text message to ${(s==null?void 0:s.nickname)||(s==null?void 0:s._id)}`),await v(j,"text"),C("")}catch(J){en.error("Failed to send message:",J),X.error("Failed to send message. Please try again.")}},q=async()=>{if(M)try{ne(!0);const J=new FormData;J.append("file",M);const ze=je=>{const Fe=Math.round(je.loaded*100/je.total);te(Fe)};en.debug(`Uploading file: ${M.name}`);const de=await fetch("/api/messages/attachments",{method:"POST",body:J,headers:{Authorization:`Bearer ${localStorage.getItem("token")||sessionStorage.getItem("token")}`}});if(!de.ok)throw new Error("Failed to upload file");const Z=await de.json();if(!Z.success)throw new Error(Z.error||"Failed to upload file");const Te={fileUrl:Z.data.url,fileName:Z.data.fileName||M.name,fileSize:Z.data.fileSize||M.size,mimeType:Z.data.mimeType||M.type,...Z.data.metadata};await v(Z.data.fileName||M.name,"file",Te),U(null),te(0)}catch(J){en.error("Failed to send file message:",J),X.error("Failed to send file. Please try again.")}finally{ne(!1)}},re=()=>{if(!W.current){en.error("Cannot start call: No connection available"),X.error("Cannot connect to video service");return}if(B){en.debug("Call already in progress");return}s!=null&&s._id?(en.debug(`Starting video call with ${s.nickname}...`),E(!0),L(!0),W.current.emit("initiateCall",{recipientId:s._id,callType:"video",userId:c._id,callId:`call-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,caller:{userId:c._id,name:c.nickname||"User"}}),v("Video Call","video").catch(J=>{en.error("Failed to send video call message:",J)})):(en.error("Cannot start call: recipient information is missing"),X.error("Cannot start call: missing recipient information"))},pe=()=>{var de;if(en.debug("Accepting incoming call",T),!T||!W.current)return;const J=((de=T.caller)==null?void 0:de.userId)||T.userId,ze=T.callId;W.current.emit("answerCall",{callerId:J,accept:!0,callId:ze,userId:c._id}),E(!1),L(!0),z(null)},ce=()=>{var de;if(en.debug("Declining incoming call"),!T||!W.current)return;const J=((de=T.caller)==null?void 0:de.userId)||T.userId,ze=T.callId;W.current.emit("answerCall",{callerId:J,accept:!1,callId:ze,userId:c._id}),z(null)},R=()=>{en.debug("Ending call"),L(!1),E(!1)},Q=J=>{if(!J)return;const ze=5*1024*1024;if(J.size>ze){X.error("File is too large (max 5MB)");return}if(!["image/jpeg","image/jpg","image/png","image/gif","application/pdf","text/plain","audio/mpeg","audio/wav","video/mp4","video/quicktime"].includes(J.type)){X.error("Unsupported file type");return}U(J)},Y=()=>{D||(U(null),te(0))};return!t||!s?null:o.jsxs("div",{className:`embedded-chat ${i?"embedded":"full-page"}`,children:[o.jsxs("div",{className:"chat-container",children:[o.jsx(J3,{recipient:s,onClose:r,onVideoCall:re,embedded:i}),o.jsx(r6,{messages:u,currentUser:c,isLoading:f,error:m,onRetry:S,typingIndicator:A,recipient:s}),o.jsx(o6,{value:j,onChange:C,onSend:H,onTyping:x,onFileSelect:Q,attachment:M,onClearAttachment:Y,isUploading:D,uploadProgress:K})]}),T&&o.jsx("div",{className:"incoming-call-dialog",children:o.jsxs("div",{className:"incoming-call-content",children:[o.jsxs("div",{className:"incoming-caller",children:[o.jsx("div",{className:"call-avatar",children:(((P=T.caller)==null?void 0:P.name)||"User").charAt(0)}),o.jsxs("div",{className:"caller-info",children:[o.jsx("h3",{children:((ie=T.caller)==null?void 0:ie.name)||"User"}),o.jsx("p",{children:"Incoming video call..."})]})]}),o.jsxs("div",{className:"call-actions",children:[o.jsx("button",{className:"decline-button",onClick:ce,children:"Decline"}),o.jsx("button",{className:"accept-button",onClick:pe,children:"Accept"})]})]})}),B&&o.jsx(U1,{recipient:s,isInitiator:I,onEnd:R}),o.jsx("style",{children:`
        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.2); }
          100% { transform: scale(1); }
        }
        
        .pulse {
          animation: pulse 1s infinite;
        }
        
        .embedded-chat {
          display: flex;
          flex-direction: column;
          height: 500px;
          width: 350px;
          position: fixed;
          bottom: 20px;
          right: 20px;
          z-index: 1000;
          border-radius: 10px;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
          overflow: hidden;
          background-color: var(--bg-card);
          animation: slide-in-bottom 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
        }
        
        .embedded-chat.full-page {
          position: relative;
          width: 100%;
          height: 100%;
          bottom: auto;
          right: auto;
          border-radius: 0;
          box-shadow: none;
          animation: none;
        }
        
        .chat-container {
          display: flex;
          flex-direction: column;
          height: 100%;
          width: 100%;
        }
        
        .incoming-call-dialog {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.75);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
        }
        
        .incoming-call-content {
          background-color: var(--bg-card);
          border-radius: 12px;
          padding: 1.5rem;
          width: 90%;
          max-width: 300px;
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }
        
        .incoming-caller {
          display: flex;
          align-items: center;
          gap: 1rem;
        }
        
        .call-avatar {
          width: 60px;
          height: 60px;
          border-radius: 50%;
          background-color: var(--primary);
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.8rem;
          font-weight: bold;
        }
        
        .caller-info h3 {
          margin: 0;
          font-size: 1.2rem;
          font-weight: 600;
        }
        
        .caller-info p {
          margin: 0.25rem 0 0;
          font-size: 0.9rem;
          color: var(--text-light);
        }
        
        .call-actions {
          display: flex;
          gap: 1rem;
        }
        
        .call-actions button {
          flex: 1;
          padding: 0.75rem;
          border-radius: 8px;
          border: none;
          font-weight: 600;
          cursor: pointer;
          transition: background-color 0.2s;
        }
        
        .decline-button {
          background-color: var(--danger-light);
          color: var(--danger);
        }
        
        .accept-button {
          background-color: var(--success);
          color: white;
        }
        
        .decline-button:hover {
          background-color: var(--danger);
          color: white;
        }
        
        .accept-button:hover {
          background-color: var(--success-dark);
        }
        
        @keyframes slide-in-bottom {
          0% {
            transform: translateY(100px);
            opacity: 0;
          }
          100% {
            transform: translateY(0);
            opacity: 1;
          }
        }
        
        /* Dark mode */
        .dark .incoming-call-content {
          background-color: var(--dark);
        }
        
        .dark .decline-button {
          background-color: rgba(220, 53, 69, 0.2);
        }
        
        @media (max-width: 768px) {
          .embedded-chat {
            width: 100%;
            height: 100%;
            bottom: 0;
            right: 0;
            border-radius: 0;
            box-shadow: none;
          }
        }
      `})]})},c6=$1(l6),u6=({userId:s,isOpen:t,onClose:r})=>{var Sr,Qs,Ks,_s,es,wr,Zs,we,Ve,Ze,st,At,ot,Zt,ts,Es;const{user:i}=Ot(),{getUser:c,currentUser:u,likeUser:f,unlikeUser:m,isUserLiked:v,error:x,blockUser:A,reportUser:S,sendMessage:j}=ti(),{initiateChat:C}=$f(),{loadUserStories:M,hasUnviewedStories:U}=Wi(),[D,ne]=y.useState([]),[K,te]=y.useState(!1),[B,L]=y.useState(0),[I,E]=y.useState(!1),[T,z]=y.useState(!1),[W,H]=y.useState(!1),[q,re]=y.useState({}),[pe,ce]=y.useState(!1),[R,Q]=y.useState(!1),[Y,P]=y.useState([]),[ie,J]=y.useState(!1),[ze,de]=y.useState(!1),[Z,Te]=y.useState(null),[je,Fe]=y.useState(!1),[Me,Ue]=y.useState({status:null,isLoading:!1}),Le=y.useRef(null),he=y.useRef(!1),ye=y.useRef(!1),G=y.useRef(!1),oe=mn(),be=yo(),{isMounted:Ne}=Qf(),_e=Rt.create("UserProfileModal"),Ge=y.useMemo(()=>i&&u&&i._id===u._id,[i,u]),bt=y.useMemo(()=>!u||!i?0:zn(),[u,i]),ut=y.useMemo(()=>{var Ce;return!u||!i||!((Ce=u.details)!=null&&Ce.interests)?[]:u.details.interests.filter(Ie=>{var Qe,Tt;return(Tt=(Qe=i.details)==null?void 0:Qe.interests)==null?void 0:Tt.includes(Ie)})},[u,i]),St=y.useMemo(()=>Y.some(Ce=>Ce.user&&u&&Ce.user._id===u._id),[Y,u]),Nt=y.useMemo(()=>Y.find(Ce=>Ce.user&&u&&Ce.user._id===u._id),[Y,u]),Mt=Me.status==="approved",ue=y.useRef(null);y.useEffect(()=>!s||!t||ue.current===s?void 0:((async()=>{Fe(!0),ue.current=s;try{await new Promise(Qe=>setTimeout(Qe,50));const Ie=await c(s);if(!Ne())return;_e.debug("User data received:",Ie),Te(Ie)}catch(Ie){Ne()&&(_e.error("Error fetching user:",Ie),Fe(!1))}finally{Ne()&&Fe(!1)}})(),()=>{t||(ue.current=null)}),[s,t,Ne]),y.useCallback(()=>{console.log("This function is no longer used - direct API call is made instead")},[]);const Re=y.useCallback(async()=>{if(!(!i||G.current||!Ne())){G.current=!0,J(!0);try{_e.debug("Fetching pending photo access requests");const Ce=await be.get("/users/photos/permissions?status=pending");if(!Ne())return;if(Ce&&Ce.success){const Ie=Array.isArray(Ce)?Ce:Array.isArray(Ce.data)?Ce.data:null;if(Ie){const Qe={};Ie.forEach(Bt=>{if(Bt&&Bt.requestedBy&&Bt.requestedBy._id){const un=Bt.requestedBy._id;Qe[un]||(Qe[un]={user:Bt.requestedBy,requests:[]}),Qe[un].requests.push(Bt)}});const Tt=Object.values(Qe);P(Bt=>{if(Bt.length!==Tt.length)return Tt;try{const un=JSON.stringify(Bt),Js=JSON.stringify(Tt);return un===Js?Bt:Tt}catch(un){return _e.warn("JSON comparison failed:",un),Tt}}),_e.debug(`Processed ${Tt.length} pending request groups`)}else _e.warn("No valid requests data in response:",Ce),P(Qe=>Qe.length>0?[]:Qe)}else _e.warn("Failed to fetch pending requests:",Ce),P(Ie=>Ie.length>0?[]:Ie)}catch(Ce){if(!Ne())return;_e.error("Error fetching pending requests:",Ce),Ce.message&&!Ce.message.includes("no pending requests")&&X.error("Failed to load photo access requests"),P(Ie=>Ie.length>0?[]:Ie)}finally{Ne()&&(J(!1),G.current=!1)}}},[i,be,Ne]),De=y.useRef(!1),se=y.useRef(!1),Ee=y.useRef(!1),Ke=y.useRef(!1);y.useEffect(()=>{if(!s||!t){Ee.current&&(Ee.current=!1,De.current=!1,se.current=!1,ye.current=!1,he.current=!1,G.current=!1,Ke.current=!1,te(!1),H(!1),Ue({status:null,isLoading:!1}),re({}),ce(!1),Q(!1),L(0),ne([]),P([]),_e.debug(`Modal cleanup ran for userId: ${s}`));return}Ee.current||(Ee.current=!0,_e.debug(`Modal opened for userId: ${s}, dataLoadedRef: ${De.current}`),L(0),z(!1),E(!1),re({}),te(!1),H(!1),Ue({status:null,isLoading:!1}),Fe(!1),ce(!1),Q(!1),J(!1),de(!1)),!he.current&&!De.current&&(he.current=!0,Promise.resolve(M==null?void 0:M(s)).then(Ce=>{Ne()&&Ce&&Array.isArray(Ce)&&ne(Ce)}).catch(Ce=>{_e.error("Error loading stories:",Ce)}).finally(()=>{Ne()&&(he.current=!1)})),!ye.current&&!Ke.current&&(Ke.current=!0,ye.current=!0,be.get(`/users/${s}/photo-access-status`).then(Ce=>{if(Ne())if(_e.debug("Received photo access status response:",Ce),Ce&&Ce.success){const Ie=Ce.status||Ce.data&&Ce.data.status||null;Ie?Ne()&&Ue(Qe=>Qe.status!==Ie?{status:Ie,isLoading:!1}:Qe):(Ue({status:"none",isLoading:!1}),_e.debug("No status value in response, defaulting to 'none'"))}else Ce?(_e.warn("Unsuccessful photo access status response:",Ce),Ue({status:"none",isLoading:!1})):(_e.warn("Empty photo access status response"),Ue({status:"none",isLoading:!1}))}).catch(Ce=>{Ne()&&(_e.error("Error loading photo access status:",Ce),Ue({status:"none",isLoading:!1}))}).finally(()=>{Ne()&&(ye.current=!1)})),i&&i._id===s&&!G.current&&!De.current&&Re(),De.current||(De.current=!0)},[s,M,i,t,Ne,be,Re]);const b=async()=>{if(!u||!u._id||Me.isLoading){_e.warn("Cannot request photo access: missing user ID or already loading");return}if(!Me.isLoading){Ue(Ie=>({...Ie,isLoading:!0}));try{_e.debug(`Requesting photo access for user ${u._id}`),Ue({status:"pending",isLoading:!1}),X.success("Access to photos requested");try{const Ie=await be.post(`/users/${u._id}/request-photo-access`);if(!Ne())return;Ie&&Ie.success?_e.debug("Photo access request successful:",Ie.message||"Request processed"):Ie?_e.info("Photo access request partially successful:",Ie):_e.warn("Photo access request returned empty response but UI shows success")}catch(Ie){_e.error("Backend error in photo access request (UI unaffected):",Ie)}}catch(Ie){if(!Ne())return;_e.error("Error in photo access request flow:",Ie),Ue({status:"pending",isLoading:!1}),X.success("Access to photos requested")}}},p=async(Ce,Ie)=>{if(!Ce||!Wn(Ce)||!Ie||!Array.isArray(Ie)||Ie.length===0){_e.warn("Invalid user ID or empty requests array for approval");return}if(ze){_e.warn("Already processing approval/rejection request");return}de(!0);try{_e.debug(`Approving all photo requests from user ${Ce}`);const Qe=await be.put(`/users/${Ce}/approve-photo-access`);if(!Ne())return;Qe&&Qe.success?(X.success("Approved all photo requests from this user"),_e.debug("Successfully approved photo requests"),P(Tt=>Tt.filter(Bt=>!Bt.user||Bt.user._id!==Ce))):(_e.warn("Failed to approve photo requests:",Qe),X.error((Qe==null?void 0:Qe.error)||"Failed to approve photo requests"))}catch(Qe){if(!Ne())return;_e.error("Error approving requests:",Qe),X.error((Qe==null?void 0:Qe.error)||"Failed to approve photo requests")}finally{Ne()&&de(!1)}},g=async(Ce,Ie)=>{if(!Ce||!Wn(Ce)||!Ie||!Array.isArray(Ie)||Ie.length===0){_e.warn("Invalid user ID or empty requests array for rejection");return}if(ze){_e.warn("Already processing approval/rejection request");return}de(!0);try{_e.debug(`Rejecting all photo requests from user ${Ce}`);const Qe=await be.put(`/users/${Ce}/reject-photo-access`);if(!Ne())return;Qe&&Qe.success?(X.success("Rejected all photo requests from this user"),_e.debug("Successfully rejected photo requests"),P(Tt=>Tt.filter(Bt=>!Bt.user||Bt.user._id!==Ce))):(_e.warn("Failed to reject photo requests:",Qe),X.error((Qe==null?void 0:Qe.error)||"Failed to reject photo requests"))}catch(Qe){if(!Ne())return;_e.error("Error rejecting requests:",Qe),X.error((Qe==null?void 0:Qe.error)||"Failed to reject photo requests")}finally{Ne()&&de(!1)}},k=y.useCallback(Ce=>{var Qe;_e.debug(`Image with ID ${Ce} failed to load`),re(Tt=>({...Tt,[Ce]:!0}));const Ie=(Qe=u==null?void 0:u.photos)==null?void 0:Qe.find(Tt=>Tt._id===Ce);Ie&&Ie.url&&(Ie.url.includes("unsplash.com")||!Ie.url.startsWith(window.location.origin))&&Df(Ie.url)},[u]),N=async()=>{if(!(!u||pe)){ce(!0);try{v&&v(u._id)?await m(u._id,u.nickname):await f(u._id,u.nickname)}catch(Ce){_e.error("Error toggling like:",Ce),X.error("Failed to update like status")}finally{Ne()&&ce(!1)}}},$=async()=>{if(s)try{await A(s),X.success("User blocked successfully"),r()}catch(Ce){_e.error("Error blocking user:",Ce),X.error("Failed to block user")}},ae=async()=>{if(s)try{await S(s),X.success("User reported successfully"),r()}catch(Ce){_e.error("Error reporting user:",Ce),X.error("Failed to report user")}},Be=async()=>{if(s){Q(!0);try{await j(s),oe("/messages"),r()}catch(Ce){_e.error("Error sending message:",Ce),X.error("Failed to start conversation")}finally{Ne()&&Q(!1)}}},at=()=>H(!0),tt=()=>H(!1),dt=()=>te(!1),nt=()=>{u!=null&&u.photos&&B<u.photos.length-1&&L(B+1)},Cs=()=>{B>0&&L(B-1)};function zn(){if(!(u!=null&&u.details)||!(i!=null&&i.details))return 0;let Ce=0;u.details.location===i.details.location&&(Ce+=25);const Ie=Math.abs((u.details.age||0)-(i.details.age||0));Ie<=5?Ce+=25:Ie<=10?Ce+=15:Ce+=5;const Qe=u.details.interests||[],Tt=i.details.interests||[],Bt=Qe.filter(un=>Tt.includes(un)).length;return Ce+=Math.min(50,Bt*10),Math.min(100,Ce)}const js=Ce=>!Ce||typeof Ce!="string"?"":Ce.charAt(0).toUpperCase()+Ce.slice(1),Wn=Ce=>Ce&&typeof Ce=="string"&&/^[0-9a-fA-F]{24}$/.test(Ce);return t?je?o.jsx(ro,{isOpen:t,onClose:r,size:"large",children:o.jsx("div",{className:"loading-container",children:o.jsx(mc,{text:"Loading profile...",size:"large",centered:!0})})}):x?o.jsx(ro,{isOpen:t,onClose:r,size:"small",children:o.jsxs("div",{className:"error-container",children:[o.jsx("h3",{children:"Error Loading Profile"}),o.jsx("p",{children:x}),o.jsx(xt,{variant:"primary",onClick:r,children:"Close"})]})}):u?o.jsx(ro,{isOpen:t,onClose:r,size:"xlarge",className:"user-profile-modal",showCloseButton:!0,bodyClassName:"modern-user-profile",closeOnClickOutside:!0,children:o.jsxs("div",{className:"container profile-content",ref:Le,children:[!Ge&&St&&Nt&&o.jsxs("div",{className:"pending-requests-notification",children:[o.jsxs("div",{className:"notification-content",children:[o.jsx(fc,{className:"notification-icon"}),o.jsx("div",{className:"notification-text",children:o.jsxs("p",{children:[o.jsx("strong",{children:u.nickname})," has requested access to your private photos"]})})]}),o.jsxs("div",{className:"notification-actions",children:[o.jsx(xt,{variant:"success",onClick:()=>p(u._id,Nt.requests),disabled:ze,isLoading:ze,icon:o.jsx(pt,{}),children:"Approve"}),o.jsx(xt,{variant:"danger",onClick:()=>g(u._id,Nt.requests),disabled:ze,isLoading:ze,icon:o.jsx(rf,{}),children:"Reject"})]})]}),o.jsxs("div",{className:"profile-layout",children:[o.jsxs("div",{className:"profile-photos-section",children:[D&&D.length>0&&o.jsx("div",{className:"profile-stories",children:o.jsx(Jf,{user:u,hasUnviewedStories:U&&U(u._id),onClick:at})}),u&&u.photos&&u.photos.length>0?o.jsxs("div",{className:"photo-gallery-container",children:[o.jsxs("div",{className:"gallery-photo",children:[u.photos[B]&&u.photos[B].isPrivate&&!Mt?o.jsxs("div",{className:"private-photo-placeholder",children:[o.jsx(Jn,{className:"lock-icon"}),o.jsx("p",{children:"Private Photo"}),Me.status==="pending"&&o.jsx("p",{className:"permission-status pending",children:"Access Request Pending"}),Me.status==="rejected"&&o.jsx("p",{className:"permission-status rejected",children:"Access Denied"}),(!Me.status||Me.status==="none")&&o.jsxs("button",{className:"request-access-btn",onClick:b,disabled:Me.isLoading,children:[Me.isLoading?o.jsx(Ln,{className:"fa-spin"}):null,"Request Photo Access"]})]}):u.photos[B]&&o.jsx("div",{className:"gallery-image-container",children:o.jsx("img",{src:u.photos[B].url,alt:`${u.nickname}'s photo`,className:"gallery-image",onError:()=>k(u.photos[B]._id)})}),u.isOnline&&o.jsxs("div",{className:"online-badge",children:[o.jsx("span",{className:"pulse"}),"Online Now"]}),u.photos.length>1&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"gallery-nav prev",onClick:Cs,disabled:B===0,"aria-label":"Previous photo",children:o.jsx(dc,{})}),o.jsx("button",{className:"gallery-nav next",onClick:nt,disabled:B===u.photos.length-1,"aria-label":"Next photo",children:o.jsx(R0,{})})]})]}),u.photos.length>1&&o.jsx("div",{className:"photo-thumbnails",children:u.photos.map((Ce,Ie)=>o.jsx("div",{className:`photo-thumbnail ${Ie===B?"active":""}`,onClick:()=>L(Ie),children:Ce.isPrivate&&!Mt?o.jsxs("div",{className:"private-thumbnail",children:[o.jsx(Jn,{}),Me.status&&o.jsxs("div",{className:`permission-status ${Me.status}`,children:[Me.status==="pending"&&"Pending",Me.status==="approved"&&"Granted",Me.status==="rejected"&&"Denied"]})]}):o.jsx("div",{className:"thumbnail-img-container",children:o.jsx("img",{src:Ce.url,alt:`${u.nickname} ${Ie+1}`,onError:()=>k(Ce._id)})})},Ce._id||Ie))})]}):o.jsxs("div",{className:"no-photo-placeholder",children:[o.jsx(ei,{size:"xlarge",placeholder:"/default-avatar.png",alt:u.nickname,status:u.isOnline?"online":null}),o.jsx("p",{children:"No photos available"})]}),o.jsxs("div",{className:"profile-actions",children:[!Ge&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:`profile-action-btn ${v&&v(u._id)?"liked":"btn-primary"}`,onClick:N,disabled:pe,children:[pe?o.jsx(Ln,{className:"fa-spin"}):o.jsx(Xs,{}),v&&v(u._id)?"Liked":"Like"]}),o.jsxs("button",{className:"profile-action-btn btn-primary",onClick:Be,disabled:R,children:[R?o.jsx(Ln,{className:"fa-spin"}):o.jsx(ea,{}),"Message"]})]}),o.jsxs("div",{className:"more-actions-dropdown",children:[o.jsx("button",{className:"dropdown-toggle-btn",onClick:()=>E(!I),"aria-label":"More actions",children:o.jsx(O0,{})}),I&&o.jsxs("div",{className:"actions-dropdown",children:[o.jsxs("button",{className:"dropdown-item",onClick:ae,children:[o.jsx(z0,{}),"Report User"]}),o.jsxs("button",{className:"dropdown-item",onClick:$,children:[o.jsx(rf,{}),"Block User"]})]})]})]})]}),o.jsxs("div",{className:"profile-details-section",children:[o.jsxs("div",{className:"user-headline",children:[o.jsxs("h1",{children:[u.nickname,", ",((Sr=u.details)==null?void 0:Sr.age)||"?"]}),u.role==="premium"&&o.jsxs("div",{className:"premium-badge",children:[o.jsx(I0,{})," Premium"]})]}),o.jsxs("div",{className:"user-location",children:[o.jsx(uo,{}),o.jsx("span",{children:((Qs=u.details)==null?void 0:Qs.location)||"Unknown location"}),o.jsx("div",{className:`online-status ${u.isOnline?"online":""}`,children:u.isOnline?"Online now":"Offline"})]}),o.jsxs("div",{className:"user-activity",children:[o.jsxs("div",{className:"activity-item",children:[o.jsx(F0,{}),o.jsx("span",{children:u.isOnline?"Active now":`Last active ${Gs(u.lastActive,{showTime:!1})}`})]}),o.jsxs("div",{className:"activity-item",children:[o.jsx(qf,{}),o.jsxs("span",{children:["Member since ",Gs(u.createdAt,{showTime:!1})]})]})]}),!Ge&&o.jsxs("div",{className:"compatibility-section",children:[o.jsx("h2",{children:"Compatibility"}),o.jsxs("div",{className:"compatibility-score",children:[o.jsxs("div",{className:"score-circle",children:[o.jsxs("svg",{viewBox:"0 0 100 100",children:[o.jsx("defs",{children:o.jsxs("linearGradient",{id:"compatibility-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"var(--primary)"}),o.jsx("stop",{offset:"100%",stopColor:"#ff4d7d"})]})}),o.jsx("circle",{className:"score-bg",cx:"50",cy:"50",r:"45"}),o.jsx("circle",{className:"score-fill",cx:"50",cy:"50",r:"45",strokeDasharray:"283",strokeDashoffset:283-283*bt/100})]}),o.jsxs("div",{className:"score-value",children:[bt,"%"]})]}),o.jsxs("div",{className:"compatibility-details",children:[o.jsxs("div",{className:"compatibility-factor",children:[o.jsx("span",{children:"Location"}),o.jsx("div",{className:"factor-bar",children:o.jsx("div",{className:"factor-fill",style:{width:((Ks=u.details)==null?void 0:Ks.location)===((_s=i==null?void 0:i.details)==null?void 0:_s.location)?"100%":"30%"}})})]}),o.jsxs("div",{className:"compatibility-factor",children:[o.jsx("span",{children:"Age"}),o.jsx("div",{className:"factor-bar",children:o.jsx("div",{className:"factor-fill",style:{width:Math.abs((((es=u.details)==null?void 0:es.age)||0)-(((wr=i==null?void 0:i.details)==null?void 0:wr.age)||0))<=5?"90%":Math.abs((((Zs=u.details)==null?void 0:Zs.age)||0)-(((we=i==null?void 0:i.details)==null?void 0:we.age)||0))<=10?"60%":"30%"}})})]}),o.jsxs("div",{className:"compatibility-factor",children:[o.jsx("span",{children:"Interests"}),o.jsx("div",{className:"factor-bar",children:o.jsx("div",{className:"factor-fill",style:{width:`${Math.min(100,ut.length*20)}%`}})})]})]})]})]}),((Ve=u.details)==null?void 0:Ve.bio)&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"About Me"}),o.jsx("p",{className:"about-text",children:u.details.bio})]}),((Ze=u.details)==null?void 0:Ze.iAm)&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"I am a"}),o.jsx("p",{children:js(u.details.iAm)})]}),((st=u.details)==null?void 0:st.maritalStatus)&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Marital Status"}),o.jsx("p",{children:u.details.maritalStatus})]}),((At=u.details)==null?void 0:At.lookingFor)&&u.details.lookingFor.length>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Looking For"}),o.jsx("div",{className:"tags-container",children:u.details.lookingFor.map((Ce,Ie)=>o.jsx("span",{className:"tag looking-for-tag",children:Ce},Ie))})]}),((ot=u.details)==null?void 0:ot.intoTags)&&u.details.intoTags.length>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"I'm Into"}),o.jsx("div",{className:"tags-container",children:u.details.intoTags.map((Ce,Ie)=>o.jsx("span",{className:"tag into-tag",children:Ce},Ie))})]}),((Zt=u.details)==null?void 0:Zt.turnOns)&&u.details.turnOns.length>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"It Turns Me On"}),o.jsx("div",{className:"tags-container",children:u.details.turnOns.map((Ce,Ie)=>o.jsx("span",{className:"tag turn-on-tag",children:Ce},Ie))})]}),((Es=(ts=u.details)==null?void 0:ts.interests)==null?void 0:Es.length)>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Interests"}),o.jsxs("div",{className:"interests-tags",children:[(T?u.details.interests:u.details.interests.slice(0,8)).map(Ce=>o.jsxs("span",{className:`interest-tag ${ut.includes(Ce)?"common":""}`,children:[Ce,ut.includes(Ce)&&o.jsx(pt,{className:"common-icon"})]},Ce)),!T&&u.details.interests.length>8&&o.jsxs(xt,{className:"show-more-interests",onClick:()=>z(!0),variant:"link",size:"small",children:["+",u.details.interests.length-8," more"]})]})]})]})]}),K&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"chat-overlay",onClick:dt}),o.jsx(Kf,{recipient:u,isOpen:K,onClose:dt})]}),W&&o.jsx(Wf,{userId:u._id,onClose:tt})]})}):o.jsx(ro,{isOpen:t,onClose:r,size:"small",children:o.jsxs("div",{className:"not-found-container",children:[o.jsx("h3",{children:"User Not Found"}),o.jsx("p",{children:"The user you're looking for doesn't exist or has been removed."}),o.jsx(xt,{variant:"primary",onClick:r,children:"Close"})]})}):null},d6=()=>{mn();const{user:s}=Ot(),{users:t,getUsers:r,loading:i,likeUser:c,unlikeUser:u,isUserLiked:f,likesLoading:m,getLikedUsers:v}=ti(),{unreadMessages:x}=$f(),{createStory:A}=Wi(),[S,j]=y.useState(1),[C,M]=y.useState(!0),[U,D]=y.useState(!1),ne=y.useRef(),K=y.useRef(null),[te,B]=y.useState("discover"),[L,I]=y.useState(!1),[E,T]=y.useState({ageMin:18,ageMax:99,distance:100,online:!1,verified:!1,withPhotos:!1,interests:[]}),[z,W]=y.useState(null),[H,q]=y.useState(!1),[re,pe]=y.useState("grid"),[ce,R]=y.useState({}),[Q,Y]=y.useState(!1),[P,ie]=y.useState(null),[J,ze]=y.useState(!1),[de,Z]=y.useState(null),[Te,je]=y.useState(!1),[Fe,Me]=y.useState(!1);y.useCallback(ue=>{R(Re=>({...Re,[ue]:!0}))},[]),y.useEffect(()=>{Ue(1).then(()=>{Me(!0)})},[E]);const Ue=y.useCallback(async ue=>{D(ue!==1);try{const Re=await r(ue,20);return M(Re.hasMore),j(ue),Re}catch(Re){return console.error("Error loading users:",Re),X.error("Failed to load users. Please try again."),null}finally{D(!1)}},[r]),Le=y.useCallback(()=>{!U&&C&&Ue(S+1)},[U,C,S,Ue]);y.useEffect(()=>{const ue=ne.current;return ue&&ue.disconnect(),ne.current=new IntersectionObserver(Re=>{Re[0].isIntersecting&&C&&!U&&!i&&Le()},{root:null,threshold:.1,rootMargin:"100px"}),K.current&&C&&ne.current.observe(K.current),()=>{ue&&ue.disconnect()}},[C,U,i,Le,t.length]),y.useEffect(()=>{const ue=setInterval(()=>{document.visibilityState==="visible"&&Ue(1)},3e5),Re=()=>{document.visibilityState==="visible"&&Ue(1)};return document.addEventListener("visibilitychange",Re),()=>{clearInterval(ue),document.removeEventListener("visibilitychange",Re),q(!1),W(null)}},[Ue]);const he=y.useMemo(()=>t.filter(ue=>{var De,se;if(ue._id===(s==null?void 0:s._id))return!1;const Re=((De=ue.details)==null?void 0:De.age)||25;if(Re<E.ageMin||Re>E.ageMax||E.online&&!ue.isOnline||E.withPhotos&&(!ue.photos||ue.photos.length===0))return!1;if(E.interests.length>0){const Ee=((se=ue.details)==null?void 0:se.interests)||[];if(!E.interests.some(b=>Ee.includes(b)))return!1}return!0}),[t,s,E]),ye=y.useMemo(()=>{const ue=new Map;return he.forEach(De=>{De&&De._id&&ue.set(De._id,De)}),Array.from(ue.values()).sort((De,se)=>De.isOnline&&!se.isOnline?-1:!De.isOnline&&se.isOnline?1:new Date(se.lastActive)-new Date(De.lastActive))},[he]),G=["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art"],oe=ue=>{T(Re=>Re.interests.includes(ue)?{...Re,interests:Re.interests.filter(De=>De!==ue)}:{...Re,interests:[...Re.interests,ue]})},be=ue=>{Z(ue),je(!0)},Ne=(ue,Re)=>{ue.stopPropagation(),W(Re),q(!0)},_e=()=>{q(!1),W(null)},Ge=ue=>{if(!A||J){X.info(J?"Story creation in progress, please wait...":"Story creation is not available right now");return}ze(!0),A(ue).then(Re=>{Re.success?(X.success("Your story has been created!"),Y(!1)):X.error(Re.error||"Failed to create story")}).catch(Re=>{X.error("An error occurred while creating your story"),console.error("Story creation error:",Re)}).finally(()=>{ze(!1)})};y.useEffect(()=>{R({})},[E]);const bt=y.useCallback(ue=>Array.isArray(x)&&x.some(Re=>Re.sender===ue),[x]),ut=y.useCallback(ue=>Array.isArray(x)?x.filter(Re=>Re.sender===ue).length:0,[x]),St=y.useCallback(()=>{T({ageMin:18,ageMax:99,distance:100,online:!1,verified:!1,withPhotos:!1,interests:[]}),j(1),M(!0)},[]);y.useEffect(()=>{const ue=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.scrollHeight-300&&C&&!U&&!i&&Le()};return window.addEventListener("scroll",ue),()=>window.removeEventListener("scroll",ue)},[C,U,i,Le]);const Nt=y.useCallback((ue,Re)=>{f(ue)?u(ue,Re).then(se=>{se&&setTimeout(()=>v(!0),300)}):c(ue,Re).then(se=>{se&&setTimeout(()=>v(!0),300)})},[f,u,c,v]),Mt=(i||m)&&S===1&&!Fe;return o.jsxs("div",{className:"app-container",children:[o.jsx(Zf,{}),o.jsx("main",{className:"app-main",children:o.jsxs("div",{className:"dashboard",children:[o.jsxs("div",{className:"stories-section",children:[o.jsxs("div",{className:"stories-header",children:[o.jsx("h2",{className:"stories-title",children:"Stories"}),o.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>!J&&Y(!0),"aria-label":"Create a new story",disabled:J,children:[o.jsx(T4,{}),o.jsx("span",{children:J?"Creating...":"Create Story"})]})]}),o.jsx(Q3,{onStoryClick:ue=>{P||ie(ue)}})]}),o.jsxs("div",{className:"dashboard-header",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"dashboard-title",children:te==="discover"?"Discover People":"Your Matches"}),o.jsx("p",{className:"dashboard-subtitle",children:"Find the perfect match for you"})]}),o.jsxs("div",{className:"dashboard-actions",children:[o.jsxs("div",{className:"view-toggle",children:[o.jsx("button",{className:`view-toggle-button ${re==="grid"?"active":""}`,onClick:()=>pe("grid"),title:"Grid View","aria-label":"Grid view",children:o.jsx(U4,{})}),o.jsx("button",{className:`view-toggle-button ${re==="list"?"active":""}`,onClick:()=>pe("list"),title:"List View","aria-label":"List view",children:o.jsx(C4,{})})]}),o.jsxs("button",{className:`filter-button ${L?"active":""}`,onClick:()=>I(!L),"aria-expanded":L,"aria-label":"Toggle filters",children:[o.jsx(L0,{}),o.jsx("span",{children:"Filters"})]})]})]}),L&&o.jsxs("div",{className:"filter-panel animate-fade-in",children:[o.jsxs("div",{className:"filter-section",children:[o.jsx("h3",{children:"Age Range"}),o.jsx("div",{className:"filter-options",children:o.jsxs("div",{className:"range-slider",children:[o.jsxs("div",{className:"range-values",children:[o.jsx("span",{children:E.ageMin}),o.jsx("span",{children:E.ageMax})]}),o.jsx("input",{type:"range",min:"18",max:"99",value:E.ageMin,onChange:ue=>T({...E,ageMin:Number.parseInt(ue.target.value)}),className:"range-input","aria-label":"Minimum age"}),o.jsx("input",{type:"range",min:"18",max:"99",value:E.ageMax,onChange:ue=>T({...E,ageMax:Number.parseInt(ue.target.value)}),className:"range-input","aria-label":"Maximum age"})]})})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h3",{children:"Distance"}),o.jsx("div",{className:"filter-options",children:o.jsxs("div",{className:"range-slider",children:[o.jsx("div",{className:"range-value",children:o.jsxs("span",{children:[E.distance," km"]})}),o.jsx("input",{type:"range",min:"5",max:"100",value:E.distance,onChange:ue=>T({...E,distance:Number.parseInt(ue.target.value)}),className:"range-input","aria-label":"Maximum distance"})]})})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h3",{children:"Show Only"}),o.jsxs("div",{className:"filter-options d-flex flex-column",children:[o.jsxs("label",{className:"filter-option",children:[o.jsx("input",{type:"checkbox",checked:E.online,onChange:()=>T({...E,online:!E.online}),"aria-label":"Show only online users"}),o.jsx("span",{children:"Online Now"})]}),o.jsxs("label",{className:"filter-option",children:[o.jsx("input",{type:"checkbox",checked:E.verified,onChange:()=>T({...E,verified:!E.verified}),"aria-label":"Show only verified profiles"}),o.jsx("span",{children:"Verified Profiles"})]}),o.jsxs("label",{className:"filter-option",children:[o.jsx("input",{type:"checkbox",checked:E.withPhotos,onChange:()=>T({...E,withPhotos:!E.withPhotos}),"aria-label":"Show only profiles with photos"}),o.jsx("span",{children:"With Photos"})]})]})]}),o.jsxs("div",{className:"filter-section",children:[o.jsx("h3",{children:"Interests"}),o.jsx("div",{className:"tags-container",children:G.map(ue=>o.jsx("button",{className:`filter-tag ${E.interests.includes(ue)?"active":""}`,onClick:()=>oe(ue),"aria-pressed":E.interests.includes(ue),children:ue},ue))})]}),o.jsxs("div",{className:"filter-actions",children:[o.jsx("button",{className:"btn btn-outline",onClick:St,"aria-label":"Reset filters",children:"Reset"}),o.jsx("button",{className:"btn btn-primary",onClick:()=>I(!1),"aria-label":"Apply filters",children:"Apply Filters"})]})]}),o.jsx("div",{className:"users-section",children:o.jsx("div",{className:`users-${re}`,children:Mt?o.jsx("div",{className:"content-loader",children:o.jsxs("div",{className:"loading-container",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{className:"loading-text",children:"Loading users..."})]})}):ye.length>0?o.jsxs(o.Fragment,{children:[ye.map((ue,Re)=>{const De=Re===ye.length-1;return o.jsx("div",{className:"user-card-wrapper relative",ref:De?K:null,children:o.jsx(Z3,{user:ue,isLiked:f(ue._id),onLike:Nt,viewMode:re,onMessage:se=>Ne(se,ue),onClick:()=>be(ue._id),showExtendedDetails:!0,hasUnreadMessages:bt(ue._id),unreadMessageCount:ut(ue._id)})},ue._id)}),U&&o.jsx("div",{className:"content-loader",style:{minHeight:"100px"},children:o.jsxs("div",{className:"loading-container",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{className:"loading-text",children:"Loading more users..."})]})})]}):o.jsx("div",{className:"content-loader",children:o.jsxs("div",{className:"loading-container",children:[o.jsx("div",{className:"no-results-icon",children:o.jsx(Ff,{})}),o.jsx("h3",{children:"No matches found"}),o.jsx("p",{children:"Try adjusting your filters to see more people"}),o.jsx("button",{className:"btn btn-primary",onClick:St,"aria-label":"Reset filters",children:"Reset Filters"})]})})})})]})}),H&&z&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"chat-overlay",onClick:_e}),o.jsx(Kf,{recipient:z,isOpen:H,onClose:_e})]}),Q&&o.jsx(K3,{onClose:()=>Y(!1),onSubmit:Ge}),P&&o.jsx(Wf,{storyId:P,onClose:()=>ie(null)}),Te&&o.jsx(u6,{userId:de,isOpen:Te,onClose:()=>je(!1)})]})},bf={getSubscriptionStatus:async()=>{try{console.log("Fetching subscription status...");const s=await Pe.get("/subscription/status");return console.log("Subscription status response:",s),s}catch(s){return console.error("Error fetching subscription status:",s),{success:!0,data:{accountTier:"FREE",isPaid:!1,dailyLikesRemaining:3,canSendMessages:!1,canCreateStory:!0}}}},upgradeSubscription:async s=>{try{if(!s||!["monthly","yearly"].includes(s))throw new Error("Invalid subscription plan. Please choose monthly or yearly.");console.log(`Upgrading to ${s} plan...`);const t=await Pe.post("/subscription/upgrade",{plan:s});if(console.log("Upgrade response:",t),t.success)return X.success(`Successfully upgraded to ${s} plan!`),t;throw new Error(t.error||"Failed to upgrade subscription")}catch(t){throw console.error("Error upgrading subscription:",t),X.error(t.message||"Failed to upgrade subscription"),t}},cancelSubscription:async()=>{try{const s=await Pe.post("/subscription/cancel");if(s.success)return X.info(s.message||"Subscription successfully canceled"),s;throw new Error(s.error||"Failed to cancel subscription")}catch(s){throw console.error("Error canceling subscription:",s),X.error(s.message||"Failed to cancel subscription"),s}},checkActionPermission:async s=>{try{if(!["message","like","story"].includes(s))throw new Error("Invalid action type");const t=await bf.getSubscriptionStatus();if(!t.success)throw new Error("Could not verify subscription status");const{data:r}=t;switch(s){case"message":return{allowed:r.canSendMessages,reason:r.canSendMessages?null:"Messaging requires a premium account"};case"like":return{allowed:r.accountTier!=="FREE"||r.dailyLikesRemaining>0,reason:r.dailyLikesRemaining>0?null:"You have used all your daily likes",remaining:r.dailyLikesRemaining};case"story":return{allowed:r.canCreateStory,reason:r.canCreateStory?null:`Story creation available in ${r.storyCooldown} hours`,cooldown:r.storyCooldown};default:return{allowed:!1,reason:"Unknown action type"}}}catch(t){return console.error(`Error checking permission for ${s}:`,t),{allowed:!1,reason:t.message||"Could not verify permissions"}}}};class f6{constructor(t){this.socket=t}requestPhotoPermission(t,r){return new Promise((i,c)=>{if(!this.socket.isConnected())return c(new Error("Socket not connected"));if(!t||!r)return c(new Error("Owner ID and Photo ID are required"));const u={ownerId:t,photoId:r},f='req-<span class="math-inline">{photoId}-</span>{this.socket.socket?.userId}',m=S=>{S.requestId===f&&(x(),S.success?i(S):c(new Error(S.error||"Failed to request permission")))},v=S=>{S.requestId===f&&(x(),c(new Error(S.error||"Permission request failed")))},x=()=>{this.socket.off("photoPermissionRequested",m),this.socket.off("photoPermissionError",v)};this.socket.on("photoPermissionRequested",m),this.socket.on("photoPermissionError",v),this.socket.emit("requestPhotoPermission",u)||(x(),c(new Error("Failed to send permission request event"))),setTimeout(()=>{x(),c(new Error("Permission request timed out"))},1e4)})}respondToPhotoPermission(t,r){return new Promise((i,c)=>{if(!this.socket.isConnected())return c(new Error("Socket not connected"));if(!t||!r)return c(new Error("Permission ID and status are required"));if(!["approved","rejected"].includes(r))return c(new Error("Invalid status provided"));const u={permissionId:t,status:r},f='res-<span class="math-inline">{permissionId}-</span>{this.socket.socket?.userId}',m=S=>{S.requestId===f&&(x(),S.success?i(S):c(new Error(S.error||"Failed to respond to permission")))},v=S=>{S.requestId===f&&(x(),c(new Error(S.error||"Permission response failed")))},x=()=>{this.socket.off("photoPermissionResponded",m),this.socket.off("photoPermissionError",v)};this.socket.on("photoPermissionResponded",m),this.socket.on("photoPermissionError",v),this.socket.emit("respondToPhotoPermission",u)||(x(),c(new Error("Failed to send permission response event"))),setTimeout(()=>{x(),c(new Error("Permission response timed out"))},1e4)})}}const Pd=new f6(Se),h6=()=>o.jsx("div",{className:"spinner",children:o.jsx(Ln,{className:"spinner-icon",size:32})}),$d=s=>s?s.startsWith("http")?s:s.includes("/images/")||s.includes("/photos/")?s.startsWith("/uploads")?s:`/uploads${s.startsWith("/")?"":"/"}${s}`:s.startsWith("/uploads/")?s:`/uploads/images/${s.split("/").pop()}`:"/placeholder.svg",m6=()=>{var N,$,ae,Be,at,tt,dt,nt,Cs,zn,js,Wn,Sr,Qs,Ks,_s,es,wr,Zs;const{id:s}=MA(),t=mn(),{user:r}=Ot(),{loading:i,likeUser:c,unlikeUser:u,isUserLiked:f,error:m,blockUser:v,reportUser:x}=ti()||{},{initiateChat:A}=$f()||{},{loadUserStories:S,hasUnviewedStories:j}=Wi()||{},[C,M]=y.useState(null),[U,D]=y.useState(!0),[ne,K]=y.useState(null),[te,B]=y.useState([]),[L,I]=y.useState(!1),[E,T]=y.useState(0),[z,W]=y.useState(!1),[H,q]=y.useState(!1),[re,pe]=y.useState(!1),[ce,R]=y.useState({}),[Q,Y]=y.useState({}),[P,ie]=y.useState({}),[J,ze]=y.useState(!1),[de,Z]=y.useState(!1),Te=y.useRef(null),[je,Fe]=y.useState(!1),[Me,Ue]=y.useState([]),[Le,he]=y.useState(!1),[ye,G]=y.useState(!1),oe=r&&C&&r._id===C._id,be=y.useRef(!0);y.useEffect(()=>(be.current=!0,()=>{be.current=!1}),[]);const Ne=y.useCallback(async()=>{var we;if(!s){K("No user ID provided in URL."),D(!1);return}D(!0),K(null),M(null),Y({}),console.log(`UserProfile page fetching data for user: ${s}`);try{const Ve=await Pe.get(`/users/${s}`);if(!Ve.success||!((we=Ve.data)!=null&&we.user))throw new Error(Ve.error||"User not found");if(!be.current)return;if(M(Ve.data.user),r&&r._id!==s)try{const Ze=await Pe.get(`/users/${s}/photo-permissions`);if(Ze.success&&be.current){const st={};(Ze.data||[]).forEach(At=>{st[At.photo]=At.status}),Y(st)}}catch(Ze){console.error("Error fetching initial permissions:",Ze)}if(S)try{const Ze=await S(s);be.current&&Array.isArray(Ze)&&B(Ze)}catch(Ze){console.error("Error loading stories:",Ze)}r&&r._id===s&&_e()}catch(Ve){console.error(`Error fetching initial data for user ${s}:`,Ve),be.current&&K(Ve.message||"Failed to load profile")}finally{be.current&&D(!1)}},[s,r,S]);y.useEffect(()=>{Ne(),T(0),q(!1),W(!1),ie({}),Ue([]),I(!1),pe(!1)},[s,Ne]);const _e=y.useCallback(async()=>{if(!(!r||!oe)){he(!0);try{const we=await Pe.get("/users/photos/permissions?status=pending");if(we.success&&be.current){const Ve={};(we.data||[]).forEach(Ze=>{var At;if(!((At=Ze==null?void 0:Ze.requestedBy)!=null&&At._id))return;const st=Ze.requestedBy._id;Ve[st]||(Ve[st]={user:Ze.requestedBy,requests:[]}),Ve[st].requests.push(Ze)}),Ue(Object.values(Ve))}}catch{X.error("Failed to load photo access requests")}finally{be.current&&he(!1)}}},[r,oe]),Ge=async(we,Ve)=>{var Ze;if(Ve&&Ve.stopPropagation(),!(!C||!we||!r||oe)){R(st=>({...st,[we]:!0}));try{const st=await Pd.requestPhotoPermission(C._id,we);be.current&&(st.success?(Y(At=>({...At,[we]:st.status||"pending"})),X.info(st.message||"Request sent/pending.")):X.error(st.error||"Failed request."))}catch(st){be.current&&((Ze=st.message)!=null&&Ze.includes("already")?(Y(At=>({...At,[we]:"pending"})),X.info("Request already sent.")):X.error(st.message||"Failed request."))}finally{be.current&&R(st=>({...st,[we]:!1}))}}},bt=async()=>{if(!(C!=null&&C.photos)||!r||oe)return;const we=C.photos.filter(ot=>ot.isPrivate&&Q[ot._id]!=="approved"&&Q[ot._id]!=="pending");if(we.length===0){X.info("No new requests needed.");return}Fe(!0);let Ve=0,Ze=0,st=0;(await Promise.allSettled(we.map(ot=>Pd.requestPhotoPermission(C._id,ot._id)))).forEach((ot,Zt)=>{var Es;const ts=we[Zt];ot.status==="fulfilled"&&ot.value.success?(be.current&&Y(Ce=>({...Ce,[ts._id]:"pending"})),(Es=ot.value.message)!=null&&Es.includes("already")?Ze++:Ve++):st++}),be.current&&(Ve>0?X.success(`Requested ${Ve} photo(s).`+(Ze>0?` ${Ze} pending.`:"")):Ze>0&&X.info(`Requests pending/sent for ${Ze} photos.`),st>0&&X.error(`Failed for ${st} photo(s).`),Fe(!1))},ut=async(we,Ve,Ze)=>{if(!(!oe||!(Ve!=null&&Ve.length))){G(!0);try{let st=0;await Promise.allSettled(Ve.map(At=>Pd.respondToPhotoPermission(At._id,Ze))).then(At=>At.forEach(ot=>{ot.status==="fulfilled"&&ot.value.success&&st++})),st>0?X.success(`Successfully ${Ze} ${st} request(s).`):Ve.length>0&&X.error(`Failed to ${Ze} requests.`),_e()}catch{X.error(`Server error processing ${Ze}.`)}finally{be.current&&G(!1)}}},St=(we,Ve)=>ut(we,Ve,"approved"),Nt=(we,Ve)=>ut(we,Ve,"rejected"),Mt=y.useCallback(we=>{be.current&&ie(Ve=>({...Ve,[we]:!0}))},[]),ue=async()=>{if(!(!C||J||!c||!u||!f)){ze(!0);try{await(f(C._id)?u:c)(C._id,C.nickname)}catch(we){X.error(we.message||"Like failed.")}finally{be.current&&ze(!1)}}},Re=async()=>{if(!(!C||!v)&&window.confirm(`Block ${C.nickname}?`))try{await v(C._id),X.info(`${C.nickname} blocked.`),t("/dashboard")}catch(we){X.error(we.message||"Block failed.")}},De=async()=>{if(!C||!x)return;const we=prompt(`Reason for reporting ${C.nickname}:`);if(we!=null&&we.trim())try{await x(C._id,we),X.success(`${C.nickname} reported.`),t("/dashboard")}catch(Ve){X.error(Ve.message||"Report failed.")}else we!==null&&X.warning("Reason required.")},se=async()=>{if(!(!C||!A)){Z(!0);try{await A(C),t("/messages")}catch(we){X.error(we.message||"Chat start failed.")}finally{be.current&&Z(!1)}}},Ee=()=>{(te==null?void 0:te.length)>0&&pe(!0)},Ke=()=>pe(!1),b=()=>{var we;((we=C==null?void 0:C.photos)==null?void 0:we.length)>E+1&&T(Ve=>Ve+1)},p=()=>{E>0&&T(we=>we-1)};y.useEffect(()=>{const we=Ve=>{var At;const{photoId:Ze,status:st}=Ve.detail;(At=C==null?void 0:C.photos)!=null&&At.some(ot=>ot._id===Ze)&&be.current&&Y(ot=>({...ot,[Ze]:st}))};return window.addEventListener("permissionStatusUpdated",we),()=>window.removeEventListener("permissionStatusUpdated",we)},[C]),y.useMemo(()=>{var st,At;if(!(C!=null&&C.details)||!(r!=null&&r.details))return 0;let we=0;((st=C.details.location)==null?void 0:st.toLowerCase())===((At=r.details.location)==null?void 0:At.toLowerCase())&&(we+=25);const Ve=Math.abs((C.details.age||0)-(r.details.age||0));Ve<=5?we+=25:Ve<=10?we+=15:we+=5;const Ze=(C.details.interests||[]).filter(ot=>(r.details.interests||[]).includes(ot)).length;return we+=Math.min(45,Ze*10),Math.min(100,Math.max(0,we))},[C,r]);const g=y.useMemo(()=>{var we,Ve;return!((we=C==null?void 0:C.details)!=null&&we.interests)||!((Ve=r==null?void 0:r.details)!=null&&Ve.interests)?[]:C.details.interests.filter(Ze=>r.details.interests.includes(Ze))},[C,r]);if(U||i)return o.jsxs("div",{className:"loading-container",children:[o.jsx(h6,{}),o.jsx("p",{children:"Loading..."})]});if(ne||m)return o.jsxs("div",{className:"error-container",children:[o.jsx("h3",{children:"Error"}),o.jsx("p",{children:ne||m}),o.jsx("button",{onClick:()=>t("/dashboard"),children:"Back"})]});if(!C)return o.jsxs("div",{className:"not-found-container",children:[o.jsx("h3",{children:"Not Found"}),o.jsx("p",{children:"User not found."}),o.jsx("button",{onClick:()=>t("/dashboard"),children:"Back"})]});const k=(we="")=>we.charAt(0).toUpperCase()+we.slice(1);return o.jsxs("div",{className:"modern-user-profile",ref:Te,children:[o.jsx(Zf,{})," ",o.jsxs("div",{className:"container profile-content",children:[o.jsxs("button",{className:"back-button",onClick:()=>t(-1),children:[" ",o.jsx(sf,{})," Back"]}),oe&&Me.length>0&&o.jsxs("div",{className:"pending-requests-section",children:[o.jsx("h2",{children:"Photo Access Requests"}),o.jsx("div",{className:"requests-list",children:Me.map(we=>{var Ve,Ze;return o.jsxs("div",{className:"request-item",children:[o.jsxs("div",{className:"request-user-info",children:[o.jsx("div",{className:"request-user-photo",children:(Ze=(Ve=we.user.photos)==null?void 0:Ve[0])!=null&&Ze.url?o.jsx("img",{src:$d(we.user.photos[0].url),alt:we.user.nickname,onError:st=>{st.target.src="/placeholder.svg"}}):o.jsx(Rd,{})}),o.jsxs("div",{className:"request-user-details",children:[o.jsx("h4",{children:we.user.nickname}),o.jsxs("p",{children:["Requests: ",we.requests.length]})]})]}),o.jsxs("div",{className:"request-actions",children:[o.jsxs("button",{className:"btn btn-sm btn-success",onClick:()=>St(we.user._id,we.requests),disabled:ye,children:[o.jsx(pt,{})," Approve"]}),o.jsxs("button",{className:"btn btn-sm btn-danger",onClick:()=>Nt(we.user._id,we.requests),disabled:ye,children:[o.jsx(xn,{})," Reject"]})]})]},we.user._id)})})]}),o.jsxs("div",{className:"profile-layout",children:[o.jsxs("div",{className:"profile-photos-section",children:[(te==null?void 0:te.length)>0&&(j==null?void 0:j(C._id))&&o.jsx("div",{className:"profile-stories",children:o.jsx(Jf,{user:C,hasUnviewedStories:!0,onClick:Ee})}),((N=C.photos)==null?void 0:N.length)>0?o.jsxs("div",{className:"photo-gallery-container",children:[o.jsxs("div",{className:"gallery-photo",children:[($=C.photos[E])!=null&&$.isPrivate&&Q[C.photos[E]._id]!=="approved"&&!oe?o.jsxs("div",{className:"private-photo-placeholder",children:[o.jsx(Jn,{className:"lock-icon"})," ",o.jsx("p",{children:"Private"}),Q[C.photos[E]._id]==="pending"&&o.jsx("p",{className:"permission-status pending",children:"Pending"}),Q[C.photos[E]._id]==="rejected"&&o.jsx("p",{className:"permission-status rejected",children:"Denied"}),!Q[C.photos[E]._id]&&o.jsx("button",{className:"request-access-btn",onClick:we=>Ge(C.photos[E]._id,we),disabled:ce[C.photos[E]._id]||je,children:ce[C.photos[E]._id]?o.jsx(Ln,{className:"spinner-icon"}):"Request"})]}):C.photos[E]&&o.jsx("img",{src:$d(C.photos[E].url),alt:C.nickname,onError:()=>Mt(C.photos[E]._id),style:{display:P[(ae=C.photos[E])==null?void 0:ae._id]?"none":"block"}}),C.photos[E]&&P[(Be=C.photos[E])==null?void 0:Be._id]&&o.jsxs("div",{className:"image-error-placeholder",children:[o.jsx(Jl,{size:48}),o.jsx("p",{children:"Error"})]}),C.isOnline&&o.jsxs("div",{className:"online-badge",children:[o.jsx("span",{className:"pulse"}),"Online"]}),C.photos.length>1&&o.jsxs(o.Fragment,{children:[" ",o.jsx("button",{className:"gallery-nav prev",onClick:p,disabled:E===0,children:o.jsx(dc,{})})," ",o.jsx("button",{className:"gallery-nav next",onClick:b,disabled:E===C.photos.length-1,children:o.jsx(R0,{})})," "]})]}),C.photos.length>1&&o.jsx("div",{className:"photo-thumbnails",children:C.photos.map((we,Ve)=>o.jsxs("div",{className:`photo-thumbnail ${Ve===E?"active":""}`,onClick:()=>T(Ve),children:[we.isPrivate&&Q[we._id]!=="approved"&&!oe?o.jsxs("div",{className:"private-thumbnail",children:[o.jsx(Jn,{}),Q[we._id]&&o.jsx("div",{className:`permission-status ${Q[we._id]}`})]}):o.jsx("img",{src:$d(we.url),alt:`${Ve+1}`,onError:()=>Mt(we._id),style:{display:P[we._id]?"none":"block"}}),P[we._id]&&o.jsx("div",{className:"thumbnail-error",children:o.jsx(Rd,{})})]},we._id))})]}):o.jsxs("div",{className:"no-photo-placeholder",children:[o.jsx(Rd,{size:64}),o.jsx("p",{children:"No photos"})]}),o.jsxs("div",{className:"profile-actions",children:[!oe&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:`btn profile-action-btn ${f!=null&&f(C._id)?"liked":""}`,onClick:ue,disabled:J,children:[o.jsx(Xs,{})," ",o.jsx("span",{children:f!=null&&f(C._id)?"Liked":"Like"})]}),o.jsxs("button",{className:"btn btn-primary profile-action-btn",onClick:se,disabled:de,children:[o.jsx(ea,{})," ",o.jsx("span",{children:"Message"})]}),((at=C.photos)==null?void 0:at.some(we=>we.isPrivate&&Q[we._id]!=="approved"))&&o.jsxs("button",{className:"btn btn-secondary profile-action-btn",onClick:bt,disabled:je,children:[o.jsx(fc,{})," ",o.jsx("span",{children:"Request Photos"})]})]}),o.jsxs("div",{className:"more-actions-dropdown",children:[o.jsx("button",{className:"btn btn-subtle profile-action-btn",onClick:()=>W(we=>!we),children:o.jsx(O0,{})}),z&&o.jsxs("div",{className:"actions-dropdown",children:[o.jsxs("button",{className:"dropdown-item",onClick:De,children:[o.jsx(z0,{})," Report"]}),!oe&&o.jsxs("button",{className:"dropdown-item",onClick:Re,children:[o.jsx(rf,{})," Block"]})]})]})]})]}),o.jsxs("div",{className:"profile-details-section",children:[o.jsxs("div",{className:"user-headline",children:[o.jsxs("h1",{children:[C.nickname,", ",((tt=C.details)==null?void 0:tt.age)||"?"]}),C.accountTier!=="FREE"&&o.jsxs("div",{className:`premium-badge tier-${(dt=C.accountTier)==null?void 0:dt.toLowerCase()}`,children:[o.jsx(I0,{})," ",k(C.accountTier)]})]}),o.jsxs("div",{className:"user-location",children:[o.jsx(uo,{}),o.jsx("span",{children:((nt=C.details)==null?void 0:nt.location)||"N/A"}),o.jsx("div",{className:`online-status ${C.isOnline?"online":""}`,children:C.isOnline?"Online":"Offline"})]}),o.jsxs("div",{className:"user-activity",children:[o.jsxs("div",{className:"activity-item",children:[o.jsx(F0,{}),o.jsxs("span",{children:["Last active ",C.lastActive?new Date(C.lastActive).toLocaleDateString():"N/A"]})]}),o.jsxs("div",{className:"activity-item",children:[o.jsx(qf,{}),o.jsxs("span",{children:["Member since ",C.createdAt?new Date(C.createdAt).toLocaleDateString():"N/A"]})]})]}),!oe&&r&&o.jsxs("div",{className:"compatibility-section",children:[o.jsx("h2",{children:"Compatibility"}),o.jsx("div",{className:"compatibility-score"})]}),((Cs=C.details)==null?void 0:Cs.bio)&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"About"}),o.jsx("p",{className:"about-text",children:C.details.bio})]}),((zn=C.details)==null?void 0:zn.iAm)&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"I am a"}),o.jsx("p",{children:k(C.details.iAm)})]}),((js=C.details)==null?void 0:js.maritalStatus)&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Status"}),o.jsx("p",{children:C.details.maritalStatus})]}),((Sr=(Wn=C.details)==null?void 0:Wn.lookingFor)==null?void 0:Sr.length)>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Looking For"}),o.jsx("div",{className:"tags-container",children:C.details.lookingFor.map(we=>o.jsx("span",{className:"tag looking-for-tag",children:we},we))})]}),((Ks=(Qs=C.details)==null?void 0:Qs.intoTags)==null?void 0:Ks.length)>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Into"}),o.jsx("div",{className:"tags-container",children:C.details.intoTags.map(we=>o.jsx("span",{className:"tag into-tag",children:we},we))})]}),((es=(_s=C.details)==null?void 0:_s.turnOns)==null?void 0:es.length)>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Turns Me On"}),o.jsx("div",{className:"tags-container",children:C.details.turnOns.map(we=>o.jsx("span",{className:"tag turn-on-tag",children:we},we))})]}),((Zs=(wr=C.details)==null?void 0:wr.interests)==null?void 0:Zs.length)>0&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Interests"}),o.jsxs("div",{className:"interests-tags",children:[(H?C.details.interests:C.details.interests.slice(0,8)).map(we=>o.jsxs("span",{className:`interest-tag ${g.includes(we)?"common":""}`,children:[we," ",g.includes(we)&&o.jsx(pt,{className:"common-icon"})]},we)),!H&&C.details.interests.length>8&&o.jsxs("button",{className:"show-more-interests",onClick:()=>q(!0),children:["+",C.details.interests.length-8," more"]})]})]}),g.length>0&&!oe&&o.jsxs("div",{className:"profile-section",children:[o.jsx("h2",{children:"Common Interests"}),o.jsx("div",{className:"common-interests",children:g.map(we=>o.jsxs("div",{className:"common-interest-item",children:[o.jsx(pt,{}),o.jsx("span",{children:we})]},we))})]})]})]}),L&&!oe&&o.jsx(Kf,{recipient:C,isOpen:L,onClose:()=>I(!1)}),re&&C&&o.jsx(Wf,{userId:C._id,onClose:Ke})]})]})},p6=()=>{var Ee,Ke;const{user:s}=Ot(),{updateProfile:t,uploadPhoto:r,refreshUserData:i}=ti(),[c,u]=y.useState(!1),[f,m]=y.useState({nickname:"",details:{age:"",gender:"",location:"",bio:"",interests:[],iAm:"",lookingFor:[],intoTags:[],turnOns:[],maritalStatus:""}}),[v,x]=y.useState([]),[A,S]=y.useState(0),[j,C]=y.useState(0),[M,U]=y.useState(!1),[D,ne]=y.useState(!1),[K]=y.useState(["Dating","Casual","Friendship","Long-term","Travel","Outdoors","Movies","Music","Fitness","Food","Art","Reading","Gaming","Photography","Dancing","Cooking"]),[te]=y.useState(["woman","man","couple"]),[B]=y.useState(["women","men","couples"]),[L]=y.useState(["Meetups","Power play","Threesomes","Online fun","Hot chat","Photo sharing","Camera chat","Cuckold","Golden showers","Strap-on","Forced bi","Erotic domination","Humiliation","Crossdressing","Worship","Foot fetish","Oral","From behind","Role-play","Toys","Massages","Foreplay","Casual meetups","Fantasy fulfillment","Bizarre","Education","Experiences","Tantra"]),[I]=y.useState(["Sexy ass","Dirty talk","Aggressive","Slow and gentle","In a public place","Pampering","Sexy clothing","Leather/latex clothing","Watching porn","Fit body","Bathing together","Erotic writing","Eye contact","Being pampered","Sexy legs","Teasing","Pushing boundaries"]),[E]=y.useState(["Single","Married","Divorced","Separated","Widowed","In a relationship","It's complicated","Open relationship","Polyamorous"]),[T,z]=y.useState({}),[W,H]=y.useState(!1),q=y.useRef(null),re=mn(),[pe,ce]=y.useState(!1),[R,Q]=y.useState(null),[Y,P]=y.useState(null),[ie,J]=y.useState(null),[ze,de]=y.useState(!1),[Z,Te]=y.useState(!1),[je,Fe]=y.useState(!0),[Me,Ue]=y.useState({});y.useEffect(()=>{var b,p,g,k,N,$,ae,Be,at,tt;if(Fe(!0),s)if(m({nickname:s.nickname||"",details:{age:((b=s.details)==null?void 0:b.age)||"",gender:((p=s.details)==null?void 0:p.gender)||"",location:((g=s.details)==null?void 0:g.location)||"",bio:((k=s.details)==null?void 0:k.bio)||"",interests:((N=s.details)==null?void 0:N.interests)||[],iAm:(($=s.details)==null?void 0:$.iAm)||"",lookingFor:((ae=s.details)==null?void 0:ae.lookingFor)||[],intoTags:((Be=s.details)==null?void 0:Be.intoTags)||[],turnOns:((at=s.details)==null?void 0:at.turnOns)||[],maritalStatus:((tt=s.details)==null?void 0:tt.maritalStatus)||""}}),s.photos&&s.photos.length>0){const dt=s.photos.map(nt=>({...nt,isPrivate:nt.isPrivate??!1,isProfile:!1}));dt.length>0&&(dt[0].isProfile=!0,S(0)),x(dt)}else x([]),S(-1);Fe(!1)},[s]);const Le=y.useRef(!0);y.useEffect(()=>()=>{Le.current=!1},[]),y.useEffect(()=>()=>{q.current&&(q.current.value="")},[]);const[he,ye]=y.useState({nickname:"",details:{age:"",gender:"",location:"",bio:"",interests:[]}}),G=b=>{const{name:p,value:g,type:k,checked:N}=b.target;if(k==="checkbox")m({...f,[p]:N});else if(k==="number"){if(g===""||!isNaN(Number.parseInt(g)))if(p.includes("details.")){const $=p.split(".")[1];m({...f,details:{...f.details,[$]:g}})}else m({...f,[p]:g})}else if(p.includes("details.")){const $=p.split(".")[1];m({...f,details:{...f.details,[$]:g}})}else m({...f,[p]:g});T[p.split(".").pop()]&&z($=>{const ae={...$};return delete ae[p.split(".").pop()],ae})},oe=b=>{const p=f.details.interests;if(!p.includes(b)&&p.length>=10){X.warning("You can select up to 10 interests");return}const g=p.includes(b)?p.filter(k=>k!==b):[...p,b];m(k=>({...k,details:{...k.details,interests:g}}))},be=b=>{m(p=>({...p,details:{...p.details,iAm:p.details.iAm===b?"":b}}))},Ne=b=>{const p=f.details.lookingFor;let g;if(p.includes(b))g=p.filter(k=>k!==b);else{if(p.length>=3){X.warning("You can select up to 3 options");return}g=[...p,b]}m(k=>({...k,details:{...k.details,lookingFor:g}}))},_e=b=>{const p=f.details.intoTags;if(!p.includes(b)&&p.length>=20){X.warning("You can select up to 20 'I'm into' tags");return}const g=p.includes(b)?p.filter(k=>k!==b):[...p,b];m(k=>({...k,details:{...k.details,intoTags:g}}))},Ge=b=>{const p=f.details.turnOns;if(!p.includes(b)&&p.length>=20){X.warning("You can select up to 20 'Turn ons' tags");return}const g=p.includes(b)?p.filter(k=>k!==b):[...p,b];m(k=>({...k,details:{...k.details,turnOns:g}}))},bt=b=>{m(p=>({...p,details:{...p.details,maritalStatus:p.details.maritalStatus===b?"":b}}))},ut=()=>{const b={};return f.nickname.trim()?f.nickname.length<3?b.nickname="Nickname must be at least 3 characters":f.nickname.length>50&&(b.nickname="Nickname cannot exceed 50 characters"):b.nickname="Nickname is required",!f.details.age&&f.details.age!==0?b.age="Age is required":isNaN(f.details.age)?b.age="Age must be a number":f.details.age<18?b.age="You must be at least 18 years old":f.details.age>120&&(b.age="Please enter a valid age"),f.details.location.trim()?f.details.location.length<2&&(b.location="Location must be at least 2 characters"):b.location="Location is required",f.details.bio&&f.details.bio.length>500&&(b.bio="Bio cannot exceed 500 characters"),b},St=async b=>{b==null||b.preventDefault();const p=ut();if(Object.keys(p).length>0){z(p);const g=document.querySelector(".error-message");g&&g.scrollIntoView({behavior:"smooth",block:"center"});return}z({}),H(!0);try{const g={nickname:f.nickname.trim(),details:{...f.details,age:Number(f.details.age),location:f.details.location.trim(),bio:f.details.bio?f.details.bio.trim():"",interests:Array.isArray(f.details.interests)?f.details.interests:[],iAm:f.details.iAm||"",lookingFor:Array.isArray(f.details.lookingFor)?f.details.lookingFor:[],intoTags:Array.isArray(f.details.intoTags)?f.details.intoTags:[],turnOns:Array.isArray(f.details.turnOns)?f.details.turnOns:[],maritalStatus:f.details.maritalStatus||""}};if(console.log("Submitting profile data:",g),await t(g))X.success("Profile updated successfully"),u(!1);else throw new Error("Failed to update profile")}catch(g){console.error("Failed to update profile:",g),X.error(g.message||"Failed to update profile. Please try again.")}finally{H(!1)}},Nt=async b=>{const p=b.target.files[0];if(!p)return;if(p.type.split("/")[0]!=="image"){X.error("Please upload an image file");return}const k=5*1024*1024;if(p.size>k){X.error("Image size should be less than 5MB");return}U(!0),C(0);const N=`temp-${Date.now()}`;x($=>[...$,{_id:N,url:URL.createObjectURL(p),isPrivate:!1,isProfile:!1,isLoading:!0}]);try{if(await r(p,!1,ae=>{C(ae)}))X.success("Photo uploaded successfully"),x(ae=>ae.filter(Be=>Be._id!==N)),await i(),C(0),q.current&&(q.current.value="");else throw new Error("Failed to upload photo")}catch($){console.error("Failed to upload photo:",$),X.error($.message||"Failed to upload photo. Please try again."),x(ae=>ae.filter(Be=>Be._id!==N))}finally{U(!1)}},Mt=()=>{var b;(b=q.current)==null||b.click()},ue=async(b,p)=>{if(p==null||p.stopPropagation(),D)return;if(b.toString().startsWith("temp-")){X.warning("Please wait for the upload to complete before changing privacy settings");return}const g=v.findIndex(N=>N._id===b);if(g===-1)return;const k=!v[g].isPrivate;x(N=>N.map($=>$._id===b?{...$,isPrivate:k}:$)),ne(!0);try{const $=await(await fetch(`/api/users/photos/${b}/privacy`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("token")}`},body:JSON.stringify({isPrivate:k})})).json();if(!$.success)throw new Error($.error||"Failed to update photo privacy");X.success(`Photo is now ${k?"private":"public"}`),await i()}catch(N){console.error("Failed to update photo privacy:",N),X.error(N.message||"Failed to update privacy setting"),x($=>$.map(ae=>ae._id===b?{...ae,isPrivate:!k}:ae))}finally{ne(!1)}},Re=async b=>{if(D)return;if(b.toString().startsWith("temp-")){X.warning("Please wait for the upload to complete before setting as profile photo");return}const p=v.findIndex(g=>g._id===b);if(p!==-1&&A!==p){S(p),x(g=>g.map((k,N)=>({...k,isProfile:N===p}))),ne(!0);try{const k=await(await fetch(`/api/users/photos/${b}/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("token")}`}})).json();if(!k.success)throw new Error(k.error||"Failed to set profile photo");X.success("Profile photo updated"),await i()}catch(g){console.error("Failed to set profile photo:",g),X.error(g.message||"Failed to set profile photo");const k=v.findIndex(N=>N.isProfile);k!==-1&&(S(k),x(N=>N.map(($,ae)=>({...$,isProfile:ae===k}))))}finally{ne(!1)}}},De=async(b,p)=>{if(p==null||p.stopPropagation(),D)return;if(b.toString().startsWith("temp-")){x(N=>N.filter($=>$._id!==b));return}if(!window.confirm("Are you sure you want to delete this photo?"))return;const g=v.findIndex(N=>N._id===b);if(g===-1)return;if(v.length===1){X.error("You cannot delete your only photo");return}if(v[g].isProfile){X.error("You cannot delete your profile photo. Please set another photo as profile first.");return}const k=v.filter(N=>N._id!==b);x(k),g<A&&S(A-1),ne(!0);try{const $=await(await fetch(`/api/users/photos/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}})).json();if(!$.success)throw new Error($.error||"Failed to delete photo");X.success("Photo deleted"),await i()}catch(N){console.error("Failed to delete photo:",N),X.error(N.message||"Failed to delete photo"),await i()}finally{ne(!1)}},se=()=>{var b,p,g,k,N,$,ae,Be,at,tt;s&&m({nickname:s.nickname||"",details:{age:((b=s.details)==null?void 0:b.age)||"",gender:((p=s.details)==null?void 0:p.gender)||"",location:((g=s.details)==null?void 0:g.location)||"",bio:((k=s.details)==null?void 0:k.bio)||"",interests:((N=s.details)==null?void 0:N.interests)||[],iAm:(($=s.details)==null?void 0:$.iAm)||"",lookingFor:((ae=s.details)==null?void 0:ae.lookingFor)||[],intoTags:((Be=s.details)==null?void 0:Be.intoTags)||[],turnOns:((at=s.details)==null?void 0:at.turnOns)||[],maritalStatus:((tt=s.details)==null?void 0:tt.maritalStatus)||""}}),z({}),u(!1)};return y.useEffect(()=>{(async()=>{try{ce(!0);const p=sessionStorage.getItem("token");if(!p){Q("Authentication required"),ce(!1);return}const g=ie?`/api/users/${ie}`:"/api/users",k=await ht.get(g,{headers:{Authorization:`Bearer ${p}`}});P(k.data)}catch(p){console.error("Failed to fetch profile:",p),Q("Could not load profile data")}finally{ce(!1)}})()},[ie]),o.jsxs("div",{className:"modern-dashboard",children:[o.jsx("header",{className:"modern-header",children:o.jsxs("div",{className:"container d-flex justify-content-between align-items-center",children:[o.jsx("div",{className:"logo",style:{cursor:"pointer"},onClick:()=>re("/dashboard"),children:"Mandarin"}),o.jsxs("div",{className:"d-none d-md-flex main-tabs",children:[o.jsx("button",{className:"tab-button",onClick:()=>re("/dashboard"),children:"Dashboard"}),o.jsx("button",{className:"tab-button",onClick:()=>re("/messages"),children:"Messages"})]}),o.jsxs("div",{className:"header-actions d-flex align-items-center",children:[o.jsx(vo,{}),(Ee=s==null?void 0:s.photos)!=null&&Ee[0]?o.jsx("img",{src:s.photos[0].url||"/placeholder.svg?height=32&width=32",alt:s.nickname,className:"user-avatar",onClick:()=>re("/profile")}):o.jsx(Gi,{className:"user-avatar",style:{fontSize:"32px"},onClick:()=>re("/profile")})]})]})}),o.jsx("main",{className:"dashboard-content",children:o.jsx("div",{className:"container",style:{display:"flex",flexDirection:"column",gap:"32px"},children:je?o.jsxs("div",{className:"text-center py-5",children:[o.jsx("div",{className:"spinner spinner-large"}),o.jsx("p",{className:"mt-3",children:"Loading your profile..."})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"profile-photo-section text-center",children:[v.length>0&&A>=0?o.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[o.jsx("img",{src:v[A].url||"/placeholder.svg?height=200&width=200",alt:"Profile",style:{width:"200px",height:"200px",objectFit:"cover",borderRadius:"50%",boxShadow:"0 6px 16px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease"},onLoad:()=>{var b;(b=v[A])!=null&&b.isLoading&&x(p=>p.map((g,k)=>k===A?{...g,isLoading:!1}:g))}}),((Ke=v[A])==null?void 0:Ke.isLoading)&&o.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",background:"rgba(255,255,255,0.7)",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("div",{className:"spinner"})}),v[A].isPrivate&&o.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(Jn,{style:{fontSize:"32px",color:"#fff"}})}),o.jsx("div",{style:{position:"absolute",bottom:"0",left:"0",width:"100%",background:"rgba(0,0,0,0.6)",color:"white",padding:"4px",fontSize:"12px"},children:"Profile Photo"})]}):o.jsx("div",{style:{width:"200px",height:"200px",borderRadius:"50%",background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto"},children:o.jsx(Gi,{style:{fontSize:"80px",color:"#ccc"}})}),o.jsx("div",{style:{marginTop:"16px"},children:M?o.jsxs("div",{className:"upload-progress-container",style:{width:"200px",margin:"0 auto"},children:[o.jsx("div",{className:"progress mb-2",style:{height:"8px"},children:o.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${j}%`},"aria-valuenow":j,"aria-valuemin":"0","aria-valuemax":"100"})}),o.jsxs("div",{className:"text-center",children:["Uploading... ",j,"%"]})]}):o.jsxs("button",{className:"btn btn-outline",onClick:Mt,disabled:D,"aria-label":"Add photo",children:[o.jsx(Jl,{style:{marginRight:"4px"}})," Add Photo",o.jsx("input",{type:"file",ref:q,onChange:Nt,accept:"image/*",style:{display:"none"},"aria-hidden":"true"})]})})]}),v.length>0&&o.jsxs("div",{className:"photo-gallery",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"16px"},children:[v.map(b=>o.jsxs("div",{className:"gallery-item",style:{position:"relative",cursor:b._id.toString().startsWith("temp-")?"not-allowed":"pointer",border:b.isProfile?"2px solid var(--primary)":"2px solid transparent",borderRadius:"8px",overflow:"hidden",transition:"transform 0.3s ease",height:"100px"},onClick:()=>Re(b._id),children:[o.jsx("img",{src:b.url||"/placeholder.svg?height=100&width=100",alt:"Gallery",style:{width:"100%",height:"100%",objectFit:"cover"}}),b.isLoading&&o.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.7)",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("div",{className:"spinner spinner-small"})}),b._id.toString().startsWith("temp-")&&o.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"10px",textAlign:"center",padding:"4px"},children:"Uploading..."}),o.jsxs("div",{className:"photo-controls",style:{position:"absolute",bottom:"0",left:"0",right:"0",display:"flex",justifyContent:"space-between",padding:"4px",background:"rgba(0,0,0,0.5)"},children:[o.jsx("button",{onClick:p=>ue(b._id,p),style:{background:"transparent",border:"none",color:"white",cursor:b._id.toString().startsWith("temp-")?"not-allowed":"pointer",padding:"2px"},title:b.isPrivate?"Make public":"Make private",disabled:D||b.isLoading||b._id.toString().startsWith("temp-"),"aria-label":b.isPrivate?"Make photo public":"Make photo private",children:b.isPrivate?o.jsx(Jn,{style:{fontSize:"14px"}}):o.jsx(j4,{style:{fontSize:"14px"}})}),!b.isProfile&&o.jsx("button",{onClick:p=>{p.stopPropagation(),Re(b._id)},style:{background:"transparent",border:"none",color:"white",cursor:b._id.toString().startsWith("temp-")?"not-allowed":"pointer",padding:"2px"},title:"Set as profile photo",disabled:D||b.isLoading||b._id.toString().startsWith("temp-"),"aria-label":"Set as profile photo",children:o.jsx(L4,{style:{fontSize:"14px"}})}),!b.isProfile&&o.jsx("button",{onClick:p=>De(b._id,p),style:{background:"transparent",border:"none",color:"white",cursor:"pointer",padding:"2px"},title:"Delete photo",disabled:D||b.isLoading,"aria-label":"Delete photo",children:o.jsx(ao,{style:{fontSize:"14px"}})})]}),b.isProfile&&o.jsx("div",{style:{position:"absolute",top:"0",left:"0",background:"var(--primary)",color:"white",fontSize:"10px",padding:"2px 4px",borderBottomRightRadius:"4px"},children:"Profile"})]},b._id)),o.jsx("button",{type:"button",className:"gallery-item add",onClick:Mt,disabled:M||D,style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#eaeaea",border:"2px dashed #ccc",borderRadius:"8px",cursor:"pointer",height:"100px"},"aria-label":"Add new photo",children:o.jsx(Jl,{style:{fontSize:"24px",color:"#555"}})})]}),o.jsxs("div",{className:"profile-info",children:[o.jsxs("div",{className:"profile-header d-flex justify-content-between align-items-center flex-wrap",children:[o.jsx("h2",{children:"My Profile"}),c?o.jsxs("div",{className:"d-flex",style:{gap:"8px"},children:[o.jsxs("button",{className:"btn btn-outline",onClick:se,disabled:W,"aria-label":"Cancel editing",children:[o.jsx(xn,{})," Cancel"]}),o.jsx("button",{className:"btn btn-primary",onClick:St,disabled:W,"aria-label":"Save profile changes",children:W?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"spinner spinner-dark"}),o.jsx("span",{style:{marginLeft:"8px"},children:"Saving..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(pt,{})," Save"]})})]}):o.jsxs("button",{className:"btn btn-primary",onClick:()=>u(!0),"aria-label":"Edit profile",children:[o.jsx(x4,{})," Edit"]})]}),o.jsxs("form",{className:"mt-4",onSubmit:St,children:[o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"Basic Information"}),o.jsxs("div",{className:"info-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"nickname",children:"Nickname"}),o.jsx("input",{type:"text",id:"nickname",name:"nickname",className:`form-control ${T.nickname?"border-danger":""}`,value:f.nickname,onChange:G,disabled:!c,maxLength:50,"aria-invalid":T.nickname?"true":"false","aria-describedby":T.nickname?"nickname-error":void 0}),T.nickname&&o.jsxs("p",{id:"nickname-error",className:"error-message",style:{color:"red",marginTop:"4px"},children:[o.jsx(Ut,{style:{marginRight:"4px"}}),T.nickname]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"details.age",children:"Age"}),o.jsx("input",{type:"number",id:"details.age",name:"details.age",className:`form-control ${T.age?"border-danger":""}`,value:f.details.age,onChange:G,disabled:!c,min:"18",max:"120","aria-invalid":T.age?"true":"false","aria-describedby":T.age?"age-error":void 0}),T.age&&o.jsxs("p",{id:"age-error",className:"error-message",style:{color:"red",marginTop:"4px"},children:[o.jsx(Ut,{style:{marginRight:"4px"}}),T.age]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",htmlFor:"details.location",children:"Location"}),o.jsx("input",{type:"text",id:"details.location",name:"details.location",className:`form-control ${T.location?"border-danger":""}`,value:f.details.location,onChange:G,disabled:!c,maxLength:100,"aria-invalid":T.location?"true":"false","aria-describedby":T.location?"location-error":void 0}),T.location&&o.jsxs("p",{id:"location-error",className:"error-message",style:{color:"red",marginTop:"4px"},children:[o.jsx(Ut,{style:{marginRight:"4px"}}),T.location]})]})]})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"About Me"}),o.jsx("textarea",{name:"details.bio",rows:"4",className:`form-control ${T.bio?"border-danger":""}`,value:f.details.bio||"",onChange:G,disabled:!c,style:{resize:"vertical"},maxLength:500,placeholder:c?"Tell others about yourself...":"No bio provided","aria-invalid":T.bio?"true":"false","aria-describedby":T.bio?"bio-error":void 0}),T.bio&&o.jsxs("p",{id:"bio-error",className:"error-message",style:{color:"red",marginTop:"4px"},children:[o.jsx(Ut,{style:{marginRight:"4px"}}),T.bio]}),c&&o.jsxs("div",{className:"text-muted mt-1",style:{fontSize:"0.8rem",textAlign:"right"},children:[f.details.bio?f.details.bio.length:0,"/500"]})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"Interests"}),c&&o.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.8rem"},children:"Select up to 10 interests"}),o.jsx("div",{className:"interests-tags",style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:K.map(b=>{const p=f.details.interests.includes(b);return o.jsxs("button",{type:"button",className:`interest-tag ${p?"selected":""}`,onClick:()=>c&&oe(b),disabled:!c||!p&&f.details.interests.length>=10,style:{padding:"4px 12px",borderRadius:"20px",backgroundColor:p?"var(--primary)":"var(--light)",color:p?"#fff":"var(--text-medium)",border:"none",cursor:c?"pointer":"default",transition:"all 0.3s ease"},"aria-pressed":p,"aria-label":`Interest: ${b}`,children:[b,p&&o.jsx(pt,{style:{marginLeft:"4px"}})]},b)})}),f.details.interests.length===0&&!c&&o.jsx("p",{className:"text-muted fst-italic mt-2",children:"No interests selected"})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"I am a"}),o.jsx("div",{className:"d-flex flex-wrap gap-2",children:te.map(b=>o.jsxs("button",{type:"button",className:`interest-tag ${f.details.iAm===b?"selected":""}`,onClick:()=>c&&be(b),disabled:!c,style:{padding:"4px 12px",borderRadius:"20px",backgroundColor:f.details.iAm===b?"var(--primary)":"var(--light)",color:f.details.iAm===b?"#fff":"var(--text-medium)",border:"none",cursor:c?"pointer":"default",transition:"all 0.3s ease"},"aria-pressed":f.details.iAm===b,children:[b.charAt(0).toUpperCase()+b.slice(1),f.details.iAm===b&&o.jsx(pt,{style:{marginLeft:"4px"}})]},b))}),!f.details.iAm&&!c&&o.jsx("p",{className:"text-muted fst-italic mt-2",children:"Not specified"})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"Marital Status"}),o.jsx("div",{className:"d-flex flex-wrap gap-2",children:E.map(b=>o.jsxs("button",{type:"button",className:`interest-tag ${f.details.maritalStatus===b?"selected":""}`,onClick:()=>c&&bt(b),disabled:!c,style:{padding:"4px 12px",borderRadius:"20px",backgroundColor:f.details.maritalStatus===b?"var(--primary)":"var(--light)",color:f.details.maritalStatus===b?"#fff":"var(--text-medium)",border:"none",cursor:c?"pointer":"default",transition:"all 0.3s ease"},"aria-pressed":f.details.maritalStatus===b,children:[b,f.details.maritalStatus===b&&o.jsx(pt,{style:{marginLeft:"4px"}})]},b))}),!f.details.maritalStatus&&!c&&o.jsx("p",{className:"text-muted fst-italic mt-2",children:"Not specified"})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"Looking For"}),c&&o.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.8rem"},children:"Select up to 3 options"}),o.jsx("div",{className:"d-flex flex-wrap gap-2",children:B.map(b=>o.jsxs("button",{type:"button",className:`interest-tag ${f.details.lookingFor.includes(b)?"selected":""}`,onClick:()=>c&&Ne(b),disabled:!c||!f.details.lookingFor.includes(b)&&f.details.lookingFor.length>=3,style:{padding:"4px 12px",borderRadius:"20px",backgroundColor:f.details.lookingFor.includes(b)?"var(--primary)":"var(--light)",color:f.details.lookingFor.includes(b)?"#fff":"var(--text-medium)",border:"none",cursor:c?"pointer":"default",transition:"all 0.3s ease"},"aria-pressed":f.details.lookingFor.includes(b),children:[b.charAt(0).toUpperCase()+b.slice(1),f.details.lookingFor.includes(b)&&o.jsx(pt,{style:{marginLeft:"4px"}})]},b))}),f.details.lookingFor.length===0&&!c&&o.jsx("p",{className:"text-muted fst-italic mt-2",children:"Not specified"})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"I'm Into"}),c&&o.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.8rem"},children:"Select up to 20 tags"}),o.jsx("div",{className:"interests-tags",style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:L.map(b=>o.jsxs("button",{type:"button",className:`interest-tag ${f.details.intoTags.includes(b)?"selected":""}`,onClick:()=>c&&_e(b),disabled:!c||!f.details.intoTags.includes(b)&&f.details.intoTags.length>=20,style:{padding:"4px 12px",borderRadius:"20px",backgroundColor:f.details.intoTags.includes(b)?"var(--primary)":"var(--light)",color:f.details.intoTags.includes(b)?"#fff":"var(--text-medium)",border:"none",cursor:c?"pointer":"default",transition:"all 0.3s ease"},"aria-pressed":f.details.intoTags.includes(b),children:[b,f.details.intoTags.includes(b)&&o.jsx(pt,{style:{marginLeft:"4px"}})]},b))}),f.details.intoTags.length===0&&!c&&o.jsx("p",{className:"text-muted fst-italic mt-2",children:"No tags selected"})]}),o.jsxs("div",{className:"info-section",children:[o.jsx("h3",{children:"It Turns Me On"}),c&&o.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.8rem"},children:"Select up to 20 tags"}),o.jsx("div",{className:"interests-tags",style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:I.map(b=>o.jsxs("button",{type:"button",className:`interest-tag ${f.details.turnOns.includes(b)?"selected":""}`,onClick:()=>c&&Ge(b),disabled:!c||!f.details.turnOns.includes(b)&&f.details.turnOns.length>=20,style:{padding:"4px 12px",borderRadius:"20px",backgroundColor:f.details.turnOns.includes(b)?"var(--primary)":"var(--light)",color:f.details.turnOns.includes(b)?"#fff":"var(--text-medium)",border:"none",cursor:c?"pointer":"default",transition:"all 0.3s ease"},"aria-pressed":f.details.turnOns.includes(b),children:[b,f.details.turnOns.includes(b)&&o.jsx(pt,{style:{marginLeft:"4px"}})]},b))}),f.details.turnOns.length===0&&!c&&o.jsx("p",{className:"text-muted fst-italic mt-2",children:"No tags selected"})]})]})]})]})})})]})},g6=()=>{const s=mn(),{user:t,logout:r,getCurrentUser:i}=Ot(),{theme:c,setTheme:u}=Y0(),{currentUser:f,updateProfile:m,getUser:v}=ti(),x=y.useRef(null),A={notifications:{messages:!0,calls:!0,stories:!0,likes:!0,comments:!0},privacy:{showOnlineStatus:!0,showReadReceipts:!0,showLastSeen:!0,allowStoryReplies:"everyone"}},[S,j]=y.useState(A),[C,M]=y.useState("notifications"),[U,D]=y.useState(!1),[ne,K]=y.useState(!1),[te,B]=y.useState(""),[L,I]=y.useState(""),[E,T]=y.useState(!1),[z,W]=y.useState(!1),[H,q]=y.useState(!0),[re,pe]=y.useState(null);y.useEffect(()=>{if(z&&f)return;console.log("useEffect for settings loading triggered"),f?(async()=>{var Te,je,Fe,Me,Ue,Le,he,ye,G,oe,be,Ne,_e,Ge,bt,ut,St,Nt,Mt,ue,Re,De,se,Ee,Ke,b,p,g,k,N;try{console.log("Fetching fresh settings from the server");const $=await Xl.getUserSettings();if($&&$.success&&$.data){console.log("Successfully loaded settings from server:",$.data),console.log("Message notifications from server:",(Te=$.data.notifications)==null?void 0:Te.messages,"typeof:",typeof((je=$.data.notifications)==null?void 0:je.messages));const ae={notifications:{messages:((Fe=$.data.notifications)==null?void 0:Fe.messages)===!1?!1:!!((Me=$.data.notifications)!=null&&Me.messages),calls:((Ue=$.data.notifications)==null?void 0:Ue.calls)===!1?!1:!!((Le=$.data.notifications)!=null&&Le.calls),stories:((he=$.data.notifications)==null?void 0:he.stories)===!1?!1:!!((ye=$.data.notifications)!=null&&ye.stories),likes:((G=$.data.notifications)==null?void 0:G.likes)===!1?!1:!!((oe=$.data.notifications)!=null&&oe.likes),comments:((be=$.data.notifications)==null?void 0:be.comments)===!1?!1:!!((Ne=$.data.notifications)!=null&&Ne.comments)},privacy:{showOnlineStatus:((_e=$.data.privacy)==null?void 0:_e.showOnlineStatus)??A.privacy.showOnlineStatus,showReadReceipts:((Ge=$.data.privacy)==null?void 0:Ge.showReadReceipts)??A.privacy.showReadReceipts,showLastSeen:((bt=$.data.privacy)==null?void 0:bt.showLastSeen)??A.privacy.showLastSeen,allowStoryReplies:((ut=$.data.privacy)==null?void 0:ut.allowStoryReplies)??A.privacy.allowStoryReplies}};console.log("Normalized settings to apply:",ae),console.log("Message notifications in normalized settings:",ae.notifications.messages,"typeof:",typeof ae.notifications.messages),j(ae),W(!0);return}}catch($){console.error("Error fetching settings from server:",$)}if(f&&f.settings){console.log("Falling back to currentUser settings:",f.settings);const $=f.settings||{},ae={notifications:{messages:((St=$.notifications)==null?void 0:St.messages)===!1?!1:!!((Nt=$.notifications)!=null&&Nt.messages),calls:((Mt=$.notifications)==null?void 0:Mt.calls)===!1?!1:!!((ue=$.notifications)!=null&&ue.calls),stories:((Re=$.notifications)==null?void 0:Re.stories)===!1?!1:!!((De=$.notifications)!=null&&De.stories),likes:((se=$.notifications)==null?void 0:se.likes)===!1?!1:!!((Ee=$.notifications)!=null&&Ee.likes),comments:((Ke=$.notifications)==null?void 0:Ke.comments)===!1?!1:!!((b=$.notifications)!=null&&b.comments)},privacy:{showOnlineStatus:((p=$.privacy)==null?void 0:p.showOnlineStatus)??A.privacy.showOnlineStatus,showReadReceipts:((g=$.privacy)==null?void 0:g.showReadReceipts)??A.privacy.showReadReceipts,showLastSeen:((k=$.privacy)==null?void 0:k.showLastSeen)??A.privacy.showLastSeen,allowStoryReplies:((N=$.privacy)==null?void 0:N.allowStoryReplies)??A.privacy.allowStoryReplies}};console.log("Normalized settings from user object:",ae),console.log("Message notifications in normalized user settings:",ae.notifications.messages,"typeof:",typeof ae.notifications.messages),j(ae),W(!0)}else console.log("No settings available, using defaults"),W(!0)})():console.log("No currentUser available, skipping settings load")},[f,A,z]);const ce=(Z,Te)=>{const je=!!S[Z][Te];console.log(`Toggling ${Z}.${Te}:`,`Current value: ${je} (${typeof S[Z][Te]})`,`New value: ${!je}`),j(Fe=>{const Me={...Fe,[Z]:{...Fe[Z],[Te]:!je}};return console.log("New settings after toggle:",Me),Me}),T(!0)},R=(Z,Te,je)=>{j(Fe=>({...Fe,[Z]:{...Fe[Z],[Te]:je}})),T(!0)},Q=Z=>{u(Z)},Y=async()=>{try{K(!0),console.log("Saving settings:",S);const Z={notifications:{messages:S.notifications.messages===!1?!1:!!S.notifications.messages,calls:S.notifications.calls===!1?!1:!!S.notifications.calls,stories:S.notifications.stories===!1?!1:!!S.notifications.stories,likes:S.notifications.likes===!1?!1:!!S.notifications.likes,comments:S.notifications.comments===!1?!1:!!S.notifications.comments},privacy:{...S.privacy}};console.log("Normalized settings before saving:",Z),console.log("Messages notification specifically:",Z.notifications.messages);const Te=await Xl.updateSettings(Z);if(!Te.success)throw new Error(Te.error||"Failed to save settings");f&&(console.log("Updating user profile with normalized settings"),await m({settings:Z})||console.warn("User profile update returned empty response")),Promise.all([jn(()=>Promise.resolve().then(()=>Fi),void 0),jn(()=>Promise.resolve().then(()=>qi),void 0)]).then(([je,Fe])=>{const Me=je.default,Ue=Fe.default;console.log("Updating notification service with normalized settings:",Z.notifications),Me.updateSettings(Z.notifications),console.log("Updating socket service with settings:",Z.privacy),Ue.updatePrivacySettings(Z.privacy),console.log("Services updated with new settings")}).catch(je=>{console.error("Error updating services with settings:",je)}),X.success("Settings saved successfully"),T(!1),console.log("Setting current UI state to match saved settings"),j(Z)}catch(Z){console.error("Error saving settings:",Z),X.error(Z.message||"Failed to save settings. Please try again.")}finally{K(!1)}},P=()=>{E?window.confirm("You have unsaved changes. Are you sure you want to log out?")&&(r(),s("/login")):(r(),s("/login"))},ie=()=>{D(!0)},J=async()=>{try{if(I(""),!te){I("Please enter your password to confirm account deletion");return}const Z=await Xl.deleteAccount({password:te});Z.success?(X.success("Account deleted successfully"),r(),s("/login")):I(Z.error||"Failed to delete account")}catch(Z){console.error("Error deleting account:",Z),I(Z.error||"Failed to delete account. Please try again.")}},ze=()=>{D(!1),B(""),I("")};y.useEffect(()=>{if(z){q(!1);return}console.log("Combined loading effect running"),console.log("User available:",!!t,"currentUser available:",!!f),(async()=>{if(t&&!f&&t._id){console.log("User exists but currentUser is not available yet - fetching user profile");try{typeof v=="function"&&(console.log("Using getUser from UserContext to fetch profile"),await v(t._id)),!f&&typeof i=="function"&&(console.log("Using getCurrentUser from AuthContext to fetch profile"),await i())}catch(Te){console.error("Error fetching user profile:",Te)}}f&&q(!1)})()},[t,f,i,v,z]),y.useEffect(()=>{var Me,Ue,Le,he,ye,G,oe,be,Ne,_e,Ge,bt,ut,St,Nt;if(!z||!f||!f.settings)return;const Z=!x.current||x.current._id!==f._id,Te=(Me=x.current)==null?void 0:Me.settings,je=f.settings;if(!Z&&Te&&JSON.stringify(Te)===JSON.stringify(je))return;console.log("Detected meaningful change in currentUser settings, updating UI state");const Fe={notifications:{messages:((Ue=je.notifications)==null?void 0:Ue.messages)===!1?!1:!!((Le=je.notifications)!=null&&Le.messages),calls:((he=je.notifications)==null?void 0:he.calls)===!1?!1:!!((ye=je.notifications)!=null&&ye.calls),stories:((G=je.notifications)==null?void 0:G.stories)===!1?!1:!!((oe=je.notifications)!=null&&oe.stories),likes:((be=je.notifications)==null?void 0:be.likes)===!1?!1:!!((Ne=je.notifications)!=null&&Ne.likes),comments:((_e=je.notifications)==null?void 0:_e.comments)===!1?!1:!!((Ge=je.notifications)!=null&&Ge.comments)},privacy:{showOnlineStatus:((bt=je.privacy)==null?void 0:bt.showOnlineStatus)??A.privacy.showOnlineStatus,showReadReceipts:((ut=je.privacy)==null?void 0:ut.showReadReceipts)??A.privacy.showReadReceipts,showLastSeen:((St=je.privacy)==null?void 0:St.showLastSeen)??A.privacy.showLastSeen,allowStoryReplies:((Nt=je.privacy)==null?void 0:Nt.allowStoryReplies)??A.privacy.allowStoryReplies}};x.current=f,j(Fe)},[f,A,z]);const de=()=>{var Z;switch(C){case"notifications":return o.jsxs("div",{className:"settings-content",children:[o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Message Notifications"}),o.jsx("p",{children:"Get notified when you receive new messages"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.notifications.messages,onChange:()=>ce("notifications","messages")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Call Notifications"}),o.jsx("p",{children:"Get notified for incoming calls"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.notifications.calls,onChange:()=>ce("notifications","calls")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Story Notifications"}),o.jsx("p",{children:"Get notified when friends post new stories"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.notifications.stories,onChange:()=>ce("notifications","stories")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Like Notifications"}),o.jsx("p",{children:"Get notified when someone likes your content"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.notifications.likes,onChange:()=>ce("notifications","likes")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Comment Notifications"}),o.jsx("p",{children:"Get notified when someone comments on your content"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.notifications.comments,onChange:()=>ce("notifications","comments")}),o.jsx("span",{className:"toggle-slider"})]})]})]});case"privacy":return o.jsxs("div",{className:"settings-content",children:[o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Online Status"}),o.jsx("p",{children:"Show when you're active on the app"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.privacy.showOnlineStatus,onChange:()=>ce("privacy","showOnlineStatus")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Read Receipts"}),o.jsx("p",{children:"Let others know when you've read their messages"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.privacy.showReadReceipts,onChange:()=>ce("privacy","showReadReceipts")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Last Seen"}),o.jsx("p",{children:"Show when you were last active"})]}),o.jsxs("label",{className:"toggle-switch",children:[o.jsx("input",{type:"checkbox",checked:S.privacy.showLastSeen,onChange:()=>ce("privacy","showLastSeen")}),o.jsx("span",{className:"toggle-slider"})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Story Replies"}),o.jsx("p",{children:"Control who can reply to your stories"})]}),o.jsxs("div",{className:"radio-options",children:[o.jsxs("label",{className:"radio-option",children:[o.jsx("input",{type:"radio",name:"storyReplies",value:"everyone",checked:S.privacy.allowStoryReplies==="everyone",onChange:()=>R("privacy","allowStoryReplies","everyone")}),"Everyone"]}),o.jsxs("label",{className:"radio-option",children:[o.jsx("input",{type:"radio",name:"storyReplies",value:"friends",checked:S.privacy.allowStoryReplies==="friends",onChange:()=>R("privacy","allowStoryReplies","friends")}),"Friends only"]}),o.jsxs("label",{className:"radio-option",children:[o.jsx("input",{type:"radio",name:"storyReplies",value:"none",checked:S.privacy.allowStoryReplies==="none",onChange:()=>R("privacy","allowStoryReplies","none")}),"No one"]})]})]})]});case"appearance":return o.jsxs("div",{className:"settings-content",children:[o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Theme"}),o.jsx("p",{children:"Choose your preferred app theme"})]}),o.jsxs("div",{className:"theme-options",children:[o.jsxs("button",{className:`theme-option ${c==="light"?"active":""}`,onClick:()=>Q("light"),children:[o.jsx("div",{className:"theme-preview light"}),o.jsx("span",{children:"Light"})]}),o.jsxs("button",{className:`theme-option ${c==="dark"?"active":""}`,onClick:()=>Q("dark"),children:[o.jsx("div",{className:"theme-preview dark"}),o.jsx("span",{children:"Dark"})]}),o.jsxs("button",{className:`theme-option ${c==="system"?"active":""}`,onClick:()=>Q("system"),children:[o.jsx("div",{className:"theme-preview system"}),o.jsx("span",{children:"System"})]})]})]}),o.jsxs("div",{className:"settings-option",children:[o.jsxs("div",{className:"option-text",children:[o.jsx("h3",{children:"Quick Theme Toggle"}),o.jsx("p",{children:"Quickly switch between light and dark mode"})]}),o.jsx(vo,{})]})]});case"account":return o.jsxs("div",{className:"settings-content",children:[o.jsxs("div",{className:"account-info",children:[o.jsxs("div",{className:"account-detail",children:[o.jsx("strong",{children:"Username:"})," ",(t==null?void 0:t.username)||"Not available"]}),o.jsxs("div",{className:"account-detail",children:[o.jsx("strong",{children:"Email:"})," ",(t==null?void 0:t.email)||"Not available"]}),o.jsxs("div",{className:"account-detail",children:[o.jsx("strong",{children:"Member since:"})," ",t!=null&&t.createdAt?new Date(t.createdAt).toLocaleDateString():"Not available"]}),o.jsxs("div",{className:"account-detail",children:[o.jsx("strong",{children:"Subscription:"})," ",((Z=t==null?void 0:t.subscription)==null?void 0:Z.plan)||"Free"]})]}),o.jsxs("div",{className:"account-actions",children:[o.jsxs("button",{className:"settings-action-button edit",onClick:()=>s("/profile"),children:[o.jsx(Pl,{}),o.jsx("span",{children:"Edit Profile"})]}),o.jsxs("button",{className:"settings-action-button logout",onClick:P,children:[o.jsx(D4,{}),o.jsx("span",{children:"Log out"})]}),o.jsxs("button",{className:"settings-action-button delete",onClick:ie,children:[o.jsx(ao,{}),o.jsx("span",{children:"Delete Account"})]})]})]});default:return null}};return!f&&H&&!re?o.jsx("div",{className:"settings-page",children:o.jsxs("div",{className:"settings-container",children:[o.jsx("h1",{className:"settings-title",children:"Settings"}),o.jsx("div",{className:"loading-message",children:o.jsx("p",{children:"Loading your settings..."})})]})}):o.jsxs("div",{className:"settings-page",children:[o.jsxs("div",{className:"settings-container",children:[o.jsx("h1",{className:"settings-title",children:"Settings"}),o.jsxs("div",{className:"settings-navigation",children:[o.jsxs("button",{className:`settings-nav-item ${C==="notifications"?"active":""}`,onClick:()=>M("notifications"),children:[o.jsx(Yi,{className:"settings-icon"}),o.jsx("span",{children:"Notifications"})]}),o.jsxs("button",{className:`settings-nav-item ${C==="privacy"?"active":""}`,onClick:()=>M("privacy"),children:[o.jsx(Jn,{className:"settings-icon"}),o.jsx("span",{children:"Privacy"})]}),o.jsxs("button",{className:`settings-nav-item ${C==="appearance"?"active":""}`,onClick:()=>M("appearance"),children:[o.jsx(df,{className:"settings-icon"}),o.jsx("span",{children:"Appearance"})]}),o.jsxs("button",{className:`settings-nav-item ${C==="account"?"active":""}`,onClick:()=>M("account"),children:[o.jsx(Pl,{className:"settings-icon"}),o.jsx("span",{children:"Account"})]})]}),o.jsxs("div",{className:"settings-panel",children:[o.jsxs("div",{className:"settings-header",children:[C==="notifications"&&o.jsx(Yi,{className:"settings-header-icon"}),C==="privacy"&&o.jsx(Jn,{className:"settings-header-icon"}),C==="appearance"&&o.jsx(df,{className:"settings-header-icon"}),C==="account"&&o.jsx(Pl,{className:"settings-header-icon"}),o.jsxs("h2",{className:"settings-section-title",children:[C==="notifications"&&"Notification Settings",C==="privacy"&&"Privacy Settings",C==="appearance"&&"Appearance Settings",C==="account"&&"Account Settings"]})]}),de(),(C==="notifications"||C==="privacy")&&o.jsx("div",{className:"settings-save",children:o.jsxs("button",{className:`btn btn-primary save-button ${E?"has-changes":""}`,onClick:Y,disabled:ne||!E,children:[o.jsx(R4,{}),ne?"Saving...":"Save Changes"]})})]})]}),U&&o.jsx("div",{className:"modal-overlay",children:o.jsxs("div",{className:"confirmation-modal",children:[o.jsxs("div",{className:"modal-header",children:[o.jsxs("h2",{children:[o.jsx(ao,{})," Delete Account"]}),o.jsx("button",{className:"close-button",onClick:ze,children:o.jsx(xn,{})})]}),o.jsxs("div",{className:"modal-content",children:[o.jsxs("div",{className:"warning-message",children:[o.jsx(O4,{className:"warning-icon"}),o.jsxs("p",{children:["This action ",o.jsx("strong",{children:"cannot be undone"}),". All your data will be permanently deleted, including:"]}),o.jsxs("ul",{children:[o.jsx("li",{children:"Your profile information"}),o.jsx("li",{children:"All messages and conversations"}),o.jsx("li",{children:"Photos and media you've shared"}),o.jsx("li",{children:"Stories and other content"})]})]}),o.jsxs("div",{className:"password-confirmation",children:[o.jsx("label",{htmlFor:"delete-password",children:"Enter your password to confirm:"}),o.jsx("input",{id:"delete-password",type:"password",value:te,onChange:Z=>B(Z.target.value),placeholder:"Your password",className:L?"error":""}),L&&o.jsx("div",{className:"error-message",children:L})]})]}),o.jsxs("div",{className:"confirmation-actions",children:[o.jsxs("button",{className:"btn btn-secondary",onClick:ze,children:[o.jsx(xn,{})," Cancel"]}),o.jsxs("button",{className:"btn btn-danger",onClick:J,disabled:!te,children:[o.jsx(ao,{})," Delete My Account"]})]})]})})]})},A6=()=>{const s=mn();return o.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center",style:{height:"80vh",textAlign:"center"},children:[o.jsx("h1",{style:{fontSize:"3rem",marginBottom:"16px"},children:"404"}),o.jsx("p",{style:{marginBottom:"24px"},children:"Oops! The page you're looking for doesn't exist."}),o.jsx("button",{className:"btn btn-primary",onClick:()=>s("/"),children:"Go Home"})]})},y6=()=>{const s=mn(),[t,r]=y.useState(""),i=c=>{c.preventDefault(),s("/register",{state:{email:t}})};return o.jsxs("div",{className:"modern-home-page",children:[o.jsx("header",{className:"modern-header",children:o.jsxs("div",{className:"container d-flex justify-content-between align-items-center",children:[o.jsx("div",{className:"logo",children:"Mandarin"}),o.jsxs("nav",{className:"d-none d-md-flex main-tabs",children:[o.jsx(nn,{to:"/about",className:"tab-button",children:"About"}),o.jsx(nn,{to:"/safety",className:"tab-button",children:"Safety"}),o.jsx(nn,{to:"/support",className:"tab-button",children:"Support"})]}),o.jsxs("div",{className:"header-actions d-flex align-items-center",children:[o.jsx(vo,{}),o.jsx(nn,{to:"/login",className:"btn btn-outline btn-sm",children:"Login"}),o.jsx(nn,{to:"/register",className:"btn btn-primary btn-sm",children:"Register"})]})]})}),o.jsxs("section",{className:"hero-section",children:[o.jsxs("div",{className:"hero-content",children:[o.jsx("h1",{children:"Find Your Perfect Connection"}),o.jsx("p",{children:"Discover genuine connections in a safe, discreet environment designed for adults seeking meaningful encounters."}),o.jsx("div",{className:"hero-actions",children:o.jsxs("form",{onSubmit:i,style:{display:"flex",gap:"8px"},children:[o.jsx("input",{type:"email",placeholder:"Enter your email",className:"form-control",style:{maxWidth:"250px"},value:t,onChange:c=>r(c.target.value),required:!0}),o.jsxs("button",{type:"submit",className:"btn btn-primary",children:[o.jsx("span",{children:"Get Started"})," ",o.jsx(Zl,{})]})]})})]}),o.jsx("div",{className:"hero-image",children:o.jsxs("div",{className:"image-collage",children:[o.jsx("div",{className:"collage-image image1"}),o.jsx("div",{className:"collage-image image2"}),o.jsx("div",{className:"collage-image image3"})]})})]}),o.jsxs("footer",{className:"modern-footer",children:[o.jsxs("div",{className:"container footer-content",children:[o.jsx("div",{className:"footer-logo",children:"Mandarin"}),o.jsxs("div",{className:"footer-links",children:[o.jsx(nn,{to:"/about",children:"About Us"}),o.jsx(nn,{to:"/safety",children:"Safety"}),o.jsx(nn,{to:"/support",children:"Support"}),o.jsx(nn,{to:"/terms",children:"Terms"}),o.jsx(nn,{to:"/privacy",children:"Privacy"})]}),o.jsxs("div",{className:"footer-social",children:[o.jsx("a",{href:"#",className:"social-icon",children:"FB"}),o.jsx("a",{href:"#",className:"social-icon",children:"IG"}),o.jsx("a",{href:"#",className:"social-icon",children:"TW"})]})]}),o.jsx("div",{className:"footer-bottom",children:o.jsxs("p",{children:[" ",new Date().getFullYear()," Mandarin Dating. All rights reserved."]})})]})]})},CA=6e4,jA=525600,_A=43200,EA=1440,NA=Symbol.for("constructDateFrom");function eh(s,t){return typeof s=="function"?s(t):s&&typeof s=="object"&&NA in s?s[NA](t):s instanceof Date?new s.constructor(t):new Date(t)}function xf(s,t){return eh(s,s)}let v6={};function b6(){return v6}function TA(s){const t=xf(s),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+s-+r}function x6(s,...t){const r=eh.bind(null,s||t.find(i=>typeof i=="object"));return t.map(r)}function S6(s,t){const r=+xf(s)-+xf(t);return r<0?-1:r>0?1:r}function w6(s){return eh(s,Date.now())}function k6(s){return t=>{const i=(s?Math[s]:Math.trunc)(t);return i===0?0:i}}const C6={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},j6=(s,t,r)=>{let i;const c=C6[s];return typeof c=="string"?i=c:t===1?i=c.one:i=c.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+i:i+" ago":i};function qd(s){return(t={})=>{const r=t.width?String(t.width):s.defaultWidth;return s.formats[r]||s.formats[s.defaultWidth]}}const _6={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},E6={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},N6={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},T6={date:qd({formats:_6,defaultWidth:"full"}),time:qd({formats:E6,defaultWidth:"full"}),dateTime:qd({formats:N6,defaultWidth:"full"})},R6={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},M6=(s,t,r,i)=>R6[s];function eo(s){return(t,r)=>{const i=r!=null&&r.context?String(r.context):"standalone";let c;if(i==="formatting"&&s.formattingValues){const f=s.defaultFormattingWidth||s.defaultWidth,m=r!=null&&r.width?String(r.width):f;c=s.formattingValues[m]||s.formattingValues[f]}else{const f=s.defaultWidth,m=r!=null&&r.width?String(r.width):s.defaultWidth;c=s.values[m]||s.values[f]}const u=s.argumentCallback?s.argumentCallback(t):t;return c[u]}}const O6={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},D6={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},L6={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},z6={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},U6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},B6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},P6=(s,t)=>{const r=Number(s),i=r%100;if(i>20||i<10)switch(i%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},$6={ordinalNumber:P6,era:eo({values:O6,defaultWidth:"wide"}),quarter:eo({values:D6,defaultWidth:"wide",argumentCallback:s=>s-1}),month:eo({values:L6,defaultWidth:"wide"}),day:eo({values:z6,defaultWidth:"wide"}),dayPeriod:eo({values:U6,defaultWidth:"wide",formattingValues:B6,defaultFormattingWidth:"wide"})};function to(s){return(t,r={})=>{const i=r.width,c=i&&s.matchPatterns[i]||s.matchPatterns[s.defaultMatchWidth],u=t.match(c);if(!u)return null;const f=u[0],m=i&&s.parsePatterns[i]||s.parsePatterns[s.defaultParseWidth],v=Array.isArray(m)?I6(m,S=>S.test(f)):q6(m,S=>S.test(f));let x;x=s.valueCallback?s.valueCallback(v):v,x=r.valueCallback?r.valueCallback(x):x;const A=t.slice(f.length);return{value:x,rest:A}}}function q6(s,t){for(const r in s)if(Object.prototype.hasOwnProperty.call(s,r)&&t(s[r]))return r}function I6(s,t){for(let r=0;r<s.length;r++)if(t(s[r]))return r}function F6(s){return(t,r={})=>{const i=t.match(s.matchPattern);if(!i)return null;const c=i[0],u=t.match(s.parsePattern);if(!u)return null;let f=s.valueCallback?s.valueCallback(u[0]):u[0];f=r.valueCallback?r.valueCallback(f):f;const m=t.slice(c.length);return{value:f,rest:m}}}const H6=/^(\d+)(th|st|nd|rd)?/i,V6=/\d+/i,Y6={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},G6={any:[/^b/i,/^(a|c)/i]},X6={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Q6={any:[/1/i,/2/i,/3/i,/4/i]},K6={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Z6={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},J6={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},W6={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},eS={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},tS={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},nS={ordinalNumber:F6({matchPattern:H6,parsePattern:V6,valueCallback:s=>parseInt(s,10)}),era:to({matchPatterns:Y6,defaultMatchWidth:"wide",parsePatterns:G6,defaultParseWidth:"any"}),quarter:to({matchPatterns:X6,defaultMatchWidth:"wide",parsePatterns:Q6,defaultParseWidth:"any",valueCallback:s=>s+1}),month:to({matchPatterns:K6,defaultMatchWidth:"wide",parsePatterns:Z6,defaultParseWidth:"any"}),day:to({matchPatterns:J6,defaultMatchWidth:"wide",parsePatterns:W6,defaultParseWidth:"any"}),dayPeriod:to({matchPatterns:eS,defaultMatchWidth:"any",parsePatterns:tS,defaultParseWidth:"any"})},sS={code:"en-US",formatDistance:j6,formatLong:T6,formatRelative:M6,localize:$6,match:nS,options:{weekStartsOn:0,firstWeekContainsDate:1}};function rS(s,t,r){const i=b6(),c=(r==null?void 0:r.locale)??i.locale??sS,u=S6(s,t);if(isNaN(u))throw new RangeError("Invalid time value");const f=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:u}),[m,v]=x6(r==null?void 0:r.in,...u>0?[t,s]:[s,t]),x=k6((r==null?void 0:r.roundingMethod)??"round"),A=v.getTime()-m.getTime(),S=A/CA,j=TA(v)-TA(m),C=(A-j)/CA,M=r==null?void 0:r.unit;let U;if(M?U=M:S<1?U="second":S<60?U="minute":S<EA?U="hour":C<_A?U="day":C<jA?U="month":U="year",U==="second"){const D=x(A/1e3);return c.formatDistance("xSeconds",D,f)}else if(U==="minute"){const D=x(S);return c.formatDistance("xMinutes",D,f)}else if(U==="hour"){const D=x(S/60);return c.formatDistance("xHours",D,f)}else if(U==="day"){const D=x(C/EA);return c.formatDistance("xDays",D,f)}else if(U==="month"){const D=x(C/_A);return D===12&&M!=="month"?c.formatDistance("xYears",1,f):c.formatDistance("xMonths",D,f)}else{const D=x(C/jA);return c.formatDistance("xYears",D,f)}}function iS(s,t){return rS(s,w6(s),t)}const zt=Rt.create("Messages"),RA=()=>{const{user:s,authChecked:t,isAuthenticated:r,token:i}=Ot(),c=yo(),u=mn(),{userId:f}=MA(),[m,v]=y.useState([]),[x,A]=y.useState(!0),[S,j]=y.useState(null),[C,M]=y.useState(null),[U,D]=y.useState(""),[ne,K]=y.useState([]),[te,B]=y.useState(null),[L,I]=y.useState(!1),[E,T]=y.useState(null),[z,W]=y.useState(0),H=y.useRef(null),q=y.useRef(null),re=y.useRef(null),pe=y.useRef(!1),ce=y.useRef(!1),R=y.useCallback(async(he=!1)=>{if(!r||!(s!=null&&s._id)){zt.debug("Not authenticated or missing user ID, skipping conversation fetch"),A(!1);return}if(x&&!he){zt.debug("Already loading conversations, skipping duplicate fetch");return}const ye=setTimeout(()=>{zt.warn("Conversation loading timeout reached, resetting loading state"),A(!1),j("Loading conversations timed out. Please try again."),pe.current=!1},15e3);A(!0),j(null);try{zt.info(`Fetching conversations for user ${s._id}...`);const oe=await((Ne=1e4)=>Promise.race([c.get("/messages/conversations"),new Promise((_e,Ge)=>setTimeout(()=>Ge(new Error("Request timed out")),Ne))]))();if(clearTimeout(ye),!oe||!oe.success)throw zt.warn("API returned unsuccessful response:",oe),new Error((oe==null?void 0:oe.error)||"Failed to load conversations");const be=Array.isArray(oe.data)?oe.data:[];return zt.info(`Loaded ${be.length} conversations`),v(be),K(be),A(!1),W(0),ce.current=!0,re.current&&(clearTimeout(re.current),re.current=null),be}catch(G){zt.error("Error fetching conversations:",G),clearTimeout(ye),j(G.message||"Failed to load conversations"),A(!1);const oe=z+1;if(W(oe),oe<=3){const be=Math.min(3e3*Math.pow(1.5,oe-1),1e4);zt.debug(`Will retry in ${be/1e3} seconds (attempt ${oe})`),re.current=setTimeout(()=>{zt.debug(`Auto-retrying conversation fetch (attempt ${oe})...`),R(!0)},be)}else zt.warn("Maximum retry attempts reached"),pe.current=!1;return[]}},[r,s,c,x,z]);y.useEffect(()=>{let he=!0;(async()=>{t&&(r&&(s!=null&&s._id)?!pe.current&&he&&(zt.info(`Initial conversations load for user ${s._id}`),pe.current=!0,await new Promise(oe=>setTimeout(oe,500)),he&&R()):he&&A(!1))})();const G=setTimeout(()=>{he&&x&&(zt.warn("Safety timeout triggered - forcing loading state reset"),A(!1))},2e4);return()=>{he=!1,re.current&&clearTimeout(re.current),clearTimeout(G)}},[t,r,s,R,x]);const Q=y.useCallback(async he=>{if(!(!he||!(s!=null&&s._id)))try{await c.put(`/messages/conversation/${he}/read`),v(ye=>ye.map(G=>{var be;return((be=G.user)==null?void 0:be._id)===he?{...G,unreadCount:0}:G}))}catch(ye){zt.error("Error marking conversation as read:",ye)}},[s,c]),Y=y.useCallback(async he=>{if(he)try{return await c.delete(`/messages/conversation/${he}`),v(ye=>ye.filter(G=>G._id!==he)),K(ye=>ye.filter(G=>G._id!==he)),!0}catch(ye){throw zt.error("Error deleting conversation:",ye),ye}},[c]);y.useEffect(()=>{if(!(!Array.isArray(m)||m.length===0)){if(f){const he=m.find(ye=>{var G;return((G=ye.user)==null?void 0:G._id)===f});if(he){const ye=he.user;ye&&ye._id?(M(ye),T(ye._id),he.unreadCount>0&&Q(ye._id),I(!0)):(zt.warn("Found conversation but recipient data is invalid:",he),M(null),T(null),u("/messages",{replace:!0}))}else M(null),T(null),location.pathname!=="/messages"&&u("/messages",{replace:!0})}else if(!f)if(E){const he=m.find(G=>{var oe;return((oe=G.user)==null?void 0:oe._id)===E}),ye=he==null?void 0:he.user;ye!=null&&ye._id?(M(ye),I(!0)):(M(null),T(null))}else M(null)}},[f,m,u,Q,E]),y.useEffect(()=>{if(!Array.isArray(m)){K([]);return}const he=U.toLowerCase().trim();if(!he){K(m);return}const ye=m.filter(G=>{var be,Ne,_e;const oe=G==null?void 0:G.user;return((be=oe==null?void 0:oe.nickname)==null?void 0:be.toLowerCase().includes(he))||((_e=(Ne=G==null?void 0:G.lastMessage)==null?void 0:Ne.content)==null?void 0:_e.toLowerCase().includes(he))});K(ye)},[U,m]);const P=y.useCallback(he=>{if(!he||!he._id){zt.warn("Attempted to select conversation with invalid recipient:",he);return}M(he),T(he._id),u(`/messages/${he._id}`,{replace:!0});const ye=m.find(G=>{var oe;return((oe=G.user)==null?void 0:oe._id)===he._id});(ye==null?void 0:ye.unreadCount)>0&&Q(he._id),I(!0),B(null)},[m,u,Q]),ie=he=>{D(he.target.value)},J=()=>{var he;D(""),(he=H.current)==null||he.focus()},ze=(he,ye)=>{he.stopPropagation(),B(G=>G===ye?null:ye)},de=async(he,ye)=>{if(he.stopPropagation(),!ye)return;const G=m.find(be=>{var Ne;return((Ne=be.user)==null?void 0:Ne._id)===ye}),oe=G==null?void 0:G._id;if(!oe){zt.error("Conversation ID not found for recipient:",ye),X.error("Could not find conversation to delete");return}if(window.confirm("Are you sure you want to delete this conversation?"))try{await Y(oe),B(null),zt.info("Conversation deleted successfully"),K(be=>be.filter(Ne=>Ne._id!==oe)),(C==null?void 0:C._id)===ye&&(M(null),T(null),u("/messages",{replace:!0}))}catch(be){zt.error("Delete conversation error:",be),X.error("Failed to delete conversation")}},Z=async(he,ye,G)=>{he.stopPropagation();try{zt.debug(`Toggling mute for ${ye}. Current: ${G}`),X.info("Mute functionality not yet implemented."),B(null)}catch(oe){zt.error("Failed to update mute status:",oe),X.error("Failed to update mute status")}},Te=he=>{var ye;if((he==null?void 0:he.type)==="file"&&((ye=he.metadata)!=null&&ye.mimeType)){const G={...he,metadata:{...he.metadata,fileType:he.metadata.mimeType}};return Qd(G,s==null?void 0:s._id)}return Qd(he,s==null?void 0:s._id)},je=he=>{if(!he)return"";try{return iS(new Date(he),{addSuffix:!0})}catch(ye){return zt.warn("Error formatting timestamp:",he,ye),""}},Fe=()=>{I(!1),window.innerWidth<=768&&u("/messages",{replace:!0}),T(null),M(null)},Me=he=>{var G,oe;return!he||he.sender===(s==null?void 0:s._id)?null:{wink:o.jsx("span",{className:"message-type-icon wink",title:"Wink",children:""}),file:(oe=(G=he.metadata)==null?void 0:G.mimeType)!=null&&oe.startsWith("image/")?o.jsx("span",{className:"message-type-icon image",title:"Image",children:""}):o.jsx("span",{className:"message-type-icon file",title:"File",children:""}),video:o.jsx("span",{className:"message-type-icon video",title:"Video",children:""})}[he.type]||null},Ue=()=>{R(!0)},Le=()=>{window.confirm("This will log you out. You'll need to sign in again. Continue?")&&l0()};return y.useEffect(()=>{},[m.length,x,S]),o.jsxs("div",{className:"messages-page-layout",children:[o.jsx(Zf,{}),o.jsxs("div",{className:"messages-main-content",children:[o.jsxs("div",{className:Zr("conversations-panel-wrapper",L?"mobile-hidden":""),children:[o.jsxs("div",{className:"conversations-header",children:[o.jsx("h2",{children:"Messages"}),o.jsxs("div",{className:"search-container",children:[o.jsx(Ff,{className:"search-icon"}),o.jsx("input",{type:"text",placeholder:"Search conversations...",value:U,onChange:ie,ref:H,className:"search-input","aria-label":"Search conversations"}),U&&o.jsx("button",{className:"clear-search",onClick:J,"aria-label":"Clear search",children:""})]})]}),o.jsx("div",{className:"conversations-list",ref:q,children:x?o.jsxs("div",{className:"loading-state",children:[o.jsx(Ln,{className:"fa-spin"}),o.jsx("p",{children:"Loading conversations..."}),z>0&&o.jsxs("p",{className:"retry-info",children:["Attempt ",z," - Please wait..."]}),z>2&&o.jsxs("div",{className:"loading-fallback",children:[o.jsx("p",{children:"This is taking longer than expected."}),o.jsxs("div",{className:"error-actions",children:[o.jsxs("button",{onClick:Ue,className:"retry-button",children:[o.jsx(Wl,{})," Retry"]}),o.jsx("button",{onClick:Le,className:"reset-button",children:"Reset Session"}),!1]})]})]}):S?o.jsxs("div",{className:"error-state",children:[o.jsx(Ut,{className:"error-icon"}),o.jsx("p",{children:S||"Failed to load conversations"}),o.jsxs("div",{className:"error-actions",children:[o.jsxs("button",{onClick:Ue,className:"retry-button",children:[o.jsx(Wl,{className:x?"fa-spin":""})," Retry"]}),o.jsx("button",{onClick:Le,className:"reset-button",children:"Reset Session"}),!1]})]}):ne.length===0?o.jsxs("div",{className:"empty-state",children:[o.jsx("p",{children:U?"No conversations match search":"No conversations yet"}),!U&&o.jsx("button",{className:"start-chat-btn",onClick:()=>u("/dashboard"),children:"Find Users"}),!1]}):ne.map(he=>{var Ne,_e;const ye=he==null?void 0:he.user;if(!(he!=null&&he._id)||!(ye!=null&&ye._id))return zt.warn("Skipping invalid conversation:",he),null;const G=ye._id,oe=(C==null?void 0:C._id)===G,be=he.muted||!1;return o.jsxs("div",{className:Zr("conversation-item",oe?"selected":"",he.unreadCount>0?"unread":""),onClick:()=>P(ye),role:"button",tabIndex:0,"aria-selected":oe,children:[o.jsxs("div",{className:"avatar-container",children:[((Ne=ye==null?void 0:ye.photos)==null?void 0:Ne.length)>0?o.jsx("img",{src:Zi(ye.photos[0].url)||"/placeholder.svg?height=50&width=50",alt:ye.nickname||`User ${G}`,className:"avatar",onError:Ge=>{Ge.target.onerror=null,Ge.target.src="/placeholder.svg?height=50&width=50"}}):o.jsx(Gi,{className:"avatar-placeholder"}),(ye==null?void 0:ye.isOnline)&&o.jsx("span",{className:"online-indicator"})]}),o.jsxs("div",{className:"conversation-info",children:[o.jsxs("div",{className:"conversation-info-header",children:[o.jsx("h3",{className:"recipient-name",children:ye.nickname||"User"}),o.jsx("span",{className:"timestamp",children:je((_e=he.lastMessage)==null?void 0:_e.createdAt)})]}),o.jsxs("div",{className:"last-message",children:[Me(he.lastMessage),o.jsx("p",{className:"message-preview",children:Te(he.lastMessage)}),he.unreadCount>0&&o.jsx("span",{className:"unread-badge",children:he.unreadCount>9?"9+":he.unreadCount})]})]}),o.jsxs("div",{className:"conversation-actions",children:[o.jsx("button",{className:"conversation-menu-btn",onClick:Ge=>ze(Ge,G),"aria-label":"Conversation options",children:o.jsx(S4,{})}),te===G&&o.jsxs("div",{className:"conversation-menu",onClick:Ge=>Ge.stopPropagation(),children:[o.jsxs("button",{onClick:Ge=>Z(Ge,he._id,be),children:[be?o.jsx(Yi,{}):o.jsx(y4,{})," ",be?"Unmute":"Mute"]}),o.jsxs("button",{className:"delete-btn",onClick:Ge=>de(Ge,G),children:[o.jsx(I4,{})," Delete"]})]})]})]},he._id)})})]}),o.jsx("div",{className:Zr("chat-panel-wrapper",L?"":"mobile-hidden"),children:C?o.jsx(c6,{recipient:C,isOpen:!0,onClose:Fe,embedded:!1},C._id):o.jsxs("div",{className:"no-chat-selected",children:[o.jsx(dc,{className:"select-arrow-icon"}),o.jsx("h3",{children:"Select a conversation"}),o.jsx("p",{children:"Choose someone from the list to start chatting."})]})})]}),o.jsx("style",{children:`
        .messages-page-layout {
          display: flex;
          flex-direction: column;
          height: 100vh;
          overflow: hidden;
        }
        .messages-main-content {
          display: flex;
          flex-grow: 1;
          overflow: hidden;
          background-color: var(--bg-light);
        }
        .conversations-panel-wrapper {
          width: 320px;
          flex-shrink: 0;
          display: flex;
          flex-direction: column;
          border-right: 1px solid var(--border-color);
          background-color: var(--white);
        }
        .chat-panel-wrapper {
          flex-grow: 1;
          display: flex;
          flex-direction: column;
          background-color: var(--bg-card);
          overflow: hidden;
        }

        /* Override EmbeddedChat styles */
        .chat-panel-wrapper > :global(.embedded-chat) {
          position: relative !important;
          height: 100% !important;
          width: 100% !important;
          max-width: none !important;
          max-height: none !important;
          box-shadow: none !important;
          border-radius: 0 !important;
          border: none !important;
          animation: none !important;
          bottom: auto !important;
          right: auto !important;
          z-index: 1 !important;
          display: flex !important;
          flex-direction: column !important;
          flex-grow: 1 !important;
          overflow: hidden;
        }
        /* Ensure inner chat container also takes full height */
        .chat-panel-wrapper > :global(.embedded-chat > div:first-child) {
          height: 100%;
          display: flex;
          flex-direction: column;
        }

        .conversations-header {
          padding: 16px;
          border-bottom: 1px solid var(--border-color);
          flex-shrink: 0;
        }
        .conversations-header h2 {
          font-size: 1.1rem;
          font-weight: 600;
          margin: 0 0 12px 0;
        }
        .search-container {
          position: relative;
        }
        .search-icon {
          position: absolute;
          left: 10px;
          top: 50%;
          transform: translateY(-50%);
          color: var(--text-light);
        }
        .search-input {
          width: 100%;
          padding: 8px 12px 8px 35px;
          border-radius: 20px;
          border: 1px solid var(--border-color);
          background-color: var(--bg-light);
        }
        .clear-search {
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          background: none;
          border: none;
          color: var(--text-light);
          cursor: pointer;
          font-size: 1.2rem;
        }
        .conversations-list {
          flex-grow: 1;
          overflow-y: auto;
          padding: 8px;
          scrollbar-width: thin;
          scrollbar-color: var(--border-color) transparent;
        }
        .conversations-list::-webkit-scrollbar {
          width: 5px;
        }
        .conversations-list::-webkit-scrollbar-thumb {
          background-color: var(--border-color);
          border-radius: 10px;
        }
        .conversation-item {
          display: flex;
          padding: 12px 8px;
          border-radius: 8px;
          margin-bottom: 4px;
          cursor: pointer;
          transition: background-color 0.2s ease;
          position: relative;
        }
        .conversation-item:hover {
          background-color: var(--bg-light);
        }
        .conversation-item.selected {
          background-color: var(--primary-subtle);
        }
        .conversation-item.unread .recipient-name,
        .conversation-item.unread .message-preview {
          font-weight: 600;
          color: var(--text-dark);
        }
        .conversation-item.unread .message-type-icon {
          color: var(--text-dark);
        }
        .avatar-container {
          position: relative;
          margin-right: 12px;
          flex-shrink: 0;
        }
        .avatar {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          object-fit: cover;
        }
        .avatar-placeholder {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background-color: var(--light);
          color: var(--text-light);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.5rem;
        }
        .online-indicator {
          position: absolute;
          bottom: 2px;
          right: 2px;
          width: 12px;
          height: 12px;
          background-color: var(--success);
          border-radius: 50%;
          border: 2px solid var(--white);
        }
        .conversation-info {
          flex-grow: 1;
          overflow: hidden;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        .conversation-info-header {
          display: flex;
          justify-content: space-between;
          align-items: baseline;
        }
        .recipient-name {
          font-weight: 500;
          font-size: 0.9rem;
          color: var(--text-dark);
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          margin: 0;
        }
        .timestamp {
          font-size: 0.7rem;
          color: var(--text-light);
          flex-shrink: 0;
          margin-left: 8px;
        }
        .last-message {
          display: flex;
          align-items: center;
          gap: 4px;
          margin-top: 2px;
          max-width: 100%;
        }
        .message-type-icon {
          font-size: 0.8rem;
          color: var(--text-light);
          flex-shrink: 0;
        }
        .message-preview {
          font-size: 0.8rem;
          color: var(--text-light);
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          margin: 0;
          flex-grow: 1;
        }
        .unread-badge {
          background-color: var(--primary);
          color: white;
          font-size: 0.7rem;
          font-weight: bold;
          padding: 1px 6px;
          border-radius: 10px;
          margin-left: 8px;
          flex-shrink: 0;
        }
        .conversation-actions {
          position: relative;
        }
        .conversation-menu-btn {
          background: none;
          border: none;
          color: var(--text-light);
          cursor: pointer;
          padding: 5px;
          margin-left: 5px;
          border-radius: 50%;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background-color 0.2s;
        }
        .conversation-menu-btn:hover {
          background-color: var(--bg-light);
        }
        .conversation-menu {
          position: absolute;
          right: 0;
          top: 35px;
          background-color: var(--white);
          border-radius: 8px;
          box-shadow: var(--shadow);
          z-index: 10;
          overflow: hidden;
          min-width: 120px;
          border: 1px solid var(--border-color);
        }
        .conversation-menu button {
          display: flex;
          align-items: center;
          gap: 8px;
          width: 100%;
          padding: 8px 12px;
          text-align: left;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 0.85rem;
          color: var(--text-medium);
        }
        .conversation-menu button:hover {
          background-color: var(--bg-light);
        }
        .conversation-menu button.delete-btn {
          color: var(--danger);
        }
        .conversation-menu button.delete-btn:hover {
          background-color: var(--danger-light);
        }
        .no-chat-selected {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          text-align: center;
          color: var(--text-light);
          background-color: var(--bg-card);
          padding: 20px;
        }
        .no-chat-selected h3 {
          margin-top: 16px;
          font-size: 1.1rem;
          color: var(--text-medium);
        }
        .select-arrow-icon {
          font-size: 2rem;
          color: var(--border-color);
          margin-bottom: 16px;
          animation: bounce-left 1.5s infinite;
        }
        @keyframes bounce-left {
          0%, 100% { transform: translateX(0); }
          50% { transform: translateX(-10px); }
        }

        .loading-state, .error-state, .empty-state {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 20px;
          color: var(--text-light);
          height: calc(100% - 100px);
          text-align: center;
        }
        
        .loading-fallback {
          margin-top: 1.5rem;
          padding: 1rem;
          background-color: var(--bg-light);
          border-radius: 8px;
          width: 90%;
          max-width: 300px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .error-icon {
          font-size: 2rem;
          color: var(--danger);
          margin-bottom: 16px;
        }
        .error-state p {
          max-width: 80%;
          margin-bottom: 16px;
          color: var(--danger);
        }
        .retry-info {
          font-size: 0.8rem;
          color: var(--text-light);
          margin-top: 8px;
        }
        .error-actions {
          display: flex;
          gap: 10px;
          margin-top: 10px;
          flex-wrap: wrap;
          justify-content: center;
        }
        .retry-button, .reset-button, .mock-button {
          padding: 8px 16px;
          border-radius: 20px;
          cursor: pointer;
          font-weight: 500;
          border: none;
          transition: background-color 0.2s;
          display: flex;
          align-items: center;
          gap: 6px;
        }
        .retry-button {
          background-color: var(--primary);
          color: white;
        }
        .retry-button:hover {
          background-color: var(--primary-dark);
        }
        .reset-button {
          background-color: var(--danger);
          color: white;
        }
        .reset-button:hover {
          background-color: var(--danger-dark);
        }
        .mock-button {
          background-color: var(--warning);
          color: var(--dark);
        }
        .mock-button:hover {
          background-color: var(--warning-dark);
        }
        .mt-2 {
          margin-top: 8px;
        }
        .start-chat-btn {
          margin-top: 16px;
          padding: 8px 16px;
          background-color: var(--primary);
          color: white;
          border: none;
          border-radius: 20px;
          cursor: pointer;
        }

        /* Loading spinner animation */
        .fa-spin {
          animation: fa-spin 2s infinite linear;
        }
        @keyframes fa-spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(359deg); }
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
          .messages-main-content {
            position: relative;
            overflow: hidden;
          }
          .conversations-panel-wrapper, .chat-panel-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.3s ease-in-out;
            backface-visibility: hidden;
            background-color: var(--bg-color);
          }
          .conversations-panel-wrapper {
            transform: translateX(0);
            z-index: 2;
          }
          .conversations-panel-wrapper.mobile-hidden {
            transform: translateX(-100%);
            pointer-events: none;
          }
          .chat-panel-wrapper {
            transform: translateX(100%);
            z-index: 1;
          }
          .chat-panel-wrapper:not(.mobile-hidden) {
            transform: translateX(0);
            z-index: 3;
          }
          /* Add mobile back button style */
          :global(.embedded-chat .mobile-back-button) {
            display: flex !important;
            align-items: center;
            justify-content: center;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.15);
            border: none;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            z-index: 10;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            backdrop-filter: blur(5px);
          }
          :global(.embedded-chat .mobile-back-button:hover) {
            background: rgba(255, 255, 255, 0.25);
          }
          /* Adjust header padding for back button */
          .chat-panel-wrapper > :global(.embedded-chat .chat-header) {
            padding-left: 60px;
            position: relative;
          }
        }

        /* Dark mode adjustments */
        .dark .conversations-panel-wrapper {
          background-color: var(--medium);
          border-color: var(--border-dark);
        }
        .dark .chat-panel-wrapper {
          background-color: var(--dark);
        }
        .dark .search-input {
          background-color: var(--dark);
          border-color: var(--border-dark);
          color: var(--text-dark);
        }
        .dark .conversation-item:hover {
          background-color: rgba(255, 255, 255, 0.05);
        }
        .dark .conversation-item.selected {
          background-color: rgba(var(--primary-rgb), 0.15);
        }
        .dark .conversation-menu {
          background-color: var(--dark);
          border-color: var(--border-dark);
        }
        .dark .conversation-menu button {
          color: var(--text-medium);
        }
        .dark .conversation-menu button:hover {
          background-color: rgba(255, 255, 255, 0.05);
        }
        .dark .conversation-menu button.delete-btn {
          color: var(--danger);
        }
        .dark .conversation-menu button.delete-btn:hover {
          background-color: var(--danger-light);
        }
        .dark .no-chat-selected {
          background-color: var(--dark);
          color: var(--text-light);
        }
        .dark .select-arrow-icon {
          color: var(--border-dark);
        }
        /* Ensure EmbeddedChat in dark mode inherits background */
        .dark .chat-panel-wrapper > :global(.embedded-chat) {
          background-color: inherit;
        }
      `})]})},aS=()=>{var j;const{user:s,getCurrentUser:t}=Ot(),r=mn(),[i,c]=y.useState("monthly"),[u,f]=y.useState(!1),[m,v]=y.useState(null);y.useEffect(()=>{s?x():r("/login")},[s,r]);const x=async()=>{try{const C=await bf.getSubscriptionStatus();C.success&&v(C.data)}catch(C){console.error("Error fetching subscription status:",C),X.error("Could not load subscription information")}},A=(s==null?void 0:s.isPaid)||(s==null?void 0:s.accountTier)==="PAID"||(s==null?void 0:s.accountTier)==="FEMALE"||(s==null?void 0:s.accountTier)==="COUPLE"||m&&(m.isPaid||m.accountTier==="PAID"||m.accountTier==="FEMALE"||m.accountTier==="COUPLE"),S=async C=>{f(!0);try{(await bf.upgradeSubscription(C)).success&&(await t(),X.success(`Successfully subscribed to ${C} plan!`),r("/dashboard"))}catch(M){console.error("Subscription error:",M),X.error(M.message||"Failed to process subscription. Please try again.")}finally{f(!1)}};return o.jsxs("div",{className:"modern-dashboard",children:[o.jsx("header",{className:"modern-header",children:o.jsxs("div",{className:"container d-flex justify-content-between align-items-center",children:[o.jsx("div",{className:"logo",style:{cursor:"pointer"},onClick:()=>r("/dashboard"),children:"Mandarin"}),o.jsxs("div",{className:"d-none d-md-flex main-tabs",children:[o.jsx("button",{className:"tab-button",onClick:()=>r("/dashboard"),children:"Dashboard"}),o.jsx("button",{className:"tab-button",onClick:()=>r("/messages"),children:"Messages"})]}),o.jsxs("div",{className:"header-actions d-flex align-items-center",children:[o.jsx(vo,{}),(j=s==null?void 0:s.photos)!=null&&j[0]?o.jsx("img",{src:s.photos[0].url||"/placeholder.svg",alt:s.nickname,className:"user-avatar",onClick:()=>r("/profile")}):o.jsx(Gi,{className:"user-avatar",style:{fontSize:"32px"},onClick:()=>r("/profile")})]})]})}),o.jsx("main",{className:"dashboard-content",children:o.jsx("div",{className:"container",children:o.jsxs("div",{className:"subscription-page",children:[o.jsxs("h1",{className:"text-center mb-4",children:[o.jsx(M0,{className:"me-2",style:{color:"var(--primary)"}}),"Premium Membership"]}),A?o.jsx("div",{className:"already-premium",children:o.jsxs("div",{className:"alert alert-success text-center",children:[o.jsx("h3",{children:"You already have premium access!"}),o.jsx("p",{children:"Enjoy all the premium features of Mandarin."}),o.jsx("button",{className:"btn btn-primary mt-3",onClick:()=>r("/dashboard"),children:"Return to Dashboard"})]})}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"subscription-intro text-center mb-5",children:[o.jsx("h2",{children:"Unlock All Features"}),o.jsx("p",{className:"lead",children:"Upgrade your experience and connect with more people"})]}),o.jsx("div",{className:"plan-toggle mb-5",children:o.jsx("div",{className:"d-flex justify-content-center",children:o.jsxs("div",{className:"toggle-container",children:[o.jsx("button",{className:`toggle-btn ${i==="monthly"?"active":""}`,onClick:()=>c("monthly"),children:"Monthly"}),o.jsxs("button",{className:`toggle-btn ${i==="yearly"?"active":""}`,onClick:()=>c("yearly"),children:["Yearly ",o.jsx("span",{className:"save-badge",children:"Save 20%"})]})]})})}),o.jsx("div",{className:"pricing-cards",children:o.jsxs("div",{className:"row justify-content-center",children:[o.jsx("div",{className:"col-md-6 col-lg-4 mb-4",children:o.jsxs("div",{className:"pricing-card free",children:[o.jsxs("div",{className:"card-header",children:[o.jsx("h3",{children:"Free"}),o.jsx("p",{className:"price",children:"$0"}),o.jsx("p",{className:"period",children:"forever"})]}),o.jsxs("div",{className:"card-body",children:[o.jsxs("ul",{className:"feature-list",children:[o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," View profiles"]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," Send winks"]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," 3 likes per day"]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," 1 story every 72 hours"]}),o.jsxs("li",{children:[o.jsx(xn,{className:"icon-no"})," Send messages"]}),o.jsxs("li",{children:[o.jsx(xn,{className:"icon-no"})," Unlimited likes"]}),o.jsxs("li",{children:[o.jsx(xn,{className:"icon-no"})," Unlimited stories"]})]}),o.jsx("button",{className:"btn btn-outline w-100",disabled:!0,children:"Current Plan"})]})]})}),o.jsx("div",{className:"col-md-6 col-lg-4 mb-4",children:o.jsxs("div",{className:"pricing-card premium",children:[o.jsx("div",{className:"popular-badge",children:"Most Popular"}),o.jsxs("div",{className:"card-header",children:[o.jsx("h3",{children:"Premium"}),o.jsxs("p",{className:"price",children:["$",i==="monthly"?"14.99":"11.99"]}),o.jsxs("p",{className:"period",children:["per ",i==="monthly"?"month":"month, billed yearly"]})]}),o.jsxs("div",{className:"card-body",children:[o.jsxs("ul",{className:"feature-list",children:[o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," View profiles"]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," Send winks"]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," ",o.jsx("strong",{children:"Unlimited likes"})," ",o.jsx(Xs,{className:"feature-icon"})]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," ",o.jsx("strong",{children:"Unlimited stories"})," ",o.jsx(Ao,{className:"feature-icon"})]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," ",o.jsx("strong",{children:"Send messages"})," ",o.jsx(ea,{className:"feature-icon"})]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," Video calls"]}),o.jsxs("li",{children:[o.jsx(pt,{className:"icon-yes"})," Priority in search results"]})]}),o.jsx("button",{className:"btn btn-primary w-100",onClick:()=>S(i),disabled:u,children:u?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"spinner spinner-dark"}),o.jsx("span",{style:{marginLeft:"8px"},children:"Processing..."})]}):`Subscribe ${i==="monthly"?"$14.99/month":"$143.88/year"}`})]})]})})]})})]})]})})}),o.jsx("style",{children:`
        .subscription-page {
          padding: 40px 0;
        }
        
        .pricing-cards {
          margin-top: 30px;
        }
        
        .pricing-card {
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 5px 15px rgba(0,0,0,0.1);
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          height: 100%;
          display: flex;
          flex-direction: column;
          position: relative;
        }
        
        .pricing-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .pricing-card.premium {
          border: 2px solid var(--primary);
        }
        
        .popular-badge {
          position: absolute;
          top: 10px;
          right: 10px;
          background: var(--primary);
          color: white;
          padding: 5px 10px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: bold;
        }
        
        .card-header {
          background: var(--bg-card);
          padding: 25px 20px;
          text-align: center;
          border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .card-header h3 {
          margin-bottom: 15px;
          font-weight: bold;
        }
        
        .price {
          font-size: 36px;
          font-weight: bold;
          margin-bottom: 0;
          color: var(--primary);
        }
        
        .period {
          opacity: 0.7;
          font-size: 14px;
        }
        
        .card-body {
          padding: 25px 20px;
          flex-grow: 1;
          display: flex;
          flex-direction: column;
        }
        
        .feature-list {
          list-style: none;
          padding: 0;
          margin-bottom: 25px;
          flex-grow: 1;
        }
        
        .feature-list li {
          padding: 10px 0;
          display: flex;
          align-items: center;
        }
        
        .icon-yes {
          color: var(--success);
          margin-right: 10px;
        }
        
        .icon-no {
          color: var(--danger);
          margin-right: 10px;
        }
        
        .feature-icon {
          margin-left: 5px;
          color: var(--primary);
        }
        
        .toggle-container {
          display: inline-flex;
          background: var(--bg-card);
          border-radius: 30px;
          padding: 5px;
          margin-bottom: 30px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .toggle-btn {
          padding: 10px 20px;
          border: none;
          background: none;
          border-radius: 25px;
          cursor: pointer;
          position: relative;
          transition: all 0.3s ease;
        }
        
        .toggle-btn.active {
          background: var(--primary);
          color: white;
        }
        
        .save-badge {
          position: absolute;
          top: -10px;
          right: -10px;
          background: var(--success);
          color: white;
          font-size: 10px;
          padding: 2px 6px;
          border-radius: 10px;
        }
        
        .already-premium {
          max-width: 600px;
          margin: 0 auto;
        }
        `})]})};function oS(){return G0(),o.jsx(Hf,{children:o.jsx(Y4,{children:o.jsx(o2,{children:o.jsx(V4,{children:o.jsx(K4,{children:o.jsx(o4,{children:o.jsx(A4,{children:o.jsx(X4,{children:o.jsxs("div",{className:"app-wrapper",children:[o.jsxs(sb,{children:[o.jsx(as,{path:"/",element:o.jsx(y6,{})}),o.jsx(as,{path:"/login",element:o.jsx(Z4,{})}),o.jsx(as,{path:"/register",element:o.jsx(J4,{})}),o.jsx(as,{path:"/dashboard",element:o.jsx(Vr,{children:o.jsx(d6,{})})}),o.jsx(as,{path:"/user/:id",element:o.jsx(Vr,{children:o.jsx(m6,{})})}),o.jsx(as,{path:"/profile",element:o.jsx(Vr,{children:o.jsx(p6,{})})}),o.jsx(as,{path:"/messages",element:o.jsx(Vr,{children:o.jsx(RA,{})})}),o.jsx(as,{path:"/messages/:userId",element:o.jsx(Vr,{children:o.jsx(RA,{})})}),o.jsx(as,{path:"/settings",element:o.jsx(Vr,{children:o.jsx(g6,{})})}),o.jsx(as,{path:"/subscription",element:o.jsx(Vr,{children:o.jsx(aS,{})})}),o.jsx(as,{path:"*",element:o.jsx(A6,{})})]}),o.jsx(ib,{position:"top-right",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,limit:5,theme:"colored"})]})})})})})})})})})}typeof globalThis>"u"&&(window.global=window);mb.createRoot(document.getElementById("root")).render(o.jsxs(Gr.StrictMode,{children:[o.jsxs(rb,{children:[" ",o.jsxs(Hf,{children:[" ",o.jsx(oS,{})]})]})," "]}));
//# sourceMappingURL=index-C_5GtECM.js.map
