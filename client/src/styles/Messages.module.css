/* Messages.module.css */
/* Assumes variables like --primary, --secondary, --text-dark, --bg-light, --border-color, etc., */
/* and utility classes/variables like --shadow-sm, --border-radius-lg are defined in a global scope (e.g., base.css) */
@import "base.css"; /* Make sure this path is correct or variables are globally available */

/* ====== Root & Layout ====== */
.appWrapper {
  position: relative;
  height: 100vh;
  width: 100%;
  overflow: hidden;
  background-color: var(--bg-light);
  display: flex;
  flex-direction: column;
}

.messagesContainer {
  display: flex;
  flex: 1; /* Takes remaining height after Navbar */
  width: 100%;
  overflow: hidden;
  position: relative; /* Needed for absolute positioning of mobile sidebar */
}

/* ====== Sidebar ====== */
.sidebar {
  width: 320px;
  background-color: var(--white);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  position: relative;
  z-index: 10;
  box-shadow: var(--shadow-md);
  flex-shrink: 0; /* Prevent shrinking */
}

/* Sidebar visibility on Mobile */
@media (max-width: 768px) {
  .sidebar {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0; /* Stretch to full height */
    height: 100%;
    z-index: 100; /* Ensure it's above chat area */
    transform: translateX(-100%); /* Hidden by default */
    border-right: none; /* No border needed when overlaying */
  }
  .sidebar.show {
    transform: translateX(0);
  }
  .sidebar.hide {
     transform: translateX(-100%);
  }
}

.sidebarHeader {
  padding: 1rem 1.5rem; /* Use rem for spacing */
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--white);
  flex-shrink: 0;
}

.sidebarHeader h2 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-dark);
  /* Optional: Modern gradient text */
  background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
}

.sidebarHeader .backButton { /* Specific style for sidebar back button */
  display: none; /* Hidden by default */
}

@media (max-width: 768px) {
  .sidebarHeader .backButton {
    display: flex; /* Show only on mobile */
  }
}

/* Conversations List */
.conversationsList {
  flex: 1; /* Takes available space */
  overflow-y: auto;
  padding: 0;
  scrollbar-width: thin;
  scrollbar-color: var(--neutral-300) transparent;
}

.conversationsList::-webkit-scrollbar {
  width: 6px;
}

.conversationsList::-webkit-scrollbar-track {
  background: transparent;
}

.conversationsList::-webkit-scrollbar-thumb {
  background-color: var(--neutral-300);
  border-radius: var(--border-radius-full);
}

.noConversations {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-light);
  padding: 1.5rem;
  text-align: center;
  gap: 1rem;
}

.noConversations svg {
  color: var(--primary-300);
  opacity: 0.7;
  margin-bottom: 0.75rem;
}

/* Conversation Item */
.conversationItem {
  display: flex;
  align-items: center;
  padding: 0.875rem 1.25rem; /* 14px 20px */
  border-bottom: 1px solid var(--neutral-100);
  cursor: pointer;
  transition: background-color 0.2s ease-out, border-left-color 0.2s ease-out;
  position: relative;
  border-left: 3px solid transparent; /* Placeholder for active state */
}

[dir="rtl"] .conversationItem {
  border-left: none;
  border-right: 3px solid transparent;
}

.conversationItem:hover {
  background-color: var(--primary-50);
}

.conversationItem.active {
  background-color: var(--primary-100); /* Use a solid color for active */
  border-left-color: var(--primary);
}

[dir="rtl"] .conversationItem.active {
  border-left-color: transparent;
  border-right-color: var(--primary);
}

.conversationItem.unread .conversationInfo .conversationName span:first-child {
  font-weight: 700; /* Make name bold if unread */
}
.conversationItem.unread .conversationInfo .conversationPreview {
  color: var(--text-dark); /* Make preview text darker */
  font-weight: 500;
}

.avatarContainer {
  position: relative;
  margin-right: 0.875rem; /* 14px */
  flex-shrink: 0;
}

[dir="rtl"] .avatarContainer {
  margin-right: 0;
  margin-left: 0.875rem;
}

.statusIndicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  position: absolute;
  bottom: 1px; /* Adjust for better positioning */
  right: 1px;
  border: 2px solid var(--white);
}

.statusIndicator.online {
  background-color: var(--success);
}

.conversationInfo {
  flex: 1;
  min-width: 0; /* Important for text truncation */
  display: flex;
  flex-direction: column;
  gap: 0.125rem; /* Small gap between name and preview */
}

.conversationName {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.conversationName span:first-child { /* Target only the name span */
  font-weight: 600;
  color: var(--text-dark);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  /* max-width: 180px; Removed fixed max-width, rely on flexbox */
}

.unreadBadge {
  background-color: var(--primary);
  color: white;
  border-radius: var(--border-radius-full);
  min-width: 20px; /* Ensure circle for single digit */
  height: 20px;
  padding: 0 0.375rem; /* 6px */
  display: inline-flex; /* Use inline-flex */
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: 700;
  margin-left: 0.5rem; /* Space from name */
}

[dir="rtl"] .unreadBadge {
  margin-left: 0;
  margin-right: 0.5rem;
}

.conversationPreview {
  font-size: 0.875rem;
  color: var(--text-light);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  /* max-width: 220px; Removed fixed max-width */
}

.conversationTime {
  font-size: 0.75rem;
  color: var(--text-subtle);
  white-space: nowrap;
  margin-left: 0.5rem; /* 8px */
  align-self: flex-start; /* Align to top */
  padding-top: 0.125rem; /* Align slightly better with name */
}

[dir="rtl"] .conversationTime {
  margin-left: 0;
  margin-right: 0.5rem;
}

/* ====== Chat Area ====== */
.chatArea {
  flex: 1;
  display: flex;
  flex-direction: column;
  background-color: var(--bg-light);
  position: relative;
  overflow: hidden; /* Prevents potential overflow issues */
  transition: width 0.3s ease-in-out; /* If width changes */
}

.chatArea.fullWidth {
  /* On mobile when sidebar is hidden, this class might be added */
  /* No specific style needed if layout is handled by sidebar visibility */
}

.chatHeader {
  padding: 0.75rem 1.25rem; /* 12px 20px */
  background-color: var(--white);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 5;
  box-shadow: var(--shadow-sm); /* Subtle shadow */
  flex-shrink: 0;
}

.chatUser {
  display: flex;
  align-items: center;
  flex: 1; /* Take available space */
  min-width: 0; /* For ellipsis on user details */
  gap: 0.75rem; /* Gap between elements */
}

.backButton {
  background: none;
  border: none;
  color: var(--text-medium);
  font-size: 1.5rem; /* Slightly larger */
  cursor: pointer;
  width: 36px;
  height: 36px;
  border-radius: var(--border-radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease-out, color 0.2s ease-out;
}

[dir="rtl"] .backButton {
  transform: scaleX(-1); /* Flip the back button icon */
}

.backButton:hover {
  background-color: var(--neutral-100);
  color: var(--primary);
}

.chatUserDetails {
  /* No margin needed if using gap in .chatUser */
  overflow: hidden; /* For ellipsis */
  display: flex;
  flex-direction: column;
}

.chatUserDetails h3 {
  margin: 0;
  font-size: 1.0rem; /* Slightly smaller H3 */
  font-weight: 600;
  color: var(--text-dark);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.statusText {
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 4px;
}

.statusText.online {
  color: var(--success);
}

.statusText.offline {
  color: var(--text-light);
}

.statusText.online::before {
  content: '';
  display: inline-block;
  width: 7px; /* Slightly larger dot */
  height: 7px;
  border-radius: 50%;
  background-color: var(--success);
  /* margin-right: 4px; - replaced by gap */
}

.chatActions {
  /* margin-left: auto; - Handled by flex: 1 on .chatUser */
  display: flex;
  align-items: center; /* Vertically align buttons */
  gap: 0.5rem; /* 8px */
}

.actionButton {
  background: none;
  border: none;
  color: var(--text-medium);
  width: 38px;
  height: 38px;
  border-radius: var(--border-radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease-out, color 0.2s ease-out;
}

.actionButton:hover {
  background-color: var(--primary-50);
  color: var(--primary);
}

.actionButton:disabled {
  opacity: 0.5; /* More pronounced disabled state */
  cursor: not-allowed;
  background-color: transparent; /* Ensure no hover effect */
  color: var(--text-light);
}

.actionButton svg {
  font-size: 1.125rem; /* Adjust icon size if needed */
}

/* Premium/Call Banners */
.premiumBanner,
.incomingCallBanner,
.activeCallBanner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1.25rem; /* 12px 20px */
  font-size: 0.875rem;
  border-bottom: 1px solid var(--border-color);
  flex-shrink: 0;
  gap: 1rem; /* Space between text and buttons */
}

.premiumBanner {
  background: linear-gradient(to right, var(--warning-light, #fffbeb), var(--warning-lighter, #fff0e0)); /* Softer gradient */
  border-color: var(--warning-border, #fde68a);
}

.premiumBanner div:first-child { /* Target text container */
   display: flex;
   align-items: center;
   gap: 0.5rem;
   color: var(--warning-dark, #92400e);
}

.premiumIcon {
  color: var(--warning, #f59e0b);
  font-size: 1rem; /* Matched icon size */
}

.upgradeBtn {
  background: var(--warning, #f59e0b);
  border: none;
  border-radius: var(--border-radius-md); /* Consistent radius */
  color: var(--white);
  font-weight: 600;
  padding: 0.375rem 0.75rem; /* 6px 12px */
  cursor: pointer;
  transition: background-color 0.2s ease-out, transform 0.1s ease-out;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: var(--shadow-xs);
}

.upgradeBtn:hover {
  background: var(--warning-dark, #d97706);
  transform: translateY(-1px);
}

.incomingCallBanner {
  background: linear-gradient(to right, var(--info-light, #e0f2fe), var(--info-lighter, #e0f7fa));
  border-color: var(--info-border, #bae6fd);
  animation: pulseBg 2s infinite ease-in-out;
}

.incomingCallInfo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
  color: var(--info-dark, #075985);
}

.callIcon {
  color: var(--info, #3b82f6);
}

.incomingCallActions {
  display: flex;
  gap: 0.5rem; /* 8px */
}

.acceptCallBtn,
.declineCallBtn {
  border: none;
  border-radius: var(--border-radius-md);
  color: white;
  font-weight: 600;
  padding: 0.375rem 0.75rem; /* 6px 12px */
  cursor: pointer;
  transition: background-color 0.2s ease-out, transform 0.1s ease-out;
  font-size: 0.875rem;
  display: inline-flex; /* Align icon and text */
  align-items: center;
  gap: 0.375rem; /* Gap in button */
  box-shadow: var(--shadow-xs);
}

.acceptCallBtn {
  background-color: var(--success);
}
.acceptCallBtn:hover {
  background-color: var(--success-dark, #047857);
  transform: translateY(-1px);
}

.declineCallBtn {
  background-color: var(--danger);
}
.declineCallBtn:hover {
  background-color: var(--danger-dark, #b91c1c);
  transform: translateY(-1px);
}

.activeCallBanner {
   background: var(--neutral-100);
   border-color: var(--neutral-200);
}
.activeCallBanner div:first-child {
   display: flex;
   align-items: center;
   gap: 0.5rem;
   color: var(--text-medium);
}
.activeCallBanner .callIcon {
   color: var(--primary);
}
.endCallBtn {
   /* Reuse decline button style but maybe different color/icon */
   composes: declineCallBtn; /* Or define separately */
   background-color: var(--danger);
}
.endCallBtn:hover {
   background-color: var(--danger-dark);
}


/* Messages Area */
.messagesArea {
  flex: 1; /* Takes available space */
  overflow-y: auto;
  padding: 1.5rem; /* 24px */
  display: flex;
  flex-direction: column;
  gap: 0.25rem; /* Small gap between bubbles */
  background-color: var(--bg-light);
  /* Subtle background pattern */
  background-image: radial-gradient(var(--neutral-200) 0.5px, transparent 0.5px);
  background-size: 15px 15px;
  scrollbar-width: thin;
  scrollbar-color: var(--neutral-300) transparent;
}

.messagesArea::-webkit-scrollbar {
  width: 6px;
}
.messagesArea::-webkit-scrollbar-track {
  background: transparent;
}
.messagesArea::-webkit-scrollbar-thumb {
  background-color: var(--neutral-300);
  border-radius: var(--border-radius-full);
}

.messagesLoading, .noMessages {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1; /* Take full height */
  color: var(--text-light);
  text-align: center;
}

.noMessagesContent {
  background: rgba(255, 255, 255, 0.95); /* Slightly less transparent */
  backdrop-filter: blur(5px);
  padding: 2rem; /* 32px */
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-lg); /* More pronounced shadow */
  max-width: 350px;
  animation: fadeInScale 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.noMessagesContent svg {
  color: var(--primary-300);
  margin-bottom: 1rem; /* 16px */
}

.noMessagesContent p {
  margin-bottom: 0.5rem; /* 8px */
}

.noMessagesContent .hint {
  color: var(--text-subtle);
  font-size: 0.875rem;
}

.errorContent { /* Style for error messages/containers */
  background-color: var(--danger-light, #fee2e2);
  color: var(--danger-dark, #991b1b);
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius-md);
  border: 1px solid var(--danger-border, #fecaca);
}
.errorContent p {
  margin: 0;
}
.errorContent button {
  margin-top: 0.75rem;
}

/* Message Grouping & Bubbles */
.messageGroup {
  display: flex;
  flex-direction: column;
  gap: 0.75rem; /* 12px - Gap between messages in the same group */
  margin-bottom: 1rem; /* Space between groups/date separators */
}

.dateSeparator {
  text-align: center;
  margin: 1rem 0; /* Reduced margin */
  position: relative;
  color: var(--text-light);
  font-size: 0.75rem;
  display: flex; /* Use flex for centering line */
  align-items: center;
  gap: 0.75rem;
}

.dateSeparator::before, .dateSeparator::after {
  content: '';
  flex-grow: 1; /* Lines take available space */
  height: 1px;
  background-color: var(--border-color);
}

.dateSeparator span {
  background-color: var(--white); /* Match bubble bg */
  padding: 0.25rem 0.75rem; /* 4px 12px */
  position: relative;
  z-index: 1;
  border-radius: var(--border-radius-full);
  font-weight: 500;
  color: var(--text-medium);
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow-xs);
}

.messageBubble {
  max-width: 70%;
  padding: 0.75rem 1rem; /* 12px 16px */
  border-radius: var(--border-radius-lg); /* Softer radius */
  position: relative;
  word-wrap: break-word; /* Ensure long words wrap */
  font-size: 0.9375rem; /* 15px, slightly larger default text */
  line-height: 1.5;
  box-shadow: var(--shadow-sm);
  transition: transform 0.2s ease-out; /* Slight hover effect */
  /* animation: slideIn 0.3s ease-out; */ /* Can be distracting */
}

/* Add slight hover scale */
/* .messageBubble:hover {
  transform: scale(1.01);
} */

.messageBubble.sent {
  align-self: flex-end;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: var(--white);
  border-bottom-right-radius: var(--border-radius-sm); /* Tail effect */
}

[dir="rtl"] .messageBubble.sent {
  align-self: flex-start; /* Adjust alignment for RTL */
  border-bottom-right-radius: var(--border-radius-lg);
  border-bottom-left-radius: var(--border-radius-sm);
}

.messageBubble.received {
  align-self: flex-start;
  background-color: var(--white);
  color: var(--text-dark);
  border-bottom-left-radius: var(--border-radius-sm); /* Tail effect */
}

[dir="rtl"] .messageBubble.received {
  align-self: flex-end; /* Adjust alignment for RTL */
  border-bottom-left-radius: var(--border-radius-lg);
  border-bottom-right-radius: var(--border-radius-sm);
}

.messageContent {
  word-break: break-word; /* Ensure content breaks correctly */
}

.messageMeta {
  font-size: 0.75rem; /* 12px */
  margin-top: 0.375rem; /* 6px */
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.25rem; /* 4px */
  opacity: 0.9;
}

.messageBubble.sent .messageMeta {
  color: rgba(255, 255, 255, 0.85); /* Slightly less bright */
}

.messageBubble.received .messageMeta {
  color: var(--text-subtle);
}

.messageTime {
  /* font-size is inherited from .messageMeta */
}

.statusIndicator { /* For read receipts */
  display: inline-flex; /* Use flex for centering */
  align-items: center;
  margin-left: 0.25rem; /* 4px */
}
.statusIndicator svg {
  font-size: 0.875rem; /* Adjust size if needed */
}

/* System Messages */
.systemMessage {
  align-self: center; /* Center system message */
  background-color: transparent; /* No bubble background */
  box-shadow: none;
  padding: 0;
  max-width: 90%; /* Allow wider system messages */
  margin: 0.5rem 0; /* Add vertical space */
}

.systemMessageContent {
  background-color: var(--neutral-100);
  border-radius: var(--border-radius-md);
  padding: 0.5rem 0.75rem; /* 8px 12px */
  font-size: 0.8125rem; /* 13px */
  text-align: center;
  color: var(--text-medium);
  display: inline-block; /* Fit content width */
}

.systemMessageContent.errorContent { /* Specific error styling */
   background-color: var(--danger-light, #fee2e2);
   color: var(--danger-dark, #991b1b);
   border: 1px solid var(--danger-border, #fecaca);
}
.systemMessageContent .messageTime { /* Style time inside system message */
  display: block; /* Put time on new line */
  font-size: 0.6875rem; /* 11px */
  margin-top: 0.25rem;
  color: var(--text-subtle);
}

/* Wink Messages */
.winkMessage {
  max-width: 80px; /* Smaller max-width */
  padding: 0.5rem; /* Smaller padding */
}

.winkContent {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem; /* Gap between emoji and label */
}
.winkContent .messageContent {
  font-size: 1.75rem; /* Larger emoji */
  line-height: 1;
}
.messageLabel { /* Wink label */
  font-size: 0.6875rem; /* 11px */
  color: inherit; /* Inherit bubble color */
  opacity: 0.7;
}
.winkContent .messageTime { /* Position time below label */
   font-size: 0.6875rem; /* 11px */
   opacity: 0.7;
}

/* File Attachment Preview (in input area) */
.attachmentPreview {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--neutral-50);
  border-top: 1px solid var(--neutral-200);
  padding: 0.625rem 1rem; /* 10px 16px */
  gap: 1rem;
}

.attachmentInfo {
  display: flex;
  align-items: center;
  gap: 0.5rem; /* 8px */
  min-width: 0; /* For ellipsis */
}

.attachmentInfo svg { /* Generic file icon */
  color: var(--primary);
  font-size: 1.25rem;
  flex-shrink: 0;
}

.attachmentName {
  font-weight: 500;
  color: var(--text-dark);
  font-size: 0.875rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.attachmentSize {
  color: var(--text-light);
  font-size: 0.8125rem; /* 13px */
  white-space: nowrap; /* Prevent size wrapping */
  flex-shrink: 0;
}

.removeAttachment {
  background: none;
  border: none;
  color: var(--danger);
  cursor: pointer;
  font-size: 1.125rem; /* Larger icon */
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--border-radius-full);
  transition: background-color 0.2s ease-out;
  flex-shrink: 0;
}

.removeAttachment:hover {
  background-color: var(--danger-light, #fee2e2);
}

.removeAttachment:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.uploadProgressContainer {
  /* Assuming this shows instead of remove button during upload */
  height: 8px; /* Slightly thicker bar */
  background-color: var(--neutral-200);
  border-radius: var(--border-radius-full);
  overflow: hidden;
  position: relative;
  width: 100px; /* Fixed width or flex grow */
  flex-shrink: 0;
  display: flex;
  align-items: center;
}

.uploadProgressBar {
  height: 100%;
  background: linear-gradient(to right, var(--primary), var(--secondary));
  transition: width 0.3s ease-out;
  border-radius: var(--border-radius-full);
}

.uploadProgressText {
  font-size: 0.75rem; /* 12px */
  color: var(--text-medium);
  position: absolute; /* Overlay on bar or place next to it */
  left: 50%;
  transform: translateX(-50%);
  mix-blend-mode: difference; /* Try to make text visible */
  color: white; /* Fallback color */
  display: none; /* Hide percentage text for simplicity */
}

/* File Messages (within bubble) */
.fileMessage {
  display: flex;
  flex-direction: column;
  gap: 0.5rem; /* Space between elements */
}

.imageAttachment {
  max-width: 100%;
  max-height: 250px; /* Limit image height */
  object-fit: cover; /* Prevent distortion */
  border-radius: var(--border-radius-md); /* Match bubble inner radius */
  cursor: pointer; /* Indicate clickable image */
  transition: filter 0.2s ease-out;
}
.imageAttachment:hover {
  filter: brightness(1.1);
}

.fileAttachment { /* For non-image files */
  display: flex;
  align-items: center; /* Align icon and text */
  gap: 0.75rem; /* Space between icon and info */
  background-color: rgba(0, 0, 0, 0.04); /* Subtle background */
  border-radius: var(--border-radius-md);
  padding: 0.75rem; /* 12px */
}

.fileAttachment svg { /* Icon within file bubble */
  font-size: 1.75rem; /* Larger icon */
  color: var(--primary);
  flex-shrink: 0;
}

.fileInfo { /* Container for name/size/link */
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  min-width: 0; /* For ellipsis on name */
}

.fileName {
  font-weight: 500;
  font-size: 0.875rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.fileSize {
  font-size: 0.75rem; /* 12px */
  color: var(--text-subtle); /* Subtle color */
}

.downloadLink {
  color: var(--info);
  text-decoration: none;
  font-size: 0.8125rem; /* 13px */
  font-weight: 500;
  margin-top: 0.25rem; /* Space above download */
  transition: color 0.2s ease-out;
}

.downloadLink:hover {
  color: var(--info-dark, #1d4ed8);
  text-decoration: underline;
}

/* Typing Indicator */
.typingIndicator {
  align-self: flex-start; /* Keep it left-aligned */
  background-color: var(--white);
  padding: 0.625rem 1rem; /* 10px 16px */
  border-radius: var(--border-radius-lg);
  border-bottom-left-radius: var(--border-radius-sm); /* Match received bubble */
  display: flex;
  align-items: center;
  gap: 5px; /* Space between dots */
  margin-top: 0.25rem; /* Space above */
  box-shadow: var(--shadow-sm);
}

[dir="rtl"] .typingIndicator {
   align-self: flex-end;
   border-bottom-left-radius: var(--border-radius-lg);
   border-bottom-right-radius: var(--border-radius-sm);
}

.typingIndicator .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: var(--neutral-300); /* Start color */
  animation: typingAnimation 1.4s infinite ease-in-out;
}

.typingIndicator .dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typingIndicator .dot:nth-child(3) {
  animation-delay: 0.4s;
}

/* Emoji Picker */
.emojiPicker {
  position: absolute;
  bottom: calc(100% + 0.5rem); /* Position above input area */
  left: 1rem; /* Align with input area padding */
  background-color: var(--white);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-lg);
  width: 300px; /* Slightly wider */
  z-index: 100;
  border: 1px solid var(--border-color);
  overflow: hidden;
  animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Pop animation */
}

[dir="rtl"] .emojiPicker {
  left: auto;
  right: 1rem;
}

.emojiHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem; /* 12px 16px */
  border-bottom: 1px solid var(--neutral-200);
  background-color: var(--neutral-50);
}

.emojiHeader h4 {
  margin: 0;
  font-size: 0.9375rem; /* 15px */
  color: var(--text-dark);
  font-weight: 600;
}

.emojiHeader button { /* Close button */
  background: none;
  border: none;
  color: var(--text-medium);
  cursor: pointer;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background-color 0.2s ease-out, color 0.2s ease-out;
}

.emojiHeader button:hover {
  background-color: var(--neutral-100);
  color: var(--primary);
}

.emojiList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(36px, 1fr)); /* Responsive grid */
  gap: 0.5rem; /* 8px */
  padding: 1rem; /* 16px */
  max-height: 200px; /* Limit height */
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--neutral-300) var(--neutral-100);
}
.emojiList::-webkit-scrollbar { width: 5px; }
.emojiList::-webkit-scrollbar-track { background: var(--neutral-100); }
.emojiList::-webkit-scrollbar-thumb { background-color: var(--neutral-300); border-radius: var(--border-radius-full); }


.emojiList button {
  background: none;
  border: none;
  font-size: 1.5rem; /* Emoji size */
  cursor: pointer;
  padding: 0; /* Remove padding, rely on dimensions */
  border-radius: var(--border-radius-md); /* Rounded hover */
  transition: background-color 0.15s ease-out, transform 0.15s ease-out;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px; /* Fixed size */
  height: 36px;
}

.emojiList button:hover {
  background-color: var(--primary-50);
  transform: scale(1.15); /* Pop effect */
}

/* Input Area */
.inputArea {
  padding: 1rem; /* 16px */
  background-color: var(--white);
  border-top: 1px solid var(--border-color);
  display: flex;
  align-items: flex-end; /* Align items to bottom */
  gap: 0.75rem; /* 12px */
  z-index: 5;
  position: relative; /* Needed for emoji picker positioning */
  flex-shrink: 0;
}

.messageInput {
  flex: 1; /* Take available space */
  padding: 0.875rem 1.25rem; /* 14px 20px */
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-full); /* Pill shape */
  resize: none;
  font-size: 0.9375rem; /* Match message bubble font size */
  outline: none;
  transition: border-color 0.2s ease-out, box-shadow 0.2s ease-out;
  max-height: 120px; /* Limit height */
  line-height: 1.4; /* Adjust line height */
  background-color: var(--neutral-50);
  color: var(--text-dark);
}

.messageInput::placeholder {
  color: var(--text-light);
}

.messageInput:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-focus-ring, rgba(255, 51, 119, 0.15)); /* Focus ring */
  background-color: var(--white);
}

.messageInput:disabled {
  background-color: var(--neutral-100);
  cursor: not-allowed;
  opacity: 0.7;
}

/* Input Area Buttons */
.emojiButton,
.attachButton,
.winkButton {
  background: none;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: var(--border-radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease-out, color 0.2s ease-out;
  flex-shrink: 0;
  color: var(--text-medium); /* Default color */
}

.emojiButton:hover,
.attachButton:hover {
  background-color: var(--primary-50);
  color: var(--primary);
}

.winkButton {
  color: var(--primary); /* Keep wink button primary */
}
.winkButton:hover {
  background-color: var(--primary-50);
}

.emojiButton svg,
.attachButton svg,
.winkButton svg {
  font-size: 1.25rem; /* Consistent icon size */
}

.attachButton:disabled,
.winkButton:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background-color: transparent;
  color: var(--text-light);
}

.sendButton {
  width: 46px;
  height: 46px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border: none;
  border-radius: var(--border-radius-full);
  cursor: pointer;
  transition: transform 0.15s ease-out, box-shadow 0.2s ease-out, background-color 0.2s ease-out;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-md); /* Use variable */
  flex-shrink: 0;
}
.sendButton svg {
  font-size: 1.25rem;
}

.sendButton:hover {
  transform: translateY(-2px) scale(1.05); /* More pop */
  box-shadow: var(--shadow-lg); /* Increase shadow */
}

.sendButton:active {
  transform: translateY(0) scale(1);
  box-shadow: var(--shadow-sm);
}

.sendButton.disabled {
  background: var(--neutral-300);
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
}

/* Spinner inside button */
.sendButton .fa-spin { /* Target FontAwesome spinner */
  animation: spin 1s linear infinite;
}

/* No Active Chat Placeholder */
.noActiveChat {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  background-color: var(--bg-light);
  background-image: radial-gradient(var(--neutral-200) 0.5px, transparent 0.5px);
  background-size: 15px 15px;
}

.noActiveChatContent {
  composes: noMessagesContent; /* Inherit base styles */
  /* Add any specific overrides if needed */
}

.noActiveChatContent h3 {
  margin-bottom: 0.75rem; /* 12px */
  color: var(--text-dark);
  font-weight: 700;
  font-size: 1.25rem;
  /* Optional gradient */
  background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
}

.noActiveChatContent p {
  color: var(--text-medium);
  margin-bottom: 0;
  font-size: 0.9375rem;
}

/* Loading & Error States */
.loadingContainer,
.errorContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1; /* Fill available space */
  text-align: center;
  padding: 1.5rem;
  background-color: var(--bg-light);
}

.errorContainer h3 {
  color: var(--danger);
  margin-bottom: 1rem;
  font-size: 1.125rem;
}

.errorContainer p {
   color: var(--text-medium);
   margin-bottom: 1.5rem;
}

/* Generic Button Styles (can reuse) */
.btnPrimary {
  padding: 0.75rem 1.5rem; /* 12px 24px */
  border-radius: var(--border-radius-lg);
  font-weight: 600; /* Bold */
  cursor: pointer;
  transition: transform 0.15s ease-out, box-shadow 0.2s ease-out;
  border: none;
  font-size: 0.875rem;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: var(--shadow-md);
  text-transform: uppercase;
  letter-spacing: 1px;
}
.btnPrimary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}
.btnPrimary:active {
  transform: translateY(0);
}

.btnSecondary {
  composes: btnPrimary; /* Inherit base style */
  background: var(--white);
  color: var(--primary);
  border: 1px solid var(--primary);
  box-shadow: var(--shadow-sm);
}
.btnSecondary:hover {
   background: var(--primary-50);
   box-shadow: var(--shadow-md);
   transform: translateY(-1px);
}

/* Video Call Overlay */
.videoCallOverlay {
  position: fixed;
  inset: 0; /* top, left, right, bottom = 0 */
  background-color: rgba(0, 0, 0, 0.88); /* Slightly darker */
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease-out;
}

/* ====== Animations ====== */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInScale {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes popIn {
   from { opacity: 0; transform: scale(0.9) translateY(10px); }
   to { opacity: 1; transform: scale(1) translateY(0); }
}

@keyframes pulseBg {
  0%, 100% { background-color: var(--info-light, #e0f2fe); }
  50% { background-color: var(--info-lighter, #bae6fd); } /* Use lighter pulse */
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes typingAnimation {
  0%, 60%, 100% { transform: translateY(0); background-color: var(--neutral-300); }
  30% { transform: translateY(-4px); background-color: var(--primary); }
}

/* ====== Dark Mode Adjustments ====== */
:global(.dark) .appWrapper,
:global(.dark) .messagesArea,
:global(.dark) .loadingContainer,
:global(.dark) .errorContainer,
:global(.dark) .noActiveChat {
  background-color: var(--neutral-900);
}

:global(.dark) .sidebar,
:global(.dark) .chatHeader,
:global(.dark) .inputArea,
:global(.dark) .attachmentPreview {
  background-color: var(--neutral-850); /* Slightly different shade for depth */
  border-color: var(--neutral-700);
}

:global(.dark) .sidebarHeader h2,
:global(.dark) .noActiveChatContent h3 {
  background: linear-gradient(90deg, var(--primary-300) 0%, var(--secondary-light) 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

:global(.dark) .conversationsList::-webkit-scrollbar-thumb,
:global(.dark) .messagesArea::-webkit-scrollbar-thumb {
  background-color: var(--neutral-600);
}

:global(.dark) .noConversations {
  color: var(--neutral-400);
}
:global(.dark) .noConversations svg {
  color: var(--primary-500);
}

:global(.dark) .conversationItem {
  border-bottom-color: var(--neutral-750); /* Darker border */
}
:global(.dark) .conversationItem:hover {
  background-color: var(--neutral-800);
}
:global(.dark) .conversationItem.active {
  background-color: var(--neutral-750);
  border-left-color: var(--primary-400);
}
[dir="rtl"]:global(.dark) .conversationItem.active {
   border-left-color: transparent;
   border-right-color: var(--primary-400);
}
:global(.dark) .conversationItem .avatarContainer .statusIndicator {
   border-color: var(--neutral-850); /* Match sidebar bg */
}
:global(.dark) .conversationName span:first-child {
  color: var(--neutral-100);
}
:global(.dark) .conversationPreview {
  color: var(--neutral-400);
}
:global(.dark) .conversationTime {
  color: var(--neutral-500);
}
:global(.dark) .unreadBadge {
  background-color: var(--primary-400);
  color: var(--black); /* Better contrast */
}
:global(.dark) .conversationItem.unread .conversationPreview {
  color: var(--neutral-200);
}

:global(.dark) .backButton {
  color: var(--neutral-400);
}
:global(.dark) .backButton:hover {
  background-color: var(--neutral-700);
  color: var(--primary-300);
}
:global(.dark) .chatUserDetails h3 {
  color: var(--neutral-100);
}
:global(.dark) .statusText {
  color: var(--neutral-400);
}
:global(.dark) .statusText.online {
  color: var(--success-light, #6ee7b7);
}
:global(.dark) .statusText.online::before {
   background-color: var(--success-light, #6ee7b7);
}
:global(.dark) .actionButton {
  color: var(--neutral-400);
}
:global(.dark) .actionButton:hover {
  background-color: var(--neutral-750);
  color: var(--primary-300);
}
:global(.dark) .actionButton:disabled {
   color: var(--neutral-600);
}

:global(.dark) .premiumBanner {
  background: linear-gradient(to right, var(--warning-darker, #422006), var(--warning-darkest, #2f1703));
  border-color: var(--warning-dark, #78350f);
  color: var(--warning-light, #fcd34d);
}
:global(.dark) .premiumBanner div:first-child {
   color: var(--warning-light, #fcd34d);
}
:global(.dark) .premiumIcon {
  color: var(--warning, #f59e0b);
}
:global(.dark) .upgradeBtn {
  background: var(--warning, #f59e0b);
  color: var(--neutral-900); /* Dark text on bright button */
}
:global(.dark) .upgradeBtn:hover {
  background: var(--warning-light, #fbbf24);
}

:global(.dark) .incomingCallBanner {
  background: linear-gradient(to right, var(--info-darker, #0c4a6e), var(--info-darkest, #082f49));
  border-color: var(--info-dark, #0369a1);
}
:global(.dark) .incomingCallInfo {
  color: var(--info-light, #7dd3fc);
}
:global(.dark) .callIcon {
  color: var(--info-light, #7dd3fc);
}
:global(.dark) .acceptCallBtn {
  background-color: var(--success-dark, #047857);
}
:global(.dark) .acceptCallBtn:hover {
  background-color: var(--success-darker, #065f46);
}
:global(.dark) .declineCallBtn {
  background-color: var(--danger-dark, #991b1b);
}
:global(.dark) .declineCallBtn:hover {
  background-color: var(--danger-darker, #7f1d1d);
}
:global(.dark) .activeCallBanner {
   background: var(--neutral-800);
   border-color: var(--neutral-700);
}
:global(.dark) .activeCallBanner div:first-child {
   color: var(--neutral-300);
}
:global(.dark) .activeCallBanner .callIcon {
   color: var(--primary-300);
}

:global(.dark) .messagesArea {
  background-image: radial-gradient(var(--neutral-700) 0.5px, transparent 0.5px);
}
:global(.dark) .noMessagesContent,
:global(.dark) .noActiveChatContent {
  background: rgba(30, 41, 59, 0.9); /* Darker, less transparent */
  color: var(--neutral-300);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4); /* Darker shadow */
}
:global(.dark) .noMessagesContent svg,
:global(.dark) .noActiveChatContent svg {
  color: var(--primary-500);
}
:global(.dark) .noMessagesContent .hint {
  color: var(--neutral-500);
}
:global(.dark) .errorContent {
   background-color: var(--danger-darker, #450a0a);
   color: var(--danger-light, #fecaca);
   border-color: var(--danger-dark, #7f1d1d);
}

:global(.dark) .dateSeparator {
  color: var(--neutral-500);
}
:global(.dark) .dateSeparator::before,
:global(.dark) .dateSeparator::after {
  background-color: var(--neutral-700);
}
:global(.dark) .dateSeparator span {
  background-color: var(--neutral-800); /* Darker bg for contrast */
  border-color: var(--neutral-700);
  color: var(--neutral-400);
}

:global(.dark) .messageBubble {
   box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Darker shadow */
}
:global(.dark) .messageBubble.received {
  background-color: var(--neutral-750); /* Slightly different bg */
  color: var(--neutral-100);
}
:global(.dark) .messageBubble.sent {
  background: linear-gradient(135deg, var(--primary-dark, #c21e56), var(--secondary-dark, #cc3366)); /* Darker gradient */
  color: var(--white);
}
:global(.dark) .messageBubble.received .messageMeta {
  color: var(--neutral-400);
}
:global(.dark) .messageBubble.sent .messageMeta {
  color: rgba(255, 255, 255, 0.8);
}

:global(.dark) .systemMessageContent {
   background-color: var(--neutral-750);
   color: var(--neutral-300);
}
:global(.dark) .systemMessageContent.errorContent {
   background-color: var(--danger-darker, #450a0a);
   color: var(--danger-light, #fecaca);
   border: 1px solid var(--danger-dark, #7f1d1d);
}
:global(.dark) .systemMessageContent .messageTime {
  color: var(--neutral-500);
}

:global(.dark) .typingIndicator {
  background-color: var(--neutral-750);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}
:global(.dark) .typingIndicator .dot {
  background-color: var(--neutral-600);
}
@keyframes typingAnimationDark {
  0%, 60%, 100% { transform: translateY(0); background-color: var(--neutral-600); }
  30% { transform: translateY(-4px); background-color: var(--primary-400); }
}
:global(.dark) .typingIndicator .dot {
   animation-name: typingAnimationDark;
}

:global(.dark) .attachmentPreview {
   background-color: var(--neutral-800); /* Match input area */
   border-color: var(--neutral-700);
}
:global(.dark) .attachmentName {
   color: var(--neutral-200);
}
:global(.dark) .attachmentSize {
   color: var(--neutral-400);
}
:global(.dark) .removeAttachment {
  color: var(--danger-light, #fda4af);
}
:global(.dark) .removeAttachment:hover {
   background-color: var(--danger-darker, #450a0a);
}
:global(.dark) .uploadProgressContainer {
  background-color: var(--neutral-700);
}
:global(.dark) .uploadProgressBar {
   background: linear-gradient(to right, var(--primary-400), var(--secondary-light));
}

:global(.dark) .fileAttachment {
   background-color: rgba(255, 255, 255, 0.08); /* Lighter overlay */
}
:global(.dark) .fileName {
   color: var(--neutral-200);
}
:global(.dark) .fileSize {
   color: var(--neutral-400);
}
:global(.dark) .downloadLink {
   color: var(--info-light, #7dd3fc);
}
:global(.dark) .downloadLink:hover {
   color: var(--info-lighter, #e0f2fe);
}

:global(.dark) .emojiPicker {
  background-color: var(--neutral-800);
  border-color: var(--neutral-700);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
}
:global(.dark) .emojiHeader {
  background-color: var(--neutral-750);
  border-color: var(--neutral-650);
}
:global(.dark) .emojiHeader h4 {
  color: var(--neutral-200);
}
:global(.dark) .emojiHeader button {
  color: var(--neutral-400);
}
:global(.dark) .emojiHeader button:hover {
  background-color: var(--neutral-700);
  color: var(--primary-300);
}
:global(.dark) .emojiList {
  scrollbar-color: var(--neutral-600) var(--neutral-750);
}
:global(.dark) .emojiList::-webkit-scrollbar-track { background: var(--neutral-750); }
:global(.dark) .emojiList::-webkit-scrollbar-thumb { background-color: var(--neutral-600); }
:global(.dark) .emojiList button:hover {
  background-color: var(--neutral-700);
}

:global(.dark) .messageInput {
  background-color: var(--neutral-800);
  border-color: var(--neutral-700);
  color: var(--neutral-100);
}
:global(.dark) .messageInput::placeholder {
  color: var(--neutral-500);
}
:global(.dark) .messageInput:focus {
  border-color: var(--primary-400);
  box-shadow: 0 0 0 3px var(--primary-focus-ring-dark, rgba(255, 51, 119, 0.3));
  background-color: var(--neutral-800);
}
:global(.dark) .messageInput:disabled {
  background-color: var(--neutral-750);
  opacity: 0.6;
}

:global(.dark) .emojiButton,
:global(.dark) .attachButton {
  color: var(--neutral-400);
}
:global(.dark) .emojiButton:hover,
:global(.dark) .attachButton:hover {
  background-color: var(--neutral-750);
  color: var(--primary-300);
}
:global(.dark) .winkButton {
  color: var(--primary-300);
}
:global(.dark) .winkButton:hover {
  background-color: var(--neutral-750);
}
:global(.dark) .attachButton:disabled,
:global(.dark) .winkButton:disabled {
   color: var(--neutral-600);
}

:global(.dark) .sendButton {
   background: linear-gradient(135deg, var(--primary-dark, #c21e56), var(--secondary-dark, #cc3366));
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
}
:global(.dark) .sendButton:hover {
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
}
:global(.dark) .sendButton.disabled {
  background: var(--neutral-600);
}

:global(.dark) .btnPrimary {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
}
:global(.dark) .btnPrimary:hover {
   box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
}
:global(.dark) .btnSecondary {
   background: var(--neutral-750);
   color: var(--primary-300);
   border-color: var(--primary-300);
   box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}
:global(.dark) .btnSecondary:hover {
   background: var(--neutral-700);
   box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}
